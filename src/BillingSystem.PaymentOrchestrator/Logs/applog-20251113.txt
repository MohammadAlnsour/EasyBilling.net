2025-11-13 09:37:09.286 +03:00 [DBG] Hosting starting
2025-11-13 09:37:09.825 +03:00 [DBG] Starting bus instances: IBus
2025-11-13 09:37:09.835 +03:00 [DBG] Starting bus: "rabbitmq://localhost/"
2025-11-13 09:37:09.883 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-11-13 09:37:09.885 +03:00 [INF] Hosting environment: Development
2025-11-13 09:37:09.888 +03:00 [INF] Content root path: C:\Repositories\Gac-BillingSystem\src\BillingSystem.PaymentOrchestrator
2025-11-13 09:37:09.898 +03:00 [DBG] Hosting started
2025-11-13 09:37:09.899 +03:00 [DBG] Connect: guest@localhost:5672/
2025-11-13 09:37:09.923 +03:00 [DBG] Connected: guest@localhost:5672/ (address: amqp://localhost:5672, local: 56248)
2025-11-13 09:37:09.927 +03:00 [INF] RabbitMQ Consumer started for queue InvoiceCreatedQueue
2025-11-13 09:37:09.958 +03:00 [DBG] Endpoint Ready: "rabbitmq://localhost/ECHGHANNAMLP1_BillingSystemP_bus_kowyyyyh3bcsy6gybdxnr9a1nd?temporary=true"
2025-11-13 09:37:09.961 +03:00 [INF] Bus started: "rabbitmq://localhost/"
2025-11-13 09:44:27.836 +03:00 [DBG] Hosting starting
2025-11-13 09:44:28.206 +03:00 [DBG] Starting bus instances: IBus
2025-11-13 09:44:28.217 +03:00 [DBG] Starting bus: "rabbitmq://localhost/"
2025-11-13 09:44:28.249 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-11-13 09:44:28.261 +03:00 [INF] Hosting environment: Development
2025-11-13 09:44:28.266 +03:00 [INF] Content root path: C:\Repositories\Gac-BillingSystem\src\BillingSystem.PaymentOrchestrator
2025-11-13 09:44:28.276 +03:00 [DBG] Hosting started
2025-11-13 09:44:28.277 +03:00 [DBG] Connect: guest@localhost:5672/
2025-11-13 09:44:28.306 +03:00 [DBG] Connected: guest@localhost:5672/ (address: amqp://localhost:5672, local: 64835)
2025-11-13 09:44:28.309 +03:00 [INF] RabbitMQ Consumer started for queue InvoiceCreatedQueue
2025-11-13 09:44:28.357 +03:00 [DBG] Endpoint Ready: "rabbitmq://localhost/ECHGHANNAMLP1_BillingSystemP_bus_bogyyyyh3bcsb1sxbdxnfyyzr5?temporary=true"
2025-11-13 09:44:28.359 +03:00 [INF] Bus started: "rabbitmq://localhost/"
2025-11-13 10:10:09.645 +03:00 [DBG] Hosting starting
2025-11-13 10:10:09.983 +03:00 [DBG] Starting bus instances: IBus
2025-11-13 10:10:09.991 +03:00 [DBG] Starting bus: "rabbitmq://localhost/"
2025-11-13 10:10:10.024 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-11-13 10:10:10.034 +03:00 [INF] Hosting environment: Development
2025-11-13 10:10:10.037 +03:00 [INF] Content root path: C:\Repositories\Gac-BillingSystem\src\BillingSystem.PaymentOrchestrator
2025-11-13 10:10:10.039 +03:00 [DBG] Hosting started
2025-11-13 10:10:10.041 +03:00 [DBG] Connect: guest@localhost:5672/
2025-11-13 10:10:10.063 +03:00 [DBG] Connected: guest@localhost:5672/ (address: amqp://localhost:5672, local: 50159)
2025-11-13 10:10:10.076 +03:00 [INF] RabbitMQ Consumer started for queue InvoiceCreatedQueue
2025-11-13 10:10:10.137 +03:00 [DBG] Endpoint Ready: "rabbitmq://localhost/ECHGHANNAMLP1_BillingSystemP_bus_dysyyyyh3bcsbpbzbdxnfy7qra?temporary=true"
2025-11-13 10:10:10.140 +03:00 [INF] Bus started: "rabbitmq://localhost/"
2025-11-13 10:11:28.643 +03:00 [DBG] An 'IServiceProvider' was created for internal use by Entity Framework.
2025-11-13 10:11:35.543 +03:00 [DBG] No relationship from 'Invoice' to 'Invoice' has been configured by convention because there are multiple properties on one entity type - {'DiscountedPrimaryInvoice'} that could be matched with the properties on the other entity type - {'InverseDiscountedPrimaryInvoice', 'InversePrimaryInvoice', 'InverseSubstitutionPrimaryInvoice', 'PrimaryInvoice', 'SubstitutionPrimaryInvoice'}. This message can be disregarded if explicit configuration has been specified in 'OnModelCreating'.
2025-11-13 10:11:35.786 +03:00 [DBG] No relationship from 'Invoice' to 'Invoice' has been configured by convention because there are multiple properties on one entity type - {'DiscountedPrimaryInvoice'} that could be matched with the properties on the other entity type - {'InverseDiscountedPrimaryInvoice', 'InversePrimaryInvoice', 'InverseSubstitutionPrimaryInvoice', 'PrimaryInvoice', 'SubstitutionPrimaryInvoice'}. This message can be disregarded if explicit configuration has been specified in 'OnModelCreating'.
2025-11-13 10:11:35.805 +03:00 [DBG] No relationship from 'Invoice' to 'Invoice' has been configured by convention because there are multiple properties on one entity type - {'InversePrimaryInvoice'} that could be matched with the properties on the other entity type - {'InverseSubstitutionPrimaryInvoice', 'PrimaryInvoice', 'SubstitutionPrimaryInvoice'}. This message can be disregarded if explicit configuration has been specified in 'OnModelCreating'.
2025-11-13 10:11:35.816 +03:00 [DBG] No relationship from 'Invoice' to 'Invoice' has been configured by convention because there are multiple properties on one entity type - {'InversePrimaryInvoice'} that could be matched with the properties on the other entity type - {'InverseSubstitutionPrimaryInvoice', 'PrimaryInvoice', 'SubstitutionPrimaryInvoice'}. This message can be disregarded if explicit configuration has been specified in 'OnModelCreating'.
2025-11-13 10:11:36.100 +03:00 [DBG] Entity Framework Core 9.0.9 initialized 'BillingServiceDBContext' using provider 'Microsoft.EntityFrameworkCore.SqlServer:9.0.9' with options: EngineType=SqlServer 
2025-11-13 10:11:36.275 +03:00 [DBG] Compiling query expression: 
'DbSet<Invoice>()
    .SingleOrDefault(p => p.Id == __entity_Id_0)'
2025-11-13 10:11:36.633 +03:00 [DBG] Generated query execution expression: 
'queryContext => SingleQueryingEnumerable.Create<Invoice>(
    relationalQueryContext: (RelationalQueryContext)queryContext, 
    relationalCommandResolver: parameters => [LIFTABLE Constant: RelationalCommandCache.QueryExpression(
        Projection Mapping:
            EmptyProjectionMember -> Dictionary<IProperty, int> { [Property: Invoice.Id (long) Required PK AfterSave:Throw ValueGenerated.OnAdd, 0], [Property: Invoice.Amount (decimal) Required, 1], [Property: Invoice.CancelationReasons (string) MaxLength(3000), 2], [Property: Invoice.ClientReferenceNumber (string) MaxLength(100), 3], [Property: Invoice.CreatedBy (string) Required MaxLength(50), 4], [Property: Invoice.CreatedDate (DateTime) Required, 5], [Property: Invoice.Currency (string) Required MaxLength(50), 6], [Property: Invoice.CustomerId (long) Required FK Index, 7], [Property: Invoice.DiscountedPrimaryInvoiceId (long?) FK Index, 8], [Property: Invoice.DueAt (DateTime?), 9], [Property: Invoice.ExternalId (Guid) Required Index, 10], [Property: Invoice.InvoiceNumber (string) Required MaxLength(50), 11], [Property: Invoice.InvoiceStatus (int) Required, 12], [Property: Invoice.InvoiceType (int) Required, 13], [Property: Invoice.IsDeleted (bool) Required, 14], [Property: Invoice.IsDiscounted (bool?), 15], [Property: Invoice.IsSubInvoice (bool?), 16], [Property: Invoice.IsSubstitution (bool?), 17], [Property: Invoice.IssuedAt (DateTime) Required, 18], [Property: Invoice.LastUpdatedDate (DateTime?), 19], [Property: Invoice.Metadata (string), 20], [Property: Invoice.PaymentProvider (string) MaxLength(100), 21], [Property: Invoice.PaymentReference (string) MaxLength(100), 22], [Property: Invoice.PrimaryInvoiceId (long?) FK Index, 23], [Property: Invoice.SubstitutionPrimaryInvoiceId (long?) FK Index, 24], [Property: Invoice.TenantId (int) Required FK Index, 25] }
        SELECT TOP(2) i.Id, i.Amount, i.CancelationReasons, i.ClientReferenceNumber, i.CreatedBy, i.CreatedDate, i.Currency, i.CustomerID, i.DiscountedPrimaryInvoiceID, i.DueAt, i.ExternalId, i.InvoiceNumber, i.InvoiceStatus, i.InvoiceType, i.IsDeleted, i.IsDiscounted, i.IsSubInvoice, i.IsSubstitution, i.IssuedAt, i.LastUpdatedDate, i.Metadata, i.PaymentProvider, i.PaymentReference, i.PrimaryInvoiceID, i.SubstitutionPrimaryInvoiceID, i.TenantId
        FROM Invoices AS i
        WHERE i.Id == @__entity_Id_0) | Resolver: c => new RelationalCommandCache(
        c.Dependencies.MemoryCache, 
        c.RelationalDependencies.QuerySqlGeneratorFactory, 
        c.RelationalDependencies.RelationalParameterBasedSqlProcessorFactory, 
        Projection Mapping:
            EmptyProjectionMember -> Dictionary<IProperty, int> { [Property: Invoice.Id (long) Required PK AfterSave:Throw ValueGenerated.OnAdd, 0], [Property: Invoice.Amount (decimal) Required, 1], [Property: Invoice.CancelationReasons (string) MaxLength(3000), 2], [Property: Invoice.ClientReferenceNumber (string) MaxLength(100), 3], [Property: Invoice.CreatedBy (string) Required MaxLength(50), 4], [Property: Invoice.CreatedDate (DateTime) Required, 5], [Property: Invoice.Currency (string) Required MaxLength(50), 6], [Property: Invoice.CustomerId (long) Required FK Index, 7], [Property: Invoice.DiscountedPrimaryInvoiceId (long?) FK Index, 8], [Property: Invoice.DueAt (DateTime?), 9], [Property: Invoice.ExternalId (Guid) Required Index, 10], [Property: Invoice.InvoiceNumber (string) Required MaxLength(50), 11], [Property: Invoice.InvoiceStatus (int) Required, 12], [Property: Invoice.InvoiceType (int) Required, 13], [Property: Invoice.IsDeleted (bool) Required, 14], [Property: Invoice.IsDiscounted (bool?), 15], [Property: Invoice.IsSubInvoice (bool?), 16], [Property: Invoice.IsSubstitution (bool?), 17], [Property: Invoice.IssuedAt (DateTime) Required, 18], [Property: Invoice.LastUpdatedDate (DateTime?), 19], [Property: Invoice.Metadata (string), 20], [Property: Invoice.PaymentProvider (string) MaxLength(100), 21], [Property: Invoice.PaymentReference (string) MaxLength(100), 22], [Property: Invoice.PrimaryInvoiceId (long?) FK Index, 23], [Property: Invoice.SubstitutionPrimaryInvoiceId (long?) FK Index, 24], [Property: Invoice.TenantId (int) Required FK Index, 25] }
        SELECT TOP(2) i.Id, i.Amount, i.CancelationReasons, i.ClientReferenceNumber, i.CreatedBy, i.CreatedDate, i.Currency, i.CustomerID, i.DiscountedPrimaryInvoiceID, i.DueAt, i.ExternalId, i.InvoiceNumber, i.InvoiceStatus, i.InvoiceType, i.IsDeleted, i.IsDiscounted, i.IsSubInvoice, i.IsSubstitution, i.IssuedAt, i.LastUpdatedDate, i.Metadata, i.PaymentProvider, i.PaymentReference, i.PrimaryInvoiceID, i.SubstitutionPrimaryInvoiceID, i.TenantId
        FROM Invoices AS i
        WHERE i.Id == @__entity_Id_0, 
        False, 
        new HashSet<string>(
            new string[]{ }, 
            StringComparer.Ordinal
        )
    )].GetRelationalCommandTemplate(parameters), 
    readerColumns: null, 
    shaper: (queryContext, dataReader, resultContext, resultCoordinator) => 
    {
        Invoice entity;
        entity = 
        {
            MaterializationContext materializationContext1;
            IEntityType entityType1;
            Invoice instance1;
            InternalEntityEntry entry1;
            bool hasNullKey1;
            materializationContext1 = new MaterializationContext(
                [LIFTABLE Constant: ValueBuffer | Resolver: _ => (object)ValueBuffer.Empty], 
                queryContext.Context
            );
            instance1 = default(Invoice);
            entry1 = queryContext.TryGetEntry(
                key: [LIFTABLE Constant: Key: Invoice.Id PK | Resolver: c => c.Dependencies.Model.FindEntityType("BillingSystem.Domain.Entities.Invoice").FindPrimaryKey()], 
                keyValues: new object[]{ (object)dataReader.GetInt64(0) }, 
                throwOnNullKey: True, 
                hasNullKey: hasNullKey1);
            !(hasNullKey1) ? entry1 != default(InternalEntityEntry) ? 
            {
                entityType1 = entry1.EntityType;
                return instance1 = (Invoice)entry1.Entity;
            } : 
            {
                ISnapshot shadowSnapshot1;
                shadowSnapshot1 = [LIFTABLE Constant: Snapshot | Resolver: _ => Snapshot.Empty];
                entityType1 = [LIFTABLE Constant: EntityType: Invoice | Resolver: namelessParameter{0} => namelessParameter{0}.Dependencies.Model.FindEntityType("BillingSystem.Domain.Entities.Invoice")];
                instance1 = switch (entityType1)
                {
                    case [LIFTABLE Constant: EntityType: Invoice | Resolver: namelessParameter{1} => namelessParameter{1}.Dependencies.Model.FindEntityType("BillingSystem.Domain.Entities.Invoice")]: 
                        {
                            return 
                            {
                                Invoice instance;
                                instance = new Invoice();
                                instance.<Id>k__BackingField = dataReader.GetInt64(0);
                                instance.<Amount>k__BackingField = dataReader.GetDecimal(1);
                                instance.<CancelationReasons>k__BackingField = dataReader.IsDBNull(2) ? default(string) : dataReader.GetString(2);
                                instance.<ClientReferenceNumber>k__BackingField = dataReader.IsDBNull(3) ? default(string) : dataReader.GetString(3);
                                instance.<CreatedBy>k__BackingField = dataReader.GetString(4);
                                instance.<CreatedDate>k__BackingField = dataReader.GetDateTime(5);
                                instance.<Currency>k__BackingField = dataReader.GetString(6);
                                instance.<CustomerId>k__BackingField = dataReader.GetInt64(7);
                                instance.<DiscountedPrimaryInvoiceId>k__BackingField = dataReader.IsDBNull(8) ? default(long?) : (long?)dataReader.GetInt64(8);
                                instance.<DueAt>k__BackingField = dataReader.IsDBNull(9) ? default(DateTime?) : (DateTime?)dataReader.GetDateTime(9);
                                instance.<ExternalId>k__BackingField = dataReader.GetGuid(10);
                                instance.<InvoiceNumber>k__BackingField = dataReader.GetString(11);
                                instance.<InvoiceStatus>k__BackingField = dataReader.GetInt32(12);
                                instance.<InvoiceType>k__BackingField = dataReader.GetInt32(13);
                                instance.<IsDeleted>k__BackingField = dataReader.GetBoolean(14);
                                instance.<IsDiscounted>k__BackingField = dataReader.IsDBNull(15) ? default(bool?) : (bool?)dataReader.GetBoolean(15);
                                instance.<IsSubInvoice>k__BackingField = dataReader.IsDBNull(16) ? default(bool?) : (bool?)dataReader.GetBoolean(16);
                                instance.<IsSubstitution>k__BackingField = dataReader.IsDBNull(17) ? default(bool?) : (bool?)dataReader.GetBoolean(17);
                                instance.<IssuedAt>k__BackingField = dataReader.GetDateTime(18);
                                instance.<LastUpdatedDate>k__BackingField = dataReader.IsDBNull(19) ? default(DateTime?) : (DateTime?)dataReader.GetDateTime(19);
                                instance.<Metadata>k__BackingField = dataReader.IsDBNull(20) ? default(string) : dataReader.GetString(20);
                                instance.<PaymentProvider>k__BackingField = dataReader.IsDBNull(21) ? default(string) : dataReader.GetString(21);
                                instance.<PaymentReference>k__BackingField = dataReader.IsDBNull(22) ? default(string) : dataReader.GetString(22);
                                instance.<PrimaryInvoiceId>k__BackingField = dataReader.IsDBNull(23) ? default(long?) : (long?)dataReader.GetInt64(23);
                                instance.<SubstitutionPrimaryInvoiceId>k__BackingField = dataReader.IsDBNull(24) ? default(long?) : (long?)dataReader.GetInt64(24);
                                instance.<TenantId>k__BackingField = dataReader.GetInt32(25);
                                (instance is IInjectableService) ? ((IInjectableService)instance).Injected(
                                    context: materializationContext1.Context, 
                                    entity: instance, 
                                    queryTrackingBehavior: TrackAll, 
                                    structuralType: [LIFTABLE Constant: EntityType: Invoice | Resolver: namelessParameter{2} => namelessParameter{2}.Dependencies.Model.FindEntityType("BillingSystem.Domain.Entities.Invoice")]) : default(void);
                                return instance;
                            }}
                    default: 
                        default(Invoice)
                }
                ;
                entry1 = entityType1 == default(IEntityType) ? default(InternalEntityEntry) : queryContext.StartTracking(
                    entityType: entityType1, 
                    entity: instance1, 
                    snapshot: shadowSnapshot1);
                return instance1;
            } : default(void);
            return instance1;
        };
        return entity;
    }, 
    contextType: BillingSystem.Infrastructure.EF.BillingServiceDBContext, 
    standAloneStateManager: False, 
    detailedErrorsEnabled: False, 
    threadSafetyChecksEnabled: True)
    .SingleOrDefault()'
2025-11-13 10:11:36.674 +03:00 [DBG] Creating DbConnection.
2025-11-13 10:11:36.696 +03:00 [DBG] Created DbConnection. (19ms).
2025-11-13 10:11:36.702 +03:00 [DBG] Opening connection to database 'GAC-BillingService' on server '.'.
2025-11-13 10:11:37.265 +03:00 [DBG] Opened connection to database 'GAC-BillingService' on server '.'.
2025-11-13 10:11:37.273 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-11-13 10:11:37.283 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (6ms).
2025-11-13 10:11:37.296 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (24ms).
2025-11-13 10:11:37.311 +03:00 [DBG] Executing DbCommand [Parameters=[@__entity_Id_0='?' (DbType = Int64)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(2) [i].[Id], [i].[Amount], [i].[CancelationReasons], [i].[ClientReferenceNumber], [i].[CreatedBy], [i].[CreatedDate], [i].[Currency], [i].[CustomerID], [i].[DiscountedPrimaryInvoiceID], [i].[DueAt], [i].[ExternalId], [i].[InvoiceNumber], [i].[InvoiceStatus], [i].[InvoiceType], [i].[IsDeleted], [i].[IsDiscounted], [i].[IsSubInvoice], [i].[IsSubstitution], [i].[IssuedAt], [i].[LastUpdatedDate], [i].[Metadata], [i].[PaymentProvider], [i].[PaymentReference], [i].[PrimaryInvoiceID], [i].[SubstitutionPrimaryInvoiceID], [i].[TenantId]
FROM [Invoices] AS [i]
WHERE [i].[Id] = @__entity_Id_0
2025-11-13 10:11:37.452 +03:00 [INF] Executed DbCommand (132ms) [Parameters=[@__entity_Id_0='?' (DbType = Int64)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(2) [i].[Id], [i].[Amount], [i].[CancelationReasons], [i].[ClientReferenceNumber], [i].[CreatedBy], [i].[CreatedDate], [i].[Currency], [i].[CustomerID], [i].[DiscountedPrimaryInvoiceID], [i].[DueAt], [i].[ExternalId], [i].[InvoiceNumber], [i].[InvoiceStatus], [i].[InvoiceType], [i].[IsDeleted], [i].[IsDiscounted], [i].[IsSubInvoice], [i].[IsSubstitution], [i].[IssuedAt], [i].[LastUpdatedDate], [i].[Metadata], [i].[PaymentProvider], [i].[PaymentReference], [i].[PrimaryInvoiceID], [i].[SubstitutionPrimaryInvoiceID], [i].[TenantId]
FROM [Invoices] AS [i]
WHERE [i].[Id] = @__entity_Id_0
2025-11-13 10:11:37.480 +03:00 [DBG] Closing data reader to 'GAC-BillingService' on server '.'.
2025-11-13 10:11:37.503 +03:00 [DBG] A data reader for 'GAC-BillingService' on server '.' is being disposed after spending 26ms reading results.
2025-11-13 10:11:37.514 +03:00 [DBG] Closing connection to database 'GAC-BillingService' on server '.'.
2025-11-13 10:11:37.526 +03:00 [DBG] Closed connection to database 'GAC-BillingService' on server '.' (11ms).
2025-11-13 10:11:39.242 +03:00 [DBG] 'BillingServiceDBContext' disposed.
2025-11-13 10:11:39.249 +03:00 [DBG] Disposing connection to database 'GAC-BillingService' on server '.'.
2025-11-13 10:11:39.256 +03:00 [DBG] Disposed connection to database '' on server '' (6ms).
2025-11-13 10:11:40.849 +03:00 [INF] Processed message: invoice Id: 0
2025-11-13 10:26:47.338 +03:00 [DBG] Hosting starting
2025-11-13 10:26:47.926 +03:00 [DBG] Starting bus instances: IBus
2025-11-13 10:26:47.936 +03:00 [DBG] Starting bus: "rabbitmq://localhost/"
2025-11-13 10:26:47.980 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-11-13 10:26:47.996 +03:00 [INF] Hosting environment: Development
2025-11-13 10:26:48.000 +03:00 [INF] Content root path: C:\Repositories\Gac-BillingSystem\src\BillingSystem.PaymentOrchestrator
2025-11-13 10:26:48.015 +03:00 [DBG] Hosting started
2025-11-13 10:26:48.015 +03:00 [DBG] Connect: guest@localhost:5672/
2025-11-13 10:26:48.052 +03:00 [DBG] Connected: guest@localhost:5672/ (address: amqp://localhost:5672, local: 65160)
2025-11-13 10:26:48.059 +03:00 [INF] RabbitMQ Consumer started for queue InvoiceCreatedQueue
2025-11-13 10:26:48.132 +03:00 [DBG] Endpoint Ready: "rabbitmq://localhost/ECHGHANNAMLP1_BillingSystemP_bus_1tfoyyyh3bcsbxkwbdxnfbobn3?temporary=true"
2025-11-13 10:26:48.135 +03:00 [INF] Bus started: "rabbitmq://localhost/"
2025-11-13 10:36:12.003 +03:00 [DBG] Hosting starting
2025-11-13 10:36:12.682 +03:00 [DBG] Starting bus instances: IBus
2025-11-13 10:36:12.691 +03:00 [DBG] Starting bus: "rabbitmq://localhost/"
2025-11-13 10:36:12.761 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-11-13 10:36:12.766 +03:00 [INF] Hosting environment: Development
2025-11-13 10:36:12.770 +03:00 [INF] Content root path: C:\Repositories\Gac-BillingSystem\src\BillingSystem.PaymentOrchestrator
2025-11-13 10:36:12.773 +03:00 [DBG] Connect: guest@localhost:5672/
2025-11-13 10:36:12.775 +03:00 [DBG] Hosting started
2025-11-13 10:36:12.807 +03:00 [DBG] Connected: guest@localhost:5672/ (address: amqp://localhost:5672, local: 57630)
2025-11-13 10:36:12.818 +03:00 [INF] RabbitMQ Consumer started for queue InvoiceCreatedQueue
2025-11-13 10:36:12.855 +03:00 [DBG] Endpoint Ready: "rabbitmq://localhost/ECHGHANNAMLP1_BillingSystemP_bus_jd7yyyyh3bcsyw6mbdxnfb4t8w?temporary=true"
2025-11-13 10:36:12.859 +03:00 [INF] Bus started: "rabbitmq://localhost/"
2025-11-13 10:41:41.742 +03:00 [DBG] Hosting starting
2025-11-13 10:41:42.156 +03:00 [DBG] Starting bus instances: IBus
2025-11-13 10:41:42.204 +03:00 [DBG] Starting bus: "rabbitmq://localhost/"
2025-11-13 10:41:42.235 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-11-13 10:41:42.245 +03:00 [INF] Hosting environment: Development
2025-11-13 10:41:42.248 +03:00 [INF] Content root path: C:\Repositories\Gac-BillingSystem\src\BillingSystem.PaymentOrchestrator
2025-11-13 10:41:42.258 +03:00 [DBG] Hosting started
2025-11-13 10:41:42.260 +03:00 [DBG] Connect: guest@localhost:5672/
2025-11-13 10:41:42.284 +03:00 [DBG] Connected: guest@localhost:5672/ (address: amqp://localhost:5672, local: 64501)
2025-11-13 10:41:42.288 +03:00 [INF] RabbitMQ Consumer started for queue InvoiceCreatedQueue
2025-11-13 10:41:42.321 +03:00 [DBG] Endpoint Ready: "rabbitmq://localhost/ECHGHANNAMLP1_BillingSystemP_bus_dtnoyyyh3bcsbzmmbdxnfnysdb?temporary=true"
2025-11-13 10:41:42.323 +03:00 [INF] Bus started: "rabbitmq://localhost/"
2025-11-13 10:46:05.848 +03:00 [DBG] Hosting starting
2025-11-13 10:46:06.527 +03:00 [DBG] Starting bus instances: IBus
2025-11-13 10:46:06.536 +03:00 [DBG] Starting bus: "rabbitmq://localhost/"
2025-11-13 10:46:06.585 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-11-13 10:46:06.597 +03:00 [INF] Hosting environment: Development
2025-11-13 10:46:06.607 +03:00 [INF] Content root path: C:\Repositories\Gac-BillingSystem\src\BillingSystem.PaymentOrchestrator
2025-11-13 10:46:06.613 +03:00 [DBG] Hosting started
2025-11-13 10:46:06.616 +03:00 [DBG] Connect: guest@localhost:5672/
2025-11-13 10:46:06.643 +03:00 [DBG] Connected: guest@localhost:5672/ (address: amqp://localhost:5672, local: 63241)
2025-11-13 10:46:06.651 +03:00 [INF] RabbitMQ Consumer started for queue InvoiceCreatedQueue
2025-11-13 10:46:06.718 +03:00 [DBG] Endpoint Ready: "rabbitmq://localhost/ECHGHANNAMLP1_BillingSystemP_bus_6oyoyyyh3bcsyxmabdxnfnfu88?temporary=true"
2025-11-13 10:46:06.722 +03:00 [INF] Bus started: "rabbitmq://localhost/"
2025-11-13 10:47:23.395 +03:00 [DBG] An 'IServiceProvider' was created for internal use by Entity Framework.
2025-11-13 10:47:23.780 +03:00 [DBG] No relationship from 'Invoice' to 'Invoice' has been configured by convention because there are multiple properties on one entity type - {'DiscountedPrimaryInvoice'} that could be matched with the properties on the other entity type - {'InverseDiscountedPrimaryInvoice', 'InversePrimaryInvoice', 'InverseSubstitutionPrimaryInvoice', 'PrimaryInvoice', 'SubstitutionPrimaryInvoice'}. This message can be disregarded if explicit configuration has been specified in 'OnModelCreating'.
2025-11-13 10:47:23.995 +03:00 [DBG] No relationship from 'Invoice' to 'Invoice' has been configured by convention because there are multiple properties on one entity type - {'DiscountedPrimaryInvoice'} that could be matched with the properties on the other entity type - {'InverseDiscountedPrimaryInvoice', 'InversePrimaryInvoice', 'InverseSubstitutionPrimaryInvoice', 'PrimaryInvoice', 'SubstitutionPrimaryInvoice'}. This message can be disregarded if explicit configuration has been specified in 'OnModelCreating'.
2025-11-13 10:47:24.009 +03:00 [DBG] No relationship from 'Invoice' to 'Invoice' has been configured by convention because there are multiple properties on one entity type - {'InversePrimaryInvoice'} that could be matched with the properties on the other entity type - {'InverseSubstitutionPrimaryInvoice', 'PrimaryInvoice', 'SubstitutionPrimaryInvoice'}. This message can be disregarded if explicit configuration has been specified in 'OnModelCreating'.
2025-11-13 10:47:24.017 +03:00 [DBG] No relationship from 'Invoice' to 'Invoice' has been configured by convention because there are multiple properties on one entity type - {'InversePrimaryInvoice'} that could be matched with the properties on the other entity type - {'InverseSubstitutionPrimaryInvoice', 'PrimaryInvoice', 'SubstitutionPrimaryInvoice'}. This message can be disregarded if explicit configuration has been specified in 'OnModelCreating'.
2025-11-13 10:47:24.346 +03:00 [DBG] Entity Framework Core 9.0.9 initialized 'BillingServiceDBContext' using provider 'Microsoft.EntityFrameworkCore.SqlServer:9.0.9' with options: EngineType=SqlServer 
2025-11-13 10:47:24.435 +03:00 [DBG] Compiling query expression: 
'DbSet<Invoice>()
    .SingleOrDefault(p => p.Id == __entity_Id_0)'
2025-11-13 10:47:24.751 +03:00 [DBG] Generated query execution expression: 
'queryContext => SingleQueryingEnumerable.Create<Invoice>(
    relationalQueryContext: (RelationalQueryContext)queryContext, 
    relationalCommandResolver: parameters => [LIFTABLE Constant: RelationalCommandCache.QueryExpression(
        Projection Mapping:
            EmptyProjectionMember -> Dictionary<IProperty, int> { [Property: Invoice.Id (long) Required PK AfterSave:Throw ValueGenerated.OnAdd, 0], [Property: Invoice.Amount (decimal) Required, 1], [Property: Invoice.CancelationReasons (string) MaxLength(3000), 2], [Property: Invoice.ClientReferenceNumber (string) MaxLength(100), 3], [Property: Invoice.CreatedBy (string) Required MaxLength(50), 4], [Property: Invoice.CreatedDate (DateTime) Required, 5], [Property: Invoice.Currency (string) Required MaxLength(50), 6], [Property: Invoice.CustomerId (long) Required FK Index, 7], [Property: Invoice.DiscountedPrimaryInvoiceId (long?) FK Index, 8], [Property: Invoice.DueAt (DateTime?), 9], [Property: Invoice.ExternalId (Guid) Required Index, 10], [Property: Invoice.InvoiceNumber (string) Required MaxLength(50), 11], [Property: Invoice.InvoiceStatus (int) Required, 12], [Property: Invoice.InvoiceType (int) Required, 13], [Property: Invoice.IsDeleted (bool) Required, 14], [Property: Invoice.IsDiscounted (bool?), 15], [Property: Invoice.IsSubInvoice (bool?), 16], [Property: Invoice.IsSubstitution (bool?), 17], [Property: Invoice.IssuedAt (DateTime) Required, 18], [Property: Invoice.LastUpdatedDate (DateTime?), 19], [Property: Invoice.Metadata (string), 20], [Property: Invoice.PaymentProvider (string) MaxLength(100), 21], [Property: Invoice.PaymentReference (string) MaxLength(100), 22], [Property: Invoice.PrimaryInvoiceId (long?) FK Index, 23], [Property: Invoice.SubstitutionPrimaryInvoiceId (long?) FK Index, 24], [Property: Invoice.TenantId (int) Required FK Index, 25] }
        SELECT TOP(2) i.Id, i.Amount, i.CancelationReasons, i.ClientReferenceNumber, i.CreatedBy, i.CreatedDate, i.Currency, i.CustomerID, i.DiscountedPrimaryInvoiceID, i.DueAt, i.ExternalId, i.InvoiceNumber, i.InvoiceStatus, i.InvoiceType, i.IsDeleted, i.IsDiscounted, i.IsSubInvoice, i.IsSubstitution, i.IssuedAt, i.LastUpdatedDate, i.Metadata, i.PaymentProvider, i.PaymentReference, i.PrimaryInvoiceID, i.SubstitutionPrimaryInvoiceID, i.TenantId
        FROM Invoices AS i
        WHERE i.Id == @__entity_Id_0) | Resolver: c => new RelationalCommandCache(
        c.Dependencies.MemoryCache, 
        c.RelationalDependencies.QuerySqlGeneratorFactory, 
        c.RelationalDependencies.RelationalParameterBasedSqlProcessorFactory, 
        Projection Mapping:
            EmptyProjectionMember -> Dictionary<IProperty, int> { [Property: Invoice.Id (long) Required PK AfterSave:Throw ValueGenerated.OnAdd, 0], [Property: Invoice.Amount (decimal) Required, 1], [Property: Invoice.CancelationReasons (string) MaxLength(3000), 2], [Property: Invoice.ClientReferenceNumber (string) MaxLength(100), 3], [Property: Invoice.CreatedBy (string) Required MaxLength(50), 4], [Property: Invoice.CreatedDate (DateTime) Required, 5], [Property: Invoice.Currency (string) Required MaxLength(50), 6], [Property: Invoice.CustomerId (long) Required FK Index, 7], [Property: Invoice.DiscountedPrimaryInvoiceId (long?) FK Index, 8], [Property: Invoice.DueAt (DateTime?), 9], [Property: Invoice.ExternalId (Guid) Required Index, 10], [Property: Invoice.InvoiceNumber (string) Required MaxLength(50), 11], [Property: Invoice.InvoiceStatus (int) Required, 12], [Property: Invoice.InvoiceType (int) Required, 13], [Property: Invoice.IsDeleted (bool) Required, 14], [Property: Invoice.IsDiscounted (bool?), 15], [Property: Invoice.IsSubInvoice (bool?), 16], [Property: Invoice.IsSubstitution (bool?), 17], [Property: Invoice.IssuedAt (DateTime) Required, 18], [Property: Invoice.LastUpdatedDate (DateTime?), 19], [Property: Invoice.Metadata (string), 20], [Property: Invoice.PaymentProvider (string) MaxLength(100), 21], [Property: Invoice.PaymentReference (string) MaxLength(100), 22], [Property: Invoice.PrimaryInvoiceId (long?) FK Index, 23], [Property: Invoice.SubstitutionPrimaryInvoiceId (long?) FK Index, 24], [Property: Invoice.TenantId (int) Required FK Index, 25] }
        SELECT TOP(2) i.Id, i.Amount, i.CancelationReasons, i.ClientReferenceNumber, i.CreatedBy, i.CreatedDate, i.Currency, i.CustomerID, i.DiscountedPrimaryInvoiceID, i.DueAt, i.ExternalId, i.InvoiceNumber, i.InvoiceStatus, i.InvoiceType, i.IsDeleted, i.IsDiscounted, i.IsSubInvoice, i.IsSubstitution, i.IssuedAt, i.LastUpdatedDate, i.Metadata, i.PaymentProvider, i.PaymentReference, i.PrimaryInvoiceID, i.SubstitutionPrimaryInvoiceID, i.TenantId
        FROM Invoices AS i
        WHERE i.Id == @__entity_Id_0, 
        False, 
        new HashSet<string>(
            new string[]{ }, 
            StringComparer.Ordinal
        )
    )].GetRelationalCommandTemplate(parameters), 
    readerColumns: null, 
    shaper: (queryContext, dataReader, resultContext, resultCoordinator) => 
    {
        Invoice entity;
        entity = 
        {
            MaterializationContext materializationContext1;
            IEntityType entityType1;
            Invoice instance1;
            InternalEntityEntry entry1;
            bool hasNullKey1;
            materializationContext1 = new MaterializationContext(
                [LIFTABLE Constant: ValueBuffer | Resolver: _ => (object)ValueBuffer.Empty], 
                queryContext.Context
            );
            instance1 = default(Invoice);
            entry1 = queryContext.TryGetEntry(
                key: [LIFTABLE Constant: Key: Invoice.Id PK | Resolver: c => c.Dependencies.Model.FindEntityType("BillingSystem.Domain.Entities.Invoice").FindPrimaryKey()], 
                keyValues: new object[]{ (object)dataReader.GetInt64(0) }, 
                throwOnNullKey: True, 
                hasNullKey: hasNullKey1);
            !(hasNullKey1) ? entry1 != default(InternalEntityEntry) ? 
            {
                entityType1 = entry1.EntityType;
                return instance1 = (Invoice)entry1.Entity;
            } : 
            {
                ISnapshot shadowSnapshot1;
                shadowSnapshot1 = [LIFTABLE Constant: Snapshot | Resolver: _ => Snapshot.Empty];
                entityType1 = [LIFTABLE Constant: EntityType: Invoice | Resolver: namelessParameter{0} => namelessParameter{0}.Dependencies.Model.FindEntityType("BillingSystem.Domain.Entities.Invoice")];
                instance1 = switch (entityType1)
                {
                    case [LIFTABLE Constant: EntityType: Invoice | Resolver: namelessParameter{1} => namelessParameter{1}.Dependencies.Model.FindEntityType("BillingSystem.Domain.Entities.Invoice")]: 
                        {
                            return 
                            {
                                Invoice instance;
                                instance = new Invoice();
                                instance.<Id>k__BackingField = dataReader.GetInt64(0);
                                instance.<Amount>k__BackingField = dataReader.GetDecimal(1);
                                instance.<CancelationReasons>k__BackingField = dataReader.IsDBNull(2) ? default(string) : dataReader.GetString(2);
                                instance.<ClientReferenceNumber>k__BackingField = dataReader.IsDBNull(3) ? default(string) : dataReader.GetString(3);
                                instance.<CreatedBy>k__BackingField = dataReader.GetString(4);
                                instance.<CreatedDate>k__BackingField = dataReader.GetDateTime(5);
                                instance.<Currency>k__BackingField = dataReader.GetString(6);
                                instance.<CustomerId>k__BackingField = dataReader.GetInt64(7);
                                instance.<DiscountedPrimaryInvoiceId>k__BackingField = dataReader.IsDBNull(8) ? default(long?) : (long?)dataReader.GetInt64(8);
                                instance.<DueAt>k__BackingField = dataReader.IsDBNull(9) ? default(DateTime?) : (DateTime?)dataReader.GetDateTime(9);
                                instance.<ExternalId>k__BackingField = dataReader.GetGuid(10);
                                instance.<InvoiceNumber>k__BackingField = dataReader.GetString(11);
                                instance.<InvoiceStatus>k__BackingField = dataReader.GetInt32(12);
                                instance.<InvoiceType>k__BackingField = dataReader.GetInt32(13);
                                instance.<IsDeleted>k__BackingField = dataReader.GetBoolean(14);
                                instance.<IsDiscounted>k__BackingField = dataReader.IsDBNull(15) ? default(bool?) : (bool?)dataReader.GetBoolean(15);
                                instance.<IsSubInvoice>k__BackingField = dataReader.IsDBNull(16) ? default(bool?) : (bool?)dataReader.GetBoolean(16);
                                instance.<IsSubstitution>k__BackingField = dataReader.IsDBNull(17) ? default(bool?) : (bool?)dataReader.GetBoolean(17);
                                instance.<IssuedAt>k__BackingField = dataReader.GetDateTime(18);
                                instance.<LastUpdatedDate>k__BackingField = dataReader.IsDBNull(19) ? default(DateTime?) : (DateTime?)dataReader.GetDateTime(19);
                                instance.<Metadata>k__BackingField = dataReader.IsDBNull(20) ? default(string) : dataReader.GetString(20);
                                instance.<PaymentProvider>k__BackingField = dataReader.IsDBNull(21) ? default(string) : dataReader.GetString(21);
                                instance.<PaymentReference>k__BackingField = dataReader.IsDBNull(22) ? default(string) : dataReader.GetString(22);
                                instance.<PrimaryInvoiceId>k__BackingField = dataReader.IsDBNull(23) ? default(long?) : (long?)dataReader.GetInt64(23);
                                instance.<SubstitutionPrimaryInvoiceId>k__BackingField = dataReader.IsDBNull(24) ? default(long?) : (long?)dataReader.GetInt64(24);
                                instance.<TenantId>k__BackingField = dataReader.GetInt32(25);
                                (instance is IInjectableService) ? ((IInjectableService)instance).Injected(
                                    context: materializationContext1.Context, 
                                    entity: instance, 
                                    queryTrackingBehavior: TrackAll, 
                                    structuralType: [LIFTABLE Constant: EntityType: Invoice | Resolver: namelessParameter{2} => namelessParameter{2}.Dependencies.Model.FindEntityType("BillingSystem.Domain.Entities.Invoice")]) : default(void);
                                return instance;
                            }}
                    default: 
                        default(Invoice)
                }
                ;
                entry1 = entityType1 == default(IEntityType) ? default(InternalEntityEntry) : queryContext.StartTracking(
                    entityType: entityType1, 
                    entity: instance1, 
                    snapshot: shadowSnapshot1);
                return instance1;
            } : default(void);
            return instance1;
        };
        return entity;
    }, 
    contextType: BillingSystem.Infrastructure.EF.BillingServiceDBContext, 
    standAloneStateManager: False, 
    detailedErrorsEnabled: False, 
    threadSafetyChecksEnabled: True)
    .SingleOrDefault()'
2025-11-13 10:47:24.816 +03:00 [DBG] Creating DbConnection.
2025-11-13 10:47:24.848 +03:00 [DBG] Created DbConnection. (28ms).
2025-11-13 10:47:24.856 +03:00 [DBG] Opening connection to database 'GAC-BillingService' on server '.'.
2025-11-13 10:47:25.271 +03:00 [DBG] Opened connection to database 'GAC-BillingService' on server '.'.
2025-11-13 10:47:25.280 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-11-13 10:47:25.292 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (7ms).
2025-11-13 10:47:25.313 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (32ms).
2025-11-13 10:47:25.330 +03:00 [DBG] Executing DbCommand [Parameters=[@__entity_Id_0='?' (DbType = Int64)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(2) [i].[Id], [i].[Amount], [i].[CancelationReasons], [i].[ClientReferenceNumber], [i].[CreatedBy], [i].[CreatedDate], [i].[Currency], [i].[CustomerID], [i].[DiscountedPrimaryInvoiceID], [i].[DueAt], [i].[ExternalId], [i].[InvoiceNumber], [i].[InvoiceStatus], [i].[InvoiceType], [i].[IsDeleted], [i].[IsDiscounted], [i].[IsSubInvoice], [i].[IsSubstitution], [i].[IssuedAt], [i].[LastUpdatedDate], [i].[Metadata], [i].[PaymentProvider], [i].[PaymentReference], [i].[PrimaryInvoiceID], [i].[SubstitutionPrimaryInvoiceID], [i].[TenantId]
FROM [Invoices] AS [i]
WHERE [i].[Id] = @__entity_Id_0
2025-11-13 10:47:25.412 +03:00 [INF] Executed DbCommand (79ms) [Parameters=[@__entity_Id_0='?' (DbType = Int64)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(2) [i].[Id], [i].[Amount], [i].[CancelationReasons], [i].[ClientReferenceNumber], [i].[CreatedBy], [i].[CreatedDate], [i].[Currency], [i].[CustomerID], [i].[DiscountedPrimaryInvoiceID], [i].[DueAt], [i].[ExternalId], [i].[InvoiceNumber], [i].[InvoiceStatus], [i].[InvoiceType], [i].[IsDeleted], [i].[IsDiscounted], [i].[IsSubInvoice], [i].[IsSubstitution], [i].[IssuedAt], [i].[LastUpdatedDate], [i].[Metadata], [i].[PaymentProvider], [i].[PaymentReference], [i].[PrimaryInvoiceID], [i].[SubstitutionPrimaryInvoiceID], [i].[TenantId]
FROM [Invoices] AS [i]
WHERE [i].[Id] = @__entity_Id_0
2025-11-13 10:47:25.431 +03:00 [DBG] Closing data reader to 'GAC-BillingService' on server '.'.
2025-11-13 10:47:25.451 +03:00 [DBG] A data reader for 'GAC-BillingService' on server '.' is being disposed after spending 19ms reading results.
2025-11-13 10:47:25.461 +03:00 [DBG] Closing connection to database 'GAC-BillingService' on server '.'.
2025-11-13 10:47:25.476 +03:00 [DBG] Closed connection to database 'GAC-BillingService' on server '.' (14ms).
2025-11-13 10:47:25.485 +03:00 [DBG] 'BillingServiceDBContext' disposed.
2025-11-13 10:47:25.492 +03:00 [DBG] Disposing connection to database 'GAC-BillingService' on server '.'.
2025-11-13 10:47:25.496 +03:00 [DBG] Disposed connection to database '' on server '' (4ms).
2025-11-13 10:47:25.508 +03:00 [INF] Processed message: invoice Id: 0
