2025-12-10 10:28:34.346 +03:00 [DBG] Hosting starting
2025-12-10 10:28:40.317 +03:00 [DBG] Starting bus instances: IBus
2025-12-10 10:28:40.326 +03:00 [DBG] Starting bus: "rabbitmq://localhost/"
2025-12-10 10:28:40.367 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-12-10 10:28:40.380 +03:00 [INF] Hosting environment: Development
2025-12-10 10:28:40.382 +03:00 [INF] Content root path: C:\Repositories\Gac-BillingSystem\src\BillingSystem.PaymentOrchestrator
2025-12-10 10:28:40.385 +03:00 [DBG] Hosting started
2025-12-10 10:28:40.388 +03:00 [DBG] Connect: guest@localhost:5672/
2025-12-10 10:28:40.421 +03:00 [DBG] Connected: guest@localhost:5672/ (address: amqp://localhost:5672, local: 52872)
2025-12-10 10:28:40.424 +03:00 [INF] RabbitMQ Consumer started for queue InvoiceCreatedQueue
2025-12-10 10:28:40.458 +03:00 [DBG] Endpoint Ready: "rabbitmq://localhost/ECHGHANNAMLP1_BillingSystemP_bus_cb8yyyyh3bcsbn4ibdxdxxp4ns?temporary=true"
2025-12-10 10:28:40.462 +03:00 [INF] Bus started: "rabbitmq://localhost/"
2025-12-10 11:00:18.743 +03:00 [DBG] Disconnect: guest@localhost:5672/
2025-12-10 11:00:18.743 +03:00 [ERR] exception occured No service for type 'Consul.ConsulClient' has been registered. , stackTrace    at Microsoft.Extensions.DependencyInjection.ServiceProviderServiceExtensions.GetRequiredService(IServiceProvider provider, Type serviceType)
   at Microsoft.Extensions.DependencyInjection.ServiceProviderServiceExtensions.GetRequiredService[T](IServiceProvider provider)
   at BillingSystem.PaymentOrchestrator.PaymentProviders.Efaa.SendInvoice(Invoice invoice) in C:\Repositories\Gac-BillingSystem\src\BillingSystem.PaymentOrchestrator\PaymentProviders\Efaa.cs:line 42
2025-12-10 11:00:18.797 +03:00 [DBG] Disconnected: guest@localhost:5672/
2025-12-10 11:00:18.814 +03:00 [ERR] exception occured No service for type 'Consul.ConsulClient' has been registered. , stackTrace    at Microsoft.Extensions.DependencyInjection.ServiceProviderServiceExtensions.GetRequiredService(IServiceProvider provider, Type serviceType)
   at Microsoft.Extensions.DependencyInjection.ServiceProviderServiceExtensions.GetRequiredService[T](IServiceProvider provider)
   at BillingSystem.PaymentOrchestrator.PaymentProviders.Efaa.SendInvoice(Invoice invoice) in C:\Repositories\Gac-BillingSystem\src\BillingSystem.PaymentOrchestrator\PaymentProviders\Efaa.cs:line 42
   at BillingSystem.PaymentOrchestrator.PaymentProviders.PaymentAdapter.SendInvoice(Invoice invoice) in C:\Repositories\Gac-BillingSystem\src\BillingSystem.PaymentOrchestrator\PaymentProviders\PaymentAdapter.cs:line 52
   at BillingSystem.PaymentOrchestrator.MessageHandler.ProcessInvoiceMessage(Invoice invoice) in C:\Repositories\Gac-BillingSystem\src\BillingSystem.PaymentOrchestrator\MessageHandler.cs:line 28
2025-12-10 11:00:18.833 +03:00 [ERR] exception occured No service for type 'Consul.ConsulClient' has been registered. , stackTrace    at Microsoft.Extensions.DependencyInjection.ServiceProviderServiceExtensions.GetRequiredService(IServiceProvider provider, Type serviceType)
   at Microsoft.Extensions.DependencyInjection.ServiceProviderServiceExtensions.GetRequiredService[T](IServiceProvider provider)
   at BillingSystem.PaymentOrchestrator.PaymentProviders.Efaa.SendInvoice(Invoice invoice) in C:\Repositories\Gac-BillingSystem\src\BillingSystem.PaymentOrchestrator\PaymentProviders\Efaa.cs:line 42
   at BillingSystem.PaymentOrchestrator.PaymentProviders.PaymentAdapter.SendInvoice(Invoice invoice) in C:\Repositories\Gac-BillingSystem\src\BillingSystem.PaymentOrchestrator\PaymentProviders\PaymentAdapter.cs:line 52
   at BillingSystem.PaymentOrchestrator.MessageHandler.ProcessInvoiceMessage(Invoice invoice) in C:\Repositories\Gac-BillingSystem\src\BillingSystem.PaymentOrchestrator\MessageHandler.cs:line 28
   at BillingSystem.PaymentOrchestrator.PaymentOrchestratorWorker.<ExecuteAsync>b__7_0(Object sender, BasicDeliverEventArgs ea) in C:\Repositories\Gac-BillingSystem\src\BillingSystem.PaymentOrchestrator\PaymentOrchestratorWorker.cs:line 59
2025-12-10 11:00:18.836 +03:00 [ERR] Error processing message (Attempt 0)
System.InvalidOperationException: No service for type 'Consul.ConsulClient' has been registered.
   at Microsoft.Extensions.DependencyInjection.ServiceProviderServiceExtensions.GetRequiredService(IServiceProvider provider, Type serviceType)
   at Microsoft.Extensions.DependencyInjection.ServiceProviderServiceExtensions.GetRequiredService[T](IServiceProvider provider)
   at BillingSystem.PaymentOrchestrator.PaymentProviders.Efaa.SendInvoice(Invoice invoice) in C:\Repositories\Gac-BillingSystem\src\BillingSystem.PaymentOrchestrator\PaymentProviders\Efaa.cs:line 42
   at BillingSystem.PaymentOrchestrator.PaymentProviders.PaymentAdapter.SendInvoice(Invoice invoice) in C:\Repositories\Gac-BillingSystem\src\BillingSystem.PaymentOrchestrator\PaymentProviders\PaymentAdapter.cs:line 52
   at BillingSystem.PaymentOrchestrator.MessageHandler.ProcessInvoiceMessage(Invoice invoice) in C:\Repositories\Gac-BillingSystem\src\BillingSystem.PaymentOrchestrator\MessageHandler.cs:line 28
   at BillingSystem.PaymentOrchestrator.PaymentOrchestratorWorker.<ExecuteAsync>b__7_0(Object sender, BasicDeliverEventArgs ea) in C:\Repositories\Gac-BillingSystem\src\BillingSystem.PaymentOrchestrator\PaymentOrchestratorWorker.cs:line 59
2025-12-10 11:20:54.355 +03:00 [DBG] Hosting starting
2025-12-10 11:21:00.163 +03:00 [DBG] Starting bus instances: IBus
2025-12-10 11:21:00.179 +03:00 [DBG] Starting bus: "rabbitmq://localhost/"
2025-12-10 11:21:00.242 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-12-10 11:21:00.253 +03:00 [INF] Hosting environment: Development
2025-12-10 11:21:00.256 +03:00 [INF] Content root path: C:\Repositories\Gac-BillingSystem\src\BillingSystem.PaymentOrchestrator
2025-12-10 11:21:00.260 +03:00 [DBG] Hosting started
2025-12-10 11:21:00.269 +03:00 [DBG] Connect: guest@localhost:5672/
2025-12-10 11:21:00.293 +03:00 [DBG] Connected: guest@localhost:5672/ (address: amqp://localhost:5672, local: 62019)
2025-12-10 11:21:00.325 +03:00 [INF] RabbitMQ Consumer started for queue InvoiceCreatedQueue
2025-12-10 11:21:00.409 +03:00 [DBG] Endpoint Ready: "rabbitmq://localhost/ECHGHANNAMLP1_BillingSystemP_bus_py8oyyyh3bcsbhpobdxdxtej8b?temporary=true"
2025-12-10 11:21:00.413 +03:00 [INF] Bus started: "rabbitmq://localhost/"
2025-12-10 11:28:49.834 +03:00 [DBG] Hosting starting
2025-12-10 11:28:55.474 +03:00 [DBG] Starting bus instances: IBus
2025-12-10 11:28:55.485 +03:00 [DBG] Starting bus: "rabbitmq://localhost/"
2025-12-10 11:28:55.544 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-12-10 11:28:55.547 +03:00 [INF] Hosting environment: Development
2025-12-10 11:28:55.551 +03:00 [INF] Content root path: C:\Repositories\Gac-BillingSystem\src\BillingSystem.PaymentOrchestrator
2025-12-10 11:28:55.564 +03:00 [DBG] Hosting started
2025-12-10 11:28:55.567 +03:00 [DBG] Connect: guest@localhost:5672/
2025-12-10 11:28:55.594 +03:00 [DBG] Connected: guest@localhost:5672/ (address: amqp://localhost:5672, local: 55720)
2025-12-10 11:28:55.613 +03:00 [INF] RabbitMQ Consumer started for queue InvoiceCreatedQueue
2025-12-10 11:28:55.672 +03:00 [DBG] Endpoint Ready: "rabbitmq://localhost/ECHGHANNAMLP1_BillingSystemP_bus_mn5yyyyh3bcsbmi9bdxdxttfba?temporary=true"
2025-12-10 11:28:55.675 +03:00 [INF] Bus started: "rabbitmq://localhost/"
2025-12-10 11:29:17.705 +03:00 [ERR] exception occured Object reference not set to an instance of an object. , stackTrace    at BillingSystem.PaymentOrchestrator.PaymentProviders.IntegrationMappers.InvoiceToNPVFine.Map(Invoice invoice) in C:\Repositories\Gac-BillingSystem\src\BillingSystem.PaymentOrchestrator\PaymentProviders\IntegrationMappers\InvoiceToNPVFine.cs:line 39
   at BillingSystem.PaymentOrchestrator.PaymentProviders.Efaa.SendInvoice(Invoice invoice) in C:\Repositories\Gac-BillingSystem\src\BillingSystem.PaymentOrchestrator\PaymentProviders\Efaa.cs:line 41
2025-12-10 11:29:19.070 +03:00 [ERR] exception occured Object reference not set to an instance of an object. , stackTrace    at BillingSystem.PaymentOrchestrator.PaymentProviders.IntegrationMappers.InvoiceToNPVFine.Map(Invoice invoice) in C:\Repositories\Gac-BillingSystem\src\BillingSystem.PaymentOrchestrator\PaymentProviders\IntegrationMappers\InvoiceToNPVFine.cs:line 39
   at BillingSystem.PaymentOrchestrator.PaymentProviders.Efaa.SendInvoice(Invoice invoice) in C:\Repositories\Gac-BillingSystem\src\BillingSystem.PaymentOrchestrator\PaymentProviders\Efaa.cs:line 41
   at BillingSystem.PaymentOrchestrator.PaymentProviders.PaymentAdapter.SendInvoice(Invoice invoice) in C:\Repositories\Gac-BillingSystem\src\BillingSystem.PaymentOrchestrator\PaymentProviders\PaymentAdapter.cs:line 52
   at BillingSystem.PaymentOrchestrator.MessageHandler.ProcessInvoiceMessage(Invoice invoice) in C:\Repositories\Gac-BillingSystem\src\BillingSystem.PaymentOrchestrator\MessageHandler.cs:line 28
2025-12-10 11:29:20.371 +03:00 [ERR] exception occured Object reference not set to an instance of an object. , stackTrace    at BillingSystem.PaymentOrchestrator.PaymentProviders.IntegrationMappers.InvoiceToNPVFine.Map(Invoice invoice) in C:\Repositories\Gac-BillingSystem\src\BillingSystem.PaymentOrchestrator\PaymentProviders\IntegrationMappers\InvoiceToNPVFine.cs:line 39
   at BillingSystem.PaymentOrchestrator.PaymentProviders.Efaa.SendInvoice(Invoice invoice) in C:\Repositories\Gac-BillingSystem\src\BillingSystem.PaymentOrchestrator\PaymentProviders\Efaa.cs:line 41
   at BillingSystem.PaymentOrchestrator.PaymentProviders.PaymentAdapter.SendInvoice(Invoice invoice) in C:\Repositories\Gac-BillingSystem\src\BillingSystem.PaymentOrchestrator\PaymentProviders\PaymentAdapter.cs:line 52
   at BillingSystem.PaymentOrchestrator.MessageHandler.ProcessInvoiceMessage(Invoice invoice) in C:\Repositories\Gac-BillingSystem\src\BillingSystem.PaymentOrchestrator\MessageHandler.cs:line 28
   at BillingSystem.PaymentOrchestrator.PaymentOrchestratorWorker.<ExecuteAsync>b__7_0(Object sender, BasicDeliverEventArgs ea) in C:\Repositories\Gac-BillingSystem\src\BillingSystem.PaymentOrchestrator\PaymentOrchestratorWorker.cs:line 59
2025-12-10 11:29:20.375 +03:00 [ERR] Error processing message (Attempt 0)
System.NullReferenceException: Object reference not set to an instance of an object.
   at BillingSystem.PaymentOrchestrator.PaymentProviders.IntegrationMappers.InvoiceToNPVFine.Map(Invoice invoice) in C:\Repositories\Gac-BillingSystem\src\BillingSystem.PaymentOrchestrator\PaymentProviders\IntegrationMappers\InvoiceToNPVFine.cs:line 39
   at BillingSystem.PaymentOrchestrator.PaymentProviders.Efaa.SendInvoice(Invoice invoice) in C:\Repositories\Gac-BillingSystem\src\BillingSystem.PaymentOrchestrator\PaymentProviders\Efaa.cs:line 41
   at BillingSystem.PaymentOrchestrator.PaymentProviders.PaymentAdapter.SendInvoice(Invoice invoice) in C:\Repositories\Gac-BillingSystem\src\BillingSystem.PaymentOrchestrator\PaymentProviders\PaymentAdapter.cs:line 52
   at BillingSystem.PaymentOrchestrator.MessageHandler.ProcessInvoiceMessage(Invoice invoice) in C:\Repositories\Gac-BillingSystem\src\BillingSystem.PaymentOrchestrator\MessageHandler.cs:line 28
   at BillingSystem.PaymentOrchestrator.PaymentOrchestratorWorker.<ExecuteAsync>b__7_0(Object sender, BasicDeliverEventArgs ea) in C:\Repositories\Gac-BillingSystem\src\BillingSystem.PaymentOrchestrator\PaymentOrchestratorWorker.cs:line 59
2025-12-10 11:29:20.396 +03:00 [WRN] Message requeued for retry (Attempt 1)
2025-12-10 11:29:33.710 +03:00 [ERR] exception occured Object reference not set to an instance of an object. , stackTrace    at BillingSystem.PaymentOrchestrator.PaymentProviders.IntegrationMappers.InvoiceToNPVFine.Map(Invoice invoice) in C:\Repositories\Gac-BillingSystem\src\BillingSystem.PaymentOrchestrator\PaymentProviders\IntegrationMappers\InvoiceToNPVFine.cs:line 39
   at BillingSystem.PaymentOrchestrator.PaymentProviders.Efaa.SendInvoice(Invoice invoice) in C:\Repositories\Gac-BillingSystem\src\BillingSystem.PaymentOrchestrator\PaymentProviders\Efaa.cs:line 41
2025-12-10 11:29:35.593 +03:00 [ERR] exception occured Object reference not set to an instance of an object. , stackTrace    at BillingSystem.PaymentOrchestrator.PaymentProviders.IntegrationMappers.InvoiceToNPVFine.Map(Invoice invoice) in C:\Repositories\Gac-BillingSystem\src\BillingSystem.PaymentOrchestrator\PaymentProviders\IntegrationMappers\InvoiceToNPVFine.cs:line 39
   at BillingSystem.PaymentOrchestrator.PaymentProviders.Efaa.SendInvoice(Invoice invoice) in C:\Repositories\Gac-BillingSystem\src\BillingSystem.PaymentOrchestrator\PaymentProviders\Efaa.cs:line 41
   at BillingSystem.PaymentOrchestrator.PaymentProviders.PaymentAdapter.SendInvoice(Invoice invoice) in C:\Repositories\Gac-BillingSystem\src\BillingSystem.PaymentOrchestrator\PaymentProviders\PaymentAdapter.cs:line 52
   at BillingSystem.PaymentOrchestrator.MessageHandler.ProcessInvoiceMessage(Invoice invoice) in C:\Repositories\Gac-BillingSystem\src\BillingSystem.PaymentOrchestrator\MessageHandler.cs:line 28
2025-12-10 11:29:36.558 +03:00 [ERR] exception occured Object reference not set to an instance of an object. , stackTrace    at BillingSystem.PaymentOrchestrator.PaymentProviders.IntegrationMappers.InvoiceToNPVFine.Map(Invoice invoice) in C:\Repositories\Gac-BillingSystem\src\BillingSystem.PaymentOrchestrator\PaymentProviders\IntegrationMappers\InvoiceToNPVFine.cs:line 39
   at BillingSystem.PaymentOrchestrator.PaymentProviders.Efaa.SendInvoice(Invoice invoice) in C:\Repositories\Gac-BillingSystem\src\BillingSystem.PaymentOrchestrator\PaymentProviders\Efaa.cs:line 41
   at BillingSystem.PaymentOrchestrator.PaymentProviders.PaymentAdapter.SendInvoice(Invoice invoice) in C:\Repositories\Gac-BillingSystem\src\BillingSystem.PaymentOrchestrator\PaymentProviders\PaymentAdapter.cs:line 52
   at BillingSystem.PaymentOrchestrator.MessageHandler.ProcessInvoiceMessage(Invoice invoice) in C:\Repositories\Gac-BillingSystem\src\BillingSystem.PaymentOrchestrator\MessageHandler.cs:line 28
   at BillingSystem.PaymentOrchestrator.PaymentOrchestratorWorker.<ExecuteAsync>b__7_0(Object sender, BasicDeliverEventArgs ea) in C:\Repositories\Gac-BillingSystem\src\BillingSystem.PaymentOrchestrator\PaymentOrchestratorWorker.cs:line 59
2025-12-10 11:29:36.563 +03:00 [ERR] Error processing message (Attempt 1)
System.NullReferenceException: Object reference not set to an instance of an object.
   at BillingSystem.PaymentOrchestrator.PaymentProviders.IntegrationMappers.InvoiceToNPVFine.Map(Invoice invoice) in C:\Repositories\Gac-BillingSystem\src\BillingSystem.PaymentOrchestrator\PaymentProviders\IntegrationMappers\InvoiceToNPVFine.cs:line 39
   at BillingSystem.PaymentOrchestrator.PaymentProviders.Efaa.SendInvoice(Invoice invoice) in C:\Repositories\Gac-BillingSystem\src\BillingSystem.PaymentOrchestrator\PaymentProviders\Efaa.cs:line 41
   at BillingSystem.PaymentOrchestrator.PaymentProviders.PaymentAdapter.SendInvoice(Invoice invoice) in C:\Repositories\Gac-BillingSystem\src\BillingSystem.PaymentOrchestrator\PaymentProviders\PaymentAdapter.cs:line 52
   at BillingSystem.PaymentOrchestrator.MessageHandler.ProcessInvoiceMessage(Invoice invoice) in C:\Repositories\Gac-BillingSystem\src\BillingSystem.PaymentOrchestrator\MessageHandler.cs:line 28
   at BillingSystem.PaymentOrchestrator.PaymentOrchestratorWorker.<ExecuteAsync>b__7_0(Object sender, BasicDeliverEventArgs ea) in C:\Repositories\Gac-BillingSystem\src\BillingSystem.PaymentOrchestrator\PaymentOrchestratorWorker.cs:line 59
2025-12-10 11:29:36.570 +03:00 [WRN] Message moved to DLQ after 2 failures
2025-12-10 12:04:43.301 +03:00 [DBG] Hosting starting
2025-12-10 12:04:48.881 +03:00 [DBG] Starting bus instances: IBus
2025-12-10 12:04:48.891 +03:00 [DBG] Starting bus: "rabbitmq://localhost/"
2025-12-10 12:04:48.931 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-12-10 12:04:48.936 +03:00 [INF] Hosting environment: Development
2025-12-10 12:04:48.939 +03:00 [INF] Content root path: C:\Repositories\Gac-BillingSystem\src\BillingSystem.PaymentOrchestrator
2025-12-10 12:04:48.939 +03:00 [DBG] Connect: guest@localhost:5672/
2025-12-10 12:04:48.942 +03:00 [DBG] Hosting started
2025-12-10 12:04:48.966 +03:00 [DBG] Connected: guest@localhost:5672/ (address: amqp://localhost:5672, local: 56064)
2025-12-10 12:04:48.977 +03:00 [INF] RabbitMQ Consumer started for queue InvoiceCreatedQueue
2025-12-10 12:04:49.024 +03:00 [DBG] Endpoint Ready: "rabbitmq://localhost/ECHGHANNAMLP1_BillingSystemP_bus_ibxoyyyh3bcsbo8mbdxdx13egk?temporary=true"
2025-12-10 12:04:49.028 +03:00 [INF] Bus started: "rabbitmq://localhost/"
2025-12-10 12:25:23.369 +03:00 [DBG] Hosting starting
2025-12-10 12:25:29.124 +03:00 [DBG] Starting bus instances: IBus
2025-12-10 12:25:29.135 +03:00 [DBG] Starting bus: "rabbitmq://localhost/"
2025-12-10 12:25:29.184 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-12-10 12:25:29.187 +03:00 [INF] Hosting environment: Development
2025-12-10 12:25:29.190 +03:00 [INF] Content root path: C:\Repositories\Gac-BillingSystem\src\BillingSystem.PaymentOrchestrator
2025-12-10 12:25:29.192 +03:00 [DBG] Connect: guest@localhost:5672/
2025-12-10 12:25:29.193 +03:00 [DBG] Hosting started
2025-12-10 12:25:29.220 +03:00 [DBG] Connected: guest@localhost:5672/ (address: amqp://localhost:5672, local: 63097)
2025-12-10 12:25:29.230 +03:00 [INF] RabbitMQ Consumer started for queue InvoiceCreatedQueue
2025-12-10 12:25:29.295 +03:00 [DBG] Endpoint Ready: "rabbitmq://localhost/ECHGHANNAMLP1_BillingSystemP_bus_3tcyyyyh3bcsy5qsbdxdxuom8h?temporary=true"
2025-12-10 12:25:29.298 +03:00 [INF] Bus started: "rabbitmq://localhost/"
2025-12-10 12:27:34.977 +03:00 [DBG] An 'IServiceProvider' was created for internal use by Entity Framework.
2025-12-10 12:27:38.503 +03:00 [DBG] No relationship from 'Invoice' to 'Invoice' has been configured by convention because there are multiple properties on one entity type - {'DiscountedPrimaryInvoice'} that could be matched with the properties on the other entity type - {'InverseDiscountedPrimaryInvoice', 'InversePrimaryInvoice', 'InverseSubstitutionPrimaryInvoice', 'PrimaryInvoice', 'SubstitutionPrimaryInvoice'}. This message can be disregarded if explicit configuration has been specified in 'OnModelCreating'.
2025-12-10 12:27:38.811 +03:00 [DBG] No relationship from 'Invoice' to 'Invoice' has been configured by convention because there are multiple properties on one entity type - {'DiscountedPrimaryInvoice'} that could be matched with the properties on the other entity type - {'InverseDiscountedPrimaryInvoice', 'InversePrimaryInvoice', 'InverseSubstitutionPrimaryInvoice', 'PrimaryInvoice', 'SubstitutionPrimaryInvoice'}. This message can be disregarded if explicit configuration has been specified in 'OnModelCreating'.
2025-12-10 12:27:38.824 +03:00 [DBG] No relationship from 'Invoice' to 'Invoice' has been configured by convention because there are multiple properties on one entity type - {'InversePrimaryInvoice'} that could be matched with the properties on the other entity type - {'InverseSubstitutionPrimaryInvoice', 'PrimaryInvoice', 'SubstitutionPrimaryInvoice'}. This message can be disregarded if explicit configuration has been specified in 'OnModelCreating'.
2025-12-10 12:27:38.830 +03:00 [DBG] No relationship from 'Invoice' to 'Invoice' has been configured by convention because there are multiple properties on one entity type - {'InversePrimaryInvoice'} that could be matched with the properties on the other entity type - {'InverseSubstitutionPrimaryInvoice', 'PrimaryInvoice', 'SubstitutionPrimaryInvoice'}. This message can be disregarded if explicit configuration has been specified in 'OnModelCreating'.
2025-12-10 12:27:39.152 +03:00 [DBG] Entity Framework Core 9.0.9 initialized 'BillingServiceDBContext' using provider 'Microsoft.EntityFrameworkCore.SqlServer:9.0.9' with options: EngineType=SqlServer 
2025-12-10 12:27:39.256 +03:00 [DBG] Compiling query expression: 
'DbSet<Invoice>()
    .SingleOrDefault(p => p.Id == __entity_Id_0)'
2025-12-10 12:27:39.719 +03:00 [DBG] Generated query execution expression: 
'queryContext => SingleQueryingEnumerable.Create<Invoice>(
    relationalQueryContext: (RelationalQueryContext)queryContext, 
    relationalCommandResolver: parameters => [LIFTABLE Constant: RelationalCommandCache.QueryExpression(
        Projection Mapping:
            EmptyProjectionMember -> Dictionary<IProperty, int> { [Property: Invoice.Id (long) Required PK AfterSave:Throw ValueGenerated.OnAdd, 0], [Property: Invoice.Amount (decimal) Required, 1], [Property: Invoice.CancelationReasons (string) MaxLength(3000), 2], [Property: Invoice.ClientReferenceNumber (string) MaxLength(100), 3], [Property: Invoice.CreatedBy (string) Required MaxLength(50), 4], [Property: Invoice.CreatedDate (DateTime) Required, 5], [Property: Invoice.Currency (string) Required MaxLength(50), 6], [Property: Invoice.CustomerId (long) Required FK Index, 7], [Property: Invoice.DiscountedPrimaryInvoiceId (long?) FK Index, 8], [Property: Invoice.DueAt (DateTime?), 9], [Property: Invoice.ExternalId (Guid) Required Index, 10], [Property: Invoice.InvoiceNumber (string) Required MaxLength(50), 11], [Property: Invoice.InvoiceStatus (int) Required, 12], [Property: Invoice.InvoiceType (int) Required, 13], [Property: Invoice.IsDeleted (bool) Required, 14], [Property: Invoice.IsDiscounted (bool?), 15], [Property: Invoice.IsSubInvoice (bool?), 16], [Property: Invoice.IsSubstitution (bool?), 17], [Property: Invoice.IssuedAt (DateTime) Required, 18], [Property: Invoice.LastUpdatedDate (DateTime?), 19], [Property: Invoice.Metadata (string), 20], [Property: Invoice.PaymentProvider (string) MaxLength(100), 21], [Property: Invoice.PaymentReference (string) MaxLength(100), 22], [Property: Invoice.PrimaryInvoiceId (long?) FK Index, 23], [Property: Invoice.ProviderResponse (string), 24], [Property: Invoice.SubstitutionPrimaryInvoiceId (long?) FK Index, 25], [Property: Invoice.TenantId (int) Required FK Index, 26] }
        SELECT TOP(2) i.Id, i.Amount, i.CancelationReasons, i.ClientReferenceNumber, i.CreatedBy, i.CreatedDate, i.Currency, i.CustomerID, i.DiscountedPrimaryInvoiceID, i.DueAt, i.ExternalId, i.InvoiceNumber, i.InvoiceStatus, i.InvoiceType, i.IsDeleted, i.IsDiscounted, i.IsSubInvoice, i.IsSubstitution, i.IssuedAt, i.LastUpdatedDate, i.Metadata, i.PaymentProvider, i.PaymentReference, i.PrimaryInvoiceID, i.ProviderResponse, i.SubstitutionPrimaryInvoiceID, i.TenantId
        FROM Invoices AS i
        WHERE i.Id == @__entity_Id_0) | Resolver: c => new RelationalCommandCache(
        c.Dependencies.MemoryCache, 
        c.RelationalDependencies.QuerySqlGeneratorFactory, 
        c.RelationalDependencies.RelationalParameterBasedSqlProcessorFactory, 
        Projection Mapping:
            EmptyProjectionMember -> Dictionary<IProperty, int> { [Property: Invoice.Id (long) Required PK AfterSave:Throw ValueGenerated.OnAdd, 0], [Property: Invoice.Amount (decimal) Required, 1], [Property: Invoice.CancelationReasons (string) MaxLength(3000), 2], [Property: Invoice.ClientReferenceNumber (string) MaxLength(100), 3], [Property: Invoice.CreatedBy (string) Required MaxLength(50), 4], [Property: Invoice.CreatedDate (DateTime) Required, 5], [Property: Invoice.Currency (string) Required MaxLength(50), 6], [Property: Invoice.CustomerId (long) Required FK Index, 7], [Property: Invoice.DiscountedPrimaryInvoiceId (long?) FK Index, 8], [Property: Invoice.DueAt (DateTime?), 9], [Property: Invoice.ExternalId (Guid) Required Index, 10], [Property: Invoice.InvoiceNumber (string) Required MaxLength(50), 11], [Property: Invoice.InvoiceStatus (int) Required, 12], [Property: Invoice.InvoiceType (int) Required, 13], [Property: Invoice.IsDeleted (bool) Required, 14], [Property: Invoice.IsDiscounted (bool?), 15], [Property: Invoice.IsSubInvoice (bool?), 16], [Property: Invoice.IsSubstitution (bool?), 17], [Property: Invoice.IssuedAt (DateTime) Required, 18], [Property: Invoice.LastUpdatedDate (DateTime?), 19], [Property: Invoice.Metadata (string), 20], [Property: Invoice.PaymentProvider (string) MaxLength(100), 21], [Property: Invoice.PaymentReference (string) MaxLength(100), 22], [Property: Invoice.PrimaryInvoiceId (long?) FK Index, 23], [Property: Invoice.ProviderResponse (string), 24], [Property: Invoice.SubstitutionPrimaryInvoiceId (long?) FK Index, 25], [Property: Invoice.TenantId (int) Required FK Index, 26] }
        SELECT TOP(2) i.Id, i.Amount, i.CancelationReasons, i.ClientReferenceNumber, i.CreatedBy, i.CreatedDate, i.Currency, i.CustomerID, i.DiscountedPrimaryInvoiceID, i.DueAt, i.ExternalId, i.InvoiceNumber, i.InvoiceStatus, i.InvoiceType, i.IsDeleted, i.IsDiscounted, i.IsSubInvoice, i.IsSubstitution, i.IssuedAt, i.LastUpdatedDate, i.Metadata, i.PaymentProvider, i.PaymentReference, i.PrimaryInvoiceID, i.ProviderResponse, i.SubstitutionPrimaryInvoiceID, i.TenantId
        FROM Invoices AS i
        WHERE i.Id == @__entity_Id_0, 
        False, 
        new HashSet<string>(
            new string[]{ }, 
            StringComparer.Ordinal
        )
    )].GetRelationalCommandTemplate(parameters), 
    readerColumns: null, 
    shaper: (queryContext, dataReader, resultContext, resultCoordinator) => 
    {
        Invoice entity;
        entity = 
        {
            MaterializationContext materializationContext1;
            IEntityType entityType1;
            Invoice instance1;
            InternalEntityEntry entry1;
            bool hasNullKey1;
            materializationContext1 = new MaterializationContext(
                [LIFTABLE Constant: ValueBuffer | Resolver: _ => (object)ValueBuffer.Empty], 
                queryContext.Context
            );
            instance1 = default(Invoice);
            entry1 = queryContext.TryGetEntry(
                key: [LIFTABLE Constant: Key: Invoice.Id PK | Resolver: c => c.Dependencies.Model.FindEntityType("BillingSystem.Domain.Entities.Invoice").FindPrimaryKey()], 
                keyValues: new object[]{ (object)dataReader.GetInt64(0) }, 
                throwOnNullKey: True, 
                hasNullKey: hasNullKey1);
            !(hasNullKey1) ? entry1 != default(InternalEntityEntry) ? 
            {
                entityType1 = entry1.EntityType;
                return instance1 = (Invoice)entry1.Entity;
            } : 
            {
                ISnapshot shadowSnapshot1;
                shadowSnapshot1 = [LIFTABLE Constant: Snapshot | Resolver: _ => Snapshot.Empty];
                entityType1 = [LIFTABLE Constant: EntityType: Invoice | Resolver: namelessParameter{0} => namelessParameter{0}.Dependencies.Model.FindEntityType("BillingSystem.Domain.Entities.Invoice")];
                instance1 = switch (entityType1)
                {
                    case [LIFTABLE Constant: EntityType: Invoice | Resolver: namelessParameter{1} => namelessParameter{1}.Dependencies.Model.FindEntityType("BillingSystem.Domain.Entities.Invoice")]: 
                        {
                            return 
                            {
                                Invoice instance;
                                instance = new Invoice();
                                instance.<Id>k__BackingField = dataReader.GetInt64(0);
                                instance.<Amount>k__BackingField = dataReader.GetDecimal(1);
                                instance.<CancelationReasons>k__BackingField = dataReader.IsDBNull(2) ? default(string) : dataReader.GetString(2);
                                instance.<ClientReferenceNumber>k__BackingField = dataReader.IsDBNull(3) ? default(string) : dataReader.GetString(3);
                                instance.<CreatedBy>k__BackingField = dataReader.GetString(4);
                                instance.<CreatedDate>k__BackingField = dataReader.GetDateTime(5);
                                instance.<Currency>k__BackingField = dataReader.GetString(6);
                                instance.<CustomerId>k__BackingField = dataReader.GetInt64(7);
                                instance.<DiscountedPrimaryInvoiceId>k__BackingField = dataReader.IsDBNull(8) ? default(long?) : (long?)dataReader.GetInt64(8);
                                instance.<DueAt>k__BackingField = dataReader.IsDBNull(9) ? default(DateTime?) : (DateTime?)dataReader.GetDateTime(9);
                                instance.<ExternalId>k__BackingField = dataReader.GetGuid(10);
                                instance.<InvoiceNumber>k__BackingField = dataReader.GetString(11);
                                instance.<InvoiceStatus>k__BackingField = dataReader.GetInt32(12);
                                instance.<InvoiceType>k__BackingField = dataReader.GetInt32(13);
                                instance.<IsDeleted>k__BackingField = dataReader.GetBoolean(14);
                                instance.<IsDiscounted>k__BackingField = dataReader.IsDBNull(15) ? default(bool?) : (bool?)dataReader.GetBoolean(15);
                                instance.<IsSubInvoice>k__BackingField = dataReader.IsDBNull(16) ? default(bool?) : (bool?)dataReader.GetBoolean(16);
                                instance.<IsSubstitution>k__BackingField = dataReader.IsDBNull(17) ? default(bool?) : (bool?)dataReader.GetBoolean(17);
                                instance.<IssuedAt>k__BackingField = dataReader.GetDateTime(18);
                                instance.<LastUpdatedDate>k__BackingField = dataReader.IsDBNull(19) ? default(DateTime?) : (DateTime?)dataReader.GetDateTime(19);
                                instance.<Metadata>k__BackingField = dataReader.IsDBNull(20) ? default(string) : dataReader.GetString(20);
                                instance.<PaymentProvider>k__BackingField = dataReader.IsDBNull(21) ? default(string) : dataReader.GetString(21);
                                instance.<PaymentReference>k__BackingField = dataReader.IsDBNull(22) ? default(string) : dataReader.GetString(22);
                                instance.<PrimaryInvoiceId>k__BackingField = dataReader.IsDBNull(23) ? default(long?) : (long?)dataReader.GetInt64(23);
                                instance.<ProviderResponse>k__BackingField = dataReader.IsDBNull(24) ? default(string) : dataReader.GetString(24);
                                instance.<SubstitutionPrimaryInvoiceId>k__BackingField = dataReader.IsDBNull(25) ? default(long?) : (long?)dataReader.GetInt64(25);
                                instance.<TenantId>k__BackingField = dataReader.GetInt32(26);
                                (instance is IInjectableService) ? ((IInjectableService)instance).Injected(
                                    context: materializationContext1.Context, 
                                    entity: instance, 
                                    queryTrackingBehavior: TrackAll, 
                                    structuralType: [LIFTABLE Constant: EntityType: Invoice | Resolver: namelessParameter{2} => namelessParameter{2}.Dependencies.Model.FindEntityType("BillingSystem.Domain.Entities.Invoice")]) : default(void);
                                return instance;
                            }}
                    default: 
                        default(Invoice)
                }
                ;
                entry1 = entityType1 == default(IEntityType) ? default(InternalEntityEntry) : queryContext.StartTracking(
                    entityType: entityType1, 
                    entity: instance1, 
                    snapshot: shadowSnapshot1);
                return instance1;
            } : default(void);
            return instance1;
        };
        return entity;
    }, 
    contextType: BillingSystem.Infrastructure.EF.BillingServiceDBContext, 
    standAloneStateManager: False, 
    detailedErrorsEnabled: False, 
    threadSafetyChecksEnabled: True)
    .SingleOrDefault()'
2025-12-10 12:27:39.764 +03:00 [DBG] Creating DbConnection.
2025-12-10 12:27:39.792 +03:00 [DBG] Created DbConnection. (25ms).
2025-12-10 12:27:39.799 +03:00 [DBG] Opening connection to database 'GAC-BillingService' on server '.'.
2025-12-10 12:27:40.114 +03:00 [DBG] Opened connection to database 'GAC-BillingService' on server '.'.
2025-12-10 12:27:40.123 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-12-10 12:27:40.136 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (7ms).
2025-12-10 12:27:40.150 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (28ms).
2025-12-10 12:27:40.165 +03:00 [DBG] Executing DbCommand [Parameters=[@__entity_Id_0='?' (DbType = Int64)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(2) [i].[Id], [i].[Amount], [i].[CancelationReasons], [i].[ClientReferenceNumber], [i].[CreatedBy], [i].[CreatedDate], [i].[Currency], [i].[CustomerID], [i].[DiscountedPrimaryInvoiceID], [i].[DueAt], [i].[ExternalId], [i].[InvoiceNumber], [i].[InvoiceStatus], [i].[InvoiceType], [i].[IsDeleted], [i].[IsDiscounted], [i].[IsSubInvoice], [i].[IsSubstitution], [i].[IssuedAt], [i].[LastUpdatedDate], [i].[Metadata], [i].[PaymentProvider], [i].[PaymentReference], [i].[PrimaryInvoiceID], [i].[ProviderResponse], [i].[SubstitutionPrimaryInvoiceID], [i].[TenantId]
FROM [Invoices] AS [i]
WHERE [i].[Id] = @__entity_Id_0
2025-12-10 12:27:40.232 +03:00 [INF] Executed DbCommand (66ms) [Parameters=[@__entity_Id_0='?' (DbType = Int64)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(2) [i].[Id], [i].[Amount], [i].[CancelationReasons], [i].[ClientReferenceNumber], [i].[CreatedBy], [i].[CreatedDate], [i].[Currency], [i].[CustomerID], [i].[DiscountedPrimaryInvoiceID], [i].[DueAt], [i].[ExternalId], [i].[InvoiceNumber], [i].[InvoiceStatus], [i].[InvoiceType], [i].[IsDeleted], [i].[IsDiscounted], [i].[IsSubInvoice], [i].[IsSubstitution], [i].[IssuedAt], [i].[LastUpdatedDate], [i].[Metadata], [i].[PaymentProvider], [i].[PaymentReference], [i].[PrimaryInvoiceID], [i].[ProviderResponse], [i].[SubstitutionPrimaryInvoiceID], [i].[TenantId]
FROM [Invoices] AS [i]
WHERE [i].[Id] = @__entity_Id_0
2025-12-10 12:27:40.314 +03:00 [DBG] Context 'BillingServiceDBContext' started tracking 'Invoice' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-12-10 12:27:40.419 +03:00 [DBG] Closing data reader to 'GAC-BillingService' on server '.'.
2025-12-10 12:27:40.442 +03:00 [DBG] A data reader for 'GAC-BillingService' on server '.' is being disposed after spending 194ms reading results.
2025-12-10 12:27:40.451 +03:00 [DBG] Closing connection to database 'GAC-BillingService' on server '.'.
2025-12-10 12:27:40.470 +03:00 [DBG] Closed connection to database 'GAC-BillingService' on server '.' (17ms).
2025-12-10 12:27:40.566 +03:00 [DBG] An entity of type 'Invoice' tracked by 'BillingServiceDBContext' changed state from '"Unchanged"' to '"Modified"'. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-12-10 12:27:40.581 +03:00 [DBG] SaveChanges starting for 'BillingServiceDBContext'.
2025-12-10 12:27:40.587 +03:00 [DBG] DetectChanges starting for 'BillingServiceDBContext'.
2025-12-10 12:27:40.594 +03:00 [DBG] DetectChanges completed for 'BillingServiceDBContext'.
2025-12-10 12:27:40.709 +03:00 [DBG] Opening connection to database 'GAC-BillingService' on server '.'.
2025-12-10 12:27:40.719 +03:00 [DBG] Opened connection to database 'GAC-BillingService' on server '.'.
2025-12-10 12:27:40.727 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-12-10 12:27:40.729 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (2ms).
2025-12-10 12:27:40.737 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (9ms).
2025-12-10 12:27:40.741 +03:00 [DBG] Executing DbCommand [Parameters=[@p7='?' (DbType = Int64), @p0='?' (DbType = DateTime), @p1='?' (DbType = DateTime), @p2='?' (DbType = Int32), @p3='?' (DbType = DateTime), @p4='?' (DbType = DateTime), @p5='?' (Size = 100), @p6='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
UPDATE [Invoices] SET [CreatedDate] = @p0, [DueAt] = @p1, [InvoiceStatus] = @p2, [IssuedAt] = @p3, [LastUpdatedDate] = @p4, [PaymentProvider] = @p5, [ProviderResponse] = @p6
OUTPUT 1
WHERE [Id] = @p7;
2025-12-10 12:27:40.796 +03:00 [INF] Executed DbCommand (56ms) [Parameters=[@p7='?' (DbType = Int64), @p0='?' (DbType = DateTime), @p1='?' (DbType = DateTime), @p2='?' (DbType = Int32), @p3='?' (DbType = DateTime), @p4='?' (DbType = DateTime), @p5='?' (Size = 100), @p6='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
UPDATE [Invoices] SET [CreatedDate] = @p0, [DueAt] = @p1, [InvoiceStatus] = @p2, [IssuedAt] = @p3, [LastUpdatedDate] = @p4, [PaymentProvider] = @p5, [ProviderResponse] = @p6
OUTPUT 1
WHERE [Id] = @p7;
2025-12-10 12:27:40.813 +03:00 [DBG] Closing data reader to 'GAC-BillingService' on server '.'.
2025-12-10 12:27:40.818 +03:00 [DBG] A data reader for 'GAC-BillingService' on server '.' is being disposed after spending 16ms reading results.
2025-12-10 12:27:40.829 +03:00 [DBG] Closing connection to database 'GAC-BillingService' on server '.'.
2025-12-10 12:27:40.835 +03:00 [DBG] Closed connection to database 'GAC-BillingService' on server '.' (5ms).
2025-12-10 12:27:40.848 +03:00 [DBG] An entity of type 'Invoice' tracked by 'BillingServiceDBContext' changed state from '"Modified"' to '"Unchanged"'. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-12-10 12:27:40.855 +03:00 [DBG] SaveChanges completed for 'BillingServiceDBContext' with 1 entities written to the database.
2025-12-10 12:27:40.912 +03:00 [DBG] 'BillingServiceDBContext' disposed.
2025-12-10 12:27:40.917 +03:00 [DBG] Disposing connection to database 'GAC-BillingService' on server '.'.
2025-12-10 12:27:40.921 +03:00 [DBG] Disposed connection to database '' on server '' (4ms).
2025-12-10 12:27:47.383 +03:00 [INF] Processed message: invoice Id: 20009
