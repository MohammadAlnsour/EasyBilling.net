2025-12-03 16:57:34.615 +03:00 [DBG] Registered model binder providers, in the following order: ["Microsoft.AspNetCore.Mvc.ModelBinding.Binders.BinderTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ServicesModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.BodyModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.HeaderModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FloatingPointTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.EnumTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.DateTimeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.SimpleTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.TryParseModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.CancellationTokenModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ByteArrayModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FormFileModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FormCollectionModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.KeyValuePairModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.DictionaryModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ArrayModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.CollectionModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ComplexObjectModelBinderProvider"]
2025-12-03 16:57:34.878 +03:00 [DBG] Hosting starting
2025-12-03 16:57:35.265 +03:00 [DBG] Starting bus instances: IBus
2025-12-03 16:57:35.272 +03:00 [DBG] Starting bus: "rabbitmq://localhost/"
2025-12-03 16:57:35.303 +03:00 [DBG] Middleware loaded
2025-12-03 16:57:35.308 +03:00 [DBG] Middleware loaded. Script /_framework/aspnetcore-browser-refresh.js (16519 B).
2025-12-03 16:57:35.315 +03:00 [DBG] Middleware loaded. Script /_framework/blazor-hotreload.js (799 B).
2025-12-03 16:57:35.334 +03:00 [DBG] Connect: guest@localhost:5672/
2025-12-03 16:57:35.540 +03:00 [DBG] Connected: guest@localhost:5672/ (address: amqp://localhost:5672, local: 57264)
2025-12-03 16:57:35.545 +03:00 [DBG] Middleware loaded: DOTNET_MODIFIABLE_ASSEMBLIES=debug, __ASPNETCORE_BROWSER_TOOLS=true
2025-12-03 16:57:35.600 +03:00 [DBG] Endpoint Ready: "rabbitmq://localhost/ECHGHANNAMLP1_BillingSystemAPI_bus_t1eyyyyh3bcsyxr4bdxdrh9jd8?temporary=true"
2025-12-03 16:57:35.608 +03:00 [INF] Bus started: "rabbitmq://localhost/"
2025-12-03 16:57:35.824 +03:00 [INF] Now listening on: https://localhost:7257
2025-12-03 16:57:35.828 +03:00 [INF] Now listening on: http://localhost:5009
2025-12-03 16:57:35.831 +03:00 [DBG] Loaded hosting startup assembly BillingSystem.API
2025-12-03 16:57:35.833 +03:00 [DBG] Loaded hosting startup assembly Microsoft.WebTools.ApiEndpointDiscovery
2025-12-03 16:57:35.835 +03:00 [DBG] Loaded hosting startup assembly Microsoft.AspNetCore.Watch.BrowserRefresh
2025-12-03 16:57:35.838 +03:00 [DBG] Loaded hosting startup assembly Microsoft.WebTools.BrowserLink.Net
2025-12-03 16:57:35.985 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-12-03 16:57:35.987 +03:00 [INF] Hosting environment: Development
2025-12-03 16:57:35.991 +03:00 [INF] Content root path: C:\Repositories\Gac-BillingSystem\src\BillingSystem.API
2025-12-03 16:57:35.993 +03:00 [DBG] Hosting started
2025-12-03 16:57:36.232 +03:00 [DBG] Connection id "0HNHIEFL0JE7H" received FIN.
2025-12-03 16:57:36.247 +03:00 [DBG] Connection id "0HNHIEFL0JE7H" accepted.
2025-12-03 16:57:36.253 +03:00 [DBG] Connection id "0HNHIEFL0JE7H" started.
2025-12-03 16:57:36.275 +03:00 [DBG] Failed to authenticate HTTPS connection.
System.IO.IOException: Received an unexpected EOF or 0 bytes from the transport stream.
   at System.Net.Security.SslStream.ReceiveHandshakeFrameAsync[TIOAdapter](CancellationToken cancellationToken)
   at System.Net.Security.SslStream.ForceAuthenticationAsync[TIOAdapter](Boolean receiveFirst, Byte[] reAuthenticationData, CancellationToken cancellationToken)
   at System.Net.Security.SslStream.ProcessAuthenticationWithTelemetryAsync(Boolean isAsync, CancellationToken cancellationToken)
   at Microsoft.AspNetCore.Server.Kestrel.Https.Internal.HttpsConnectionMiddleware.OnConnectionAsync(ConnectionContext context)
2025-12-03 16:57:36.302 +03:00 [DBG] Connection id "0HNHIEFL0JE7H" stopped.
2025-12-03 16:57:36.313 +03:00 [DBG] Connection id "0HNHIEFL0JE7H" sending FIN because: "The Socket transport's send loop completed gracefully."
2025-12-03 16:57:37.735 +03:00 [DBG] Connection id "0HNHIEFL0JE7I" accepted.
2025-12-03 16:57:37.739 +03:00 [DBG] Connection id "0HNHIEFL0JE7I" started.
2025-12-03 16:57:37.807 +03:00 [DBG] Connection 0HNHIEFL0JE7I established using the following protocol: "Tls13"
2025-12-03 16:57:37.882 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7257/swagger/index.html - null null
2025-12-03 16:57:37.971 +03:00 [DBG] Wildcard detected, all requests with hosts will be allowed.
2025-12-03 16:57:37.996 +03:00 [DBG] No candidates found for the request path '/swagger/index.html'
2025-12-03 16:57:38.000 +03:00 [DBG] Request did not match any endpoints
2025-12-03 16:57:38.080 +03:00 [DBG] Response markup is scheduled to include Browser Link script injection.
2025-12-03 16:57:38.084 +03:00 [DBG] Response markup is scheduled to include browser refresh script injection.
2025-12-03 16:57:38.112 +03:00 [INF] HTTP GET /swagger/index.html responded 200 in 101.5712 ms
2025-12-03 16:57:38.120 +03:00 [DBG] Response markup was updated to include Browser Link script injection.
2025-12-03 16:57:38.124 +03:00 [DBG] Response markup was updated to include browser refresh script injection.
2025-12-03 16:57:38.131 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7257/swagger/index.html - 200 null text/html;charset=utf-8 260.6673ms
2025-12-03 16:57:38.173 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7257/_framework/aspnetcore-browser-refresh.js - null null
2025-12-03 16:57:38.173 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7257/_vs/browserLink - null null
2025-12-03 16:57:38.187 +03:00 [DBG] Script injected: /_framework/aspnetcore-browser-refresh.js
2025-12-03 16:57:38.191 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7257/_framework/aspnetcore-browser-refresh.js - 200 16519 application/javascript; charset=utf-8 18.5322ms
2025-12-03 16:57:38.255 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7257/_vs/browserLink - 200 null text/javascript; charset=UTF-8 81.9726ms
2025-12-03 16:57:38.441 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7257/swagger/v1/swagger.json - null null
2025-12-03 16:57:38.456 +03:00 [DBG] No candidates found for the request path '/swagger/v1/swagger.json'
2025-12-03 16:57:38.460 +03:00 [DBG] Request did not match any endpoints
2025-12-03 16:57:38.482 +03:00 [INF] HTTP GET /swagger/v1/swagger.json responded 200 in 19.1050 ms
2025-12-03 16:57:38.493 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7257/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 52.9979ms
2025-12-03 17:23:17.033 +03:00 [DBG] Connection id "0HNHIEFL0JE7J" accepted.
2025-12-03 17:23:17.035 +03:00 [DBG] Connection id "0HNHIEFL0JE7J" received FIN.
2025-12-03 17:23:17.041 +03:00 [DBG] Connection id "0HNHIEFL0JE7J" started.
2025-12-03 17:23:17.043 +03:00 [DBG] Connection id "0HNHIEFL0JE7K" accepted.
2025-12-03 17:23:17.053 +03:00 [DBG] Failed to authenticate HTTPS connection.
System.IO.IOException: Received an unexpected EOF or 0 bytes from the transport stream.
   at System.Net.Security.SslStream.ReceiveHandshakeFrameAsync[TIOAdapter](CancellationToken cancellationToken)
   at System.Net.Security.SslStream.ForceAuthenticationAsync[TIOAdapter](Boolean receiveFirst, Byte[] reAuthenticationData, CancellationToken cancellationToken)
   at System.Net.Security.SslStream.ProcessAuthenticationWithTelemetryAsync(Boolean isAsync, CancellationToken cancellationToken)
   at Microsoft.AspNetCore.Server.Kestrel.Https.Internal.HttpsConnectionMiddleware.OnConnectionAsync(ConnectionContext context)
2025-12-03 17:23:17.054 +03:00 [DBG] Connection id "0HNHIEFL0JE7K" started.
2025-12-03 17:23:17.059 +03:00 [DBG] Connection id "0HNHIEFL0JE7J" stopped.
2025-12-03 17:23:17.063 +03:00 [DBG] Connection id "0HNHIEFL0JE7J" sending FIN because: "The Socket transport's send loop completed gracefully."
2025-12-03 17:23:17.068 +03:00 [DBG] Connection 0HNHIEFL0JE7K established using the following protocol: "Tls13"
2025-12-03 17:23:17.076 +03:00 [INF] Request starting HTTP/1.1 POST https://localhost:7257/api/Invoices - application/json 1620
2025-12-03 17:23:17.083 +03:00 [DBG] No candidates found for the request path '/api/Invoices'
2025-12-03 17:23:17.085 +03:00 [DBG] Request did not match any endpoints
2025-12-03 17:23:17.090 +03:00 [DBG] POST requests are not supported
2025-12-03 17:23:18.047 +03:00 [DBG] An 'IServiceProvider' was created for internal use by Entity Framework.
2025-12-03 17:23:23.583 +03:00 [INF] HTTP POST /api/Invoices responded 404 in 6493.9509 ms
2025-12-03 17:23:23.600 +03:00 [DBG] Connection id "0HNHIEFL0JE7K" completed keep alive response.
2025-12-03 17:23:23.604 +03:00 [INF] Request finished HTTP/1.1 POST https://localhost:7257/api/Invoices - 404 0 null 6528.2591ms
2025-12-03 17:23:23.614 +03:00 [INF] Request reached the end of the middleware pipeline without being handled by application code. Request path: POST https://localhost:7257/api/Invoices, Response status code: 404
2025-12-03 17:23:23.619 +03:00 [DBG] Connection id "0HNHIEFL0JE7K", Request id "0HNHIEFL0JE7K:00000001": started reading request body.
2025-12-03 17:23:23.623 +03:00 [DBG] Connection id "0HNHIEFL0JE7K", Request id "0HNHIEFL0JE7K:00000001": done reading request body.
2025-12-03 17:24:32.414 +03:00 [DBG] Connection id "0HNHIEFL0JE7L" accepted.
2025-12-03 17:24:32.414 +03:00 [DBG] Connection id "0HNHIEFL0JE7L" received FIN.
2025-12-03 17:24:32.418 +03:00 [DBG] Connection id "0HNHIEFL0JE7M" accepted.
2025-12-03 17:24:32.417 +03:00 [DBG] Connection id "0HNHIEFL0JE7L" started.
2025-12-03 17:24:32.430 +03:00 [DBG] Connection id "0HNHIEFL0JE7M" started.
2025-12-03 17:24:32.433 +03:00 [DBG] Failed to authenticate HTTPS connection.
System.IO.IOException: Received an unexpected EOF or 0 bytes from the transport stream.
   at System.Net.Security.SslStream.ReceiveHandshakeFrameAsync[TIOAdapter](CancellationToken cancellationToken)
   at System.Net.Security.SslStream.ForceAuthenticationAsync[TIOAdapter](Boolean receiveFirst, Byte[] reAuthenticationData, CancellationToken cancellationToken)
   at System.Net.Security.SslStream.ProcessAuthenticationWithTelemetryAsync(Boolean isAsync, CancellationToken cancellationToken)
   at Microsoft.AspNetCore.Server.Kestrel.Https.Internal.HttpsConnectionMiddleware.OnConnectionAsync(ConnectionContext context)
2025-12-03 17:24:32.439 +03:00 [DBG] Connection id "0HNHIEFL0JE7L" stopped.
2025-12-03 17:24:32.442 +03:00 [DBG] Connection 0HNHIEFL0JE7M established using the following protocol: "Tls13"
2025-12-03 17:24:32.442 +03:00 [DBG] Connection id "0HNHIEFL0JE7L" sending FIN because: "The Socket transport's send loop completed gracefully."
2025-12-03 17:24:32.444 +03:00 [INF] Request starting HTTP/1.1 POST https://localhost:7257/api/Invoices/Post - application/json 1620
2025-12-03 17:24:32.456 +03:00 [DBG] 1 candidate(s) found for the request path '/api/Invoices/Post'
2025-12-03 17:24:32.464 +03:00 [DBG] Endpoint 'BillingSystem.API.Controllers.InvoicesController.Post (BillingSystem.API)' with route pattern 'api/Invoices/Post' is valid for the request path '/api/Invoices/Post'
2025-12-03 17:24:32.474 +03:00 [DBG] Request matched endpoint 'BillingSystem.API.Controllers.InvoicesController.Post (BillingSystem.API)'
2025-12-03 17:24:32.479 +03:00 [DBG] Static files was skipped as the request already matched an endpoint.
2025-12-03 17:24:32.492 +03:00 [INF] Executing endpoint 'BillingSystem.API.Controllers.InvoicesController.Post (BillingSystem.API)'
2025-12-03 17:24:32.536 +03:00 [INF] Route matched with {action = "Post", controller = "Invoices"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Post(BillingSystem.Application.Requests.CreateInvoiceRequest) on controller BillingSystem.API.Controllers.InvoicesController (BillingSystem.API).
2025-12-03 17:24:32.544 +03:00 [DBG] Execution plan of authorization filters (in the following order): ["None"]
2025-12-03 17:24:32.548 +03:00 [DBG] Execution plan of resource filters (in the following order): ["None"]
2025-12-03 17:24:32.552 +03:00 [DBG] Execution plan of action filters (in the following order): ["Microsoft.AspNetCore.Mvc.ModelBinding.UnsupportedContentTypeFilter (Order: -3000)","Microsoft.AspNetCore.Mvc.Infrastructure.ModelStateInvalidFilter (Order: -2000)","BillingSystem.API.ActionFilters.AuditBillingRequestsFilter","BillingSystem.API.ActionFilters.IdempotencyFilter (Order: 0)"]
2025-12-03 17:24:32.556 +03:00 [DBG] Execution plan of exception filters (in the following order): ["None"]
2025-12-03 17:24:32.559 +03:00 [DBG] Execution plan of result filters (in the following order): ["Microsoft.AspNetCore.Mvc.Infrastructure.ClientErrorResultFilter (Order: -2000)","Microsoft.AspNetCore.Mvc.ProducesAttribute (Order: 0)","BillingSystem.API.ActionFilters.IdempotencyFilter (Order: 0)"]
2025-12-03 17:24:32.567 +03:00 [DBG] Executing controller factory for controller BillingSystem.API.Controllers.InvoicesController (BillingSystem.API)
2025-12-03 17:24:32.572 +03:00 [WRN] You do not have a valid license key for the Lucky Penny software MediatR. This is allowed for development and testing scenarios. If you are running in production you are required to have a licensed version. Please visit https://luckypennysoftware.com to obtain a valid license.
2025-12-03 17:24:32.625 +03:00 [DBG] Executed controller factory for controller BillingSystem.API.Controllers.InvoicesController (BillingSystem.API)
2025-12-03 17:24:32.634 +03:00 [DBG] Attempting to bind parameter 'invoiceRequest' of type 'BillingSystem.Application.Requests.CreateInvoiceRequest' ...
2025-12-03 17:24:32.641 +03:00 [DBG] Attempting to bind parameter 'invoiceRequest' of type 'BillingSystem.Application.Requests.CreateInvoiceRequest' using the name '' in request data ...
2025-12-03 17:24:32.644 +03:00 [DBG] Selected input formatter 'Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonInputFormatter' for content type 'application/json'.
2025-12-03 17:24:32.678 +03:00 [DBG] Connection id "0HNHIEFL0JE7M", Request id "0HNHIEFL0JE7M:00000001": started reading request body.
2025-12-03 17:24:32.684 +03:00 [DBG] Connection id "0HNHIEFL0JE7M", Request id "0HNHIEFL0JE7M:00000001": done reading request body.
2025-12-03 17:24:32.721 +03:00 [DBG] JSON input formatter succeeded, deserializing to type 'BillingSystem.Application.Requests.CreateInvoiceRequest'
2025-12-03 17:24:32.726 +03:00 [DBG] Done attempting to bind parameter 'invoiceRequest' of type 'BillingSystem.Application.Requests.CreateInvoiceRequest'.
2025-12-03 17:24:32.729 +03:00 [DBG] Done attempting to bind parameter 'invoiceRequest' of type 'BillingSystem.Application.Requests.CreateInvoiceRequest'.
2025-12-03 17:24:32.733 +03:00 [DBG] Attempting to validate the bound parameter 'invoiceRequest' of type 'BillingSystem.Application.Requests.CreateInvoiceRequest' ...
2025-12-03 17:24:32.760 +03:00 [DBG] Done attempting to validate the bound parameter 'invoiceRequest' of type 'BillingSystem.Application.Requests.CreateInvoiceRequest'.
2025-12-03 17:24:33.172 +03:00 [DBG] No relationship from 'Invoice' to 'Invoice' has been configured by convention because there are multiple properties on one entity type - {'DiscountedPrimaryInvoice'} that could be matched with the properties on the other entity type - {'InverseDiscountedPrimaryInvoice', 'InversePrimaryInvoice', 'InverseSubstitutionPrimaryInvoice', 'PrimaryInvoice', 'SubstitutionPrimaryInvoice'}. This message can be disregarded if explicit configuration has been specified in 'OnModelCreating'.
2025-12-03 17:24:33.488 +03:00 [DBG] No relationship from 'Invoice' to 'Invoice' has been configured by convention because there are multiple properties on one entity type - {'DiscountedPrimaryInvoice'} that could be matched with the properties on the other entity type - {'InverseDiscountedPrimaryInvoice', 'InversePrimaryInvoice', 'InverseSubstitutionPrimaryInvoice', 'PrimaryInvoice', 'SubstitutionPrimaryInvoice'}. This message can be disregarded if explicit configuration has been specified in 'OnModelCreating'.
2025-12-03 17:24:33.505 +03:00 [DBG] No relationship from 'Invoice' to 'Invoice' has been configured by convention because there are multiple properties on one entity type - {'InversePrimaryInvoice'} that could be matched with the properties on the other entity type - {'InverseSubstitutionPrimaryInvoice', 'PrimaryInvoice', 'SubstitutionPrimaryInvoice'}. This message can be disregarded if explicit configuration has been specified in 'OnModelCreating'.
2025-12-03 17:24:33.518 +03:00 [DBG] No relationship from 'Invoice' to 'Invoice' has been configured by convention because there are multiple properties on one entity type - {'InversePrimaryInvoice'} that could be matched with the properties on the other entity type - {'InverseSubstitutionPrimaryInvoice', 'PrimaryInvoice', 'SubstitutionPrimaryInvoice'}. This message can be disregarded if explicit configuration has been specified in 'OnModelCreating'.
2025-12-03 17:24:33.918 +03:00 [DBG] Entity Framework Core 9.0.9 initialized 'BillingServiceDBContext' using provider 'Microsoft.EntityFrameworkCore.SqlServer:9.0.9' with options: EngineType=SqlServer 
2025-12-03 17:24:34.113 +03:00 [DBG] Compiling query expression: 
'DbSet<Invoice>()
    .AsNoTracking()
    .Any(inv => inv.ExternalId.ToString() == __idempotentKey_0)'
2025-12-03 17:24:34.482 +03:00 [DBG] Generated query execution expression: 
'queryContext => ShapedQueryCompilingExpressionVisitor.SingleAsync<bool>(
    asyncEnumerable: SingleQueryingEnumerable.Create<bool>(
        relationalQueryContext: (RelationalQueryContext)queryContext, 
        relationalCommandResolver: parameters => [LIFTABLE Constant: RelationalCommandCache.QueryExpression(
            Projection Mapping:
                EmptyProjectionMember -> 0
            SELECT EXISTS (
                SELECT 1
                FROM Invoices AS i
                WHERE COALESCE(CONVERT(varchar(36), i.ExternalId), '') == @__idempotentKey_0)) | Resolver: c => new RelationalCommandCache(
            c.Dependencies.MemoryCache, 
            c.RelationalDependencies.QuerySqlGeneratorFactory, 
            c.RelationalDependencies.RelationalParameterBasedSqlProcessorFactory, 
            Projection Mapping:
                EmptyProjectionMember -> 0
            SELECT EXISTS (
                SELECT 1
                FROM Invoices AS i
                WHERE COALESCE(CONVERT(varchar(36), i.ExternalId), '') == @__idempotentKey_0), 
            False, 
            new HashSet<string>(
                new string[]{ }, 
                StringComparer.Ordinal
            )
        )].GetRelationalCommandTemplate(parameters), 
        readerColumns: null, 
        shaper: (queryContext, dataReader, resultContext, resultCoordinator) => 
        {
            bool? value1;
            value1 = dataReader.IsDBNull(0) ? default(bool?) : (bool?)dataReader.GetBoolean(0);
            return (bool)value1;
        }, 
        contextType: BillingSystem.Infrastructure.EF.BillingServiceDBContext, 
        standAloneStateManager: False, 
        detailedErrorsEnabled: False, 
        threadSafetyChecksEnabled: True), 
    cancellationToken: queryContext.CancellationToken)'
2025-12-03 17:24:34.573 +03:00 [DBG] Creating DbConnection.
2025-12-03 17:24:34.601 +03:00 [DBG] Created DbConnection. (26ms).
2025-12-03 17:24:34.608 +03:00 [DBG] Opening connection to database 'GAC-BillingService' on server '.'.
2025-12-03 17:24:35.179 +03:00 [DBG] Opened connection to database 'GAC-BillingService' on server '.'.
2025-12-03 17:24:35.187 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-12-03 17:24:35.198 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (7ms).
2025-12-03 17:24:35.213 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (25ms).
2025-12-03 17:24:35.225 +03:00 [DBG] Executing DbCommand [Parameters=[@__idempotentKey_0='?' (Size = 36) (DbType = AnsiString)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [Invoices] AS [i]
        WHERE CONVERT(varchar(36), [i].[ExternalId]) = @__idempotentKey_0) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2025-12-03 17:24:35.369 +03:00 [INF] Executed DbCommand (141ms) [Parameters=[@__idempotentKey_0='?' (Size = 36) (DbType = AnsiString)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [Invoices] AS [i]
        WHERE CONVERT(varchar(36), [i].[ExternalId]) = @__idempotentKey_0) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2025-12-03 17:24:35.408 +03:00 [DBG] Closing data reader to 'GAC-BillingService' on server '.'.
2025-12-03 17:24:35.432 +03:00 [DBG] A data reader for 'GAC-BillingService' on server '.' is being disposed after spending 46ms reading results.
2025-12-03 17:24:35.445 +03:00 [DBG] Closing connection to database 'GAC-BillingService' on server '.'.
2025-12-03 17:24:35.460 +03:00 [DBG] Closed connection to database 'GAC-BillingService' on server '.' (13ms).
2025-12-03 17:31:57.695 +03:00 [DBG] Registered model binder providers, in the following order: ["Microsoft.AspNetCore.Mvc.ModelBinding.Binders.BinderTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ServicesModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.BodyModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.HeaderModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FloatingPointTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.EnumTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.DateTimeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.SimpleTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.TryParseModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.CancellationTokenModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ByteArrayModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FormFileModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FormCollectionModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.KeyValuePairModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.DictionaryModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ArrayModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.CollectionModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ComplexObjectModelBinderProvider"]
2025-12-03 17:31:57.913 +03:00 [DBG] Hosting starting
2025-12-03 17:31:58.288 +03:00 [DBG] Starting bus instances: IBus
2025-12-03 17:31:58.299 +03:00 [DBG] Starting bus: "rabbitmq://localhost/"
2025-12-03 17:31:58.350 +03:00 [DBG] Middleware loaded
2025-12-03 17:31:58.357 +03:00 [DBG] Middleware loaded. Script /_framework/aspnetcore-browser-refresh.js (16519 B).
2025-12-03 17:31:58.363 +03:00 [DBG] Middleware loaded. Script /_framework/blazor-hotreload.js (799 B).
2025-12-03 17:31:58.387 +03:00 [DBG] Connect: guest@localhost:5672/
2025-12-03 17:31:58.541 +03:00 [DBG] Middleware loaded: DOTNET_MODIFIABLE_ASSEMBLIES=debug, __ASPNETCORE_BROWSER_TOOLS=true
2025-12-03 17:31:58.573 +03:00 [DBG] Connected: guest@localhost:5672/ (address: amqp://localhost:5672, local: 64213)
2025-12-03 17:31:58.629 +03:00 [DBG] Endpoint Ready: "rabbitmq://localhost/ECHGHANNAMLP1_BillingSystemAPI_bus_yufoyyyh3bcsbewzbdxdr6fzyt?temporary=true"
2025-12-03 17:31:58.633 +03:00 [INF] Bus started: "rabbitmq://localhost/"
2025-12-03 17:31:58.829 +03:00 [INF] Now listening on: https://localhost:7257
2025-12-03 17:31:58.834 +03:00 [INF] Now listening on: http://localhost:5009
2025-12-03 17:31:58.837 +03:00 [DBG] Loaded hosting startup assembly BillingSystem.API
2025-12-03 17:31:58.839 +03:00 [DBG] Loaded hosting startup assembly Microsoft.WebTools.ApiEndpointDiscovery
2025-12-03 17:31:58.841 +03:00 [DBG] Loaded hosting startup assembly Microsoft.AspNetCore.Watch.BrowserRefresh
2025-12-03 17:31:58.843 +03:00 [DBG] Loaded hosting startup assembly Microsoft.WebTools.BrowserLink.Net
2025-12-03 17:31:58.860 +03:00 [DBG] Connection id "0HNHIF2RNBHLA" accepted.
2025-12-03 17:31:58.866 +03:00 [DBG] Connection id "0HNHIF2RNBHLB" accepted.
2025-12-03 17:31:58.866 +03:00 [DBG] Connection id "0HNHIF2RNBHLA" started.
2025-12-03 17:31:58.869 +03:00 [DBG] Connection id "0HNHIF2RNBHLB" started.
2025-12-03 17:31:58.885 +03:00 [DBG] Connection id "0HNHIF2RNBHLB" received FIN.
2025-12-03 17:31:58.885 +03:00 [DBG] Connection id "0HNHIF2RNBHLA" received FIN.
2025-12-03 17:31:58.916 +03:00 [DBG] Failed to authenticate HTTPS connection.
System.IO.IOException: Received an unexpected EOF or 0 bytes from the transport stream.
   at System.Net.Security.SslStream.ReceiveHandshakeFrameAsync[TIOAdapter](CancellationToken cancellationToken)
   at System.Net.Security.SslStream.ForceAuthenticationAsync[TIOAdapter](Boolean receiveFirst, Byte[] reAuthenticationData, CancellationToken cancellationToken)
   at System.Net.Security.SslStream.ProcessAuthenticationWithTelemetryAsync(Boolean isAsync, CancellationToken cancellationToken)
   at Microsoft.AspNetCore.Server.Kestrel.Https.Internal.HttpsConnectionMiddleware.OnConnectionAsync(ConnectionContext context)
2025-12-03 17:31:58.916 +03:00 [DBG] Failed to authenticate HTTPS connection.
System.IO.IOException: Received an unexpected EOF or 0 bytes from the transport stream.
   at System.Net.Security.SslStream.ReceiveHandshakeFrameAsync[TIOAdapter](CancellationToken cancellationToken)
   at System.Net.Security.SslStream.ForceAuthenticationAsync[TIOAdapter](Boolean receiveFirst, Byte[] reAuthenticationData, CancellationToken cancellationToken)
   at System.Net.Security.SslStream.ProcessAuthenticationWithTelemetryAsync(Boolean isAsync, CancellationToken cancellationToken)
   at Microsoft.AspNetCore.Server.Kestrel.Https.Internal.HttpsConnectionMiddleware.OnConnectionAsync(ConnectionContext context)
2025-12-03 17:31:58.954 +03:00 [DBG] Connection id "0HNHIF2RNBHLA" stopped.
2025-12-03 17:31:58.955 +03:00 [DBG] Connection id "0HNHIF2RNBHLB" stopped.
2025-12-03 17:31:58.968 +03:00 [DBG] Connection id "0HNHIF2RNBHLA" sending FIN because: "The Socket transport's send loop completed gracefully."
2025-12-03 17:31:58.968 +03:00 [DBG] Connection id "0HNHIF2RNBHLB" sending FIN because: "The Socket transport's send loop completed gracefully."
2025-12-03 17:31:59.022 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-12-03 17:31:59.023 +03:00 [INF] Hosting environment: Development
2025-12-03 17:31:59.026 +03:00 [INF] Content root path: C:\Repositories\Gac-BillingSystem\src\BillingSystem.API
2025-12-03 17:31:59.028 +03:00 [DBG] Hosting started
2025-12-03 17:31:59.474 +03:00 [DBG] Connection id "0HNHIF2RNBHLC" accepted.
2025-12-03 17:31:59.478 +03:00 [DBG] Connection id "0HNHIF2RNBHLC" started.
2025-12-03 17:31:59.558 +03:00 [DBG] Connection 0HNHIF2RNBHLC established using the following protocol: "Tls13"
2025-12-03 17:31:59.638 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7257/swagger/index.html - null null
2025-12-03 17:31:59.685 +03:00 [DBG] Wildcard detected, all requests with hosts will be allowed.
2025-12-03 17:31:59.733 +03:00 [DBG] No candidates found for the request path '/swagger/index.html'
2025-12-03 17:31:59.739 +03:00 [DBG] Request did not match any endpoints
2025-12-03 17:31:59.822 +03:00 [DBG] Response markup is scheduled to include Browser Link script injection.
2025-12-03 17:31:59.827 +03:00 [DBG] Response markup is scheduled to include browser refresh script injection.
2025-12-03 17:31:59.860 +03:00 [INF] HTTP GET /swagger/index.html responded 200 in 111.3644 ms
2025-12-03 17:31:59.866 +03:00 [DBG] Response markup was updated to include Browser Link script injection.
2025-12-03 17:31:59.870 +03:00 [DBG] Response markup was updated to include browser refresh script injection.
2025-12-03 17:31:59.878 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7257/swagger/index.html - 200 null text/html;charset=utf-8 250.5211ms
2025-12-03 17:31:59.929 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7257/_framework/aspnetcore-browser-refresh.js - null null
2025-12-03 17:31:59.931 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7257/_vs/browserLink - null null
2025-12-03 17:31:59.968 +03:00 [DBG] Script injected: /_framework/aspnetcore-browser-refresh.js
2025-12-03 17:31:59.978 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7257/_framework/aspnetcore-browser-refresh.js - 200 16519 application/javascript; charset=utf-8 49.7096ms
2025-12-03 17:32:00.062 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7257/_vs/browserLink - 200 null text/javascript; charset=UTF-8 133.7694ms
2025-12-03 17:32:00.131 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7257/swagger/v1/swagger.json - null null
2025-12-03 17:32:00.145 +03:00 [DBG] No candidates found for the request path '/swagger/v1/swagger.json'
2025-12-03 17:32:00.148 +03:00 [DBG] Request did not match any endpoints
2025-12-03 17:32:00.169 +03:00 [INF] HTTP GET /swagger/v1/swagger.json responded 200 in 16.7112 ms
2025-12-03 17:32:00.176 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7257/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 45.586ms
2025-12-03 17:32:40.785 +03:00 [DBG] Connection id "0HNHIF2RNBHLD" accepted.
2025-12-03 17:32:40.787 +03:00 [DBG] Connection id "0HNHIF2RNBHLD" received FIN.
2025-12-03 17:32:40.799 +03:00 [DBG] Connection id "0HNHIF2RNBHLE" accepted.
2025-12-03 17:32:40.798 +03:00 [DBG] Connection id "0HNHIF2RNBHLD" started.
2025-12-03 17:32:40.809 +03:00 [DBG] Connection id "0HNHIF2RNBHLE" started.
2025-12-03 17:32:40.813 +03:00 [DBG] Failed to authenticate HTTPS connection.
System.IO.IOException: Received an unexpected EOF or 0 bytes from the transport stream.
   at System.Net.Security.SslStream.ReceiveHandshakeFrameAsync[TIOAdapter](CancellationToken cancellationToken)
   at System.Net.Security.SslStream.ForceAuthenticationAsync[TIOAdapter](Boolean receiveFirst, Byte[] reAuthenticationData, CancellationToken cancellationToken)
   at System.Net.Security.SslStream.ProcessAuthenticationWithTelemetryAsync(Boolean isAsync, CancellationToken cancellationToken)
   at Microsoft.AspNetCore.Server.Kestrel.Https.Internal.HttpsConnectionMiddleware.OnConnectionAsync(ConnectionContext context)
2025-12-03 17:32:40.819 +03:00 [DBG] Connection id "0HNHIF2RNBHLD" stopped.
2025-12-03 17:32:40.820 +03:00 [DBG] Connection 0HNHIF2RNBHLE established using the following protocol: "Tls13"
2025-12-03 17:32:40.824 +03:00 [DBG] Connection id "0HNHIF2RNBHLD" sending FIN because: "The Socket transport's send loop completed gracefully."
2025-12-03 17:32:40.832 +03:00 [INF] Request starting HTTP/1.1 POST https://localhost:7257/api/Invoices/Post - application/json 1620
2025-12-03 17:32:40.844 +03:00 [DBG] 1 candidate(s) found for the request path '/api/Invoices/Post'
2025-12-03 17:32:40.850 +03:00 [DBG] Endpoint 'BillingSystem.API.Controllers.InvoicesController.Post (BillingSystem.API)' with route pattern 'api/Invoices/Post' is valid for the request path '/api/Invoices/Post'
2025-12-03 17:32:40.856 +03:00 [DBG] Request matched endpoint 'BillingSystem.API.Controllers.InvoicesController.Post (BillingSystem.API)'
2025-12-03 17:32:40.862 +03:00 [DBG] Static files was skipped as the request already matched an endpoint.
2025-12-03 17:32:41.049 +03:00 [DBG] An 'IServiceProvider' was created for internal use by Entity Framework.
2025-12-03 17:32:46.491 +03:00 [INF] Executing endpoint 'BillingSystem.API.Controllers.InvoicesController.Post (BillingSystem.API)'
2025-12-03 17:32:46.526 +03:00 [INF] Route matched with {action = "Post", controller = "Invoices"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Post(BillingSystem.Application.Requests.CreateInvoiceRequest) on controller BillingSystem.API.Controllers.InvoicesController (BillingSystem.API).
2025-12-03 17:32:46.534 +03:00 [DBG] Execution plan of authorization filters (in the following order): ["None"]
2025-12-03 17:32:46.537 +03:00 [DBG] Execution plan of resource filters (in the following order): ["None"]
2025-12-03 17:32:46.542 +03:00 [DBG] Execution plan of action filters (in the following order): ["Microsoft.AspNetCore.Mvc.ModelBinding.UnsupportedContentTypeFilter (Order: -3000)","Microsoft.AspNetCore.Mvc.Infrastructure.ModelStateInvalidFilter (Order: -2000)","BillingSystem.API.ActionFilters.AuditBillingRequestsFilter","BillingSystem.API.ActionFilters.IdempotencyFilter (Order: 0)"]
2025-12-03 17:32:46.548 +03:00 [DBG] Execution plan of exception filters (in the following order): ["None"]
2025-12-03 17:32:46.552 +03:00 [DBG] Execution plan of result filters (in the following order): ["Microsoft.AspNetCore.Mvc.Infrastructure.ClientErrorResultFilter (Order: -2000)","Microsoft.AspNetCore.Mvc.ProducesAttribute (Order: 0)","BillingSystem.API.ActionFilters.IdempotencyFilter (Order: 0)"]
2025-12-03 17:32:46.562 +03:00 [DBG] Executing controller factory for controller BillingSystem.API.Controllers.InvoicesController (BillingSystem.API)
2025-12-03 17:32:46.570 +03:00 [WRN] You do not have a valid license key for the Lucky Penny software MediatR. This is allowed for development and testing scenarios. If you are running in production you are required to have a licensed version. Please visit https://luckypennysoftware.com to obtain a valid license.
2025-12-03 17:32:46.620 +03:00 [DBG] Executed controller factory for controller BillingSystem.API.Controllers.InvoicesController (BillingSystem.API)
2025-12-03 17:32:46.643 +03:00 [DBG] Attempting to bind parameter 'invoiceRequest' of type 'BillingSystem.Application.Requests.CreateInvoiceRequest' ...
2025-12-03 17:32:46.649 +03:00 [DBG] Attempting to bind parameter 'invoiceRequest' of type 'BillingSystem.Application.Requests.CreateInvoiceRequest' using the name '' in request data ...
2025-12-03 17:32:46.655 +03:00 [DBG] Selected input formatter 'Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonInputFormatter' for content type 'application/json'.
2025-12-03 17:32:46.698 +03:00 [DBG] Connection id "0HNHIF2RNBHLE", Request id "0HNHIF2RNBHLE:00000001": started reading request body.
2025-12-03 17:32:46.702 +03:00 [DBG] Connection id "0HNHIF2RNBHLE", Request id "0HNHIF2RNBHLE:00000001": done reading request body.
2025-12-03 17:32:46.732 +03:00 [DBG] JSON input formatter succeeded, deserializing to type 'BillingSystem.Application.Requests.CreateInvoiceRequest'
2025-12-03 17:32:46.736 +03:00 [DBG] Done attempting to bind parameter 'invoiceRequest' of type 'BillingSystem.Application.Requests.CreateInvoiceRequest'.
2025-12-03 17:32:46.740 +03:00 [DBG] Done attempting to bind parameter 'invoiceRequest' of type 'BillingSystem.Application.Requests.CreateInvoiceRequest'.
2025-12-03 17:32:46.743 +03:00 [DBG] Attempting to validate the bound parameter 'invoiceRequest' of type 'BillingSystem.Application.Requests.CreateInvoiceRequest' ...
2025-12-03 17:32:46.767 +03:00 [DBG] Done attempting to validate the bound parameter 'invoiceRequest' of type 'BillingSystem.Application.Requests.CreateInvoiceRequest'.
2025-12-03 17:32:47.068 +03:00 [DBG] No relationship from 'Invoice' to 'Invoice' has been configured by convention because there are multiple properties on one entity type - {'DiscountedPrimaryInvoice'} that could be matched with the properties on the other entity type - {'InverseDiscountedPrimaryInvoice', 'InversePrimaryInvoice', 'InverseSubstitutionPrimaryInvoice', 'PrimaryInvoice', 'SubstitutionPrimaryInvoice'}. This message can be disregarded if explicit configuration has been specified in 'OnModelCreating'.
2025-12-03 17:32:47.338 +03:00 [DBG] No relationship from 'Invoice' to 'Invoice' has been configured by convention because there are multiple properties on one entity type - {'DiscountedPrimaryInvoice'} that could be matched with the properties on the other entity type - {'InverseDiscountedPrimaryInvoice', 'InversePrimaryInvoice', 'InverseSubstitutionPrimaryInvoice', 'PrimaryInvoice', 'SubstitutionPrimaryInvoice'}. This message can be disregarded if explicit configuration has been specified in 'OnModelCreating'.
2025-12-03 17:32:47.350 +03:00 [DBG] No relationship from 'Invoice' to 'Invoice' has been configured by convention because there are multiple properties on one entity type - {'InversePrimaryInvoice'} that could be matched with the properties on the other entity type - {'InverseSubstitutionPrimaryInvoice', 'PrimaryInvoice', 'SubstitutionPrimaryInvoice'}. This message can be disregarded if explicit configuration has been specified in 'OnModelCreating'.
2025-12-03 17:32:47.359 +03:00 [DBG] No relationship from 'Invoice' to 'Invoice' has been configured by convention because there are multiple properties on one entity type - {'InversePrimaryInvoice'} that could be matched with the properties on the other entity type - {'InverseSubstitutionPrimaryInvoice', 'PrimaryInvoice', 'SubstitutionPrimaryInvoice'}. This message can be disregarded if explicit configuration has been specified in 'OnModelCreating'.
2025-12-03 17:32:47.717 +03:00 [DBG] Entity Framework Core 9.0.9 initialized 'BillingServiceDBContext' using provider 'Microsoft.EntityFrameworkCore.SqlServer:9.0.9' with options: EngineType=SqlServer 
2025-12-03 17:32:47.851 +03:00 [DBG] Compiling query expression: 
'DbSet<Invoice>()
    .AsNoTracking()
    .Any(inv => inv.ExternalId.ToString() == __idempotentKey_0)'
2025-12-03 17:32:48.274 +03:00 [DBG] Generated query execution expression: 
'queryContext => ShapedQueryCompilingExpressionVisitor.SingleAsync<bool>(
    asyncEnumerable: SingleQueryingEnumerable.Create<bool>(
        relationalQueryContext: (RelationalQueryContext)queryContext, 
        relationalCommandResolver: parameters => [LIFTABLE Constant: RelationalCommandCache.QueryExpression(
            Projection Mapping:
                EmptyProjectionMember -> 0
            SELECT EXISTS (
                SELECT 1
                FROM Invoices AS i
                WHERE COALESCE(CONVERT(varchar(36), i.ExternalId), '') == @__idempotentKey_0)) | Resolver: c => new RelationalCommandCache(
            c.Dependencies.MemoryCache, 
            c.RelationalDependencies.QuerySqlGeneratorFactory, 
            c.RelationalDependencies.RelationalParameterBasedSqlProcessorFactory, 
            Projection Mapping:
                EmptyProjectionMember -> 0
            SELECT EXISTS (
                SELECT 1
                FROM Invoices AS i
                WHERE COALESCE(CONVERT(varchar(36), i.ExternalId), '') == @__idempotentKey_0), 
            False, 
            new HashSet<string>(
                new string[]{ }, 
                StringComparer.Ordinal
            )
        )].GetRelationalCommandTemplate(parameters), 
        readerColumns: null, 
        shaper: (queryContext, dataReader, resultContext, resultCoordinator) => 
        {
            bool? value1;
            value1 = dataReader.IsDBNull(0) ? default(bool?) : (bool?)dataReader.GetBoolean(0);
            return (bool)value1;
        }, 
        contextType: BillingSystem.Infrastructure.EF.BillingServiceDBContext, 
        standAloneStateManager: False, 
        detailedErrorsEnabled: False, 
        threadSafetyChecksEnabled: True), 
    cancellationToken: queryContext.CancellationToken)'
2025-12-03 17:32:48.341 +03:00 [DBG] Creating DbConnection.
2025-12-03 17:32:48.388 +03:00 [DBG] Created DbConnection. (46ms).
2025-12-03 17:32:48.395 +03:00 [DBG] Opening connection to database 'GAC-BillingService' on server '.'.
2025-12-03 17:32:48.723 +03:00 [DBG] Opened connection to database 'GAC-BillingService' on server '.'.
2025-12-03 17:32:48.733 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-12-03 17:32:48.749 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (11ms).
2025-12-03 17:32:48.766 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (34ms).
2025-12-03 17:32:48.780 +03:00 [DBG] Executing DbCommand [Parameters=[@__idempotentKey_0='?' (Size = 36) (DbType = AnsiString)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [Invoices] AS [i]
        WHERE CONVERT(varchar(36), [i].[ExternalId]) = @__idempotentKey_0) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2025-12-03 17:32:48.852 +03:00 [INF] Executed DbCommand (74ms) [Parameters=[@__idempotentKey_0='?' (Size = 36) (DbType = AnsiString)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [Invoices] AS [i]
        WHERE CONVERT(varchar(36), [i].[ExternalId]) = @__idempotentKey_0) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2025-12-03 17:32:48.888 +03:00 [DBG] Closing data reader to 'GAC-BillingService' on server '.'.
2025-12-03 17:32:48.900 +03:00 [DBG] A data reader for 'GAC-BillingService' on server '.' is being disposed after spending 35ms reading results.
2025-12-03 17:32:48.907 +03:00 [DBG] Closing connection to database 'GAC-BillingService' on server '.'.
2025-12-03 17:32:48.917 +03:00 [DBG] Closed connection to database 'GAC-BillingService' on server '.' (9ms).
2025-12-03 17:32:49.138 +03:00 [WRN] You do not have a valid license key for the Lucky Penny software AutoMapper. This is allowed for development and testing scenarios. If you are running in production you are required to have a licensed version. Please visit https://luckypennysoftware.com to obtain a valid license.
2025-12-03 17:32:49.208 +03:00 [DBG] Opening connection to database 'GAC-BillingService' on server '.'.
2025-12-03 17:32:49.216 +03:00 [DBG] Opened connection to database 'GAC-BillingService' on server '.'.
2025-12-03 17:32:49.225 +03:00 [DBG] Beginning transaction with isolation level 'Unspecified'.
2025-12-03 17:32:49.239 +03:00 [DBG] Began transaction with isolation level 'ReadCommitted'.
2025-12-03 17:32:49.246 +03:00 [DBG] Compiling query expression: 
'DbSet<InvoiceSequenceValue>().FromSql(EXECUTE dbo.GetNextInvoiceNumber, __p_0)
'
2025-12-03 17:32:49.305 +03:00 [DBG] Generated query execution expression: 
'queryContext => FromSqlQueryingEnumerable.Create<InvoiceSequenceValue>(
    relationalQueryContext: (RelationalQueryContext)queryContext, 
    relationalCommandResolver: parameters => [LIFTABLE Constant: RelationalCommandCache.QueryExpression(
        Projection Mapping:
            EmptyProjectionMember -> Dictionary<IProperty, int> { [Property: InvoiceSequenceValue.Value (long) Required, 0] }
        SELECT b.Value
        FROM EXECUTE dbo.GetNextInvoiceNumber) | Resolver: c => new RelationalCommandCache(
        c.Dependencies.MemoryCache, 
        c.RelationalDependencies.QuerySqlGeneratorFactory, 
        c.RelationalDependencies.RelationalParameterBasedSqlProcessorFactory, 
        Projection Mapping:
            EmptyProjectionMember -> Dictionary<IProperty, int> { [Property: InvoiceSequenceValue.Value (long) Required, 0] }
        SELECT b.Value
        FROM EXECUTE dbo.GetNextInvoiceNumber, 
        False, 
        new HashSet<string>(
            new string[]{ }, 
            StringComparer.Ordinal
        )
    )].GetRelationalCommandTemplate(parameters), 
    readerColumns: null, 
    columnNames: [LIFTABLE Constant: string[] { "Value" } | Resolver: _ => new string[]{ "Value" }], 
    shaper: (queryContext, dataReader, indexMap) => 
    {
        InvoiceSequenceValue entity;
        entity = 
        {
            MaterializationContext materializationContext1;
            IEntityType entityType1;
            InvoiceSequenceValue instance1;
            materializationContext1 = new MaterializationContext(
                [LIFTABLE Constant: ValueBuffer | Resolver: _ => (object)ValueBuffer.Empty], 
                queryContext.Context
            );
            instance1 = default(InvoiceSequenceValue);
            {
                ISnapshot shadowSnapshot1;
                shadowSnapshot1 = [LIFTABLE Constant: Snapshot | Resolver: _ => Snapshot.Empty];
                entityType1 = [LIFTABLE Constant: EntityType: InvoiceSequenceValue Keyless | Resolver: namelessParameter{0} => namelessParameter{0}.Dependencies.Model.FindEntityType("BillingSystem.Domain.Entities.InvoiceSequenceValue")];
                instance1 = switch (entityType1)
                {
                    case [LIFTABLE Constant: EntityType: InvoiceSequenceValue Keyless | Resolver: namelessParameter{1} => namelessParameter{1}.Dependencies.Model.FindEntityType("BillingSystem.Domain.Entities.InvoiceSequenceValue")]: 
                        {
                            return 
                            {
                                InvoiceSequenceValue instance;
                                instance = new InvoiceSequenceValue();
                                instance.<Value>k__BackingField = dataReader.GetInt64(indexMap[0]);
                                (instance is IInjectableService) ? ((IInjectableService)instance).Injected(
                                    context: materializationContext1.Context, 
                                    entity: instance, 
                                    queryTrackingBehavior: TrackAll, 
                                    structuralType: [LIFTABLE Constant: EntityType: InvoiceSequenceValue Keyless | Resolver: namelessParameter{2} => namelessParameter{2}.Dependencies.Model.FindEntityType("BillingSystem.Domain.Entities.InvoiceSequenceValue")]) : default(void);
                                return instance;
                            }}
                    default: 
                        default(InvoiceSequenceValue)
                }
                ;
                return instance1;
            }return instance1;
        };
        return entity;
    }, 
    contextType: BillingSystem.Infrastructure.EF.BillingServiceDBContext, 
    standAloneStateManager: False, 
    detailedErrorsEnabled: False, 
    threadSafetyChecksEnabled: True)'
2025-12-03 17:32:49.318 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-12-03 17:32:49.321 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (3ms).
2025-12-03 17:32:49.327 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (9ms).
2025-12-03 17:32:49.331 +03:00 [DBG] Executing DbCommand [Parameters=[], CommandType='"Text"', CommandTimeout='30']
EXECUTE dbo.GetNextInvoiceNumber
2025-12-03 17:32:49.358 +03:00 [INF] Executed DbCommand (26ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
EXECUTE dbo.GetNextInvoiceNumber
2025-12-03 17:32:49.370 +03:00 [DBG] Closing data reader to 'GAC-BillingService' on server '.'.
2025-12-03 17:32:49.376 +03:00 [DBG] A data reader for 'GAC-BillingService' on server '.' is being disposed after spending 11ms reading results.
2025-12-03 17:32:49.384 +03:00 [DBG] Compiling query expression: 
'DbSet<Customer>()
    .FirstOrDefault(c => c.IdentityNumber == __cutomerIdentityNumber_0)'
2025-12-03 17:32:49.403 +03:00 [DBG] Generated query execution expression: 
'queryContext => SingleQueryingEnumerable.Create<Customer>(
    relationalQueryContext: (RelationalQueryContext)queryContext, 
    relationalCommandResolver: parameters => [LIFTABLE Constant: RelationalCommandCache.QueryExpression(
        Projection Mapping:
            EmptyProjectionMember -> Dictionary<IProperty, int> { [Property: Customer.Id (long) Required PK AfterSave:Throw ValueGenerated.OnAdd, 0], [Property: Customer.AddressBuildingNumber (string) MaxLength(200), 1], [Property: Customer.AddressCity (string) Required MaxLength(200), 2], [Property: Customer.AddressCountry (string) Required MaxLength(200), 3], [Property: Customer.AddressDistrict (string) Required MaxLength(200), 4], [Property: Customer.AddressPostalCode (string) Required MaxLength(50), 5], [Property: Customer.AddressStreet (string) MaxLength(200), 6], [Property: Customer.AddressSubNumber (string) MaxLength(200), 7], [Property: Customer.CreatedBy (string) Required MaxLength(50), 8], [Property: Customer.CreatedDate (DateTime) Required, 9], [Property: Customer.CustomerType (string) Required MaxLength(100), 10], [Property: Customer.EmailAddress (string) MaxLength(80), 11], [Property: Customer.FullName (string) Required MaxLength(500), 12], [Property: Customer.IdentityNumber (string) Required MaxLength(100), 13], [Property: Customer.IdentityType (int?), 14], [Property: Customer.IsDeleted (bool) Required, 15], [Property: Customer.LastUpdatedDate (DateTime?), 16], [Property: Customer.OverpaymentBalance (decimal?), 17], [Property: Customer.PhoneNumber (string) MaxLength(50), 18], [Property: Customer.Vatnumber (string) MaxLength(100), 19] }
        SELECT TOP(1) c.Id, c.Address_BuildingNumber, c.Address_City, c.Address_Country, c.Address_District, c.Address_PostalCode, c.Address_Street, c.Address_SubNumber, c.CreatedBy, c.CreatedDate, c.CustomerType, c.EmailAddress, c.FullName, c.IdentityNumber, c.IdentityType, c.IsDeleted, c.LastUpdatedDate, c.OverpaymentBalance, c.PhoneNumber, c.VATNumber
        FROM Customers AS c
        WHERE c.IdentityNumber == @__cutomerIdentityNumber_0) | Resolver: c => new RelationalCommandCache(
        c.Dependencies.MemoryCache, 
        c.RelationalDependencies.QuerySqlGeneratorFactory, 
        c.RelationalDependencies.RelationalParameterBasedSqlProcessorFactory, 
        Projection Mapping:
            EmptyProjectionMember -> Dictionary<IProperty, int> { [Property: Customer.Id (long) Required PK AfterSave:Throw ValueGenerated.OnAdd, 0], [Property: Customer.AddressBuildingNumber (string) MaxLength(200), 1], [Property: Customer.AddressCity (string) Required MaxLength(200), 2], [Property: Customer.AddressCountry (string) Required MaxLength(200), 3], [Property: Customer.AddressDistrict (string) Required MaxLength(200), 4], [Property: Customer.AddressPostalCode (string) Required MaxLength(50), 5], [Property: Customer.AddressStreet (string) MaxLength(200), 6], [Property: Customer.AddressSubNumber (string) MaxLength(200), 7], [Property: Customer.CreatedBy (string) Required MaxLength(50), 8], [Property: Customer.CreatedDate (DateTime) Required, 9], [Property: Customer.CustomerType (string) Required MaxLength(100), 10], [Property: Customer.EmailAddress (string) MaxLength(80), 11], [Property: Customer.FullName (string) Required MaxLength(500), 12], [Property: Customer.IdentityNumber (string) Required MaxLength(100), 13], [Property: Customer.IdentityType (int?), 14], [Property: Customer.IsDeleted (bool) Required, 15], [Property: Customer.LastUpdatedDate (DateTime?), 16], [Property: Customer.OverpaymentBalance (decimal?), 17], [Property: Customer.PhoneNumber (string) MaxLength(50), 18], [Property: Customer.Vatnumber (string) MaxLength(100), 19] }
        SELECT TOP(1) c.Id, c.Address_BuildingNumber, c.Address_City, c.Address_Country, c.Address_District, c.Address_PostalCode, c.Address_Street, c.Address_SubNumber, c.CreatedBy, c.CreatedDate, c.CustomerType, c.EmailAddress, c.FullName, c.IdentityNumber, c.IdentityType, c.IsDeleted, c.LastUpdatedDate, c.OverpaymentBalance, c.PhoneNumber, c.VATNumber
        FROM Customers AS c
        WHERE c.IdentityNumber == @__cutomerIdentityNumber_0, 
        False, 
        new HashSet<string>(
            new string[]{ }, 
            StringComparer.Ordinal
        )
    )].GetRelationalCommandTemplate(parameters), 
    readerColumns: null, 
    shaper: (queryContext, dataReader, resultContext, resultCoordinator) => 
    {
        Customer entity;
        entity = 
        {
            MaterializationContext materializationContext1;
            IEntityType entityType1;
            Customer instance1;
            InternalEntityEntry entry1;
            bool hasNullKey1;
            materializationContext1 = new MaterializationContext(
                [LIFTABLE Constant: ValueBuffer | Resolver: _ => (object)ValueBuffer.Empty], 
                queryContext.Context
            );
            instance1 = default(Customer);
            entry1 = queryContext.TryGetEntry(
                key: [LIFTABLE Constant: Key: Customer.Id PK | Resolver: c => c.Dependencies.Model.FindEntityType("BillingSystem.Domain.Entities.Customer").FindPrimaryKey()], 
                keyValues: new object[]{ (object)dataReader.GetInt64(0) }, 
                throwOnNullKey: True, 
                hasNullKey: hasNullKey1);
            !(hasNullKey1) ? entry1 != default(InternalEntityEntry) ? 
            {
                entityType1 = entry1.EntityType;
                return instance1 = (Customer)entry1.Entity;
            } : 
            {
                ISnapshot shadowSnapshot1;
                shadowSnapshot1 = [LIFTABLE Constant: Snapshot | Resolver: _ => Snapshot.Empty];
                entityType1 = [LIFTABLE Constant: EntityType: Customer | Resolver: namelessParameter{0} => namelessParameter{0}.Dependencies.Model.FindEntityType("BillingSystem.Domain.Entities.Customer")];
                instance1 = switch (entityType1)
                {
                    case [LIFTABLE Constant: EntityType: Customer | Resolver: namelessParameter{1} => namelessParameter{1}.Dependencies.Model.FindEntityType("BillingSystem.Domain.Entities.Customer")]: 
                        {
                            return 
                            {
                                Customer instance;
                                instance = new Customer();
                                instance.<Id>k__BackingField = dataReader.GetInt64(0);
                                instance.<AddressBuildingNumber>k__BackingField = dataReader.IsDBNull(1) ? default(string) : dataReader.GetString(1);
                                instance.<AddressCity>k__BackingField = dataReader.GetString(2);
                                instance.<AddressCountry>k__BackingField = dataReader.GetString(3);
                                instance.<AddressDistrict>k__BackingField = dataReader.GetString(4);
                                instance.<AddressPostalCode>k__BackingField = dataReader.GetString(5);
                                instance.<AddressStreet>k__BackingField = dataReader.IsDBNull(6) ? default(string) : dataReader.GetString(6);
                                instance.<AddressSubNumber>k__BackingField = dataReader.IsDBNull(7) ? default(string) : dataReader.GetString(7);
                                instance.<CreatedBy>k__BackingField = dataReader.GetString(8);
                                instance.<CreatedDate>k__BackingField = dataReader.GetDateTime(9);
                                instance.<CustomerType>k__BackingField = dataReader.GetString(10);
                                instance.<EmailAddress>k__BackingField = dataReader.IsDBNull(11) ? default(string) : dataReader.GetString(11);
                                instance.<FullName>k__BackingField = dataReader.GetString(12);
                                instance.<IdentityNumber>k__BackingField = dataReader.GetString(13);
                                instance.<IdentityType>k__BackingField = dataReader.IsDBNull(14) ? default(int?) : (int?)dataReader.GetInt32(14);
                                instance.<IsDeleted>k__BackingField = dataReader.GetBoolean(15);
                                instance.<LastUpdatedDate>k__BackingField = dataReader.IsDBNull(16) ? default(DateTime?) : (DateTime?)dataReader.GetDateTime(16);
                                instance.<OverpaymentBalance>k__BackingField = dataReader.IsDBNull(17) ? default(decimal?) : (decimal?)dataReader.GetDecimal(17);
                                instance.<PhoneNumber>k__BackingField = dataReader.IsDBNull(18) ? default(string) : dataReader.GetString(18);
                                instance.<Vatnumber>k__BackingField = dataReader.IsDBNull(19) ? default(string) : dataReader.GetString(19);
                                (instance is IInjectableService) ? ((IInjectableService)instance).Injected(
                                    context: materializationContext1.Context, 
                                    entity: instance, 
                                    queryTrackingBehavior: TrackAll, 
                                    structuralType: [LIFTABLE Constant: EntityType: Customer | Resolver: namelessParameter{2} => namelessParameter{2}.Dependencies.Model.FindEntityType("BillingSystem.Domain.Entities.Customer")]) : default(void);
                                return instance;
                            }}
                    default: 
                        default(Customer)
                }
                ;
                entry1 = entityType1 == default(IEntityType) ? default(InternalEntityEntry) : queryContext.StartTracking(
                    entityType: entityType1, 
                    entity: instance1, 
                    snapshot: shadowSnapshot1);
                return instance1;
            } : default(void);
            return instance1;
        };
        return entity;
    }, 
    contextType: BillingSystem.Infrastructure.EF.BillingServiceDBContext, 
    standAloneStateManager: False, 
    detailedErrorsEnabled: False, 
    threadSafetyChecksEnabled: True)
    .SingleOrDefault()'
2025-12-03 17:32:49.416 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-12-03 17:32:49.420 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (3ms).
2025-12-03 17:32:49.425 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (9ms).
2025-12-03 17:32:49.428 +03:00 [DBG] Executing DbCommand [Parameters=[@__cutomerIdentityNumber_0='?' (Size = 100)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[Id], [c].[Address_BuildingNumber], [c].[Address_City], [c].[Address_Country], [c].[Address_District], [c].[Address_PostalCode], [c].[Address_Street], [c].[Address_SubNumber], [c].[CreatedBy], [c].[CreatedDate], [c].[CustomerType], [c].[EmailAddress], [c].[FullName], [c].[IdentityNumber], [c].[IdentityType], [c].[IsDeleted], [c].[LastUpdatedDate], [c].[OverpaymentBalance], [c].[PhoneNumber], [c].[VATNumber]
FROM [Customers] AS [c]
WHERE [c].[IdentityNumber] = @__cutomerIdentityNumber_0
2025-12-03 17:32:49.452 +03:00 [INF] Executed DbCommand (24ms) [Parameters=[@__cutomerIdentityNumber_0='?' (Size = 100)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[Id], [c].[Address_BuildingNumber], [c].[Address_City], [c].[Address_Country], [c].[Address_District], [c].[Address_PostalCode], [c].[Address_Street], [c].[Address_SubNumber], [c].[CreatedBy], [c].[CreatedDate], [c].[CustomerType], [c].[EmailAddress], [c].[FullName], [c].[IdentityNumber], [c].[IdentityType], [c].[IsDeleted], [c].[LastUpdatedDate], [c].[OverpaymentBalance], [c].[PhoneNumber], [c].[VATNumber]
FROM [Customers] AS [c]
WHERE [c].[IdentityNumber] = @__cutomerIdentityNumber_0
2025-12-03 17:32:49.491 +03:00 [DBG] Context 'BillingServiceDBContext' started tracking 'Customer' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-12-03 17:32:49.555 +03:00 [DBG] Closing data reader to 'GAC-BillingService' on server '.'.
2025-12-03 17:32:49.560 +03:00 [DBG] A data reader for 'GAC-BillingService' on server '.' is being disposed after spending 101ms reading results.
2025-12-03 17:32:49.631 +03:00 [DBG] 'BillingServiceDBContext' generated a temporary value for the property 'Invoice.Id'. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-12-03 17:32:49.783 +03:00 [DBG] Context 'BillingServiceDBContext' started tracking 'Invoice' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-12-03 17:32:49.793 +03:00 [DBG] 'BillingServiceDBContext' generated a temporary value for the property 'InvoicesAttachment.Id'. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-12-03 17:32:49.814 +03:00 [DBG] The navigation 'InvoicesAttachment.Invoice' was detected as changed. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-12-03 17:32:49.822 +03:00 [DBG] Context 'BillingServiceDBContext' started tracking 'InvoicesAttachment' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-12-03 17:32:49.830 +03:00 [DBG] 'BillingServiceDBContext' generated a temporary value for the property 'InvoicesItem.Id'. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-12-03 17:32:49.853 +03:00 [DBG] The navigation 'InvoicesItem.Invoice' was detected as changed. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-12-03 17:32:49.861 +03:00 [DBG] Context 'BillingServiceDBContext' started tracking 'InvoicesItem' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-12-03 17:32:49.872 +03:00 [DBG] SaveChanges starting for 'BillingServiceDBContext'.
2025-12-03 17:32:49.883 +03:00 [DBG] DetectChanges starting for 'BillingServiceDBContext'.
2025-12-03 17:32:49.987 +03:00 [DBG] DetectChanges completed for 'BillingServiceDBContext'.
2025-12-03 17:32:50.122 +03:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-12-03 17:32:50.127 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-12-03 17:32:50.129 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (2ms).
2025-12-03 17:32:50.134 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (7ms).
2025-12-03 17:32:50.139 +03:00 [DBG] Executing DbCommand [Parameters=[@p0='?' (Precision = 18) (DbType = Decimal), @p1='?' (Size = 3000), @p2='?' (Size = 100), @p3='?' (Size = 50), @p4='?' (DbType = DateTime), @p5='?' (Size = 50), @p6='?' (DbType = Int64), @p7='?' (DbType = Int64), @p8='?' (DbType = DateTime), @p9='?' (DbType = Guid), @p10='?' (Size = 50), @p11='?' (DbType = Int32), @p12='?' (DbType = Int32), @p13='?' (DbType = Boolean), @p14='?' (DbType = Boolean), @p15='?' (DbType = Boolean), @p16='?' (DbType = Boolean), @p17='?' (DbType = DateTime), @p18='?' (DbType = DateTime), @p19='?' (Size = 4000), @p20='?' (Size = 100), @p21='?' (Size = 100), @p22='?' (DbType = Int64), @p23='?' (Size = 4000), @p24='?' (DbType = Int64), @p25='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [Invoices] ([Amount], [CancelationReasons], [ClientReferenceNumber], [CreatedBy], [CreatedDate], [Currency], [CustomerID], [DiscountedPrimaryInvoiceID], [DueAt], [ExternalId], [InvoiceNumber], [InvoiceStatus], [InvoiceType], [IsDeleted], [IsDiscounted], [IsSubInvoice], [IsSubstitution], [IssuedAt], [LastUpdatedDate], [Metadata], [PaymentProvider], [PaymentReference], [PrimaryInvoiceID], [ProviderResponse], [SubstitutionPrimaryInvoiceID], [TenantId])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18, @p19, @p20, @p21, @p22, @p23, @p24, @p25);
2025-12-03 17:32:50.161 +03:00 [INF] Executed DbCommand (24ms) [Parameters=[@p0='?' (Precision = 18) (DbType = Decimal), @p1='?' (Size = 3000), @p2='?' (Size = 100), @p3='?' (Size = 50), @p4='?' (DbType = DateTime), @p5='?' (Size = 50), @p6='?' (DbType = Int64), @p7='?' (DbType = Int64), @p8='?' (DbType = DateTime), @p9='?' (DbType = Guid), @p10='?' (Size = 50), @p11='?' (DbType = Int32), @p12='?' (DbType = Int32), @p13='?' (DbType = Boolean), @p14='?' (DbType = Boolean), @p15='?' (DbType = Boolean), @p16='?' (DbType = Boolean), @p17='?' (DbType = DateTime), @p18='?' (DbType = DateTime), @p19='?' (Size = 4000), @p20='?' (Size = 100), @p21='?' (Size = 100), @p22='?' (DbType = Int64), @p23='?' (Size = 4000), @p24='?' (DbType = Int64), @p25='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [Invoices] ([Amount], [CancelationReasons], [ClientReferenceNumber], [CreatedBy], [CreatedDate], [Currency], [CustomerID], [DiscountedPrimaryInvoiceID], [DueAt], [ExternalId], [InvoiceNumber], [InvoiceStatus], [InvoiceType], [IsDeleted], [IsDiscounted], [IsSubInvoice], [IsSubstitution], [IssuedAt], [LastUpdatedDate], [Metadata], [PaymentProvider], [PaymentReference], [PrimaryInvoiceID], [ProviderResponse], [SubstitutionPrimaryInvoiceID], [TenantId])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18, @p19, @p20, @p21, @p22, @p23, @p24, @p25);
2025-12-03 17:32:50.190 +03:00 [DBG] The foreign key property 'Invoice.Id' was detected as changed. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see property values.
2025-12-03 17:32:50.199 +03:00 [DBG] The foreign key property 'InvoicesAttachment.InvoiceId' was detected as changed. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see property values.
2025-12-03 17:32:50.206 +03:00 [DBG] The foreign key property 'InvoicesItem.InvoiceId' was detected as changed. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see property values.
2025-12-03 17:32:50.211 +03:00 [DBG] Closing data reader to 'GAC-BillingService' on server '.'.
2025-12-03 17:32:50.215 +03:00 [DBG] A data reader for 'GAC-BillingService' on server '.' is being disposed after spending 43ms reading results.
2025-12-03 17:32:50.223 +03:00 [DBG] Executing 2 update commands as a batch.
2025-12-03 17:32:50.226 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-12-03 17:32:50.228 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (2ms).
2025-12-03 17:32:50.230 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (4ms).
2025-12-03 17:32:50.233 +03:00 [DBG] Executing DbCommand [Parameters=[@p26='?' (Size = 50), @p27='?' (DbType = DateTime), @p28='?' (Size = 200), @p29='?' (DbType = Int64), @p30='?' (DbType = Boolean), @p31='?' (Precision = 18) (DbType = Decimal), @p32='?' (Size = 50), @p33='?' (DbType = DateTime), @p34='?' (DbType = Int64), @p35='?' (DbType = Boolean), @p36='?' (Size = 500), @p37='?' (Size = 200), @p38='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SET NOCOUNT ON;
INSERT INTO [InvoicesAttachments] ([CreatedBy], [CreatedDate], [FileName], [InvoiceId], [IsDeleted])
OUTPUT INSERTED.[Id]
VALUES (@p26, @p27, @p28, @p29, @p30);
INSERT INTO [InvoicesItems] ([Amount], [CreatedBy], [CreatedDate], [InvoiceId], [IsDeleted], [ItemDesc], [ItemName], [Quantity])
OUTPUT INSERTED.[Id]
VALUES (@p31, @p32, @p33, @p34, @p35, @p36, @p37, @p38);
2025-12-03 17:32:50.245 +03:00 [INF] Executed DbCommand (12ms) [Parameters=[@p26='?' (Size = 50), @p27='?' (DbType = DateTime), @p28='?' (Size = 200), @p29='?' (DbType = Int64), @p30='?' (DbType = Boolean), @p31='?' (Precision = 18) (DbType = Decimal), @p32='?' (Size = 50), @p33='?' (DbType = DateTime), @p34='?' (DbType = Int64), @p35='?' (DbType = Boolean), @p36='?' (Size = 500), @p37='?' (Size = 200), @p38='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SET NOCOUNT ON;
INSERT INTO [InvoicesAttachments] ([CreatedBy], [CreatedDate], [FileName], [InvoiceId], [IsDeleted])
OUTPUT INSERTED.[Id]
VALUES (@p26, @p27, @p28, @p29, @p30);
INSERT INTO [InvoicesItems] ([Amount], [CreatedBy], [CreatedDate], [InvoiceId], [IsDeleted], [ItemDesc], [ItemName], [Quantity])
OUTPUT INSERTED.[Id]
VALUES (@p31, @p32, @p33, @p34, @p35, @p36, @p37, @p38);
2025-12-03 17:32:50.250 +03:00 [DBG] The foreign key property 'InvoicesAttachment.Id' was detected as changed. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see property values.
2025-12-03 17:32:50.253 +03:00 [DBG] The foreign key property 'InvoicesItem.Id' was detected as changed. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see property values.
2025-12-03 17:32:50.257 +03:00 [DBG] Closing data reader to 'GAC-BillingService' on server '.'.
2025-12-03 17:32:50.260 +03:00 [DBG] A data reader for 'GAC-BillingService' on server '.' is being disposed after spending 10ms reading results.
2025-12-03 17:32:50.275 +03:00 [DBG] An entity of type 'Invoice' tracked by 'BillingServiceDBContext' changed state from '"Added"' to '"Unchanged"'. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-12-03 17:32:50.282 +03:00 [DBG] An entity of type 'InvoicesAttachment' tracked by 'BillingServiceDBContext' changed state from '"Added"' to '"Unchanged"'. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-12-03 17:32:50.287 +03:00 [DBG] An entity of type 'InvoicesItem' tracked by 'BillingServiceDBContext' changed state from '"Added"' to '"Unchanged"'. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-12-03 17:32:50.293 +03:00 [DBG] SaveChanges completed for 'BillingServiceDBContext' with 3 entities written to the database.
2025-12-03 17:32:50.318 +03:00 [DBG] 'BillingServiceDBContext' generated a temporary value for the property 'OutboxEvent.Id'. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-12-03 17:32:50.342 +03:00 [DBG] Context 'BillingServiceDBContext' started tracking 'OutboxEvent' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-12-03 17:32:50.348 +03:00 [DBG] 'BillingServiceDBContext' generated a temporary value for the property 'AuditEvent.Id'. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-12-03 17:32:50.371 +03:00 [DBG] Context 'BillingServiceDBContext' started tracking 'AuditEvent' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-12-03 17:32:50.375 +03:00 [DBG] SaveChanges starting for 'BillingServiceDBContext'.
2025-12-03 17:32:50.378 +03:00 [DBG] DetectChanges starting for 'BillingServiceDBContext'.
2025-12-03 17:32:50.395 +03:00 [DBG] DetectChanges completed for 'BillingServiceDBContext'.
2025-12-03 17:32:50.399 +03:00 [DBG] Executing 2 update commands as a batch.
2025-12-03 17:32:50.401 +03:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-12-03 17:32:50.403 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-12-03 17:32:50.406 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (2ms).
2025-12-03 17:32:50.409 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (5ms).
2025-12-03 17:32:50.411 +03:00 [DBG] Executing DbCommand [Parameters=[@p0='?' (Size = 100), @p1='?' (Size = 4000), @p2='?' (Size = 50), @p3='?' (DbType = DateTime), @p4='?' (Size = 500), @p5='?' (Size = 20), @p6='?' (Size = 100), @p7='?' (Size = 100), @p8='?' (DbType = Int64), @p9='?' (DbType = DateTime), @p10='?' (Size = 4000), @p11='?' (Size = 300), @p12='?' (Size = 4000), @p13='?' (DbType = Boolean), @p14='?' (Size = 20) (DbType = AnsiString)], CommandType='"Text"', CommandTimeout='30']
SET NOCOUNT ON;
INSERT INTO [audit].[AuditEvents] ([Action], [Changes], [CreatedBy], [CreatedDate], [Description], [EntityId], [EntityType], [UserId])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
INSERT INTO [Outbox_events] ([Aggregate_id], [CreatedDate], [ErrorMsg], [Event_type], [Payload], [Processed], [ProcessingStatus])
OUTPUT INSERTED.[Id]
VALUES (@p8, @p9, @p10, @p11, @p12, @p13, @p14);
2025-12-03 17:32:50.427 +03:00 [INF] Executed DbCommand (16ms) [Parameters=[@p0='?' (Size = 100), @p1='?' (Size = 4000), @p2='?' (Size = 50), @p3='?' (DbType = DateTime), @p4='?' (Size = 500), @p5='?' (Size = 20), @p6='?' (Size = 100), @p7='?' (Size = 100), @p8='?' (DbType = Int64), @p9='?' (DbType = DateTime), @p10='?' (Size = 4000), @p11='?' (Size = 300), @p12='?' (Size = 4000), @p13='?' (DbType = Boolean), @p14='?' (Size = 20) (DbType = AnsiString)], CommandType='"Text"', CommandTimeout='30']
SET NOCOUNT ON;
INSERT INTO [audit].[AuditEvents] ([Action], [Changes], [CreatedBy], [CreatedDate], [Description], [EntityId], [EntityType], [UserId])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
INSERT INTO [Outbox_events] ([Aggregate_id], [CreatedDate], [ErrorMsg], [Event_type], [Payload], [Processed], [ProcessingStatus])
OUTPUT INSERTED.[Id]
VALUES (@p8, @p9, @p10, @p11, @p12, @p13, @p14);
2025-12-03 17:32:50.433 +03:00 [DBG] The foreign key property 'AuditEvent.Id' was detected as changed. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see property values.
2025-12-03 17:32:50.437 +03:00 [DBG] The foreign key property 'OutboxEvent.Id' was detected as changed. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see property values.
2025-12-03 17:32:50.440 +03:00 [DBG] Closing data reader to 'GAC-BillingService' on server '.'.
2025-12-03 17:32:50.445 +03:00 [DBG] A data reader for 'GAC-BillingService' on server '.' is being disposed after spending 14ms reading results.
2025-12-03 17:32:50.450 +03:00 [DBG] An entity of type 'AuditEvent' tracked by 'BillingServiceDBContext' changed state from '"Added"' to '"Unchanged"'. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-12-03 17:32:50.456 +03:00 [DBG] An entity of type 'OutboxEvent' tracked by 'BillingServiceDBContext' changed state from '"Added"' to '"Unchanged"'. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-12-03 17:32:50.461 +03:00 [DBG] SaveChanges completed for 'BillingServiceDBContext' with 2 entities written to the database.
2025-12-03 17:32:50.468 +03:00 [DBG] Committing transaction.
2025-12-03 17:32:50.485 +03:00 [DBG] Committed transaction.
2025-12-03 17:32:50.493 +03:00 [DBG] Closing connection to database 'GAC-BillingService' on server '.'.
2025-12-03 17:32:50.497 +03:00 [DBG] Closed connection to database 'GAC-BillingService' on server '.' (3ms).
2025-12-03 17:32:50.505 +03:00 [DBG] Disposing transaction.
2025-12-03 17:32:50.538 +03:00 [DBG] List of registered output formatters, in the following order: ["Microsoft.AspNetCore.Mvc.Formatters.HttpNoContentOutputFormatter","Microsoft.AspNetCore.Mvc.Formatters.StringOutputFormatter","Microsoft.AspNetCore.Mvc.Formatters.StreamOutputFormatter","Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonOutputFormatter"]
2025-12-03 17:32:50.560 +03:00 [DBG] No information found on request to perform content negotiation.
2025-12-03 17:32:50.567 +03:00 [DBG] Attempting to select the first output formatter in the output formatters list which supports a content type from the explicitly specified content types '["application/json"]'.
2025-12-03 17:32:50.580 +03:00 [DBG] Selected output formatter 'Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonOutputFormatter' and content type 'application/json' to write the response.
2025-12-03 17:32:50.588 +03:00 [INF] Executing OkObjectResult, writing value of type 'BillingSystem.SharedKernel.ApiResponse`1[[System.Int64, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-12-03 17:32:50.616 +03:00 [INF] Executed action BillingSystem.API.Controllers.InvoicesController.Post (BillingSystem.API) in 4051.3275ms
2025-12-03 17:32:50.621 +03:00 [INF] Executed endpoint 'BillingSystem.API.Controllers.InvoicesController.Post (BillingSystem.API)'
2025-12-03 17:32:50.625 +03:00 [INF] HTTP POST /api/Invoices/Post responded 200 in 9763.4756 ms
2025-12-03 17:32:50.630 +03:00 [DBG] Connection id "0HNHIF2RNBHLE" completed keep alive response.
2025-12-03 17:32:50.637 +03:00 [DBG] 'BillingServiceDBContext' disposed.
2025-12-03 17:32:50.645 +03:00 [DBG] Disposing connection to database 'GAC-BillingService' on server '.'.
2025-12-03 17:32:50.651 +03:00 [DBG] Disposed connection to database '' on server '' (5ms).
2025-12-03 17:32:50.656 +03:00 [INF] Request finished HTTP/1.1 POST https://localhost:7257/api/Invoices/Post - 200 null application/json; charset=utf-8 9823.8952ms
2025-12-03 17:37:20.761 +03:00 [DBG] Connection id "0HNHIF2RNBHLC" received FIN.
2025-12-03 18:37:56.608 +03:00 [DBG] Connection id "0HNHIF2RNBHLC" is closed. The last processed stream ID was 7.
2025-12-03 18:37:56.609 +03:00 [DBG] The connection queue processing loop for 0HNHIF2RNBHLC completed.
2025-12-03 18:37:57.338 +03:00 [DBG] Connection id "0HNHIF2RNBHLC" sending FIN because: "The Socket transport's send loop completed gracefully."
2025-12-03 18:37:58.243 +03:00 [DBG] Connection id "0HNHIF2RNBHLC" stopped.
