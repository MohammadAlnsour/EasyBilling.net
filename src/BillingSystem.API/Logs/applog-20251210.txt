2025-12-10 10:28:34.766 +03:00 [DBG] Registered model binder providers, in the following order: ["Microsoft.AspNetCore.Mvc.ModelBinding.Binders.BinderTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ServicesModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.BodyModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.HeaderModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FloatingPointTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.EnumTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.DateTimeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.SimpleTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.TryParseModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.CancellationTokenModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ByteArrayModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FormFileModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FormCollectionModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.KeyValuePairModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.DictionaryModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ArrayModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.CollectionModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ComplexObjectModelBinderProvider"]
2025-12-10 10:28:34.965 +03:00 [DBG] Hosting starting
2025-12-10 10:28:35.441 +03:00 [DBG] Starting bus instances: IBus
2025-12-10 10:28:35.451 +03:00 [DBG] Starting bus: "rabbitmq://localhost/"
2025-12-10 10:28:35.484 +03:00 [DBG] Middleware loaded
2025-12-10 10:28:35.488 +03:00 [DBG] Middleware loaded. Script /_framework/aspnetcore-browser-refresh.js (16519 B).
2025-12-10 10:28:35.506 +03:00 [DBG] Middleware loaded. Script /_framework/blazor-hotreload.js (799 B).
2025-12-10 10:28:35.510 +03:00 [DBG] Connect: guest@localhost:5672/
2025-12-10 10:28:35.680 +03:00 [DBG] Middleware loaded: DOTNET_MODIFIABLE_ASSEMBLIES=debug, __ASPNETCORE_BROWSER_TOOLS=true
2025-12-10 10:28:35.681 +03:00 [DBG] Connected: guest@localhost:5672/ (address: amqp://localhost:5672, local: 53572)
2025-12-10 10:28:35.737 +03:00 [DBG] Endpoint Ready: "rabbitmq://localhost/ECHGHANNAMLP1_BillingSystemAPI_bus_zd9yyyyh3bcsy9fjbdxdxxp4fc?temporary=true"
2025-12-10 10:28:35.742 +03:00 [INF] Bus started: "rabbitmq://localhost/"
2025-12-10 10:28:35.958 +03:00 [INF] Now listening on: https://localhost:7257
2025-12-10 10:28:35.962 +03:00 [INF] Now listening on: http://localhost:5009
2025-12-10 10:28:35.964 +03:00 [DBG] Loaded hosting startup assembly BillingSystem.API
2025-12-10 10:28:35.966 +03:00 [DBG] Loaded hosting startup assembly Microsoft.WebTools.ApiEndpointDiscovery
2025-12-10 10:28:35.968 +03:00 [DBG] Loaded hosting startup assembly Microsoft.AspNetCore.Watch.BrowserRefresh
2025-12-10 10:28:35.971 +03:00 [DBG] Loaded hosting startup assembly Microsoft.WebTools.BrowserLink.Net
2025-12-10 10:28:36.047 +03:00 [DBG] Connection id "0HNHNNMTHGBAB" accepted.
2025-12-10 10:28:36.048 +03:00 [DBG] Connection id "0HNHNNMTHGBAC" accepted.
2025-12-10 10:28:36.052 +03:00 [DBG] Connection id "0HNHNNMTHGBAB" started.
2025-12-10 10:28:36.053 +03:00 [DBG] Connection id "0HNHNNMTHGBAC" started.
2025-12-10 10:28:36.065 +03:00 [DBG] Connection id "0HNHNNMTHGBAC" received FIN.
2025-12-10 10:28:36.065 +03:00 [DBG] Connection id "0HNHNNMTHGBAB" received FIN.
2025-12-10 10:28:36.091 +03:00 [DBG] Failed to authenticate HTTPS connection.
System.IO.IOException: Received an unexpected EOF or 0 bytes from the transport stream.
   at System.Net.Security.SslStream.ReceiveHandshakeFrameAsync[TIOAdapter](CancellationToken cancellationToken)
   at System.Net.Security.SslStream.ForceAuthenticationAsync[TIOAdapter](Boolean receiveFirst, Byte[] reAuthenticationData, CancellationToken cancellationToken)
   at System.Net.Security.SslStream.ProcessAuthenticationWithTelemetryAsync(Boolean isAsync, CancellationToken cancellationToken)
   at Microsoft.AspNetCore.Server.Kestrel.Https.Internal.HttpsConnectionMiddleware.OnConnectionAsync(ConnectionContext context)
2025-12-10 10:28:36.091 +03:00 [DBG] Failed to authenticate HTTPS connection.
System.IO.IOException: Received an unexpected EOF or 0 bytes from the transport stream.
   at System.Net.Security.SslStream.ReceiveHandshakeFrameAsync[TIOAdapter](CancellationToken cancellationToken)
   at System.Net.Security.SslStream.ForceAuthenticationAsync[TIOAdapter](Boolean receiveFirst, Byte[] reAuthenticationData, CancellationToken cancellationToken)
   at System.Net.Security.SslStream.ProcessAuthenticationWithTelemetryAsync(Boolean isAsync, CancellationToken cancellationToken)
   at Microsoft.AspNetCore.Server.Kestrel.Https.Internal.HttpsConnectionMiddleware.OnConnectionAsync(ConnectionContext context)
2025-12-10 10:28:36.126 +03:00 [DBG] Connection id "0HNHNNMTHGBAC" stopped.
2025-12-10 10:28:36.128 +03:00 [DBG] Connection id "0HNHNNMTHGBAB" stopped.
2025-12-10 10:28:36.139 +03:00 [DBG] Connection id "0HNHNNMTHGBAB" sending FIN because: "The Socket transport's send loop completed gracefully."
2025-12-10 10:28:36.139 +03:00 [DBG] Connection id "0HNHNNMTHGBAC" sending FIN because: "The Socket transport's send loop completed gracefully."
2025-12-10 10:28:36.169 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-12-10 10:28:36.173 +03:00 [INF] Hosting environment: Development
2025-12-10 10:28:36.176 +03:00 [INF] Content root path: C:\Repositories\Gac-BillingSystem\src\BillingSystem.API
2025-12-10 10:28:36.178 +03:00 [DBG] Hosting started
2025-12-10 10:28:36.961 +03:00 [DBG] Connection id "0HNHNNMTHGBAD" accepted.
2025-12-10 10:28:36.970 +03:00 [DBG] Connection id "0HNHNNMTHGBAD" started.
2025-12-10 10:28:37.050 +03:00 [DBG] Connection 0HNHNNMTHGBAD established using the following protocol: "Tls13"
2025-12-10 10:28:37.131 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7257/swagger/index.html - null null
2025-12-10 10:28:37.196 +03:00 [DBG] Wildcard detected, all requests with hosts will be allowed.
2025-12-10 10:28:37.250 +03:00 [DBG] No candidates found for the request path '/swagger/index.html'
2025-12-10 10:28:37.254 +03:00 [DBG] Request did not match any endpoints
2025-12-10 10:28:37.347 +03:00 [DBG] Response markup is scheduled to include Browser Link script injection.
2025-12-10 10:28:37.351 +03:00 [DBG] Response markup is scheduled to include browser refresh script injection.
2025-12-10 10:28:37.381 +03:00 [INF] HTTP GET /swagger/index.html responded 200 in 116.7664 ms
2025-12-10 10:28:37.390 +03:00 [DBG] Response markup was updated to include Browser Link script injection.
2025-12-10 10:28:37.393 +03:00 [DBG] Response markup was updated to include browser refresh script injection.
2025-12-10 10:28:37.401 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7257/swagger/index.html - 200 null text/html;charset=utf-8 282.6427ms
2025-12-10 10:28:37.436 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7257/_framework/aspnetcore-browser-refresh.js - null null
2025-12-10 10:28:37.453 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7257/_vs/browserLink - null null
2025-12-10 10:28:37.454 +03:00 [DBG] Script injected: /_framework/aspnetcore-browser-refresh.js
2025-12-10 10:28:37.467 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7257/_framework/aspnetcore-browser-refresh.js - 200 16519 application/javascript; charset=utf-8 30.444ms
2025-12-10 10:28:37.526 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7257/_vs/browserLink - 200 null text/javascript; charset=UTF-8 72.4082ms
2025-12-10 10:28:37.613 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7257/swagger/v1/swagger.json - null null
2025-12-10 10:28:37.621 +03:00 [DBG] No candidates found for the request path '/swagger/v1/swagger.json'
2025-12-10 10:28:37.624 +03:00 [DBG] Request did not match any endpoints
2025-12-10 10:28:37.648 +03:00 [INF] HTTP GET /swagger/v1/swagger.json responded 200 in 19.8987 ms
2025-12-10 10:28:37.660 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7257/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 47.4141ms
2025-12-10 10:29:12.486 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7257/health - null null
2025-12-10 10:29:12.508 +03:00 [DBG] 1 candidate(s) found for the request path '/health'
2025-12-10 10:29:12.513 +03:00 [DBG] Request matched endpoint 'HTTP: GET /health'
2025-12-10 10:29:12.522 +03:00 [DBG] Static files was skipped as the request already matched an endpoint.
2025-12-10 10:29:12.618 +03:00 [WRN] x-idempotent-key header not found in the request.
2025-12-10 10:29:12.623 +03:00 [WRN] x-Correlation-Id header not found in the request.
2025-12-10 10:29:12.996 +03:00 [DBG] An 'IServiceProvider' was created for internal use by Entity Framework.
2025-12-10 10:29:18.294 +03:00 [INF] HTTP GET /health 400 in 5760ms
CorrelationId: 1fffe3b8-b701-4dce-af1d-8bbf1e1d52a2
Request: 
Response: x-tenant-id header not foundInvalid x-tenant-id header.
2025-12-10 10:29:18.303 +03:00 [INF] HTTP GET /health responded 400 in 5783.9305 ms
2025-12-10 10:29:18.312 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7257/health - 400 null null 5825.5629ms
2025-12-10 10:31:36.250 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7257/health - null null
2025-12-10 10:31:36.257 +03:00 [DBG] 1 candidate(s) found for the request path '/health'
2025-12-10 10:31:36.260 +03:00 [DBG] Request matched endpoint 'HTTP: GET /health'
2025-12-10 10:31:36.264 +03:00 [DBG] Static files was skipped as the request already matched an endpoint.
2025-12-10 10:31:36.266 +03:00 [WRN] x-idempotent-key header not found in the request.
2025-12-10 10:31:36.268 +03:00 [WRN] x-Correlation-Id header not found in the request.
2025-12-10 10:31:36.281 +03:00 [INF] HTTP GET /health 400 in 14ms
CorrelationId: 8640aa71-bc11-4b62-a2c9-2d2b0bd8b00b
Request: 
Response: x-tenant-id header not foundInvalid x-tenant-id header.
2025-12-10 10:31:36.289 +03:00 [INF] HTTP GET /health responded 400 in 25.2331 ms
2025-12-10 10:31:36.301 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7257/health - 400 null null 51.936ms
2025-12-10 10:55:28.891 +03:00 [DBG] Connection id "0HNHNNMTHGBAE" accepted.
2025-12-10 10:55:28.895 +03:00 [DBG] Connection id "0HNHNNMTHGBAE" received FIN.
2025-12-10 10:55:28.897 +03:00 [DBG] Connection id "0HNHNNMTHGBAF" accepted.
2025-12-10 10:55:28.897 +03:00 [DBG] Connection id "0HNHNNMTHGBAE" started.
2025-12-10 10:55:28.909 +03:00 [DBG] Connection id "0HNHNNMTHGBAF" started.
2025-12-10 10:55:28.913 +03:00 [DBG] Failed to authenticate HTTPS connection.
System.IO.IOException: Received an unexpected EOF or 0 bytes from the transport stream.
   at System.Net.Security.SslStream.ReceiveHandshakeFrameAsync[TIOAdapter](CancellationToken cancellationToken)
   at System.Net.Security.SslStream.ForceAuthenticationAsync[TIOAdapter](Boolean receiveFirst, Byte[] reAuthenticationData, CancellationToken cancellationToken)
   at System.Net.Security.SslStream.ProcessAuthenticationWithTelemetryAsync(Boolean isAsync, CancellationToken cancellationToken)
   at Microsoft.AspNetCore.Server.Kestrel.Https.Internal.HttpsConnectionMiddleware.OnConnectionAsync(ConnectionContext context)
2025-12-10 10:55:28.919 +03:00 [DBG] Connection id "0HNHNNMTHGBAE" stopped.
2025-12-10 10:55:28.922 +03:00 [DBG] Connection id "0HNHNNMTHGBAE" sending FIN because: "The Socket transport's send loop completed gracefully."
2025-12-10 10:55:28.922 +03:00 [DBG] Connection 0HNHNNMTHGBAF established using the following protocol: "Tls13"
2025-12-10 10:55:28.932 +03:00 [INF] Request starting HTTP/1.1 POST https://localhost:7257/api/Invoices/Post - application/json 1538
2025-12-10 10:55:28.938 +03:00 [DBG] 1 candidate(s) found for the request path '/api/Invoices/Post'
2025-12-10 10:55:28.946 +03:00 [DBG] Endpoint 'BillingSystem.API.Controllers.InvoicesController.Post (BillingSystem.API)' with route pattern 'api/Invoices/Post' is valid for the request path '/api/Invoices/Post'
2025-12-10 10:55:28.951 +03:00 [DBG] Request matched endpoint 'BillingSystem.API.Controllers.InvoicesController.Post (BillingSystem.API)'
2025-12-10 10:55:28.955 +03:00 [DBG] Static files was skipped as the request already matched an endpoint.
2025-12-10 10:55:28.960 +03:00 [DBG] Connection id "0HNHNNMTHGBAF", Request id "0HNHNNMTHGBAF:00000001": started reading request body.
2025-12-10 10:55:28.964 +03:00 [DBG] Connection id "0HNHNNMTHGBAF", Request id "0HNHNNMTHGBAF:00000001": done reading request body.
2025-12-10 10:55:29.617 +03:00 [INF] Executing endpoint 'BillingSystem.API.Controllers.InvoicesController.Post (BillingSystem.API)'
2025-12-10 10:55:29.702 +03:00 [INF] Route matched with {action = "Post", controller = "Invoices"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Post(BillingSystem.Application.Requests.CreateInvoiceRequest) on controller BillingSystem.API.Controllers.InvoicesController (BillingSystem.API).
2025-12-10 10:55:29.714 +03:00 [DBG] Execution plan of authorization filters (in the following order): ["None"]
2025-12-10 10:55:29.721 +03:00 [DBG] Execution plan of resource filters (in the following order): ["None"]
2025-12-10 10:55:29.726 +03:00 [DBG] Execution plan of action filters (in the following order): ["Microsoft.AspNetCore.Mvc.ModelBinding.UnsupportedContentTypeFilter (Order: -3000)","Microsoft.AspNetCore.Mvc.Infrastructure.ModelStateInvalidFilter (Order: -2000)","BillingSystem.API.ActionFilters.IdempotencyFilter (Order: 0)"]
2025-12-10 10:55:29.733 +03:00 [DBG] Execution plan of exception filters (in the following order): ["None"]
2025-12-10 10:55:29.737 +03:00 [DBG] Execution plan of result filters (in the following order): ["Microsoft.AspNetCore.Mvc.Infrastructure.ClientErrorResultFilter (Order: -2000)","Microsoft.AspNetCore.Mvc.ProducesAttribute (Order: 0)","BillingSystem.API.ActionFilters.IdempotencyFilter (Order: 0)"]
2025-12-10 10:55:29.743 +03:00 [DBG] Executing controller factory for controller BillingSystem.API.Controllers.InvoicesController (BillingSystem.API)
2025-12-10 10:55:29.749 +03:00 [WRN] You do not have a valid license key for the Lucky Penny software MediatR. This is allowed for development and testing scenarios. If you are running in production you are required to have a licensed version. Please visit https://luckypennysoftware.com to obtain a valid license.
2025-12-10 10:55:29.795 +03:00 [DBG] Executed controller factory for controller BillingSystem.API.Controllers.InvoicesController (BillingSystem.API)
2025-12-10 10:55:29.804 +03:00 [DBG] Attempting to bind parameter 'invoiceRequest' of type 'BillingSystem.Application.Requests.CreateInvoiceRequest' ...
2025-12-10 10:55:29.812 +03:00 [DBG] Attempting to bind parameter 'invoiceRequest' of type 'BillingSystem.Application.Requests.CreateInvoiceRequest' using the name '' in request data ...
2025-12-10 10:55:29.819 +03:00 [DBG] Selected input formatter 'Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonInputFormatter' for content type 'application/json'.
2025-12-10 10:55:29.901 +03:00 [DBG] JSON input formatter succeeded, deserializing to type 'BillingSystem.Application.Requests.CreateInvoiceRequest'
2025-12-10 10:55:29.904 +03:00 [DBG] Done attempting to bind parameter 'invoiceRequest' of type 'BillingSystem.Application.Requests.CreateInvoiceRequest'.
2025-12-10 10:55:29.908 +03:00 [DBG] Done attempting to bind parameter 'invoiceRequest' of type 'BillingSystem.Application.Requests.CreateInvoiceRequest'.
2025-12-10 10:55:29.910 +03:00 [DBG] Attempting to validate the bound parameter 'invoiceRequest' of type 'BillingSystem.Application.Requests.CreateInvoiceRequest' ...
2025-12-10 10:55:29.942 +03:00 [DBG] Done attempting to validate the bound parameter 'invoiceRequest' of type 'BillingSystem.Application.Requests.CreateInvoiceRequest'.
2025-12-10 10:55:30.336 +03:00 [DBG] No relationship from 'Invoice' to 'Invoice' has been configured by convention because there are multiple properties on one entity type - {'DiscountedPrimaryInvoice'} that could be matched with the properties on the other entity type - {'InverseDiscountedPrimaryInvoice', 'InversePrimaryInvoice', 'InverseSubstitutionPrimaryInvoice', 'PrimaryInvoice', 'SubstitutionPrimaryInvoice'}. This message can be disregarded if explicit configuration has been specified in 'OnModelCreating'.
2025-12-10 10:55:30.619 +03:00 [DBG] No relationship from 'Invoice' to 'Invoice' has been configured by convention because there are multiple properties on one entity type - {'DiscountedPrimaryInvoice'} that could be matched with the properties on the other entity type - {'InverseDiscountedPrimaryInvoice', 'InversePrimaryInvoice', 'InverseSubstitutionPrimaryInvoice', 'PrimaryInvoice', 'SubstitutionPrimaryInvoice'}. This message can be disregarded if explicit configuration has been specified in 'OnModelCreating'.
2025-12-10 10:55:30.631 +03:00 [DBG] No relationship from 'Invoice' to 'Invoice' has been configured by convention because there are multiple properties on one entity type - {'InversePrimaryInvoice'} that could be matched with the properties on the other entity type - {'InverseSubstitutionPrimaryInvoice', 'PrimaryInvoice', 'SubstitutionPrimaryInvoice'}. This message can be disregarded if explicit configuration has been specified in 'OnModelCreating'.
2025-12-10 10:55:30.638 +03:00 [DBG] No relationship from 'Invoice' to 'Invoice' has been configured by convention because there are multiple properties on one entity type - {'InversePrimaryInvoice'} that could be matched with the properties on the other entity type - {'InverseSubstitutionPrimaryInvoice', 'PrimaryInvoice', 'SubstitutionPrimaryInvoice'}. This message can be disregarded if explicit configuration has been specified in 'OnModelCreating'.
2025-12-10 10:55:31.016 +03:00 [DBG] Entity Framework Core 9.0.9 initialized 'BillingServiceDBContext' using provider 'Microsoft.EntityFrameworkCore.SqlServer:9.0.9' with options: EngineType=SqlServer 
2025-12-10 10:55:31.213 +03:00 [DBG] Compiling query expression: 
'DbSet<Invoice>()
    .AsNoTracking()
    .Any(inv => inv.ExternalId.ToString() == __idempotentKey_0)'
2025-12-10 10:55:31.574 +03:00 [DBG] Generated query execution expression: 
'queryContext => ShapedQueryCompilingExpressionVisitor.SingleAsync<bool>(
    asyncEnumerable: SingleQueryingEnumerable.Create<bool>(
        relationalQueryContext: (RelationalQueryContext)queryContext, 
        relationalCommandResolver: parameters => [LIFTABLE Constant: RelationalCommandCache.QueryExpression(
            Projection Mapping:
                EmptyProjectionMember -> 0
            SELECT EXISTS (
                SELECT 1
                FROM Invoices AS i
                WHERE COALESCE(CONVERT(varchar(36), i.ExternalId), '') == @__idempotentKey_0)) | Resolver: c => new RelationalCommandCache(
            c.Dependencies.MemoryCache, 
            c.RelationalDependencies.QuerySqlGeneratorFactory, 
            c.RelationalDependencies.RelationalParameterBasedSqlProcessorFactory, 
            Projection Mapping:
                EmptyProjectionMember -> 0
            SELECT EXISTS (
                SELECT 1
                FROM Invoices AS i
                WHERE COALESCE(CONVERT(varchar(36), i.ExternalId), '') == @__idempotentKey_0), 
            False, 
            new HashSet<string>(
                new string[]{ }, 
                StringComparer.Ordinal
            )
        )].GetRelationalCommandTemplate(parameters), 
        readerColumns: null, 
        shaper: (queryContext, dataReader, resultContext, resultCoordinator) => 
        {
            bool? value1;
            value1 = dataReader.IsDBNull(0) ? default(bool?) : (bool?)dataReader.GetBoolean(0);
            return (bool)value1;
        }, 
        contextType: BillingSystem.Infrastructure.EF.BillingServiceDBContext, 
        standAloneStateManager: False, 
        detailedErrorsEnabled: False, 
        threadSafetyChecksEnabled: True), 
    cancellationToken: queryContext.CancellationToken)'
2025-12-10 10:55:31.643 +03:00 [DBG] Creating DbConnection.
2025-12-10 10:55:31.670 +03:00 [DBG] Created DbConnection. (26ms).
2025-12-10 10:55:31.678 +03:00 [DBG] Opening connection to database 'GAC-BillingService' on server '.'.
2025-12-10 10:55:32.200 +03:00 [DBG] Opened connection to database 'GAC-BillingService' on server '.'.
2025-12-10 10:55:32.210 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-12-10 10:55:32.221 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (7ms).
2025-12-10 10:55:32.232 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (23ms).
2025-12-10 10:55:32.247 +03:00 [DBG] Executing DbCommand [Parameters=[@__idempotentKey_0='?' (Size = 36) (DbType = AnsiString)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [Invoices] AS [i]
        WHERE CONVERT(varchar(36), [i].[ExternalId]) = @__idempotentKey_0) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2025-12-10 10:55:32.399 +03:00 [INF] Executed DbCommand (155ms) [Parameters=[@__idempotentKey_0='?' (Size = 36) (DbType = AnsiString)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [Invoices] AS [i]
        WHERE CONVERT(varchar(36), [i].[ExternalId]) = @__idempotentKey_0) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2025-12-10 10:55:32.428 +03:00 [DBG] Closing data reader to 'GAC-BillingService' on server '.'.
2025-12-10 10:55:32.440 +03:00 [DBG] A data reader for 'GAC-BillingService' on server '.' is being disposed after spending 26ms reading results.
2025-12-10 10:55:32.447 +03:00 [DBG] Closing connection to database 'GAC-BillingService' on server '.'.
2025-12-10 10:55:32.461 +03:00 [DBG] Closed connection to database 'GAC-BillingService' on server '.' (13ms).
2025-12-10 10:55:32.632 +03:00 [WRN] You do not have a valid license key for the Lucky Penny software AutoMapper. This is allowed for development and testing scenarios. If you are running in production you are required to have a licensed version. Please visit https://luckypennysoftware.com to obtain a valid license.
2025-12-10 10:55:32.714 +03:00 [DBG] Opening connection to database 'GAC-BillingService' on server '.'.
2025-12-10 10:55:32.723 +03:00 [DBG] Opened connection to database 'GAC-BillingService' on server '.'.
2025-12-10 10:55:32.729 +03:00 [DBG] Beginning transaction with isolation level 'Unspecified'.
2025-12-10 10:55:32.743 +03:00 [DBG] Began transaction with isolation level 'ReadCommitted'.
2025-12-10 10:55:32.750 +03:00 [DBG] Compiling query expression: 
'DbSet<InvoiceSequenceValue>().FromSql(EXECUTE dbo.GetNextInvoiceNumber, __p_0)
'
2025-12-10 10:55:32.813 +03:00 [DBG] Generated query execution expression: 
'queryContext => FromSqlQueryingEnumerable.Create<InvoiceSequenceValue>(
    relationalQueryContext: (RelationalQueryContext)queryContext, 
    relationalCommandResolver: parameters => [LIFTABLE Constant: RelationalCommandCache.QueryExpression(
        Projection Mapping:
            EmptyProjectionMember -> Dictionary<IProperty, int> { [Property: InvoiceSequenceValue.Value (long) Required, 0] }
        SELECT b.Value
        FROM EXECUTE dbo.GetNextInvoiceNumber) | Resolver: c => new RelationalCommandCache(
        c.Dependencies.MemoryCache, 
        c.RelationalDependencies.QuerySqlGeneratorFactory, 
        c.RelationalDependencies.RelationalParameterBasedSqlProcessorFactory, 
        Projection Mapping:
            EmptyProjectionMember -> Dictionary<IProperty, int> { [Property: InvoiceSequenceValue.Value (long) Required, 0] }
        SELECT b.Value
        FROM EXECUTE dbo.GetNextInvoiceNumber, 
        False, 
        new HashSet<string>(
            new string[]{ }, 
            StringComparer.Ordinal
        )
    )].GetRelationalCommandTemplate(parameters), 
    readerColumns: null, 
    columnNames: [LIFTABLE Constant: string[] { "Value" } | Resolver: _ => new string[]{ "Value" }], 
    shaper: (queryContext, dataReader, indexMap) => 
    {
        InvoiceSequenceValue entity;
        entity = 
        {
            MaterializationContext materializationContext1;
            IEntityType entityType1;
            InvoiceSequenceValue instance1;
            materializationContext1 = new MaterializationContext(
                [LIFTABLE Constant: ValueBuffer | Resolver: _ => (object)ValueBuffer.Empty], 
                queryContext.Context
            );
            instance1 = default(InvoiceSequenceValue);
            {
                ISnapshot shadowSnapshot1;
                shadowSnapshot1 = [LIFTABLE Constant: Snapshot | Resolver: _ => Snapshot.Empty];
                entityType1 = [LIFTABLE Constant: EntityType: InvoiceSequenceValue Keyless | Resolver: namelessParameter{0} => namelessParameter{0}.Dependencies.Model.FindEntityType("BillingSystem.Domain.Entities.InvoiceSequenceValue")];
                instance1 = switch (entityType1)
                {
                    case [LIFTABLE Constant: EntityType: InvoiceSequenceValue Keyless | Resolver: namelessParameter{1} => namelessParameter{1}.Dependencies.Model.FindEntityType("BillingSystem.Domain.Entities.InvoiceSequenceValue")]: 
                        {
                            return 
                            {
                                InvoiceSequenceValue instance;
                                instance = new InvoiceSequenceValue();
                                instance.<Value>k__BackingField = dataReader.GetInt64(indexMap[0]);
                                (instance is IInjectableService) ? ((IInjectableService)instance).Injected(
                                    context: materializationContext1.Context, 
                                    entity: instance, 
                                    queryTrackingBehavior: TrackAll, 
                                    structuralType: [LIFTABLE Constant: EntityType: InvoiceSequenceValue Keyless | Resolver: namelessParameter{2} => namelessParameter{2}.Dependencies.Model.FindEntityType("BillingSystem.Domain.Entities.InvoiceSequenceValue")]) : default(void);
                                return instance;
                            }}
                    default: 
                        default(InvoiceSequenceValue)
                }
                ;
                return instance1;
            }return instance1;
        };
        return entity;
    }, 
    contextType: BillingSystem.Infrastructure.EF.BillingServiceDBContext, 
    standAloneStateManager: False, 
    detailedErrorsEnabled: False, 
    threadSafetyChecksEnabled: True)'
2025-12-10 10:55:32.830 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-12-10 10:55:32.836 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (6ms).
2025-12-10 10:55:32.843 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (13ms).
2025-12-10 10:55:32.848 +03:00 [DBG] Executing DbCommand [Parameters=[], CommandType='"Text"', CommandTimeout='30']
EXECUTE dbo.GetNextInvoiceNumber
2025-12-10 10:55:32.860 +03:00 [INF] Executed DbCommand (12ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
EXECUTE dbo.GetNextInvoiceNumber
2025-12-10 10:55:32.870 +03:00 [DBG] Closing data reader to 'GAC-BillingService' on server '.'.
2025-12-10 10:55:32.873 +03:00 [DBG] A data reader for 'GAC-BillingService' on server '.' is being disposed after spending 7ms reading results.
2025-12-10 10:55:32.878 +03:00 [DBG] Compiling query expression: 
'DbSet<Customer>()
    .FirstOrDefault(c => c.IdentityNumber == __cutomerIdentityNumber_0)'
2025-12-10 10:55:32.899 +03:00 [DBG] Generated query execution expression: 
'queryContext => SingleQueryingEnumerable.Create<Customer>(
    relationalQueryContext: (RelationalQueryContext)queryContext, 
    relationalCommandResolver: parameters => [LIFTABLE Constant: RelationalCommandCache.QueryExpression(
        Projection Mapping:
            EmptyProjectionMember -> Dictionary<IProperty, int> { [Property: Customer.Id (long) Required PK AfterSave:Throw ValueGenerated.OnAdd, 0], [Property: Customer.AddressBuildingNumber (string) MaxLength(200), 1], [Property: Customer.AddressCity (string) Required MaxLength(200), 2], [Property: Customer.AddressCountry (string) Required MaxLength(200), 3], [Property: Customer.AddressDistrict (string) Required MaxLength(200), 4], [Property: Customer.AddressPostalCode (string) Required MaxLength(50), 5], [Property: Customer.AddressStreet (string) MaxLength(200), 6], [Property: Customer.AddressSubNumber (string) MaxLength(200), 7], [Property: Customer.CreatedBy (string) Required MaxLength(50), 8], [Property: Customer.CreatedDate (DateTime) Required, 9], [Property: Customer.CustomerType (string) Required MaxLength(100), 10], [Property: Customer.EmailAddress (string) MaxLength(80), 11], [Property: Customer.FullName (string) Required MaxLength(500), 12], [Property: Customer.IdentityNumber (string) Required MaxLength(100), 13], [Property: Customer.IdentityType (int?), 14], [Property: Customer.IsDeleted (bool) Required, 15], [Property: Customer.LastUpdatedDate (DateTime?), 16], [Property: Customer.OverpaymentBalance (decimal?), 17], [Property: Customer.PhoneNumber (string) MaxLength(50), 18], [Property: Customer.Vatnumber (string) MaxLength(100), 19] }
        SELECT TOP(1) c.Id, c.Address_BuildingNumber, c.Address_City, c.Address_Country, c.Address_District, c.Address_PostalCode, c.Address_Street, c.Address_SubNumber, c.CreatedBy, c.CreatedDate, c.CustomerType, c.EmailAddress, c.FullName, c.IdentityNumber, c.IdentityType, c.IsDeleted, c.LastUpdatedDate, c.OverpaymentBalance, c.PhoneNumber, c.VATNumber
        FROM Customers AS c
        WHERE c.IdentityNumber == @__cutomerIdentityNumber_0) | Resolver: c => new RelationalCommandCache(
        c.Dependencies.MemoryCache, 
        c.RelationalDependencies.QuerySqlGeneratorFactory, 
        c.RelationalDependencies.RelationalParameterBasedSqlProcessorFactory, 
        Projection Mapping:
            EmptyProjectionMember -> Dictionary<IProperty, int> { [Property: Customer.Id (long) Required PK AfterSave:Throw ValueGenerated.OnAdd, 0], [Property: Customer.AddressBuildingNumber (string) MaxLength(200), 1], [Property: Customer.AddressCity (string) Required MaxLength(200), 2], [Property: Customer.AddressCountry (string) Required MaxLength(200), 3], [Property: Customer.AddressDistrict (string) Required MaxLength(200), 4], [Property: Customer.AddressPostalCode (string) Required MaxLength(50), 5], [Property: Customer.AddressStreet (string) MaxLength(200), 6], [Property: Customer.AddressSubNumber (string) MaxLength(200), 7], [Property: Customer.CreatedBy (string) Required MaxLength(50), 8], [Property: Customer.CreatedDate (DateTime) Required, 9], [Property: Customer.CustomerType (string) Required MaxLength(100), 10], [Property: Customer.EmailAddress (string) MaxLength(80), 11], [Property: Customer.FullName (string) Required MaxLength(500), 12], [Property: Customer.IdentityNumber (string) Required MaxLength(100), 13], [Property: Customer.IdentityType (int?), 14], [Property: Customer.IsDeleted (bool) Required, 15], [Property: Customer.LastUpdatedDate (DateTime?), 16], [Property: Customer.OverpaymentBalance (decimal?), 17], [Property: Customer.PhoneNumber (string) MaxLength(50), 18], [Property: Customer.Vatnumber (string) MaxLength(100), 19] }
        SELECT TOP(1) c.Id, c.Address_BuildingNumber, c.Address_City, c.Address_Country, c.Address_District, c.Address_PostalCode, c.Address_Street, c.Address_SubNumber, c.CreatedBy, c.CreatedDate, c.CustomerType, c.EmailAddress, c.FullName, c.IdentityNumber, c.IdentityType, c.IsDeleted, c.LastUpdatedDate, c.OverpaymentBalance, c.PhoneNumber, c.VATNumber
        FROM Customers AS c
        WHERE c.IdentityNumber == @__cutomerIdentityNumber_0, 
        False, 
        new HashSet<string>(
            new string[]{ }, 
            StringComparer.Ordinal
        )
    )].GetRelationalCommandTemplate(parameters), 
    readerColumns: null, 
    shaper: (queryContext, dataReader, resultContext, resultCoordinator) => 
    {
        Customer entity;
        entity = 
        {
            MaterializationContext materializationContext1;
            IEntityType entityType1;
            Customer instance1;
            InternalEntityEntry entry1;
            bool hasNullKey1;
            materializationContext1 = new MaterializationContext(
                [LIFTABLE Constant: ValueBuffer | Resolver: _ => (object)ValueBuffer.Empty], 
                queryContext.Context
            );
            instance1 = default(Customer);
            entry1 = queryContext.TryGetEntry(
                key: [LIFTABLE Constant: Key: Customer.Id PK | Resolver: c => c.Dependencies.Model.FindEntityType("BillingSystem.Domain.Entities.Customer").FindPrimaryKey()], 
                keyValues: new object[]{ (object)dataReader.GetInt64(0) }, 
                throwOnNullKey: True, 
                hasNullKey: hasNullKey1);
            !(hasNullKey1) ? entry1 != default(InternalEntityEntry) ? 
            {
                entityType1 = entry1.EntityType;
                return instance1 = (Customer)entry1.Entity;
            } : 
            {
                ISnapshot shadowSnapshot1;
                shadowSnapshot1 = [LIFTABLE Constant: Snapshot | Resolver: _ => Snapshot.Empty];
                entityType1 = [LIFTABLE Constant: EntityType: Customer | Resolver: namelessParameter{0} => namelessParameter{0}.Dependencies.Model.FindEntityType("BillingSystem.Domain.Entities.Customer")];
                instance1 = switch (entityType1)
                {
                    case [LIFTABLE Constant: EntityType: Customer | Resolver: namelessParameter{1} => namelessParameter{1}.Dependencies.Model.FindEntityType("BillingSystem.Domain.Entities.Customer")]: 
                        {
                            return 
                            {
                                Customer instance;
                                instance = new Customer();
                                instance.<Id>k__BackingField = dataReader.GetInt64(0);
                                instance.<AddressBuildingNumber>k__BackingField = dataReader.IsDBNull(1) ? default(string) : dataReader.GetString(1);
                                instance.<AddressCity>k__BackingField = dataReader.GetString(2);
                                instance.<AddressCountry>k__BackingField = dataReader.GetString(3);
                                instance.<AddressDistrict>k__BackingField = dataReader.GetString(4);
                                instance.<AddressPostalCode>k__BackingField = dataReader.GetString(5);
                                instance.<AddressStreet>k__BackingField = dataReader.IsDBNull(6) ? default(string) : dataReader.GetString(6);
                                instance.<AddressSubNumber>k__BackingField = dataReader.IsDBNull(7) ? default(string) : dataReader.GetString(7);
                                instance.<CreatedBy>k__BackingField = dataReader.GetString(8);
                                instance.<CreatedDate>k__BackingField = dataReader.GetDateTime(9);
                                instance.<CustomerType>k__BackingField = dataReader.GetString(10);
                                instance.<EmailAddress>k__BackingField = dataReader.IsDBNull(11) ? default(string) : dataReader.GetString(11);
                                instance.<FullName>k__BackingField = dataReader.GetString(12);
                                instance.<IdentityNumber>k__BackingField = dataReader.GetString(13);
                                instance.<IdentityType>k__BackingField = dataReader.IsDBNull(14) ? default(int?) : (int?)dataReader.GetInt32(14);
                                instance.<IsDeleted>k__BackingField = dataReader.GetBoolean(15);
                                instance.<LastUpdatedDate>k__BackingField = dataReader.IsDBNull(16) ? default(DateTime?) : (DateTime?)dataReader.GetDateTime(16);
                                instance.<OverpaymentBalance>k__BackingField = dataReader.IsDBNull(17) ? default(decimal?) : (decimal?)dataReader.GetDecimal(17);
                                instance.<PhoneNumber>k__BackingField = dataReader.IsDBNull(18) ? default(string) : dataReader.GetString(18);
                                instance.<Vatnumber>k__BackingField = dataReader.IsDBNull(19) ? default(string) : dataReader.GetString(19);
                                (instance is IInjectableService) ? ((IInjectableService)instance).Injected(
                                    context: materializationContext1.Context, 
                                    entity: instance, 
                                    queryTrackingBehavior: TrackAll, 
                                    structuralType: [LIFTABLE Constant: EntityType: Customer | Resolver: namelessParameter{2} => namelessParameter{2}.Dependencies.Model.FindEntityType("BillingSystem.Domain.Entities.Customer")]) : default(void);
                                return instance;
                            }}
                    default: 
                        default(Customer)
                }
                ;
                entry1 = entityType1 == default(IEntityType) ? default(InternalEntityEntry) : queryContext.StartTracking(
                    entityType: entityType1, 
                    entity: instance1, 
                    snapshot: shadowSnapshot1);
                return instance1;
            } : default(void);
            return instance1;
        };
        return entity;
    }, 
    contextType: BillingSystem.Infrastructure.EF.BillingServiceDBContext, 
    standAloneStateManager: False, 
    detailedErrorsEnabled: False, 
    threadSafetyChecksEnabled: True)
    .SingleOrDefault()'
2025-12-10 10:55:32.911 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-12-10 10:55:32.914 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (2ms).
2025-12-10 10:55:32.917 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (6ms).
2025-12-10 10:55:32.921 +03:00 [DBG] Executing DbCommand [Parameters=[@__cutomerIdentityNumber_0='?' (Size = 100)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[Id], [c].[Address_BuildingNumber], [c].[Address_City], [c].[Address_Country], [c].[Address_District], [c].[Address_PostalCode], [c].[Address_Street], [c].[Address_SubNumber], [c].[CreatedBy], [c].[CreatedDate], [c].[CustomerType], [c].[EmailAddress], [c].[FullName], [c].[IdentityNumber], [c].[IdentityType], [c].[IsDeleted], [c].[LastUpdatedDate], [c].[OverpaymentBalance], [c].[PhoneNumber], [c].[VATNumber]
FROM [Customers] AS [c]
WHERE [c].[IdentityNumber] = @__cutomerIdentityNumber_0
2025-12-10 10:55:32.930 +03:00 [INF] Executed DbCommand (10ms) [Parameters=[@__cutomerIdentityNumber_0='?' (Size = 100)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[Id], [c].[Address_BuildingNumber], [c].[Address_City], [c].[Address_Country], [c].[Address_District], [c].[Address_PostalCode], [c].[Address_Street], [c].[Address_SubNumber], [c].[CreatedBy], [c].[CreatedDate], [c].[CustomerType], [c].[EmailAddress], [c].[FullName], [c].[IdentityNumber], [c].[IdentityType], [c].[IsDeleted], [c].[LastUpdatedDate], [c].[OverpaymentBalance], [c].[PhoneNumber], [c].[VATNumber]
FROM [Customers] AS [c]
WHERE [c].[IdentityNumber] = @__cutomerIdentityNumber_0
2025-12-10 10:55:32.972 +03:00 [DBG] Context 'BillingServiceDBContext' started tracking 'Customer' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-12-10 10:55:33.059 +03:00 [DBG] Closing data reader to 'GAC-BillingService' on server '.'.
2025-12-10 10:55:33.064 +03:00 [DBG] A data reader for 'GAC-BillingService' on server '.' is being disposed after spending 127ms reading results.
2025-12-10 10:55:33.114 +03:00 [DBG] 'BillingServiceDBContext' generated a temporary value for the property 'Invoice.Id'. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-12-10 10:55:33.213 +03:00 [DBG] Context 'BillingServiceDBContext' started tracking 'Invoice' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-12-10 10:55:33.222 +03:00 [DBG] 'BillingServiceDBContext' generated a temporary value for the property 'InvoicesAttachment.Id'. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-12-10 10:55:33.238 +03:00 [DBG] The navigation 'InvoicesAttachment.Invoice' was detected as changed. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-12-10 10:55:33.248 +03:00 [DBG] Context 'BillingServiceDBContext' started tracking 'InvoicesAttachment' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-12-10 10:55:33.256 +03:00 [DBG] 'BillingServiceDBContext' generated a temporary value for the property 'InvoicesItem.Id'. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-12-10 10:55:33.278 +03:00 [DBG] The navigation 'InvoicesItem.Invoice' was detected as changed. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-12-10 10:55:33.284 +03:00 [DBG] Context 'BillingServiceDBContext' started tracking 'InvoicesItem' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-12-10 10:55:33.292 +03:00 [DBG] SaveChanges starting for 'BillingServiceDBContext'.
2025-12-10 10:55:33.296 +03:00 [DBG] DetectChanges starting for 'BillingServiceDBContext'.
2025-12-10 10:55:33.361 +03:00 [DBG] DetectChanges completed for 'BillingServiceDBContext'.
2025-12-10 10:55:33.501 +03:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-12-10 10:55:33.508 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-12-10 10:55:33.511 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (3ms).
2025-12-10 10:55:33.516 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (8ms).
2025-12-10 10:55:33.521 +03:00 [DBG] Executing DbCommand [Parameters=[@p0='?' (Precision = 18) (DbType = Decimal), @p1='?' (Size = 3000), @p2='?' (Size = 100), @p3='?' (Size = 50), @p4='?' (DbType = DateTime), @p5='?' (Size = 50), @p6='?' (DbType = Int64), @p7='?' (DbType = Int64), @p8='?' (DbType = DateTime), @p9='?' (DbType = Guid), @p10='?' (Size = 50), @p11='?' (DbType = Int32), @p12='?' (DbType = Int32), @p13='?' (DbType = Boolean), @p14='?' (DbType = Boolean), @p15='?' (DbType = Boolean), @p16='?' (DbType = Boolean), @p17='?' (DbType = DateTime), @p18='?' (DbType = DateTime), @p19='?' (Size = 4000), @p20='?' (Size = 100), @p21='?' (Size = 100), @p22='?' (DbType = Int64), @p23='?' (Size = 4000), @p24='?' (DbType = Int64), @p25='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [Invoices] ([Amount], [CancelationReasons], [ClientReferenceNumber], [CreatedBy], [CreatedDate], [Currency], [CustomerID], [DiscountedPrimaryInvoiceID], [DueAt], [ExternalId], [InvoiceNumber], [InvoiceStatus], [InvoiceType], [IsDeleted], [IsDiscounted], [IsSubInvoice], [IsSubstitution], [IssuedAt], [LastUpdatedDate], [Metadata], [PaymentProvider], [PaymentReference], [PrimaryInvoiceID], [ProviderResponse], [SubstitutionPrimaryInvoiceID], [TenantId])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18, @p19, @p20, @p21, @p22, @p23, @p24, @p25);
2025-12-10 10:55:33.535 +03:00 [INF] Executed DbCommand (16ms) [Parameters=[@p0='?' (Precision = 18) (DbType = Decimal), @p1='?' (Size = 3000), @p2='?' (Size = 100), @p3='?' (Size = 50), @p4='?' (DbType = DateTime), @p5='?' (Size = 50), @p6='?' (DbType = Int64), @p7='?' (DbType = Int64), @p8='?' (DbType = DateTime), @p9='?' (DbType = Guid), @p10='?' (Size = 50), @p11='?' (DbType = Int32), @p12='?' (DbType = Int32), @p13='?' (DbType = Boolean), @p14='?' (DbType = Boolean), @p15='?' (DbType = Boolean), @p16='?' (DbType = Boolean), @p17='?' (DbType = DateTime), @p18='?' (DbType = DateTime), @p19='?' (Size = 4000), @p20='?' (Size = 100), @p21='?' (Size = 100), @p22='?' (DbType = Int64), @p23='?' (Size = 4000), @p24='?' (DbType = Int64), @p25='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [Invoices] ([Amount], [CancelationReasons], [ClientReferenceNumber], [CreatedBy], [CreatedDate], [Currency], [CustomerID], [DiscountedPrimaryInvoiceID], [DueAt], [ExternalId], [InvoiceNumber], [InvoiceStatus], [InvoiceType], [IsDeleted], [IsDiscounted], [IsSubInvoice], [IsSubstitution], [IssuedAt], [LastUpdatedDate], [Metadata], [PaymentProvider], [PaymentReference], [PrimaryInvoiceID], [ProviderResponse], [SubstitutionPrimaryInvoiceID], [TenantId])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18, @p19, @p20, @p21, @p22, @p23, @p24, @p25);
2025-12-10 10:55:33.560 +03:00 [DBG] The foreign key property 'Invoice.Id' was detected as changed. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see property values.
2025-12-10 10:55:33.572 +03:00 [DBG] The foreign key property 'InvoicesAttachment.InvoiceId' was detected as changed. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see property values.
2025-12-10 10:55:33.581 +03:00 [DBG] The foreign key property 'InvoicesItem.InvoiceId' was detected as changed. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see property values.
2025-12-10 10:55:33.587 +03:00 [DBG] Closing data reader to 'GAC-BillingService' on server '.'.
2025-12-10 10:55:33.590 +03:00 [DBG] A data reader for 'GAC-BillingService' on server '.' is being disposed after spending 49ms reading results.
2025-12-10 10:55:33.598 +03:00 [DBG] Executing 2 update commands as a batch.
2025-12-10 10:55:33.601 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-12-10 10:55:33.603 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (1ms).
2025-12-10 10:55:33.606 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (5ms).
2025-12-10 10:55:33.608 +03:00 [DBG] Executing DbCommand [Parameters=[@p26='?' (Size = 50), @p27='?' (DbType = DateTime), @p28='?' (Size = 200), @p29='?' (DbType = Int64), @p30='?' (DbType = Boolean), @p31='?' (Precision = 18) (DbType = Decimal), @p32='?' (Size = 50), @p33='?' (DbType = DateTime), @p34='?' (DbType = Int64), @p35='?' (DbType = Boolean), @p36='?' (Size = 500), @p37='?' (Size = 200), @p38='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SET NOCOUNT ON;
INSERT INTO [InvoicesAttachments] ([CreatedBy], [CreatedDate], [FileName], [InvoiceId], [IsDeleted])
OUTPUT INSERTED.[Id]
VALUES (@p26, @p27, @p28, @p29, @p30);
INSERT INTO [InvoicesItems] ([Amount], [CreatedBy], [CreatedDate], [InvoiceId], [IsDeleted], [ItemDesc], [ItemName], [Quantity])
OUTPUT INSERTED.[Id]
VALUES (@p31, @p32, @p33, @p34, @p35, @p36, @p37, @p38);
2025-12-10 10:55:33.619 +03:00 [INF] Executed DbCommand (11ms) [Parameters=[@p26='?' (Size = 50), @p27='?' (DbType = DateTime), @p28='?' (Size = 200), @p29='?' (DbType = Int64), @p30='?' (DbType = Boolean), @p31='?' (Precision = 18) (DbType = Decimal), @p32='?' (Size = 50), @p33='?' (DbType = DateTime), @p34='?' (DbType = Int64), @p35='?' (DbType = Boolean), @p36='?' (Size = 500), @p37='?' (Size = 200), @p38='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SET NOCOUNT ON;
INSERT INTO [InvoicesAttachments] ([CreatedBy], [CreatedDate], [FileName], [InvoiceId], [IsDeleted])
OUTPUT INSERTED.[Id]
VALUES (@p26, @p27, @p28, @p29, @p30);
INSERT INTO [InvoicesItems] ([Amount], [CreatedBy], [CreatedDate], [InvoiceId], [IsDeleted], [ItemDesc], [ItemName], [Quantity])
OUTPUT INSERTED.[Id]
VALUES (@p31, @p32, @p33, @p34, @p35, @p36, @p37, @p38);
2025-12-10 10:55:33.625 +03:00 [DBG] The foreign key property 'InvoicesAttachment.Id' was detected as changed. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see property values.
2025-12-10 10:55:33.629 +03:00 [DBG] The foreign key property 'InvoicesItem.Id' was detected as changed. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see property values.
2025-12-10 10:55:33.631 +03:00 [DBG] Closing data reader to 'GAC-BillingService' on server '.'.
2025-12-10 10:55:33.634 +03:00 [DBG] A data reader for 'GAC-BillingService' on server '.' is being disposed after spending 9ms reading results.
2025-12-10 10:55:33.646 +03:00 [DBG] An entity of type 'Invoice' tracked by 'BillingServiceDBContext' changed state from '"Added"' to '"Unchanged"'. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-12-10 10:55:33.652 +03:00 [DBG] An entity of type 'InvoicesAttachment' tracked by 'BillingServiceDBContext' changed state from '"Added"' to '"Unchanged"'. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-12-10 10:55:33.658 +03:00 [DBG] An entity of type 'InvoicesItem' tracked by 'BillingServiceDBContext' changed state from '"Added"' to '"Unchanged"'. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-12-10 10:55:33.666 +03:00 [DBG] SaveChanges completed for 'BillingServiceDBContext' with 3 entities written to the database.
2025-12-10 10:55:33.690 +03:00 [DBG] 'BillingServiceDBContext' generated a temporary value for the property 'OutboxEvent.Id'. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-12-10 10:55:33.710 +03:00 [DBG] Context 'BillingServiceDBContext' started tracking 'OutboxEvent' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-12-10 10:55:33.717 +03:00 [DBG] 'BillingServiceDBContext' generated a temporary value for the property 'AuditEvent.Id'. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-12-10 10:55:33.740 +03:00 [DBG] Context 'BillingServiceDBContext' started tracking 'AuditEvent' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-12-10 10:55:33.744 +03:00 [DBG] SaveChanges starting for 'BillingServiceDBContext'.
2025-12-10 10:55:33.748 +03:00 [DBG] DetectChanges starting for 'BillingServiceDBContext'.
2025-12-10 10:55:33.763 +03:00 [DBG] DetectChanges completed for 'BillingServiceDBContext'.
2025-12-10 10:55:33.767 +03:00 [DBG] Executing 2 update commands as a batch.
2025-12-10 10:55:33.770 +03:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-12-10 10:55:33.771 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-12-10 10:55:33.773 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (1ms).
2025-12-10 10:55:33.776 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (5ms).
2025-12-10 10:55:33.779 +03:00 [DBG] Executing DbCommand [Parameters=[@p0='?' (Size = 100), @p1='?' (Size = 4000), @p2='?' (Size = 50), @p3='?' (DbType = DateTime), @p4='?' (Size = 500), @p5='?' (Size = 20), @p6='?' (Size = 100), @p7='?' (Size = 100), @p8='?' (DbType = Int64), @p9='?' (Size = 4000), @p10='?' (DbType = DateTime), @p11='?' (Size = 4000), @p12='?' (Size = 300), @p13='?' (Size = 4000), @p14='?' (DbType = Boolean), @p15='?' (Size = 20) (DbType = AnsiString)], CommandType='"Text"', CommandTimeout='30']
SET NOCOUNT ON;
INSERT INTO [audit].[AuditEvents] ([Action], [Changes], [CreatedBy], [CreatedDate], [Description], [EntityId], [EntityType], [UserId])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
INSERT INTO [Outbox_events] ([Aggregate_id], [CorrelationId], [CreatedDate], [ErrorMsg], [Event_type], [Payload], [Processed], [ProcessingStatus])
OUTPUT INSERTED.[Id]
VALUES (@p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15);
2025-12-10 10:55:33.799 +03:00 [INF] Executed DbCommand (20ms) [Parameters=[@p0='?' (Size = 100), @p1='?' (Size = 4000), @p2='?' (Size = 50), @p3='?' (DbType = DateTime), @p4='?' (Size = 500), @p5='?' (Size = 20), @p6='?' (Size = 100), @p7='?' (Size = 100), @p8='?' (DbType = Int64), @p9='?' (Size = 4000), @p10='?' (DbType = DateTime), @p11='?' (Size = 4000), @p12='?' (Size = 300), @p13='?' (Size = 4000), @p14='?' (DbType = Boolean), @p15='?' (Size = 20) (DbType = AnsiString)], CommandType='"Text"', CommandTimeout='30']
SET NOCOUNT ON;
INSERT INTO [audit].[AuditEvents] ([Action], [Changes], [CreatedBy], [CreatedDate], [Description], [EntityId], [EntityType], [UserId])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
INSERT INTO [Outbox_events] ([Aggregate_id], [CorrelationId], [CreatedDate], [ErrorMsg], [Event_type], [Payload], [Processed], [ProcessingStatus])
OUTPUT INSERTED.[Id]
VALUES (@p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15);
2025-12-10 10:55:33.807 +03:00 [DBG] The foreign key property 'AuditEvent.Id' was detected as changed. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see property values.
2025-12-10 10:55:33.812 +03:00 [DBG] The foreign key property 'OutboxEvent.Id' was detected as changed. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see property values.
2025-12-10 10:55:33.815 +03:00 [DBG] Closing data reader to 'GAC-BillingService' on server '.'.
2025-12-10 10:55:33.817 +03:00 [DBG] A data reader for 'GAC-BillingService' on server '.' is being disposed after spending 11ms reading results.
2025-12-10 10:55:33.822 +03:00 [DBG] An entity of type 'AuditEvent' tracked by 'BillingServiceDBContext' changed state from '"Added"' to '"Unchanged"'. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-12-10 10:55:33.826 +03:00 [DBG] An entity of type 'OutboxEvent' tracked by 'BillingServiceDBContext' changed state from '"Added"' to '"Unchanged"'. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-12-10 10:55:33.830 +03:00 [DBG] SaveChanges completed for 'BillingServiceDBContext' with 2 entities written to the database.
2025-12-10 10:55:33.836 +03:00 [DBG] Committing transaction.
2025-12-10 10:55:33.852 +03:00 [DBG] Committed transaction.
2025-12-10 10:55:33.859 +03:00 [DBG] Closing connection to database 'GAC-BillingService' on server '.'.
2025-12-10 10:55:33.863 +03:00 [DBG] Closed connection to database 'GAC-BillingService' on server '.' (4ms).
2025-12-10 10:55:33.870 +03:00 [DBG] Disposing transaction.
2025-12-10 10:55:33.882 +03:00 [DBG] List of registered output formatters, in the following order: ["Microsoft.AspNetCore.Mvc.Formatters.HttpNoContentOutputFormatter","Microsoft.AspNetCore.Mvc.Formatters.StringOutputFormatter","Microsoft.AspNetCore.Mvc.Formatters.StreamOutputFormatter","Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonOutputFormatter"]
2025-12-10 10:55:33.891 +03:00 [DBG] No information found on request to perform content negotiation.
2025-12-10 10:55:33.893 +03:00 [DBG] Attempting to select the first output formatter in the output formatters list which supports a content type from the explicitly specified content types '["application/json"]'.
2025-12-10 10:55:33.897 +03:00 [DBG] Selected output formatter 'Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonOutputFormatter' and content type 'application/json' to write the response.
2025-12-10 10:55:33.900 +03:00 [INF] Executing OkObjectResult, writing value of type 'BillingSystem.SharedKernel.ApiResponse`1[[System.Int64, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-12-10 10:55:33.921 +03:00 [INF] Executed action BillingSystem.API.Controllers.InvoicesController.Post (BillingSystem.API) in 4174.8019ms
2025-12-10 10:55:33.925 +03:00 [INF] Executed endpoint 'BillingSystem.API.Controllers.InvoicesController.Post (BillingSystem.API)'
2025-12-10 10:55:33.929 +03:00 [INF] HTTP POST /api/Invoices/Post 200 in 4970ms
CorrelationId: 52b0d7f7-424a-432f-baf2-7395a502df90
Request: {
    "externalId": "52b0d7f7-424a-432f-baf2-7395a502df90",
    "tenantId": 2,
    "amount": 1000,
    "currency": "SAR",
    "invoiceType": 2,
    "invoiceStatus": 1,
    "issuedAt": "2025-12-10T08:48:29.095Z",
    "dueAt": "2026-12-29T08:48:29.095Z",
    "IsSubInvoice": true,
    "ClientReferenceNumber": "Installment01",
    "customer": {
        "fullName": "Abdualmajeed alharbi",
        "customerType": 1,
        "identityType": 1,
        "address": {
            "addressCountry": "saudi arabia",
            "addressCity": "riyadh",
            "addressPostalCode": "3445",
            "addressDistrict": "laban",
            "addressStreet": "altaif",
            "addressBuildingNumber": "322",
            "addressSubNumber": "433"
        },
        "identityNumber": "1397026390",
        "phoneNumber": "0582982757",
        "emailAddress": "mnsour@gac.gov.sa",
        "vatnumber": ""
    },
    "Metadata": "{\n  \"cityHappened\": 1,\n  \"fineGroupCode\": 258,\n  \"detailFineType\": 258001,\n  \"regPersonID\": 1025326510,\n  \"remarks\": \"remarks\",\n  \"resolutionRef\": \"\",\n  \"resolutionSource\": 0,\n  \"resolutionType\": 0,\n  \"securityOperatorID\": 1025326332\n}",
    "attachments": [
        {
            "fileName": "string",
            "fileContent": ""
        }
    ],
    "items": [
        {
            "itemName": " ",
            "itemDesc": "  1000 ",
            "amount": 1000
        }
    ]
}
Response: {"message":"invoice created.","statusCode":"200","data":20006,"isSucceed":true,"validationErrors":null}
2025-12-10 10:55:33.940 +03:00 [INF] HTTP POST /api/Invoices/Post responded 200 in 4984.9609 ms
2025-12-10 10:55:33.944 +03:00 [DBG] Connection id "0HNHNNMTHGBAF" completed keep alive response.
2025-12-10 10:55:33.947 +03:00 [DBG] 'BillingServiceDBContext' disposed.
2025-12-10 10:55:33.956 +03:00 [DBG] Disposing connection to database 'GAC-BillingService' on server '.'.
2025-12-10 10:55:33.961 +03:00 [DBG] Disposed connection to database '' on server '' (4ms).
2025-12-10 10:55:33.966 +03:00 [INF] Request finished HTTP/1.1 POST https://localhost:7257/api/Invoices/Post - 200 null application/json; charset=utf-8 5034.3304ms
2025-12-10 11:00:18.744 +03:00 [DBG] Disconnect: guest@localhost:5672/
2025-12-10 11:00:18.818 +03:00 [DBG] Disconnected: guest@localhost:5672/
2025-12-10 11:20:47.958 +03:00 [DBG] Registered model binder providers, in the following order: ["Microsoft.AspNetCore.Mvc.ModelBinding.Binders.BinderTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ServicesModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.BodyModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.HeaderModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FloatingPointTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.EnumTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.DateTimeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.SimpleTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.TryParseModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.CancellationTokenModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ByteArrayModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FormFileModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FormCollectionModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.KeyValuePairModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.DictionaryModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ArrayModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.CollectionModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ComplexObjectModelBinderProvider"]
2025-12-10 11:20:48.167 +03:00 [DBG] Hosting starting
2025-12-10 11:20:48.506 +03:00 [DBG] Starting bus instances: IBus
2025-12-10 11:20:48.515 +03:00 [DBG] Starting bus: "rabbitmq://localhost/"
2025-12-10 11:20:48.570 +03:00 [DBG] Middleware loaded
2025-12-10 11:20:48.576 +03:00 [DBG] Middleware loaded. Script /_framework/aspnetcore-browser-refresh.js (16519 B).
2025-12-10 11:20:48.585 +03:00 [DBG] Middleware loaded. Script /_framework/blazor-hotreload.js (799 B).
2025-12-10 11:20:48.600 +03:00 [DBG] Connect: guest@localhost:5672/
2025-12-10 11:20:48.751 +03:00 [DBG] Middleware loaded: DOTNET_MODIFIABLE_ASSEMBLIES=debug, __ASPNETCORE_BROWSER_TOOLS=true
2025-12-10 11:20:48.757 +03:00 [DBG] Connected: guest@localhost:5672/ (address: amqp://localhost:5672, local: 65231)
2025-12-10 11:20:48.846 +03:00 [DBG] Endpoint Ready: "rabbitmq://localhost/ECHGHANNAMLP1_BillingSystemAPI_bus_4tnyyyyh3bcsy8mcbdxdxtegbd?temporary=true"
2025-12-10 11:20:48.850 +03:00 [INF] Bus started: "rabbitmq://localhost/"
2025-12-10 11:20:49.068 +03:00 [INF] Now listening on: https://localhost:7257
2025-12-10 11:20:49.073 +03:00 [INF] Now listening on: http://localhost:5009
2025-12-10 11:20:49.078 +03:00 [DBG] Loaded hosting startup assembly BillingSystem.API
2025-12-10 11:20:49.080 +03:00 [DBG] Loaded hosting startup assembly Microsoft.WebTools.ApiEndpointDiscovery
2025-12-10 11:20:49.082 +03:00 [DBG] Loaded hosting startup assembly Microsoft.AspNetCore.Watch.BrowserRefresh
2025-12-10 11:20:49.084 +03:00 [DBG] Loaded hosting startup assembly Microsoft.WebTools.BrowserLink.Net
2025-12-10 11:20:49.251 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-12-10 11:20:49.254 +03:00 [INF] Hosting environment: Development
2025-12-10 11:20:49.259 +03:00 [INF] Content root path: C:\Repositories\Gac-BillingSystem\src\BillingSystem.API
2025-12-10 11:20:49.263 +03:00 [DBG] Hosting started
2025-12-10 11:20:49.428 +03:00 [DBG] Connection id "0HNHNOK3BNVMC" accepted.
2025-12-10 11:20:49.428 +03:00 [DBG] Connection id "0HNHNOK3BNVMD" accepted.
2025-12-10 11:20:49.436 +03:00 [DBG] Connection id "0HNHNOK3BNVMC" started.
2025-12-10 11:20:49.438 +03:00 [DBG] Connection id "0HNHNOK3BNVMD" started.
2025-12-10 11:20:49.458 +03:00 [DBG] Connection id "0HNHNOK3BNVMC" received FIN.
2025-12-10 11:20:49.458 +03:00 [DBG] Connection id "0HNHNOK3BNVMD" received FIN.
2025-12-10 11:20:49.497 +03:00 [DBG] Failed to authenticate HTTPS connection.
System.IO.IOException: Received an unexpected EOF or 0 bytes from the transport stream.
   at System.Net.Security.SslStream.ReceiveHandshakeFrameAsync[TIOAdapter](CancellationToken cancellationToken)
   at System.Net.Security.SslStream.ForceAuthenticationAsync[TIOAdapter](Boolean receiveFirst, Byte[] reAuthenticationData, CancellationToken cancellationToken)
   at System.Net.Security.SslStream.ProcessAuthenticationWithTelemetryAsync(Boolean isAsync, CancellationToken cancellationToken)
   at Microsoft.AspNetCore.Server.Kestrel.Https.Internal.HttpsConnectionMiddleware.OnConnectionAsync(ConnectionContext context)
2025-12-10 11:20:49.497 +03:00 [DBG] Failed to authenticate HTTPS connection.
System.IO.IOException: Received an unexpected EOF or 0 bytes from the transport stream.
   at System.Net.Security.SslStream.ReceiveHandshakeFrameAsync[TIOAdapter](CancellationToken cancellationToken)
   at System.Net.Security.SslStream.ForceAuthenticationAsync[TIOAdapter](Boolean receiveFirst, Byte[] reAuthenticationData, CancellationToken cancellationToken)
   at System.Net.Security.SslStream.ProcessAuthenticationWithTelemetryAsync(Boolean isAsync, CancellationToken cancellationToken)
   at Microsoft.AspNetCore.Server.Kestrel.Https.Internal.HttpsConnectionMiddleware.OnConnectionAsync(ConnectionContext context)
2025-12-10 11:20:49.557 +03:00 [DBG] Connection id "0HNHNOK3BNVMD" stopped.
2025-12-10 11:20:49.565 +03:00 [DBG] Connection id "0HNHNOK3BNVMC" stopped.
2025-12-10 11:20:49.580 +03:00 [DBG] Connection id "0HNHNOK3BNVMC" sending FIN because: "The Socket transport's send loop completed gracefully."
2025-12-10 11:20:49.580 +03:00 [DBG] Connection id "0HNHNOK3BNVMD" sending FIN because: "The Socket transport's send loop completed gracefully."
2025-12-10 11:20:50.323 +03:00 [DBG] Connection id "0HNHNOK3BNVME" accepted.
2025-12-10 11:20:50.328 +03:00 [DBG] Connection id "0HNHNOK3BNVME" started.
2025-12-10 11:20:50.417 +03:00 [DBG] Connection 0HNHNOK3BNVME established using the following protocol: "Tls13"
2025-12-10 11:20:50.494 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7257/swagger/index.html - null null
2025-12-10 11:20:50.570 +03:00 [DBG] Wildcard detected, all requests with hosts will be allowed.
2025-12-10 11:20:50.623 +03:00 [DBG] No candidates found for the request path '/swagger/index.html'
2025-12-10 11:20:50.635 +03:00 [DBG] Request did not match any endpoints
2025-12-10 11:20:50.727 +03:00 [DBG] Response markup is scheduled to include Browser Link script injection.
2025-12-10 11:20:50.733 +03:00 [DBG] Response markup is scheduled to include browser refresh script injection.
2025-12-10 11:20:50.761 +03:00 [INF] HTTP GET /swagger/index.html responded 200 in 110.5180 ms
2025-12-10 11:20:50.771 +03:00 [DBG] Response markup was updated to include Browser Link script injection.
2025-12-10 11:20:50.822 +03:00 [DBG] Response markup was updated to include browser refresh script injection.
2025-12-10 11:20:50.840 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7257/swagger/index.html - 200 null text/html;charset=utf-8 355.6822ms
2025-12-10 11:20:50.849 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7257/_framework/aspnetcore-browser-refresh.js - null null
2025-12-10 11:20:50.868 +03:00 [DBG] Script injected: /_framework/aspnetcore-browser-refresh.js
2025-12-10 11:20:50.873 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7257/_framework/aspnetcore-browser-refresh.js - 200 16519 application/javascript; charset=utf-8 24.0067ms
2025-12-10 11:20:50.902 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7257/_vs/browserLink - null null
2025-12-10 11:20:50.982 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7257/_vs/browserLink - 200 null text/javascript; charset=UTF-8 81.5449ms
2025-12-10 11:20:51.017 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7257/swagger/v1/swagger.json - null null
2025-12-10 11:20:51.025 +03:00 [DBG] No candidates found for the request path '/swagger/v1/swagger.json'
2025-12-10 11:20:51.027 +03:00 [DBG] Request did not match any endpoints
2025-12-10 11:20:51.048 +03:00 [INF] HTTP GET /swagger/v1/swagger.json responded 200 in 17.3611 ms
2025-12-10 11:20:51.056 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7257/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 38.6896ms
2025-12-10 11:20:51.995 +03:00 [DBG] Connection id "0HNHNOK3BNVME" received FIN.
2025-12-10 11:20:52.008 +03:00 [DBG] The connection queue processing loop for 0HNHNOK3BNVME completed.
2025-12-10 11:20:52.017 +03:00 [DBG] Connection id "0HNHNOK3BNVME" is closed. The last processed stream ID was 7.
2025-12-10 11:20:52.027 +03:00 [DBG] Connection id "0HNHNOK3BNVME" sending FIN because: "The Socket transport's send loop completed gracefully."
2025-12-10 11:20:52.048 +03:00 [DBG] Connection id "0HNHNOK3BNVME" stopped.
2025-12-10 11:28:49.261 +03:00 [DBG] Registered model binder providers, in the following order: ["Microsoft.AspNetCore.Mvc.ModelBinding.Binders.BinderTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ServicesModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.BodyModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.HeaderModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FloatingPointTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.EnumTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.DateTimeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.SimpleTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.TryParseModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.CancellationTokenModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ByteArrayModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FormFileModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FormCollectionModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.KeyValuePairModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.DictionaryModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ArrayModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.CollectionModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ComplexObjectModelBinderProvider"]
2025-12-10 11:28:49.485 +03:00 [DBG] Hosting starting
2025-12-10 11:28:49.970 +03:00 [DBG] Starting bus instances: IBus
2025-12-10 11:28:49.981 +03:00 [DBG] Starting bus: "rabbitmq://localhost/"
2025-12-10 11:28:50.019 +03:00 [DBG] Middleware loaded
2025-12-10 11:28:50.026 +03:00 [DBG] Middleware loaded. Script /_framework/aspnetcore-browser-refresh.js (16519 B).
2025-12-10 11:28:50.031 +03:00 [DBG] Middleware loaded. Script /_framework/blazor-hotreload.js (799 B).
2025-12-10 11:28:50.049 +03:00 [DBG] Connect: guest@localhost:5672/
2025-12-10 11:28:50.250 +03:00 [DBG] Middleware loaded: DOTNET_MODIFIABLE_ASSEMBLIES=debug, __ASPNETCORE_BROWSER_TOOLS=true
2025-12-10 11:28:50.265 +03:00 [DBG] Connected: guest@localhost:5672/ (address: amqp://localhost:5672, local: 57314)
2025-12-10 11:28:50.349 +03:00 [DBG] Endpoint Ready: "rabbitmq://localhost/ECHGHANNAMLP1_BillingSystemAPI_bus_tyroyyyh3bcsbidwbdxdxttfyi?temporary=true"
2025-12-10 11:28:50.354 +03:00 [INF] Bus started: "rabbitmq://localhost/"
2025-12-10 11:28:50.699 +03:00 [INF] Now listening on: https://localhost:7257
2025-12-10 11:28:50.706 +03:00 [INF] Now listening on: http://localhost:5009
2025-12-10 11:28:50.710 +03:00 [DBG] Loaded hosting startup assembly BillingSystem.API
2025-12-10 11:28:50.720 +03:00 [DBG] Loaded hosting startup assembly Microsoft.WebTools.ApiEndpointDiscovery
2025-12-10 11:28:50.724 +03:00 [DBG] Loaded hosting startup assembly Microsoft.AspNetCore.Watch.BrowserRefresh
2025-12-10 11:28:50.726 +03:00 [DBG] Loaded hosting startup assembly Microsoft.WebTools.BrowserLink.Net
2025-12-10 11:28:50.867 +03:00 [DBG] Connection id "0HNHNOOIR4A21" received FIN.
2025-12-10 11:28:50.886 +03:00 [DBG] Connection id "0HNHNOOIR4A21" accepted.
2025-12-10 11:28:50.894 +03:00 [DBG] Connection id "0HNHNOOIR4A21" started.
2025-12-10 11:28:50.942 +03:00 [DBG] Failed to authenticate HTTPS connection.
System.IO.IOException: Received an unexpected EOF or 0 bytes from the transport stream.
   at System.Net.Security.SslStream.ReceiveHandshakeFrameAsync[TIOAdapter](CancellationToken cancellationToken)
   at System.Net.Security.SslStream.ForceAuthenticationAsync[TIOAdapter](Boolean receiveFirst, Byte[] reAuthenticationData, CancellationToken cancellationToken)
   at System.Net.Security.SslStream.ProcessAuthenticationWithTelemetryAsync(Boolean isAsync, CancellationToken cancellationToken)
   at Microsoft.AspNetCore.Server.Kestrel.Https.Internal.HttpsConnectionMiddleware.OnConnectionAsync(ConnectionContext context)
2025-12-10 11:28:50.952 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-12-10 11:28:50.997 +03:00 [INF] Hosting environment: Development
2025-12-10 11:28:51.000 +03:00 [DBG] Connection id "0HNHNOOIR4A21" stopped.
2025-12-10 11:28:51.012 +03:00 [INF] Content root path: C:\Repositories\Gac-BillingSystem\src\BillingSystem.API
2025-12-10 11:28:51.039 +03:00 [DBG] Hosting started
2025-12-10 11:28:51.053 +03:00 [DBG] Connection id "0HNHNOOIR4A21" sending FIN because: "The Socket transport's send loop completed gracefully."
2025-12-10 11:28:51.969 +03:00 [DBG] Connection id "0HNHNOOIR4A22" accepted.
2025-12-10 11:28:51.971 +03:00 [DBG] Connection id "0HNHNOOIR4A22" started.
2025-12-10 11:28:52.041 +03:00 [DBG] Connection 0HNHNOOIR4A22 established using the following protocol: "Tls13"
2025-12-10 11:28:52.136 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7257/swagger/index.html - null null
2025-12-10 11:28:52.214 +03:00 [DBG] Wildcard detected, all requests with hosts will be allowed.
2025-12-10 11:28:52.255 +03:00 [DBG] No candidates found for the request path '/swagger/index.html'
2025-12-10 11:28:52.263 +03:00 [DBG] Request did not match any endpoints
2025-12-10 11:28:52.380 +03:00 [DBG] Response markup is scheduled to include Browser Link script injection.
2025-12-10 11:28:52.387 +03:00 [DBG] Response markup is scheduled to include browser refresh script injection.
2025-12-10 11:28:52.428 +03:00 [INF] HTTP GET /swagger/index.html responded 200 in 153.6489 ms
2025-12-10 11:28:52.438 +03:00 [DBG] Response markup was updated to include Browser Link script injection.
2025-12-10 11:28:52.442 +03:00 [DBG] Response markup was updated to include browser refresh script injection.
2025-12-10 11:28:52.451 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7257/_framework/aspnetcore-browser-refresh.js - null null
2025-12-10 11:28:52.451 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7257/swagger/index.html - 200 null text/html;charset=utf-8 327.6726ms
2025-12-10 11:28:52.464 +03:00 [DBG] Script injected: /_framework/aspnetcore-browser-refresh.js
2025-12-10 11:28:52.473 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7257/_framework/aspnetcore-browser-refresh.js - 200 16519 application/javascript; charset=utf-8 22.4044ms
2025-12-10 11:28:52.484 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7257/_vs/browserLink - null null
2025-12-10 11:28:52.560 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7257/_vs/browserLink - 200 null text/javascript; charset=UTF-8 77.156ms
2025-12-10 11:28:52.608 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7257/swagger/v1/swagger.json - null null
2025-12-10 11:28:52.618 +03:00 [DBG] No candidates found for the request path '/swagger/v1/swagger.json'
2025-12-10 11:28:52.621 +03:00 [DBG] Request did not match any endpoints
2025-12-10 11:28:52.652 +03:00 [INF] HTTP GET /swagger/v1/swagger.json responded 200 in 27.5315 ms
2025-12-10 11:28:52.660 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7257/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 53.2011ms
2025-12-10 11:31:32.882 +03:00 [DBG] Connection id "0HNHNOOIR4A23" accepted.
2025-12-10 11:31:32.882 +03:00 [DBG] Connection id "0HNHNOOIR4A23" received FIN.
2025-12-10 11:31:32.894 +03:00 [DBG] Connection id "0HNHNOOIR4A23" started.
2025-12-10 11:31:32.902 +03:00 [DBG] Connection id "0HNHNOOIR4A24" accepted.
2025-12-10 11:31:32.916 +03:00 [DBG] Failed to authenticate HTTPS connection.
System.IO.IOException: Received an unexpected EOF or 0 bytes from the transport stream.
   at System.Net.Security.SslStream.ReceiveHandshakeFrameAsync[TIOAdapter](CancellationToken cancellationToken)
   at System.Net.Security.SslStream.ForceAuthenticationAsync[TIOAdapter](Boolean receiveFirst, Byte[] reAuthenticationData, CancellationToken cancellationToken)
   at System.Net.Security.SslStream.ProcessAuthenticationWithTelemetryAsync(Boolean isAsync, CancellationToken cancellationToken)
   at Microsoft.AspNetCore.Server.Kestrel.Https.Internal.HttpsConnectionMiddleware.OnConnectionAsync(ConnectionContext context)
2025-12-10 11:31:32.917 +03:00 [DBG] Connection id "0HNHNOOIR4A24" started.
2025-12-10 11:31:32.922 +03:00 [DBG] Connection id "0HNHNOOIR4A23" stopped.
2025-12-10 11:31:32.926 +03:00 [DBG] Connection id "0HNHNOOIR4A23" sending FIN because: "The Socket transport's send loop completed gracefully."
2025-12-10 11:31:32.930 +03:00 [DBG] Connection 0HNHNOOIR4A24 established using the following protocol: "Tls13"
2025-12-10 11:31:32.938 +03:00 [INF] Request starting HTTP/1.1 POST https://localhost:7257/api/Invoices/Post - application/json 1544
2025-12-10 11:31:32.955 +03:00 [DBG] 1 candidate(s) found for the request path '/api/Invoices/Post'
2025-12-10 11:31:32.973 +03:00 [DBG] Endpoint 'BillingSystem.API.Controllers.InvoicesController.Post (BillingSystem.API)' with route pattern 'api/Invoices/Post' is valid for the request path '/api/Invoices/Post'
2025-12-10 11:31:32.982 +03:00 [DBG] Request matched endpoint 'BillingSystem.API.Controllers.InvoicesController.Post (BillingSystem.API)'
2025-12-10 11:31:32.995 +03:00 [DBG] Static files was skipped as the request already matched an endpoint.
2025-12-10 11:31:33.032 +03:00 [DBG] Connection id "0HNHNOOIR4A24", Request id "0HNHNOOIR4A24:00000001": started reading request body.
2025-12-10 11:31:33.038 +03:00 [DBG] Connection id "0HNHNOOIR4A24", Request id "0HNHNOOIR4A24:00000001": done reading request body.
2025-12-10 11:31:33.226 +03:00 [DBG] An 'IServiceProvider' was created for internal use by Entity Framework.
2025-12-10 11:31:38.687 +03:00 [INF] Executing endpoint 'BillingSystem.API.Controllers.InvoicesController.Post (BillingSystem.API)'
2025-12-10 11:31:38.757 +03:00 [INF] Route matched with {action = "Post", controller = "Invoices"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Post(BillingSystem.Application.Requests.CreateInvoiceRequest) on controller BillingSystem.API.Controllers.InvoicesController (BillingSystem.API).
2025-12-10 11:31:38.765 +03:00 [DBG] Execution plan of authorization filters (in the following order): ["None"]
2025-12-10 11:31:38.768 +03:00 [DBG] Execution plan of resource filters (in the following order): ["None"]
2025-12-10 11:31:38.772 +03:00 [DBG] Execution plan of action filters (in the following order): ["Microsoft.AspNetCore.Mvc.ModelBinding.UnsupportedContentTypeFilter (Order: -3000)","Microsoft.AspNetCore.Mvc.Infrastructure.ModelStateInvalidFilter (Order: -2000)","BillingSystem.API.ActionFilters.IdempotencyFilter (Order: 0)"]
2025-12-10 11:31:38.777 +03:00 [DBG] Execution plan of exception filters (in the following order): ["None"]
2025-12-10 11:31:38.782 +03:00 [DBG] Execution plan of result filters (in the following order): ["Microsoft.AspNetCore.Mvc.Infrastructure.ClientErrorResultFilter (Order: -2000)","Microsoft.AspNetCore.Mvc.ProducesAttribute (Order: 0)","BillingSystem.API.ActionFilters.IdempotencyFilter (Order: 0)"]
2025-12-10 11:31:38.788 +03:00 [DBG] Executing controller factory for controller BillingSystem.API.Controllers.InvoicesController (BillingSystem.API)
2025-12-10 11:31:38.796 +03:00 [WRN] You do not have a valid license key for the Lucky Penny software MediatR. This is allowed for development and testing scenarios. If you are running in production you are required to have a licensed version. Please visit https://luckypennysoftware.com to obtain a valid license.
2025-12-10 11:31:38.848 +03:00 [DBG] Executed controller factory for controller BillingSystem.API.Controllers.InvoicesController (BillingSystem.API)
2025-12-10 11:31:38.860 +03:00 [DBG] Attempting to bind parameter 'invoiceRequest' of type 'BillingSystem.Application.Requests.CreateInvoiceRequest' ...
2025-12-10 11:31:38.873 +03:00 [DBG] Attempting to bind parameter 'invoiceRequest' of type 'BillingSystem.Application.Requests.CreateInvoiceRequest' using the name '' in request data ...
2025-12-10 11:31:38.880 +03:00 [DBG] Selected input formatter 'Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonInputFormatter' for content type 'application/json'.
2025-12-10 11:31:38.998 +03:00 [DBG] JSON input formatter succeeded, deserializing to type 'BillingSystem.Application.Requests.CreateInvoiceRequest'
2025-12-10 11:31:39.004 +03:00 [DBG] Done attempting to bind parameter 'invoiceRequest' of type 'BillingSystem.Application.Requests.CreateInvoiceRequest'.
2025-12-10 11:31:39.009 +03:00 [DBG] Done attempting to bind parameter 'invoiceRequest' of type 'BillingSystem.Application.Requests.CreateInvoiceRequest'.
2025-12-10 11:31:39.014 +03:00 [DBG] Attempting to validate the bound parameter 'invoiceRequest' of type 'BillingSystem.Application.Requests.CreateInvoiceRequest' ...
2025-12-10 11:31:39.045 +03:00 [DBG] Done attempting to validate the bound parameter 'invoiceRequest' of type 'BillingSystem.Application.Requests.CreateInvoiceRequest'.
2025-12-10 11:31:39.375 +03:00 [DBG] No relationship from 'Invoice' to 'Invoice' has been configured by convention because there are multiple properties on one entity type - {'DiscountedPrimaryInvoice'} that could be matched with the properties on the other entity type - {'InverseDiscountedPrimaryInvoice', 'InversePrimaryInvoice', 'InverseSubstitutionPrimaryInvoice', 'PrimaryInvoice', 'SubstitutionPrimaryInvoice'}. This message can be disregarded if explicit configuration has been specified in 'OnModelCreating'.
2025-12-10 11:31:39.643 +03:00 [DBG] No relationship from 'Invoice' to 'Invoice' has been configured by convention because there are multiple properties on one entity type - {'DiscountedPrimaryInvoice'} that could be matched with the properties on the other entity type - {'InverseDiscountedPrimaryInvoice', 'InversePrimaryInvoice', 'InverseSubstitutionPrimaryInvoice', 'PrimaryInvoice', 'SubstitutionPrimaryInvoice'}. This message can be disregarded if explicit configuration has been specified in 'OnModelCreating'.
2025-12-10 11:31:39.660 +03:00 [DBG] No relationship from 'Invoice' to 'Invoice' has been configured by convention because there are multiple properties on one entity type - {'InversePrimaryInvoice'} that could be matched with the properties on the other entity type - {'InverseSubstitutionPrimaryInvoice', 'PrimaryInvoice', 'SubstitutionPrimaryInvoice'}. This message can be disregarded if explicit configuration has been specified in 'OnModelCreating'.
2025-12-10 11:31:39.672 +03:00 [DBG] No relationship from 'Invoice' to 'Invoice' has been configured by convention because there are multiple properties on one entity type - {'InversePrimaryInvoice'} that could be matched with the properties on the other entity type - {'InverseSubstitutionPrimaryInvoice', 'PrimaryInvoice', 'SubstitutionPrimaryInvoice'}. This message can be disregarded if explicit configuration has been specified in 'OnModelCreating'.
2025-12-10 11:31:40.097 +03:00 [DBG] Entity Framework Core 9.0.9 initialized 'BillingServiceDBContext' using provider 'Microsoft.EntityFrameworkCore.SqlServer:9.0.9' with options: EngineType=SqlServer 
2025-12-10 11:31:40.196 +03:00 [DBG] Compiling query expression: 
'DbSet<Invoice>()
    .AsNoTracking()
    .Any(inv => inv.ExternalId.ToString() == __idempotentKey_0)'
2025-12-10 11:31:40.487 +03:00 [DBG] Generated query execution expression: 
'queryContext => ShapedQueryCompilingExpressionVisitor.SingleAsync<bool>(
    asyncEnumerable: SingleQueryingEnumerable.Create<bool>(
        relationalQueryContext: (RelationalQueryContext)queryContext, 
        relationalCommandResolver: parameters => [LIFTABLE Constant: RelationalCommandCache.QueryExpression(
            Projection Mapping:
                EmptyProjectionMember -> 0
            SELECT EXISTS (
                SELECT 1
                FROM Invoices AS i
                WHERE COALESCE(CONVERT(varchar(36), i.ExternalId), '') == @__idempotentKey_0)) | Resolver: c => new RelationalCommandCache(
            c.Dependencies.MemoryCache, 
            c.RelationalDependencies.QuerySqlGeneratorFactory, 
            c.RelationalDependencies.RelationalParameterBasedSqlProcessorFactory, 
            Projection Mapping:
                EmptyProjectionMember -> 0
            SELECT EXISTS (
                SELECT 1
                FROM Invoices AS i
                WHERE COALESCE(CONVERT(varchar(36), i.ExternalId), '') == @__idempotentKey_0), 
            False, 
            new HashSet<string>(
                new string[]{ }, 
                StringComparer.Ordinal
            )
        )].GetRelationalCommandTemplate(parameters), 
        readerColumns: null, 
        shaper: (queryContext, dataReader, resultContext, resultCoordinator) => 
        {
            bool? value1;
            value1 = dataReader.IsDBNull(0) ? default(bool?) : (bool?)dataReader.GetBoolean(0);
            return (bool)value1;
        }, 
        contextType: BillingSystem.Infrastructure.EF.BillingServiceDBContext, 
        standAloneStateManager: False, 
        detailedErrorsEnabled: False, 
        threadSafetyChecksEnabled: True), 
    cancellationToken: queryContext.CancellationToken)'
2025-12-10 11:31:40.561 +03:00 [DBG] Creating DbConnection.
2025-12-10 11:31:40.588 +03:00 [DBG] Created DbConnection. (24ms).
2025-12-10 11:31:40.596 +03:00 [DBG] Opening connection to database 'GAC-BillingService' on server '.'.
2025-12-10 11:31:40.950 +03:00 [DBG] Opened connection to database 'GAC-BillingService' on server '.'.
2025-12-10 11:31:40.962 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-12-10 11:31:40.981 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (12ms).
2025-12-10 11:31:41.005 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (43ms).
2025-12-10 11:31:41.021 +03:00 [DBG] Executing DbCommand [Parameters=[@__idempotentKey_0='?' (Size = 36) (DbType = AnsiString)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [Invoices] AS [i]
        WHERE CONVERT(varchar(36), [i].[ExternalId]) = @__idempotentKey_0) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2025-12-10 11:31:41.127 +03:00 [INF] Executed DbCommand (104ms) [Parameters=[@__idempotentKey_0='?' (Size = 36) (DbType = AnsiString)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [Invoices] AS [i]
        WHERE CONVERT(varchar(36), [i].[ExternalId]) = @__idempotentKey_0) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2025-12-10 11:31:41.155 +03:00 [DBG] Closing data reader to 'GAC-BillingService' on server '.'.
2025-12-10 11:31:41.169 +03:00 [DBG] A data reader for 'GAC-BillingService' on server '.' is being disposed after spending 27ms reading results.
2025-12-10 11:31:41.178 +03:00 [DBG] Closing connection to database 'GAC-BillingService' on server '.'.
2025-12-10 11:31:41.186 +03:00 [DBG] Closed connection to database 'GAC-BillingService' on server '.' (8ms).
2025-12-10 11:31:41.400 +03:00 [WRN] You do not have a valid license key for the Lucky Penny software AutoMapper. This is allowed for development and testing scenarios. If you are running in production you are required to have a licensed version. Please visit https://luckypennysoftware.com to obtain a valid license.
2025-12-10 11:31:41.494 +03:00 [DBG] Opening connection to database 'GAC-BillingService' on server '.'.
2025-12-10 11:31:41.509 +03:00 [DBG] Opened connection to database 'GAC-BillingService' on server '.'.
2025-12-10 11:31:41.520 +03:00 [DBG] Beginning transaction with isolation level 'Unspecified'.
2025-12-10 11:31:41.541 +03:00 [DBG] Began transaction with isolation level 'ReadCommitted'.
2025-12-10 11:31:41.550 +03:00 [DBG] Compiling query expression: 
'DbSet<InvoiceSequenceValue>().FromSql(EXECUTE dbo.GetNextInvoiceNumber, __p_0)
'
2025-12-10 11:31:41.630 +03:00 [DBG] Generated query execution expression: 
'queryContext => FromSqlQueryingEnumerable.Create<InvoiceSequenceValue>(
    relationalQueryContext: (RelationalQueryContext)queryContext, 
    relationalCommandResolver: parameters => [LIFTABLE Constant: RelationalCommandCache.QueryExpression(
        Projection Mapping:
            EmptyProjectionMember -> Dictionary<IProperty, int> { [Property: InvoiceSequenceValue.Value (long) Required, 0] }
        SELECT b.Value
        FROM EXECUTE dbo.GetNextInvoiceNumber) | Resolver: c => new RelationalCommandCache(
        c.Dependencies.MemoryCache, 
        c.RelationalDependencies.QuerySqlGeneratorFactory, 
        c.RelationalDependencies.RelationalParameterBasedSqlProcessorFactory, 
        Projection Mapping:
            EmptyProjectionMember -> Dictionary<IProperty, int> { [Property: InvoiceSequenceValue.Value (long) Required, 0] }
        SELECT b.Value
        FROM EXECUTE dbo.GetNextInvoiceNumber, 
        False, 
        new HashSet<string>(
            new string[]{ }, 
            StringComparer.Ordinal
        )
    )].GetRelationalCommandTemplate(parameters), 
    readerColumns: null, 
    columnNames: [LIFTABLE Constant: string[] { "Value" } | Resolver: _ => new string[]{ "Value" }], 
    shaper: (queryContext, dataReader, indexMap) => 
    {
        InvoiceSequenceValue entity;
        entity = 
        {
            MaterializationContext materializationContext1;
            IEntityType entityType1;
            InvoiceSequenceValue instance1;
            materializationContext1 = new MaterializationContext(
                [LIFTABLE Constant: ValueBuffer | Resolver: _ => (object)ValueBuffer.Empty], 
                queryContext.Context
            );
            instance1 = default(InvoiceSequenceValue);
            {
                ISnapshot shadowSnapshot1;
                shadowSnapshot1 = [LIFTABLE Constant: Snapshot | Resolver: _ => Snapshot.Empty];
                entityType1 = [LIFTABLE Constant: EntityType: InvoiceSequenceValue Keyless | Resolver: namelessParameter{0} => namelessParameter{0}.Dependencies.Model.FindEntityType("BillingSystem.Domain.Entities.InvoiceSequenceValue")];
                instance1 = switch (entityType1)
                {
                    case [LIFTABLE Constant: EntityType: InvoiceSequenceValue Keyless | Resolver: namelessParameter{1} => namelessParameter{1}.Dependencies.Model.FindEntityType("BillingSystem.Domain.Entities.InvoiceSequenceValue")]: 
                        {
                            return 
                            {
                                InvoiceSequenceValue instance;
                                instance = new InvoiceSequenceValue();
                                instance.<Value>k__BackingField = dataReader.GetInt64(indexMap[0]);
                                (instance is IInjectableService) ? ((IInjectableService)instance).Injected(
                                    context: materializationContext1.Context, 
                                    entity: instance, 
                                    queryTrackingBehavior: TrackAll, 
                                    structuralType: [LIFTABLE Constant: EntityType: InvoiceSequenceValue Keyless | Resolver: namelessParameter{2} => namelessParameter{2}.Dependencies.Model.FindEntityType("BillingSystem.Domain.Entities.InvoiceSequenceValue")]) : default(void);
                                return instance;
                            }}
                    default: 
                        default(InvoiceSequenceValue)
                }
                ;
                return instance1;
            }return instance1;
        };
        return entity;
    }, 
    contextType: BillingSystem.Infrastructure.EF.BillingServiceDBContext, 
    standAloneStateManager: False, 
    detailedErrorsEnabled: False, 
    threadSafetyChecksEnabled: True)'
2025-12-10 11:31:41.648 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-12-10 11:31:41.654 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (5ms).
2025-12-10 11:31:41.660 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (12ms).
2025-12-10 11:31:41.664 +03:00 [DBG] Executing DbCommand [Parameters=[], CommandType='"Text"', CommandTimeout='30']
EXECUTE dbo.GetNextInvoiceNumber
2025-12-10 11:31:41.676 +03:00 [INF] Executed DbCommand (12ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
EXECUTE dbo.GetNextInvoiceNumber
2025-12-10 11:31:41.691 +03:00 [DBG] Closing data reader to 'GAC-BillingService' on server '.'.
2025-12-10 11:31:41.698 +03:00 [DBG] A data reader for 'GAC-BillingService' on server '.' is being disposed after spending 12ms reading results.
2025-12-10 11:31:41.709 +03:00 [DBG] Compiling query expression: 
'DbSet<Customer>()
    .FirstOrDefault(c => c.IdentityNumber == __cutomerIdentityNumber_0)'
2025-12-10 11:31:41.739 +03:00 [DBG] Generated query execution expression: 
'queryContext => SingleQueryingEnumerable.Create<Customer>(
    relationalQueryContext: (RelationalQueryContext)queryContext, 
    relationalCommandResolver: parameters => [LIFTABLE Constant: RelationalCommandCache.QueryExpression(
        Projection Mapping:
            EmptyProjectionMember -> Dictionary<IProperty, int> { [Property: Customer.Id (long) Required PK AfterSave:Throw ValueGenerated.OnAdd, 0], [Property: Customer.AddressBuildingNumber (string) MaxLength(200), 1], [Property: Customer.AddressCity (string) Required MaxLength(200), 2], [Property: Customer.AddressCountry (string) Required MaxLength(200), 3], [Property: Customer.AddressDistrict (string) Required MaxLength(200), 4], [Property: Customer.AddressPostalCode (string) Required MaxLength(50), 5], [Property: Customer.AddressStreet (string) MaxLength(200), 6], [Property: Customer.AddressSubNumber (string) MaxLength(200), 7], [Property: Customer.CreatedBy (string) Required MaxLength(50), 8], [Property: Customer.CreatedDate (DateTime) Required, 9], [Property: Customer.CustomerType (string) Required MaxLength(100), 10], [Property: Customer.EmailAddress (string) MaxLength(80), 11], [Property: Customer.FullName (string) Required MaxLength(500), 12], [Property: Customer.IdentityNumber (string) Required MaxLength(100), 13], [Property: Customer.IdentityType (int?), 14], [Property: Customer.IsDeleted (bool) Required, 15], [Property: Customer.LastUpdatedDate (DateTime?), 16], [Property: Customer.OverpaymentBalance (decimal?), 17], [Property: Customer.PhoneNumber (string) MaxLength(50), 18], [Property: Customer.Vatnumber (string) MaxLength(100), 19] }
        SELECT TOP(1) c.Id, c.Address_BuildingNumber, c.Address_City, c.Address_Country, c.Address_District, c.Address_PostalCode, c.Address_Street, c.Address_SubNumber, c.CreatedBy, c.CreatedDate, c.CustomerType, c.EmailAddress, c.FullName, c.IdentityNumber, c.IdentityType, c.IsDeleted, c.LastUpdatedDate, c.OverpaymentBalance, c.PhoneNumber, c.VATNumber
        FROM Customers AS c
        WHERE c.IdentityNumber == @__cutomerIdentityNumber_0) | Resolver: c => new RelationalCommandCache(
        c.Dependencies.MemoryCache, 
        c.RelationalDependencies.QuerySqlGeneratorFactory, 
        c.RelationalDependencies.RelationalParameterBasedSqlProcessorFactory, 
        Projection Mapping:
            EmptyProjectionMember -> Dictionary<IProperty, int> { [Property: Customer.Id (long) Required PK AfterSave:Throw ValueGenerated.OnAdd, 0], [Property: Customer.AddressBuildingNumber (string) MaxLength(200), 1], [Property: Customer.AddressCity (string) Required MaxLength(200), 2], [Property: Customer.AddressCountry (string) Required MaxLength(200), 3], [Property: Customer.AddressDistrict (string) Required MaxLength(200), 4], [Property: Customer.AddressPostalCode (string) Required MaxLength(50), 5], [Property: Customer.AddressStreet (string) MaxLength(200), 6], [Property: Customer.AddressSubNumber (string) MaxLength(200), 7], [Property: Customer.CreatedBy (string) Required MaxLength(50), 8], [Property: Customer.CreatedDate (DateTime) Required, 9], [Property: Customer.CustomerType (string) Required MaxLength(100), 10], [Property: Customer.EmailAddress (string) MaxLength(80), 11], [Property: Customer.FullName (string) Required MaxLength(500), 12], [Property: Customer.IdentityNumber (string) Required MaxLength(100), 13], [Property: Customer.IdentityType (int?), 14], [Property: Customer.IsDeleted (bool) Required, 15], [Property: Customer.LastUpdatedDate (DateTime?), 16], [Property: Customer.OverpaymentBalance (decimal?), 17], [Property: Customer.PhoneNumber (string) MaxLength(50), 18], [Property: Customer.Vatnumber (string) MaxLength(100), 19] }
        SELECT TOP(1) c.Id, c.Address_BuildingNumber, c.Address_City, c.Address_Country, c.Address_District, c.Address_PostalCode, c.Address_Street, c.Address_SubNumber, c.CreatedBy, c.CreatedDate, c.CustomerType, c.EmailAddress, c.FullName, c.IdentityNumber, c.IdentityType, c.IsDeleted, c.LastUpdatedDate, c.OverpaymentBalance, c.PhoneNumber, c.VATNumber
        FROM Customers AS c
        WHERE c.IdentityNumber == @__cutomerIdentityNumber_0, 
        False, 
        new HashSet<string>(
            new string[]{ }, 
            StringComparer.Ordinal
        )
    )].GetRelationalCommandTemplate(parameters), 
    readerColumns: null, 
    shaper: (queryContext, dataReader, resultContext, resultCoordinator) => 
    {
        Customer entity;
        entity = 
        {
            MaterializationContext materializationContext1;
            IEntityType entityType1;
            Customer instance1;
            InternalEntityEntry entry1;
            bool hasNullKey1;
            materializationContext1 = new MaterializationContext(
                [LIFTABLE Constant: ValueBuffer | Resolver: _ => (object)ValueBuffer.Empty], 
                queryContext.Context
            );
            instance1 = default(Customer);
            entry1 = queryContext.TryGetEntry(
                key: [LIFTABLE Constant: Key: Customer.Id PK | Resolver: c => c.Dependencies.Model.FindEntityType("BillingSystem.Domain.Entities.Customer").FindPrimaryKey()], 
                keyValues: new object[]{ (object)dataReader.GetInt64(0) }, 
                throwOnNullKey: True, 
                hasNullKey: hasNullKey1);
            !(hasNullKey1) ? entry1 != default(InternalEntityEntry) ? 
            {
                entityType1 = entry1.EntityType;
                return instance1 = (Customer)entry1.Entity;
            } : 
            {
                ISnapshot shadowSnapshot1;
                shadowSnapshot1 = [LIFTABLE Constant: Snapshot | Resolver: _ => Snapshot.Empty];
                entityType1 = [LIFTABLE Constant: EntityType: Customer | Resolver: namelessParameter{0} => namelessParameter{0}.Dependencies.Model.FindEntityType("BillingSystem.Domain.Entities.Customer")];
                instance1 = switch (entityType1)
                {
                    case [LIFTABLE Constant: EntityType: Customer | Resolver: namelessParameter{1} => namelessParameter{1}.Dependencies.Model.FindEntityType("BillingSystem.Domain.Entities.Customer")]: 
                        {
                            return 
                            {
                                Customer instance;
                                instance = new Customer();
                                instance.<Id>k__BackingField = dataReader.GetInt64(0);
                                instance.<AddressBuildingNumber>k__BackingField = dataReader.IsDBNull(1) ? default(string) : dataReader.GetString(1);
                                instance.<AddressCity>k__BackingField = dataReader.GetString(2);
                                instance.<AddressCountry>k__BackingField = dataReader.GetString(3);
                                instance.<AddressDistrict>k__BackingField = dataReader.GetString(4);
                                instance.<AddressPostalCode>k__BackingField = dataReader.GetString(5);
                                instance.<AddressStreet>k__BackingField = dataReader.IsDBNull(6) ? default(string) : dataReader.GetString(6);
                                instance.<AddressSubNumber>k__BackingField = dataReader.IsDBNull(7) ? default(string) : dataReader.GetString(7);
                                instance.<CreatedBy>k__BackingField = dataReader.GetString(8);
                                instance.<CreatedDate>k__BackingField = dataReader.GetDateTime(9);
                                instance.<CustomerType>k__BackingField = dataReader.GetString(10);
                                instance.<EmailAddress>k__BackingField = dataReader.IsDBNull(11) ? default(string) : dataReader.GetString(11);
                                instance.<FullName>k__BackingField = dataReader.GetString(12);
                                instance.<IdentityNumber>k__BackingField = dataReader.GetString(13);
                                instance.<IdentityType>k__BackingField = dataReader.IsDBNull(14) ? default(int?) : (int?)dataReader.GetInt32(14);
                                instance.<IsDeleted>k__BackingField = dataReader.GetBoolean(15);
                                instance.<LastUpdatedDate>k__BackingField = dataReader.IsDBNull(16) ? default(DateTime?) : (DateTime?)dataReader.GetDateTime(16);
                                instance.<OverpaymentBalance>k__BackingField = dataReader.IsDBNull(17) ? default(decimal?) : (decimal?)dataReader.GetDecimal(17);
                                instance.<PhoneNumber>k__BackingField = dataReader.IsDBNull(18) ? default(string) : dataReader.GetString(18);
                                instance.<Vatnumber>k__BackingField = dataReader.IsDBNull(19) ? default(string) : dataReader.GetString(19);
                                (instance is IInjectableService) ? ((IInjectableService)instance).Injected(
                                    context: materializationContext1.Context, 
                                    entity: instance, 
                                    queryTrackingBehavior: TrackAll, 
                                    structuralType: [LIFTABLE Constant: EntityType: Customer | Resolver: namelessParameter{2} => namelessParameter{2}.Dependencies.Model.FindEntityType("BillingSystem.Domain.Entities.Customer")]) : default(void);
                                return instance;
                            }}
                    default: 
                        default(Customer)
                }
                ;
                entry1 = entityType1 == default(IEntityType) ? default(InternalEntityEntry) : queryContext.StartTracking(
                    entityType: entityType1, 
                    entity: instance1, 
                    snapshot: shadowSnapshot1);
                return instance1;
            } : default(void);
            return instance1;
        };
        return entity;
    }, 
    contextType: BillingSystem.Infrastructure.EF.BillingServiceDBContext, 
    standAloneStateManager: False, 
    detailedErrorsEnabled: False, 
    threadSafetyChecksEnabled: True)
    .SingleOrDefault()'
2025-12-10 11:31:41.761 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-12-10 11:31:41.767 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (5ms).
2025-12-10 11:31:41.769 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (7ms).
2025-12-10 11:31:41.771 +03:00 [DBG] Executing DbCommand [Parameters=[@__cutomerIdentityNumber_0='?' (Size = 100)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[Id], [c].[Address_BuildingNumber], [c].[Address_City], [c].[Address_Country], [c].[Address_District], [c].[Address_PostalCode], [c].[Address_Street], [c].[Address_SubNumber], [c].[CreatedBy], [c].[CreatedDate], [c].[CustomerType], [c].[EmailAddress], [c].[FullName], [c].[IdentityNumber], [c].[IdentityType], [c].[IsDeleted], [c].[LastUpdatedDate], [c].[OverpaymentBalance], [c].[PhoneNumber], [c].[VATNumber]
FROM [Customers] AS [c]
WHERE [c].[IdentityNumber] = @__cutomerIdentityNumber_0
2025-12-10 11:31:41.778 +03:00 [INF] Executed DbCommand (8ms) [Parameters=[@__cutomerIdentityNumber_0='?' (Size = 100)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[Id], [c].[Address_BuildingNumber], [c].[Address_City], [c].[Address_Country], [c].[Address_District], [c].[Address_PostalCode], [c].[Address_Street], [c].[Address_SubNumber], [c].[CreatedBy], [c].[CreatedDate], [c].[CustomerType], [c].[EmailAddress], [c].[FullName], [c].[IdentityNumber], [c].[IdentityType], [c].[IsDeleted], [c].[LastUpdatedDate], [c].[OverpaymentBalance], [c].[PhoneNumber], [c].[VATNumber]
FROM [Customers] AS [c]
WHERE [c].[IdentityNumber] = @__cutomerIdentityNumber_0
2025-12-10 11:31:41.845 +03:00 [DBG] Context 'BillingServiceDBContext' started tracking 'Customer' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-12-10 11:31:41.922 +03:00 [DBG] Closing data reader to 'GAC-BillingService' on server '.'.
2025-12-10 11:31:41.928 +03:00 [DBG] A data reader for 'GAC-BillingService' on server '.' is being disposed after spending 145ms reading results.
2025-12-10 11:31:41.973 +03:00 [DBG] 'BillingServiceDBContext' generated a temporary value for the property 'Invoice.Id'. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-12-10 11:31:42.121 +03:00 [DBG] Context 'BillingServiceDBContext' started tracking 'Invoice' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-12-10 11:31:42.132 +03:00 [DBG] 'BillingServiceDBContext' generated a temporary value for the property 'InvoicesAttachment.Id'. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-12-10 11:31:42.147 +03:00 [DBG] The navigation 'InvoicesAttachment.Invoice' was detected as changed. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-12-10 11:31:42.158 +03:00 [DBG] Context 'BillingServiceDBContext' started tracking 'InvoicesAttachment' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-12-10 11:31:42.166 +03:00 [DBG] 'BillingServiceDBContext' generated a temporary value for the property 'InvoicesItem.Id'. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-12-10 11:31:42.189 +03:00 [DBG] The navigation 'InvoicesItem.Invoice' was detected as changed. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-12-10 11:31:42.195 +03:00 [DBG] Context 'BillingServiceDBContext' started tracking 'InvoicesItem' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-12-10 11:31:42.204 +03:00 [DBG] SaveChanges starting for 'BillingServiceDBContext'.
2025-12-10 11:31:42.212 +03:00 [DBG] DetectChanges starting for 'BillingServiceDBContext'.
2025-12-10 11:31:42.286 +03:00 [DBG] DetectChanges completed for 'BillingServiceDBContext'.
2025-12-10 11:31:42.442 +03:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-12-10 11:31:42.450 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-12-10 11:31:42.452 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (2ms).
2025-12-10 11:31:42.458 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (7ms).
2025-12-10 11:31:42.463 +03:00 [DBG] Executing DbCommand [Parameters=[@p0='?' (Precision = 18) (DbType = Decimal), @p1='?' (Size = 3000), @p2='?' (Size = 100), @p3='?' (Size = 50), @p4='?' (DbType = DateTime), @p5='?' (Size = 50), @p6='?' (DbType = Int64), @p7='?' (DbType = Int64), @p8='?' (DbType = DateTime), @p9='?' (DbType = Guid), @p10='?' (Size = 50), @p11='?' (DbType = Int32), @p12='?' (DbType = Int32), @p13='?' (DbType = Boolean), @p14='?' (DbType = Boolean), @p15='?' (DbType = Boolean), @p16='?' (DbType = Boolean), @p17='?' (DbType = DateTime), @p18='?' (DbType = DateTime), @p19='?' (Size = 4000), @p20='?' (Size = 100), @p21='?' (Size = 100), @p22='?' (DbType = Int64), @p23='?' (Size = 4000), @p24='?' (DbType = Int64), @p25='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [Invoices] ([Amount], [CancelationReasons], [ClientReferenceNumber], [CreatedBy], [CreatedDate], [Currency], [CustomerID], [DiscountedPrimaryInvoiceID], [DueAt], [ExternalId], [InvoiceNumber], [InvoiceStatus], [InvoiceType], [IsDeleted], [IsDiscounted], [IsSubInvoice], [IsSubstitution], [IssuedAt], [LastUpdatedDate], [Metadata], [PaymentProvider], [PaymentReference], [PrimaryInvoiceID], [ProviderResponse], [SubstitutionPrimaryInvoiceID], [TenantId])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18, @p19, @p20, @p21, @p22, @p23, @p24, @p25);
2025-12-10 11:31:42.484 +03:00 [INF] Executed DbCommand (23ms) [Parameters=[@p0='?' (Precision = 18) (DbType = Decimal), @p1='?' (Size = 3000), @p2='?' (Size = 100), @p3='?' (Size = 50), @p4='?' (DbType = DateTime), @p5='?' (Size = 50), @p6='?' (DbType = Int64), @p7='?' (DbType = Int64), @p8='?' (DbType = DateTime), @p9='?' (DbType = Guid), @p10='?' (Size = 50), @p11='?' (DbType = Int32), @p12='?' (DbType = Int32), @p13='?' (DbType = Boolean), @p14='?' (DbType = Boolean), @p15='?' (DbType = Boolean), @p16='?' (DbType = Boolean), @p17='?' (DbType = DateTime), @p18='?' (DbType = DateTime), @p19='?' (Size = 4000), @p20='?' (Size = 100), @p21='?' (Size = 100), @p22='?' (DbType = Int64), @p23='?' (Size = 4000), @p24='?' (DbType = Int64), @p25='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [Invoices] ([Amount], [CancelationReasons], [ClientReferenceNumber], [CreatedBy], [CreatedDate], [Currency], [CustomerID], [DiscountedPrimaryInvoiceID], [DueAt], [ExternalId], [InvoiceNumber], [InvoiceStatus], [InvoiceType], [IsDeleted], [IsDiscounted], [IsSubInvoice], [IsSubstitution], [IssuedAt], [LastUpdatedDate], [Metadata], [PaymentProvider], [PaymentReference], [PrimaryInvoiceID], [ProviderResponse], [SubstitutionPrimaryInvoiceID], [TenantId])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18, @p19, @p20, @p21, @p22, @p23, @p24, @p25);
2025-12-10 11:31:42.507 +03:00 [DBG] The foreign key property 'Invoice.Id' was detected as changed. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see property values.
2025-12-10 11:31:42.518 +03:00 [DBG] The foreign key property 'InvoicesAttachment.InvoiceId' was detected as changed. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see property values.
2025-12-10 11:31:42.527 +03:00 [DBG] The foreign key property 'InvoicesItem.InvoiceId' was detected as changed. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see property values.
2025-12-10 11:31:42.535 +03:00 [DBG] Closing data reader to 'GAC-BillingService' on server '.'.
2025-12-10 11:31:42.537 +03:00 [DBG] A data reader for 'GAC-BillingService' on server '.' is being disposed after spending 46ms reading results.
2025-12-10 11:31:42.545 +03:00 [DBG] Executing 2 update commands as a batch.
2025-12-10 11:31:42.548 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-12-10 11:31:42.550 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (1ms).
2025-12-10 11:31:42.553 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (4ms).
2025-12-10 11:31:42.556 +03:00 [DBG] Executing DbCommand [Parameters=[@p26='?' (Size = 50), @p27='?' (DbType = DateTime), @p28='?' (Size = 200), @p29='?' (DbType = Int64), @p30='?' (DbType = Boolean), @p31='?' (Precision = 18) (DbType = Decimal), @p32='?' (Size = 50), @p33='?' (DbType = DateTime), @p34='?' (DbType = Int64), @p35='?' (DbType = Boolean), @p36='?' (Size = 500), @p37='?' (Size = 200), @p38='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SET NOCOUNT ON;
INSERT INTO [InvoicesAttachments] ([CreatedBy], [CreatedDate], [FileName], [InvoiceId], [IsDeleted])
OUTPUT INSERTED.[Id]
VALUES (@p26, @p27, @p28, @p29, @p30);
INSERT INTO [InvoicesItems] ([Amount], [CreatedBy], [CreatedDate], [InvoiceId], [IsDeleted], [ItemDesc], [ItemName], [Quantity])
OUTPUT INSERTED.[Id]
VALUES (@p31, @p32, @p33, @p34, @p35, @p36, @p37, @p38);
2025-12-10 11:31:42.564 +03:00 [INF] Executed DbCommand (8ms) [Parameters=[@p26='?' (Size = 50), @p27='?' (DbType = DateTime), @p28='?' (Size = 200), @p29='?' (DbType = Int64), @p30='?' (DbType = Boolean), @p31='?' (Precision = 18) (DbType = Decimal), @p32='?' (Size = 50), @p33='?' (DbType = DateTime), @p34='?' (DbType = Int64), @p35='?' (DbType = Boolean), @p36='?' (Size = 500), @p37='?' (Size = 200), @p38='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SET NOCOUNT ON;
INSERT INTO [InvoicesAttachments] ([CreatedBy], [CreatedDate], [FileName], [InvoiceId], [IsDeleted])
OUTPUT INSERTED.[Id]
VALUES (@p26, @p27, @p28, @p29, @p30);
INSERT INTO [InvoicesItems] ([Amount], [CreatedBy], [CreatedDate], [InvoiceId], [IsDeleted], [ItemDesc], [ItemName], [Quantity])
OUTPUT INSERTED.[Id]
VALUES (@p31, @p32, @p33, @p34, @p35, @p36, @p37, @p38);
2025-12-10 11:31:42.569 +03:00 [DBG] The foreign key property 'InvoicesAttachment.Id' was detected as changed. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see property values.
2025-12-10 11:31:42.574 +03:00 [DBG] The foreign key property 'InvoicesItem.Id' was detected as changed. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see property values.
2025-12-10 11:31:42.578 +03:00 [DBG] Closing data reader to 'GAC-BillingService' on server '.'.
2025-12-10 11:31:42.580 +03:00 [DBG] A data reader for 'GAC-BillingService' on server '.' is being disposed after spending 12ms reading results.
2025-12-10 11:31:42.593 +03:00 [DBG] An entity of type 'Invoice' tracked by 'BillingServiceDBContext' changed state from '"Added"' to '"Unchanged"'. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-12-10 11:31:42.604 +03:00 [DBG] An entity of type 'InvoicesAttachment' tracked by 'BillingServiceDBContext' changed state from '"Added"' to '"Unchanged"'. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-12-10 11:31:42.612 +03:00 [DBG] An entity of type 'InvoicesItem' tracked by 'BillingServiceDBContext' changed state from '"Added"' to '"Unchanged"'. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-12-10 11:31:42.619 +03:00 [DBG] SaveChanges completed for 'BillingServiceDBContext' with 3 entities written to the database.
2025-12-10 11:31:42.770 +03:00 [ERR] exception occured Self referencing loop detected for property 'Customer' with type 'BillingSystem.Domain.Entities.Customer'. Path 'Customer.Invoices[0]'. , stackTrace    at Newtonsoft.Json.Serialization.JsonSerializerInternalWriter.CheckForCircularReference(JsonWriter writer, Object value, JsonProperty property, JsonContract contract, JsonContainerContract containerContract, JsonProperty containerProperty)
   at Newtonsoft.Json.Serialization.JsonSerializerInternalWriter.CalculatePropertyValues(JsonWriter writer, Object value, JsonContainerContract contract, JsonProperty member, JsonProperty property, JsonContract& memberContract, Object& memberValue)
   at Newtonsoft.Json.Serialization.JsonSerializerInternalWriter.SerializeObject(JsonWriter writer, Object value, JsonObjectContract contract, JsonProperty member, JsonContainerContract collectionContract, JsonProperty containerProperty)
   at Newtonsoft.Json.Serialization.JsonSerializerInternalWriter.SerializeValue(JsonWriter writer, Object value, JsonContract valueContract, JsonProperty member, JsonContainerContract containerContract, JsonProperty containerProperty)
   at Newtonsoft.Json.Serialization.JsonSerializerInternalWriter.SerializeList(JsonWriter writer, IEnumerable values, JsonArrayContract contract, JsonProperty member, JsonContainerContract collectionContract, JsonProperty containerProperty)
   at Newtonsoft.Json.Serialization.JsonSerializerInternalWriter.SerializeValue(JsonWriter writer, Object value, JsonContract valueContract, JsonProperty member, JsonContainerContract containerContract, JsonProperty containerProperty)
   at Newtonsoft.Json.Serialization.JsonSerializerInternalWriter.SerializeObject(JsonWriter writer, Object value, JsonObjectContract contract, JsonProperty member, JsonContainerContract collectionContract, JsonProperty containerProperty)
   at Newtonsoft.Json.Serialization.JsonSerializerInternalWriter.SerializeValue(JsonWriter writer, Object value, JsonContract valueContract, JsonProperty member, JsonContainerContract containerContract, JsonProperty containerProperty)
   at Newtonsoft.Json.Serialization.JsonSerializerInternalWriter.SerializeObject(JsonWriter writer, Object value, JsonObjectContract contract, JsonProperty member, JsonContainerContract collectionContract, JsonProperty containerProperty)
   at Newtonsoft.Json.Serialization.JsonSerializerInternalWriter.SerializeValue(JsonWriter writer, Object value, JsonContract valueContract, JsonProperty member, JsonContainerContract containerContract, JsonProperty containerProperty)
   at Newtonsoft.Json.Serialization.JsonSerializerInternalWriter.Serialize(JsonWriter jsonWriter, Object value, Type objectType)
   at Newtonsoft.Json.JsonSerializer.SerializeInternal(JsonWriter jsonWriter, Object value, Type objectType)
   at Newtonsoft.Json.JsonSerializer.Serialize(JsonWriter jsonWriter, Object value, Type objectType)
   at Newtonsoft.Json.JsonConvert.SerializeObjectInternal(Object value, Type type, JsonSerializer jsonSerializer)
   at Newtonsoft.Json.JsonConvert.SerializeObject(Object value, Type type, JsonSerializerSettings settings)
   at Newtonsoft.Json.JsonConvert.SerializeObject(Object value)
   at BillingSystem.Infrastructure.Persistence.EF.InvoiceRepository.InsertTransactional(Invoice entity, AuditEvent auditEvent) in C:\Repositories\Gac-BillingSystem\src\BillingSystem.Infrastructure\Persistence\EF\InvoiceRepository.cs:line 102
2025-12-10 11:31:42.777 +03:00 [DBG] Rolling back transaction.
2025-12-10 11:31:42.787 +03:00 [DBG] Rolled back transaction.
2025-12-10 11:31:42.792 +03:00 [DBG] Closing connection to database 'GAC-BillingService' on server '.'.
2025-12-10 11:31:42.798 +03:00 [DBG] Closed connection to database 'GAC-BillingService' on server '.' (5ms).
2025-12-10 11:31:42.847 +03:00 [DBG] Disposing transaction.
2025-12-10 11:31:42.933 +03:00 [ERR] exception occured Self referencing loop detected for property 'Customer' with type 'BillingSystem.Domain.Entities.Customer'. Path 'Customer.Invoices[0]'. , stackTrace    at Newtonsoft.Json.Serialization.JsonSerializerInternalWriter.CheckForCircularReference(JsonWriter writer, Object value, JsonProperty property, JsonContract contract, JsonContainerContract containerContract, JsonProperty containerProperty)
   at Newtonsoft.Json.Serialization.JsonSerializerInternalWriter.CalculatePropertyValues(JsonWriter writer, Object value, JsonContainerContract contract, JsonProperty member, JsonProperty property, JsonContract& memberContract, Object& memberValue)
   at Newtonsoft.Json.Serialization.JsonSerializerInternalWriter.SerializeObject(JsonWriter writer, Object value, JsonObjectContract contract, JsonProperty member, JsonContainerContract collectionContract, JsonProperty containerProperty)
   at Newtonsoft.Json.Serialization.JsonSerializerInternalWriter.SerializeValue(JsonWriter writer, Object value, JsonContract valueContract, JsonProperty member, JsonContainerContract containerContract, JsonProperty containerProperty)
   at Newtonsoft.Json.Serialization.JsonSerializerInternalWriter.SerializeList(JsonWriter writer, IEnumerable values, JsonArrayContract contract, JsonProperty member, JsonContainerContract collectionContract, JsonProperty containerProperty)
   at Newtonsoft.Json.Serialization.JsonSerializerInternalWriter.SerializeValue(JsonWriter writer, Object value, JsonContract valueContract, JsonProperty member, JsonContainerContract containerContract, JsonProperty containerProperty)
   at Newtonsoft.Json.Serialization.JsonSerializerInternalWriter.SerializeObject(JsonWriter writer, Object value, JsonObjectContract contract, JsonProperty member, JsonContainerContract collectionContract, JsonProperty containerProperty)
   at Newtonsoft.Json.Serialization.JsonSerializerInternalWriter.SerializeValue(JsonWriter writer, Object value, JsonContract valueContract, JsonProperty member, JsonContainerContract containerContract, JsonProperty containerProperty)
   at Newtonsoft.Json.Serialization.JsonSerializerInternalWriter.SerializeObject(JsonWriter writer, Object value, JsonObjectContract contract, JsonProperty member, JsonContainerContract collectionContract, JsonProperty containerProperty)
   at Newtonsoft.Json.Serialization.JsonSerializerInternalWriter.SerializeValue(JsonWriter writer, Object value, JsonContract valueContract, JsonProperty member, JsonContainerContract containerContract, JsonProperty containerProperty)
   at Newtonsoft.Json.Serialization.JsonSerializerInternalWriter.Serialize(JsonWriter jsonWriter, Object value, Type objectType)
   at Newtonsoft.Json.JsonSerializer.SerializeInternal(JsonWriter jsonWriter, Object value, Type objectType)
   at Newtonsoft.Json.JsonSerializer.Serialize(JsonWriter jsonWriter, Object value, Type objectType)
   at Newtonsoft.Json.JsonConvert.SerializeObjectInternal(Object value, Type type, JsonSerializer jsonSerializer)
   at Newtonsoft.Json.JsonConvert.SerializeObject(Object value, Type type, JsonSerializerSettings settings)
   at Newtonsoft.Json.JsonConvert.SerializeObject(Object value)
   at BillingSystem.Infrastructure.Persistence.EF.InvoiceRepository.InsertTransactional(Invoice entity, AuditEvent auditEvent) in C:\Repositories\Gac-BillingSystem\src\BillingSystem.Infrastructure\Persistence\EF\InvoiceRepository.cs:line 102
   at BillingSystem.Application.Commands.CreateInvoiceCommandRequestHandler.Handle(CreateInvoiceRequest request, CancellationToken cancellationToken) in C:\Repositories\Gac-BillingSystem\src\BillingSystem.Application\Commands\CreateInvoiceCommandRequestHandler.cs:line 70
   at BillingSystem.API.Controllers.InvoicesController.Post(CreateInvoiceRequest invoiceRequest) in C:\Repositories\Gac-BillingSystem\src\BillingSystem.API\Controllers\InvoicesController.cs:line 57
2025-12-10 11:31:42.939 +03:00 [ERR] exception in Create Invoice API : Self referencing loop detected for property 'Customer' with type 'BillingSystem.Domain.Entities.Customer'. Path 'Customer.Invoices[0]'. ,    at Newtonsoft.Json.Serialization.JsonSerializerInternalWriter.CheckForCircularReference(JsonWriter writer, Object value, JsonProperty property, JsonContract contract, JsonContainerContract containerContract, JsonProperty containerProperty)
   at Newtonsoft.Json.Serialization.JsonSerializerInternalWriter.CalculatePropertyValues(JsonWriter writer, Object value, JsonContainerContract contract, JsonProperty member, JsonProperty property, JsonContract& memberContract, Object& memberValue)
   at Newtonsoft.Json.Serialization.JsonSerializerInternalWriter.SerializeObject(JsonWriter writer, Object value, JsonObjectContract contract, JsonProperty member, JsonContainerContract collectionContract, JsonProperty containerProperty)
   at Newtonsoft.Json.Serialization.JsonSerializerInternalWriter.SerializeValue(JsonWriter writer, Object value, JsonContract valueContract, JsonProperty member, JsonContainerContract containerContract, JsonProperty containerProperty)
   at Newtonsoft.Json.Serialization.JsonSerializerInternalWriter.SerializeList(JsonWriter writer, IEnumerable values, JsonArrayContract contract, JsonProperty member, JsonContainerContract collectionContract, JsonProperty containerProperty)
   at Newtonsoft.Json.Serialization.JsonSerializerInternalWriter.SerializeValue(JsonWriter writer, Object value, JsonContract valueContract, JsonProperty member, JsonContainerContract containerContract, JsonProperty containerProperty)
   at Newtonsoft.Json.Serialization.JsonSerializerInternalWriter.SerializeObject(JsonWriter writer, Object value, JsonObjectContract contract, JsonProperty member, JsonContainerContract collectionContract, JsonProperty containerProperty)
   at Newtonsoft.Json.Serialization.JsonSerializerInternalWriter.SerializeValue(JsonWriter writer, Object value, JsonContract valueContract, JsonProperty member, JsonContainerContract containerContract, JsonProperty containerProperty)
   at Newtonsoft.Json.Serialization.JsonSerializerInternalWriter.SerializeObject(JsonWriter writer, Object value, JsonObjectContract contract, JsonProperty member, JsonContainerContract collectionContract, JsonProperty containerProperty)
   at Newtonsoft.Json.Serialization.JsonSerializerInternalWriter.SerializeValue(JsonWriter writer, Object value, JsonContract valueContract, JsonProperty member, JsonContainerContract containerContract, JsonProperty containerProperty)
   at Newtonsoft.Json.Serialization.JsonSerializerInternalWriter.Serialize(JsonWriter jsonWriter, Object value, Type objectType)
   at Newtonsoft.Json.JsonSerializer.SerializeInternal(JsonWriter jsonWriter, Object value, Type objectType)
   at Newtonsoft.Json.JsonSerializer.Serialize(JsonWriter jsonWriter, Object value, Type objectType)
   at Newtonsoft.Json.JsonConvert.SerializeObjectInternal(Object value, Type type, JsonSerializer jsonSerializer)
   at Newtonsoft.Json.JsonConvert.SerializeObject(Object value, Type type, JsonSerializerSettings settings)
   at Newtonsoft.Json.JsonConvert.SerializeObject(Object value)
   at BillingSystem.Infrastructure.Persistence.EF.InvoiceRepository.InsertTransactional(Invoice entity, AuditEvent auditEvent) in C:\Repositories\Gac-BillingSystem\src\BillingSystem.Infrastructure\Persistence\EF\InvoiceRepository.cs:line 102
   at BillingSystem.Application.Commands.CreateInvoiceCommandRequestHandler.Handle(CreateInvoiceRequest request, CancellationToken cancellationToken) in C:\Repositories\Gac-BillingSystem\src\BillingSystem.Application\Commands\CreateInvoiceCommandRequestHandler.cs:line 70
   at BillingSystem.API.Controllers.InvoicesController.Post(CreateInvoiceRequest invoiceRequest) in C:\Repositories\Gac-BillingSystem\src\BillingSystem.API\Controllers\InvoicesController.cs:line 57
2025-12-10 11:31:42.948 +03:00 [DBG] List of registered output formatters, in the following order: ["Microsoft.AspNetCore.Mvc.Formatters.HttpNoContentOutputFormatter","Microsoft.AspNetCore.Mvc.Formatters.StringOutputFormatter","Microsoft.AspNetCore.Mvc.Formatters.StreamOutputFormatter","Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonOutputFormatter"]
2025-12-10 11:31:42.959 +03:00 [DBG] No information found on request to perform content negotiation.
2025-12-10 11:31:42.962 +03:00 [DBG] Attempting to select the first output formatter in the output formatters list which supports a content type from the explicitly specified content types '["application/json","application/problem+json","application/problem+xml"]'.
2025-12-10 11:31:42.968 +03:00 [DBG] Selected output formatter 'Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonOutputFormatter' and content type 'application/json' to write the response.
2025-12-10 11:31:42.971 +03:00 [INF] Executing ObjectResult, writing value of type 'Microsoft.AspNetCore.Mvc.ProblemDetails'.
2025-12-10 11:31:43.005 +03:00 [INF] Executed action BillingSystem.API.Controllers.InvoicesController.Post (BillingSystem.API) in 4215.1653ms
2025-12-10 11:31:43.012 +03:00 [INF] Executed endpoint 'BillingSystem.API.Controllers.InvoicesController.Post (BillingSystem.API)'
2025-12-10 11:31:43.015 +03:00 [INF] HTTP POST /api/Invoices/Post 500 in 10008ms
CorrelationId: 83624d96-85ad-42e6-96a9-ea1727bd2e13
Request: {
    "externalId": "83624d96-85ad-42e6-96a9-ea1727bd2e13",
    "tenantId": 2,
    "amount": 200000,
    "currency": "SAR",
    "invoiceType": 2,
    "invoiceStatus": 1,
    "issuedAt": "2025-12-10T08:48:29.095Z",
    "dueAt": "2026-12-29T08:48:29.095Z",
    "IsSubInvoice": true,
    "ClientReferenceNumber": "Installment01",
    "customer": {
        "fullName": "Abdualmajeed alharbi",
        "customerType": 1,
        "identityType": 1,
        "address": {
            "addressCountry": "saudi arabia",
            "addressCity": "riyadh",
            "addressPostalCode": "3445",
            "addressDistrict": "laban",
            "addressStreet": "altaif",
            "addressBuildingNumber": "322",
            "addressSubNumber": "433"
        },
        "identityNumber": "1397026390",
        "phoneNumber": "0582982757",
        "emailAddress": "mnsour@gac.gov.sa",
        "vatnumber": ""
    },
    "Metadata": "{\n  \"cityHappened\": 1,\n  \"fineGroupCode\": 258,\n  \"detailFineType\": 258001,\n  \"regPersonID\": 1025326510,\n  \"remarks\": \"remarks\",\n  \"resolutionRef\": \"\",\n  \"resolutionSource\": 0,\n  \"resolutionType\": 0,\n  \"securityOperatorID\": 1025326332\n}",
    "attachments": [
        {
            "fileName": "string",
            "fileContent": ""
        }
    ],
    "items": [
        {
            "itemName": " ",
            "itemDesc": "  200000 ",
            "amount": 200000
        }
    ]
}
Response: {"type":"https://tools.ietf.org/html/rfc9110#section-15.6.1","title":"An error occurred while processing your request.","status":500,"detail":"An error occured on the server, please contact system administrator.","traceId":"00-0e6dbe3eea2531e4a69b1561df2586d6-1f64d178be355ccb-00"}
2025-12-10 11:31:43.026 +03:00 [ERR] HTTP POST /api/Invoices/Post responded 500 in 10033.5291 ms
2025-12-10 11:31:43.030 +03:00 [DBG] Connection id "0HNHNOOIR4A24" completed keep alive response.
2025-12-10 11:31:43.035 +03:00 [DBG] 'BillingServiceDBContext' disposed.
2025-12-10 11:31:43.041 +03:00 [DBG] Disposing connection to database 'GAC-BillingService' on server '.'.
2025-12-10 11:31:43.045 +03:00 [DBG] Disposed connection to database '' on server '' (4ms).
2025-12-10 11:31:43.050 +03:00 [INF] Request finished HTTP/1.1 POST https://localhost:7257/api/Invoices/Post - 500 null application/json; charset=utf-8 10112.0059ms
2025-12-10 11:32:00.275 +03:00 [INF] Request starting HTTP/1.1 POST https://localhost:7257/api/Invoices/Post - application/json 1544
2025-12-10 11:32:00.284 +03:00 [DBG] 1 candidate(s) found for the request path '/api/Invoices/Post'
2025-12-10 11:32:00.289 +03:00 [DBG] Endpoint 'BillingSystem.API.Controllers.InvoicesController.Post (BillingSystem.API)' with route pattern 'api/Invoices/Post' is valid for the request path '/api/Invoices/Post'
2025-12-10 11:32:00.296 +03:00 [DBG] Request matched endpoint 'BillingSystem.API.Controllers.InvoicesController.Post (BillingSystem.API)'
2025-12-10 11:32:00.300 +03:00 [DBG] Static files was skipped as the request already matched an endpoint.
2025-12-10 11:32:00.303 +03:00 [DBG] Connection id "0HNHNOOIR4A24", Request id "0HNHNOOIR4A24:00000002": started reading request body.
2025-12-10 11:32:00.309 +03:00 [DBG] Connection id "0HNHNOOIR4A24", Request id "0HNHNOOIR4A24:00000002": done reading request body.
2025-12-10 11:32:00.317 +03:00 [INF] Executing endpoint 'BillingSystem.API.Controllers.InvoicesController.Post (BillingSystem.API)'
2025-12-10 11:32:00.321 +03:00 [INF] Route matched with {action = "Post", controller = "Invoices"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Post(BillingSystem.Application.Requests.CreateInvoiceRequest) on controller BillingSystem.API.Controllers.InvoicesController (BillingSystem.API).
2025-12-10 11:32:00.324 +03:00 [DBG] Execution plan of authorization filters (in the following order): ["None"]
2025-12-10 11:32:00.328 +03:00 [DBG] Execution plan of resource filters (in the following order): ["None"]
2025-12-10 11:32:00.331 +03:00 [DBG] Execution plan of action filters (in the following order): ["Microsoft.AspNetCore.Mvc.ModelBinding.UnsupportedContentTypeFilter (Order: -3000)","Microsoft.AspNetCore.Mvc.Infrastructure.ModelStateInvalidFilter (Order: -2000)","BillingSystem.API.ActionFilters.IdempotencyFilter (Order: 0)"]
2025-12-10 11:32:00.334 +03:00 [DBG] Execution plan of exception filters (in the following order): ["None"]
2025-12-10 11:32:00.337 +03:00 [DBG] Execution plan of result filters (in the following order): ["Microsoft.AspNetCore.Mvc.Infrastructure.ClientErrorResultFilter (Order: -2000)","Microsoft.AspNetCore.Mvc.ProducesAttribute (Order: 0)","BillingSystem.API.ActionFilters.IdempotencyFilter (Order: 0)"]
2025-12-10 11:32:00.343 +03:00 [DBG] Executing controller factory for controller BillingSystem.API.Controllers.InvoicesController (BillingSystem.API)
2025-12-10 11:32:00.349 +03:00 [DBG] Executed controller factory for controller BillingSystem.API.Controllers.InvoicesController (BillingSystem.API)
2025-12-10 11:32:00.352 +03:00 [DBG] Attempting to bind parameter 'invoiceRequest' of type 'BillingSystem.Application.Requests.CreateInvoiceRequest' ...
2025-12-10 11:32:00.355 +03:00 [DBG] Attempting to bind parameter 'invoiceRequest' of type 'BillingSystem.Application.Requests.CreateInvoiceRequest' using the name '' in request data ...
2025-12-10 11:32:00.359 +03:00 [DBG] Selected input formatter 'Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonInputFormatter' for content type 'application/json'.
2025-12-10 11:32:00.362 +03:00 [DBG] JSON input formatter succeeded, deserializing to type 'BillingSystem.Application.Requests.CreateInvoiceRequest'
2025-12-10 11:32:00.364 +03:00 [DBG] Done attempting to bind parameter 'invoiceRequest' of type 'BillingSystem.Application.Requests.CreateInvoiceRequest'.
2025-12-10 11:32:00.367 +03:00 [DBG] Done attempting to bind parameter 'invoiceRequest' of type 'BillingSystem.Application.Requests.CreateInvoiceRequest'.
2025-12-10 11:32:00.369 +03:00 [DBG] Attempting to validate the bound parameter 'invoiceRequest' of type 'BillingSystem.Application.Requests.CreateInvoiceRequest' ...
2025-12-10 11:32:00.372 +03:00 [DBG] Done attempting to validate the bound parameter 'invoiceRequest' of type 'BillingSystem.Application.Requests.CreateInvoiceRequest'.
2025-12-10 11:32:00.393 +03:00 [DBG] Entity Framework Core 9.0.9 initialized 'BillingServiceDBContext' using provider 'Microsoft.EntityFrameworkCore.SqlServer:9.0.9' with options: EngineType=SqlServer 
2025-12-10 11:32:00.402 +03:00 [DBG] Creating DbConnection.
2025-12-10 11:32:00.405 +03:00 [DBG] Created DbConnection. (3ms).
2025-12-10 11:32:00.410 +03:00 [DBG] Opening connection to database 'GAC-BillingService' on server '.'.
2025-12-10 11:32:00.413 +03:00 [DBG] Opened connection to database 'GAC-BillingService' on server '.'.
2025-12-10 11:32:00.416 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-12-10 11:32:00.418 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (2ms).
2025-12-10 11:32:00.422 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (5ms).
2025-12-10 11:32:00.426 +03:00 [DBG] Executing DbCommand [Parameters=[@__idempotentKey_0='?' (Size = 36) (DbType = AnsiString)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [Invoices] AS [i]
        WHERE CONVERT(varchar(36), [i].[ExternalId]) = @__idempotentKey_0) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2025-12-10 11:32:00.434 +03:00 [INF] Executed DbCommand (8ms) [Parameters=[@__idempotentKey_0='?' (Size = 36) (DbType = AnsiString)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [Invoices] AS [i]
        WHERE CONVERT(varchar(36), [i].[ExternalId]) = @__idempotentKey_0) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2025-12-10 11:32:00.440 +03:00 [DBG] Closing data reader to 'GAC-BillingService' on server '.'.
2025-12-10 11:32:00.443 +03:00 [DBG] A data reader for 'GAC-BillingService' on server '.' is being disposed after spending 3ms reading results.
2025-12-10 11:32:00.448 +03:00 [DBG] Closing connection to database 'GAC-BillingService' on server '.'.
2025-12-10 11:32:00.451 +03:00 [DBG] Closed connection to database 'GAC-BillingService' on server '.' (3ms).
2025-12-10 11:32:00.462 +03:00 [DBG] Opening connection to database 'GAC-BillingService' on server '.'.
2025-12-10 11:32:00.467 +03:00 [DBG] Opened connection to database 'GAC-BillingService' on server '.'.
2025-12-10 11:32:00.474 +03:00 [DBG] Beginning transaction with isolation level 'Unspecified'.
2025-12-10 11:32:00.480 +03:00 [DBG] Began transaction with isolation level 'ReadCommitted'.
2025-12-10 11:32:00.483 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-12-10 11:32:00.485 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (2ms).
2025-12-10 11:32:00.488 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (4ms).
2025-12-10 11:32:00.493 +03:00 [DBG] Executing DbCommand [Parameters=[], CommandType='"Text"', CommandTimeout='30']
EXECUTE dbo.GetNextInvoiceNumber
2025-12-10 11:32:00.499 +03:00 [INF] Executed DbCommand (7ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
EXECUTE dbo.GetNextInvoiceNumber
2025-12-10 11:32:00.504 +03:00 [DBG] Closing data reader to 'GAC-BillingService' on server '.'.
2025-12-10 11:32:00.509 +03:00 [DBG] A data reader for 'GAC-BillingService' on server '.' is being disposed after spending 5ms reading results.
2025-12-10 11:32:00.513 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-12-10 11:32:00.516 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (3ms).
2025-12-10 11:32:00.520 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (7ms).
2025-12-10 11:32:00.524 +03:00 [DBG] Executing DbCommand [Parameters=[@__cutomerIdentityNumber_0='?' (Size = 100)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[Id], [c].[Address_BuildingNumber], [c].[Address_City], [c].[Address_Country], [c].[Address_District], [c].[Address_PostalCode], [c].[Address_Street], [c].[Address_SubNumber], [c].[CreatedBy], [c].[CreatedDate], [c].[CustomerType], [c].[EmailAddress], [c].[FullName], [c].[IdentityNumber], [c].[IdentityType], [c].[IsDeleted], [c].[LastUpdatedDate], [c].[OverpaymentBalance], [c].[PhoneNumber], [c].[VATNumber]
FROM [Customers] AS [c]
WHERE [c].[IdentityNumber] = @__cutomerIdentityNumber_0
2025-12-10 11:32:00.532 +03:00 [INF] Executed DbCommand (8ms) [Parameters=[@__cutomerIdentityNumber_0='?' (Size = 100)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[Id], [c].[Address_BuildingNumber], [c].[Address_City], [c].[Address_Country], [c].[Address_District], [c].[Address_PostalCode], [c].[Address_Street], [c].[Address_SubNumber], [c].[CreatedBy], [c].[CreatedDate], [c].[CustomerType], [c].[EmailAddress], [c].[FullName], [c].[IdentityNumber], [c].[IdentityType], [c].[IsDeleted], [c].[LastUpdatedDate], [c].[OverpaymentBalance], [c].[PhoneNumber], [c].[VATNumber]
FROM [Customers] AS [c]
WHERE [c].[IdentityNumber] = @__cutomerIdentityNumber_0
2025-12-10 11:32:00.538 +03:00 [DBG] Context 'BillingServiceDBContext' started tracking 'Customer' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-12-10 11:32:00.542 +03:00 [DBG] Closing data reader to 'GAC-BillingService' on server '.'.
2025-12-10 11:32:00.545 +03:00 [DBG] A data reader for 'GAC-BillingService' on server '.' is being disposed after spending 7ms reading results.
2025-12-10 11:32:00.549 +03:00 [DBG] 'BillingServiceDBContext' generated a temporary value for the property 'Invoice.Id'. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-12-10 11:32:00.552 +03:00 [DBG] Context 'BillingServiceDBContext' started tracking 'Invoice' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-12-10 11:32:00.555 +03:00 [DBG] 'BillingServiceDBContext' generated a temporary value for the property 'InvoicesAttachment.Id'. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-12-10 11:32:00.559 +03:00 [DBG] The navigation 'InvoicesAttachment.Invoice' was detected as changed. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-12-10 11:32:00.562 +03:00 [DBG] Context 'BillingServiceDBContext' started tracking 'InvoicesAttachment' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-12-10 11:32:00.565 +03:00 [DBG] 'BillingServiceDBContext' generated a temporary value for the property 'InvoicesItem.Id'. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-12-10 11:32:00.568 +03:00 [DBG] The navigation 'InvoicesItem.Invoice' was detected as changed. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-12-10 11:32:00.571 +03:00 [DBG] Context 'BillingServiceDBContext' started tracking 'InvoicesItem' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-12-10 11:32:00.575 +03:00 [DBG] SaveChanges starting for 'BillingServiceDBContext'.
2025-12-10 11:32:00.578 +03:00 [DBG] DetectChanges starting for 'BillingServiceDBContext'.
2025-12-10 11:32:00.580 +03:00 [DBG] DetectChanges completed for 'BillingServiceDBContext'.
2025-12-10 11:32:00.583 +03:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-12-10 11:32:00.585 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-12-10 11:32:00.587 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (2ms).
2025-12-10 11:32:00.592 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (6ms).
2025-12-10 11:32:00.595 +03:00 [DBG] Executing DbCommand [Parameters=[@p0='?' (Precision = 18) (DbType = Decimal), @p1='?' (Size = 3000), @p2='?' (Size = 100), @p3='?' (Size = 50), @p4='?' (DbType = DateTime), @p5='?' (Size = 50), @p6='?' (DbType = Int64), @p7='?' (DbType = Int64), @p8='?' (DbType = DateTime), @p9='?' (DbType = Guid), @p10='?' (Size = 50), @p11='?' (DbType = Int32), @p12='?' (DbType = Int32), @p13='?' (DbType = Boolean), @p14='?' (DbType = Boolean), @p15='?' (DbType = Boolean), @p16='?' (DbType = Boolean), @p17='?' (DbType = DateTime), @p18='?' (DbType = DateTime), @p19='?' (Size = 4000), @p20='?' (Size = 100), @p21='?' (Size = 100), @p22='?' (DbType = Int64), @p23='?' (Size = 4000), @p24='?' (DbType = Int64), @p25='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [Invoices] ([Amount], [CancelationReasons], [ClientReferenceNumber], [CreatedBy], [CreatedDate], [Currency], [CustomerID], [DiscountedPrimaryInvoiceID], [DueAt], [ExternalId], [InvoiceNumber], [InvoiceStatus], [InvoiceType], [IsDeleted], [IsDiscounted], [IsSubInvoice], [IsSubstitution], [IssuedAt], [LastUpdatedDate], [Metadata], [PaymentProvider], [PaymentReference], [PrimaryInvoiceID], [ProviderResponse], [SubstitutionPrimaryInvoiceID], [TenantId])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18, @p19, @p20, @p21, @p22, @p23, @p24, @p25);
2025-12-10 11:32:00.616 +03:00 [INF] Executed DbCommand (22ms) [Parameters=[@p0='?' (Precision = 18) (DbType = Decimal), @p1='?' (Size = 3000), @p2='?' (Size = 100), @p3='?' (Size = 50), @p4='?' (DbType = DateTime), @p5='?' (Size = 50), @p6='?' (DbType = Int64), @p7='?' (DbType = Int64), @p8='?' (DbType = DateTime), @p9='?' (DbType = Guid), @p10='?' (Size = 50), @p11='?' (DbType = Int32), @p12='?' (DbType = Int32), @p13='?' (DbType = Boolean), @p14='?' (DbType = Boolean), @p15='?' (DbType = Boolean), @p16='?' (DbType = Boolean), @p17='?' (DbType = DateTime), @p18='?' (DbType = DateTime), @p19='?' (Size = 4000), @p20='?' (Size = 100), @p21='?' (Size = 100), @p22='?' (DbType = Int64), @p23='?' (Size = 4000), @p24='?' (DbType = Int64), @p25='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [Invoices] ([Amount], [CancelationReasons], [ClientReferenceNumber], [CreatedBy], [CreatedDate], [Currency], [CustomerID], [DiscountedPrimaryInvoiceID], [DueAt], [ExternalId], [InvoiceNumber], [InvoiceStatus], [InvoiceType], [IsDeleted], [IsDiscounted], [IsSubInvoice], [IsSubstitution], [IssuedAt], [LastUpdatedDate], [Metadata], [PaymentProvider], [PaymentReference], [PrimaryInvoiceID], [ProviderResponse], [SubstitutionPrimaryInvoiceID], [TenantId])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18, @p19, @p20, @p21, @p22, @p23, @p24, @p25);
2025-12-10 11:32:00.625 +03:00 [DBG] The foreign key property 'Invoice.Id' was detected as changed. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see property values.
2025-12-10 11:32:00.628 +03:00 [DBG] The foreign key property 'InvoicesAttachment.InvoiceId' was detected as changed. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see property values.
2025-12-10 11:32:00.631 +03:00 [DBG] The foreign key property 'InvoicesItem.InvoiceId' was detected as changed. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see property values.
2025-12-10 11:32:00.634 +03:00 [DBG] Closing data reader to 'GAC-BillingService' on server '.'.
2025-12-10 11:32:00.637 +03:00 [DBG] A data reader for 'GAC-BillingService' on server '.' is being disposed after spending 12ms reading results.
2025-12-10 11:32:00.641 +03:00 [DBG] Executing 2 update commands as a batch.
2025-12-10 11:32:00.644 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-12-10 11:32:00.647 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (3ms).
2025-12-10 11:32:00.650 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (6ms).
2025-12-10 11:32:00.653 +03:00 [DBG] Executing DbCommand [Parameters=[@p26='?' (Size = 50), @p27='?' (DbType = DateTime), @p28='?' (Size = 200), @p29='?' (DbType = Int64), @p30='?' (DbType = Boolean), @p31='?' (Precision = 18) (DbType = Decimal), @p32='?' (Size = 50), @p33='?' (DbType = DateTime), @p34='?' (DbType = Int64), @p35='?' (DbType = Boolean), @p36='?' (Size = 500), @p37='?' (Size = 200), @p38='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SET NOCOUNT ON;
INSERT INTO [InvoicesAttachments] ([CreatedBy], [CreatedDate], [FileName], [InvoiceId], [IsDeleted])
OUTPUT INSERTED.[Id]
VALUES (@p26, @p27, @p28, @p29, @p30);
INSERT INTO [InvoicesItems] ([Amount], [CreatedBy], [CreatedDate], [InvoiceId], [IsDeleted], [ItemDesc], [ItemName], [Quantity])
OUTPUT INSERTED.[Id]
VALUES (@p31, @p32, @p33, @p34, @p35, @p36, @p37, @p38);
2025-12-10 11:32:00.660 +03:00 [INF] Executed DbCommand (7ms) [Parameters=[@p26='?' (Size = 50), @p27='?' (DbType = DateTime), @p28='?' (Size = 200), @p29='?' (DbType = Int64), @p30='?' (DbType = Boolean), @p31='?' (Precision = 18) (DbType = Decimal), @p32='?' (Size = 50), @p33='?' (DbType = DateTime), @p34='?' (DbType = Int64), @p35='?' (DbType = Boolean), @p36='?' (Size = 500), @p37='?' (Size = 200), @p38='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SET NOCOUNT ON;
INSERT INTO [InvoicesAttachments] ([CreatedBy], [CreatedDate], [FileName], [InvoiceId], [IsDeleted])
OUTPUT INSERTED.[Id]
VALUES (@p26, @p27, @p28, @p29, @p30);
INSERT INTO [InvoicesItems] ([Amount], [CreatedBy], [CreatedDate], [InvoiceId], [IsDeleted], [ItemDesc], [ItemName], [Quantity])
OUTPUT INSERTED.[Id]
VALUES (@p31, @p32, @p33, @p34, @p35, @p36, @p37, @p38);
2025-12-10 11:32:00.664 +03:00 [DBG] The foreign key property 'InvoicesAttachment.Id' was detected as changed. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see property values.
2025-12-10 11:32:00.667 +03:00 [DBG] The foreign key property 'InvoicesItem.Id' was detected as changed. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see property values.
2025-12-10 11:32:00.670 +03:00 [DBG] Closing data reader to 'GAC-BillingService' on server '.'.
2025-12-10 11:32:00.674 +03:00 [DBG] A data reader for 'GAC-BillingService' on server '.' is being disposed after spending 10ms reading results.
2025-12-10 11:32:00.678 +03:00 [DBG] An entity of type 'Invoice' tracked by 'BillingServiceDBContext' changed state from '"Added"' to '"Unchanged"'. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-12-10 11:32:00.681 +03:00 [DBG] An entity of type 'InvoicesAttachment' tracked by 'BillingServiceDBContext' changed state from '"Added"' to '"Unchanged"'. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-12-10 11:32:00.687 +03:00 [DBG] An entity of type 'InvoicesItem' tracked by 'BillingServiceDBContext' changed state from '"Added"' to '"Unchanged"'. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-12-10 11:32:00.692 +03:00 [DBG] SaveChanges completed for 'BillingServiceDBContext' with 3 entities written to the database.
2025-12-10 12:04:41.909 +03:00 [DBG] Registered model binder providers, in the following order: ["Microsoft.AspNetCore.Mvc.ModelBinding.Binders.BinderTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ServicesModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.BodyModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.HeaderModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FloatingPointTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.EnumTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.DateTimeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.SimpleTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.TryParseModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.CancellationTokenModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ByteArrayModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FormFileModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FormCollectionModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.KeyValuePairModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.DictionaryModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ArrayModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.CollectionModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ComplexObjectModelBinderProvider"]
2025-12-10 12:04:42.143 +03:00 [DBG] Hosting starting
2025-12-10 12:04:42.590 +03:00 [DBG] Starting bus instances: IBus
2025-12-10 12:04:42.597 +03:00 [DBG] Starting bus: "rabbitmq://localhost/"
2025-12-10 12:04:42.630 +03:00 [DBG] Middleware loaded
2025-12-10 12:04:42.634 +03:00 [DBG] Middleware loaded. Script /_framework/aspnetcore-browser-refresh.js (16519 B).
2025-12-10 12:04:42.638 +03:00 [DBG] Middleware loaded. Script /_framework/blazor-hotreload.js (799 B).
2025-12-10 12:04:42.658 +03:00 [DBG] Connect: guest@localhost:5672/
2025-12-10 12:04:42.829 +03:00 [DBG] Middleware loaded: DOTNET_MODIFIABLE_ASSEMBLIES=debug, __ASPNETCORE_BROWSER_TOOLS=true
2025-12-10 12:04:42.847 +03:00 [DBG] Connected: guest@localhost:5672/ (address: amqp://localhost:5672, local: 51337)
2025-12-10 12:04:42.910 +03:00 [DBG] Endpoint Ready: "rabbitmq://localhost/ECHGHANNAMLP1_BillingSystemAPI_bus_atioyyyh3bcsbwfabdxdx13ebg?temporary=true"
2025-12-10 12:04:42.914 +03:00 [INF] Bus started: "rabbitmq://localhost/"
2025-12-10 12:04:43.119 +03:00 [INF] Now listening on: https://localhost:7257
2025-12-10 12:04:43.128 +03:00 [INF] Now listening on: http://localhost:5009
2025-12-10 12:04:43.134 +03:00 [DBG] Loaded hosting startup assembly BillingSystem.API
2025-12-10 12:04:43.136 +03:00 [DBG] Loaded hosting startup assembly Microsoft.WebTools.ApiEndpointDiscovery
2025-12-10 12:04:43.139 +03:00 [DBG] Loaded hosting startup assembly Microsoft.AspNetCore.Watch.BrowserRefresh
2025-12-10 12:04:43.141 +03:00 [DBG] Loaded hosting startup assembly Microsoft.WebTools.BrowserLink.Net
2025-12-10 12:04:43.301 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-12-10 12:04:43.304 +03:00 [INF] Hosting environment: Development
2025-12-10 12:04:43.308 +03:00 [INF] Content root path: C:\Repositories\Gac-BillingSystem\src\BillingSystem.API
2025-12-10 12:04:43.312 +03:00 [DBG] Hosting started
2025-12-10 12:04:43.567 +03:00 [DBG] Connection id "0HNHNPCKCRP0A" accepted.
2025-12-10 12:04:43.568 +03:00 [DBG] Connection id "0HNHNPCKCRP0B" accepted.
2025-12-10 12:04:43.574 +03:00 [DBG] Connection id "0HNHNPCKCRP0A" started.
2025-12-10 12:04:43.578 +03:00 [DBG] Connection id "0HNHNPCKCRP0B" started.
2025-12-10 12:04:43.600 +03:00 [DBG] Connection id "0HNHNPCKCRP0B" received FIN.
2025-12-10 12:04:43.600 +03:00 [DBG] Connection id "0HNHNPCKCRP0A" received FIN.
2025-12-10 12:04:43.617 +03:00 [DBG] Failed to authenticate HTTPS connection.
System.IO.IOException: Received an unexpected EOF or 0 bytes from the transport stream.
   at System.Net.Security.SslStream.ReceiveHandshakeFrameAsync[TIOAdapter](CancellationToken cancellationToken)
   at System.Net.Security.SslStream.ForceAuthenticationAsync[TIOAdapter](Boolean receiveFirst, Byte[] reAuthenticationData, CancellationToken cancellationToken)
   at System.Net.Security.SslStream.ProcessAuthenticationWithTelemetryAsync(Boolean isAsync, CancellationToken cancellationToken)
   at Microsoft.AspNetCore.Server.Kestrel.Https.Internal.HttpsConnectionMiddleware.OnConnectionAsync(ConnectionContext context)
2025-12-10 12:04:43.617 +03:00 [DBG] Failed to authenticate HTTPS connection.
System.IO.IOException: Received an unexpected EOF or 0 bytes from the transport stream.
   at System.Net.Security.SslStream.ReceiveHandshakeFrameAsync[TIOAdapter](CancellationToken cancellationToken)
   at System.Net.Security.SslStream.ForceAuthenticationAsync[TIOAdapter](Boolean receiveFirst, Byte[] reAuthenticationData, CancellationToken cancellationToken)
   at System.Net.Security.SslStream.ProcessAuthenticationWithTelemetryAsync(Boolean isAsync, CancellationToken cancellationToken)
   at Microsoft.AspNetCore.Server.Kestrel.Https.Internal.HttpsConnectionMiddleware.OnConnectionAsync(ConnectionContext context)
2025-12-10 12:04:43.644 +03:00 [DBG] Connection id "0HNHNPCKCRP0A" stopped.
2025-12-10 12:04:43.644 +03:00 [DBG] Connection id "0HNHNPCKCRP0B" stopped.
2025-12-10 12:04:43.654 +03:00 [DBG] Connection id "0HNHNPCKCRP0A" sending FIN because: "The Socket transport's send loop completed gracefully."
2025-12-10 12:04:43.654 +03:00 [DBG] Connection id "0HNHNPCKCRP0B" sending FIN because: "The Socket transport's send loop completed gracefully."
2025-12-10 12:04:44.365 +03:00 [DBG] Connection id "0HNHNPCKCRP0C" accepted.
2025-12-10 12:04:44.369 +03:00 [DBG] Connection id "0HNHNPCKCRP0C" started.
2025-12-10 12:04:44.490 +03:00 [DBG] Connection 0HNHNPCKCRP0C established using the following protocol: "Tls13"
2025-12-10 12:04:44.569 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7257/swagger/index.html - null null
2025-12-10 12:04:44.629 +03:00 [DBG] Wildcard detected, all requests with hosts will be allowed.
2025-12-10 12:04:44.657 +03:00 [DBG] No candidates found for the request path '/swagger/index.html'
2025-12-10 12:04:44.660 +03:00 [DBG] Request did not match any endpoints
2025-12-10 12:04:44.739 +03:00 [DBG] Response markup is scheduled to include Browser Link script injection.
2025-12-10 12:04:44.744 +03:00 [DBG] Response markup is scheduled to include browser refresh script injection.
2025-12-10 12:04:44.771 +03:00 [INF] HTTP GET /swagger/index.html responded 200 in 102.3447 ms
2025-12-10 12:04:44.779 +03:00 [DBG] Response markup was updated to include Browser Link script injection.
2025-12-10 12:04:44.782 +03:00 [DBG] Response markup was updated to include browser refresh script injection.
2025-12-10 12:04:44.789 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7257/swagger/index.html - 200 null text/html;charset=utf-8 231.419ms
2025-12-10 12:04:44.835 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7257/_framework/aspnetcore-browser-refresh.js - null null
2025-12-10 12:04:44.835 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7257/_vs/browserLink - null null
2025-12-10 12:04:44.849 +03:00 [DBG] Script injected: /_framework/aspnetcore-browser-refresh.js
2025-12-10 12:04:44.852 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7257/_framework/aspnetcore-browser-refresh.js - 200 16519 application/javascript; charset=utf-8 18.4561ms
2025-12-10 12:04:44.905 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7257/_vs/browserLink - 200 null text/javascript; charset=UTF-8 70.4953ms
2025-12-10 12:04:44.955 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7257/swagger/v1/swagger.json - null null
2025-12-10 12:04:44.963 +03:00 [DBG] No candidates found for the request path '/swagger/v1/swagger.json'
2025-12-10 12:04:44.966 +03:00 [DBG] Request did not match any endpoints
2025-12-10 12:04:44.986 +03:00 [INF] HTTP GET /swagger/v1/swagger.json responded 200 in 17.5421 ms
2025-12-10 12:04:44.992 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7257/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 37.52ms
2025-12-10 12:06:31.216 +03:00 [DBG] Connection id "0HNHNPCKCRP0D" accepted.
2025-12-10 12:06:31.217 +03:00 [DBG] Connection id "0HNHNPCKCRP0D" received FIN.
2025-12-10 12:06:31.234 +03:00 [DBG] Connection id "0HNHNPCKCRP0D" started.
2025-12-10 12:06:31.235 +03:00 [DBG] Connection id "0HNHNPCKCRP0E" accepted.
2025-12-10 12:06:31.247 +03:00 [DBG] Failed to authenticate HTTPS connection.
System.IO.IOException: Received an unexpected EOF or 0 bytes from the transport stream.
   at System.Net.Security.SslStream.ReceiveHandshakeFrameAsync[TIOAdapter](CancellationToken cancellationToken)
   at System.Net.Security.SslStream.ForceAuthenticationAsync[TIOAdapter](Boolean receiveFirst, Byte[] reAuthenticationData, CancellationToken cancellationToken)
   at System.Net.Security.SslStream.ProcessAuthenticationWithTelemetryAsync(Boolean isAsync, CancellationToken cancellationToken)
   at Microsoft.AspNetCore.Server.Kestrel.Https.Internal.HttpsConnectionMiddleware.OnConnectionAsync(ConnectionContext context)
2025-12-10 12:06:31.248 +03:00 [DBG] Connection id "0HNHNPCKCRP0E" started.
2025-12-10 12:06:31.252 +03:00 [DBG] Connection id "0HNHNPCKCRP0D" stopped.
2025-12-10 12:06:31.257 +03:00 [DBG] Connection id "0HNHNPCKCRP0D" sending FIN because: "The Socket transport's send loop completed gracefully."
2025-12-10 12:06:31.261 +03:00 [DBG] Connection 0HNHNPCKCRP0E established using the following protocol: "Tls13"
2025-12-10 12:06:31.269 +03:00 [INF] Request starting HTTP/1.1 POST https://localhost:7257/api/Invoices/Post - application/json 1544
2025-12-10 12:06:31.281 +03:00 [DBG] 1 candidate(s) found for the request path '/api/Invoices/Post'
2025-12-10 12:06:31.290 +03:00 [DBG] Endpoint 'BillingSystem.API.Controllers.InvoicesController.Post (BillingSystem.API)' with route pattern 'api/Invoices/Post' is valid for the request path '/api/Invoices/Post'
2025-12-10 12:06:31.298 +03:00 [DBG] Request matched endpoint 'BillingSystem.API.Controllers.InvoicesController.Post (BillingSystem.API)'
2025-12-10 12:06:31.306 +03:00 [DBG] Static files was skipped as the request already matched an endpoint.
2025-12-10 12:06:31.331 +03:00 [DBG] Connection id "0HNHNPCKCRP0E", Request id "0HNHNPCKCRP0E:00000001": started reading request body.
2025-12-10 12:06:31.337 +03:00 [DBG] Connection id "0HNHNPCKCRP0E", Request id "0HNHNPCKCRP0E:00000001": done reading request body.
2025-12-10 12:06:31.580 +03:00 [DBG] An 'IServiceProvider' was created for internal use by Entity Framework.
2025-12-10 12:06:37.010 +03:00 [INF] Executing endpoint 'BillingSystem.API.Controllers.InvoicesController.Post (BillingSystem.API)'
2025-12-10 12:06:37.074 +03:00 [INF] Route matched with {action = "Post", controller = "Invoices"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Post(BillingSystem.Application.Requests.CreateInvoiceRequest) on controller BillingSystem.API.Controllers.InvoicesController (BillingSystem.API).
2025-12-10 12:06:37.083 +03:00 [DBG] Execution plan of authorization filters (in the following order): ["None"]
2025-12-10 12:06:37.090 +03:00 [DBG] Execution plan of resource filters (in the following order): ["None"]
2025-12-10 12:06:37.097 +03:00 [DBG] Execution plan of action filters (in the following order): ["Microsoft.AspNetCore.Mvc.ModelBinding.UnsupportedContentTypeFilter (Order: -3000)","Microsoft.AspNetCore.Mvc.Infrastructure.ModelStateInvalidFilter (Order: -2000)","BillingSystem.API.ActionFilters.IdempotencyFilter (Order: 0)"]
2025-12-10 12:06:37.103 +03:00 [DBG] Execution plan of exception filters (in the following order): ["None"]
2025-12-10 12:06:37.107 +03:00 [DBG] Execution plan of result filters (in the following order): ["Microsoft.AspNetCore.Mvc.Infrastructure.ClientErrorResultFilter (Order: -2000)","Microsoft.AspNetCore.Mvc.ProducesAttribute (Order: 0)","BillingSystem.API.ActionFilters.IdempotencyFilter (Order: 0)"]
2025-12-10 12:06:37.114 +03:00 [DBG] Executing controller factory for controller BillingSystem.API.Controllers.InvoicesController (BillingSystem.API)
2025-12-10 12:06:37.123 +03:00 [WRN] You do not have a valid license key for the Lucky Penny software MediatR. This is allowed for development and testing scenarios. If you are running in production you are required to have a licensed version. Please visit https://luckypennysoftware.com to obtain a valid license.
2025-12-10 12:06:37.174 +03:00 [DBG] Executed controller factory for controller BillingSystem.API.Controllers.InvoicesController (BillingSystem.API)
2025-12-10 12:06:37.184 +03:00 [DBG] Attempting to bind parameter 'invoiceRequest' of type 'BillingSystem.Application.Requests.CreateInvoiceRequest' ...
2025-12-10 12:06:37.190 +03:00 [DBG] Attempting to bind parameter 'invoiceRequest' of type 'BillingSystem.Application.Requests.CreateInvoiceRequest' using the name '' in request data ...
2025-12-10 12:06:37.196 +03:00 [DBG] Selected input formatter 'Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonInputFormatter' for content type 'application/json'.
2025-12-10 12:06:37.288 +03:00 [DBG] JSON input formatter succeeded, deserializing to type 'BillingSystem.Application.Requests.CreateInvoiceRequest'
2025-12-10 12:06:37.293 +03:00 [DBG] Done attempting to bind parameter 'invoiceRequest' of type 'BillingSystem.Application.Requests.CreateInvoiceRequest'.
2025-12-10 12:06:37.297 +03:00 [DBG] Done attempting to bind parameter 'invoiceRequest' of type 'BillingSystem.Application.Requests.CreateInvoiceRequest'.
2025-12-10 12:06:37.302 +03:00 [DBG] Attempting to validate the bound parameter 'invoiceRequest' of type 'BillingSystem.Application.Requests.CreateInvoiceRequest' ...
2025-12-10 12:06:37.328 +03:00 [DBG] Done attempting to validate the bound parameter 'invoiceRequest' of type 'BillingSystem.Application.Requests.CreateInvoiceRequest'.
2025-12-10 12:06:37.650 +03:00 [DBG] No relationship from 'Invoice' to 'Invoice' has been configured by convention because there are multiple properties on one entity type - {'DiscountedPrimaryInvoice'} that could be matched with the properties on the other entity type - {'InverseDiscountedPrimaryInvoice', 'InversePrimaryInvoice', 'InverseSubstitutionPrimaryInvoice', 'PrimaryInvoice', 'SubstitutionPrimaryInvoice'}. This message can be disregarded if explicit configuration has been specified in 'OnModelCreating'.
2025-12-10 12:06:37.935 +03:00 [DBG] No relationship from 'Invoice' to 'Invoice' has been configured by convention because there are multiple properties on one entity type - {'DiscountedPrimaryInvoice'} that could be matched with the properties on the other entity type - {'InverseDiscountedPrimaryInvoice', 'InversePrimaryInvoice', 'InverseSubstitutionPrimaryInvoice', 'PrimaryInvoice', 'SubstitutionPrimaryInvoice'}. This message can be disregarded if explicit configuration has been specified in 'OnModelCreating'.
2025-12-10 12:06:37.946 +03:00 [DBG] No relationship from 'Invoice' to 'Invoice' has been configured by convention because there are multiple properties on one entity type - {'InversePrimaryInvoice'} that could be matched with the properties on the other entity type - {'InverseSubstitutionPrimaryInvoice', 'PrimaryInvoice', 'SubstitutionPrimaryInvoice'}. This message can be disregarded if explicit configuration has been specified in 'OnModelCreating'.
2025-12-10 12:06:37.955 +03:00 [DBG] No relationship from 'Invoice' to 'Invoice' has been configured by convention because there are multiple properties on one entity type - {'InversePrimaryInvoice'} that could be matched with the properties on the other entity type - {'InverseSubstitutionPrimaryInvoice', 'PrimaryInvoice', 'SubstitutionPrimaryInvoice'}. This message can be disregarded if explicit configuration has been specified in 'OnModelCreating'.
2025-12-10 12:06:38.295 +03:00 [DBG] Entity Framework Core 9.0.9 initialized 'BillingServiceDBContext' using provider 'Microsoft.EntityFrameworkCore.SqlServer:9.0.9' with options: EngineType=SqlServer 
2025-12-10 12:06:38.426 +03:00 [DBG] Compiling query expression: 
'DbSet<Invoice>()
    .AsNoTracking()
    .Any(inv => inv.ExternalId.ToString() == __idempotentKey_0)'
2025-12-10 12:06:38.761 +03:00 [DBG] Generated query execution expression: 
'queryContext => ShapedQueryCompilingExpressionVisitor.SingleAsync<bool>(
    asyncEnumerable: SingleQueryingEnumerable.Create<bool>(
        relationalQueryContext: (RelationalQueryContext)queryContext, 
        relationalCommandResolver: parameters => [LIFTABLE Constant: RelationalCommandCache.QueryExpression(
            Projection Mapping:
                EmptyProjectionMember -> 0
            SELECT EXISTS (
                SELECT 1
                FROM Invoices AS i
                WHERE COALESCE(CONVERT(varchar(36), i.ExternalId), '') == @__idempotentKey_0)) | Resolver: c => new RelationalCommandCache(
            c.Dependencies.MemoryCache, 
            c.RelationalDependencies.QuerySqlGeneratorFactory, 
            c.RelationalDependencies.RelationalParameterBasedSqlProcessorFactory, 
            Projection Mapping:
                EmptyProjectionMember -> 0
            SELECT EXISTS (
                SELECT 1
                FROM Invoices AS i
                WHERE COALESCE(CONVERT(varchar(36), i.ExternalId), '') == @__idempotentKey_0), 
            False, 
            new HashSet<string>(
                new string[]{ }, 
                StringComparer.Ordinal
            )
        )].GetRelationalCommandTemplate(parameters), 
        readerColumns: null, 
        shaper: (queryContext, dataReader, resultContext, resultCoordinator) => 
        {
            bool? value1;
            value1 = dataReader.IsDBNull(0) ? default(bool?) : (bool?)dataReader.GetBoolean(0);
            return (bool)value1;
        }, 
        contextType: BillingSystem.Infrastructure.EF.BillingServiceDBContext, 
        standAloneStateManager: False, 
        detailedErrorsEnabled: False, 
        threadSafetyChecksEnabled: True), 
    cancellationToken: queryContext.CancellationToken)'
2025-12-10 12:06:38.829 +03:00 [DBG] Creating DbConnection.
2025-12-10 12:06:38.862 +03:00 [DBG] Created DbConnection. (29ms).
2025-12-10 12:06:38.871 +03:00 [DBG] Opening connection to database 'GAC-BillingService' on server '.'.
2025-12-10 12:06:39.185 +03:00 [DBG] Opened connection to database 'GAC-BillingService' on server '.'.
2025-12-10 12:06:39.195 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-12-10 12:06:39.206 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (9ms).
2025-12-10 12:06:39.218 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (24ms).
2025-12-10 12:06:39.232 +03:00 [DBG] Executing DbCommand [Parameters=[@__idempotentKey_0='?' (Size = 36) (DbType = AnsiString)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [Invoices] AS [i]
        WHERE CONVERT(varchar(36), [i].[ExternalId]) = @__idempotentKey_0) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2025-12-10 12:06:39.322 +03:00 [INF] Executed DbCommand (86ms) [Parameters=[@__idempotentKey_0='?' (Size = 36) (DbType = AnsiString)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [Invoices] AS [i]
        WHERE CONVERT(varchar(36), [i].[ExternalId]) = @__idempotentKey_0) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2025-12-10 12:06:39.352 +03:00 [DBG] Closing data reader to 'GAC-BillingService' on server '.'.
2025-12-10 12:06:39.364 +03:00 [DBG] A data reader for 'GAC-BillingService' on server '.' is being disposed after spending 29ms reading results.
2025-12-10 12:06:39.374 +03:00 [DBG] Closing connection to database 'GAC-BillingService' on server '.'.
2025-12-10 12:06:39.389 +03:00 [DBG] Closed connection to database 'GAC-BillingService' on server '.' (15ms).
2025-12-10 12:06:39.626 +03:00 [WRN] You do not have a valid license key for the Lucky Penny software AutoMapper. This is allowed for development and testing scenarios. If you are running in production you are required to have a licensed version. Please visit https://luckypennysoftware.com to obtain a valid license.
2025-12-10 12:06:39.690 +03:00 [DBG] Opening connection to database 'GAC-BillingService' on server '.'.
2025-12-10 12:06:39.698 +03:00 [DBG] Opened connection to database 'GAC-BillingService' on server '.'.
2025-12-10 12:06:39.703 +03:00 [DBG] Beginning transaction with isolation level 'Unspecified'.
2025-12-10 12:06:39.715 +03:00 [DBG] Began transaction with isolation level 'ReadCommitted'.
2025-12-10 12:06:39.723 +03:00 [DBG] Compiling query expression: 
'DbSet<InvoiceSequenceValue>().FromSql(EXECUTE dbo.GetNextInvoiceNumber, __p_0)
'
2025-12-10 12:06:39.784 +03:00 [DBG] Generated query execution expression: 
'queryContext => FromSqlQueryingEnumerable.Create<InvoiceSequenceValue>(
    relationalQueryContext: (RelationalQueryContext)queryContext, 
    relationalCommandResolver: parameters => [LIFTABLE Constant: RelationalCommandCache.QueryExpression(
        Projection Mapping:
            EmptyProjectionMember -> Dictionary<IProperty, int> { [Property: InvoiceSequenceValue.Value (long) Required, 0] }
        SELECT b.Value
        FROM EXECUTE dbo.GetNextInvoiceNumber) | Resolver: c => new RelationalCommandCache(
        c.Dependencies.MemoryCache, 
        c.RelationalDependencies.QuerySqlGeneratorFactory, 
        c.RelationalDependencies.RelationalParameterBasedSqlProcessorFactory, 
        Projection Mapping:
            EmptyProjectionMember -> Dictionary<IProperty, int> { [Property: InvoiceSequenceValue.Value (long) Required, 0] }
        SELECT b.Value
        FROM EXECUTE dbo.GetNextInvoiceNumber, 
        False, 
        new HashSet<string>(
            new string[]{ }, 
            StringComparer.Ordinal
        )
    )].GetRelationalCommandTemplate(parameters), 
    readerColumns: null, 
    columnNames: [LIFTABLE Constant: string[] { "Value" } | Resolver: _ => new string[]{ "Value" }], 
    shaper: (queryContext, dataReader, indexMap) => 
    {
        InvoiceSequenceValue entity;
        entity = 
        {
            MaterializationContext materializationContext1;
            IEntityType entityType1;
            InvoiceSequenceValue instance1;
            materializationContext1 = new MaterializationContext(
                [LIFTABLE Constant: ValueBuffer | Resolver: _ => (object)ValueBuffer.Empty], 
                queryContext.Context
            );
            instance1 = default(InvoiceSequenceValue);
            {
                ISnapshot shadowSnapshot1;
                shadowSnapshot1 = [LIFTABLE Constant: Snapshot | Resolver: _ => Snapshot.Empty];
                entityType1 = [LIFTABLE Constant: EntityType: InvoiceSequenceValue Keyless | Resolver: namelessParameter{0} => namelessParameter{0}.Dependencies.Model.FindEntityType("BillingSystem.Domain.Entities.InvoiceSequenceValue")];
                instance1 = switch (entityType1)
                {
                    case [LIFTABLE Constant: EntityType: InvoiceSequenceValue Keyless | Resolver: namelessParameter{1} => namelessParameter{1}.Dependencies.Model.FindEntityType("BillingSystem.Domain.Entities.InvoiceSequenceValue")]: 
                        {
                            return 
                            {
                                InvoiceSequenceValue instance;
                                instance = new InvoiceSequenceValue();
                                instance.<Value>k__BackingField = dataReader.GetInt64(indexMap[0]);
                                (instance is IInjectableService) ? ((IInjectableService)instance).Injected(
                                    context: materializationContext1.Context, 
                                    entity: instance, 
                                    queryTrackingBehavior: TrackAll, 
                                    structuralType: [LIFTABLE Constant: EntityType: InvoiceSequenceValue Keyless | Resolver: namelessParameter{2} => namelessParameter{2}.Dependencies.Model.FindEntityType("BillingSystem.Domain.Entities.InvoiceSequenceValue")]) : default(void);
                                return instance;
                            }}
                    default: 
                        default(InvoiceSequenceValue)
                }
                ;
                return instance1;
            }return instance1;
        };
        return entity;
    }, 
    contextType: BillingSystem.Infrastructure.EF.BillingServiceDBContext, 
    standAloneStateManager: False, 
    detailedErrorsEnabled: False, 
    threadSafetyChecksEnabled: True)'
2025-12-10 12:06:39.795 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-12-10 12:06:39.798 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (3ms).
2025-12-10 12:06:39.805 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (9ms).
2025-12-10 12:06:39.808 +03:00 [DBG] Executing DbCommand [Parameters=[], CommandType='"Text"', CommandTimeout='30']
EXECUTE dbo.GetNextInvoiceNumber
2025-12-10 12:06:39.820 +03:00 [INF] Executed DbCommand (11ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
EXECUTE dbo.GetNextInvoiceNumber
2025-12-10 12:06:39.828 +03:00 [DBG] Closing data reader to 'GAC-BillingService' on server '.'.
2025-12-10 12:06:39.832 +03:00 [DBG] A data reader for 'GAC-BillingService' on server '.' is being disposed after spending 7ms reading results.
2025-12-10 12:06:39.838 +03:00 [DBG] Compiling query expression: 
'DbSet<Customer>()
    .FirstOrDefault(c => c.IdentityNumber == __cutomerIdentityNumber_0)'
2025-12-10 12:06:39.856 +03:00 [DBG] Generated query execution expression: 
'queryContext => SingleQueryingEnumerable.Create<Customer>(
    relationalQueryContext: (RelationalQueryContext)queryContext, 
    relationalCommandResolver: parameters => [LIFTABLE Constant: RelationalCommandCache.QueryExpression(
        Projection Mapping:
            EmptyProjectionMember -> Dictionary<IProperty, int> { [Property: Customer.Id (long) Required PK AfterSave:Throw ValueGenerated.OnAdd, 0], [Property: Customer.AddressBuildingNumber (string) MaxLength(200), 1], [Property: Customer.AddressCity (string) Required MaxLength(200), 2], [Property: Customer.AddressCountry (string) Required MaxLength(200), 3], [Property: Customer.AddressDistrict (string) Required MaxLength(200), 4], [Property: Customer.AddressPostalCode (string) Required MaxLength(50), 5], [Property: Customer.AddressStreet (string) MaxLength(200), 6], [Property: Customer.AddressSubNumber (string) MaxLength(200), 7], [Property: Customer.CreatedBy (string) Required MaxLength(50), 8], [Property: Customer.CreatedDate (DateTime) Required, 9], [Property: Customer.CustomerType (string) Required MaxLength(100), 10], [Property: Customer.EmailAddress (string) MaxLength(80), 11], [Property: Customer.FullName (string) Required MaxLength(500), 12], [Property: Customer.IdentityNumber (string) Required MaxLength(100), 13], [Property: Customer.IdentityType (int?), 14], [Property: Customer.IsDeleted (bool) Required, 15], [Property: Customer.LastUpdatedDate (DateTime?), 16], [Property: Customer.OverpaymentBalance (decimal?), 17], [Property: Customer.PhoneNumber (string) MaxLength(50), 18], [Property: Customer.Vatnumber (string) MaxLength(100), 19] }
        SELECT TOP(1) c.Id, c.Address_BuildingNumber, c.Address_City, c.Address_Country, c.Address_District, c.Address_PostalCode, c.Address_Street, c.Address_SubNumber, c.CreatedBy, c.CreatedDate, c.CustomerType, c.EmailAddress, c.FullName, c.IdentityNumber, c.IdentityType, c.IsDeleted, c.LastUpdatedDate, c.OverpaymentBalance, c.PhoneNumber, c.VATNumber
        FROM Customers AS c
        WHERE c.IdentityNumber == @__cutomerIdentityNumber_0) | Resolver: c => new RelationalCommandCache(
        c.Dependencies.MemoryCache, 
        c.RelationalDependencies.QuerySqlGeneratorFactory, 
        c.RelationalDependencies.RelationalParameterBasedSqlProcessorFactory, 
        Projection Mapping:
            EmptyProjectionMember -> Dictionary<IProperty, int> { [Property: Customer.Id (long) Required PK AfterSave:Throw ValueGenerated.OnAdd, 0], [Property: Customer.AddressBuildingNumber (string) MaxLength(200), 1], [Property: Customer.AddressCity (string) Required MaxLength(200), 2], [Property: Customer.AddressCountry (string) Required MaxLength(200), 3], [Property: Customer.AddressDistrict (string) Required MaxLength(200), 4], [Property: Customer.AddressPostalCode (string) Required MaxLength(50), 5], [Property: Customer.AddressStreet (string) MaxLength(200), 6], [Property: Customer.AddressSubNumber (string) MaxLength(200), 7], [Property: Customer.CreatedBy (string) Required MaxLength(50), 8], [Property: Customer.CreatedDate (DateTime) Required, 9], [Property: Customer.CustomerType (string) Required MaxLength(100), 10], [Property: Customer.EmailAddress (string) MaxLength(80), 11], [Property: Customer.FullName (string) Required MaxLength(500), 12], [Property: Customer.IdentityNumber (string) Required MaxLength(100), 13], [Property: Customer.IdentityType (int?), 14], [Property: Customer.IsDeleted (bool) Required, 15], [Property: Customer.LastUpdatedDate (DateTime?), 16], [Property: Customer.OverpaymentBalance (decimal?), 17], [Property: Customer.PhoneNumber (string) MaxLength(50), 18], [Property: Customer.Vatnumber (string) MaxLength(100), 19] }
        SELECT TOP(1) c.Id, c.Address_BuildingNumber, c.Address_City, c.Address_Country, c.Address_District, c.Address_PostalCode, c.Address_Street, c.Address_SubNumber, c.CreatedBy, c.CreatedDate, c.CustomerType, c.EmailAddress, c.FullName, c.IdentityNumber, c.IdentityType, c.IsDeleted, c.LastUpdatedDate, c.OverpaymentBalance, c.PhoneNumber, c.VATNumber
        FROM Customers AS c
        WHERE c.IdentityNumber == @__cutomerIdentityNumber_0, 
        False, 
        new HashSet<string>(
            new string[]{ }, 
            StringComparer.Ordinal
        )
    )].GetRelationalCommandTemplate(parameters), 
    readerColumns: null, 
    shaper: (queryContext, dataReader, resultContext, resultCoordinator) => 
    {
        Customer entity;
        entity = 
        {
            MaterializationContext materializationContext1;
            IEntityType entityType1;
            Customer instance1;
            InternalEntityEntry entry1;
            bool hasNullKey1;
            materializationContext1 = new MaterializationContext(
                [LIFTABLE Constant: ValueBuffer | Resolver: _ => (object)ValueBuffer.Empty], 
                queryContext.Context
            );
            instance1 = default(Customer);
            entry1 = queryContext.TryGetEntry(
                key: [LIFTABLE Constant: Key: Customer.Id PK | Resolver: c => c.Dependencies.Model.FindEntityType("BillingSystem.Domain.Entities.Customer").FindPrimaryKey()], 
                keyValues: new object[]{ (object)dataReader.GetInt64(0) }, 
                throwOnNullKey: True, 
                hasNullKey: hasNullKey1);
            !(hasNullKey1) ? entry1 != default(InternalEntityEntry) ? 
            {
                entityType1 = entry1.EntityType;
                return instance1 = (Customer)entry1.Entity;
            } : 
            {
                ISnapshot shadowSnapshot1;
                shadowSnapshot1 = [LIFTABLE Constant: Snapshot | Resolver: _ => Snapshot.Empty];
                entityType1 = [LIFTABLE Constant: EntityType: Customer | Resolver: namelessParameter{0} => namelessParameter{0}.Dependencies.Model.FindEntityType("BillingSystem.Domain.Entities.Customer")];
                instance1 = switch (entityType1)
                {
                    case [LIFTABLE Constant: EntityType: Customer | Resolver: namelessParameter{1} => namelessParameter{1}.Dependencies.Model.FindEntityType("BillingSystem.Domain.Entities.Customer")]: 
                        {
                            return 
                            {
                                Customer instance;
                                instance = new Customer();
                                instance.<Id>k__BackingField = dataReader.GetInt64(0);
                                instance.<AddressBuildingNumber>k__BackingField = dataReader.IsDBNull(1) ? default(string) : dataReader.GetString(1);
                                instance.<AddressCity>k__BackingField = dataReader.GetString(2);
                                instance.<AddressCountry>k__BackingField = dataReader.GetString(3);
                                instance.<AddressDistrict>k__BackingField = dataReader.GetString(4);
                                instance.<AddressPostalCode>k__BackingField = dataReader.GetString(5);
                                instance.<AddressStreet>k__BackingField = dataReader.IsDBNull(6) ? default(string) : dataReader.GetString(6);
                                instance.<AddressSubNumber>k__BackingField = dataReader.IsDBNull(7) ? default(string) : dataReader.GetString(7);
                                instance.<CreatedBy>k__BackingField = dataReader.GetString(8);
                                instance.<CreatedDate>k__BackingField = dataReader.GetDateTime(9);
                                instance.<CustomerType>k__BackingField = dataReader.GetString(10);
                                instance.<EmailAddress>k__BackingField = dataReader.IsDBNull(11) ? default(string) : dataReader.GetString(11);
                                instance.<FullName>k__BackingField = dataReader.GetString(12);
                                instance.<IdentityNumber>k__BackingField = dataReader.GetString(13);
                                instance.<IdentityType>k__BackingField = dataReader.IsDBNull(14) ? default(int?) : (int?)dataReader.GetInt32(14);
                                instance.<IsDeleted>k__BackingField = dataReader.GetBoolean(15);
                                instance.<LastUpdatedDate>k__BackingField = dataReader.IsDBNull(16) ? default(DateTime?) : (DateTime?)dataReader.GetDateTime(16);
                                instance.<OverpaymentBalance>k__BackingField = dataReader.IsDBNull(17) ? default(decimal?) : (decimal?)dataReader.GetDecimal(17);
                                instance.<PhoneNumber>k__BackingField = dataReader.IsDBNull(18) ? default(string) : dataReader.GetString(18);
                                instance.<Vatnumber>k__BackingField = dataReader.IsDBNull(19) ? default(string) : dataReader.GetString(19);
                                (instance is IInjectableService) ? ((IInjectableService)instance).Injected(
                                    context: materializationContext1.Context, 
                                    entity: instance, 
                                    queryTrackingBehavior: TrackAll, 
                                    structuralType: [LIFTABLE Constant: EntityType: Customer | Resolver: namelessParameter{2} => namelessParameter{2}.Dependencies.Model.FindEntityType("BillingSystem.Domain.Entities.Customer")]) : default(void);
                                return instance;
                            }}
                    default: 
                        default(Customer)
                }
                ;
                entry1 = entityType1 == default(IEntityType) ? default(InternalEntityEntry) : queryContext.StartTracking(
                    entityType: entityType1, 
                    entity: instance1, 
                    snapshot: shadowSnapshot1);
                return instance1;
            } : default(void);
            return instance1;
        };
        return entity;
    }, 
    contextType: BillingSystem.Infrastructure.EF.BillingServiceDBContext, 
    standAloneStateManager: False, 
    detailedErrorsEnabled: False, 
    threadSafetyChecksEnabled: True)
    .SingleOrDefault()'
2025-12-10 12:06:39.875 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-12-10 12:06:39.880 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (4ms).
2025-12-10 12:06:39.883 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (8ms).
2025-12-10 12:06:39.886 +03:00 [DBG] Executing DbCommand [Parameters=[@__cutomerIdentityNumber_0='?' (Size = 100)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[Id], [c].[Address_BuildingNumber], [c].[Address_City], [c].[Address_Country], [c].[Address_District], [c].[Address_PostalCode], [c].[Address_Street], [c].[Address_SubNumber], [c].[CreatedBy], [c].[CreatedDate], [c].[CustomerType], [c].[EmailAddress], [c].[FullName], [c].[IdentityNumber], [c].[IdentityType], [c].[IsDeleted], [c].[LastUpdatedDate], [c].[OverpaymentBalance], [c].[PhoneNumber], [c].[VATNumber]
FROM [Customers] AS [c]
WHERE [c].[IdentityNumber] = @__cutomerIdentityNumber_0
2025-12-10 12:06:39.894 +03:00 [INF] Executed DbCommand (8ms) [Parameters=[@__cutomerIdentityNumber_0='?' (Size = 100)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[Id], [c].[Address_BuildingNumber], [c].[Address_City], [c].[Address_Country], [c].[Address_District], [c].[Address_PostalCode], [c].[Address_Street], [c].[Address_SubNumber], [c].[CreatedBy], [c].[CreatedDate], [c].[CustomerType], [c].[EmailAddress], [c].[FullName], [c].[IdentityNumber], [c].[IdentityType], [c].[IsDeleted], [c].[LastUpdatedDate], [c].[OverpaymentBalance], [c].[PhoneNumber], [c].[VATNumber]
FROM [Customers] AS [c]
WHERE [c].[IdentityNumber] = @__cutomerIdentityNumber_0
2025-12-10 12:06:39.946 +03:00 [DBG] Context 'BillingServiceDBContext' started tracking 'Customer' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-12-10 12:06:40.019 +03:00 [DBG] Closing data reader to 'GAC-BillingService' on server '.'.
2025-12-10 12:06:40.024 +03:00 [DBG] A data reader for 'GAC-BillingService' on server '.' is being disposed after spending 124ms reading results.
2025-12-10 12:06:40.065 +03:00 [DBG] 'BillingServiceDBContext' generated a temporary value for the property 'Invoice.Id'. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-12-10 12:06:40.198 +03:00 [DBG] Context 'BillingServiceDBContext' started tracking 'Invoice' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-12-10 12:06:40.210 +03:00 [DBG] 'BillingServiceDBContext' generated a temporary value for the property 'InvoicesAttachment.Id'. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-12-10 12:06:40.231 +03:00 [DBG] The navigation 'InvoicesAttachment.Invoice' was detected as changed. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-12-10 12:06:40.241 +03:00 [DBG] Context 'BillingServiceDBContext' started tracking 'InvoicesAttachment' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-12-10 12:06:40.248 +03:00 [DBG] 'BillingServiceDBContext' generated a temporary value for the property 'InvoicesItem.Id'. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-12-10 12:06:40.269 +03:00 [DBG] The navigation 'InvoicesItem.Invoice' was detected as changed. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-12-10 12:06:40.274 +03:00 [DBG] Context 'BillingServiceDBContext' started tracking 'InvoicesItem' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-12-10 12:06:40.282 +03:00 [DBG] SaveChanges starting for 'BillingServiceDBContext'.
2025-12-10 12:06:40.288 +03:00 [DBG] DetectChanges starting for 'BillingServiceDBContext'.
2025-12-10 12:06:40.351 +03:00 [DBG] DetectChanges completed for 'BillingServiceDBContext'.
2025-12-10 12:06:40.469 +03:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-12-10 12:06:40.475 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-12-10 12:06:40.477 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (2ms).
2025-12-10 12:06:40.483 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (7ms).
2025-12-10 12:06:40.489 +03:00 [DBG] Executing DbCommand [Parameters=[@p0='?' (Precision = 18) (DbType = Decimal), @p1='?' (Size = 3000), @p2='?' (Size = 100), @p3='?' (Size = 50), @p4='?' (DbType = DateTime), @p5='?' (Size = 50), @p6='?' (DbType = Int64), @p7='?' (DbType = Int64), @p8='?' (DbType = DateTime), @p9='?' (DbType = Guid), @p10='?' (Size = 50), @p11='?' (DbType = Int32), @p12='?' (DbType = Int32), @p13='?' (DbType = Boolean), @p14='?' (DbType = Boolean), @p15='?' (DbType = Boolean), @p16='?' (DbType = Boolean), @p17='?' (DbType = DateTime), @p18='?' (DbType = DateTime), @p19='?' (Size = 4000), @p20='?' (Size = 100), @p21='?' (Size = 100), @p22='?' (DbType = Int64), @p23='?' (Size = 4000), @p24='?' (DbType = Int64), @p25='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [Invoices] ([Amount], [CancelationReasons], [ClientReferenceNumber], [CreatedBy], [CreatedDate], [Currency], [CustomerID], [DiscountedPrimaryInvoiceID], [DueAt], [ExternalId], [InvoiceNumber], [InvoiceStatus], [InvoiceType], [IsDeleted], [IsDiscounted], [IsSubInvoice], [IsSubstitution], [IssuedAt], [LastUpdatedDate], [Metadata], [PaymentProvider], [PaymentReference], [PrimaryInvoiceID], [ProviderResponse], [SubstitutionPrimaryInvoiceID], [TenantId])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18, @p19, @p20, @p21, @p22, @p23, @p24, @p25);
2025-12-10 12:06:40.506 +03:00 [INF] Executed DbCommand (19ms) [Parameters=[@p0='?' (Precision = 18) (DbType = Decimal), @p1='?' (Size = 3000), @p2='?' (Size = 100), @p3='?' (Size = 50), @p4='?' (DbType = DateTime), @p5='?' (Size = 50), @p6='?' (DbType = Int64), @p7='?' (DbType = Int64), @p8='?' (DbType = DateTime), @p9='?' (DbType = Guid), @p10='?' (Size = 50), @p11='?' (DbType = Int32), @p12='?' (DbType = Int32), @p13='?' (DbType = Boolean), @p14='?' (DbType = Boolean), @p15='?' (DbType = Boolean), @p16='?' (DbType = Boolean), @p17='?' (DbType = DateTime), @p18='?' (DbType = DateTime), @p19='?' (Size = 4000), @p20='?' (Size = 100), @p21='?' (Size = 100), @p22='?' (DbType = Int64), @p23='?' (Size = 4000), @p24='?' (DbType = Int64), @p25='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [Invoices] ([Amount], [CancelationReasons], [ClientReferenceNumber], [CreatedBy], [CreatedDate], [Currency], [CustomerID], [DiscountedPrimaryInvoiceID], [DueAt], [ExternalId], [InvoiceNumber], [InvoiceStatus], [InvoiceType], [IsDeleted], [IsDiscounted], [IsSubInvoice], [IsSubstitution], [IssuedAt], [LastUpdatedDate], [Metadata], [PaymentProvider], [PaymentReference], [PrimaryInvoiceID], [ProviderResponse], [SubstitutionPrimaryInvoiceID], [TenantId])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18, @p19, @p20, @p21, @p22, @p23, @p24, @p25);
2025-12-10 12:06:40.530 +03:00 [DBG] The foreign key property 'Invoice.Id' was detected as changed. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see property values.
2025-12-10 12:06:40.539 +03:00 [DBG] The foreign key property 'InvoicesAttachment.InvoiceId' was detected as changed. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see property values.
2025-12-10 12:06:40.548 +03:00 [DBG] The foreign key property 'InvoicesItem.InvoiceId' was detected as changed. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see property values.
2025-12-10 12:06:40.554 +03:00 [DBG] Closing data reader to 'GAC-BillingService' on server '.'.
2025-12-10 12:06:40.559 +03:00 [DBG] A data reader for 'GAC-BillingService' on server '.' is being disposed after spending 48ms reading results.
2025-12-10 12:06:40.567 +03:00 [DBG] Executing 2 update commands as a batch.
2025-12-10 12:06:40.570 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-12-10 12:06:40.574 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (4ms).
2025-12-10 12:06:40.579 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (8ms).
2025-12-10 12:06:40.582 +03:00 [DBG] Executing DbCommand [Parameters=[@p26='?' (Size = 50), @p27='?' (DbType = DateTime), @p28='?' (Size = 200), @p29='?' (DbType = Int64), @p30='?' (DbType = Boolean), @p31='?' (Precision = 18) (DbType = Decimal), @p32='?' (Size = 50), @p33='?' (DbType = DateTime), @p34='?' (DbType = Int64), @p35='?' (DbType = Boolean), @p36='?' (Size = 500), @p37='?' (Size = 200), @p38='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SET NOCOUNT ON;
INSERT INTO [InvoicesAttachments] ([CreatedBy], [CreatedDate], [FileName], [InvoiceId], [IsDeleted])
OUTPUT INSERTED.[Id]
VALUES (@p26, @p27, @p28, @p29, @p30);
INSERT INTO [InvoicesItems] ([Amount], [CreatedBy], [CreatedDate], [InvoiceId], [IsDeleted], [ItemDesc], [ItemName], [Quantity])
OUTPUT INSERTED.[Id]
VALUES (@p31, @p32, @p33, @p34, @p35, @p36, @p37, @p38);
2025-12-10 12:06:40.589 +03:00 [INF] Executed DbCommand (7ms) [Parameters=[@p26='?' (Size = 50), @p27='?' (DbType = DateTime), @p28='?' (Size = 200), @p29='?' (DbType = Int64), @p30='?' (DbType = Boolean), @p31='?' (Precision = 18) (DbType = Decimal), @p32='?' (Size = 50), @p33='?' (DbType = DateTime), @p34='?' (DbType = Int64), @p35='?' (DbType = Boolean), @p36='?' (Size = 500), @p37='?' (Size = 200), @p38='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SET NOCOUNT ON;
INSERT INTO [InvoicesAttachments] ([CreatedBy], [CreatedDate], [FileName], [InvoiceId], [IsDeleted])
OUTPUT INSERTED.[Id]
VALUES (@p26, @p27, @p28, @p29, @p30);
INSERT INTO [InvoicesItems] ([Amount], [CreatedBy], [CreatedDate], [InvoiceId], [IsDeleted], [ItemDesc], [ItemName], [Quantity])
OUTPUT INSERTED.[Id]
VALUES (@p31, @p32, @p33, @p34, @p35, @p36, @p37, @p38);
2025-12-10 12:06:40.594 +03:00 [DBG] The foreign key property 'InvoicesAttachment.Id' was detected as changed. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see property values.
2025-12-10 12:06:40.600 +03:00 [DBG] The foreign key property 'InvoicesItem.Id' was detected as changed. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see property values.
2025-12-10 12:06:40.604 +03:00 [DBG] Closing data reader to 'GAC-BillingService' on server '.'.
2025-12-10 12:06:40.607 +03:00 [DBG] A data reader for 'GAC-BillingService' on server '.' is being disposed after spending 13ms reading results.
2025-12-10 12:06:40.621 +03:00 [DBG] An entity of type 'Invoice' tracked by 'BillingServiceDBContext' changed state from '"Added"' to '"Unchanged"'. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-12-10 12:06:40.626 +03:00 [DBG] An entity of type 'InvoicesAttachment' tracked by 'BillingServiceDBContext' changed state from '"Added"' to '"Unchanged"'. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-12-10 12:06:40.631 +03:00 [DBG] An entity of type 'InvoicesItem' tracked by 'BillingServiceDBContext' changed state from '"Added"' to '"Unchanged"'. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-12-10 12:06:40.638 +03:00 [DBG] SaveChanges completed for 'BillingServiceDBContext' with 3 entities written to the database.
2025-12-10 12:06:40.674 +03:00 [DBG] 'BillingServiceDBContext' generated a temporary value for the property 'OutboxEvent.Id'. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-12-10 12:06:40.707 +03:00 [DBG] Context 'BillingServiceDBContext' started tracking 'OutboxEvent' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-12-10 12:06:40.714 +03:00 [DBG] 'BillingServiceDBContext' generated a temporary value for the property 'AuditEvent.Id'. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-12-10 12:06:40.748 +03:00 [DBG] Context 'BillingServiceDBContext' started tracking 'AuditEvent' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-12-10 12:06:40.757 +03:00 [DBG] SaveChanges starting for 'BillingServiceDBContext'.
2025-12-10 12:06:40.760 +03:00 [DBG] DetectChanges starting for 'BillingServiceDBContext'.
2025-12-10 12:06:40.786 +03:00 [DBG] DetectChanges completed for 'BillingServiceDBContext'.
2025-12-10 12:06:40.792 +03:00 [DBG] Executing 2 update commands as a batch.
2025-12-10 12:06:40.796 +03:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-12-10 12:06:40.800 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-12-10 12:06:40.804 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (4ms).
2025-12-10 12:06:40.807 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (6ms).
2025-12-10 12:06:40.811 +03:00 [DBG] Executing DbCommand [Parameters=[@p0='?' (Size = 100), @p1='?' (Size = 4000), @p2='?' (Size = 50), @p3='?' (DbType = DateTime), @p4='?' (Size = 500), @p5='?' (Size = 20), @p6='?' (Size = 100), @p7='?' (Size = 100), @p8='?' (DbType = Int64), @p9='?' (Size = 4000), @p10='?' (DbType = DateTime), @p11='?' (Size = 4000), @p12='?' (Size = 300), @p13='?' (Size = 4000), @p14='?' (DbType = Boolean), @p15='?' (Size = 20) (DbType = AnsiString)], CommandType='"Text"', CommandTimeout='30']
SET NOCOUNT ON;
INSERT INTO [audit].[AuditEvents] ([Action], [Changes], [CreatedBy], [CreatedDate], [Description], [EntityId], [EntityType], [UserId])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
INSERT INTO [Outbox_events] ([Aggregate_id], [CorrelationId], [CreatedDate], [ErrorMsg], [Event_type], [Payload], [Processed], [ProcessingStatus])
OUTPUT INSERTED.[Id]
VALUES (@p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15);
2025-12-10 12:06:40.820 +03:00 [INF] Executed DbCommand (10ms) [Parameters=[@p0='?' (Size = 100), @p1='?' (Size = 4000), @p2='?' (Size = 50), @p3='?' (DbType = DateTime), @p4='?' (Size = 500), @p5='?' (Size = 20), @p6='?' (Size = 100), @p7='?' (Size = 100), @p8='?' (DbType = Int64), @p9='?' (Size = 4000), @p10='?' (DbType = DateTime), @p11='?' (Size = 4000), @p12='?' (Size = 300), @p13='?' (Size = 4000), @p14='?' (DbType = Boolean), @p15='?' (Size = 20) (DbType = AnsiString)], CommandType='"Text"', CommandTimeout='30']
SET NOCOUNT ON;
INSERT INTO [audit].[AuditEvents] ([Action], [Changes], [CreatedBy], [CreatedDate], [Description], [EntityId], [EntityType], [UserId])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
INSERT INTO [Outbox_events] ([Aggregate_id], [CorrelationId], [CreatedDate], [ErrorMsg], [Event_type], [Payload], [Processed], [ProcessingStatus])
OUTPUT INSERTED.[Id]
VALUES (@p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15);
2025-12-10 12:06:40.829 +03:00 [DBG] The foreign key property 'AuditEvent.Id' was detected as changed. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see property values.
2025-12-10 12:06:40.835 +03:00 [DBG] The foreign key property 'OutboxEvent.Id' was detected as changed. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see property values.
2025-12-10 12:06:40.838 +03:00 [DBG] Closing data reader to 'GAC-BillingService' on server '.'.
2025-12-10 12:06:40.840 +03:00 [DBG] A data reader for 'GAC-BillingService' on server '.' is being disposed after spending 12ms reading results.
2025-12-10 12:06:40.845 +03:00 [DBG] An entity of type 'AuditEvent' tracked by 'BillingServiceDBContext' changed state from '"Added"' to '"Unchanged"'. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-12-10 12:06:40.851 +03:00 [DBG] An entity of type 'OutboxEvent' tracked by 'BillingServiceDBContext' changed state from '"Added"' to '"Unchanged"'. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-12-10 12:06:40.855 +03:00 [DBG] SaveChanges completed for 'BillingServiceDBContext' with 2 entities written to the database.
2025-12-10 12:06:40.860 +03:00 [DBG] Committing transaction.
2025-12-10 12:06:40.888 +03:00 [DBG] Committed transaction.
2025-12-10 12:06:40.893 +03:00 [DBG] Closing connection to database 'GAC-BillingService' on server '.'.
2025-12-10 12:06:40.898 +03:00 [DBG] Closed connection to database 'GAC-BillingService' on server '.' (4ms).
2025-12-10 12:06:40.903 +03:00 [DBG] Disposing transaction.
2025-12-10 12:06:40.915 +03:00 [DBG] List of registered output formatters, in the following order: ["Microsoft.AspNetCore.Mvc.Formatters.HttpNoContentOutputFormatter","Microsoft.AspNetCore.Mvc.Formatters.StringOutputFormatter","Microsoft.AspNetCore.Mvc.Formatters.StreamOutputFormatter","Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonOutputFormatter"]
2025-12-10 12:06:40.923 +03:00 [DBG] No information found on request to perform content negotiation.
2025-12-10 12:06:40.929 +03:00 [DBG] Attempting to select the first output formatter in the output formatters list which supports a content type from the explicitly specified content types '["application/json"]'.
2025-12-10 12:06:40.934 +03:00 [DBG] Selected output formatter 'Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonOutputFormatter' and content type 'application/json' to write the response.
2025-12-10 12:06:40.939 +03:00 [INF] Executing OkObjectResult, writing value of type 'BillingSystem.SharedKernel.ApiResponse`1[[System.Int64, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-12-10 12:06:40.959 +03:00 [INF] Executed action BillingSystem.API.Controllers.InvoicesController.Post (BillingSystem.API) in 3840.9092ms
2025-12-10 12:06:40.965 +03:00 [INF] Executed endpoint 'BillingSystem.API.Controllers.InvoicesController.Post (BillingSystem.API)'
2025-12-10 12:06:40.969 +03:00 [INF] HTTP POST /api/Invoices/Post 200 in 9654ms
CorrelationId: 379f5064-cbf2-4622-94e9-e90e603fdb5b
Request: {
    "externalId": "379f5064-cbf2-4622-94e9-e90e603fdb5b",
    "tenantId": 2,
    "amount": 200000,
    "currency": "SAR",
    "invoiceType": 2,
    "invoiceStatus": 1,
    "issuedAt": "2025-12-10T08:48:29.095Z",
    "dueAt": "2026-12-29T08:48:29.095Z",
    "IsSubInvoice": true,
    "ClientReferenceNumber": "Installment01",
    "customer": {
        "fullName": "Abdualmajeed alharbi",
        "customerType": 1,
        "identityType": 1,
        "address": {
            "addressCountry": "saudi arabia",
            "addressCity": "riyadh",
            "addressPostalCode": "3445",
            "addressDistrict": "laban",
            "addressStreet": "altaif",
            "addressBuildingNumber": "322",
            "addressSubNumber": "433"
        },
        "identityNumber": "1397026390",
        "phoneNumber": "0582982757",
        "emailAddress": "mnsour@gac.gov.sa",
        "vatnumber": ""
    },
    "Metadata": "{\n  \"cityHappened\": 1,\n  \"fineGroupCode\": 258,\n  \"detailFineType\": 258001,\n  \"regPersonID\": 1025326510,\n  \"remarks\": \"remarks\",\n  \"resolutionRef\": \"\",\n  \"resolutionSource\": 0,\n  \"resolutionType\": 0,\n  \"securityOperatorID\": 1025326332\n}",
    "attachments": [
        {
            "fileName": "string",
            "fileContent": ""
        }
    ],
    "items": [
        {
            "itemName": " ",
            "itemDesc": "  200000 ",
            "amount": 200000
        }
    ]
}
Response: {"message":"invoice created.","statusCode":"200","data":20009,"isSucceed":true,"validationErrors":null}
2025-12-10 12:06:40.982 +03:00 [INF] HTTP POST /api/Invoices/Post responded 200 in 9677.1750 ms
2025-12-10 12:06:40.988 +03:00 [DBG] Connection id "0HNHNPCKCRP0E" completed keep alive response.
2025-12-10 12:06:40.995 +03:00 [DBG] 'BillingServiceDBContext' disposed.
2025-12-10 12:06:41.004 +03:00 [DBG] Disposing connection to database 'GAC-BillingService' on server '.'.
2025-12-10 12:06:41.008 +03:00 [DBG] Disposed connection to database '' on server '' (4ms).
2025-12-10 12:06:41.012 +03:00 [INF] Request finished HTTP/1.1 POST https://localhost:7257/api/Invoices/Post - 200 null application/json; charset=utf-8 9743.2881ms
2025-12-10 12:25:21.858 +03:00 [DBG] Registered model binder providers, in the following order: ["Microsoft.AspNetCore.Mvc.ModelBinding.Binders.BinderTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ServicesModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.BodyModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.HeaderModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FloatingPointTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.EnumTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.DateTimeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.SimpleTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.TryParseModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.CancellationTokenModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ByteArrayModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FormFileModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FormCollectionModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.KeyValuePairModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.DictionaryModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ArrayModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.CollectionModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ComplexObjectModelBinderProvider"]
2025-12-10 12:25:22.062 +03:00 [DBG] Hosting starting
2025-12-10 12:25:22.508 +03:00 [DBG] Starting bus instances: IBus
2025-12-10 12:25:22.517 +03:00 [DBG] Starting bus: "rabbitmq://localhost/"
2025-12-10 12:25:22.549 +03:00 [DBG] Middleware loaded
2025-12-10 12:25:22.553 +03:00 [DBG] Middleware loaded. Script /_framework/aspnetcore-browser-refresh.js (16519 B).
2025-12-10 12:25:22.580 +03:00 [DBG] Middleware loaded. Script /_framework/blazor-hotreload.js (799 B).
2025-12-10 12:25:22.585 +03:00 [DBG] Connect: guest@localhost:5672/
2025-12-10 12:25:22.807 +03:00 [DBG] Middleware loaded: DOTNET_MODIFIABLE_ASSEMBLIES=debug, __ASPNETCORE_BROWSER_TOOLS=true
2025-12-10 12:25:22.809 +03:00 [DBG] Connected: guest@localhost:5672/ (address: amqp://localhost:5672, local: 54508)
2025-12-10 12:25:22.889 +03:00 [DBG] Endpoint Ready: "rabbitmq://localhost/ECHGHANNAMLP1_BillingSystemAPI_bus_4ymoyyyh3bcsyqsrbdxdxuombw?temporary=true"
2025-12-10 12:25:22.894 +03:00 [INF] Bus started: "rabbitmq://localhost/"
2025-12-10 12:25:23.144 +03:00 [INF] Now listening on: https://localhost:7257
2025-12-10 12:25:23.164 +03:00 [INF] Now listening on: http://localhost:5009
2025-12-10 12:25:23.170 +03:00 [DBG] Loaded hosting startup assembly BillingSystem.API
2025-12-10 12:25:23.175 +03:00 [DBG] Loaded hosting startup assembly Microsoft.WebTools.ApiEndpointDiscovery
2025-12-10 12:25:23.177 +03:00 [DBG] Loaded hosting startup assembly Microsoft.AspNetCore.Watch.BrowserRefresh
2025-12-10 12:25:23.180 +03:00 [DBG] Loaded hosting startup assembly Microsoft.WebTools.BrowserLink.Net
2025-12-10 12:25:23.412 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-12-10 12:25:23.414 +03:00 [INF] Hosting environment: Development
2025-12-10 12:25:23.417 +03:00 [INF] Content root path: C:\Repositories\Gac-BillingSystem\src\BillingSystem.API
2025-12-10 12:25:23.420 +03:00 [DBG] Hosting started
2025-12-10 12:25:23.537 +03:00 [DBG] Connection id "0HNHNPO5U4UGD" accepted.
2025-12-10 12:25:23.538 +03:00 [DBG] Connection id "0HNHNPO5U4UGC" accepted.
2025-12-10 12:25:23.541 +03:00 [DBG] Connection id "0HNHNPO5U4UGD" started.
2025-12-10 12:25:23.542 +03:00 [DBG] Connection id "0HNHNPO5U4UGC" started.
2025-12-10 12:25:23.564 +03:00 [DBG] Connection id "0HNHNPO5U4UGD" received FIN.
2025-12-10 12:25:23.564 +03:00 [DBG] Connection id "0HNHNPO5U4UGC" received FIN.
2025-12-10 12:25:23.596 +03:00 [DBG] Failed to authenticate HTTPS connection.
System.IO.IOException: Received an unexpected EOF or 0 bytes from the transport stream.
   at System.Net.Security.SslStream.ReceiveHandshakeFrameAsync[TIOAdapter](CancellationToken cancellationToken)
   at System.Net.Security.SslStream.ForceAuthenticationAsync[TIOAdapter](Boolean receiveFirst, Byte[] reAuthenticationData, CancellationToken cancellationToken)
   at System.Net.Security.SslStream.ProcessAuthenticationWithTelemetryAsync(Boolean isAsync, CancellationToken cancellationToken)
   at Microsoft.AspNetCore.Server.Kestrel.Https.Internal.HttpsConnectionMiddleware.OnConnectionAsync(ConnectionContext context)
2025-12-10 12:25:23.596 +03:00 [DBG] Failed to authenticate HTTPS connection.
System.IO.IOException: Received an unexpected EOF or 0 bytes from the transport stream.
   at System.Net.Security.SslStream.ReceiveHandshakeFrameAsync[TIOAdapter](CancellationToken cancellationToken)
   at System.Net.Security.SslStream.ForceAuthenticationAsync[TIOAdapter](Boolean receiveFirst, Byte[] reAuthenticationData, CancellationToken cancellationToken)
   at System.Net.Security.SslStream.ProcessAuthenticationWithTelemetryAsync(Boolean isAsync, CancellationToken cancellationToken)
   at Microsoft.AspNetCore.Server.Kestrel.Https.Internal.HttpsConnectionMiddleware.OnConnectionAsync(ConnectionContext context)
2025-12-10 12:25:23.648 +03:00 [DBG] Connection id "0HNHNPO5U4UGC" stopped.
2025-12-10 12:25:23.652 +03:00 [DBG] Connection id "0HNHNPO5U4UGD" stopped.
2025-12-10 12:25:23.705 +03:00 [DBG] Connection id "0HNHNPO5U4UGC" sending FIN because: "The Socket transport's send loop completed gracefully."
2025-12-10 12:25:23.705 +03:00 [DBG] Connection id "0HNHNPO5U4UGD" sending FIN because: "The Socket transport's send loop completed gracefully."
2025-12-10 12:25:25.244 +03:00 [DBG] Connection id "0HNHNPO5U4UGE" accepted.
2025-12-10 12:25:25.248 +03:00 [DBG] Connection id "0HNHNPO5U4UGE" started.
2025-12-10 12:25:25.306 +03:00 [DBG] Connection 0HNHNPO5U4UGE established using the following protocol: "Tls13"
2025-12-10 12:25:25.447 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7257/swagger/index.html - null null
2025-12-10 12:25:25.596 +03:00 [DBG] Wildcard detected, all requests with hosts will be allowed.
2025-12-10 12:25:25.632 +03:00 [DBG] No candidates found for the request path '/swagger/index.html'
2025-12-10 12:25:25.643 +03:00 [DBG] Request did not match any endpoints
2025-12-10 12:25:25.743 +03:00 [DBG] Response markup is scheduled to include Browser Link script injection.
2025-12-10 12:25:25.748 +03:00 [DBG] Response markup is scheduled to include browser refresh script injection.
2025-12-10 12:25:25.776 +03:00 [INF] HTTP GET /swagger/index.html responded 200 in 121.4840 ms
2025-12-10 12:25:25.786 +03:00 [DBG] Response markup was updated to include Browser Link script injection.
2025-12-10 12:25:25.790 +03:00 [DBG] Response markup was updated to include browser refresh script injection.
2025-12-10 12:25:25.799 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7257/swagger/index.html - 200 null text/html;charset=utf-8 379.8349ms
2025-12-10 12:25:25.849 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7257/_framework/aspnetcore-browser-refresh.js - null null
2025-12-10 12:25:25.876 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7257/_vs/browserLink - null null
2025-12-10 12:25:25.896 +03:00 [DBG] Script injected: /_framework/aspnetcore-browser-refresh.js
2025-12-10 12:25:25.908 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7257/_framework/aspnetcore-browser-refresh.js - 200 16519 application/javascript; charset=utf-8 58.4098ms
2025-12-10 12:25:25.975 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7257/_vs/browserLink - 200 null text/javascript; charset=UTF-8 98.8091ms
2025-12-10 12:25:26.032 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7257/swagger/v1/swagger.json - null null
2025-12-10 12:25:26.040 +03:00 [DBG] No candidates found for the request path '/swagger/v1/swagger.json'
2025-12-10 12:25:26.043 +03:00 [DBG] Request did not match any endpoints
2025-12-10 12:25:26.068 +03:00 [INF] HTTP GET /swagger/v1/swagger.json responded 200 in 21.3208 ms
2025-12-10 12:25:26.079 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7257/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 47.6123ms
2025-12-10 13:20:42.631 +03:00 [DBG] Connection id "0HNHNPO5U4UGE" received FIN.
2025-12-10 13:20:42.648 +03:00 [DBG] The connection queue processing loop for 0HNHNPO5U4UGE completed.
2025-12-10 13:20:42.659 +03:00 [DBG] Connection id "0HNHNPO5U4UGE" is closed. The last processed stream ID was 7.
2025-12-10 13:20:42.667 +03:00 [DBG] Connection id "0HNHNPO5U4UGE" sending FIN because: "The Socket transport's send loop completed gracefully."
2025-12-10 13:20:42.681 +03:00 [DBG] Connection id "0HNHNPO5U4UGE" stopped.
