2025-10-13 11:48:02.538 +03:00 [DBG] Registered model binder providers, in the following order: ["Microsoft.AspNetCore.Mvc.ModelBinding.Binders.BinderTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ServicesModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.BodyModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.HeaderModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FloatingPointTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.EnumTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.DateTimeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.SimpleTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.TryParseModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.CancellationTokenModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ByteArrayModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FormFileModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FormCollectionModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.KeyValuePairModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.DictionaryModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ArrayModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.CollectionModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ComplexObjectModelBinderProvider"]
2025-10-13 11:48:02.686 +03:00 [DBG] Hosting starting
2025-10-13 11:48:02.959 +03:00 [DBG] Starting bus instances: IBus
2025-10-13 11:48:02.966 +03:00 [DBG] Starting bus: "rabbitmq://localhost/"
2025-10-13 11:48:02.989 +03:00 [DBG] Middleware loaded
2025-10-13 11:48:02.993 +03:00 [DBG] Middleware loaded. Script /_framework/aspnetcore-browser-refresh.js (16519 B).
2025-10-13 11:48:02.997 +03:00 [DBG] Middleware loaded. Script /_framework/blazor-hotreload.js (799 B).
2025-10-13 11:48:03.025 +03:00 [DBG] Connect: guest@localhost:5672/
2025-10-13 11:48:03.195 +03:00 [DBG] Connected: guest@localhost:5672/ (address: amqp://localhost:5672, local: 53827)
2025-10-13 11:48:03.251 +03:00 [DBG] Endpoint Ready: "rabbitmq://localhost/ECHGHANNAMLP1_BillingSystemAPI_bus_wbioyyyh3bcsyadnbdxywpjadn?temporary=true"
2025-10-13 11:48:03.255 +03:00 [INF] Bus started: "rabbitmq://localhost/"
2025-10-13 11:48:03.315 +03:00 [DBG] Middleware loaded: DOTNET_MODIFIABLE_ASSEMBLIES=debug, __ASPNETCORE_BROWSER_TOOLS=true
2025-10-13 11:48:03.505 +03:00 [INF] Now listening on: https://localhost:7257
2025-10-13 11:48:03.508 +03:00 [INF] Now listening on: http://localhost:5009
2025-10-13 11:48:03.509 +03:00 [DBG] Loaded hosting startup assembly BillingSystem.API
2025-10-13 11:48:03.511 +03:00 [DBG] Loaded hosting startup assembly Microsoft.WebTools.ApiEndpointDiscovery
2025-10-13 11:48:03.512 +03:00 [DBG] Loaded hosting startup assembly Microsoft.AspNetCore.Watch.BrowserRefresh
2025-10-13 11:48:03.514 +03:00 [DBG] Loaded hosting startup assembly Microsoft.WebTools.BrowserLink.Net
2025-10-13 11:48:03.658 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-10-13 11:48:03.660 +03:00 [INF] Hosting environment: Development
2025-10-13 11:48:03.662 +03:00 [INF] Content root path: C:\Repositories\Gac-BillingSystem\src\BillingSystem.API
2025-10-13 11:48:03.663 +03:00 [DBG] Hosting started
2025-10-13 11:48:03.683 +03:00 [DBG] Connection id "0HNGA6KSDSN35" received FIN.
2025-10-13 11:48:03.692 +03:00 [DBG] Connection id "0HNGA6KSDSN35" accepted.
2025-10-13 11:48:03.695 +03:00 [DBG] Connection id "0HNGA6KSDSN35" started.
2025-10-13 11:48:03.713 +03:00 [DBG] Failed to authenticate HTTPS connection.
System.IO.IOException: Received an unexpected EOF or 0 bytes from the transport stream.
   at System.Net.Security.SslStream.ReceiveHandshakeFrameAsync[TIOAdapter](CancellationToken cancellationToken)
   at System.Net.Security.SslStream.ForceAuthenticationAsync[TIOAdapter](Boolean receiveFirst, Byte[] reAuthenticationData, CancellationToken cancellationToken)
   at System.Net.Security.SslStream.ProcessAuthenticationWithTelemetryAsync(Boolean isAsync, CancellationToken cancellationToken)
   at Microsoft.AspNetCore.Server.Kestrel.Https.Internal.HttpsConnectionMiddleware.OnConnectionAsync(ConnectionContext context)
2025-10-13 11:48:03.763 +03:00 [DBG] Connection id "0HNGA6KSDSN35" stopped.
2025-10-13 11:48:03.772 +03:00 [DBG] Connection id "0HNGA6KSDSN35" sending FIN because: "The Socket transport's send loop completed gracefully."
2025-10-13 11:48:04.545 +03:00 [DBG] Connection id "0HNGA6KSDSN36" accepted.
2025-10-13 11:48:04.548 +03:00 [DBG] Connection id "0HNGA6KSDSN36" started.
2025-10-13 11:48:04.598 +03:00 [DBG] Connection 0HNGA6KSDSN36 established using the following protocol: "Tls12"
2025-10-13 11:48:04.671 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7257/swagger - null null
2025-10-13 11:48:04.748 +03:00 [DBG] Wildcard detected, all requests with hosts will be allowed.
2025-10-13 11:48:04.769 +03:00 [DBG] No candidates found for the request path '/swagger'
2025-10-13 11:48:04.771 +03:00 [DBG] Request did not match any endpoints
2025-10-13 11:48:04.780 +03:00 [INF] HTTP GET /swagger responded 301 in 3.7311 ms
2025-10-13 11:48:04.787 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7257/swagger - 301 0 null 123.421ms
2025-10-13 11:48:04.791 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7257/swagger/index.html - null null
2025-10-13 11:48:04.799 +03:00 [DBG] No candidates found for the request path '/swagger/index.html'
2025-10-13 11:48:04.800 +03:00 [DBG] Request did not match any endpoints
2025-10-13 11:48:04.852 +03:00 [DBG] Response markup is scheduled to include Browser Link script injection.
2025-10-13 11:48:04.856 +03:00 [DBG] Response markup is scheduled to include browser refresh script injection.
2025-10-13 11:48:04.875 +03:00 [INF] HTTP GET /swagger/index.html responded 200 in 73.4839 ms
2025-10-13 11:48:04.881 +03:00 [DBG] Response markup was updated to include Browser Link script injection.
2025-10-13 11:48:04.883 +03:00 [DBG] Response markup was updated to include browser refresh script injection.
2025-10-13 11:48:04.886 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7257/swagger/index.html - 200 null text/html;charset=utf-8 94.9338ms
2025-10-13 11:48:04.897 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7257/swagger/swagger-ui.css - null null
2025-10-13 11:48:04.898 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7257/swagger/swagger-ui-bundle.js - null null
2025-10-13 11:48:04.900 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7257/swagger/swagger-ui-standalone-preset.js - null null
2025-10-13 11:48:04.903 +03:00 [DBG] No candidates found for the request path '/swagger/swagger-ui.css'
2025-10-13 11:48:04.900 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7257/_framework/aspnetcore-browser-refresh.js - null null
2025-10-13 11:48:04.913 +03:00 [DBG] No candidates found for the request path '/swagger/swagger-ui-standalone-preset.js'
2025-10-13 11:48:04.916 +03:00 [DBG] Request did not match any endpoints
2025-10-13 11:48:04.921 +03:00 [DBG] Request did not match any endpoints
2025-10-13 11:48:04.908 +03:00 [DBG] No candidates found for the request path '/swagger/swagger-ui-bundle.js'
2025-10-13 11:48:04.925 +03:00 [DBG] Script injected: /_framework/aspnetcore-browser-refresh.js
2025-10-13 11:48:04.927 +03:00 [DBG] Request did not match any endpoints
2025-10-13 11:48:04.929 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7257/_framework/aspnetcore-browser-refresh.js - 200 16519 application/javascript; charset=utf-8 29.98ms
2025-10-13 11:48:04.966 +03:00 [INF] Sending file. Request path: '/swagger-ui-standalone-preset.js'. Physical path: 'N/A'
2025-10-13 11:48:04.966 +03:00 [INF] Sending file. Request path: '/swagger-ui.css'. Physical path: 'N/A'
2025-10-13 11:48:04.969 +03:00 [INF] HTTP GET /swagger/swagger-ui-standalone-preset.js responded 200 in 44.0947 ms
2025-10-13 11:48:04.973 +03:00 [INF] HTTP GET /swagger/swagger-ui.css responded 200 in 48.8270 ms
2025-10-13 11:48:04.977 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7257/swagger/swagger-ui-standalone-preset.js - 200 230280 text/javascript 77.5456ms
2025-10-13 11:48:04.981 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7257/swagger/swagger-ui.css - 200 152034 text/css 83.9814ms
2025-10-13 11:48:04.981 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7257/_vs/browserLink - null null
2025-10-13 11:48:04.981 +03:00 [INF] Sending file. Request path: '/swagger-ui-bundle.js'. Physical path: 'N/A'
2025-10-13 11:48:04.995 +03:00 [INF] HTTP GET /swagger/swagger-ui-bundle.js responded 200 in 65.5248 ms
2025-10-13 11:48:04.998 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7257/swagger/swagger-ui-bundle.js - 200 1456926 text/javascript 100.0184ms
2025-10-13 11:48:05.046 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7257/_vs/browserLink - 200 null text/javascript; charset=UTF-8 65.4263ms
2025-10-13 11:48:05.111 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7257/swagger/v1/swagger.json - null null
2025-10-13 11:48:05.114 +03:00 [DBG] No candidates found for the request path '/swagger/v1/swagger.json'
2025-10-13 11:48:05.115 +03:00 [DBG] Request did not match any endpoints
2025-10-13 11:48:05.124 +03:00 [INF] HTTP GET /swagger/v1/swagger.json responded 200 in 6.9362 ms
2025-10-13 11:48:05.127 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7257/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 16.7062ms
2025-10-13 11:50:56.477 +03:00 [INF] Request starting HTTP/2 POST https://localhost:7257/api/Invoices - application/json 236
2025-10-13 11:50:56.483 +03:00 [DBG] 1 candidate(s) found for the request path '/api/Invoices'
2025-10-13 11:50:56.489 +03:00 [DBG] Endpoint 'BillingSystem.API.Controllers.InvoicesController.Post (BillingSystem.API)' with route pattern 'api/Invoices' is valid for the request path '/api/Invoices'
2025-10-13 11:50:56.491 +03:00 [DBG] Request matched endpoint 'BillingSystem.API.Controllers.InvoicesController.Post (BillingSystem.API)'
2025-10-13 11:50:56.493 +03:00 [DBG] Static files was skipped as the request already matched an endpoint.
2025-10-13 11:50:56.495 +03:00 [DBG] The request has an origin header: 'https://localhost:7257'.
2025-10-13 11:50:56.497 +03:00 [INF] CORS policy execution failed.
2025-10-13 11:50:56.498 +03:00 [INF] Request origin https://localhost:7257 does not have permission to access the resource.
2025-10-13 11:50:56.745 +03:00 [DBG] An 'IServiceProvider' was created for internal use by Entity Framework.
2025-10-13 11:51:02.018 +03:00 [ERR] HTTP POST /api/Invoices responded 500 in 5524.6455 ms
System.InvalidOperationException: The response cannot be cleared, it has already started sending.
   at Microsoft.AspNetCore.Http.ResponseExtensions.Clear(HttpResponse response)
   at BillingSystem.API.Middlewares.TenantIdValidatorMiddleware.InvokeAsync(HttpContext context, ITenantService tenantService) in C:\Repositories\Gac-BillingSystem\src\BillingSystem.API\Middlewares\TenantIdValidatorMiddleware.cs:line 23
   at BillingSystem.API.Middlewares.IdempotencyKeyValidatorMiddleware.InvokeAsync(HttpContext context) in C:\Repositories\Gac-BillingSystem\src\BillingSystem.API\Middlewares\IdempotencyKeyValidatorMiddleware.cs:line 31
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Serilog.AspNetCore.RequestLoggingMiddleware.Invoke(HttpContext httpContext)
2025-10-13 11:51:02.027 +03:00 [ERR] An unhandled exception has occurred while executing the request.
System.InvalidOperationException: The response cannot be cleared, it has already started sending.
   at Microsoft.AspNetCore.Http.ResponseExtensions.Clear(HttpResponse response)
   at BillingSystem.API.Middlewares.TenantIdValidatorMiddleware.InvokeAsync(HttpContext context, ITenantService tenantService) in C:\Repositories\Gac-BillingSystem\src\BillingSystem.API\Middlewares\TenantIdValidatorMiddleware.cs:line 23
   at BillingSystem.API.Middlewares.IdempotencyKeyValidatorMiddleware.InvokeAsync(HttpContext context) in C:\Repositories\Gac-BillingSystem\src\BillingSystem.API\Middlewares\IdempotencyKeyValidatorMiddleware.cs:line 31
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Serilog.AspNetCore.RequestLoggingMiddleware.Invoke(HttpContext httpContext)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-10-13 11:51:02.033 +03:00 [WRN] The response has already started, the error page middleware will not be executed.
2025-10-13 11:51:02.038 +03:00 [ERR] Connection id "0HNGA6KSDSN36", Request id "0HNGA6KSDSN36:00000011": An unhandled exception was thrown by the application.
System.InvalidOperationException: The response cannot be cleared, it has already started sending.
   at Microsoft.AspNetCore.Http.ResponseExtensions.Clear(HttpResponse response)
   at BillingSystem.API.Middlewares.TenantIdValidatorMiddleware.InvokeAsync(HttpContext context, ITenantService tenantService) in C:\Repositories\Gac-BillingSystem\src\BillingSystem.API\Middlewares\TenantIdValidatorMiddleware.cs:line 23
   at BillingSystem.API.Middlewares.IdempotencyKeyValidatorMiddleware.InvokeAsync(HttpContext context) in C:\Repositories\Gac-BillingSystem\src\BillingSystem.API\Middlewares\IdempotencyKeyValidatorMiddleware.cs:line 31
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Serilog.AspNetCore.RequestLoggingMiddleware.Invoke(HttpContext httpContext)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.WebTools.BrowserLink.Net.BrowserLinkMiddleware.InvokeAsync(HttpContext context)
   at Microsoft.AspNetCore.Watch.BrowserRefresh.BrowserRefreshMiddleware.InvokeAsync(HttpContext context)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.ProcessRequests[TContext](IHttpApplication`1 application)
2025-10-13 11:51:02.090 +03:00 [DBG] Trace id "0HNGA6KSDSN36:00000011": HTTP/2 stream error ""INTERNAL_ERROR"". A Reset is being sent to the stream.
Microsoft.AspNetCore.Connections.ConnectionAbortedException: An error occurred after the response headers were sent, a reset is being sent.
2025-10-13 11:51:02.094 +03:00 [INF] Request finished HTTP/2 POST https://localhost:7257/api/Invoices - 400 null null 5617.3356ms
2025-10-13 11:51:57.029 +03:00 [INF] Request starting HTTP/2 POST https://localhost:7257/api/Invoices - application/json 236
2025-10-13 11:51:57.033 +03:00 [DBG] 1 candidate(s) found for the request path '/api/Invoices'
2025-10-13 11:51:57.035 +03:00 [DBG] Endpoint 'BillingSystem.API.Controllers.InvoicesController.Post (BillingSystem.API)' with route pattern 'api/Invoices' is valid for the request path '/api/Invoices'
2025-10-13 11:51:57.037 +03:00 [DBG] Request matched endpoint 'BillingSystem.API.Controllers.InvoicesController.Post (BillingSystem.API)'
2025-10-13 11:51:57.039 +03:00 [DBG] Static files was skipped as the request already matched an endpoint.
2025-10-13 11:51:57.040 +03:00 [DBG] The request has an origin header: 'https://localhost:7257'.
2025-10-13 11:51:57.042 +03:00 [INF] CORS policy execution failed.
2025-10-13 11:51:57.045 +03:00 [INF] Request origin https://localhost:7257 does not have permission to access the resource.
2025-10-13 11:52:23.855 +03:00 [ERR] HTTP POST /api/Invoices responded 500 in 26815.5220 ms
System.InvalidOperationException: The response cannot be cleared, it has already started sending.
   at Microsoft.AspNetCore.Http.ResponseExtensions.Clear(HttpResponse response)
   at BillingSystem.API.Middlewares.TenantIdValidatorMiddleware.InvokeAsync(HttpContext context, ITenantService tenantService) in C:\Repositories\Gac-BillingSystem\src\BillingSystem.API\Middlewares\TenantIdValidatorMiddleware.cs:line 23
   at BillingSystem.API.Middlewares.IdempotencyKeyValidatorMiddleware.InvokeAsync(HttpContext context) in C:\Repositories\Gac-BillingSystem\src\BillingSystem.API\Middlewares\IdempotencyKeyValidatorMiddleware.cs:line 31
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Serilog.AspNetCore.RequestLoggingMiddleware.Invoke(HttpContext httpContext)
2025-10-13 11:52:23.860 +03:00 [ERR] An unhandled exception has occurred while executing the request.
System.InvalidOperationException: The response cannot be cleared, it has already started sending.
   at Microsoft.AspNetCore.Http.ResponseExtensions.Clear(HttpResponse response)
   at BillingSystem.API.Middlewares.TenantIdValidatorMiddleware.InvokeAsync(HttpContext context, ITenantService tenantService) in C:\Repositories\Gac-BillingSystem\src\BillingSystem.API\Middlewares\TenantIdValidatorMiddleware.cs:line 23
   at BillingSystem.API.Middlewares.IdempotencyKeyValidatorMiddleware.InvokeAsync(HttpContext context) in C:\Repositories\Gac-BillingSystem\src\BillingSystem.API\Middlewares\IdempotencyKeyValidatorMiddleware.cs:line 31
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Serilog.AspNetCore.RequestLoggingMiddleware.Invoke(HttpContext httpContext)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-10-13 11:52:23.867 +03:00 [WRN] The response has already started, the error page middleware will not be executed.
2025-10-13 11:52:23.869 +03:00 [ERR] Connection id "0HNGA6KSDSN36", Request id "0HNGA6KSDSN36:00000013": An unhandled exception was thrown by the application.
System.InvalidOperationException: The response cannot be cleared, it has already started sending.
   at Microsoft.AspNetCore.Http.ResponseExtensions.Clear(HttpResponse response)
   at BillingSystem.API.Middlewares.TenantIdValidatorMiddleware.InvokeAsync(HttpContext context, ITenantService tenantService) in C:\Repositories\Gac-BillingSystem\src\BillingSystem.API\Middlewares\TenantIdValidatorMiddleware.cs:line 23
   at BillingSystem.API.Middlewares.IdempotencyKeyValidatorMiddleware.InvokeAsync(HttpContext context) in C:\Repositories\Gac-BillingSystem\src\BillingSystem.API\Middlewares\IdempotencyKeyValidatorMiddleware.cs:line 31
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Serilog.AspNetCore.RequestLoggingMiddleware.Invoke(HttpContext httpContext)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.WebTools.BrowserLink.Net.BrowserLinkMiddleware.InvokeAsync(HttpContext context)
   at Microsoft.AspNetCore.Watch.BrowserRefresh.BrowserRefreshMiddleware.InvokeAsync(HttpContext context)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.ProcessRequests[TContext](IHttpApplication`1 application)
2025-10-13 11:52:23.876 +03:00 [DBG] Trace id "0HNGA6KSDSN36:00000013": HTTP/2 stream error ""INTERNAL_ERROR"". A Reset is being sent to the stream.
Microsoft.AspNetCore.Connections.ConnectionAbortedException: An error occurred after the response headers were sent, a reset is being sent.
2025-10-13 11:52:23.878 +03:00 [INF] Request finished HTTP/2 POST https://localhost:7257/api/Invoices - 400 null null 26848.0459ms
2025-10-13 11:53:43.820 +03:00 [DBG] Connection id "0HNGA6KSDSN37" accepted.
2025-10-13 11:53:43.821 +03:00 [DBG] Connection id "0HNGA6KSDSN37" received FIN.
2025-10-13 11:53:43.822 +03:00 [DBG] Connection id "0HNGA6KSDSN37" started.
2025-10-13 11:53:43.822 +03:00 [DBG] Connection id "0HNGA6KSDSN38" accepted.
2025-10-13 11:53:43.825 +03:00 [DBG] Failed to authenticate HTTPS connection.
System.IO.IOException: Received an unexpected EOF or 0 bytes from the transport stream.
   at System.Net.Security.SslStream.ReceiveHandshakeFrameAsync[TIOAdapter](CancellationToken cancellationToken)
   at System.Net.Security.SslStream.ForceAuthenticationAsync[TIOAdapter](Boolean receiveFirst, Byte[] reAuthenticationData, CancellationToken cancellationToken)
   at System.Net.Security.SslStream.ProcessAuthenticationWithTelemetryAsync(Boolean isAsync, CancellationToken cancellationToken)
   at Microsoft.AspNetCore.Server.Kestrel.Https.Internal.HttpsConnectionMiddleware.OnConnectionAsync(ConnectionContext context)
2025-10-13 11:53:43.826 +03:00 [DBG] Connection id "0HNGA6KSDSN38" started.
2025-10-13 11:53:43.829 +03:00 [DBG] Connection id "0HNGA6KSDSN37" stopped.
2025-10-13 11:53:43.831 +03:00 [DBG] Connection id "0HNGA6KSDSN37" sending FIN because: "The Socket transport's send loop completed gracefully."
2025-10-13 11:53:43.835 +03:00 [DBG] Connection 0HNGA6KSDSN38 established using the following protocol: "Tls12"
2025-10-13 11:53:43.841 +03:00 [INF] Request starting HTTP/1.1 POST https://localhost:7257/api/Invoices - application/json 261
2025-10-13 11:53:43.843 +03:00 [DBG] 1 candidate(s) found for the request path '/api/Invoices'
2025-10-13 11:53:43.844 +03:00 [DBG] Endpoint 'BillingSystem.API.Controllers.InvoicesController.Post (BillingSystem.API)' with route pattern 'api/Invoices' is valid for the request path '/api/Invoices'
2025-10-13 11:53:43.846 +03:00 [DBG] Request matched endpoint 'BillingSystem.API.Controllers.InvoicesController.Post (BillingSystem.API)'
2025-10-13 11:53:43.847 +03:00 [DBG] Static files was skipped as the request already matched an endpoint.
2025-10-13 11:54:16.942 +03:00 [INF] Executing endpoint 'BillingSystem.API.Controllers.InvoicesController.Post (BillingSystem.API)'
2025-10-13 11:54:16.976 +03:00 [INF] Route matched with {action = "Post", controller = "Invoices"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Post(BillingSystem.Application.Requests.CreateInvoiceRequest) on controller BillingSystem.API.Controllers.InvoicesController (BillingSystem.API).
2025-10-13 11:54:16.981 +03:00 [DBG] Execution plan of authorization filters (in the following order): ["None"]
2025-10-13 11:54:16.982 +03:00 [DBG] Execution plan of resource filters (in the following order): ["None"]
2025-10-13 11:54:16.984 +03:00 [DBG] Execution plan of action filters (in the following order): ["Microsoft.AspNetCore.Mvc.ModelBinding.UnsupportedContentTypeFilter (Order: -3000)","Microsoft.AspNetCore.Mvc.Infrastructure.ModelStateInvalidFilter (Order: -2000)","BillingSystem.API.ActionFilters.AuditBillingRequestsFilter","BillingSystem.API.ActionFilters.IdempotencyFilter (Order: 0)"]
2025-10-13 11:54:16.988 +03:00 [DBG] Execution plan of exception filters (in the following order): ["None"]
2025-10-13 11:54:16.989 +03:00 [DBG] Execution plan of result filters (in the following order): ["Microsoft.AspNetCore.Mvc.Infrastructure.ClientErrorResultFilter (Order: -2000)","Microsoft.AspNetCore.Mvc.ProducesAttribute (Order: 0)","BillingSystem.API.ActionFilters.IdempotencyFilter (Order: 0)"]
2025-10-13 11:54:16.993 +03:00 [DBG] Executing controller factory for controller BillingSystem.API.Controllers.InvoicesController (BillingSystem.API)
2025-10-13 11:54:16.998 +03:00 [WRN] You do not have a valid license key for the Lucky Penny software MediatR. This is allowed for development and testing scenarios. If you are running in production you are required to have a licensed version. Please visit https://luckypennysoftware.com to obtain a valid license.
2025-10-13 11:54:17.020 +03:00 [DBG] Executed controller factory for controller BillingSystem.API.Controllers.InvoicesController (BillingSystem.API)
2025-10-13 11:54:17.025 +03:00 [DBG] Attempting to bind parameter 'invoiceRequest' of type 'BillingSystem.Application.Requests.CreateInvoiceRequest' ...
2025-10-13 11:54:17.031 +03:00 [DBG] Attempting to bind parameter 'invoiceRequest' of type 'BillingSystem.Application.Requests.CreateInvoiceRequest' using the name '' in request data ...
2025-10-13 11:54:17.033 +03:00 [DBG] Selected input formatter 'Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonInputFormatter' for content type 'application/json'.
2025-10-13 11:54:17.052 +03:00 [DBG] Connection id "0HNGA6KSDSN38", Request id "0HNGA6KSDSN38:00000001": started reading request body.
2025-10-13 11:54:17.054 +03:00 [DBG] Connection id "0HNGA6KSDSN38", Request id "0HNGA6KSDSN38:00000001": done reading request body.
2025-10-13 11:54:17.073 +03:00 [DBG] JSON input formatter succeeded, deserializing to type 'BillingSystem.Application.Requests.CreateInvoiceRequest'
2025-10-13 11:54:17.075 +03:00 [DBG] Done attempting to bind parameter 'invoiceRequest' of type 'BillingSystem.Application.Requests.CreateInvoiceRequest'.
2025-10-13 11:54:17.077 +03:00 [DBG] Done attempting to bind parameter 'invoiceRequest' of type 'BillingSystem.Application.Requests.CreateInvoiceRequest'.
2025-10-13 11:54:17.079 +03:00 [DBG] Attempting to validate the bound parameter 'invoiceRequest' of type 'BillingSystem.Application.Requests.CreateInvoiceRequest' ...
2025-10-13 11:54:17.092 +03:00 [DBG] Done attempting to validate the bound parameter 'invoiceRequest' of type 'BillingSystem.Application.Requests.CreateInvoiceRequest'.
2025-10-13 11:55:17.007 +03:00 [DBG] Entity Framework Core 9.0.9 initialized 'BillingServiceDBContext' using provider 'Microsoft.EntityFrameworkCore.SqlServer:9.0.9' with options: EngineType=SqlServer 
2025-10-13 11:55:17.135 +03:00 [DBG] Compiling query expression: 
'DbSet<Invoice>()
    .AsNoTracking()
    .Any(inv => inv.ExternalId.ToString() == __idempotentKey_0)'
2025-10-13 11:55:17.380 +03:00 [DBG] Generated query execution expression: 
'queryContext => ShapedQueryCompilingExpressionVisitor.SingleAsync<bool>(
    asyncEnumerable: SingleQueryingEnumerable.Create<bool>(
        relationalQueryContext: (RelationalQueryContext)queryContext, 
        relationalCommandResolver: parameters => [LIFTABLE Constant: RelationalCommandCache.QueryExpression(
            Projection Mapping:
                EmptyProjectionMember -> 0
            SELECT EXISTS (
                SELECT 1
                FROM Invoices AS i
                WHERE COALESCE(CONVERT(varchar(36), i.ExternalId), '') == @__idempotentKey_0)) | Resolver: c => new RelationalCommandCache(
            c.Dependencies.MemoryCache, 
            c.RelationalDependencies.QuerySqlGeneratorFactory, 
            c.RelationalDependencies.RelationalParameterBasedSqlProcessorFactory, 
            Projection Mapping:
                EmptyProjectionMember -> 0
            SELECT EXISTS (
                SELECT 1
                FROM Invoices AS i
                WHERE COALESCE(CONVERT(varchar(36), i.ExternalId), '') == @__idempotentKey_0), 
            False, 
            new HashSet<string>(
                new string[]{ }, 
                StringComparer.Ordinal
            )
        )].GetRelationalCommandTemplate(parameters), 
        readerColumns: null, 
        shaper: (queryContext, dataReader, resultContext, resultCoordinator) => 
        {
            bool? value1;
            value1 = dataReader.IsDBNull(0) ? default(bool?) : (bool?)dataReader.GetBoolean(0);
            return (bool)value1;
        }, 
        contextType: BillingSystem.Infrastructure.EF.BillingServiceDBContext, 
        standAloneStateManager: False, 
        detailedErrorsEnabled: False, 
        threadSafetyChecksEnabled: True), 
    cancellationToken: queryContext.CancellationToken)'
2025-10-13 11:55:17.436 +03:00 [DBG] Creating DbConnection.
2025-10-13 11:55:17.460 +03:00 [DBG] Created DbConnection. (21ms).
2025-10-13 11:55:17.465 +03:00 [DBG] Opening connection to database 'GAC-BillingService' on server '.'.
2025-10-13 11:55:17.950 +03:00 [DBG] Opened connection to database 'GAC-BillingService' on server '.'.
2025-10-13 11:55:17.955 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-10-13 11:55:17.962 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (4ms).
2025-10-13 11:55:17.970 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (16ms).
2025-10-13 11:55:17.979 +03:00 [DBG] Executing DbCommand [Parameters=[@__idempotentKey_0='?' (Size = 36) (DbType = AnsiString)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [Invoices] AS [i]
        WHERE CONVERT(varchar(36), [i].[ExternalId]) = @__idempotentKey_0) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2025-10-13 11:55:18.056 +03:00 [INF] Executed DbCommand (79ms) [Parameters=[@__idempotentKey_0='?' (Size = 36) (DbType = AnsiString)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [Invoices] AS [i]
        WHERE CONVERT(varchar(36), [i].[ExternalId]) = @__idempotentKey_0) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2025-10-13 11:55:18.075 +03:00 [DBG] Closing data reader to 'GAC-BillingService' on server '.'.
2025-10-13 11:55:18.084 +03:00 [DBG] A data reader for 'GAC-BillingService' on server '.' is being disposed after spending 19ms reading results.
2025-10-13 11:55:18.089 +03:00 [DBG] Closing connection to database 'GAC-BillingService' on server '.'.
2025-10-13 11:55:18.096 +03:00 [DBG] Closed connection to database 'GAC-BillingService' on server '.' (6ms).
2025-10-13 11:55:27.254 +03:00 [WRN] You do not have a valid license key for the Lucky Penny software AutoMapper. This is allowed for development and testing scenarios. If you are running in production you are required to have a licensed version. Please visit https://luckypennysoftware.com to obtain a valid license.
2025-10-13 11:55:28.089 +03:00 [DBG] Opening connection to database 'GAC-BillingService' on server '.'.
2025-10-13 11:55:28.092 +03:00 [DBG] Opened connection to database 'GAC-BillingService' on server '.'.
2025-10-13 11:55:28.094 +03:00 [DBG] Beginning transaction with isolation level 'Unspecified'.
2025-10-13 11:55:28.103 +03:00 [DBG] Began transaction with isolation level 'ReadCommitted'.
2025-10-13 11:55:31.111 +03:00 [DBG] 'BillingServiceDBContext' generated a temporary value for the property 'Invoice.Id'. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-10-13 11:55:31.188 +03:00 [DBG] Context 'BillingServiceDBContext' started tracking 'Invoice' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-10-13 11:55:31.842 +03:00 [DBG] SaveChanges starting for 'BillingServiceDBContext'.
2025-10-13 11:55:31.847 +03:00 [DBG] DetectChanges starting for 'BillingServiceDBContext'.
2025-10-13 11:55:31.879 +03:00 [DBG] DetectChanges completed for 'BillingServiceDBContext'.
2025-10-13 11:55:31.953 +03:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-10-13 11:55:31.958 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-10-13 11:55:31.959 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (1ms).
2025-10-13 11:55:31.963 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (4ms).
2025-10-13 11:55:31.965 +03:00 [DBG] Executing DbCommand [Parameters=[@p0='?' (Precision = 18) (DbType = Decimal), @p1='?' (Size = 50), @p2='?' (DbType = DateTime), @p3='?' (Size = 50), @p4='?' (DbType = DateTime), @p5='?' (DbType = Guid), @p6='?' (DbType = Int32), @p7='?' (DbType = Int32), @p8='?' (DbType = Boolean), @p9='?' (DbType = DateTime), @p10='?' (DbType = DateTime), @p11='?' (Size = 100), @p12='?' (Size = 100), @p13='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [Invoices] ([Amount], [CreatedBy], [CreatedDate], [Currency], [DueAt], [ExternalId], [InvoiceStatus], [InvoiceType], [IsDeleted], [IssuedAt], [LastUpdatedDate], [PaymentProvider], [PaymentReference], [TenantId])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13);
2025-10-13 11:55:31.974 +03:00 [INF] Executed DbCommand (10ms) [Parameters=[@p0='?' (Precision = 18) (DbType = Decimal), @p1='?' (Size = 50), @p2='?' (DbType = DateTime), @p3='?' (Size = 50), @p4='?' (DbType = DateTime), @p5='?' (DbType = Guid), @p6='?' (DbType = Int32), @p7='?' (DbType = Int32), @p8='?' (DbType = Boolean), @p9='?' (DbType = DateTime), @p10='?' (DbType = DateTime), @p11='?' (Size = 100), @p12='?' (Size = 100), @p13='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [Invoices] ([Amount], [CreatedBy], [CreatedDate], [Currency], [DueAt], [ExternalId], [InvoiceStatus], [InvoiceType], [IsDeleted], [IssuedAt], [LastUpdatedDate], [PaymentProvider], [PaymentReference], [TenantId])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13);
2025-10-13 11:55:32.004 +03:00 [DBG] Closing data reader to 'GAC-BillingService' on server '.'.
2025-10-13 11:55:32.006 +03:00 [DBG] A data reader for 'GAC-BillingService' on server '.' is being disposed after spending 28ms reading results.
2025-10-13 11:55:32.021 +03:00 [ERR] An exception occurred in the database while saving changes for context type 'BillingSystem.Infrastructure.EF.BillingServiceDBContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): Cannot insert the value NULL into column 'CreatedBy', table 'GAC-BillingService.dbo.Invoices'; column does not allow nulls. INSERT fails.
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:ea078550-a705-4f10-9af9-c9bb415d9a6b
Error Number:515,State:2,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalDatabase.SaveChangesAsync(IList`1 entries, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): Cannot insert the value NULL into column 'CreatedBy', table 'GAC-BillingService.dbo.Invoices'; column does not allow nulls. INSERT fails.
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:ea078550-a705-4f10-9af9-c9bb415d9a6b
Error Number:515,State:2,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalDatabase.SaveChangesAsync(IList`1 entries, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2025-10-13 11:57:02.375 +03:00 [DBG] Registered model binder providers, in the following order: ["Microsoft.AspNetCore.Mvc.ModelBinding.Binders.BinderTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ServicesModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.BodyModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.HeaderModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FloatingPointTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.EnumTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.DateTimeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.SimpleTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.TryParseModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.CancellationTokenModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ByteArrayModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FormFileModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FormCollectionModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.KeyValuePairModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.DictionaryModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ArrayModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.CollectionModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ComplexObjectModelBinderProvider"]
2025-10-13 11:57:02.443 +03:00 [DBG] Hosting starting
2025-10-13 11:57:02.583 +03:00 [DBG] Starting bus instances: IBus
2025-10-13 11:57:02.588 +03:00 [DBG] Starting bus: "rabbitmq://localhost/"
2025-10-13 11:57:02.601 +03:00 [DBG] Middleware loaded
2025-10-13 11:57:02.603 +03:00 [DBG] Middleware loaded. Script /_framework/aspnetcore-browser-refresh.js (16519 B).
2025-10-13 11:57:02.605 +03:00 [DBG] Middleware loaded. Script /_framework/blazor-hotreload.js (799 B).
2025-10-13 11:57:02.618 +03:00 [DBG] Connect: guest@localhost:5672/
2025-10-13 11:57:02.685 +03:00 [DBG] Middleware loaded: DOTNET_MODIFIABLE_ASSEMBLIES=debug, __ASPNETCORE_BROWSER_TOOLS=true
2025-10-13 11:57:02.700 +03:00 [DBG] Connected: guest@localhost:5672/ (address: amqp://localhost:5672, local: 59811)
2025-10-13 11:57:02.754 +03:00 [DBG] Endpoint Ready: "rabbitmq://localhost/ECHGHANNAMLP1_BillingSystemAPI_bus_ptooyyyh3bcsy4xkbdxywpu4yp?temporary=true"
2025-10-13 11:57:02.757 +03:00 [INF] Bus started: "rabbitmq://localhost/"
2025-10-13 11:57:02.794 +03:00 [INF] Now listening on: https://localhost:7257
2025-10-13 11:57:02.796 +03:00 [INF] Now listening on: http://localhost:5009
2025-10-13 11:57:02.797 +03:00 [DBG] Loaded hosting startup assembly BillingSystem.API
2025-10-13 11:57:02.798 +03:00 [DBG] Loaded hosting startup assembly Microsoft.WebTools.ApiEndpointDiscovery
2025-10-13 11:57:02.799 +03:00 [DBG] Loaded hosting startup assembly Microsoft.AspNetCore.Watch.BrowserRefresh
2025-10-13 11:57:02.800 +03:00 [DBG] Loaded hosting startup assembly Microsoft.WebTools.BrowserLink.Net
2025-10-13 11:57:02.855 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-10-13 11:57:02.856 +03:00 [INF] Hosting environment: Development
2025-10-13 11:57:02.858 +03:00 [INF] Content root path: C:\Repositories\Gac-BillingSystem\src\BillingSystem.API
2025-10-13 11:57:02.859 +03:00 [DBG] Hosting started
2025-10-13 11:57:03.137 +03:00 [DBG] Connection id "0HNGA6PT6H428" accepted.
2025-10-13 11:57:03.141 +03:00 [DBG] Connection id "0HNGA6PT6H428" started.
2025-10-13 11:57:03.146 +03:00 [DBG] Connection id "0HNGA6PT6H429" accepted.
2025-10-13 11:57:03.147 +03:00 [DBG] Connection id "0HNGA6PT6H429" started.
2025-10-13 11:57:03.162 +03:00 [DBG] Connection id "0HNGA6PT6H428" received FIN.
2025-10-13 11:57:03.162 +03:00 [DBG] Connection id "0HNGA6PT6H429" received FIN.
2025-10-13 11:57:03.171 +03:00 [DBG] Failed to authenticate HTTPS connection.
System.IO.IOException: Received an unexpected EOF or 0 bytes from the transport stream.
   at System.Net.Security.SslStream.ReceiveHandshakeFrameAsync[TIOAdapter](CancellationToken cancellationToken)
   at System.Net.Security.SslStream.ForceAuthenticationAsync[TIOAdapter](Boolean receiveFirst, Byte[] reAuthenticationData, CancellationToken cancellationToken)
   at System.Net.Security.SslStream.ProcessAuthenticationWithTelemetryAsync(Boolean isAsync, CancellationToken cancellationToken)
   at Microsoft.AspNetCore.Server.Kestrel.Https.Internal.HttpsConnectionMiddleware.OnConnectionAsync(ConnectionContext context)
2025-10-13 11:57:03.171 +03:00 [DBG] Failed to authenticate HTTPS connection.
System.IO.IOException: Received an unexpected EOF or 0 bytes from the transport stream.
   at System.Net.Security.SslStream.ReceiveHandshakeFrameAsync[TIOAdapter](CancellationToken cancellationToken)
   at System.Net.Security.SslStream.ForceAuthenticationAsync[TIOAdapter](Boolean receiveFirst, Byte[] reAuthenticationData, CancellationToken cancellationToken)
   at System.Net.Security.SslStream.ProcessAuthenticationWithTelemetryAsync(Boolean isAsync, CancellationToken cancellationToken)
   at Microsoft.AspNetCore.Server.Kestrel.Https.Internal.HttpsConnectionMiddleware.OnConnectionAsync(ConnectionContext context)
2025-10-13 11:57:03.191 +03:00 [DBG] Connection id "0HNGA6PT6H429" stopped.
2025-10-13 11:57:03.194 +03:00 [DBG] Connection id "0HNGA6PT6H428" stopped.
2025-10-13 11:57:03.199 +03:00 [DBG] Connection id "0HNGA6PT6H429" sending FIN because: "The Socket transport's send loop completed gracefully."
2025-10-13 11:57:03.199 +03:00 [DBG] Connection id "0HNGA6PT6H428" sending FIN because: "The Socket transport's send loop completed gracefully."
2025-10-13 11:57:03.555 +03:00 [DBG] Connection id "0HNGA6PT6H42A" accepted.
2025-10-13 11:57:03.558 +03:00 [DBG] Connection id "0HNGA6PT6H42A" started.
2025-10-13 11:57:03.593 +03:00 [DBG] Connection 0HNGA6PT6H42A established using the following protocol: "Tls12"
2025-10-13 11:57:03.628 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7257/swagger/index.html - null null
2025-10-13 11:57:03.662 +03:00 [DBG] Wildcard detected, all requests with hosts will be allowed.
2025-10-13 11:57:03.674 +03:00 [DBG] No candidates found for the request path '/swagger/index.html'
2025-10-13 11:57:03.675 +03:00 [DBG] Request did not match any endpoints
2025-10-13 11:57:03.715 +03:00 [DBG] Response markup is scheduled to include Browser Link script injection.
2025-10-13 11:57:03.718 +03:00 [DBG] Response markup is scheduled to include browser refresh script injection.
2025-10-13 11:57:03.734 +03:00 [INF] HTTP GET /swagger/index.html responded 200 in 54.6360 ms
2025-10-13 11:57:03.737 +03:00 [DBG] Response markup was updated to include Browser Link script injection.
2025-10-13 11:57:03.740 +03:00 [DBG] Response markup was updated to include browser refresh script injection.
2025-10-13 11:57:03.745 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7257/swagger/index.html - 200 null text/html;charset=utf-8 121.0757ms
2025-10-13 11:57:03.757 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7257/_framework/aspnetcore-browser-refresh.js - null null
2025-10-13 11:57:03.766 +03:00 [DBG] Script injected: /_framework/aspnetcore-browser-refresh.js
2025-10-13 11:57:03.769 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7257/_framework/aspnetcore-browser-refresh.js - 200 16519 application/javascript; charset=utf-8 12.0317ms
2025-10-13 11:57:03.806 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7257/_vs/browserLink - null null
2025-10-13 11:57:03.843 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7257/_vs/browserLink - 200 null text/javascript; charset=UTF-8 36.965ms
2025-10-13 11:57:03.939 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7257/swagger/v1/swagger.json - null null
2025-10-13 11:57:03.944 +03:00 [DBG] No candidates found for the request path '/swagger/v1/swagger.json'
2025-10-13 11:57:03.946 +03:00 [DBG] Request did not match any endpoints
2025-10-13 11:57:03.952 +03:00 [INF] HTTP GET /swagger/v1/swagger.json responded 200 in 4.8821 ms
2025-10-13 11:57:03.954 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7257/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 15.3611ms
2025-10-13 11:57:18.314 +03:00 [DBG] Connection id "0HNGA6PT6H42B" accepted.
2025-10-13 11:57:18.314 +03:00 [DBG] Connection id "0HNGA6PT6H42B" received FIN.
2025-10-13 11:57:18.315 +03:00 [DBG] Connection id "0HNGA6PT6H42B" started.
2025-10-13 11:57:18.316 +03:00 [DBG] Connection id "0HNGA6PT6H42C" accepted.
2025-10-13 11:57:18.319 +03:00 [DBG] Failed to authenticate HTTPS connection.
System.IO.IOException: Received an unexpected EOF or 0 bytes from the transport stream.
   at System.Net.Security.SslStream.ReceiveHandshakeFrameAsync[TIOAdapter](CancellationToken cancellationToken)
   at System.Net.Security.SslStream.ForceAuthenticationAsync[TIOAdapter](Boolean receiveFirst, Byte[] reAuthenticationData, CancellationToken cancellationToken)
   at System.Net.Security.SslStream.ProcessAuthenticationWithTelemetryAsync(Boolean isAsync, CancellationToken cancellationToken)
   at Microsoft.AspNetCore.Server.Kestrel.Https.Internal.HttpsConnectionMiddleware.OnConnectionAsync(ConnectionContext context)
2025-10-13 11:57:18.320 +03:00 [DBG] Connection id "0HNGA6PT6H42C" started.
2025-10-13 11:57:18.323 +03:00 [DBG] Connection id "0HNGA6PT6H42B" stopped.
2025-10-13 11:57:18.327 +03:00 [DBG] Connection id "0HNGA6PT6H42B" sending FIN because: "The Socket transport's send loop completed gracefully."
2025-10-13 11:57:18.328 +03:00 [DBG] Connection 0HNGA6PT6H42C established using the following protocol: "Tls12"
2025-10-13 11:57:18.334 +03:00 [INF] Request starting HTTP/1.1 POST https://localhost:7257/api/Invoices - application/json 261
2025-10-13 11:57:18.339 +03:00 [DBG] 1 candidate(s) found for the request path '/api/Invoices'
2025-10-13 11:57:18.345 +03:00 [DBG] Endpoint 'BillingSystem.API.Controllers.InvoicesController.Post (BillingSystem.API)' with route pattern 'api/Invoices' is valid for the request path '/api/Invoices'
2025-10-13 11:57:18.348 +03:00 [DBG] Request matched endpoint 'BillingSystem.API.Controllers.InvoicesController.Post (BillingSystem.API)'
2025-10-13 11:57:18.352 +03:00 [DBG] Static files was skipped as the request already matched an endpoint.
2025-10-13 11:57:25.050 +03:00 [DBG] An 'IServiceProvider' was created for internal use by Entity Framework.
2025-10-13 11:57:34.110 +03:00 [INF] Executing endpoint 'BillingSystem.API.Controllers.InvoicesController.Post (BillingSystem.API)'
2025-10-13 11:57:34.137 +03:00 [INF] Route matched with {action = "Post", controller = "Invoices"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Post(BillingSystem.Application.Requests.CreateInvoiceRequest) on controller BillingSystem.API.Controllers.InvoicesController (BillingSystem.API).
2025-10-13 11:57:34.143 +03:00 [DBG] Execution plan of authorization filters (in the following order): ["None"]
2025-10-13 11:57:34.144 +03:00 [DBG] Execution plan of resource filters (in the following order): ["None"]
2025-10-13 11:57:34.146 +03:00 [DBG] Execution plan of action filters (in the following order): ["Microsoft.AspNetCore.Mvc.ModelBinding.UnsupportedContentTypeFilter (Order: -3000)","Microsoft.AspNetCore.Mvc.Infrastructure.ModelStateInvalidFilter (Order: -2000)","BillingSystem.API.ActionFilters.AuditBillingRequestsFilter","BillingSystem.API.ActionFilters.IdempotencyFilter (Order: 0)"]
2025-10-13 11:57:34.149 +03:00 [DBG] Execution plan of exception filters (in the following order): ["None"]
2025-10-13 11:57:34.151 +03:00 [DBG] Execution plan of result filters (in the following order): ["Microsoft.AspNetCore.Mvc.Infrastructure.ClientErrorResultFilter (Order: -2000)","Microsoft.AspNetCore.Mvc.ProducesAttribute (Order: 0)","BillingSystem.API.ActionFilters.IdempotencyFilter (Order: 0)"]
2025-10-13 11:57:34.155 +03:00 [DBG] Executing controller factory for controller BillingSystem.API.Controllers.InvoicesController (BillingSystem.API)
2025-10-13 11:57:34.160 +03:00 [WRN] You do not have a valid license key for the Lucky Penny software MediatR. This is allowed for development and testing scenarios. If you are running in production you are required to have a licensed version. Please visit https://luckypennysoftware.com to obtain a valid license.
2025-10-13 11:57:34.184 +03:00 [DBG] Executed controller factory for controller BillingSystem.API.Controllers.InvoicesController (BillingSystem.API)
2025-10-13 11:57:34.198 +03:00 [DBG] Attempting to bind parameter 'invoiceRequest' of type 'BillingSystem.Application.Requests.CreateInvoiceRequest' ...
2025-10-13 11:57:34.202 +03:00 [DBG] Attempting to bind parameter 'invoiceRequest' of type 'BillingSystem.Application.Requests.CreateInvoiceRequest' using the name '' in request data ...
2025-10-13 11:57:34.204 +03:00 [DBG] Selected input formatter 'Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonInputFormatter' for content type 'application/json'.
2025-10-13 11:57:34.221 +03:00 [DBG] Connection id "0HNGA6PT6H42C", Request id "0HNGA6PT6H42C:00000001": started reading request body.
2025-10-13 11:57:34.223 +03:00 [DBG] Connection id "0HNGA6PT6H42C", Request id "0HNGA6PT6H42C:00000001": done reading request body.
2025-10-13 11:57:34.240 +03:00 [DBG] JSON input formatter succeeded, deserializing to type 'BillingSystem.Application.Requests.CreateInvoiceRequest'
2025-10-13 11:57:34.244 +03:00 [DBG] Done attempting to bind parameter 'invoiceRequest' of type 'BillingSystem.Application.Requests.CreateInvoiceRequest'.
2025-10-13 11:57:34.245 +03:00 [DBG] Done attempting to bind parameter 'invoiceRequest' of type 'BillingSystem.Application.Requests.CreateInvoiceRequest'.
2025-10-13 11:57:34.247 +03:00 [DBG] Attempting to validate the bound parameter 'invoiceRequest' of type 'BillingSystem.Application.Requests.CreateInvoiceRequest' ...
2025-10-13 11:57:34.255 +03:00 [DBG] Done attempting to validate the bound parameter 'invoiceRequest' of type 'BillingSystem.Application.Requests.CreateInvoiceRequest'.
2025-10-13 11:57:55.942 +03:00 [DBG] Entity Framework Core 9.0.9 initialized 'BillingServiceDBContext' using provider 'Microsoft.EntityFrameworkCore.SqlServer:9.0.9' with options: EngineType=SqlServer 
2025-10-13 11:57:56.020 +03:00 [DBG] Compiling query expression: 
'DbSet<Invoice>()
    .AsNoTracking()
    .Any(inv => inv.ExternalId.ToString() == __idempotentKey_0)'
2025-10-13 11:57:56.253 +03:00 [DBG] Generated query execution expression: 
'queryContext => ShapedQueryCompilingExpressionVisitor.SingleAsync<bool>(
    asyncEnumerable: SingleQueryingEnumerable.Create<bool>(
        relationalQueryContext: (RelationalQueryContext)queryContext, 
        relationalCommandResolver: parameters => [LIFTABLE Constant: RelationalCommandCache.QueryExpression(
            Projection Mapping:
                EmptyProjectionMember -> 0
            SELECT EXISTS (
                SELECT 1
                FROM Invoices AS i
                WHERE COALESCE(CONVERT(varchar(36), i.ExternalId), '') == @__idempotentKey_0)) | Resolver: c => new RelationalCommandCache(
            c.Dependencies.MemoryCache, 
            c.RelationalDependencies.QuerySqlGeneratorFactory, 
            c.RelationalDependencies.RelationalParameterBasedSqlProcessorFactory, 
            Projection Mapping:
                EmptyProjectionMember -> 0
            SELECT EXISTS (
                SELECT 1
                FROM Invoices AS i
                WHERE COALESCE(CONVERT(varchar(36), i.ExternalId), '') == @__idempotentKey_0), 
            False, 
            new HashSet<string>(
                new string[]{ }, 
                StringComparer.Ordinal
            )
        )].GetRelationalCommandTemplate(parameters), 
        readerColumns: null, 
        shaper: (queryContext, dataReader, resultContext, resultCoordinator) => 
        {
            bool? value1;
            value1 = dataReader.IsDBNull(0) ? default(bool?) : (bool?)dataReader.GetBoolean(0);
            return (bool)value1;
        }, 
        contextType: BillingSystem.Infrastructure.EF.BillingServiceDBContext, 
        standAloneStateManager: False, 
        detailedErrorsEnabled: False, 
        threadSafetyChecksEnabled: True), 
    cancellationToken: queryContext.CancellationToken)'
2025-10-13 11:57:56.299 +03:00 [DBG] Creating DbConnection.
2025-10-13 11:57:56.317 +03:00 [DBG] Created DbConnection. (16ms).
2025-10-13 11:57:56.321 +03:00 [DBG] Opening connection to database 'GAC-BillingService' on server '.'.
2025-10-13 11:57:56.553 +03:00 [DBG] Opened connection to database 'GAC-BillingService' on server '.'.
2025-10-13 11:57:56.558 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-10-13 11:57:56.564 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (4ms).
2025-10-13 11:57:56.572 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (14ms).
2025-10-13 11:57:56.582 +03:00 [DBG] Executing DbCommand [Parameters=[@__idempotentKey_0='?' (Size = 36) (DbType = AnsiString)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [Invoices] AS [i]
        WHERE CONVERT(varchar(36), [i].[ExternalId]) = @__idempotentKey_0) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2025-10-13 11:57:56.631 +03:00 [INF] Executed DbCommand (50ms) [Parameters=[@__idempotentKey_0='?' (Size = 36) (DbType = AnsiString)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [Invoices] AS [i]
        WHERE CONVERT(varchar(36), [i].[ExternalId]) = @__idempotentKey_0) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2025-10-13 11:57:56.648 +03:00 [DBG] Closing data reader to 'GAC-BillingService' on server '.'.
2025-10-13 11:57:56.658 +03:00 [DBG] A data reader for 'GAC-BillingService' on server '.' is being disposed after spending 18ms reading results.
2025-10-13 11:57:56.663 +03:00 [DBG] Closing connection to database 'GAC-BillingService' on server '.'.
2025-10-13 11:57:56.670 +03:00 [DBG] Closed connection to database 'GAC-BillingService' on server '.' (7ms).
2025-10-13 11:57:58.894 +03:00 [WRN] You do not have a valid license key for the Lucky Penny software AutoMapper. This is allowed for development and testing scenarios. If you are running in production you are required to have a licensed version. Please visit https://luckypennysoftware.com to obtain a valid license.
2025-10-13 11:57:59.588 +03:00 [DBG] Opening connection to database 'GAC-BillingService' on server '.'.
2025-10-13 11:57:59.593 +03:00 [DBG] Opened connection to database 'GAC-BillingService' on server '.'.
2025-10-13 11:57:59.597 +03:00 [DBG] Beginning transaction with isolation level 'Unspecified'.
2025-10-13 11:57:59.608 +03:00 [DBG] Began transaction with isolation level 'ReadCommitted'.
2025-10-13 11:58:01.580 +03:00 [DBG] 'BillingServiceDBContext' generated a temporary value for the property 'Invoice.Id'. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-10-13 11:58:01.661 +03:00 [DBG] Context 'BillingServiceDBContext' started tracking 'Invoice' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-10-13 11:58:03.172 +03:00 [DBG] SaveChanges starting for 'BillingServiceDBContext'.
2025-10-13 11:58:03.176 +03:00 [DBG] DetectChanges starting for 'BillingServiceDBContext'.
2025-10-13 11:58:03.200 +03:00 [DBG] DetectChanges completed for 'BillingServiceDBContext'.
2025-10-13 11:58:03.270 +03:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-10-13 11:58:03.275 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-10-13 11:58:03.276 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2025-10-13 11:58:03.279 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (4ms).
2025-10-13 11:58:03.281 +03:00 [DBG] Executing DbCommand [Parameters=[@p0='?' (Precision = 18) (DbType = Decimal), @p1='?' (Size = 50), @p2='?' (DbType = DateTime), @p3='?' (Size = 50), @p4='?' (DbType = DateTime), @p5='?' (DbType = Guid), @p6='?' (DbType = Int32), @p7='?' (DbType = Int32), @p8='?' (DbType = Boolean), @p9='?' (DbType = DateTime), @p10='?' (DbType = DateTime), @p11='?' (Size = 100), @p12='?' (Size = 100), @p13='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [Invoices] ([Amount], [CreatedBy], [CreatedDate], [Currency], [DueAt], [ExternalId], [InvoiceStatus], [InvoiceType], [IsDeleted], [IssuedAt], [LastUpdatedDate], [PaymentProvider], [PaymentReference], [TenantId])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13);
2025-10-13 11:58:03.296 +03:00 [INF] Executed DbCommand (16ms) [Parameters=[@p0='?' (Precision = 18) (DbType = Decimal), @p1='?' (Size = 50), @p2='?' (DbType = DateTime), @p3='?' (Size = 50), @p4='?' (DbType = DateTime), @p5='?' (DbType = Guid), @p6='?' (DbType = Int32), @p7='?' (DbType = Int32), @p8='?' (DbType = Boolean), @p9='?' (DbType = DateTime), @p10='?' (DbType = DateTime), @p11='?' (Size = 100), @p12='?' (Size = 100), @p13='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [Invoices] ([Amount], [CreatedBy], [CreatedDate], [Currency], [DueAt], [ExternalId], [InvoiceStatus], [InvoiceType], [IsDeleted], [IssuedAt], [LastUpdatedDate], [PaymentProvider], [PaymentReference], [TenantId])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13);
2025-10-13 11:58:03.325 +03:00 [DBG] Closing data reader to 'GAC-BillingService' on server '.'.
2025-10-13 11:58:03.328 +03:00 [DBG] A data reader for 'GAC-BillingService' on server '.' is being disposed after spending 12ms reading results.
2025-10-13 11:58:03.341 +03:00 [ERR] An exception occurred in the database while saving changes for context type 'BillingSystem.Infrastructure.EF.BillingServiceDBContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The INSERT statement conflicted with the FOREIGN KEY constraint "FK_Invoices_Tenants". The conflict occurred in database "GAC-BillingService", table "dbo.Tenants", column 'Id'.
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:896da34f-0cd2-4ddb-a498-03b2b84605ab
Error Number:547,State:0,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalDatabase.SaveChangesAsync(IList`1 entries, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The INSERT statement conflicted with the FOREIGN KEY constraint "FK_Invoices_Tenants". The conflict occurred in database "GAC-BillingService", table "dbo.Tenants", column 'Id'.
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:896da34f-0cd2-4ddb-a498-03b2b84605ab
Error Number:547,State:0,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalDatabase.SaveChangesAsync(IList`1 entries, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2025-10-13 12:05:24.534 +03:00 [ERR] exception occured An error occurred while saving the entity changes. See the inner exception for details. , stackTrace    at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalDatabase.SaveChangesAsync(IList`1 entries, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at BillingSystem.Infrastructure.Persistence.EF.InvoiceRepository.Insert(Invoice entity) in C:\Repositories\Gac-BillingSystem\src\BillingSystem.Infrastructure\Persistence\EF\InvoiceRepository.cs:line 61
2025-10-13 12:05:24.552 +03:00 [DBG] Disconnect: guest@localhost:5672/
2025-10-13 12:05:24.554 +03:00 [ERR] exception inner exception The INSERT statement conflicted with the FOREIGN KEY constraint "FK_Invoices_Tenants". The conflict occurred in database "GAC-BillingService", table "dbo.Tenants", column 'Id'. , stackTrace    at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
2025-10-13 12:05:24.576 +03:00 [DBG] Rolling back transaction.
2025-10-13 12:05:24.583 +03:00 [DBG] Rolled back transaction.
2025-10-13 12:05:24.585 +03:00 [DBG] Closing connection to database 'GAC-BillingService' on server '.'.
2025-10-13 12:05:24.587 +03:00 [DBG] Disconnected: guest@localhost:5672/
2025-10-13 12:05:24.587 +03:00 [DBG] Closed connection to database 'GAC-BillingService' on server '.' (1ms).
2025-10-13 12:05:24.615 +03:00 [DBG] Disposing transaction.
2025-10-13 12:05:24.681 +03:00 [ERR] exception occured An error occurred while saving the entity changes. See the inner exception for details. , stackTrace    at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalDatabase.SaveChangesAsync(IList`1 entries, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at BillingSystem.Infrastructure.Persistence.EF.InvoiceRepository.Insert(Invoice entity) in C:\Repositories\Gac-BillingSystem\src\BillingSystem.Infrastructure\Persistence\EF\InvoiceRepository.cs:line 61
   at BillingSystem.Application.Commands.CreateInvoiceCommandRequestHandler.Handle(CreateInvoiceRequest request, CancellationToken cancellationToken) in C:\Repositories\Gac-BillingSystem\src\BillingSystem.Application\Commands\CreateInvoiceCommandRequestHandler.cs:line 32
   at BillingSystem.API.Controllers.InvoicesController.Post(CreateInvoiceRequest invoiceRequest) in C:\Repositories\Gac-BillingSystem\src\BillingSystem.API\Controllers\InvoicesController.cs:line 45
2025-10-13 12:05:24.686 +03:00 [ERR] exception inner exception The INSERT statement conflicted with the FOREIGN KEY constraint "FK_Invoices_Tenants". The conflict occurred in database "GAC-BillingService", table "dbo.Tenants", column 'Id'. , stackTrace    at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
2025-10-13 12:05:24.812 +03:00 [DBG] List of registered output formatters, in the following order: ["Microsoft.AspNetCore.Mvc.Formatters.HttpNoContentOutputFormatter","Microsoft.AspNetCore.Mvc.Formatters.StringOutputFormatter","Microsoft.AspNetCore.Mvc.Formatters.StreamOutputFormatter","Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonOutputFormatter"]
2025-10-13 12:05:24.817 +03:00 [DBG] No information found on request to perform content negotiation.
2025-10-13 12:05:24.819 +03:00 [DBG] Attempting to select the first output formatter in the output formatters list which supports a content type from the explicitly specified content types '["application/json","application/problem+json","application/problem+xml"]'.
2025-10-13 12:05:24.822 +03:00 [DBG] Selected output formatter 'Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonOutputFormatter' and content type 'application/json' to write the response.
2025-10-13 12:05:24.824 +03:00 [INF] Executing ObjectResult, writing value of type 'Microsoft.AspNetCore.Mvc.ProblemDetails'.
2025-10-13 12:05:24.847 +03:00 [INF] Executed action BillingSystem.API.Controllers.InvoicesController.Post (BillingSystem.API) in 470679.89ms
2025-10-13 12:05:24.852 +03:00 [INF] Executed endpoint 'BillingSystem.API.Controllers.InvoicesController.Post (BillingSystem.API)'
2025-10-13 12:05:24.855 +03:00 [ERR] HTTP POST /api/Invoices responded 500 in 486491.9776 ms
2025-10-13 12:05:24.860 +03:00 [DBG] Connection id "0HNGA6PT6H42C" completed keep alive response.
2025-10-13 12:05:24.863 +03:00 [DBG] 'BillingServiceDBContext' disposed.
2025-10-13 12:05:24.868 +03:00 [DBG] Disposing connection to database 'GAC-BillingService' on server '.'.
2025-10-13 12:05:24.870 +03:00 [DBG] Disposed connection to database '' on server '' (2ms).
2025-10-13 12:05:24.872 +03:00 [INF] Request finished HTTP/1.1 POST https://localhost:7257/api/Invoices - 500 null application/json; charset=utf-8 486526.1864ms
2025-10-13 12:05:25.407 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7257/swagger/index.html - null null
2025-10-13 12:05:25.420 +03:00 [DBG] No candidates found for the request path '/swagger/index.html'
2025-10-13 12:05:25.422 +03:00 [DBG] Request did not match any endpoints
2025-10-13 12:05:25.423 +03:00 [DBG] Response markup is scheduled to include Browser Link script injection.
2025-10-13 12:05:25.424 +03:00 [DBG] Response markup is scheduled to include browser refresh script injection.
2025-10-13 12:05:25.431 +03:00 [INF] HTTP GET /swagger/index.html responded 200 in 7.9705 ms
2025-10-13 12:05:25.433 +03:00 [DBG] Response markup was updated to include Browser Link script injection.
2025-10-13 12:05:25.435 +03:00 [DBG] Response markup was updated to include browser refresh script injection.
2025-10-13 12:05:25.437 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7257/swagger/index.html - 200 null text/html;charset=utf-8 30.0577ms
2025-10-13 12:05:25.452 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7257/_framework/aspnetcore-browser-refresh.js - null null
2025-10-13 12:05:25.452 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7257/_vs/browserLink - null null
2025-10-13 12:05:25.458 +03:00 [DBG] Script injected: /_framework/aspnetcore-browser-refresh.js
2025-10-13 12:05:25.462 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7257/_framework/aspnetcore-browser-refresh.js - 200 16519 application/javascript; charset=utf-8 10.5606ms
2025-10-13 12:05:25.488 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7257/_vs/browserLink - 200 null text/javascript; charset=UTF-8 37.1165ms
2025-10-13 12:05:25.726 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7257/swagger/v1/swagger.json - null null
2025-10-13 12:05:25.730 +03:00 [DBG] No candidates found for the request path '/swagger/v1/swagger.json'
2025-10-13 12:05:25.731 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7257/swagger/favicon-32x32.png - null null
2025-10-13 12:05:25.732 +03:00 [DBG] Request did not match any endpoints
2025-10-13 12:05:25.735 +03:00 [DBG] No candidates found for the request path '/swagger/favicon-32x32.png'
2025-10-13 12:05:25.738 +03:00 [DBG] Request did not match any endpoints
2025-10-13 12:05:25.740 +03:00 [INF] HTTP GET /swagger/v1/swagger.json responded 200 in 4.3077 ms
2025-10-13 12:05:25.743 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7257/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 17.5082ms
2025-10-13 12:05:25.747 +03:00 [INF] Sending file. Request path: '/favicon-32x32.png'. Physical path: 'N/A'
2025-10-13 12:05:25.748 +03:00 [INF] HTTP GET /swagger/favicon-32x32.png responded 200 in 8.5385 ms
2025-10-13 12:05:25.753 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7257/swagger/favicon-32x32.png - 200 628 image/png 21.743ms
2025-10-13 12:05:48.392 +03:00 [DBG] Connection id "0HNGA6PT6H42D" received FIN.
2025-10-13 12:05:48.392 +03:00 [DBG] Connection id "0HNGA6PT6H42D" accepted.
2025-10-13 12:05:48.394 +03:00 [DBG] Connection id "0HNGA6PT6H42D" started.
2025-10-13 12:05:48.395 +03:00 [DBG] Connection id "0HNGA6PT6H42E" accepted.
2025-10-13 12:05:48.397 +03:00 [DBG] Failed to authenticate HTTPS connection.
System.IO.IOException: Received an unexpected EOF or 0 bytes from the transport stream.
   at System.Net.Security.SslStream.ReceiveHandshakeFrameAsync[TIOAdapter](CancellationToken cancellationToken)
   at System.Net.Security.SslStream.ForceAuthenticationAsync[TIOAdapter](Boolean receiveFirst, Byte[] reAuthenticationData, CancellationToken cancellationToken)
   at System.Net.Security.SslStream.ProcessAuthenticationWithTelemetryAsync(Boolean isAsync, CancellationToken cancellationToken)
   at Microsoft.AspNetCore.Server.Kestrel.Https.Internal.HttpsConnectionMiddleware.OnConnectionAsync(ConnectionContext context)
2025-10-13 12:05:48.397 +03:00 [DBG] Connection id "0HNGA6PT6H42E" started.
2025-10-13 12:05:48.402 +03:00 [DBG] Connection id "0HNGA6PT6H42D" stopped.
2025-10-13 12:05:48.405 +03:00 [DBG] Connection id "0HNGA6PT6H42D" sending FIN because: "The Socket transport's send loop completed gracefully."
2025-10-13 12:05:48.408 +03:00 [DBG] Connection 0HNGA6PT6H42E established using the following protocol: "Tls12"
2025-10-13 12:05:48.409 +03:00 [INF] Request starting HTTP/1.1 POST https://localhost:7257/api/Invoices - application/json 261
2025-10-13 12:05:48.412 +03:00 [DBG] 1 candidate(s) found for the request path '/api/Invoices'
2025-10-13 12:05:48.413 +03:00 [DBG] Endpoint 'BillingSystem.API.Controllers.InvoicesController.Post (BillingSystem.API)' with route pattern 'api/Invoices' is valid for the request path '/api/Invoices'
2025-10-13 12:05:48.415 +03:00 [DBG] Request matched endpoint 'BillingSystem.API.Controllers.InvoicesController.Post (BillingSystem.API)'
2025-10-13 12:05:48.416 +03:00 [DBG] Static files was skipped as the request already matched an endpoint.
2025-10-13 12:05:59.314 +03:00 [INF] Executing endpoint 'BillingSystem.API.Controllers.InvoicesController.Post (BillingSystem.API)'
2025-10-13 12:05:59.325 +03:00 [INF] Route matched with {action = "Post", controller = "Invoices"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Post(BillingSystem.Application.Requests.CreateInvoiceRequest) on controller BillingSystem.API.Controllers.InvoicesController (BillingSystem.API).
2025-10-13 12:05:59.329 +03:00 [DBG] Execution plan of authorization filters (in the following order): ["None"]
2025-10-13 12:05:59.333 +03:00 [DBG] Execution plan of resource filters (in the following order): ["None"]
2025-10-13 12:05:59.337 +03:00 [DBG] Execution plan of action filters (in the following order): ["Microsoft.AspNetCore.Mvc.ModelBinding.UnsupportedContentTypeFilter (Order: -3000)","Microsoft.AspNetCore.Mvc.Infrastructure.ModelStateInvalidFilter (Order: -2000)","BillingSystem.API.ActionFilters.AuditBillingRequestsFilter","BillingSystem.API.ActionFilters.IdempotencyFilter (Order: 0)"]
2025-10-13 12:05:59.343 +03:00 [DBG] Execution plan of exception filters (in the following order): ["None"]
2025-10-13 12:05:59.347 +03:00 [DBG] Execution plan of result filters (in the following order): ["Microsoft.AspNetCore.Mvc.Infrastructure.ClientErrorResultFilter (Order: -2000)","Microsoft.AspNetCore.Mvc.ProducesAttribute (Order: 0)","BillingSystem.API.ActionFilters.IdempotencyFilter (Order: 0)"]
2025-10-13 12:05:59.352 +03:00 [DBG] Executing controller factory for controller BillingSystem.API.Controllers.InvoicesController (BillingSystem.API)
2025-10-13 12:05:59.360 +03:00 [DBG] Executed controller factory for controller BillingSystem.API.Controllers.InvoicesController (BillingSystem.API)
2025-10-13 12:05:59.366 +03:00 [DBG] Attempting to bind parameter 'invoiceRequest' of type 'BillingSystem.Application.Requests.CreateInvoiceRequest' ...
2025-10-13 12:05:59.370 +03:00 [DBG] Attempting to bind parameter 'invoiceRequest' of type 'BillingSystem.Application.Requests.CreateInvoiceRequest' using the name '' in request data ...
2025-10-13 12:05:59.373 +03:00 [DBG] Selected input formatter 'Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonInputFormatter' for content type 'application/json'.
2025-10-13 12:05:59.378 +03:00 [DBG] Connection id "0HNGA6PT6H42E", Request id "0HNGA6PT6H42E:00000001": started reading request body.
2025-10-13 12:05:59.380 +03:00 [DBG] Connection id "0HNGA6PT6H42E", Request id "0HNGA6PT6H42E:00000001": done reading request body.
2025-10-13 12:05:59.384 +03:00 [DBG] JSON input formatter succeeded, deserializing to type 'BillingSystem.Application.Requests.CreateInvoiceRequest'
2025-10-13 12:05:59.392 +03:00 [DBG] Done attempting to bind parameter 'invoiceRequest' of type 'BillingSystem.Application.Requests.CreateInvoiceRequest'.
2025-10-13 12:05:59.397 +03:00 [DBG] Done attempting to bind parameter 'invoiceRequest' of type 'BillingSystem.Application.Requests.CreateInvoiceRequest'.
2025-10-13 12:05:59.400 +03:00 [DBG] Attempting to validate the bound parameter 'invoiceRequest' of type 'BillingSystem.Application.Requests.CreateInvoiceRequest' ...
2025-10-13 12:05:59.404 +03:00 [DBG] Done attempting to validate the bound parameter 'invoiceRequest' of type 'BillingSystem.Application.Requests.CreateInvoiceRequest'.
2025-10-13 12:06:07.273 +03:00 [DBG] Entity Framework Core 9.0.9 initialized 'BillingServiceDBContext' using provider 'Microsoft.EntityFrameworkCore.SqlServer:9.0.9' with options: EngineType=SqlServer 
2025-10-13 12:06:07.279 +03:00 [DBG] Creating DbConnection.
2025-10-13 12:06:07.280 +03:00 [DBG] Created DbConnection. (1ms).
2025-10-13 12:06:07.281 +03:00 [DBG] Opening connection to database 'GAC-BillingService' on server '.'.
2025-10-13 12:06:07.282 +03:00 [DBG] Opened connection to database 'GAC-BillingService' on server '.'.
2025-10-13 12:06:07.284 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-10-13 12:06:07.285 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (1ms).
2025-10-13 12:06:07.286 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (2ms).
2025-10-13 12:06:07.288 +03:00 [DBG] Executing DbCommand [Parameters=[@__idempotentKey_0='?' (Size = 36) (DbType = AnsiString)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [Invoices] AS [i]
        WHERE CONVERT(varchar(36), [i].[ExternalId]) = @__idempotentKey_0) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2025-10-13 12:06:07.292 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[@__idempotentKey_0='?' (Size = 36) (DbType = AnsiString)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [Invoices] AS [i]
        WHERE CONVERT(varchar(36), [i].[ExternalId]) = @__idempotentKey_0) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2025-10-13 12:06:07.295 +03:00 [DBG] Closing data reader to 'GAC-BillingService' on server '.'.
2025-10-13 12:06:07.296 +03:00 [DBG] A data reader for 'GAC-BillingService' on server '.' is being disposed after spending 1ms reading results.
2025-10-13 12:06:07.298 +03:00 [DBG] Closing connection to database 'GAC-BillingService' on server '.'.
2025-10-13 12:06:07.299 +03:00 [DBG] Closed connection to database 'GAC-BillingService' on server '.' (1ms).
2025-10-13 12:06:09.351 +03:00 [DBG] Opening connection to database 'GAC-BillingService' on server '.'.
2025-10-13 12:06:09.352 +03:00 [DBG] Opened connection to database 'GAC-BillingService' on server '.'.
2025-10-13 12:06:09.353 +03:00 [DBG] Beginning transaction with isolation level 'Unspecified'.
2025-10-13 12:06:09.356 +03:00 [DBG] Began transaction with isolation level 'ReadCommitted'.
2025-10-13 12:06:11.634 +03:00 [DBG] 'BillingServiceDBContext' generated a temporary value for the property 'Invoice.Id'. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-10-13 12:06:11.637 +03:00 [DBG] Context 'BillingServiceDBContext' started tracking 'Invoice' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-10-13 12:06:12.238 +03:00 [DBG] SaveChanges starting for 'BillingServiceDBContext'.
2025-10-13 12:06:12.240 +03:00 [DBG] DetectChanges starting for 'BillingServiceDBContext'.
2025-10-13 12:06:12.241 +03:00 [DBG] DetectChanges completed for 'BillingServiceDBContext'.
2025-10-13 12:06:12.243 +03:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-10-13 12:06:12.245 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-10-13 12:06:12.246 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2025-10-13 12:06:12.247 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (2ms).
2025-10-13 12:06:12.248 +03:00 [DBG] Executing DbCommand [Parameters=[@p0='?' (Precision = 18) (DbType = Decimal), @p1='?' (Size = 50), @p2='?' (DbType = DateTime), @p3='?' (Size = 50), @p4='?' (DbType = DateTime), @p5='?' (DbType = Guid), @p6='?' (DbType = Int32), @p7='?' (DbType = Int32), @p8='?' (DbType = Boolean), @p9='?' (DbType = DateTime), @p10='?' (DbType = DateTime), @p11='?' (Size = 100), @p12='?' (Size = 100), @p13='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [Invoices] ([Amount], [CreatedBy], [CreatedDate], [Currency], [DueAt], [ExternalId], [InvoiceStatus], [InvoiceType], [IsDeleted], [IssuedAt], [LastUpdatedDate], [PaymentProvider], [PaymentReference], [TenantId])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13);
2025-10-13 12:06:12.255 +03:00 [INF] Executed DbCommand (6ms) [Parameters=[@p0='?' (Precision = 18) (DbType = Decimal), @p1='?' (Size = 50), @p2='?' (DbType = DateTime), @p3='?' (Size = 50), @p4='?' (DbType = DateTime), @p5='?' (DbType = Guid), @p6='?' (DbType = Int32), @p7='?' (DbType = Int32), @p8='?' (DbType = Boolean), @p9='?' (DbType = DateTime), @p10='?' (DbType = DateTime), @p11='?' (Size = 100), @p12='?' (Size = 100), @p13='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [Invoices] ([Amount], [CreatedBy], [CreatedDate], [Currency], [DueAt], [ExternalId], [InvoiceStatus], [InvoiceType], [IsDeleted], [IssuedAt], [LastUpdatedDate], [PaymentProvider], [PaymentReference], [TenantId])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13);
2025-10-13 12:06:12.280 +03:00 [DBG] The foreign key property 'Invoice.Id' was detected as changed. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see property values.
2025-10-13 12:06:12.287 +03:00 [DBG] Closing data reader to 'GAC-BillingService' on server '.'.
2025-10-13 12:06:12.289 +03:00 [DBG] A data reader for 'GAC-BillingService' on server '.' is being disposed after spending 15ms reading results.
2025-10-13 12:06:12.300 +03:00 [DBG] An entity of type 'Invoice' tracked by 'BillingServiceDBContext' changed state from '"Added"' to '"Unchanged"'. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-10-13 12:06:12.305 +03:00 [DBG] SaveChanges completed for 'BillingServiceDBContext' with 1 entities written to the database.
2025-10-13 12:06:27.588 +03:00 [DBG] 'BillingServiceDBContext' generated a temporary value for the property 'OutboxEvent.Id'. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-10-13 12:06:27.602 +03:00 [DBG] Context 'BillingServiceDBContext' started tracking 'OutboxEvent' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-10-13 12:06:28.626 +03:00 [DBG] SaveChanges starting for 'BillingServiceDBContext'.
2025-10-13 12:06:28.628 +03:00 [DBG] DetectChanges starting for 'BillingServiceDBContext'.
2025-10-13 12:06:28.635 +03:00 [DBG] DetectChanges completed for 'BillingServiceDBContext'.
2025-10-13 12:06:28.637 +03:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-10-13 12:06:28.638 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-10-13 12:06:28.639 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (1ms).
2025-10-13 12:06:28.640 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (2ms).
2025-10-13 12:06:28.641 +03:00 [DBG] Executing DbCommand [Parameters=[@p0='?' (DbType = Int64), @p1='?' (DbType = DateTime), @p2='?' (Size = 300), @p3='?' (Size = 4000), @p4='?' (DbType = Boolean)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [Outbox_events] ([Aggregate_id], [CreatedDate], [Event_type], [Payload], [Processed])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4);
2025-10-13 12:06:28.647 +03:00 [INF] Executed DbCommand (5ms) [Parameters=[@p0='?' (DbType = Int64), @p1='?' (DbType = DateTime), @p2='?' (Size = 300), @p3='?' (Size = 4000), @p4='?' (DbType = Boolean)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [Outbox_events] ([Aggregate_id], [CreatedDate], [Event_type], [Payload], [Processed])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4);
2025-10-13 12:06:28.663 +03:00 [DBG] The foreign key property 'OutboxEvent.Id' was detected as changed. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see property values.
2025-10-13 12:06:28.664 +03:00 [DBG] Closing data reader to 'GAC-BillingService' on server '.'.
2025-10-13 12:06:28.666 +03:00 [DBG] A data reader for 'GAC-BillingService' on server '.' is being disposed after spending 4ms reading results.
2025-10-13 12:06:28.668 +03:00 [DBG] An entity of type 'OutboxEvent' tracked by 'BillingServiceDBContext' changed state from '"Added"' to '"Unchanged"'. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-10-13 12:06:28.670 +03:00 [DBG] SaveChanges completed for 'BillingServiceDBContext' with 1 entities written to the database.
2025-10-13 12:06:29.489 +03:00 [DBG] Committing transaction.
2025-10-13 12:06:29.515 +03:00 [DBG] Committed transaction.
2025-10-13 12:06:29.517 +03:00 [DBG] Closing connection to database 'GAC-BillingService' on server '.'.
2025-10-13 12:06:29.519 +03:00 [DBG] Closed connection to database 'GAC-BillingService' on server '.' (1ms).
2025-10-13 12:06:30.370 +03:00 [DBG] Disposing transaction.
2025-10-13 12:06:33.756 +03:00 [DBG] List of registered output formatters, in the following order: ["Microsoft.AspNetCore.Mvc.Formatters.HttpNoContentOutputFormatter","Microsoft.AspNetCore.Mvc.Formatters.StringOutputFormatter","Microsoft.AspNetCore.Mvc.Formatters.StreamOutputFormatter","Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonOutputFormatter"]
2025-10-13 12:06:33.759 +03:00 [DBG] No information found on request to perform content negotiation.
2025-10-13 12:06:33.759 +03:00 [DBG] Attempting to select the first output formatter in the output formatters list which supports a content type from the explicitly specified content types '["application/json"]'.
2025-10-13 12:06:33.761 +03:00 [DBG] Selected output formatter 'Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonOutputFormatter' and content type 'application/json' to write the response.
2025-10-13 12:06:33.763 +03:00 [INF] Executing OkObjectResult, writing value of type 'BillingSystem.SharedKernel.ApiResponse`1[[System.Int64, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-10-13 12:06:33.772 +03:00 [INF] Executed action BillingSystem.API.Controllers.InvoicesController.Post (BillingSystem.API) in 34419.1465ms
2025-10-13 12:06:33.774 +03:00 [INF] Executed endpoint 'BillingSystem.API.Controllers.InvoicesController.Post (BillingSystem.API)'
2025-10-13 12:06:33.776 +03:00 [INF] HTTP POST /api/Invoices responded 200 in 45358.2873 ms
2025-10-13 12:06:33.778 +03:00 [DBG] Connection id "0HNGA6PT6H42E" completed keep alive response.
2025-10-13 12:06:33.779 +03:00 [DBG] 'BillingServiceDBContext' disposed.
2025-10-13 12:06:33.780 +03:00 [DBG] Disposing connection to database 'GAC-BillingService' on server '.'.
2025-10-13 12:06:33.782 +03:00 [DBG] Disposed connection to database '' on server '' (1ms).
2025-10-13 12:06:33.784 +03:00 [INF] Request finished HTTP/1.1 POST https://localhost:7257/api/Invoices - 200 null application/json; charset=utf-8 45373.3582ms
2025-10-13 12:08:54.779 +03:00 [DBG] Connection id "0HNGA6PT6H42F" accepted.
2025-10-13 12:08:54.780 +03:00 [DBG] Connection id "0HNGA6PT6H42F" received FIN.
2025-10-13 12:08:54.781 +03:00 [DBG] Connection id "0HNGA6PT6H42F" started.
2025-10-13 12:08:54.782 +03:00 [DBG] Connection id "0HNGA6PT6H42G" accepted.
2025-10-13 12:08:54.785 +03:00 [DBG] Failed to authenticate HTTPS connection.
System.IO.IOException: Received an unexpected EOF or 0 bytes from the transport stream.
   at System.Net.Security.SslStream.ReceiveHandshakeFrameAsync[TIOAdapter](CancellationToken cancellationToken)
   at System.Net.Security.SslStream.ForceAuthenticationAsync[TIOAdapter](Boolean receiveFirst, Byte[] reAuthenticationData, CancellationToken cancellationToken)
   at System.Net.Security.SslStream.ProcessAuthenticationWithTelemetryAsync(Boolean isAsync, CancellationToken cancellationToken)
   at Microsoft.AspNetCore.Server.Kestrel.Https.Internal.HttpsConnectionMiddleware.OnConnectionAsync(ConnectionContext context)
2025-10-13 12:08:54.785 +03:00 [DBG] Connection id "0HNGA6PT6H42G" started.
2025-10-13 12:08:54.788 +03:00 [DBG] Connection id "0HNGA6PT6H42F" stopped.
2025-10-13 12:08:54.791 +03:00 [DBG] Connection id "0HNGA6PT6H42F" sending FIN because: "The Socket transport's send loop completed gracefully."
2025-10-13 12:08:54.793 +03:00 [DBG] Connection 0HNGA6PT6H42G established using the following protocol: "Tls12"
2025-10-13 12:08:54.795 +03:00 [INF] Request starting HTTP/1.1 POST https://localhost:7257/api/Invoices - application/json 261
2025-10-13 12:08:54.798 +03:00 [DBG] 1 candidate(s) found for the request path '/api/Invoices'
2025-10-13 12:08:54.799 +03:00 [DBG] Endpoint 'BillingSystem.API.Controllers.InvoicesController.Post (BillingSystem.API)' with route pattern 'api/Invoices' is valid for the request path '/api/Invoices'
2025-10-13 12:08:54.801 +03:00 [DBG] Request matched endpoint 'BillingSystem.API.Controllers.InvoicesController.Post (BillingSystem.API)'
2025-10-13 12:08:54.802 +03:00 [DBG] Static files was skipped as the request already matched an endpoint.
2025-10-13 12:08:57.542 +03:00 [INF] Executing endpoint 'BillingSystem.API.Controllers.InvoicesController.Post (BillingSystem.API)'
2025-10-13 12:08:57.546 +03:00 [INF] Route matched with {action = "Post", controller = "Invoices"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Post(BillingSystem.Application.Requests.CreateInvoiceRequest) on controller BillingSystem.API.Controllers.InvoicesController (BillingSystem.API).
2025-10-13 12:08:57.549 +03:00 [DBG] Execution plan of authorization filters (in the following order): ["None"]
2025-10-13 12:08:57.550 +03:00 [DBG] Execution plan of resource filters (in the following order): ["None"]
2025-10-13 12:08:57.552 +03:00 [DBG] Execution plan of action filters (in the following order): ["Microsoft.AspNetCore.Mvc.ModelBinding.UnsupportedContentTypeFilter (Order: -3000)","Microsoft.AspNetCore.Mvc.Infrastructure.ModelStateInvalidFilter (Order: -2000)","BillingSystem.API.ActionFilters.AuditBillingRequestsFilter","BillingSystem.API.ActionFilters.IdempotencyFilter (Order: 0)"]
2025-10-13 12:08:57.558 +03:00 [DBG] Execution plan of exception filters (in the following order): ["None"]
2025-10-13 12:08:57.559 +03:00 [DBG] Execution plan of result filters (in the following order): ["Microsoft.AspNetCore.Mvc.Infrastructure.ClientErrorResultFilter (Order: -2000)","Microsoft.AspNetCore.Mvc.ProducesAttribute (Order: 0)","BillingSystem.API.ActionFilters.IdempotencyFilter (Order: 0)"]
2025-10-13 12:08:57.562 +03:00 [DBG] Executing controller factory for controller BillingSystem.API.Controllers.InvoicesController (BillingSystem.API)
2025-10-13 12:08:57.565 +03:00 [DBG] Executed controller factory for controller BillingSystem.API.Controllers.InvoicesController (BillingSystem.API)
2025-10-13 12:08:57.566 +03:00 [DBG] Attempting to bind parameter 'invoiceRequest' of type 'BillingSystem.Application.Requests.CreateInvoiceRequest' ...
2025-10-13 12:08:57.568 +03:00 [DBG] Attempting to bind parameter 'invoiceRequest' of type 'BillingSystem.Application.Requests.CreateInvoiceRequest' using the name '' in request data ...
2025-10-13 12:08:57.570 +03:00 [DBG] Selected input formatter 'Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonInputFormatter' for content type 'application/json'.
2025-10-13 12:08:57.573 +03:00 [DBG] Connection id "0HNGA6PT6H42G", Request id "0HNGA6PT6H42G:00000001": started reading request body.
2025-10-13 12:08:57.574 +03:00 [DBG] Connection id "0HNGA6PT6H42G", Request id "0HNGA6PT6H42G:00000001": done reading request body.
2025-10-13 12:08:57.576 +03:00 [DBG] JSON input formatter succeeded, deserializing to type 'BillingSystem.Application.Requests.CreateInvoiceRequest'
2025-10-13 12:08:57.577 +03:00 [DBG] Done attempting to bind parameter 'invoiceRequest' of type 'BillingSystem.Application.Requests.CreateInvoiceRequest'.
2025-10-13 12:08:57.578 +03:00 [DBG] Done attempting to bind parameter 'invoiceRequest' of type 'BillingSystem.Application.Requests.CreateInvoiceRequest'.
2025-10-13 12:08:57.580 +03:00 [DBG] Attempting to validate the bound parameter 'invoiceRequest' of type 'BillingSystem.Application.Requests.CreateInvoiceRequest' ...
2025-10-13 12:08:57.581 +03:00 [DBG] Done attempting to validate the bound parameter 'invoiceRequest' of type 'BillingSystem.Application.Requests.CreateInvoiceRequest'.
2025-10-13 12:08:59.970 +03:00 [DBG] Entity Framework Core 9.0.9 initialized 'BillingServiceDBContext' using provider 'Microsoft.EntityFrameworkCore.SqlServer:9.0.9' with options: EngineType=SqlServer 
2025-10-13 12:08:59.975 +03:00 [DBG] Creating DbConnection.
2025-10-13 12:08:59.977 +03:00 [DBG] Created DbConnection. (1ms).
2025-10-13 12:08:59.979 +03:00 [DBG] Opening connection to database 'GAC-BillingService' on server '.'.
2025-10-13 12:08:59.981 +03:00 [DBG] Opened connection to database 'GAC-BillingService' on server '.'.
2025-10-13 12:08:59.983 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-10-13 12:08:59.984 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (1ms).
2025-10-13 12:08:59.986 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (2ms).
2025-10-13 12:08:59.988 +03:00 [DBG] Executing DbCommand [Parameters=[@__idempotentKey_0='?' (Size = 36) (DbType = AnsiString)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [Invoices] AS [i]
        WHERE CONVERT(varchar(36), [i].[ExternalId]) = @__idempotentKey_0) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2025-10-13 12:08:59.994 +03:00 [INF] Executed DbCommand (7ms) [Parameters=[@__idempotentKey_0='?' (Size = 36) (DbType = AnsiString)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [Invoices] AS [i]
        WHERE CONVERT(varchar(36), [i].[ExternalId]) = @__idempotentKey_0) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2025-10-13 12:08:59.998 +03:00 [DBG] Closing data reader to 'GAC-BillingService' on server '.'.
2025-10-13 12:09:00.000 +03:00 [DBG] A data reader for 'GAC-BillingService' on server '.' is being disposed after spending 2ms reading results.
2025-10-13 12:09:00.003 +03:00 [DBG] Closing connection to database 'GAC-BillingService' on server '.'.
2025-10-13 12:09:00.004 +03:00 [DBG] Closed connection to database 'GAC-BillingService' on server '.' (1ms).
2025-10-13 12:09:00.007 +03:00 [DBG] Request was short circuited at action filter 'BillingSystem.API.ActionFilters.IdempotencyFilter'.
2025-10-13 12:09:00.009 +03:00 [DBG] List of registered output formatters, in the following order: ["Microsoft.AspNetCore.Mvc.Formatters.HttpNoContentOutputFormatter","Microsoft.AspNetCore.Mvc.Formatters.StringOutputFormatter","Microsoft.AspNetCore.Mvc.Formatters.StreamOutputFormatter","Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonOutputFormatter"]
2025-10-13 12:09:00.013 +03:00 [DBG] No information found on request to perform content negotiation.
2025-10-13 12:09:00.014 +03:00 [DBG] Attempting to select the first output formatter in the output formatters list which supports a content type from the explicitly specified content types '["application/json"]'.
2025-10-13 12:09:00.017 +03:00 [DBG] Selected output formatter 'Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonOutputFormatter' and content type 'application/json' to write the response.
2025-10-13 12:09:00.019 +03:00 [INF] Executing ConflictObjectResult, writing value of type 'System.String'.
2025-10-13 12:09:00.021 +03:00 [INF] Executed action BillingSystem.API.Controllers.InvoicesController.Post (BillingSystem.API) in 2459.4427ms
2025-10-13 12:09:00.023 +03:00 [INF] Executed endpoint 'BillingSystem.API.Controllers.InvoicesController.Post (BillingSystem.API)'
2025-10-13 12:09:00.025 +03:00 [INF] HTTP POST /api/Invoices responded 409 in 5223.5636 ms
2025-10-13 12:09:00.028 +03:00 [DBG] Connection id "0HNGA6PT6H42G" completed keep alive response.
2025-10-13 12:09:00.030 +03:00 [DBG] 'BillingServiceDBContext' disposed.
2025-10-13 12:09:00.031 +03:00 [DBG] Disposing connection to database 'GAC-BillingService' on server '.'.
2025-10-13 12:09:00.033 +03:00 [DBG] Disposed connection to database '' on server '' (1ms).
2025-10-13 12:09:00.035 +03:00 [INF] Request finished HTTP/1.1 POST https://localhost:7257/api/Invoices - 409 null application/json; charset=utf-8 5239.4497ms
2025-10-13 12:09:57.164 +03:00 [DBG] Connection id "0HNGA6PT6H42H" accepted.
2025-10-13 12:09:57.164 +03:00 [DBG] Connection id "0HNGA6PT6H42H" received FIN.
2025-10-13 12:09:57.166 +03:00 [DBG] Connection id "0HNGA6PT6H42H" started.
2025-10-13 12:09:57.167 +03:00 [DBG] Connection id "0HNGA6PT6H42I" accepted.
2025-10-13 12:09:57.170 +03:00 [DBG] Failed to authenticate HTTPS connection.
System.IO.IOException: Received an unexpected EOF or 0 bytes from the transport stream.
   at System.Net.Security.SslStream.ReceiveHandshakeFrameAsync[TIOAdapter](CancellationToken cancellationToken)
   at System.Net.Security.SslStream.ForceAuthenticationAsync[TIOAdapter](Boolean receiveFirst, Byte[] reAuthenticationData, CancellationToken cancellationToken)
   at System.Net.Security.SslStream.ProcessAuthenticationWithTelemetryAsync(Boolean isAsync, CancellationToken cancellationToken)
   at Microsoft.AspNetCore.Server.Kestrel.Https.Internal.HttpsConnectionMiddleware.OnConnectionAsync(ConnectionContext context)
2025-10-13 12:09:57.171 +03:00 [DBG] Connection id "0HNGA6PT6H42I" started.
2025-10-13 12:09:57.175 +03:00 [DBG] Connection id "0HNGA6PT6H42H" stopped.
2025-10-13 12:09:57.177 +03:00 [DBG] Connection id "0HNGA6PT6H42H" sending FIN because: "The Socket transport's send loop completed gracefully."
2025-10-13 12:09:57.180 +03:00 [DBG] Connection 0HNGA6PT6H42I established using the following protocol: "Tls12"
2025-10-13 12:09:57.181 +03:00 [INF] Request starting HTTP/1.1 POST https://localhost:7257/api/Invoices - application/json 261
2025-10-13 12:09:57.183 +03:00 [DBG] 1 candidate(s) found for the request path '/api/Invoices'
2025-10-13 12:09:57.184 +03:00 [DBG] Endpoint 'BillingSystem.API.Controllers.InvoicesController.Post (BillingSystem.API)' with route pattern 'api/Invoices' is valid for the request path '/api/Invoices'
2025-10-13 12:09:57.186 +03:00 [DBG] Request matched endpoint 'BillingSystem.API.Controllers.InvoicesController.Post (BillingSystem.API)'
2025-10-13 12:09:57.187 +03:00 [DBG] Static files was skipped as the request already matched an endpoint.
2025-10-13 12:10:02.321 +03:00 [INF] Executing endpoint 'BillingSystem.API.Controllers.InvoicesController.Post (BillingSystem.API)'
2025-10-13 12:10:02.324 +03:00 [INF] Route matched with {action = "Post", controller = "Invoices"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Post(BillingSystem.Application.Requests.CreateInvoiceRequest) on controller BillingSystem.API.Controllers.InvoicesController (BillingSystem.API).
2025-10-13 12:10:02.327 +03:00 [DBG] Execution plan of authorization filters (in the following order): ["None"]
2025-10-13 12:10:02.328 +03:00 [DBG] Execution plan of resource filters (in the following order): ["None"]
2025-10-13 12:10:02.330 +03:00 [DBG] Execution plan of action filters (in the following order): ["Microsoft.AspNetCore.Mvc.ModelBinding.UnsupportedContentTypeFilter (Order: -3000)","Microsoft.AspNetCore.Mvc.Infrastructure.ModelStateInvalidFilter (Order: -2000)","BillingSystem.API.ActionFilters.AuditBillingRequestsFilter","BillingSystem.API.ActionFilters.IdempotencyFilter (Order: 0)"]
2025-10-13 12:10:02.333 +03:00 [DBG] Execution plan of exception filters (in the following order): ["None"]
2025-10-13 12:10:02.334 +03:00 [DBG] Execution plan of result filters (in the following order): ["Microsoft.AspNetCore.Mvc.Infrastructure.ClientErrorResultFilter (Order: -2000)","Microsoft.AspNetCore.Mvc.ProducesAttribute (Order: 0)","BillingSystem.API.ActionFilters.IdempotencyFilter (Order: 0)"]
2025-10-13 12:10:02.336 +03:00 [DBG] Executing controller factory for controller BillingSystem.API.Controllers.InvoicesController (BillingSystem.API)
2025-10-13 12:10:02.338 +03:00 [DBG] Executed controller factory for controller BillingSystem.API.Controllers.InvoicesController (BillingSystem.API)
2025-10-13 12:10:02.341 +03:00 [DBG] Attempting to bind parameter 'invoiceRequest' of type 'BillingSystem.Application.Requests.CreateInvoiceRequest' ...
2025-10-13 12:10:02.343 +03:00 [DBG] Attempting to bind parameter 'invoiceRequest' of type 'BillingSystem.Application.Requests.CreateInvoiceRequest' using the name '' in request data ...
2025-10-13 12:10:02.344 +03:00 [DBG] Selected input formatter 'Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonInputFormatter' for content type 'application/json'.
2025-10-13 12:10:02.346 +03:00 [DBG] Connection id "0HNGA6PT6H42I", Request id "0HNGA6PT6H42I:00000001": started reading request body.
2025-10-13 12:10:02.347 +03:00 [DBG] Connection id "0HNGA6PT6H42I", Request id "0HNGA6PT6H42I:00000001": done reading request body.
2025-10-13 12:10:02.349 +03:00 [DBG] JSON input formatter succeeded, deserializing to type 'BillingSystem.Application.Requests.CreateInvoiceRequest'
2025-10-13 12:10:02.350 +03:00 [DBG] Done attempting to bind parameter 'invoiceRequest' of type 'BillingSystem.Application.Requests.CreateInvoiceRequest'.
2025-10-13 12:10:02.351 +03:00 [DBG] Done attempting to bind parameter 'invoiceRequest' of type 'BillingSystem.Application.Requests.CreateInvoiceRequest'.
2025-10-13 12:10:02.353 +03:00 [DBG] Attempting to validate the bound parameter 'invoiceRequest' of type 'BillingSystem.Application.Requests.CreateInvoiceRequest' ...
2025-10-13 12:10:02.355 +03:00 [DBG] Done attempting to validate the bound parameter 'invoiceRequest' of type 'BillingSystem.Application.Requests.CreateInvoiceRequest'.
2025-10-13 12:10:04.430 +03:00 [DBG] Entity Framework Core 9.0.9 initialized 'BillingServiceDBContext' using provider 'Microsoft.EntityFrameworkCore.SqlServer:9.0.9' with options: EngineType=SqlServer 
2025-10-13 12:10:04.439 +03:00 [DBG] Creating DbConnection.
2025-10-13 12:10:04.440 +03:00 [DBG] Created DbConnection. (1ms).
2025-10-13 12:10:04.442 +03:00 [DBG] Opening connection to database 'GAC-BillingService' on server '.'.
2025-10-13 12:10:04.443 +03:00 [DBG] Opened connection to database 'GAC-BillingService' on server '.'.
2025-10-13 12:10:04.444 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-10-13 12:10:04.445 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (1ms).
2025-10-13 12:10:04.447 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (2ms).
2025-10-13 12:10:04.448 +03:00 [DBG] Executing DbCommand [Parameters=[@__idempotentKey_0='?' (Size = 36) (DbType = AnsiString)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [Invoices] AS [i]
        WHERE CONVERT(varchar(36), [i].[ExternalId]) = @__idempotentKey_0) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2025-10-13 12:10:04.452 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[@__idempotentKey_0='?' (Size = 36) (DbType = AnsiString)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [Invoices] AS [i]
        WHERE CONVERT(varchar(36), [i].[ExternalId]) = @__idempotentKey_0) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2025-10-13 12:10:04.455 +03:00 [DBG] Closing data reader to 'GAC-BillingService' on server '.'.
2025-10-13 12:10:04.456 +03:00 [DBG] A data reader for 'GAC-BillingService' on server '.' is being disposed after spending 1ms reading results.
2025-10-13 12:10:04.458 +03:00 [DBG] Closing connection to database 'GAC-BillingService' on server '.'.
2025-10-13 12:10:04.459 +03:00 [DBG] Closed connection to database 'GAC-BillingService' on server '.' (1ms).
2025-10-13 12:10:04.461 +03:00 [DBG] Request was short circuited at action filter 'BillingSystem.API.ActionFilters.IdempotencyFilter'.
2025-10-13 12:10:04.463 +03:00 [DBG] List of registered output formatters, in the following order: ["Microsoft.AspNetCore.Mvc.Formatters.HttpNoContentOutputFormatter","Microsoft.AspNetCore.Mvc.Formatters.StringOutputFormatter","Microsoft.AspNetCore.Mvc.Formatters.StreamOutputFormatter","Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonOutputFormatter"]
2025-10-13 12:10:04.467 +03:00 [DBG] No information found on request to perform content negotiation.
2025-10-13 12:10:04.467 +03:00 [DBG] Attempting to select the first output formatter in the output formatters list which supports a content type from the explicitly specified content types '["application/json"]'.
2025-10-13 12:10:04.469 +03:00 [DBG] Selected output formatter 'Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonOutputFormatter' and content type 'application/json' to write the response.
2025-10-13 12:10:04.470 +03:00 [INF] Executing ConflictObjectResult, writing value of type 'System.String'.
2025-10-13 12:10:04.473 +03:00 [INF] Executed action BillingSystem.API.Controllers.InvoicesController.Post (BillingSystem.API) in 2136.2001ms
2025-10-13 12:10:04.474 +03:00 [INF] Executed endpoint 'BillingSystem.API.Controllers.InvoicesController.Post (BillingSystem.API)'
2025-10-13 12:10:04.475 +03:00 [INF] HTTP POST /api/Invoices responded 409 in 7287.8809 ms
2025-10-13 12:10:04.477 +03:00 [DBG] Connection id "0HNGA6PT6H42I" completed keep alive response.
2025-10-13 12:10:04.478 +03:00 [DBG] 'BillingServiceDBContext' disposed.
2025-10-13 12:10:04.479 +03:00 [DBG] Disposing connection to database 'GAC-BillingService' on server '.'.
2025-10-13 12:10:04.481 +03:00 [DBG] Disposed connection to database '' on server '' (1ms).
2025-10-13 12:10:04.483 +03:00 [INF] Request finished HTTP/1.1 POST https://localhost:7257/api/Invoices - 409 null application/json; charset=utf-8 7301.2505ms
2025-10-13 12:11:29.556 +03:00 [DBG] Connection id "0HNGA6PT6H42J" received FIN.
2025-10-13 12:11:29.558 +03:00 [DBG] Connection id "0HNGA6PT6H42J" accepted.
2025-10-13 12:11:29.559 +03:00 [DBG] Connection id "0HNGA6PT6H42J" started.
2025-10-13 12:11:29.559 +03:00 [DBG] Connection id "0HNGA6PT6H42K" accepted.
2025-10-13 12:11:29.561 +03:00 [DBG] Failed to authenticate HTTPS connection.
System.IO.IOException: Received an unexpected EOF or 0 bytes from the transport stream.
   at System.Net.Security.SslStream.ReceiveHandshakeFrameAsync[TIOAdapter](CancellationToken cancellationToken)
   at System.Net.Security.SslStream.ForceAuthenticationAsync[TIOAdapter](Boolean receiveFirst, Byte[] reAuthenticationData, CancellationToken cancellationToken)
   at System.Net.Security.SslStream.ProcessAuthenticationWithTelemetryAsync(Boolean isAsync, CancellationToken cancellationToken)
   at Microsoft.AspNetCore.Server.Kestrel.Https.Internal.HttpsConnectionMiddleware.OnConnectionAsync(ConnectionContext context)
2025-10-13 12:11:29.562 +03:00 [DBG] Connection id "0HNGA6PT6H42K" started.
2025-10-13 12:11:29.565 +03:00 [DBG] Connection id "0HNGA6PT6H42J" stopped.
2025-10-13 12:11:29.567 +03:00 [DBG] Connection id "0HNGA6PT6H42J" sending FIN because: "The Socket transport's send loop completed gracefully."
2025-10-13 12:11:29.570 +03:00 [DBG] Connection 0HNGA6PT6H42K established using the following protocol: "Tls12"
2025-10-13 12:11:29.571 +03:00 [INF] Request starting HTTP/1.1 POST https://localhost:7257/api/Invoices - application/json 261
2025-10-13 12:11:29.574 +03:00 [DBG] 1 candidate(s) found for the request path '/api/Invoices'
2025-10-13 12:11:29.575 +03:00 [DBG] Endpoint 'BillingSystem.API.Controllers.InvoicesController.Post (BillingSystem.API)' with route pattern 'api/Invoices' is valid for the request path '/api/Invoices'
2025-10-13 12:11:29.577 +03:00 [DBG] Request matched endpoint 'BillingSystem.API.Controllers.InvoicesController.Post (BillingSystem.API)'
2025-10-13 12:11:29.578 +03:00 [DBG] Static files was skipped as the request already matched an endpoint.
2025-10-13 12:11:57.377 +03:00 [INF] Executing endpoint 'BillingSystem.API.Controllers.InvoicesController.Post (BillingSystem.API)'
2025-10-13 12:11:57.379 +03:00 [INF] Route matched with {action = "Post", controller = "Invoices"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Post(BillingSystem.Application.Requests.CreateInvoiceRequest) on controller BillingSystem.API.Controllers.InvoicesController (BillingSystem.API).
2025-10-13 12:11:57.381 +03:00 [DBG] Execution plan of authorization filters (in the following order): ["None"]
2025-10-13 12:11:57.383 +03:00 [DBG] Execution plan of resource filters (in the following order): ["None"]
2025-10-13 12:11:57.384 +03:00 [DBG] Execution plan of action filters (in the following order): ["Microsoft.AspNetCore.Mvc.ModelBinding.UnsupportedContentTypeFilter (Order: -3000)","Microsoft.AspNetCore.Mvc.Infrastructure.ModelStateInvalidFilter (Order: -2000)","BillingSystem.API.ActionFilters.AuditBillingRequestsFilter","BillingSystem.API.ActionFilters.IdempotencyFilter (Order: 0)"]
2025-10-13 12:11:57.387 +03:00 [DBG] Execution plan of exception filters (in the following order): ["None"]
2025-10-13 12:11:57.388 +03:00 [DBG] Execution plan of result filters (in the following order): ["Microsoft.AspNetCore.Mvc.Infrastructure.ClientErrorResultFilter (Order: -2000)","Microsoft.AspNetCore.Mvc.ProducesAttribute (Order: 0)","BillingSystem.API.ActionFilters.IdempotencyFilter (Order: 0)"]
2025-10-13 12:11:57.391 +03:00 [DBG] Executing controller factory for controller BillingSystem.API.Controllers.InvoicesController (BillingSystem.API)
2025-10-13 12:11:57.392 +03:00 [DBG] Executed controller factory for controller BillingSystem.API.Controllers.InvoicesController (BillingSystem.API)
2025-10-13 12:11:57.394 +03:00 [DBG] Attempting to bind parameter 'invoiceRequest' of type 'BillingSystem.Application.Requests.CreateInvoiceRequest' ...
2025-10-13 12:11:57.396 +03:00 [DBG] Attempting to bind parameter 'invoiceRequest' of type 'BillingSystem.Application.Requests.CreateInvoiceRequest' using the name '' in request data ...
2025-10-13 12:11:57.398 +03:00 [DBG] Selected input formatter 'Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonInputFormatter' for content type 'application/json'.
2025-10-13 12:11:57.399 +03:00 [DBG] Connection id "0HNGA6PT6H42K", Request id "0HNGA6PT6H42K:00000001": started reading request body.
2025-10-13 12:11:57.400 +03:00 [DBG] Connection id "0HNGA6PT6H42K", Request id "0HNGA6PT6H42K:00000001": done reading request body.
2025-10-13 12:11:57.402 +03:00 [DBG] JSON input formatter succeeded, deserializing to type 'BillingSystem.Application.Requests.CreateInvoiceRequest'
2025-10-13 12:11:57.403 +03:00 [DBG] Done attempting to bind parameter 'invoiceRequest' of type 'BillingSystem.Application.Requests.CreateInvoiceRequest'.
2025-10-13 12:11:57.404 +03:00 [DBG] Done attempting to bind parameter 'invoiceRequest' of type 'BillingSystem.Application.Requests.CreateInvoiceRequest'.
2025-10-13 12:11:57.405 +03:00 [DBG] Attempting to validate the bound parameter 'invoiceRequest' of type 'BillingSystem.Application.Requests.CreateInvoiceRequest' ...
2025-10-13 12:11:57.407 +03:00 [DBG] Done attempting to validate the bound parameter 'invoiceRequest' of type 'BillingSystem.Application.Requests.CreateInvoiceRequest'.
2025-10-13 12:12:51.512 +03:00 [DBG] Entity Framework Core 9.0.9 initialized 'BillingServiceDBContext' using provider 'Microsoft.EntityFrameworkCore.SqlServer:9.0.9' with options: EngineType=SqlServer 
2025-10-13 12:12:51.515 +03:00 [DBG] Creating DbConnection.
2025-10-13 12:12:51.516 +03:00 [DBG] Created DbConnection. (0ms).
2025-10-13 12:12:51.518 +03:00 [DBG] Opening connection to database 'GAC-BillingService' on server '.'.
2025-10-13 12:12:51.519 +03:00 [DBG] Opened connection to database 'GAC-BillingService' on server '.'.
2025-10-13 12:12:51.521 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-10-13 12:12:51.522 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (1ms).
2025-10-13 12:12:51.524 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (3ms).
2025-10-13 12:12:51.527 +03:00 [DBG] Executing DbCommand [Parameters=[@__idempotentKey_0='?' (Size = 36) (DbType = AnsiString)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [Invoices] AS [i]
        WHERE CONVERT(varchar(36), [i].[ExternalId]) = @__idempotentKey_0) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2025-10-13 12:12:51.532 +03:00 [INF] Executed DbCommand (5ms) [Parameters=[@__idempotentKey_0='?' (Size = 36) (DbType = AnsiString)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [Invoices] AS [i]
        WHERE CONVERT(varchar(36), [i].[ExternalId]) = @__idempotentKey_0) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2025-10-13 12:12:51.535 +03:00 [DBG] Closing data reader to 'GAC-BillingService' on server '.'.
2025-10-13 12:12:51.536 +03:00 [DBG] A data reader for 'GAC-BillingService' on server '.' is being disposed after spending 1ms reading results.
2025-10-13 12:12:51.538 +03:00 [DBG] Closing connection to database 'GAC-BillingService' on server '.'.
2025-10-13 12:12:51.539 +03:00 [DBG] Closed connection to database 'GAC-BillingService' on server '.' (1ms).
2025-10-13 12:13:08.208 +03:00 [DBG] List of registered output formatters, in the following order: ["Microsoft.AspNetCore.Mvc.Formatters.HttpNoContentOutputFormatter","Microsoft.AspNetCore.Mvc.Formatters.StringOutputFormatter","Microsoft.AspNetCore.Mvc.Formatters.StreamOutputFormatter","Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonOutputFormatter"]
2025-10-13 12:13:08.212 +03:00 [DBG] No information found on request to perform content negotiation.
2025-10-13 12:13:08.212 +03:00 [DBG] Attempting to select the first output formatter in the output formatters list which supports a content type from the explicitly specified content types '["application/json"]'.
2025-10-13 12:13:08.214 +03:00 [DBG] Selected output formatter 'Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonOutputFormatter' and content type 'application/json' to write the response.
2025-10-13 12:13:08.216 +03:00 [INF] Executing BadRequestObjectResult, writing value of type 'BillingSystem.SharedKernel.ApiResponse`1[[System.Int64, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-10-13 12:13:08.218 +03:00 [INF] Executed action BillingSystem.API.Controllers.InvoicesController.Post (BillingSystem.API) in 70825.5783ms
2025-10-13 12:13:08.219 +03:00 [INF] Executed endpoint 'BillingSystem.API.Controllers.InvoicesController.Post (BillingSystem.API)'
2025-10-13 12:13:08.220 +03:00 [INF] HTTP POST /api/Invoices responded 400 in 98640.3886 ms
2025-10-13 12:13:08.222 +03:00 [DBG] Connection id "0HNGA6PT6H42K" completed keep alive response.
2025-10-13 12:13:08.224 +03:00 [DBG] 'BillingServiceDBContext' disposed.
2025-10-13 12:13:08.225 +03:00 [DBG] Disposing connection to database 'GAC-BillingService' on server '.'.
2025-10-13 12:13:08.227 +03:00 [DBG] Disposed connection to database '' on server '' (1ms).
2025-10-13 12:13:08.230 +03:00 [INF] Request finished HTTP/1.1 POST https://localhost:7257/api/Invoices - 400 null application/json; charset=utf-8 98655.9831ms
2025-10-13 12:26:42.992 +03:00 [DBG] Connection id "0HNGA6PT6H42A" received FIN.
2025-10-13 12:26:42.995 +03:00 [DBG] Connection id "0HNGA6PT6H42A" is closed. The last processed stream ID was 17.
2025-10-13 12:26:42.995 +03:00 [DBG] The connection queue processing loop for 0HNGA6PT6H42A completed.
2025-10-13 12:26:42.997 +03:00 [DBG] Connection id "0HNGA6PT6H42A" sending FIN because: "The Socket transport's send loop completed gracefully."
2025-10-13 12:26:43.014 +03:00 [DBG] Connection id "0HNGA6PT6H42A" stopped.
2025-10-13 12:57:48.914 +03:00 [DBG] Registered model binder providers, in the following order: ["Microsoft.AspNetCore.Mvc.ModelBinding.Binders.BinderTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ServicesModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.BodyModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.HeaderModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FloatingPointTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.EnumTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.DateTimeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.SimpleTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.TryParseModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.CancellationTokenModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ByteArrayModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FormFileModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FormCollectionModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.KeyValuePairModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.DictionaryModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ArrayModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.CollectionModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ComplexObjectModelBinderProvider"]
2025-10-13 12:57:48.997 +03:00 [DBG] Hosting starting
2025-10-13 12:57:49.139 +03:00 [DBG] Starting bus instances: IBus
2025-10-13 12:57:49.142 +03:00 [DBG] Starting bus: "rabbitmq://localhost/"
2025-10-13 12:57:49.156 +03:00 [DBG] Middleware loaded
2025-10-13 12:57:49.157 +03:00 [DBG] Middleware loaded. Script /_framework/aspnetcore-browser-refresh.js (16519 B).
2025-10-13 12:57:49.160 +03:00 [DBG] Middleware loaded. Script /_framework/blazor-hotreload.js (799 B).
2025-10-13 12:57:49.170 +03:00 [DBG] Connect: guest@localhost:5672/
2025-10-13 12:57:49.247 +03:00 [DBG] Middleware loaded: DOTNET_MODIFIABLE_ASSEMBLIES=debug, __ASPNETCORE_BROWSER_TOOLS=true
2025-10-13 12:57:49.259 +03:00 [DBG] Connected: guest@localhost:5672/ (address: amqp://localhost:5672, local: 56583)
2025-10-13 12:57:49.310 +03:00 [DBG] Endpoint Ready: "rabbitmq://localhost/ECHGHANNAMLP1_BillingSystemAPI_bus_g1noyyyh3bcsy61bbdxywxzzrt?temporary=true"
2025-10-13 12:57:49.312 +03:00 [INF] Bus started: "rabbitmq://localhost/"
2025-10-13 12:57:49.361 +03:00 [INF] Now listening on: https://localhost:7257
2025-10-13 12:57:49.362 +03:00 [INF] Now listening on: http://localhost:5009
2025-10-13 12:57:49.363 +03:00 [DBG] Loaded hosting startup assembly BillingSystem.API
2025-10-13 12:57:49.365 +03:00 [DBG] Loaded hosting startup assembly Microsoft.WebTools.ApiEndpointDiscovery
2025-10-13 12:57:49.366 +03:00 [DBG] Loaded hosting startup assembly Microsoft.AspNetCore.Watch.BrowserRefresh
2025-10-13 12:57:49.368 +03:00 [DBG] Loaded hosting startup assembly Microsoft.WebTools.BrowserLink.Net
2025-10-13 12:57:49.419 +03:00 [DBG] Connection id "0HNGA7RRS5V43" accepted.
2025-10-13 12:57:49.422 +03:00 [DBG] Connection id "0HNGA7RRS5V43" started.
2025-10-13 12:57:49.428 +03:00 [DBG] Connection id "0HNGA7RRS5V43" received FIN.
2025-10-13 12:57:49.440 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-10-13 12:57:49.440 +03:00 [DBG] Failed to authenticate HTTPS connection.
System.IO.IOException: Received an unexpected EOF or 0 bytes from the transport stream.
   at System.Net.Security.SslStream.ReceiveHandshakeFrameAsync[TIOAdapter](CancellationToken cancellationToken)
   at System.Net.Security.SslStream.ForceAuthenticationAsync[TIOAdapter](Boolean receiveFirst, Byte[] reAuthenticationData, CancellationToken cancellationToken)
   at System.Net.Security.SslStream.ProcessAuthenticationWithTelemetryAsync(Boolean isAsync, CancellationToken cancellationToken)
   at Microsoft.AspNetCore.Server.Kestrel.Https.Internal.HttpsConnectionMiddleware.OnConnectionAsync(ConnectionContext context)
2025-10-13 12:57:49.441 +03:00 [INF] Hosting environment: Development
2025-10-13 12:57:49.458 +03:00 [INF] Content root path: C:\Repositories\Gac-BillingSystem\src\BillingSystem.API
2025-10-13 12:57:49.459 +03:00 [DBG] Connection id "0HNGA7RRS5V43" stopped.
2025-10-13 12:57:49.460 +03:00 [DBG] Hosting started
2025-10-13 12:57:49.467 +03:00 [DBG] Connection id "0HNGA7RRS5V43" sending FIN because: "The Socket transport's send loop completed gracefully."
2025-10-13 12:57:49.843 +03:00 [DBG] Connection id "0HNGA7RRS5V44" accepted.
2025-10-13 12:57:49.846 +03:00 [DBG] Connection id "0HNGA7RRS5V44" started.
2025-10-13 12:57:49.881 +03:00 [DBG] Connection 0HNGA7RRS5V44 established using the following protocol: "Tls12"
2025-10-13 12:57:49.922 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7257/swagger/index.html - null null
2025-10-13 12:57:49.953 +03:00 [DBG] Wildcard detected, all requests with hosts will be allowed.
2025-10-13 12:57:49.966 +03:00 [DBG] No candidates found for the request path '/swagger/index.html'
2025-10-13 12:57:49.968 +03:00 [DBG] Request did not match any endpoints
2025-10-13 12:57:50.006 +03:00 [DBG] Response markup is scheduled to include Browser Link script injection.
2025-10-13 12:57:50.009 +03:00 [DBG] Response markup is scheduled to include browser refresh script injection.
2025-10-13 12:57:50.030 +03:00 [INF] HTTP GET /swagger/index.html responded 200 in 58.0679 ms
2025-10-13 12:57:50.034 +03:00 [DBG] Response markup was updated to include Browser Link script injection.
2025-10-13 12:57:50.036 +03:00 [DBG] Response markup was updated to include browser refresh script injection.
2025-10-13 12:57:50.041 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7257/swagger/index.html - 200 null text/html;charset=utf-8 124.7076ms
2025-10-13 12:57:50.100 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7257/_framework/aspnetcore-browser-refresh.js - null null
2025-10-13 12:57:50.109 +03:00 [DBG] Script injected: /_framework/aspnetcore-browser-refresh.js
2025-10-13 12:57:50.111 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7257/_vs/browserLink - null null
2025-10-13 12:57:50.111 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7257/_framework/aspnetcore-browser-refresh.js - 200 16519 application/javascript; charset=utf-8 11.0192ms
2025-10-13 12:57:50.137 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7257/_vs/browserLink - 200 null text/javascript; charset=UTF-8 25.8858ms
2025-10-13 12:57:50.327 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7257/swagger/v1/swagger.json - null null
2025-10-13 12:57:50.331 +03:00 [DBG] No candidates found for the request path '/swagger/v1/swagger.json'
2025-10-13 12:57:50.332 +03:00 [DBG] Request did not match any endpoints
2025-10-13 12:57:50.338 +03:00 [INF] HTTP GET /swagger/v1/swagger.json responded 200 in 4.7164 ms
2025-10-13 12:57:50.341 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7257/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 14.6256ms
2025-10-13 12:58:31.595 +03:00 [DBG] Connection id "0HNGA7RRS5V45" accepted.
2025-10-13 12:58:31.595 +03:00 [DBG] Connection id "0HNGA7RRS5V45" received FIN.
2025-10-13 12:58:31.596 +03:00 [DBG] Connection id "0HNGA7RRS5V45" started.
2025-10-13 12:58:31.597 +03:00 [DBG] Connection id "0HNGA7RRS5V46" accepted.
2025-10-13 12:58:31.599 +03:00 [DBG] Failed to authenticate HTTPS connection.
System.IO.IOException: Received an unexpected EOF or 0 bytes from the transport stream.
   at System.Net.Security.SslStream.ReceiveHandshakeFrameAsync[TIOAdapter](CancellationToken cancellationToken)
   at System.Net.Security.SslStream.ForceAuthenticationAsync[TIOAdapter](Boolean receiveFirst, Byte[] reAuthenticationData, CancellationToken cancellationToken)
   at System.Net.Security.SslStream.ProcessAuthenticationWithTelemetryAsync(Boolean isAsync, CancellationToken cancellationToken)
   at Microsoft.AspNetCore.Server.Kestrel.Https.Internal.HttpsConnectionMiddleware.OnConnectionAsync(ConnectionContext context)
2025-10-13 12:58:31.599 +03:00 [DBG] Connection id "0HNGA7RRS5V46" started.
2025-10-13 12:58:31.602 +03:00 [DBG] Connection id "0HNGA7RRS5V45" stopped.
2025-10-13 12:58:31.604 +03:00 [DBG] Connection id "0HNGA7RRS5V45" sending FIN because: "The Socket transport's send loop completed gracefully."
2025-10-13 12:58:31.608 +03:00 [DBG] Connection 0HNGA7RRS5V46 established using the following protocol: "Tls12"
2025-10-13 12:58:31.612 +03:00 [INF] Request starting HTTP/1.1 POST https://localhost:7257/api/Invoices - application/json 261
2025-10-13 12:58:31.617 +03:00 [DBG] 1 candidate(s) found for the request path '/api/Invoices'
2025-10-13 12:58:31.622 +03:00 [DBG] Endpoint 'BillingSystem.API.Controllers.InvoicesController.Post (BillingSystem.API)' with route pattern 'api/Invoices' is valid for the request path '/api/Invoices'
2025-10-13 12:58:31.625 +03:00 [DBG] Request matched endpoint 'BillingSystem.API.Controllers.InvoicesController.Post (BillingSystem.API)'
2025-10-13 12:58:31.628 +03:00 [DBG] Static files was skipped as the request already matched an endpoint.
2025-10-13 12:58:36.732 +03:00 [DBG] An 'IServiceProvider' was created for internal use by Entity Framework.
2025-10-13 12:58:52.777 +03:00 [DBG] Entity Framework Core 9.0.9 initialized 'BillingServiceDBContext' using provider 'Microsoft.EntityFrameworkCore.SqlServer:9.0.9' with options: EngineType=SqlServer 
2025-10-13 12:58:52.814 +03:00 [DBG] Compiling query expression: 
'DbSet<Tenant>()'
2025-10-13 12:58:53.035 +03:00 [DBG] Generated query execution expression: 
'queryContext => SingleQueryingEnumerable.Create<Tenant>(
    relationalQueryContext: (RelationalQueryContext)queryContext, 
    relationalCommandResolver: parameters => [LIFTABLE Constant: RelationalCommandCache.QueryExpression(
        Projection Mapping:
            EmptyProjectionMember -> Dictionary<IProperty, int> { [Property: Tenant.Id (int) Required PK AfterSave:Throw ValueGenerated.OnAdd, 0], [Property: Tenant.IsDeleted (bool) Required, 1], [Property: Tenant.TenantGUID (Guid) Required, 2], [Property: Tenant.TenantName (string) Required, 3], [Property: Tenant.TenantStatus (int) Required, 4], [Property: Tenant.ValidFrom (DateTime) Required, 5], [Property: Tenant.ValidTo (DateTime) Required, 6] }
        SELECT t.Id, t.IsDeleted, t.TenantGUID, t.TenantName, t.TenantStatus, t.ValidFrom, t.ValidTo
        FROM Tenants AS t) | Resolver: c => new RelationalCommandCache(
        c.Dependencies.MemoryCache, 
        c.RelationalDependencies.QuerySqlGeneratorFactory, 
        c.RelationalDependencies.RelationalParameterBasedSqlProcessorFactory, 
        Projection Mapping:
            EmptyProjectionMember -> Dictionary<IProperty, int> { [Property: Tenant.Id (int) Required PK AfterSave:Throw ValueGenerated.OnAdd, 0], [Property: Tenant.IsDeleted (bool) Required, 1], [Property: Tenant.TenantGUID (Guid) Required, 2], [Property: Tenant.TenantName (string) Required, 3], [Property: Tenant.TenantStatus (int) Required, 4], [Property: Tenant.ValidFrom (DateTime) Required, 5], [Property: Tenant.ValidTo (DateTime) Required, 6] }
        SELECT t.Id, t.IsDeleted, t.TenantGUID, t.TenantName, t.TenantStatus, t.ValidFrom, t.ValidTo
        FROM Tenants AS t, 
        False, 
        new HashSet<string>(
            new string[]{ }, 
            StringComparer.Ordinal
        )
    )].GetRelationalCommandTemplate(parameters), 
    readerColumns: null, 
    shaper: (queryContext, dataReader, resultContext, resultCoordinator) => 
    {
        Tenant entity;
        entity = 
        {
            MaterializationContext materializationContext1;
            IEntityType entityType1;
            Tenant instance1;
            InternalEntityEntry entry1;
            bool hasNullKey1;
            materializationContext1 = new MaterializationContext(
                [LIFTABLE Constant: ValueBuffer | Resolver: _ => (object)ValueBuffer.Empty], 
                queryContext.Context
            );
            instance1 = default(Tenant);
            entry1 = queryContext.TryGetEntry(
                key: [LIFTABLE Constant: Key: Tenant.Id PK | Resolver: c => c.Dependencies.Model.FindEntityType("BillingSystem.Domain.Entities.Tenant").FindPrimaryKey()], 
                keyValues: new object[]{ (object)dataReader.GetInt32(0) }, 
                throwOnNullKey: True, 
                hasNullKey: hasNullKey1);
            !(hasNullKey1) ? entry1 != default(InternalEntityEntry) ? 
            {
                entityType1 = entry1.EntityType;
                return instance1 = (Tenant)entry1.Entity;
            } : 
            {
                ISnapshot shadowSnapshot1;
                shadowSnapshot1 = [LIFTABLE Constant: Snapshot | Resolver: _ => Snapshot.Empty];
                entityType1 = [LIFTABLE Constant: EntityType: Tenant | Resolver: namelessParameter{0} => namelessParameter{0}.Dependencies.Model.FindEntityType("BillingSystem.Domain.Entities.Tenant")];
                instance1 = switch (entityType1)
                {
                    case [LIFTABLE Constant: EntityType: Tenant | Resolver: namelessParameter{1} => namelessParameter{1}.Dependencies.Model.FindEntityType("BillingSystem.Domain.Entities.Tenant")]: 
                        {
                            return 
                            {
                                Tenant instance;
                                instance = new Tenant();
                                instance.<Id>k__BackingField = dataReader.GetInt32(0);
                                instance.<IsDeleted>k__BackingField = dataReader.GetBoolean(1);
                                instance.<TenantGUID>k__BackingField = dataReader.GetGuid(2);
                                instance.<TenantName>k__BackingField = dataReader.GetString(3);
                                instance.<TenantStatus>k__BackingField = dataReader.GetInt32(4);
                                instance.<ValidFrom>k__BackingField = dataReader.GetDateTime(5);
                                instance.<ValidTo>k__BackingField = dataReader.GetDateTime(6);
                                (instance is IInjectableService) ? ((IInjectableService)instance).Injected(
                                    context: materializationContext1.Context, 
                                    entity: instance, 
                                    queryTrackingBehavior: TrackAll, 
                                    structuralType: [LIFTABLE Constant: EntityType: Tenant | Resolver: namelessParameter{2} => namelessParameter{2}.Dependencies.Model.FindEntityType("BillingSystem.Domain.Entities.Tenant")]) : default(void);
                                return instance;
                            }}
                    default: 
                        default(Tenant)
                }
                ;
                entry1 = entityType1 == default(IEntityType) ? default(InternalEntityEntry) : queryContext.StartTracking(
                    entityType: entityType1, 
                    entity: instance1, 
                    snapshot: shadowSnapshot1);
                return instance1;
            } : default(void);
            return instance1;
        };
        return entity;
    }, 
    contextType: BillingSystem.Infrastructure.EF.BillingServiceDBContext, 
    standAloneStateManager: False, 
    detailedErrorsEnabled: False, 
    threadSafetyChecksEnabled: True)'
2025-10-13 12:58:53.066 +03:00 [DBG] Creating DbConnection.
2025-10-13 12:58:53.084 +03:00 [DBG] Created DbConnection. (16ms).
2025-10-13 12:58:53.089 +03:00 [DBG] Opening connection to database 'GAC-BillingService' on server '.'.
2025-10-13 12:58:53.342 +03:00 [DBG] Opened connection to database 'GAC-BillingService' on server '.'.
2025-10-13 12:58:53.346 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-10-13 12:58:53.352 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (3ms).
2025-10-13 12:58:53.354 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (9ms).
2025-10-13 12:58:53.361 +03:00 [DBG] Executing DbCommand [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [t].[Id], [t].[IsDeleted], [t].[TenantGUID], [t].[TenantName], [t].[TenantStatus], [t].[ValidFrom], [t].[ValidTo]
FROM [Tenants] AS [t]
2025-10-13 12:58:53.394 +03:00 [INF] Executed DbCommand (33ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [t].[Id], [t].[IsDeleted], [t].[TenantGUID], [t].[TenantName], [t].[TenantStatus], [t].[ValidFrom], [t].[ValidTo]
FROM [Tenants] AS [t]
2025-10-13 12:58:53.433 +03:00 [DBG] Context 'BillingServiceDBContext' started tracking 'Tenant' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-10-13 12:58:53.467 +03:00 [DBG] Closing data reader to 'GAC-BillingService' on server '.'.
2025-10-13 12:58:53.475 +03:00 [DBG] A data reader for 'GAC-BillingService' on server '.' is being disposed after spending 74ms reading results.
2025-10-13 12:58:53.479 +03:00 [DBG] Closing connection to database 'GAC-BillingService' on server '.'.
2025-10-13 12:58:53.486 +03:00 [DBG] Closed connection to database 'GAC-BillingService' on server '.' (6ms).
2025-10-13 12:59:01.382 +03:00 [INF] Executing endpoint 'BillingSystem.API.Controllers.InvoicesController.Post (BillingSystem.API)'
2025-10-13 12:59:01.409 +03:00 [INF] Route matched with {action = "Post", controller = "Invoices"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Post(BillingSystem.Application.Requests.CreateInvoiceRequest) on controller BillingSystem.API.Controllers.InvoicesController (BillingSystem.API).
2025-10-13 12:59:01.414 +03:00 [DBG] Execution plan of authorization filters (in the following order): ["None"]
2025-10-13 12:59:01.415 +03:00 [DBG] Execution plan of resource filters (in the following order): ["None"]
2025-10-13 12:59:01.417 +03:00 [DBG] Execution plan of action filters (in the following order): ["Microsoft.AspNetCore.Mvc.ModelBinding.UnsupportedContentTypeFilter (Order: -3000)","Microsoft.AspNetCore.Mvc.Infrastructure.ModelStateInvalidFilter (Order: -2000)","BillingSystem.API.ActionFilters.AuditBillingRequestsFilter","BillingSystem.API.ActionFilters.IdempotencyFilter (Order: 0)"]
2025-10-13 12:59:01.419 +03:00 [DBG] Execution plan of exception filters (in the following order): ["None"]
2025-10-13 12:59:01.421 +03:00 [DBG] Execution plan of result filters (in the following order): ["Microsoft.AspNetCore.Mvc.Infrastructure.ClientErrorResultFilter (Order: -2000)","Microsoft.AspNetCore.Mvc.ProducesAttribute (Order: 0)","BillingSystem.API.ActionFilters.IdempotencyFilter (Order: 0)"]
2025-10-13 12:59:01.426 +03:00 [DBG] Executing controller factory for controller BillingSystem.API.Controllers.InvoicesController (BillingSystem.API)
2025-10-13 12:59:01.431 +03:00 [WRN] You do not have a valid license key for the Lucky Penny software MediatR. This is allowed for development and testing scenarios. If you are running in production you are required to have a licensed version. Please visit https://luckypennysoftware.com to obtain a valid license.
2025-10-13 12:59:01.452 +03:00 [DBG] Executed controller factory for controller BillingSystem.API.Controllers.InvoicesController (BillingSystem.API)
2025-10-13 12:59:01.466 +03:00 [DBG] Attempting to bind parameter 'invoiceRequest' of type 'BillingSystem.Application.Requests.CreateInvoiceRequest' ...
2025-10-13 12:59:01.469 +03:00 [DBG] Attempting to bind parameter 'invoiceRequest' of type 'BillingSystem.Application.Requests.CreateInvoiceRequest' using the name '' in request data ...
2025-10-13 12:59:01.472 +03:00 [DBG] Selected input formatter 'Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonInputFormatter' for content type 'application/json'.
2025-10-13 12:59:01.490 +03:00 [DBG] Connection id "0HNGA7RRS5V46", Request id "0HNGA7RRS5V46:00000001": started reading request body.
2025-10-13 12:59:01.492 +03:00 [DBG] Connection id "0HNGA7RRS5V46", Request id "0HNGA7RRS5V46:00000001": done reading request body.
2025-10-13 12:59:01.509 +03:00 [DBG] JSON input formatter succeeded, deserializing to type 'BillingSystem.Application.Requests.CreateInvoiceRequest'
2025-10-13 12:59:01.511 +03:00 [DBG] Done attempting to bind parameter 'invoiceRequest' of type 'BillingSystem.Application.Requests.CreateInvoiceRequest'.
2025-10-13 12:59:01.512 +03:00 [DBG] Done attempting to bind parameter 'invoiceRequest' of type 'BillingSystem.Application.Requests.CreateInvoiceRequest'.
2025-10-13 12:59:01.513 +03:00 [DBG] Attempting to validate the bound parameter 'invoiceRequest' of type 'BillingSystem.Application.Requests.CreateInvoiceRequest' ...
2025-10-13 12:59:01.528 +03:00 [DBG] Done attempting to validate the bound parameter 'invoiceRequest' of type 'BillingSystem.Application.Requests.CreateInvoiceRequest'.
2025-10-13 12:59:25.641 +03:00 [DBG] Compiling query expression: 
'DbSet<Invoice>()
    .AsNoTracking()
    .Any(inv => inv.ExternalId.ToString() == __idempotentKey_0)'
2025-10-13 12:59:25.735 +03:00 [DBG] Generated query execution expression: 
'queryContext => ShapedQueryCompilingExpressionVisitor.SingleAsync<bool>(
    asyncEnumerable: SingleQueryingEnumerable.Create<bool>(
        relationalQueryContext: (RelationalQueryContext)queryContext, 
        relationalCommandResolver: parameters => [LIFTABLE Constant: RelationalCommandCache.QueryExpression(
            Projection Mapping:
                EmptyProjectionMember -> 0
            SELECT EXISTS (
                SELECT 1
                FROM Invoices AS i
                WHERE COALESCE(CONVERT(varchar(36), i.ExternalId), '') == @__idempotentKey_0)) | Resolver: c => new RelationalCommandCache(
            c.Dependencies.MemoryCache, 
            c.RelationalDependencies.QuerySqlGeneratorFactory, 
            c.RelationalDependencies.RelationalParameterBasedSqlProcessorFactory, 
            Projection Mapping:
                EmptyProjectionMember -> 0
            SELECT EXISTS (
                SELECT 1
                FROM Invoices AS i
                WHERE COALESCE(CONVERT(varchar(36), i.ExternalId), '') == @__idempotentKey_0), 
            False, 
            new HashSet<string>(
                new string[]{ }, 
                StringComparer.Ordinal
            )
        )].GetRelationalCommandTemplate(parameters), 
        readerColumns: null, 
        shaper: (queryContext, dataReader, resultContext, resultCoordinator) => 
        {
            bool? value1;
            value1 = dataReader.IsDBNull(0) ? default(bool?) : (bool?)dataReader.GetBoolean(0);
            return (bool)value1;
        }, 
        contextType: BillingSystem.Infrastructure.EF.BillingServiceDBContext, 
        standAloneStateManager: False, 
        detailedErrorsEnabled: False, 
        threadSafetyChecksEnabled: True), 
    cancellationToken: queryContext.CancellationToken)'
2025-10-13 12:59:25.759 +03:00 [DBG] Opening connection to database 'GAC-BillingService' on server '.'.
2025-10-13 12:59:25.762 +03:00 [DBG] Opened connection to database 'GAC-BillingService' on server '.'.
2025-10-13 12:59:25.763 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-10-13 12:59:25.764 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (1ms).
2025-10-13 12:59:25.768 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (4ms).
2025-10-13 12:59:25.773 +03:00 [DBG] Executing DbCommand [Parameters=[@__idempotentKey_0='?' (Size = 36) (DbType = AnsiString)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [Invoices] AS [i]
        WHERE CONVERT(varchar(36), [i].[ExternalId]) = @__idempotentKey_0) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2025-10-13 12:59:25.802 +03:00 [INF] Executed DbCommand (31ms) [Parameters=[@__idempotentKey_0='?' (Size = 36) (DbType = AnsiString)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [Invoices] AS [i]
        WHERE CONVERT(varchar(36), [i].[ExternalId]) = @__idempotentKey_0) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2025-10-13 12:59:25.805 +03:00 [DBG] Closing data reader to 'GAC-BillingService' on server '.'.
2025-10-13 12:59:25.807 +03:00 [DBG] A data reader for 'GAC-BillingService' on server '.' is being disposed after spending 3ms reading results.
2025-10-13 12:59:25.809 +03:00 [DBG] Closing connection to database 'GAC-BillingService' on server '.'.
2025-10-13 12:59:25.810 +03:00 [DBG] Closed connection to database 'GAC-BillingService' on server '.' (1ms).
2025-10-13 13:00:28.709 +03:00 [DBG] List of registered output formatters, in the following order: ["Microsoft.AspNetCore.Mvc.Formatters.HttpNoContentOutputFormatter","Microsoft.AspNetCore.Mvc.Formatters.StringOutputFormatter","Microsoft.AspNetCore.Mvc.Formatters.StreamOutputFormatter","Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonOutputFormatter"]
2025-10-13 13:00:28.715 +03:00 [DBG] No information found on request to perform content negotiation.
2025-10-13 13:00:28.716 +03:00 [DBG] Attempting to select the first output formatter in the output formatters list which supports a content type from the explicitly specified content types '["application/json"]'.
2025-10-13 13:00:28.718 +03:00 [DBG] Selected output formatter 'Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonOutputFormatter' and content type 'application/json' to write the response.
2025-10-13 13:00:28.720 +03:00 [INF] Executing BadRequestObjectResult, writing value of type 'BillingSystem.SharedKernel.ApiResponse`1[[System.Int64, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-10-13 13:00:28.732 +03:00 [INF] Executed action BillingSystem.API.Controllers.InvoicesController.Post (BillingSystem.API) in 87303.6266ms
2025-10-13 13:00:28.734 +03:00 [INF] Executed endpoint 'BillingSystem.API.Controllers.InvoicesController.Post (BillingSystem.API)'
2025-10-13 13:00:28.735 +03:00 [INF] HTTP POST /api/Invoices responded 400 in 117105.6813 ms
2025-10-13 13:00:28.737 +03:00 [DBG] Connection id "0HNGA7RRS5V46" completed keep alive response.
2025-10-13 13:00:28.740 +03:00 [DBG] 'BillingServiceDBContext' disposed.
2025-10-13 13:00:28.746 +03:00 [DBG] Disposing connection to database 'GAC-BillingService' on server '.'.
2025-10-13 13:00:28.748 +03:00 [DBG] Disposed connection to database '' on server '' (2ms).
2025-10-13 13:00:28.750 +03:00 [INF] Request finished HTTP/1.1 POST https://localhost:7257/api/Invoices - 400 null application/json; charset=utf-8 117135.7277ms
2025-10-13 13:00:43.919 +03:00 [DBG] Connection id "0HNGA7RRS5V47" accepted.
2025-10-13 13:00:43.919 +03:00 [DBG] Connection id "0HNGA7RRS5V47" received FIN.
2025-10-13 13:00:43.921 +03:00 [DBG] Connection id "0HNGA7RRS5V47" started.
2025-10-13 13:00:43.922 +03:00 [DBG] Connection id "0HNGA7RRS5V48" accepted.
2025-10-13 13:00:43.926 +03:00 [DBG] Failed to authenticate HTTPS connection.
System.IO.IOException: Received an unexpected EOF or 0 bytes from the transport stream.
   at System.Net.Security.SslStream.ReceiveHandshakeFrameAsync[TIOAdapter](CancellationToken cancellationToken)
   at System.Net.Security.SslStream.ForceAuthenticationAsync[TIOAdapter](Boolean receiveFirst, Byte[] reAuthenticationData, CancellationToken cancellationToken)
   at System.Net.Security.SslStream.ProcessAuthenticationWithTelemetryAsync(Boolean isAsync, CancellationToken cancellationToken)
   at Microsoft.AspNetCore.Server.Kestrel.Https.Internal.HttpsConnectionMiddleware.OnConnectionAsync(ConnectionContext context)
2025-10-13 13:00:43.926 +03:00 [DBG] Connection id "0HNGA7RRS5V48" started.
2025-10-13 13:00:43.930 +03:00 [DBG] Connection id "0HNGA7RRS5V47" stopped.
2025-10-13 13:00:43.932 +03:00 [DBG] Connection id "0HNGA7RRS5V47" sending FIN because: "The Socket transport's send loop completed gracefully."
2025-10-13 13:00:43.934 +03:00 [DBG] Connection 0HNGA7RRS5V48 established using the following protocol: "Tls12"
2025-10-13 13:00:43.936 +03:00 [INF] Request starting HTTP/1.1 POST https://localhost:7257/api/Invoices - application/json 260
2025-10-13 13:00:43.938 +03:00 [DBG] 1 candidate(s) found for the request path '/api/Invoices'
2025-10-13 13:00:43.939 +03:00 [DBG] Endpoint 'BillingSystem.API.Controllers.InvoicesController.Post (BillingSystem.API)' with route pattern 'api/Invoices' is valid for the request path '/api/Invoices'
2025-10-13 13:00:43.941 +03:00 [DBG] Request matched endpoint 'BillingSystem.API.Controllers.InvoicesController.Post (BillingSystem.API)'
2025-10-13 13:00:43.943 +03:00 [DBG] Static files was skipped as the request already matched an endpoint.
2025-10-13 13:00:52.477 +03:00 [INF] Executing endpoint 'BillingSystem.API.Controllers.InvoicesController.Post (BillingSystem.API)'
2025-10-13 13:00:52.480 +03:00 [INF] Route matched with {action = "Post", controller = "Invoices"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Post(BillingSystem.Application.Requests.CreateInvoiceRequest) on controller BillingSystem.API.Controllers.InvoicesController (BillingSystem.API).
2025-10-13 13:00:52.483 +03:00 [DBG] Execution plan of authorization filters (in the following order): ["None"]
2025-10-13 13:00:52.485 +03:00 [DBG] Execution plan of resource filters (in the following order): ["None"]
2025-10-13 13:00:52.487 +03:00 [DBG] Execution plan of action filters (in the following order): ["Microsoft.AspNetCore.Mvc.ModelBinding.UnsupportedContentTypeFilter (Order: -3000)","Microsoft.AspNetCore.Mvc.Infrastructure.ModelStateInvalidFilter (Order: -2000)","BillingSystem.API.ActionFilters.AuditBillingRequestsFilter","BillingSystem.API.ActionFilters.IdempotencyFilter (Order: 0)"]
2025-10-13 13:00:52.490 +03:00 [DBG] Execution plan of exception filters (in the following order): ["None"]
2025-10-13 13:00:52.492 +03:00 [DBG] Execution plan of result filters (in the following order): ["Microsoft.AspNetCore.Mvc.Infrastructure.ClientErrorResultFilter (Order: -2000)","Microsoft.AspNetCore.Mvc.ProducesAttribute (Order: 0)","BillingSystem.API.ActionFilters.IdempotencyFilter (Order: 0)"]
2025-10-13 13:00:52.494 +03:00 [DBG] Executing controller factory for controller BillingSystem.API.Controllers.InvoicesController (BillingSystem.API)
2025-10-13 13:00:52.496 +03:00 [DBG] Executed controller factory for controller BillingSystem.API.Controllers.InvoicesController (BillingSystem.API)
2025-10-13 13:00:52.498 +03:00 [DBG] Attempting to bind parameter 'invoiceRequest' of type 'BillingSystem.Application.Requests.CreateInvoiceRequest' ...
2025-10-13 13:00:52.499 +03:00 [DBG] Attempting to bind parameter 'invoiceRequest' of type 'BillingSystem.Application.Requests.CreateInvoiceRequest' using the name '' in request data ...
2025-10-13 13:00:52.500 +03:00 [DBG] Selected input formatter 'Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonInputFormatter' for content type 'application/json'.
2025-10-13 13:00:52.502 +03:00 [DBG] Connection id "0HNGA7RRS5V48", Request id "0HNGA7RRS5V48:00000001": started reading request body.
2025-10-13 13:00:52.503 +03:00 [DBG] Connection id "0HNGA7RRS5V48", Request id "0HNGA7RRS5V48:00000001": done reading request body.
2025-10-13 13:00:52.505 +03:00 [DBG] JSON input formatter succeeded, deserializing to type 'BillingSystem.Application.Requests.CreateInvoiceRequest'
2025-10-13 13:00:52.505 +03:00 [DBG] Done attempting to bind parameter 'invoiceRequest' of type 'BillingSystem.Application.Requests.CreateInvoiceRequest'.
2025-10-13 13:00:52.507 +03:00 [DBG] Done attempting to bind parameter 'invoiceRequest' of type 'BillingSystem.Application.Requests.CreateInvoiceRequest'.
2025-10-13 13:00:52.508 +03:00 [DBG] Attempting to validate the bound parameter 'invoiceRequest' of type 'BillingSystem.Application.Requests.CreateInvoiceRequest' ...
2025-10-13 13:00:52.510 +03:00 [DBG] Done attempting to validate the bound parameter 'invoiceRequest' of type 'BillingSystem.Application.Requests.CreateInvoiceRequest'.
2025-10-13 13:01:17.941 +03:00 [DBG] Entity Framework Core 9.0.9 initialized 'BillingServiceDBContext' using provider 'Microsoft.EntityFrameworkCore.SqlServer:9.0.9' with options: EngineType=SqlServer 
2025-10-13 13:01:17.947 +03:00 [DBG] Creating DbConnection.
2025-10-13 13:01:17.948 +03:00 [DBG] Created DbConnection. (1ms).
2025-10-13 13:01:17.949 +03:00 [DBG] Opening connection to database 'GAC-BillingService' on server '.'.
2025-10-13 13:01:17.950 +03:00 [DBG] Opened connection to database 'GAC-BillingService' on server '.'.
2025-10-13 13:01:17.953 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-10-13 13:01:17.955 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (1ms).
2025-10-13 13:01:17.956 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (3ms).
2025-10-13 13:01:17.958 +03:00 [DBG] Executing DbCommand [Parameters=[@__idempotentKey_0='?' (Size = 36) (DbType = AnsiString)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [Invoices] AS [i]
        WHERE CONVERT(varchar(36), [i].[ExternalId]) = @__idempotentKey_0) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2025-10-13 13:01:17.961 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[@__idempotentKey_0='?' (Size = 36) (DbType = AnsiString)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [Invoices] AS [i]
        WHERE CONVERT(varchar(36), [i].[ExternalId]) = @__idempotentKey_0) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2025-10-13 13:01:17.964 +03:00 [DBG] Closing data reader to 'GAC-BillingService' on server '.'.
2025-10-13 13:01:17.965 +03:00 [DBG] A data reader for 'GAC-BillingService' on server '.' is being disposed after spending 1ms reading results.
2025-10-13 13:01:17.966 +03:00 [DBG] Closing connection to database 'GAC-BillingService' on server '.'.
2025-10-13 13:01:17.968 +03:00 [DBG] Closed connection to database 'GAC-BillingService' on server '.' (1ms).
2025-10-13 13:01:21.956 +03:00 [WRN] You do not have a valid license key for the Lucky Penny software AutoMapper. This is allowed for development and testing scenarios. If you are running in production you are required to have a licensed version. Please visit https://luckypennysoftware.com to obtain a valid license.
2025-10-13 13:01:25.154 +03:00 [DBG] Opening connection to database 'GAC-BillingService' on server '.'.
2025-10-13 13:01:25.156 +03:00 [DBG] Opened connection to database 'GAC-BillingService' on server '.'.
2025-10-13 13:01:25.162 +03:00 [DBG] Beginning transaction with isolation level 'Unspecified'.
2025-10-13 13:01:25.169 +03:00 [DBG] Began transaction with isolation level 'ReadCommitted'.
2025-10-13 13:01:28.394 +03:00 [DBG] 'BillingServiceDBContext' generated a temporary value for the property 'Invoice.Id'. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-10-13 13:01:28.443 +03:00 [DBG] Context 'BillingServiceDBContext' started tracking 'Invoice' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-10-13 13:01:29.055 +03:00 [DBG] SaveChanges starting for 'BillingServiceDBContext'.
2025-10-13 13:01:29.059 +03:00 [DBG] DetectChanges starting for 'BillingServiceDBContext'.
2025-10-13 13:01:29.081 +03:00 [DBG] DetectChanges completed for 'BillingServiceDBContext'.
2025-10-13 13:01:29.145 +03:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-10-13 13:01:29.149 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-10-13 13:01:29.150 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2025-10-13 13:01:29.153 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (4ms).
2025-10-13 13:01:29.155 +03:00 [DBG] Executing DbCommand [Parameters=[@p0='?' (Precision = 18) (DbType = Decimal), @p1='?' (Size = 50), @p2='?' (DbType = DateTime), @p3='?' (Size = 50), @p4='?' (DbType = DateTime), @p5='?' (DbType = Guid), @p6='?' (DbType = Int32), @p7='?' (DbType = Int32), @p8='?' (DbType = Boolean), @p9='?' (DbType = DateTime), @p10='?' (DbType = DateTime), @p11='?' (Size = 100), @p12='?' (Size = 100), @p13='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [Invoices] ([Amount], [CreatedBy], [CreatedDate], [Currency], [DueAt], [ExternalId], [InvoiceStatus], [InvoiceType], [IsDeleted], [IssuedAt], [LastUpdatedDate], [PaymentProvider], [PaymentReference], [TenantId])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13);
2025-10-13 13:01:29.162 +03:00 [INF] Executed DbCommand (8ms) [Parameters=[@p0='?' (Precision = 18) (DbType = Decimal), @p1='?' (Size = 50), @p2='?' (DbType = DateTime), @p3='?' (Size = 50), @p4='?' (DbType = DateTime), @p5='?' (DbType = Guid), @p6='?' (DbType = Int32), @p7='?' (DbType = Int32), @p8='?' (DbType = Boolean), @p9='?' (DbType = DateTime), @p10='?' (DbType = DateTime), @p11='?' (Size = 100), @p12='?' (Size = 100), @p13='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [Invoices] ([Amount], [CreatedBy], [CreatedDate], [Currency], [DueAt], [ExternalId], [InvoiceStatus], [InvoiceType], [IsDeleted], [IssuedAt], [LastUpdatedDate], [PaymentProvider], [PaymentReference], [TenantId])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13);
2025-10-13 13:01:29.193 +03:00 [DBG] The foreign key property 'Invoice.Id' was detected as changed. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see property values.
2025-10-13 13:01:29.201 +03:00 [DBG] Closing data reader to 'GAC-BillingService' on server '.'.
2025-10-13 13:01:29.203 +03:00 [DBG] A data reader for 'GAC-BillingService' on server '.' is being disposed after spending 37ms reading results.
2025-10-13 13:01:29.214 +03:00 [DBG] An entity of type 'Invoice' tracked by 'BillingServiceDBContext' changed state from '"Added"' to '"Unchanged"'. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-10-13 13:01:29.217 +03:00 [DBG] SaveChanges completed for 'BillingServiceDBContext' with 1 entities written to the database.
2025-10-13 13:01:30.837 +03:00 [DBG] 'BillingServiceDBContext' generated a temporary value for the property 'OutboxEvent.Id'. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-10-13 13:01:30.848 +03:00 [DBG] Context 'BillingServiceDBContext' started tracking 'OutboxEvent' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-10-13 13:01:31.446 +03:00 [DBG] SaveChanges starting for 'BillingServiceDBContext'.
2025-10-13 13:01:31.448 +03:00 [DBG] DetectChanges starting for 'BillingServiceDBContext'.
2025-10-13 13:01:31.454 +03:00 [DBG] DetectChanges completed for 'BillingServiceDBContext'.
2025-10-13 13:01:31.457 +03:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-10-13 13:01:31.458 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-10-13 13:01:31.459 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2025-10-13 13:01:31.460 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (2ms).
2025-10-13 13:01:31.461 +03:00 [DBG] Executing DbCommand [Parameters=[@p0='?' (DbType = Int64), @p1='?' (DbType = DateTime), @p2='?' (Size = 300), @p3='?' (Size = 4000), @p4='?' (DbType = Boolean)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [Outbox_events] ([Aggregate_id], [CreatedDate], [Event_type], [Payload], [Processed])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4);
2025-10-13 13:01:31.465 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[@p0='?' (DbType = Int64), @p1='?' (DbType = DateTime), @p2='?' (Size = 300), @p3='?' (Size = 4000), @p4='?' (DbType = Boolean)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [Outbox_events] ([Aggregate_id], [CreatedDate], [Event_type], [Payload], [Processed])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4);
2025-10-13 13:01:31.482 +03:00 [DBG] The foreign key property 'OutboxEvent.Id' was detected as changed. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see property values.
2025-10-13 13:01:31.484 +03:00 [DBG] Closing data reader to 'GAC-BillingService' on server '.'.
2025-10-13 13:01:31.485 +03:00 [DBG] A data reader for 'GAC-BillingService' on server '.' is being disposed after spending 4ms reading results.
2025-10-13 13:01:31.487 +03:00 [DBG] An entity of type 'OutboxEvent' tracked by 'BillingServiceDBContext' changed state from '"Added"' to '"Unchanged"'. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-10-13 13:01:31.489 +03:00 [DBG] SaveChanges completed for 'BillingServiceDBContext' with 1 entities written to the database.
2025-10-13 13:01:32.319 +03:00 [DBG] Committing transaction.
2025-10-13 13:01:32.337 +03:00 [DBG] Committed transaction.
2025-10-13 13:01:32.341 +03:00 [DBG] Closing connection to database 'GAC-BillingService' on server '.'.
2025-10-13 13:01:32.343 +03:00 [DBG] Closed connection to database 'GAC-BillingService' on server '.' (1ms).
2025-10-13 13:01:32.719 +03:00 [DBG] Disposing transaction.
2025-10-13 13:01:35.597 +03:00 [DBG] List of registered output formatters, in the following order: ["Microsoft.AspNetCore.Mvc.Formatters.HttpNoContentOutputFormatter","Microsoft.AspNetCore.Mvc.Formatters.StringOutputFormatter","Microsoft.AspNetCore.Mvc.Formatters.StreamOutputFormatter","Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonOutputFormatter"]
2025-10-13 13:01:35.601 +03:00 [DBG] No information found on request to perform content negotiation.
2025-10-13 13:01:35.602 +03:00 [DBG] Attempting to select the first output formatter in the output formatters list which supports a content type from the explicitly specified content types '["application/json"]'.
2025-10-13 13:01:35.603 +03:00 [DBG] Selected output formatter 'Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonOutputFormatter' and content type 'application/json' to write the response.
2025-10-13 13:01:35.604 +03:00 [INF] Executing OkObjectResult, writing value of type 'BillingSystem.SharedKernel.ApiResponse`1[[System.Int64, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-10-13 13:01:35.607 +03:00 [INF] Executed action BillingSystem.API.Controllers.InvoicesController.Post (BillingSystem.API) in 43113.3097ms
2025-10-13 13:01:35.609 +03:00 [INF] Executed endpoint 'BillingSystem.API.Controllers.InvoicesController.Post (BillingSystem.API)'
2025-10-13 13:01:35.611 +03:00 [INF] HTTP POST /api/Invoices responded 200 in 51666.7969 ms
2025-10-13 13:01:35.612 +03:00 [DBG] Connection id "0HNGA7RRS5V48" completed keep alive response.
2025-10-13 13:01:35.613 +03:00 [DBG] 'BillingServiceDBContext' disposed.
2025-10-13 13:01:35.614 +03:00 [DBG] Disposing connection to database 'GAC-BillingService' on server '.'.
2025-10-13 13:01:35.616 +03:00 [DBG] Disposed connection to database '' on server '' (1ms).
2025-10-13 13:01:35.617 +03:00 [INF] Request finished HTTP/1.1 POST https://localhost:7257/api/Invoices - 200 null application/json; charset=utf-8 51680.8969ms
2025-10-13 13:01:54.839 +03:00 [DBG] Connection id "0HNGA7RRS5V49" accepted.
2025-10-13 13:01:54.840 +03:00 [DBG] Connection id "0HNGA7RRS5V49" received FIN.
2025-10-13 13:01:54.841 +03:00 [DBG] Connection id "0HNGA7RRS5V49" started.
2025-10-13 13:01:54.842 +03:00 [DBG] Connection id "0HNGA7RRS5V4A" accepted.
2025-10-13 13:01:54.845 +03:00 [DBG] Connection id "0HNGA7RRS5V4A" started.
2025-10-13 13:01:54.845 +03:00 [DBG] Failed to authenticate HTTPS connection.
System.IO.IOException: Received an unexpected EOF or 0 bytes from the transport stream.
   at System.Net.Security.SslStream.ReceiveHandshakeFrameAsync[TIOAdapter](CancellationToken cancellationToken)
   at System.Net.Security.SslStream.ForceAuthenticationAsync[TIOAdapter](Boolean receiveFirst, Byte[] reAuthenticationData, CancellationToken cancellationToken)
   at System.Net.Security.SslStream.ProcessAuthenticationWithTelemetryAsync(Boolean isAsync, CancellationToken cancellationToken)
   at Microsoft.AspNetCore.Server.Kestrel.Https.Internal.HttpsConnectionMiddleware.OnConnectionAsync(ConnectionContext context)
2025-10-13 13:01:54.848 +03:00 [DBG] Connection id "0HNGA7RRS5V49" stopped.
2025-10-13 13:01:54.849 +03:00 [DBG] Connection 0HNGA7RRS5V4A established using the following protocol: "Tls12"
2025-10-13 13:01:54.849 +03:00 [DBG] Connection id "0HNGA7RRS5V49" sending FIN because: "The Socket transport's send loop completed gracefully."
2025-10-13 13:01:54.851 +03:00 [INF] Request starting HTTP/1.1 POST https://localhost:7257/api/Invoices - application/json 260
2025-10-13 13:01:54.854 +03:00 [DBG] 1 candidate(s) found for the request path '/api/Invoices'
2025-10-13 13:01:54.854 +03:00 [DBG] Endpoint 'BillingSystem.API.Controllers.InvoicesController.Post (BillingSystem.API)' with route pattern 'api/Invoices' is valid for the request path '/api/Invoices'
2025-10-13 13:01:54.856 +03:00 [DBG] Request matched endpoint 'BillingSystem.API.Controllers.InvoicesController.Post (BillingSystem.API)'
2025-10-13 13:01:54.856 +03:00 [DBG] Static files was skipped as the request already matched an endpoint.
2025-10-13 13:01:59.706 +03:00 [INF] Executing endpoint 'BillingSystem.API.Controllers.InvoicesController.Post (BillingSystem.API)'
2025-10-13 13:01:59.721 +03:00 [INF] Route matched with {action = "Post", controller = "Invoices"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Post(BillingSystem.Application.Requests.CreateInvoiceRequest) on controller BillingSystem.API.Controllers.InvoicesController (BillingSystem.API).
2025-10-13 13:01:59.727 +03:00 [DBG] Execution plan of authorization filters (in the following order): ["None"]
2025-10-13 13:01:59.729 +03:00 [DBG] Execution plan of resource filters (in the following order): ["None"]
2025-10-13 13:01:59.732 +03:00 [DBG] Execution plan of action filters (in the following order): ["Microsoft.AspNetCore.Mvc.ModelBinding.UnsupportedContentTypeFilter (Order: -3000)","Microsoft.AspNetCore.Mvc.Infrastructure.ModelStateInvalidFilter (Order: -2000)","BillingSystem.API.ActionFilters.AuditBillingRequestsFilter","BillingSystem.API.ActionFilters.IdempotencyFilter (Order: 0)"]
2025-10-13 13:01:59.746 +03:00 [DBG] Execution plan of exception filters (in the following order): ["None"]
2025-10-13 13:01:59.749 +03:00 [DBG] Execution plan of result filters (in the following order): ["Microsoft.AspNetCore.Mvc.Infrastructure.ClientErrorResultFilter (Order: -2000)","Microsoft.AspNetCore.Mvc.ProducesAttribute (Order: 0)","BillingSystem.API.ActionFilters.IdempotencyFilter (Order: 0)"]
2025-10-13 13:01:59.755 +03:00 [DBG] Executing controller factory for controller BillingSystem.API.Controllers.InvoicesController (BillingSystem.API)
2025-10-13 13:01:59.757 +03:00 [DBG] Executed controller factory for controller BillingSystem.API.Controllers.InvoicesController (BillingSystem.API)
2025-10-13 13:01:59.760 +03:00 [DBG] Attempting to bind parameter 'invoiceRequest' of type 'BillingSystem.Application.Requests.CreateInvoiceRequest' ...
2025-10-13 13:01:59.761 +03:00 [DBG] Attempting to bind parameter 'invoiceRequest' of type 'BillingSystem.Application.Requests.CreateInvoiceRequest' using the name '' in request data ...
2025-10-13 13:01:59.763 +03:00 [DBG] Selected input formatter 'Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonInputFormatter' for content type 'application/json'.
2025-10-13 13:01:59.767 +03:00 [DBG] Connection id "0HNGA7RRS5V4A", Request id "0HNGA7RRS5V4A:00000001": started reading request body.
2025-10-13 13:01:59.768 +03:00 [DBG] Connection id "0HNGA7RRS5V4A", Request id "0HNGA7RRS5V4A:00000001": done reading request body.
2025-10-13 13:01:59.769 +03:00 [DBG] JSON input formatter succeeded, deserializing to type 'BillingSystem.Application.Requests.CreateInvoiceRequest'
2025-10-13 13:01:59.770 +03:00 [DBG] Done attempting to bind parameter 'invoiceRequest' of type 'BillingSystem.Application.Requests.CreateInvoiceRequest'.
2025-10-13 13:01:59.771 +03:00 [DBG] Done attempting to bind parameter 'invoiceRequest' of type 'BillingSystem.Application.Requests.CreateInvoiceRequest'.
2025-10-13 13:01:59.772 +03:00 [DBG] Attempting to validate the bound parameter 'invoiceRequest' of type 'BillingSystem.Application.Requests.CreateInvoiceRequest' ...
2025-10-13 13:01:59.774 +03:00 [DBG] Done attempting to validate the bound parameter 'invoiceRequest' of type 'BillingSystem.Application.Requests.CreateInvoiceRequest'.
2025-10-13 13:02:12.229 +03:00 [DBG] Entity Framework Core 9.0.9 initialized 'BillingServiceDBContext' using provider 'Microsoft.EntityFrameworkCore.SqlServer:9.0.9' with options: EngineType=SqlServer 
2025-10-13 13:02:12.233 +03:00 [DBG] Creating DbConnection.
2025-10-13 13:02:12.234 +03:00 [DBG] Created DbConnection. (1ms).
2025-10-13 13:02:12.237 +03:00 [DBG] Opening connection to database 'GAC-BillingService' on server '.'.
2025-10-13 13:02:12.239 +03:00 [DBG] Opened connection to database 'GAC-BillingService' on server '.'.
2025-10-13 13:02:12.240 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-10-13 13:02:12.241 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (1ms).
2025-10-13 13:02:12.243 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (2ms).
2025-10-13 13:02:12.245 +03:00 [DBG] Executing DbCommand [Parameters=[@__idempotentKey_0='?' (Size = 36) (DbType = AnsiString)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [Invoices] AS [i]
        WHERE CONVERT(varchar(36), [i].[ExternalId]) = @__idempotentKey_0) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2025-10-13 13:02:12.248 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__idempotentKey_0='?' (Size = 36) (DbType = AnsiString)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [Invoices] AS [i]
        WHERE CONVERT(varchar(36), [i].[ExternalId]) = @__idempotentKey_0) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2025-10-13 13:02:12.251 +03:00 [DBG] Closing data reader to 'GAC-BillingService' on server '.'.
2025-10-13 13:02:12.252 +03:00 [DBG] A data reader for 'GAC-BillingService' on server '.' is being disposed after spending 1ms reading results.
2025-10-13 13:02:12.253 +03:00 [DBG] Closing connection to database 'GAC-BillingService' on server '.'.
2025-10-13 13:02:12.254 +03:00 [DBG] Closed connection to database 'GAC-BillingService' on server '.' (0ms).
2025-10-13 13:02:12.256 +03:00 [DBG] Request was short circuited at action filter 'BillingSystem.API.ActionFilters.IdempotencyFilter'.
2025-10-13 13:02:12.257 +03:00 [DBG] List of registered output formatters, in the following order: ["Microsoft.AspNetCore.Mvc.Formatters.HttpNoContentOutputFormatter","Microsoft.AspNetCore.Mvc.Formatters.StringOutputFormatter","Microsoft.AspNetCore.Mvc.Formatters.StreamOutputFormatter","Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonOutputFormatter"]
2025-10-13 13:02:12.259 +03:00 [DBG] No information found on request to perform content negotiation.
2025-10-13 13:02:12.260 +03:00 [DBG] Attempting to select the first output formatter in the output formatters list which supports a content type from the explicitly specified content types '["application/json"]'.
2025-10-13 13:02:12.261 +03:00 [DBG] Selected output formatter 'Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonOutputFormatter' and content type 'application/json' to write the response.
2025-10-13 13:02:12.262 +03:00 [INF] Executing ConflictObjectResult, writing value of type 'System.String'.
2025-10-13 13:02:12.263 +03:00 [INF] Executed action BillingSystem.API.Controllers.InvoicesController.Post (BillingSystem.API) in 12508.4812ms
2025-10-13 13:02:12.264 +03:00 [INF] Executed endpoint 'BillingSystem.API.Controllers.InvoicesController.Post (BillingSystem.API)'
2025-10-13 13:02:12.266 +03:00 [INF] HTTP POST /api/Invoices responded 409 in 17409.0100 ms
2025-10-13 13:02:12.267 +03:00 [DBG] Connection id "0HNGA7RRS5V4A" completed keep alive response.
2025-10-13 13:02:12.268 +03:00 [DBG] 'BillingServiceDBContext' disposed.
2025-10-13 13:02:12.269 +03:00 [DBG] Disposing connection to database 'GAC-BillingService' on server '.'.
2025-10-13 13:02:12.270 +03:00 [DBG] Disposed connection to database '' on server '' (1ms).
2025-10-13 13:02:12.272 +03:00 [INF] Request finished HTTP/1.1 POST https://localhost:7257/api/Invoices - 409 null application/json; charset=utf-8 17420.2167ms
2025-10-13 13:03:36.187 +03:00 [DBG] Connection id "0HNGA7RRS5V4B" received FIN.
2025-10-13 13:03:36.187 +03:00 [DBG] Connection id "0HNGA7RRS5V4C" accepted.
2025-10-13 13:03:36.190 +03:00 [DBG] Connection id "0HNGA7RRS5V4C" started.
2025-10-13 13:03:36.190 +03:00 [DBG] Connection id "0HNGA7RRS5V4D" accepted.
2025-10-13 13:03:36.192 +03:00 [DBG] Failed to authenticate HTTPS connection.
System.IO.IOException: Received an unexpected EOF or 0 bytes from the transport stream.
   at System.Net.Security.SslStream.ReceiveHandshakeFrameAsync[TIOAdapter](CancellationToken cancellationToken)
   at System.Net.Security.SslStream.ForceAuthenticationAsync[TIOAdapter](Boolean receiveFirst, Byte[] reAuthenticationData, CancellationToken cancellationToken)
   at System.Net.Security.SslStream.ProcessAuthenticationWithTelemetryAsync(Boolean isAsync, CancellationToken cancellationToken)
   at Microsoft.AspNetCore.Server.Kestrel.Https.Internal.HttpsConnectionMiddleware.OnConnectionAsync(ConnectionContext context)
2025-10-13 13:03:36.192 +03:00 [DBG] Connection id "0HNGA7RRS5V4D" started.
2025-10-13 13:03:36.195 +03:00 [DBG] Connection id "0HNGA7RRS5V4C" stopped.
2025-10-13 13:03:36.196 +03:00 [DBG] Connection id "0HNGA7RRS5V4C" sending FIN because: "The Socket transport's send loop completed gracefully."
2025-10-13 13:03:36.200 +03:00 [DBG] Connection 0HNGA7RRS5V4D established using the following protocol: "Tls12"
2025-10-13 13:03:36.201 +03:00 [INF] Request starting HTTP/1.1 POST https://localhost:7257/api/Invoices - application/json 260
2025-10-13 13:03:36.203 +03:00 [DBG] 1 candidate(s) found for the request path '/api/Invoices'
2025-10-13 13:03:36.204 +03:00 [DBG] Endpoint 'BillingSystem.API.Controllers.InvoicesController.Post (BillingSystem.API)' with route pattern 'api/Invoices' is valid for the request path '/api/Invoices'
2025-10-13 13:03:36.205 +03:00 [DBG] Request matched endpoint 'BillingSystem.API.Controllers.InvoicesController.Post (BillingSystem.API)'
2025-10-13 13:03:36.206 +03:00 [DBG] Static files was skipped as the request already matched an endpoint.
2025-10-13 13:03:39.254 +03:00 [INF] Executing endpoint 'BillingSystem.API.Controllers.InvoicesController.Post (BillingSystem.API)'
2025-10-13 13:03:39.259 +03:00 [INF] Route matched with {action = "Post", controller = "Invoices"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Post(BillingSystem.Application.Requests.CreateInvoiceRequest) on controller BillingSystem.API.Controllers.InvoicesController (BillingSystem.API).
2025-10-13 13:03:39.264 +03:00 [DBG] Execution plan of authorization filters (in the following order): ["None"]
2025-10-13 13:03:39.265 +03:00 [DBG] Execution plan of resource filters (in the following order): ["None"]
2025-10-13 13:03:39.267 +03:00 [DBG] Execution plan of action filters (in the following order): ["Microsoft.AspNetCore.Mvc.ModelBinding.UnsupportedContentTypeFilter (Order: -3000)","Microsoft.AspNetCore.Mvc.Infrastructure.ModelStateInvalidFilter (Order: -2000)","BillingSystem.API.ActionFilters.AuditBillingRequestsFilter","BillingSystem.API.ActionFilters.IdempotencyFilter (Order: 0)"]
2025-10-13 13:03:39.270 +03:00 [DBG] Execution plan of exception filters (in the following order): ["None"]
2025-10-13 13:03:39.273 +03:00 [DBG] Execution plan of result filters (in the following order): ["Microsoft.AspNetCore.Mvc.Infrastructure.ClientErrorResultFilter (Order: -2000)","Microsoft.AspNetCore.Mvc.ProducesAttribute (Order: 0)","BillingSystem.API.ActionFilters.IdempotencyFilter (Order: 0)"]
2025-10-13 13:03:39.275 +03:00 [DBG] Executing controller factory for controller BillingSystem.API.Controllers.InvoicesController (BillingSystem.API)
2025-10-13 13:03:39.278 +03:00 [DBG] Executed controller factory for controller BillingSystem.API.Controllers.InvoicesController (BillingSystem.API)
2025-10-13 13:03:39.280 +03:00 [DBG] Attempting to bind parameter 'invoiceRequest' of type 'BillingSystem.Application.Requests.CreateInvoiceRequest' ...
2025-10-13 13:03:39.281 +03:00 [DBG] Attempting to bind parameter 'invoiceRequest' of type 'BillingSystem.Application.Requests.CreateInvoiceRequest' using the name '' in request data ...
2025-10-13 13:03:39.282 +03:00 [DBG] Selected input formatter 'Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonInputFormatter' for content type 'application/json'.
2025-10-13 13:03:39.284 +03:00 [DBG] Connection id "0HNGA7RRS5V4D", Request id "0HNGA7RRS5V4D:00000001": started reading request body.
2025-10-13 13:03:39.284 +03:00 [DBG] Connection id "0HNGA7RRS5V4D", Request id "0HNGA7RRS5V4D:00000001": done reading request body.
2025-10-13 13:03:39.286 +03:00 [DBG] JSON input formatter succeeded, deserializing to type 'BillingSystem.Application.Requests.CreateInvoiceRequest'
2025-10-13 13:03:39.287 +03:00 [DBG] Done attempting to bind parameter 'invoiceRequest' of type 'BillingSystem.Application.Requests.CreateInvoiceRequest'.
2025-10-13 13:03:39.289 +03:00 [DBG] Done attempting to bind parameter 'invoiceRequest' of type 'BillingSystem.Application.Requests.CreateInvoiceRequest'.
2025-10-13 13:03:39.290 +03:00 [DBG] Attempting to validate the bound parameter 'invoiceRequest' of type 'BillingSystem.Application.Requests.CreateInvoiceRequest' ...
2025-10-13 13:03:39.292 +03:00 [DBG] Done attempting to validate the bound parameter 'invoiceRequest' of type 'BillingSystem.Application.Requests.CreateInvoiceRequest'.
2025-10-13 13:03:42.595 +03:00 [DBG] Entity Framework Core 9.0.9 initialized 'BillingServiceDBContext' using provider 'Microsoft.EntityFrameworkCore.SqlServer:9.0.9' with options: EngineType=SqlServer 
2025-10-13 13:03:42.599 +03:00 [DBG] Creating DbConnection.
2025-10-13 13:03:42.599 +03:00 [DBG] Created DbConnection. (0ms).
2025-10-13 13:03:42.600 +03:00 [DBG] Opening connection to database 'GAC-BillingService' on server '.'.
2025-10-13 13:03:42.601 +03:00 [DBG] Opened connection to database 'GAC-BillingService' on server '.'.
2025-10-13 13:03:42.602 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-10-13 13:03:42.603 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2025-10-13 13:03:42.604 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (1ms).
2025-10-13 13:03:42.605 +03:00 [DBG] Executing DbCommand [Parameters=[@__idempotentKey_0='?' (Size = 36) (DbType = AnsiString)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [Invoices] AS [i]
        WHERE CONVERT(varchar(36), [i].[ExternalId]) = @__idempotentKey_0) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2025-10-13 13:03:42.609 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__idempotentKey_0='?' (Size = 36) (DbType = AnsiString)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [Invoices] AS [i]
        WHERE CONVERT(varchar(36), [i].[ExternalId]) = @__idempotentKey_0) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2025-10-13 13:03:42.615 +03:00 [DBG] Closing data reader to 'GAC-BillingService' on server '.'.
2025-10-13 13:03:42.616 +03:00 [DBG] A data reader for 'GAC-BillingService' on server '.' is being disposed after spending 1ms reading results.
2025-10-13 13:03:42.617 +03:00 [DBG] Closing connection to database 'GAC-BillingService' on server '.'.
2025-10-13 13:03:42.619 +03:00 [DBG] Closed connection to database 'GAC-BillingService' on server '.' (1ms).
2025-10-13 13:03:42.621 +03:00 [DBG] Request was short circuited at action filter 'BillingSystem.API.ActionFilters.IdempotencyFilter'.
2025-10-13 13:03:42.623 +03:00 [DBG] List of registered output formatters, in the following order: ["Microsoft.AspNetCore.Mvc.Formatters.HttpNoContentOutputFormatter","Microsoft.AspNetCore.Mvc.Formatters.StringOutputFormatter","Microsoft.AspNetCore.Mvc.Formatters.StreamOutputFormatter","Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonOutputFormatter"]
2025-10-13 13:03:42.625 +03:00 [DBG] No information found on request to perform content negotiation.
2025-10-13 13:03:42.626 +03:00 [DBG] Attempting to select the first output formatter in the output formatters list which supports a content type from the explicitly specified content types '["application/json"]'.
2025-10-13 13:03:42.628 +03:00 [DBG] Selected output formatter 'Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonOutputFormatter' and content type 'application/json' to write the response.
2025-10-13 13:03:42.630 +03:00 [INF] Executing ConflictObjectResult, writing value of type 'System.String'.
2025-10-13 13:03:42.631 +03:00 [INF] Executed action BillingSystem.API.Controllers.InvoicesController.Post (BillingSystem.API) in 3355.4057ms
2025-10-13 13:03:42.632 +03:00 [INF] Executed endpoint 'BillingSystem.API.Controllers.InvoicesController.Post (BillingSystem.API)'
2025-10-13 13:03:42.633 +03:00 [INF] HTTP POST /api/Invoices responded 409 in 6427.1092 ms
2025-10-13 13:03:42.635 +03:00 [DBG] Connection id "0HNGA7RRS5V4D" completed keep alive response.
2025-10-13 13:03:42.635 +03:00 [DBG] 'BillingServiceDBContext' disposed.
2025-10-13 13:03:42.636 +03:00 [DBG] Disposing connection to database 'GAC-BillingService' on server '.'.
2025-10-13 13:03:42.638 +03:00 [DBG] Disposed connection to database '' on server '' (1ms).
2025-10-13 13:03:42.639 +03:00 [INF] Request finished HTTP/1.1 POST https://localhost:7257/api/Invoices - 409 null application/json; charset=utf-8 6437.9265ms
