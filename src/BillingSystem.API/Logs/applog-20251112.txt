2025-11-12 15:33:33.892 +03:00 [DBG] Registered model binder providers, in the following order: ["Microsoft.AspNetCore.Mvc.ModelBinding.Binders.BinderTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ServicesModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.BodyModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.HeaderModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FloatingPointTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.EnumTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.DateTimeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.SimpleTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.TryParseModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.CancellationTokenModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ByteArrayModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FormFileModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FormCollectionModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.KeyValuePairModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.DictionaryModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ArrayModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.CollectionModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ComplexObjectModelBinderProvider"]
2025-11-12 15:33:34.078 +03:00 [DBG] Hosting starting
2025-11-12 15:33:34.474 +03:00 [DBG] Starting bus instances: IBus
2025-11-12 15:33:34.483 +03:00 [DBG] Starting bus: "rabbitmq://localhost/"
2025-11-12 15:33:34.516 +03:00 [DBG] Middleware loaded
2025-11-12 15:33:34.521 +03:00 [DBG] Middleware loaded. Script /_framework/aspnetcore-browser-refresh.js (16519 B).
2025-11-12 15:33:34.531 +03:00 [DBG] Middleware loaded. Script /_framework/blazor-hotreload.js (799 B).
2025-11-12 15:33:34.544 +03:00 [DBG] Connect: guest@localhost:5672/
2025-11-12 15:33:34.757 +03:00 [DBG] Connected: guest@localhost:5672/ (address: amqp://localhost:5672, local: 49268)
2025-11-12 15:33:34.817 +03:00 [DBG] Middleware loaded: DOTNET_MODIFIABLE_ASSEMBLIES=debug, __ASPNETCORE_BROWSER_TOOLS=true
2025-11-12 15:33:34.839 +03:00 [DBG] Endpoint Ready: "rabbitmq://localhost/ECHGHANNAMLP1_BillingSystemAPI_bus_fuxoyyyh3bcsbnppbdxnd371bp?temporary=true"
2025-11-12 15:33:34.843 +03:00 [INF] Bus started: "rabbitmq://localhost/"
2025-11-12 15:33:35.120 +03:00 [INF] Now listening on: https://localhost:7257
2025-11-12 15:33:35.125 +03:00 [INF] Now listening on: http://localhost:5009
2025-11-12 15:33:35.127 +03:00 [DBG] Loaded hosting startup assembly BillingSystem.API
2025-11-12 15:33:35.130 +03:00 [DBG] Loaded hosting startup assembly Microsoft.WebTools.ApiEndpointDiscovery
2025-11-12 15:33:35.135 +03:00 [DBG] Loaded hosting startup assembly Microsoft.AspNetCore.Watch.BrowserRefresh
2025-11-12 15:33:35.139 +03:00 [DBG] Loaded hosting startup assembly Microsoft.WebTools.BrowserLink.Net
2025-11-12 15:33:35.286 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-11-12 15:33:35.288 +03:00 [INF] Hosting environment: Development
2025-11-12 15:33:35.291 +03:00 [INF] Content root path: C:\Repositories\Gac-BillingSystem\src\BillingSystem.API
2025-11-12 15:33:35.293 +03:00 [DBG] Hosting started
2025-11-12 15:33:35.429 +03:00 [DBG] Connection id "0HNH1SUPCUPSH" accepted.
2025-11-12 15:33:35.436 +03:00 [DBG] Connection id "0HNH1SUPCUPSH" started.
2025-11-12 15:33:35.464 +03:00 [DBG] Connection id "0HNH1SUPCUPSH" received FIN.
2025-11-12 15:33:35.491 +03:00 [DBG] Failed to authenticate HTTPS connection.
System.IO.IOException: Received an unexpected EOF or 0 bytes from the transport stream.
   at System.Net.Security.SslStream.ReceiveHandshakeFrameAsync[TIOAdapter](CancellationToken cancellationToken)
   at System.Net.Security.SslStream.ForceAuthenticationAsync[TIOAdapter](Boolean receiveFirst, Byte[] reAuthenticationData, CancellationToken cancellationToken)
   at System.Net.Security.SslStream.ProcessAuthenticationWithTelemetryAsync(Boolean isAsync, CancellationToken cancellationToken)
   at Microsoft.AspNetCore.Server.Kestrel.Https.Internal.HttpsConnectionMiddleware.OnConnectionAsync(ConnectionContext context)
2025-11-12 15:33:35.537 +03:00 [DBG] Connection id "0HNH1SUPCUPSH" stopped.
2025-11-12 15:33:35.551 +03:00 [DBG] Connection id "0HNH1SUPCUPSH" sending FIN because: "The Socket transport's send loop completed gracefully."
2025-11-12 15:33:36.281 +03:00 [DBG] Connection id "0HNH1SUPCUPSI" accepted.
2025-11-12 15:33:36.286 +03:00 [DBG] Connection id "0HNH1SUPCUPSI" started.
2025-11-12 15:33:36.287 +03:00 [DBG] Connection id "0HNH1SUPCUPSJ" accepted.
2025-11-12 15:33:36.297 +03:00 [DBG] Connection id "0HNH1SUPCUPSJ" started.
2025-11-12 15:33:36.369 +03:00 [DBG] Connection id "0HNH1SUPCUPSI" received FIN.
2025-11-12 15:33:36.388 +03:00 [DBG] Connection 0HNH1SUPCUPSJ established using the following protocol: "Tls13"
2025-11-12 15:33:36.388 +03:00 [DBG] Connection 0HNH1SUPCUPSI established using the following protocol: "Tls13"
2025-11-12 15:33:36.411 +03:00 [DBG] Connection id "0HNH1SUPCUPSI" is closed. The last processed stream ID was 0.
2025-11-12 15:33:36.415 +03:00 [DBG] Connection id "0HNH1SUPCUPSI" sending FIN because: "The Socket transport's send loop completed gracefully."
2025-11-12 15:33:36.422 +03:00 [DBG] The connection queue processing loop for 0HNH1SUPCUPSI completed.
2025-11-12 15:33:36.428 +03:00 [DBG] Connection id "0HNH1SUPCUPSI" stopped.
2025-11-12 15:33:36.483 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7257/swagger - null null
2025-11-12 15:33:36.576 +03:00 [DBG] Wildcard detected, all requests with hosts will be allowed.
2025-11-12 15:33:36.609 +03:00 [DBG] No candidates found for the request path '/swagger'
2025-11-12 15:33:36.615 +03:00 [DBG] Request did not match any endpoints
2025-11-12 15:33:36.634 +03:00 [INF] HTTP GET /swagger responded 301 in 7.7832 ms
2025-11-12 15:33:36.649 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7257/swagger - 301 0 null 177.8811ms
2025-11-12 15:33:36.659 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7257/swagger/index.html - null null
2025-11-12 15:33:36.672 +03:00 [DBG] No candidates found for the request path '/swagger/index.html'
2025-11-12 15:33:36.675 +03:00 [DBG] Request did not match any endpoints
2025-11-12 15:33:36.754 +03:00 [DBG] Response markup is scheduled to include Browser Link script injection.
2025-11-12 15:33:36.759 +03:00 [DBG] Response markup is scheduled to include browser refresh script injection.
2025-11-12 15:33:36.789 +03:00 [INF] HTTP GET /swagger/index.html responded 200 in 110.8026 ms
2025-11-12 15:33:36.798 +03:00 [DBG] Response markup was updated to include Browser Link script injection.
2025-11-12 15:33:36.801 +03:00 [DBG] Response markup was updated to include browser refresh script injection.
2025-11-12 15:33:36.804 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7257/swagger/index.html - 200 null text/html;charset=utf-8 145.7995ms
2025-11-12 15:33:36.821 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7257/swagger/swagger-ui.css - null null
2025-11-12 15:33:36.826 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7257/swagger/swagger-ui-bundle.js - null null
2025-11-12 15:33:36.828 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7257/_framework/aspnetcore-browser-refresh.js - null null
2025-11-12 15:33:36.827 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7257/swagger/swagger-ui-standalone-preset.js - null null
2025-11-12 15:33:36.870 +03:00 [DBG] Script injected: /_framework/aspnetcore-browser-refresh.js
2025-11-12 15:33:36.844 +03:00 [DBG] No candidates found for the request path '/swagger/swagger-ui-bundle.js'
2025-11-12 15:33:36.871 +03:00 [DBG] No candidates found for the request path '/swagger/swagger-ui-standalone-preset.js'
2025-11-12 15:33:36.875 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7257/_framework/aspnetcore-browser-refresh.js - 200 16519 application/javascript; charset=utf-8 47.3261ms
2025-11-12 15:33:36.878 +03:00 [DBG] Request did not match any endpoints
2025-11-12 15:33:36.881 +03:00 [DBG] Request did not match any endpoints
2025-11-12 15:33:36.836 +03:00 [DBG] No candidates found for the request path '/swagger/swagger-ui.css'
2025-11-12 15:33:36.854 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7257/_vs/browserLink - null null
2025-11-12 15:33:36.896 +03:00 [DBG] Request did not match any endpoints
2025-11-12 15:33:36.950 +03:00 [INF] Sending file. Request path: '/swagger-ui.css'. Physical path: 'N/A'
2025-11-12 15:33:36.950 +03:00 [INF] Sending file. Request path: '/swagger-ui-standalone-preset.js'. Physical path: 'N/A'
2025-11-12 15:33:36.955 +03:00 [INF] HTTP GET /swagger/swagger-ui.css responded 200 in 48.8538 ms
2025-11-12 15:33:36.961 +03:00 [INF] HTTP GET /swagger/swagger-ui-standalone-preset.js responded 200 in 67.2693 ms
2025-11-12 15:33:36.967 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7257/swagger/swagger-ui.css - 200 152034 text/css 146.2351ms
2025-11-12 15:33:36.975 +03:00 [INF] Sending file. Request path: '/swagger-ui-bundle.js'. Physical path: 'N/A'
2025-11-12 15:33:36.974 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7257/swagger/swagger-ui-standalone-preset.js - 200 230280 text/javascript 147.1826ms
2025-11-12 15:33:36.984 +03:00 [INF] HTTP GET /swagger/swagger-ui-bundle.js responded 200 in 90.7921 ms
2025-11-12 15:33:36.998 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7257/swagger/swagger-ui-bundle.js - 200 1456926 text/javascript 172.3064ms
2025-11-12 15:33:37.007 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7257/_vs/browserLink - 200 null text/javascript; charset=UTF-8 153.7039ms
2025-11-12 15:33:37.144 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7257/swagger/v1/swagger.json - null null
2025-11-12 15:33:37.153 +03:00 [DBG] No candidates found for the request path '/swagger/v1/swagger.json'
2025-11-12 15:33:37.156 +03:00 [DBG] Request did not match any endpoints
2025-11-12 15:33:37.176 +03:00 [INF] HTTP GET /swagger/v1/swagger.json responded 200 in 18.8712 ms
2025-11-12 15:33:37.183 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7257/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 39.3735ms
2025-11-12 15:33:37.263 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7257/swagger/favicon-32x32.png - null null
2025-11-12 15:33:37.276 +03:00 [DBG] No candidates found for the request path '/swagger/favicon-32x32.png'
2025-11-12 15:33:37.282 +03:00 [DBG] Request did not match any endpoints
2025-11-12 15:33:37.285 +03:00 [INF] Sending file. Request path: '/favicon-32x32.png'. Physical path: 'N/A'
2025-11-12 15:33:37.290 +03:00 [INF] HTTP GET /swagger/favicon-32x32.png responded 200 in 5.4172 ms
2025-11-12 15:33:37.297 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7257/swagger/favicon-32x32.png - 200 628 image/png 33.8201ms
2025-11-12 15:47:30.638 +03:00 [DBG] Connection id "0HNH1SUPCUPSK" accepted.
2025-11-12 15:47:30.639 +03:00 [DBG] Connection id "0HNH1SUPCUPSK" received FIN.
2025-11-12 15:47:30.655 +03:00 [DBG] Connection id "0HNH1SUPCUPSK" started.
2025-11-12 15:47:30.655 +03:00 [DBG] Connection id "0HNH1SUPCUPSL" accepted.
2025-11-12 15:47:30.685 +03:00 [DBG] Failed to authenticate HTTPS connection.
System.IO.IOException: Received an unexpected EOF or 0 bytes from the transport stream.
   at System.Net.Security.SslStream.ReceiveHandshakeFrameAsync[TIOAdapter](CancellationToken cancellationToken)
   at System.Net.Security.SslStream.ForceAuthenticationAsync[TIOAdapter](Boolean receiveFirst, Byte[] reAuthenticationData, CancellationToken cancellationToken)
   at System.Net.Security.SslStream.ProcessAuthenticationWithTelemetryAsync(Boolean isAsync, CancellationToken cancellationToken)
   at Microsoft.AspNetCore.Server.Kestrel.Https.Internal.HttpsConnectionMiddleware.OnConnectionAsync(ConnectionContext context)
2025-11-12 15:47:30.686 +03:00 [DBG] Connection id "0HNH1SUPCUPSL" started.
2025-11-12 15:47:30.690 +03:00 [DBG] Connection id "0HNH1SUPCUPSK" stopped.
2025-11-12 15:47:30.695 +03:00 [DBG] Connection id "0HNH1SUPCUPSK" sending FIN because: "The Socket transport's send loop completed gracefully."
2025-11-12 15:47:30.700 +03:00 [DBG] Connection 0HNH1SUPCUPSL established using the following protocol: "Tls13"
2025-11-12 15:47:30.710 +03:00 [INF] Request starting HTTP/1.1 POST https://localhost:7257/api/Invoices - application/json 1316
2025-11-12 15:47:30.724 +03:00 [DBG] 1 candidate(s) found for the request path '/api/Invoices'
2025-11-12 15:47:30.735 +03:00 [DBG] Endpoint 'BillingSystem.API.Controllers.InvoicesController.Post (BillingSystem.API)' with route pattern 'api/Invoices' is valid for the request path '/api/Invoices'
2025-11-12 15:47:30.740 +03:00 [DBG] Request matched endpoint 'BillingSystem.API.Controllers.InvoicesController.Post (BillingSystem.API)'
2025-11-12 15:47:30.746 +03:00 [DBG] Static files was skipped as the request already matched an endpoint.
2025-11-12 15:47:31.569 +03:00 [DBG] An 'IServiceProvider' was created for internal use by Entity Framework.
2025-11-12 15:47:37.416 +03:00 [DBG] No relationship from 'Invoice' to 'Invoice' has been configured by convention because there are multiple properties on one entity type - {'DiscountedPrimaryInvoice'} that could be matched with the properties on the other entity type - {'InverseDiscountedPrimaryInvoice', 'InversePrimaryInvoice', 'InverseSubstitutionPrimaryInvoice', 'PrimaryInvoice', 'SubstitutionPrimaryInvoice'}. This message can be disregarded if explicit configuration has been specified in 'OnModelCreating'.
2025-11-12 15:47:37.648 +03:00 [DBG] No relationship from 'Invoice' to 'Invoice' has been configured by convention because there are multiple properties on one entity type - {'DiscountedPrimaryInvoice'} that could be matched with the properties on the other entity type - {'InverseDiscountedPrimaryInvoice', 'InversePrimaryInvoice', 'InverseSubstitutionPrimaryInvoice', 'PrimaryInvoice', 'SubstitutionPrimaryInvoice'}. This message can be disregarded if explicit configuration has been specified in 'OnModelCreating'.
2025-11-12 15:47:37.662 +03:00 [DBG] No relationship from 'Invoice' to 'Invoice' has been configured by convention because there are multiple properties on one entity type - {'InversePrimaryInvoice'} that could be matched with the properties on the other entity type - {'InverseSubstitutionPrimaryInvoice', 'PrimaryInvoice', 'SubstitutionPrimaryInvoice'}. This message can be disregarded if explicit configuration has been specified in 'OnModelCreating'.
2025-11-12 15:47:37.670 +03:00 [DBG] No relationship from 'Invoice' to 'Invoice' has been configured by convention because there are multiple properties on one entity type - {'InversePrimaryInvoice'} that could be matched with the properties on the other entity type - {'InverseSubstitutionPrimaryInvoice', 'PrimaryInvoice', 'SubstitutionPrimaryInvoice'}. This message can be disregarded if explicit configuration has been specified in 'OnModelCreating'.
2025-11-12 15:47:38.019 +03:00 [DBG] Entity Framework Core 9.0.9 initialized 'BillingServiceDBContext' using provider 'Microsoft.EntityFrameworkCore.SqlServer:9.0.9' with options: EngineType=SqlServer 
2025-11-12 15:47:38.141 +03:00 [DBG] Compiling query expression: 
'DbSet<Tenant>()'
2025-11-12 15:47:38.504 +03:00 [DBG] Generated query execution expression: 
'queryContext => SingleQueryingEnumerable.Create<Tenant>(
    relationalQueryContext: (RelationalQueryContext)queryContext, 
    relationalCommandResolver: parameters => [LIFTABLE Constant: RelationalCommandCache.QueryExpression(
        Projection Mapping:
            EmptyProjectionMember -> Dictionary<IProperty, int> { [Property: Tenant.Id (int) Required PK AfterSave:Throw ValueGenerated.OnAdd, 0], [Property: Tenant.IsDeleted (bool) Required, 1], [Property: Tenant.TenantGuid (Guid) Required, 2], [Property: Tenant.TenantName (string) Required MaxLength(100), 3], [Property: Tenant.TenantStatus (int) Required, 4], [Property: Tenant.ValidFrom (DateTime) Required, 5], [Property: Tenant.ValidTo (DateTime) Required, 6] }
        SELECT t.Id, t.IsDeleted, t.TenantGUID, t.TenantName, t.TenantStatus, t.ValidFrom, t.ValidTo
        FROM Tenants AS t) | Resolver: c => new RelationalCommandCache(
        c.Dependencies.MemoryCache, 
        c.RelationalDependencies.QuerySqlGeneratorFactory, 
        c.RelationalDependencies.RelationalParameterBasedSqlProcessorFactory, 
        Projection Mapping:
            EmptyProjectionMember -> Dictionary<IProperty, int> { [Property: Tenant.Id (int) Required PK AfterSave:Throw ValueGenerated.OnAdd, 0], [Property: Tenant.IsDeleted (bool) Required, 1], [Property: Tenant.TenantGuid (Guid) Required, 2], [Property: Tenant.TenantName (string) Required MaxLength(100), 3], [Property: Tenant.TenantStatus (int) Required, 4], [Property: Tenant.ValidFrom (DateTime) Required, 5], [Property: Tenant.ValidTo (DateTime) Required, 6] }
        SELECT t.Id, t.IsDeleted, t.TenantGUID, t.TenantName, t.TenantStatus, t.ValidFrom, t.ValidTo
        FROM Tenants AS t, 
        False, 
        new HashSet<string>(
            new string[]{ }, 
            StringComparer.Ordinal
        )
    )].GetRelationalCommandTemplate(parameters), 
    readerColumns: null, 
    shaper: (queryContext, dataReader, resultContext, resultCoordinator) => 
    {
        Tenant entity;
        entity = 
        {
            MaterializationContext materializationContext1;
            IEntityType entityType1;
            Tenant instance1;
            InternalEntityEntry entry1;
            bool hasNullKey1;
            materializationContext1 = new MaterializationContext(
                [LIFTABLE Constant: ValueBuffer | Resolver: _ => (object)ValueBuffer.Empty], 
                queryContext.Context
            );
            instance1 = default(Tenant);
            entry1 = queryContext.TryGetEntry(
                key: [LIFTABLE Constant: Key: Tenant.Id PK | Resolver: c => c.Dependencies.Model.FindEntityType("BillingSystem.Domain.Entities.Tenant").FindPrimaryKey()], 
                keyValues: new object[]{ (object)dataReader.GetInt32(0) }, 
                throwOnNullKey: True, 
                hasNullKey: hasNullKey1);
            !(hasNullKey1) ? entry1 != default(InternalEntityEntry) ? 
            {
                entityType1 = entry1.EntityType;
                return instance1 = (Tenant)entry1.Entity;
            } : 
            {
                ISnapshot shadowSnapshot1;
                shadowSnapshot1 = [LIFTABLE Constant: Snapshot | Resolver: _ => Snapshot.Empty];
                entityType1 = [LIFTABLE Constant: EntityType: Tenant | Resolver: namelessParameter{0} => namelessParameter{0}.Dependencies.Model.FindEntityType("BillingSystem.Domain.Entities.Tenant")];
                instance1 = switch (entityType1)
                {
                    case [LIFTABLE Constant: EntityType: Tenant | Resolver: namelessParameter{1} => namelessParameter{1}.Dependencies.Model.FindEntityType("BillingSystem.Domain.Entities.Tenant")]: 
                        {
                            return 
                            {
                                Tenant instance;
                                instance = new Tenant();
                                instance.<Id>k__BackingField = dataReader.GetInt32(0);
                                instance.<IsDeleted>k__BackingField = dataReader.GetBoolean(1);
                                instance.<TenantGuid>k__BackingField = dataReader.GetGuid(2);
                                instance.<TenantName>k__BackingField = dataReader.GetString(3);
                                instance.<TenantStatus>k__BackingField = dataReader.GetInt32(4);
                                instance.<ValidFrom>k__BackingField = dataReader.GetDateTime(5);
                                instance.<ValidTo>k__BackingField = dataReader.GetDateTime(6);
                                (instance is IInjectableService) ? ((IInjectableService)instance).Injected(
                                    context: materializationContext1.Context, 
                                    entity: instance, 
                                    queryTrackingBehavior: TrackAll, 
                                    structuralType: [LIFTABLE Constant: EntityType: Tenant | Resolver: namelessParameter{2} => namelessParameter{2}.Dependencies.Model.FindEntityType("BillingSystem.Domain.Entities.Tenant")]) : default(void);
                                return instance;
                            }}
                    default: 
                        default(Tenant)
                }
                ;
                entry1 = entityType1 == default(IEntityType) ? default(InternalEntityEntry) : queryContext.StartTracking(
                    entityType: entityType1, 
                    entity: instance1, 
                    snapshot: shadowSnapshot1);
                return instance1;
            } : default(void);
            return instance1;
        };
        return entity;
    }, 
    contextType: BillingSystem.Infrastructure.EF.BillingServiceDBContext, 
    standAloneStateManager: False, 
    detailedErrorsEnabled: False, 
    threadSafetyChecksEnabled: True)'
2025-11-12 15:47:38.542 +03:00 [DBG] Creating DbConnection.
2025-11-12 15:47:38.570 +03:00 [DBG] Created DbConnection. (23ms).
2025-11-12 15:47:38.578 +03:00 [DBG] Opening connection to database 'GAC-BillingService' on server '.'.
2025-11-12 15:47:39.318 +03:00 [DBG] Opened connection to database 'GAC-BillingService' on server '.'.
2025-11-12 15:47:39.329 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-11-12 15:47:39.340 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (10ms).
2025-11-12 15:47:39.351 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (22ms).
2025-11-12 15:47:39.377 +03:00 [DBG] Executing DbCommand [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [t].[Id], [t].[IsDeleted], [t].[TenantGUID], [t].[TenantName], [t].[TenantStatus], [t].[ValidFrom], [t].[ValidTo]
FROM [Tenants] AS [t]
2025-11-12 15:47:39.490 +03:00 [INF] Executed DbCommand (113ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [t].[Id], [t].[IsDeleted], [t].[TenantGUID], [t].[TenantName], [t].[TenantStatus], [t].[ValidFrom], [t].[ValidTo]
FROM [Tenants] AS [t]
2025-11-12 15:47:39.583 +03:00 [DBG] Context 'BillingServiceDBContext' started tracking 'Tenant' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-11-12 15:47:39.654 +03:00 [DBG] Context 'BillingServiceDBContext' started tracking 'Tenant' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-11-12 15:47:39.672 +03:00 [DBG] Closing data reader to 'GAC-BillingService' on server '.'.
2025-11-12 15:47:39.692 +03:00 [DBG] A data reader for 'GAC-BillingService' on server '.' is being disposed after spending 180ms reading results.
2025-11-12 15:47:39.705 +03:00 [DBG] Closing connection to database 'GAC-BillingService' on server '.'.
2025-11-12 15:47:39.725 +03:00 [DBG] Closed connection to database 'GAC-BillingService' on server '.' (19ms).
2025-11-12 15:47:39.945 +03:00 [INF] Executing endpoint 'BillingSystem.API.Controllers.InvoicesController.Post (BillingSystem.API)'
2025-11-12 15:47:40.012 +03:00 [INF] Route matched with {action = "Post", controller = "Invoices"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Post(BillingSystem.Application.Requests.CreateInvoiceRequest) on controller BillingSystem.API.Controllers.InvoicesController (BillingSystem.API).
2025-11-12 15:47:40.025 +03:00 [DBG] Execution plan of authorization filters (in the following order): ["None"]
2025-11-12 15:47:40.033 +03:00 [DBG] Execution plan of resource filters (in the following order): ["None"]
2025-11-12 15:47:40.043 +03:00 [DBG] Execution plan of action filters (in the following order): ["Microsoft.AspNetCore.Mvc.ModelBinding.UnsupportedContentTypeFilter (Order: -3000)","Microsoft.AspNetCore.Mvc.Infrastructure.ModelStateInvalidFilter (Order: -2000)","BillingSystem.API.ActionFilters.AuditBillingRequestsFilter","BillingSystem.API.ActionFilters.IdempotencyFilter (Order: 0)"]
2025-11-12 15:47:40.054 +03:00 [DBG] Execution plan of exception filters (in the following order): ["None"]
2025-11-12 15:47:40.062 +03:00 [DBG] Execution plan of result filters (in the following order): ["Microsoft.AspNetCore.Mvc.Infrastructure.ClientErrorResultFilter (Order: -2000)","Microsoft.AspNetCore.Mvc.ProducesAttribute (Order: 0)","BillingSystem.API.ActionFilters.IdempotencyFilter (Order: 0)"]
2025-11-12 15:47:40.078 +03:00 [DBG] Executing controller factory for controller BillingSystem.API.Controllers.InvoicesController (BillingSystem.API)
2025-11-12 15:47:40.087 +03:00 [WRN] You do not have a valid license key for the Lucky Penny software MediatR. This is allowed for development and testing scenarios. If you are running in production you are required to have a licensed version. Please visit https://luckypennysoftware.com to obtain a valid license.
2025-11-12 15:47:40.161 +03:00 [DBG] Executed controller factory for controller BillingSystem.API.Controllers.InvoicesController (BillingSystem.API)
2025-11-12 15:47:40.218 +03:00 [DBG] Attempting to bind parameter 'invoiceRequest' of type 'BillingSystem.Application.Requests.CreateInvoiceRequest' ...
2025-11-12 15:47:40.231 +03:00 [DBG] Attempting to bind parameter 'invoiceRequest' of type 'BillingSystem.Application.Requests.CreateInvoiceRequest' using the name '' in request data ...
2025-11-12 15:47:40.240 +03:00 [DBG] Selected input formatter 'Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonInputFormatter' for content type 'application/json'.
2025-11-12 15:47:40.310 +03:00 [DBG] Connection id "0HNH1SUPCUPSL", Request id "0HNH1SUPCUPSL:00000001": started reading request body.
2025-11-12 15:47:40.314 +03:00 [DBG] Connection id "0HNH1SUPCUPSL", Request id "0HNH1SUPCUPSL:00000001": done reading request body.
2025-11-12 15:47:40.363 +03:00 [DBG] JSON input formatter succeeded, deserializing to type 'BillingSystem.Application.Requests.CreateInvoiceRequest'
2025-11-12 15:47:40.369 +03:00 [DBG] Done attempting to bind parameter 'invoiceRequest' of type 'BillingSystem.Application.Requests.CreateInvoiceRequest'.
2025-11-12 15:47:40.372 +03:00 [DBG] Done attempting to bind parameter 'invoiceRequest' of type 'BillingSystem.Application.Requests.CreateInvoiceRequest'.
2025-11-12 15:47:40.376 +03:00 [DBG] Attempting to validate the bound parameter 'invoiceRequest' of type 'BillingSystem.Application.Requests.CreateInvoiceRequest' ...
2025-11-12 15:47:40.424 +03:00 [DBG] Done attempting to validate the bound parameter 'invoiceRequest' of type 'BillingSystem.Application.Requests.CreateInvoiceRequest'.
2025-11-12 15:47:40.495 +03:00 [DBG] Compiling query expression: 
'DbSet<Invoice>()
    .AsNoTracking()
    .Any(inv => inv.ExternalId.ToString() == __idempotentKey_0)'
2025-11-12 15:47:40.681 +03:00 [DBG] Generated query execution expression: 
'queryContext => ShapedQueryCompilingExpressionVisitor.SingleAsync<bool>(
    asyncEnumerable: SingleQueryingEnumerable.Create<bool>(
        relationalQueryContext: (RelationalQueryContext)queryContext, 
        relationalCommandResolver: parameters => [LIFTABLE Constant: RelationalCommandCache.QueryExpression(
            Projection Mapping:
                EmptyProjectionMember -> 0
            SELECT EXISTS (
                SELECT 1
                FROM Invoices AS i
                WHERE COALESCE(CONVERT(varchar(36), i.ExternalId), '') == @__idempotentKey_0)) | Resolver: c => new RelationalCommandCache(
            c.Dependencies.MemoryCache, 
            c.RelationalDependencies.QuerySqlGeneratorFactory, 
            c.RelationalDependencies.RelationalParameterBasedSqlProcessorFactory, 
            Projection Mapping:
                EmptyProjectionMember -> 0
            SELECT EXISTS (
                SELECT 1
                FROM Invoices AS i
                WHERE COALESCE(CONVERT(varchar(36), i.ExternalId), '') == @__idempotentKey_0), 
            False, 
            new HashSet<string>(
                new string[]{ }, 
                StringComparer.Ordinal
            )
        )].GetRelationalCommandTemplate(parameters), 
        readerColumns: null, 
        shaper: (queryContext, dataReader, resultContext, resultCoordinator) => 
        {
            bool? value1;
            value1 = dataReader.IsDBNull(0) ? default(bool?) : (bool?)dataReader.GetBoolean(0);
            return (bool)value1;
        }, 
        contextType: BillingSystem.Infrastructure.EF.BillingServiceDBContext, 
        standAloneStateManager: False, 
        detailedErrorsEnabled: False, 
        threadSafetyChecksEnabled: True), 
    cancellationToken: queryContext.CancellationToken)'
2025-11-12 15:47:40.722 +03:00 [DBG] Opening connection to database 'GAC-BillingService' on server '.'.
2025-11-12 15:47:40.730 +03:00 [DBG] Opened connection to database 'GAC-BillingService' on server '.'.
2025-11-12 15:47:40.734 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-11-12 15:47:40.738 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (3ms).
2025-11-12 15:47:40.749 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (14ms).
2025-11-12 15:47:40.760 +03:00 [DBG] Executing DbCommand [Parameters=[@__idempotentKey_0='?' (Size = 36) (DbType = AnsiString)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [Invoices] AS [i]
        WHERE CONVERT(varchar(36), [i].[ExternalId]) = @__idempotentKey_0) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2025-11-12 15:47:40.910 +03:00 [INF] Executed DbCommand (156ms) [Parameters=[@__idempotentKey_0='?' (Size = 36) (DbType = AnsiString)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [Invoices] AS [i]
        WHERE CONVERT(varchar(36), [i].[ExternalId]) = @__idempotentKey_0) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2025-11-12 15:47:40.923 +03:00 [DBG] Closing data reader to 'GAC-BillingService' on server '.'.
2025-11-12 15:47:40.929 +03:00 [DBG] A data reader for 'GAC-BillingService' on server '.' is being disposed after spending 10ms reading results.
2025-11-12 15:47:40.934 +03:00 [DBG] Closing connection to database 'GAC-BillingService' on server '.'.
2025-11-12 15:47:40.939 +03:00 [DBG] Closed connection to database 'GAC-BillingService' on server '.' (4ms).
2025-11-12 15:47:41.224 +03:00 [WRN] You do not have a valid license key for the Lucky Penny software AutoMapper. This is allowed for development and testing scenarios. If you are running in production you are required to have a licensed version. Please visit https://luckypennysoftware.com to obtain a valid license.
2025-11-12 15:47:53.765 +03:00 [DBG] Opening connection to database 'GAC-BillingService' on server '.'.
2025-11-12 15:47:53.771 +03:00 [DBG] Opened connection to database 'GAC-BillingService' on server '.'.
2025-11-12 15:47:53.777 +03:00 [DBG] Beginning transaction with isolation level 'Unspecified'.
2025-11-12 15:47:53.805 +03:00 [DBG] Began transaction with isolation level 'ReadCommitted'.
2025-11-12 15:47:54.972 +03:00 [DBG] Compiling query expression: 
'SqlQuery<long>(SELECT CAST(NEXT VALUE FOR dbo.InvoiceNumberSequence AS BIGINT) AS Value, __p_0)
    .First()'
2025-11-12 15:47:54.985 +03:00 [WRN] The query uses the 'First'/'FirstOrDefault' operator without 'OrderBy' and filter operators. This may lead to unpredictable results.
2025-11-12 15:47:54.998 +03:00 [DBG] Generated query execution expression: 
'queryContext => ShapedQueryCompilingExpressionVisitor.SingleAsync<long>(
    asyncEnumerable: SingleQueryingEnumerable.Create<long>(
        relationalQueryContext: (RelationalQueryContext)queryContext, 
        relationalCommandResolver: parameters => [LIFTABLE Constant: RelationalCommandCache.QueryExpression(
            Projection Mapping:
                EmptyProjectionMember -> 0
            SELECT TOP(1) s.Value
            FROM SELECT CAST(NEXT VALUE FOR dbo.InvoiceNumberSequence AS BIGINT) AS Value) | Resolver: c => new RelationalCommandCache(
            c.Dependencies.MemoryCache, 
            c.RelationalDependencies.QuerySqlGeneratorFactory, 
            c.RelationalDependencies.RelationalParameterBasedSqlProcessorFactory, 
            Projection Mapping:
                EmptyProjectionMember -> 0
            SELECT TOP(1) s.Value
            FROM SELECT CAST(NEXT VALUE FOR dbo.InvoiceNumberSequence AS BIGINT) AS Value, 
            False, 
            new HashSet<string>(
                new string[]{ }, 
                StringComparer.Ordinal
            )
        )].GetRelationalCommandTemplate(parameters), 
        readerColumns: null, 
        shaper: (queryContext, dataReader, resultContext, resultCoordinator) => 
        {
            long? value1;
            value1 = dataReader.IsDBNull(0) ? default(long?) : (long?)dataReader.GetInt64(0);
            return (long)value1;
        }, 
        contextType: BillingSystem.Infrastructure.EF.BillingServiceDBContext, 
        standAloneStateManager: False, 
        detailedErrorsEnabled: False, 
        threadSafetyChecksEnabled: True), 
    cancellationToken: queryContext.CancellationToken)'
2025-11-12 15:47:55.015 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-11-12 15:47:55.021 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (5ms).
2025-11-12 15:47:55.029 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (14ms).
2025-11-12 15:47:55.033 +03:00 [DBG] Executing DbCommand [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [s].[Value]
FROM (
    SELECT CAST(NEXT VALUE FOR dbo.InvoiceNumberSequence AS BIGINT) AS Value
) AS [s]
2025-11-12 15:47:55.076 +03:00 [ERR] Failed executing DbCommand (42ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [s].[Value]
FROM (
    SELECT CAST(NEXT VALUE FOR dbo.InvoiceNumberSequence AS BIGINT) AS Value
) AS [s]
2025-11-12 15:47:55.101 +03:00 [ERR] An exception occurred while iterating over the results of a query for context type 'BillingSystem.Infrastructure.EF.BillingServiceDBContext'.
Microsoft.Data.SqlClient.SqlException (0x80131904): NEXT VALUE FOR function is not allowed in check constraints, default objects, computed columns, views, user-defined functions, user-defined aggregates, user-defined table types, sub-queries, common table expressions, derived tables or return statements.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__211_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.InitializeReaderAsync(AsyncEnumerator enumerator, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()
ClientConnectionId:034c9893-d345-4f86-8345-01a1f7c2c664
Error Number:11719,State:1,Class:15
Microsoft.Data.SqlClient.SqlException (0x80131904): NEXT VALUE FOR function is not allowed in check constraints, default objects, computed columns, views, user-defined functions, user-defined aggregates, user-defined table types, sub-queries, common table expressions, derived tables or return statements.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__211_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.InitializeReaderAsync(AsyncEnumerator enumerator, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()
ClientConnectionId:034c9893-d345-4f86-8345-01a1f7c2c664
Error Number:11719,State:1,Class:15
2025-11-12 15:48:20.564 +03:00 [ERR] exception occured NEXT VALUE FOR function is not allowed in check constraints, default objects, computed columns, views, user-defined functions, user-defined aggregates, user-defined table types, sub-queries, common table expressions, derived tables or return statements. , stackTrace    at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__211_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.InitializeReaderAsync(AsyncEnumerator enumerator, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()
   at Microsoft.EntityFrameworkCore.Query.ShapedQueryCompilingExpressionVisitor.SingleAsync[TSource](IAsyncEnumerable`1 asyncEnumerable, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.ShapedQueryCompilingExpressionVisitor.SingleAsync[TSource](IAsyncEnumerable`1 asyncEnumerable, CancellationToken cancellationToken)
   at BillingSystem.Infrastructure.Persistence.EF.InvoiceRepository.Insert(Invoice entity) in C:\Repositories\Gac-BillingSystem\src\BillingSystem.Infrastructure\Persistence\EF\InvoiceRepository.cs:line 61
2025-11-12 15:48:20.838 +03:00 [DBG] Rolling back transaction.
2025-11-12 15:48:20.850 +03:00 [DBG] Rolled back transaction.
2025-11-12 15:48:20.857 +03:00 [DBG] Closing connection to database 'GAC-BillingService' on server '.'.
2025-11-12 15:48:20.863 +03:00 [DBG] Closed connection to database 'GAC-BillingService' on server '.' (5ms).
2025-11-12 15:48:21.149 +03:00 [DBG] Disposing transaction.
2025-11-12 15:48:21.258 +03:00 [ERR] exception occured NEXT VALUE FOR function is not allowed in check constraints, default objects, computed columns, views, user-defined functions, user-defined aggregates, user-defined table types, sub-queries, common table expressions, derived tables or return statements. , stackTrace    at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__211_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.InitializeReaderAsync(AsyncEnumerator enumerator, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()
   at Microsoft.EntityFrameworkCore.Query.ShapedQueryCompilingExpressionVisitor.SingleAsync[TSource](IAsyncEnumerable`1 asyncEnumerable, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.ShapedQueryCompilingExpressionVisitor.SingleAsync[TSource](IAsyncEnumerable`1 asyncEnumerable, CancellationToken cancellationToken)
   at BillingSystem.Infrastructure.Persistence.EF.InvoiceRepository.Insert(Invoice entity) in C:\Repositories\Gac-BillingSystem\src\BillingSystem.Infrastructure\Persistence\EF\InvoiceRepository.cs:line 61
   at BillingSystem.Application.Commands.CreateInvoiceCommandRequestHandler.Handle(CreateInvoiceRequest request, CancellationToken cancellationToken) in C:\Repositories\Gac-BillingSystem\src\BillingSystem.Application\Commands\CreateInvoiceCommandRequestHandler.cs:line 39
   at BillingSystem.API.Controllers.InvoicesController.Post(CreateInvoiceRequest invoiceRequest) in C:\Repositories\Gac-BillingSystem\src\BillingSystem.API\Controllers\InvoicesController.cs:line 45
2025-11-12 15:48:21.291 +03:00 [DBG] List of registered output formatters, in the following order: ["Microsoft.AspNetCore.Mvc.Formatters.HttpNoContentOutputFormatter","Microsoft.AspNetCore.Mvc.Formatters.StringOutputFormatter","Microsoft.AspNetCore.Mvc.Formatters.StreamOutputFormatter","Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonOutputFormatter"]
2025-11-12 15:48:21.301 +03:00 [DBG] No information found on request to perform content negotiation.
2025-11-12 15:48:21.306 +03:00 [DBG] Attempting to select the first output formatter in the output formatters list which supports a content type from the explicitly specified content types '["application/json","application/problem+json","application/problem+xml"]'.
2025-11-12 15:48:21.315 +03:00 [DBG] Selected output formatter 'Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonOutputFormatter' and content type 'application/json' to write the response.
2025-11-12 15:48:21.321 +03:00 [INF] Executing ObjectResult, writing value of type 'Microsoft.AspNetCore.Mvc.ProblemDetails'.
2025-11-12 15:48:21.374 +03:00 [INF] Executed action BillingSystem.API.Controllers.InvoicesController.Post (BillingSystem.API) in 41295.8253ms
2025-11-12 15:48:21.380 +03:00 [INF] Executed endpoint 'BillingSystem.API.Controllers.InvoicesController.Post (BillingSystem.API)'
2025-11-12 15:48:21.385 +03:00 [ERR] HTTP POST /api/Invoices responded 500 in 50638.2229 ms
2025-11-12 15:48:21.391 +03:00 [DBG] Connection id "0HNH1SUPCUPSL" completed keep alive response.
2025-11-12 15:48:21.396 +03:00 [DBG] 'BillingServiceDBContext' disposed.
2025-11-12 15:48:21.402 +03:00 [DBG] Disposing connection to database 'GAC-BillingService' on server '.'.
2025-11-12 15:48:21.408 +03:00 [DBG] Disposed connection to database '' on server '' (5ms).
2025-11-12 15:48:21.414 +03:00 [INF] Request finished HTTP/1.1 POST https://localhost:7257/api/Invoices - 500 null application/json; charset=utf-8 50703.4953ms
2025-11-12 15:50:10.368 +03:00 [DBG] Registered model binder providers, in the following order: ["Microsoft.AspNetCore.Mvc.ModelBinding.Binders.BinderTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ServicesModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.BodyModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.HeaderModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FloatingPointTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.EnumTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.DateTimeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.SimpleTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.TryParseModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.CancellationTokenModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ByteArrayModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FormFileModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FormCollectionModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.KeyValuePairModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.DictionaryModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ArrayModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.CollectionModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ComplexObjectModelBinderProvider"]
2025-11-12 15:50:10.565 +03:00 [DBG] Hosting starting
2025-11-12 15:50:10.995 +03:00 [DBG] Starting bus instances: IBus
2025-11-12 15:50:11.005 +03:00 [DBG] Starting bus: "rabbitmq://localhost/"
2025-11-12 15:50:11.043 +03:00 [DBG] Middleware loaded
2025-11-12 15:50:11.053 +03:00 [DBG] Middleware loaded. Script /_framework/aspnetcore-browser-refresh.js (16519 B).
2025-11-12 15:50:11.073 +03:00 [DBG] Middleware loaded. Script /_framework/blazor-hotreload.js (799 B).
2025-11-12 15:50:11.078 +03:00 [DBG] Connect: guest@localhost:5672/
2025-11-12 15:50:11.245 +03:00 [DBG] Middleware loaded: DOTNET_MODIFIABLE_ASSEMBLIES=debug, __ASPNETCORE_BROWSER_TOOLS=true
2025-11-12 15:50:11.266 +03:00 [DBG] Connected: guest@localhost:5672/ (address: amqp://localhost:5672, local: 49779)
2025-11-12 15:50:11.344 +03:00 [DBG] Endpoint Ready: "rabbitmq://localhost/ECHGHANNAMLP1_BillingSystemAPI_bus_a1woyyyh3bcsy6msbdxnd4orbr?temporary=true"
2025-11-12 15:50:11.352 +03:00 [INF] Bus started: "rabbitmq://localhost/"
2025-11-12 15:50:11.609 +03:00 [INF] Now listening on: https://localhost:7257
2025-11-12 15:50:11.614 +03:00 [INF] Now listening on: http://localhost:5009
2025-11-12 15:50:11.617 +03:00 [DBG] Loaded hosting startup assembly BillingSystem.API
2025-11-12 15:50:11.619 +03:00 [DBG] Loaded hosting startup assembly Microsoft.WebTools.ApiEndpointDiscovery
2025-11-12 15:50:11.621 +03:00 [DBG] Loaded hosting startup assembly Microsoft.AspNetCore.Watch.BrowserRefresh
2025-11-12 15:50:11.624 +03:00 [DBG] Loaded hosting startup assembly Microsoft.WebTools.BrowserLink.Net
2025-11-12 15:50:11.731 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-11-12 15:50:11.736 +03:00 [INF] Hosting environment: Development
2025-11-12 15:50:11.739 +03:00 [INF] Content root path: C:\Repositories\Gac-BillingSystem\src\BillingSystem.API
2025-11-12 15:50:11.741 +03:00 [DBG] Hosting started
2025-11-12 15:50:11.973 +03:00 [DBG] Connection id "0HNH1T82CNQOT" received FIN.
2025-11-12 15:50:11.973 +03:00 [DBG] Connection id "0HNH1T82CNQOU" received FIN.
2025-11-12 15:50:11.980 +03:00 [DBG] Connection id "0HNH1T82CNQOT" accepted.
2025-11-12 15:50:11.980 +03:00 [DBG] Connection id "0HNH1T82CNQOU" accepted.
2025-11-12 15:50:12.001 +03:00 [DBG] Connection id "0HNH1T82CNQOT" started.
2025-11-12 15:50:12.005 +03:00 [DBG] Connection id "0HNH1T82CNQOU" started.
2025-11-12 15:50:12.044 +03:00 [DBG] Failed to authenticate HTTPS connection.
System.IO.IOException: Received an unexpected EOF or 0 bytes from the transport stream.
   at System.Net.Security.SslStream.ReceiveHandshakeFrameAsync[TIOAdapter](CancellationToken cancellationToken)
   at System.Net.Security.SslStream.ForceAuthenticationAsync[TIOAdapter](Boolean receiveFirst, Byte[] reAuthenticationData, CancellationToken cancellationToken)
   at System.Net.Security.SslStream.ProcessAuthenticationWithTelemetryAsync(Boolean isAsync, CancellationToken cancellationToken)
   at Microsoft.AspNetCore.Server.Kestrel.Https.Internal.HttpsConnectionMiddleware.OnConnectionAsync(ConnectionContext context)
2025-11-12 15:50:12.044 +03:00 [DBG] Failed to authenticate HTTPS connection.
System.IO.IOException: Received an unexpected EOF or 0 bytes from the transport stream.
   at System.Net.Security.SslStream.ReceiveHandshakeFrameAsync[TIOAdapter](CancellationToken cancellationToken)
   at System.Net.Security.SslStream.ForceAuthenticationAsync[TIOAdapter](Boolean receiveFirst, Byte[] reAuthenticationData, CancellationToken cancellationToken)
   at System.Net.Security.SslStream.ProcessAuthenticationWithTelemetryAsync(Boolean isAsync, CancellationToken cancellationToken)
   at Microsoft.AspNetCore.Server.Kestrel.Https.Internal.HttpsConnectionMiddleware.OnConnectionAsync(ConnectionContext context)
2025-11-12 15:50:12.085 +03:00 [DBG] Connection id "0HNH1T82CNQOU" stopped.
2025-11-12 15:50:12.086 +03:00 [DBG] Connection id "0HNH1T82CNQOT" stopped.
2025-11-12 15:50:12.098 +03:00 [DBG] Connection id "0HNH1T82CNQOU" sending FIN because: "The Socket transport's send loop completed gracefully."
2025-11-12 15:50:12.098 +03:00 [DBG] Connection id "0HNH1T82CNQOT" sending FIN because: "The Socket transport's send loop completed gracefully."
2025-11-12 15:50:12.671 +03:00 [DBG] Connection id "0HNH1T82CNQOV" accepted.
2025-11-12 15:50:12.674 +03:00 [DBG] Connection id "0HNH1T82CNQOV" started.
2025-11-12 15:50:12.734 +03:00 [DBG] Connection 0HNH1T82CNQOV established using the following protocol: "Tls13"
2025-11-12 15:50:12.817 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7257/swagger/index.html - null null
2025-11-12 15:50:12.875 +03:00 [DBG] Wildcard detected, all requests with hosts will be allowed.
2025-11-12 15:50:12.895 +03:00 [DBG] No candidates found for the request path '/swagger/index.html'
2025-11-12 15:50:12.901 +03:00 [DBG] Request did not match any endpoints
2025-11-12 15:50:12.974 +03:00 [DBG] Response markup is scheduled to include Browser Link script injection.
2025-11-12 15:50:12.980 +03:00 [DBG] Response markup is scheduled to include browser refresh script injection.
2025-11-12 15:50:13.010 +03:00 [INF] HTTP GET /swagger/index.html responded 200 in 99.2198 ms
2025-11-12 15:50:13.020 +03:00 [DBG] Response markup was updated to include Browser Link script injection.
2025-11-12 15:50:13.025 +03:00 [DBG] Response markup was updated to include browser refresh script injection.
2025-11-12 15:50:13.033 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7257/swagger/index.html - 200 null text/html;charset=utf-8 227.3394ms
2025-11-12 15:50:13.109 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7257/_vs/browserLink - null null
2025-11-12 15:50:13.109 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7257/_framework/aspnetcore-browser-refresh.js - null null
2025-11-12 15:50:13.130 +03:00 [DBG] Script injected: /_framework/aspnetcore-browser-refresh.js
2025-11-12 15:50:13.135 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7257/_framework/aspnetcore-browser-refresh.js - 200 16519 application/javascript; charset=utf-8 26.5249ms
2025-11-12 15:50:13.176 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7257/_vs/browserLink - 200 null text/javascript; charset=UTF-8 67.5189ms
2025-11-12 15:50:13.291 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7257/swagger/v1/swagger.json - null null
2025-11-12 15:50:13.298 +03:00 [DBG] No candidates found for the request path '/swagger/v1/swagger.json'
2025-11-12 15:50:13.302 +03:00 [DBG] Request did not match any endpoints
2025-11-12 15:50:13.320 +03:00 [INF] HTTP GET /swagger/v1/swagger.json responded 200 in 15.6969 ms
2025-11-12 15:50:13.327 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7257/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 36.8701ms
2025-11-12 15:50:23.150 +03:00 [DBG] Connection id "0HNH1T82CNQP0" accepted.
2025-11-12 15:50:23.150 +03:00 [DBG] Connection id "0HNH1T82CNQP0" received FIN.
2025-11-12 15:50:23.155 +03:00 [DBG] Connection id "0HNH1T82CNQP0" started.
2025-11-12 15:50:23.156 +03:00 [DBG] Connection id "0HNH1T82CNQP1" accepted.
2025-11-12 15:50:23.161 +03:00 [DBG] Failed to authenticate HTTPS connection.
System.IO.IOException: Received an unexpected EOF or 0 bytes from the transport stream.
   at System.Net.Security.SslStream.ReceiveHandshakeFrameAsync[TIOAdapter](CancellationToken cancellationToken)
   at System.Net.Security.SslStream.ForceAuthenticationAsync[TIOAdapter](Boolean receiveFirst, Byte[] reAuthenticationData, CancellationToken cancellationToken)
   at System.Net.Security.SslStream.ProcessAuthenticationWithTelemetryAsync(Boolean isAsync, CancellationToken cancellationToken)
   at Microsoft.AspNetCore.Server.Kestrel.Https.Internal.HttpsConnectionMiddleware.OnConnectionAsync(ConnectionContext context)
2025-11-12 15:50:23.163 +03:00 [DBG] Connection id "0HNH1T82CNQP1" started.
2025-11-12 15:50:23.169 +03:00 [DBG] Connection id "0HNH1T82CNQP0" stopped.
2025-11-12 15:50:23.174 +03:00 [DBG] Connection id "0HNH1T82CNQP0" sending FIN because: "The Socket transport's send loop completed gracefully."
2025-11-12 15:50:23.177 +03:00 [DBG] Connection 0HNH1T82CNQP1 established using the following protocol: "Tls13"
2025-11-12 15:50:23.185 +03:00 [INF] Request starting HTTP/1.1 POST https://localhost:7257/api/Invoices - application/json 1316
2025-11-12 15:50:23.195 +03:00 [DBG] 1 candidate(s) found for the request path '/api/Invoices'
2025-11-12 15:50:23.204 +03:00 [DBG] Endpoint 'BillingSystem.API.Controllers.InvoicesController.Post (BillingSystem.API)' with route pattern 'api/Invoices' is valid for the request path '/api/Invoices'
2025-11-12 15:50:23.209 +03:00 [DBG] Request matched endpoint 'BillingSystem.API.Controllers.InvoicesController.Post (BillingSystem.API)'
2025-11-12 15:50:23.217 +03:00 [DBG] Static files was skipped as the request already matched an endpoint.
2025-11-12 15:50:23.424 +03:00 [DBG] An 'IServiceProvider' was created for internal use by Entity Framework.
2025-11-12 15:50:28.849 +03:00 [INF] Executing endpoint 'BillingSystem.API.Controllers.InvoicesController.Post (BillingSystem.API)'
2025-11-12 15:50:28.894 +03:00 [INF] Route matched with {action = "Post", controller = "Invoices"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Post(BillingSystem.Application.Requests.CreateInvoiceRequest) on controller BillingSystem.API.Controllers.InvoicesController (BillingSystem.API).
2025-11-12 15:50:28.902 +03:00 [DBG] Execution plan of authorization filters (in the following order): ["None"]
2025-11-12 15:50:28.905 +03:00 [DBG] Execution plan of resource filters (in the following order): ["None"]
2025-11-12 15:50:28.907 +03:00 [DBG] Execution plan of action filters (in the following order): ["Microsoft.AspNetCore.Mvc.ModelBinding.UnsupportedContentTypeFilter (Order: -3000)","Microsoft.AspNetCore.Mvc.Infrastructure.ModelStateInvalidFilter (Order: -2000)","BillingSystem.API.ActionFilters.AuditBillingRequestsFilter","BillingSystem.API.ActionFilters.IdempotencyFilter (Order: 0)"]
2025-11-12 15:50:28.911 +03:00 [DBG] Execution plan of exception filters (in the following order): ["None"]
2025-11-12 15:50:28.917 +03:00 [DBG] Execution plan of result filters (in the following order): ["Microsoft.AspNetCore.Mvc.Infrastructure.ClientErrorResultFilter (Order: -2000)","Microsoft.AspNetCore.Mvc.ProducesAttribute (Order: 0)","BillingSystem.API.ActionFilters.IdempotencyFilter (Order: 0)"]
2025-11-12 15:50:28.923 +03:00 [DBG] Executing controller factory for controller BillingSystem.API.Controllers.InvoicesController (BillingSystem.API)
2025-11-12 15:50:28.932 +03:00 [WRN] You do not have a valid license key for the Lucky Penny software MediatR. This is allowed for development and testing scenarios. If you are running in production you are required to have a licensed version. Please visit https://luckypennysoftware.com to obtain a valid license.
2025-11-12 15:50:28.975 +03:00 [DBG] Executed controller factory for controller BillingSystem.API.Controllers.InvoicesController (BillingSystem.API)
2025-11-12 15:50:29.003 +03:00 [DBG] Attempting to bind parameter 'invoiceRequest' of type 'BillingSystem.Application.Requests.CreateInvoiceRequest' ...
2025-11-12 15:50:29.009 +03:00 [DBG] Attempting to bind parameter 'invoiceRequest' of type 'BillingSystem.Application.Requests.CreateInvoiceRequest' using the name '' in request data ...
2025-11-12 15:50:29.015 +03:00 [DBG] Selected input formatter 'Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonInputFormatter' for content type 'application/json'.
2025-11-12 15:50:29.054 +03:00 [DBG] Connection id "0HNH1T82CNQP1", Request id "0HNH1T82CNQP1:00000001": started reading request body.
2025-11-12 15:50:29.059 +03:00 [DBG] Connection id "0HNH1T82CNQP1", Request id "0HNH1T82CNQP1:00000001": done reading request body.
2025-11-12 15:50:29.102 +03:00 [DBG] JSON input formatter succeeded, deserializing to type 'BillingSystem.Application.Requests.CreateInvoiceRequest'
2025-11-12 15:50:29.107 +03:00 [DBG] Done attempting to bind parameter 'invoiceRequest' of type 'BillingSystem.Application.Requests.CreateInvoiceRequest'.
2025-11-12 15:50:29.110 +03:00 [DBG] Done attempting to bind parameter 'invoiceRequest' of type 'BillingSystem.Application.Requests.CreateInvoiceRequest'.
2025-11-12 15:50:29.115 +03:00 [DBG] Attempting to validate the bound parameter 'invoiceRequest' of type 'BillingSystem.Application.Requests.CreateInvoiceRequest' ...
2025-11-12 15:50:29.144 +03:00 [DBG] Done attempting to validate the bound parameter 'invoiceRequest' of type 'BillingSystem.Application.Requests.CreateInvoiceRequest'.
2025-11-12 15:50:29.453 +03:00 [DBG] No relationship from 'Invoice' to 'Invoice' has been configured by convention because there are multiple properties on one entity type - {'DiscountedPrimaryInvoice'} that could be matched with the properties on the other entity type - {'InverseDiscountedPrimaryInvoice', 'InversePrimaryInvoice', 'InverseSubstitutionPrimaryInvoice', 'PrimaryInvoice', 'SubstitutionPrimaryInvoice'}. This message can be disregarded if explicit configuration has been specified in 'OnModelCreating'.
2025-11-12 15:50:29.677 +03:00 [DBG] No relationship from 'Invoice' to 'Invoice' has been configured by convention because there are multiple properties on one entity type - {'DiscountedPrimaryInvoice'} that could be matched with the properties on the other entity type - {'InverseDiscountedPrimaryInvoice', 'InversePrimaryInvoice', 'InverseSubstitutionPrimaryInvoice', 'PrimaryInvoice', 'SubstitutionPrimaryInvoice'}. This message can be disregarded if explicit configuration has been specified in 'OnModelCreating'.
2025-11-12 15:50:29.691 +03:00 [DBG] No relationship from 'Invoice' to 'Invoice' has been configured by convention because there are multiple properties on one entity type - {'InversePrimaryInvoice'} that could be matched with the properties on the other entity type - {'InverseSubstitutionPrimaryInvoice', 'PrimaryInvoice', 'SubstitutionPrimaryInvoice'}. This message can be disregarded if explicit configuration has been specified in 'OnModelCreating'.
2025-11-12 15:50:29.703 +03:00 [DBG] No relationship from 'Invoice' to 'Invoice' has been configured by convention because there are multiple properties on one entity type - {'InversePrimaryInvoice'} that could be matched with the properties on the other entity type - {'InverseSubstitutionPrimaryInvoice', 'PrimaryInvoice', 'SubstitutionPrimaryInvoice'}. This message can be disregarded if explicit configuration has been specified in 'OnModelCreating'.
2025-11-12 15:50:30.076 +03:00 [DBG] Entity Framework Core 9.0.9 initialized 'BillingServiceDBContext' using provider 'Microsoft.EntityFrameworkCore.SqlServer:9.0.9' with options: EngineType=SqlServer 
2025-11-12 15:50:30.214 +03:00 [DBG] Compiling query expression: 
'DbSet<Invoice>()
    .AsNoTracking()
    .Any(inv => inv.ExternalId.ToString() == __idempotentKey_0)'
2025-11-12 15:50:30.514 +03:00 [DBG] Generated query execution expression: 
'queryContext => ShapedQueryCompilingExpressionVisitor.SingleAsync<bool>(
    asyncEnumerable: SingleQueryingEnumerable.Create<bool>(
        relationalQueryContext: (RelationalQueryContext)queryContext, 
        relationalCommandResolver: parameters => [LIFTABLE Constant: RelationalCommandCache.QueryExpression(
            Projection Mapping:
                EmptyProjectionMember -> 0
            SELECT EXISTS (
                SELECT 1
                FROM Invoices AS i
                WHERE COALESCE(CONVERT(varchar(36), i.ExternalId), '') == @__idempotentKey_0)) | Resolver: c => new RelationalCommandCache(
            c.Dependencies.MemoryCache, 
            c.RelationalDependencies.QuerySqlGeneratorFactory, 
            c.RelationalDependencies.RelationalParameterBasedSqlProcessorFactory, 
            Projection Mapping:
                EmptyProjectionMember -> 0
            SELECT EXISTS (
                SELECT 1
                FROM Invoices AS i
                WHERE COALESCE(CONVERT(varchar(36), i.ExternalId), '') == @__idempotentKey_0), 
            False, 
            new HashSet<string>(
                new string[]{ }, 
                StringComparer.Ordinal
            )
        )].GetRelationalCommandTemplate(parameters), 
        readerColumns: null, 
        shaper: (queryContext, dataReader, resultContext, resultCoordinator) => 
        {
            bool? value1;
            value1 = dataReader.IsDBNull(0) ? default(bool?) : (bool?)dataReader.GetBoolean(0);
            return (bool)value1;
        }, 
        contextType: BillingSystem.Infrastructure.EF.BillingServiceDBContext, 
        standAloneStateManager: False, 
        detailedErrorsEnabled: False, 
        threadSafetyChecksEnabled: True), 
    cancellationToken: queryContext.CancellationToken)'
2025-11-12 15:50:30.578 +03:00 [DBG] Creating DbConnection.
2025-11-12 15:50:30.606 +03:00 [DBG] Created DbConnection. (25ms).
2025-11-12 15:50:30.614 +03:00 [DBG] Opening connection to database 'GAC-BillingService' on server '.'.
2025-11-12 15:50:30.949 +03:00 [DBG] Opened connection to database 'GAC-BillingService' on server '.'.
2025-11-12 15:50:30.958 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-11-12 15:50:30.968 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (5ms).
2025-11-12 15:50:30.987 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (29ms).
2025-11-12 15:50:30.998 +03:00 [DBG] Executing DbCommand [Parameters=[@__idempotentKey_0='?' (Size = 36) (DbType = AnsiString)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [Invoices] AS [i]
        WHERE CONVERT(varchar(36), [i].[ExternalId]) = @__idempotentKey_0) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2025-11-12 15:50:31.084 +03:00 [INF] Executed DbCommand (85ms) [Parameters=[@__idempotentKey_0='?' (Size = 36) (DbType = AnsiString)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [Invoices] AS [i]
        WHERE CONVERT(varchar(36), [i].[ExternalId]) = @__idempotentKey_0) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2025-11-12 15:50:31.118 +03:00 [DBG] Closing data reader to 'GAC-BillingService' on server '.'.
2025-11-12 15:50:31.133 +03:00 [DBG] A data reader for 'GAC-BillingService' on server '.' is being disposed after spending 35ms reading results.
2025-11-12 15:50:31.143 +03:00 [DBG] Closing connection to database 'GAC-BillingService' on server '.'.
2025-11-12 15:50:31.154 +03:00 [DBG] Closed connection to database 'GAC-BillingService' on server '.' (12ms).
2025-11-12 15:50:31.335 +03:00 [WRN] You do not have a valid license key for the Lucky Penny software AutoMapper. This is allowed for development and testing scenarios. If you are running in production you are required to have a licensed version. Please visit https://luckypennysoftware.com to obtain a valid license.
2025-11-12 15:50:37.585 +03:00 [DBG] Opening connection to database 'GAC-BillingService' on server '.'.
2025-11-12 15:50:37.593 +03:00 [DBG] Opened connection to database 'GAC-BillingService' on server '.'.
2025-11-12 15:50:37.604 +03:00 [DBG] Beginning transaction with isolation level 'Unspecified'.
2025-11-12 15:50:37.623 +03:00 [DBG] Began transaction with isolation level 'ReadCommitted'.
2025-11-12 15:50:39.604 +03:00 [DBG] 'BillingServiceDBContext' generated a temporary value for the property 'Invoice.Id'. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-11-12 15:50:39.826 +03:00 [DBG] Context 'BillingServiceDBContext' started tracking 'Invoice' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-11-12 15:50:39.834 +03:00 [DBG] 'BillingServiceDBContext' generated a temporary value for the property 'Customer.Id'. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-11-12 15:50:39.938 +03:00 [DBG] The foreign key property 'Invoice.CustomerId' was detected as changed. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see property values.
2025-11-12 15:50:39.975 +03:00 [DBG] Context 'BillingServiceDBContext' started tracking 'Customer' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-11-12 15:56:21.553 +03:00 [ERR] exception occured Self referencing loop detected with type 'BillingSystem.Domain.Entities.Invoice'. Path 'Customer.Invoices'. , stackTrace    at Newtonsoft.Json.Serialization.JsonSerializerInternalWriter.CheckForCircularReference(JsonWriter writer, Object value, JsonProperty property, JsonContract contract, JsonContainerContract containerContract, JsonProperty containerProperty)
   at Newtonsoft.Json.Serialization.JsonSerializerInternalWriter.SerializeList(JsonWriter writer, IEnumerable values, JsonArrayContract contract, JsonProperty member, JsonContainerContract collectionContract, JsonProperty containerProperty)
   at Newtonsoft.Json.Serialization.JsonSerializerInternalWriter.SerializeValue(JsonWriter writer, Object value, JsonContract valueContract, JsonProperty member, JsonContainerContract containerContract, JsonProperty containerProperty)
   at Newtonsoft.Json.Serialization.JsonSerializerInternalWriter.SerializeObject(JsonWriter writer, Object value, JsonObjectContract contract, JsonProperty member, JsonContainerContract collectionContract, JsonProperty containerProperty)
   at Newtonsoft.Json.Serialization.JsonSerializerInternalWriter.SerializeValue(JsonWriter writer, Object value, JsonContract valueContract, JsonProperty member, JsonContainerContract containerContract, JsonProperty containerProperty)
   at Newtonsoft.Json.Serialization.JsonSerializerInternalWriter.SerializeObject(JsonWriter writer, Object value, JsonObjectContract contract, JsonProperty member, JsonContainerContract collectionContract, JsonProperty containerProperty)
   at Newtonsoft.Json.Serialization.JsonSerializerInternalWriter.SerializeValue(JsonWriter writer, Object value, JsonContract valueContract, JsonProperty member, JsonContainerContract containerContract, JsonProperty containerProperty)
   at Newtonsoft.Json.Serialization.JsonSerializerInternalWriter.Serialize(JsonWriter jsonWriter, Object value, Type objectType)
   at Newtonsoft.Json.JsonSerializer.SerializeInternal(JsonWriter jsonWriter, Object value, Type objectType)
   at Newtonsoft.Json.JsonSerializer.Serialize(JsonWriter jsonWriter, Object value, Type objectType)
   at Newtonsoft.Json.JsonConvert.SerializeObjectInternal(Object value, Type type, JsonSerializer jsonSerializer)
   at Newtonsoft.Json.JsonConvert.SerializeObject(Object value, Type type, JsonSerializerSettings settings)
   at Newtonsoft.Json.JsonConvert.SerializeObject(Object value)
   at BillingSystem.Infrastructure.Persistence.EF.InvoiceRepository.Insert(Invoice entity) in C:\Repositories\Gac-BillingSystem\src\BillingSystem.Infrastructure\Persistence\EF\InvoiceRepository.cs:line 69
2025-11-12 15:56:21.559 +03:00 [DBG] Disconnect: guest@localhost:5672/
2025-11-12 15:56:21.601 +03:00 [DBG] Rolling back transaction.
2025-11-12 15:56:21.619 +03:00 [DBG] Rolled back transaction.
2025-11-12 15:56:21.622 +03:00 [DBG] Disconnected: guest@localhost:5672/
2025-11-12 15:56:21.623 +03:00 [DBG] Closing connection to database 'GAC-BillingService' on server '.'.
2025-11-12 15:56:21.627 +03:00 [DBG] Closed connection to database 'GAC-BillingService' on server '.' (4ms).
2025-11-12 15:56:21.663 +03:00 [DBG] Disposing transaction.
2025-11-12 15:56:21.727 +03:00 [ERR] exception occured Self referencing loop detected with type 'BillingSystem.Domain.Entities.Invoice'. Path 'Customer.Invoices'. , stackTrace    at Newtonsoft.Json.Serialization.JsonSerializerInternalWriter.CheckForCircularReference(JsonWriter writer, Object value, JsonProperty property, JsonContract contract, JsonContainerContract containerContract, JsonProperty containerProperty)
   at Newtonsoft.Json.Serialization.JsonSerializerInternalWriter.SerializeList(JsonWriter writer, IEnumerable values, JsonArrayContract contract, JsonProperty member, JsonContainerContract collectionContract, JsonProperty containerProperty)
   at Newtonsoft.Json.Serialization.JsonSerializerInternalWriter.SerializeValue(JsonWriter writer, Object value, JsonContract valueContract, JsonProperty member, JsonContainerContract containerContract, JsonProperty containerProperty)
   at Newtonsoft.Json.Serialization.JsonSerializerInternalWriter.SerializeObject(JsonWriter writer, Object value, JsonObjectContract contract, JsonProperty member, JsonContainerContract collectionContract, JsonProperty containerProperty)
   at Newtonsoft.Json.Serialization.JsonSerializerInternalWriter.SerializeValue(JsonWriter writer, Object value, JsonContract valueContract, JsonProperty member, JsonContainerContract containerContract, JsonProperty containerProperty)
   at Newtonsoft.Json.Serialization.JsonSerializerInternalWriter.SerializeObject(JsonWriter writer, Object value, JsonObjectContract contract, JsonProperty member, JsonContainerContract collectionContract, JsonProperty containerProperty)
   at Newtonsoft.Json.Serialization.JsonSerializerInternalWriter.SerializeValue(JsonWriter writer, Object value, JsonContract valueContract, JsonProperty member, JsonContainerContract containerContract, JsonProperty containerProperty)
   at Newtonsoft.Json.Serialization.JsonSerializerInternalWriter.Serialize(JsonWriter jsonWriter, Object value, Type objectType)
   at Newtonsoft.Json.JsonSerializer.SerializeInternal(JsonWriter jsonWriter, Object value, Type objectType)
   at Newtonsoft.Json.JsonSerializer.Serialize(JsonWriter jsonWriter, Object value, Type objectType)
   at Newtonsoft.Json.JsonConvert.SerializeObjectInternal(Object value, Type type, JsonSerializer jsonSerializer)
   at Newtonsoft.Json.JsonConvert.SerializeObject(Object value, Type type, JsonSerializerSettings settings)
   at Newtonsoft.Json.JsonConvert.SerializeObject(Object value)
   at BillingSystem.Infrastructure.Persistence.EF.InvoiceRepository.Insert(Invoice entity) in C:\Repositories\Gac-BillingSystem\src\BillingSystem.Infrastructure\Persistence\EF\InvoiceRepository.cs:line 69
   at BillingSystem.Application.Commands.CreateInvoiceCommandRequestHandler.Handle(CreateInvoiceRequest request, CancellationToken cancellationToken) in C:\Repositories\Gac-BillingSystem\src\BillingSystem.Application\Commands\CreateInvoiceCommandRequestHandler.cs:line 39
   at BillingSystem.API.Controllers.InvoicesController.Post(CreateInvoiceRequest invoiceRequest) in C:\Repositories\Gac-BillingSystem\src\BillingSystem.API\Controllers\InvoicesController.cs:line 45
2025-11-12 15:56:21.743 +03:00 [DBG] List of registered output formatters, in the following order: ["Microsoft.AspNetCore.Mvc.Formatters.HttpNoContentOutputFormatter","Microsoft.AspNetCore.Mvc.Formatters.StringOutputFormatter","Microsoft.AspNetCore.Mvc.Formatters.StreamOutputFormatter","Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonOutputFormatter"]
2025-11-12 15:56:21.750 +03:00 [DBG] No information found on request to perform content negotiation.
2025-11-12 15:56:21.754 +03:00 [DBG] Attempting to select the first output formatter in the output formatters list which supports a content type from the explicitly specified content types '["application/json","application/problem+json","application/problem+xml"]'.
2025-11-12 15:56:21.760 +03:00 [DBG] Selected output formatter 'Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonOutputFormatter' and content type 'application/json' to write the response.
2025-11-12 15:56:21.764 +03:00 [INF] Executing ObjectResult, writing value of type 'Microsoft.AspNetCore.Mvc.ProblemDetails'.
2025-11-12 15:56:21.794 +03:00 [INF] Executed action BillingSystem.API.Controllers.InvoicesController.Post (BillingSystem.API) in 352863.6628ms
2025-11-12 15:56:21.799 +03:00 [INF] Executed endpoint 'BillingSystem.API.Controllers.InvoicesController.Post (BillingSystem.API)'
2025-11-12 15:56:21.803 +03:00 [ERR] HTTP POST /api/Invoices responded 500 in 358582.0459 ms
2025-11-12 15:56:21.807 +03:00 [DBG] Connection id "0HNH1T82CNQP1" completed keep alive response.
2025-11-12 15:56:21.813 +03:00 [DBG] 'BillingServiceDBContext' disposed.
2025-11-12 15:56:21.821 +03:00 [DBG] Disposing connection to database 'GAC-BillingService' on server '.'.
2025-11-12 15:56:21.825 +03:00 [DBG] Disposed connection to database '' on server '' (4ms).
2025-11-12 15:56:21.829 +03:00 [INF] Request finished HTTP/1.1 POST https://localhost:7257/api/Invoices - 500 null application/json; charset=utf-8 358637.7385ms
2025-11-12 15:59:14.658 +03:00 [DBG] Registered model binder providers, in the following order: ["Microsoft.AspNetCore.Mvc.ModelBinding.Binders.BinderTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ServicesModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.BodyModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.HeaderModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FloatingPointTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.EnumTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.DateTimeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.SimpleTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.TryParseModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.CancellationTokenModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ByteArrayModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FormFileModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FormCollectionModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.KeyValuePairModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.DictionaryModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ArrayModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.CollectionModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ComplexObjectModelBinderProvider"]
2025-11-12 15:59:14.864 +03:00 [DBG] Hosting starting
2025-11-12 15:59:15.245 +03:00 [DBG] Starting bus instances: IBus
2025-11-12 15:59:15.256 +03:00 [DBG] Starting bus: "rabbitmq://localhost/"
2025-11-12 15:59:15.292 +03:00 [DBG] Middleware loaded
2025-11-12 15:59:15.300 +03:00 [DBG] Middleware loaded. Script /_framework/aspnetcore-browser-refresh.js (16519 B).
2025-11-12 15:59:15.318 +03:00 [DBG] Middleware loaded. Script /_framework/blazor-hotreload.js (799 B).
2025-11-12 15:59:15.324 +03:00 [DBG] Connect: guest@localhost:5672/
2025-11-12 15:59:15.522 +03:00 [DBG] Middleware loaded: DOTNET_MODIFIABLE_ASSEMBLIES=debug, __ASPNETCORE_BROWSER_TOOLS=true
2025-11-12 15:59:15.564 +03:00 [DBG] Connected: guest@localhost:5672/ (address: amqp://localhost:5672, local: 59703)
2025-11-12 15:59:15.657 +03:00 [DBG] Endpoint Ready: "rabbitmq://localhost/ECHGHANNAMLP1_BillingSystemAPI_bus_7bcoyyyh3bcsyu3ibdxnd44erq?temporary=true"
2025-11-12 15:59:15.665 +03:00 [INF] Bus started: "rabbitmq://localhost/"
2025-11-12 15:59:16.034 +03:00 [INF] Now listening on: https://localhost:7257
2025-11-12 15:59:16.040 +03:00 [INF] Now listening on: http://localhost:5009
2025-11-12 15:59:16.043 +03:00 [DBG] Loaded hosting startup assembly BillingSystem.API
2025-11-12 15:59:16.045 +03:00 [DBG] Loaded hosting startup assembly Microsoft.WebTools.ApiEndpointDiscovery
2025-11-12 15:59:16.050 +03:00 [DBG] Loaded hosting startup assembly Microsoft.AspNetCore.Watch.BrowserRefresh
2025-11-12 15:59:16.054 +03:00 [DBG] Loaded hosting startup assembly Microsoft.WebTools.BrowserLink.Net
2025-11-12 15:59:16.184 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-11-12 15:59:16.187 +03:00 [INF] Hosting environment: Development
2025-11-12 15:59:16.190 +03:00 [INF] Content root path: C:\Repositories\Gac-BillingSystem\src\BillingSystem.API
2025-11-12 15:59:16.195 +03:00 [DBG] Hosting started
2025-11-12 15:59:16.347 +03:00 [DBG] Connection id "0HNH1TD4K9N5I" received FIN.
2025-11-12 15:59:16.365 +03:00 [DBG] Connection id "0HNH1TD4K9N5I" accepted.
2025-11-12 15:59:16.372 +03:00 [DBG] Connection id "0HNH1TD4K9N5I" started.
2025-11-12 15:59:16.400 +03:00 [DBG] Failed to authenticate HTTPS connection.
System.IO.IOException: Received an unexpected EOF or 0 bytes from the transport stream.
   at System.Net.Security.SslStream.ReceiveHandshakeFrameAsync[TIOAdapter](CancellationToken cancellationToken)
   at System.Net.Security.SslStream.ForceAuthenticationAsync[TIOAdapter](Boolean receiveFirst, Byte[] reAuthenticationData, CancellationToken cancellationToken)
   at System.Net.Security.SslStream.ProcessAuthenticationWithTelemetryAsync(Boolean isAsync, CancellationToken cancellationToken)
   at Microsoft.AspNetCore.Server.Kestrel.Https.Internal.HttpsConnectionMiddleware.OnConnectionAsync(ConnectionContext context)
2025-11-12 15:59:16.438 +03:00 [DBG] Connection id "0HNH1TD4K9N5I" stopped.
2025-11-12 15:59:16.448 +03:00 [DBG] Connection id "0HNH1TD4K9N5I" sending FIN because: "The Socket transport's send loop completed gracefully."
2025-11-12 15:59:17.275 +03:00 [DBG] Connection id "0HNH1TD4K9N5J" accepted.
2025-11-12 15:59:17.281 +03:00 [DBG] Connection id "0HNH1TD4K9N5J" started.
2025-11-12 15:59:17.366 +03:00 [DBG] Connection 0HNH1TD4K9N5J established using the following protocol: "Tls13"
2025-11-12 15:59:17.484 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7257/swagger/index.html - null null
2025-11-12 15:59:17.585 +03:00 [DBG] Wildcard detected, all requests with hosts will be allowed.
2025-11-12 15:59:17.644 +03:00 [DBG] No candidates found for the request path '/swagger/index.html'
2025-11-12 15:59:17.659 +03:00 [DBG] Request did not match any endpoints
2025-11-12 15:59:18.027 +03:00 [DBG] Response markup is scheduled to include Browser Link script injection.
2025-11-12 15:59:18.039 +03:00 [DBG] Response markup is scheduled to include browser refresh script injection.
2025-11-12 15:59:18.088 +03:00 [INF] HTTP GET /swagger/index.html responded 200 in 392.8586 ms
2025-11-12 15:59:18.096 +03:00 [DBG] Response markup was updated to include Browser Link script injection.
2025-11-12 15:59:18.100 +03:00 [DBG] Response markup was updated to include browser refresh script injection.
2025-11-12 15:59:18.108 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7257/swagger/index.html - 200 null text/html;charset=utf-8 642.581ms
2025-11-12 15:59:18.143 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7257/_framework/aspnetcore-browser-refresh.js - null null
2025-11-12 15:59:18.143 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7257/_vs/browserLink - null null
2025-11-12 15:59:18.160 +03:00 [DBG] Script injected: /_framework/aspnetcore-browser-refresh.js
2025-11-12 15:59:18.164 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7257/_framework/aspnetcore-browser-refresh.js - 200 16519 application/javascript; charset=utf-8 22.9625ms
2025-11-12 15:59:18.240 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7257/_vs/browserLink - 200 null text/javascript; charset=UTF-8 97.9783ms
2025-11-12 15:59:18.313 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7257/swagger/v1/swagger.json - null null
2025-11-12 15:59:18.324 +03:00 [DBG] No candidates found for the request path '/swagger/v1/swagger.json'
2025-11-12 15:59:18.329 +03:00 [DBG] Request did not match any endpoints
2025-11-12 15:59:18.360 +03:00 [INF] HTTP GET /swagger/v1/swagger.json responded 200 in 26.1672 ms
2025-11-12 15:59:18.371 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7257/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 58.8578ms
2025-11-12 15:59:27.532 +03:00 [DBG] Connection id "0HNH1TD4K9N5K" accepted.
2025-11-12 15:59:27.532 +03:00 [DBG] Connection id "0HNH1TD4K9N5K" received FIN.
2025-11-12 15:59:27.538 +03:00 [DBG] Connection id "0HNH1TD4K9N5K" started.
2025-11-12 15:59:27.540 +03:00 [DBG] Connection id "0HNH1TD4K9N5L" accepted.
2025-11-12 15:59:27.549 +03:00 [DBG] Failed to authenticate HTTPS connection.
System.IO.IOException: Received an unexpected EOF or 0 bytes from the transport stream.
   at System.Net.Security.SslStream.ReceiveHandshakeFrameAsync[TIOAdapter](CancellationToken cancellationToken)
   at System.Net.Security.SslStream.ForceAuthenticationAsync[TIOAdapter](Boolean receiveFirst, Byte[] reAuthenticationData, CancellationToken cancellationToken)
   at System.Net.Security.SslStream.ProcessAuthenticationWithTelemetryAsync(Boolean isAsync, CancellationToken cancellationToken)
   at Microsoft.AspNetCore.Server.Kestrel.Https.Internal.HttpsConnectionMiddleware.OnConnectionAsync(ConnectionContext context)
2025-11-12 15:59:27.551 +03:00 [DBG] Connection id "0HNH1TD4K9N5L" started.
2025-11-12 15:59:27.556 +03:00 [DBG] Connection id "0HNH1TD4K9N5K" stopped.
2025-11-12 15:59:27.563 +03:00 [DBG] Connection id "0HNH1TD4K9N5K" sending FIN because: "The Socket transport's send loop completed gracefully."
2025-11-12 15:59:27.566 +03:00 [DBG] Connection 0HNH1TD4K9N5L established using the following protocol: "Tls13"
2025-11-12 15:59:27.577 +03:00 [INF] Request starting HTTP/1.1 POST https://localhost:7257/api/Invoices - application/json 1316
2025-11-12 15:59:27.588 +03:00 [DBG] 1 candidate(s) found for the request path '/api/Invoices'
2025-11-12 15:59:27.598 +03:00 [DBG] Endpoint 'BillingSystem.API.Controllers.InvoicesController.Post (BillingSystem.API)' with route pattern 'api/Invoices' is valid for the request path '/api/Invoices'
2025-11-12 15:59:27.603 +03:00 [DBG] Request matched endpoint 'BillingSystem.API.Controllers.InvoicesController.Post (BillingSystem.API)'
2025-11-12 15:59:27.613 +03:00 [DBG] Static files was skipped as the request already matched an endpoint.
2025-11-12 15:59:27.836 +03:00 [DBG] An 'IServiceProvider' was created for internal use by Entity Framework.
2025-11-12 15:59:33.345 +03:00 [INF] Executing endpoint 'BillingSystem.API.Controllers.InvoicesController.Post (BillingSystem.API)'
2025-11-12 15:59:33.412 +03:00 [INF] Route matched with {action = "Post", controller = "Invoices"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Post(BillingSystem.Application.Requests.CreateInvoiceRequest) on controller BillingSystem.API.Controllers.InvoicesController (BillingSystem.API).
2025-11-12 15:59:33.422 +03:00 [DBG] Execution plan of authorization filters (in the following order): ["None"]
2025-11-12 15:59:33.428 +03:00 [DBG] Execution plan of resource filters (in the following order): ["None"]
2025-11-12 15:59:33.432 +03:00 [DBG] Execution plan of action filters (in the following order): ["Microsoft.AspNetCore.Mvc.ModelBinding.UnsupportedContentTypeFilter (Order: -3000)","Microsoft.AspNetCore.Mvc.Infrastructure.ModelStateInvalidFilter (Order: -2000)","BillingSystem.API.ActionFilters.AuditBillingRequestsFilter","BillingSystem.API.ActionFilters.IdempotencyFilter (Order: 0)"]
2025-11-12 15:59:33.439 +03:00 [DBG] Execution plan of exception filters (in the following order): ["None"]
2025-11-12 15:59:33.442 +03:00 [DBG] Execution plan of result filters (in the following order): ["Microsoft.AspNetCore.Mvc.Infrastructure.ClientErrorResultFilter (Order: -2000)","Microsoft.AspNetCore.Mvc.ProducesAttribute (Order: 0)","BillingSystem.API.ActionFilters.IdempotencyFilter (Order: 0)"]
2025-11-12 15:59:33.450 +03:00 [DBG] Executing controller factory for controller BillingSystem.API.Controllers.InvoicesController (BillingSystem.API)
2025-11-12 15:59:33.458 +03:00 [WRN] You do not have a valid license key for the Lucky Penny software MediatR. This is allowed for development and testing scenarios. If you are running in production you are required to have a licensed version. Please visit https://luckypennysoftware.com to obtain a valid license.
2025-11-12 15:59:33.509 +03:00 [DBG] Executed controller factory for controller BillingSystem.API.Controllers.InvoicesController (BillingSystem.API)
2025-11-12 15:59:33.536 +03:00 [DBG] Attempting to bind parameter 'invoiceRequest' of type 'BillingSystem.Application.Requests.CreateInvoiceRequest' ...
2025-11-12 15:59:33.545 +03:00 [DBG] Attempting to bind parameter 'invoiceRequest' of type 'BillingSystem.Application.Requests.CreateInvoiceRequest' using the name '' in request data ...
2025-11-12 15:59:33.553 +03:00 [DBG] Selected input formatter 'Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonInputFormatter' for content type 'application/json'.
2025-11-12 15:59:33.599 +03:00 [DBG] Connection id "0HNH1TD4K9N5L", Request id "0HNH1TD4K9N5L:00000001": started reading request body.
2025-11-12 15:59:33.608 +03:00 [DBG] Connection id "0HNH1TD4K9N5L", Request id "0HNH1TD4K9N5L:00000001": done reading request body.
2025-11-12 15:59:33.660 +03:00 [DBG] JSON input formatter succeeded, deserializing to type 'BillingSystem.Application.Requests.CreateInvoiceRequest'
2025-11-12 15:59:33.668 +03:00 [DBG] Done attempting to bind parameter 'invoiceRequest' of type 'BillingSystem.Application.Requests.CreateInvoiceRequest'.
2025-11-12 15:59:33.672 +03:00 [DBG] Done attempting to bind parameter 'invoiceRequest' of type 'BillingSystem.Application.Requests.CreateInvoiceRequest'.
2025-11-12 15:59:33.677 +03:00 [DBG] Attempting to validate the bound parameter 'invoiceRequest' of type 'BillingSystem.Application.Requests.CreateInvoiceRequest' ...
2025-11-12 15:59:33.715 +03:00 [DBG] Done attempting to validate the bound parameter 'invoiceRequest' of type 'BillingSystem.Application.Requests.CreateInvoiceRequest'.
2025-11-12 15:59:34.055 +03:00 [DBG] No relationship from 'Invoice' to 'Invoice' has been configured by convention because there are multiple properties on one entity type - {'DiscountedPrimaryInvoice'} that could be matched with the properties on the other entity type - {'InverseDiscountedPrimaryInvoice', 'InversePrimaryInvoice', 'InverseSubstitutionPrimaryInvoice', 'PrimaryInvoice', 'SubstitutionPrimaryInvoice'}. This message can be disregarded if explicit configuration has been specified in 'OnModelCreating'.
2025-11-12 15:59:34.279 +03:00 [DBG] No relationship from 'Invoice' to 'Invoice' has been configured by convention because there are multiple properties on one entity type - {'DiscountedPrimaryInvoice'} that could be matched with the properties on the other entity type - {'InverseDiscountedPrimaryInvoice', 'InversePrimaryInvoice', 'InverseSubstitutionPrimaryInvoice', 'PrimaryInvoice', 'SubstitutionPrimaryInvoice'}. This message can be disregarded if explicit configuration has been specified in 'OnModelCreating'.
2025-11-12 15:59:34.293 +03:00 [DBG] No relationship from 'Invoice' to 'Invoice' has been configured by convention because there are multiple properties on one entity type - {'InversePrimaryInvoice'} that could be matched with the properties on the other entity type - {'InverseSubstitutionPrimaryInvoice', 'PrimaryInvoice', 'SubstitutionPrimaryInvoice'}. This message can be disregarded if explicit configuration has been specified in 'OnModelCreating'.
2025-11-12 15:59:34.301 +03:00 [DBG] No relationship from 'Invoice' to 'Invoice' has been configured by convention because there are multiple properties on one entity type - {'InversePrimaryInvoice'} that could be matched with the properties on the other entity type - {'InverseSubstitutionPrimaryInvoice', 'PrimaryInvoice', 'SubstitutionPrimaryInvoice'}. This message can be disregarded if explicit configuration has been specified in 'OnModelCreating'.
2025-11-12 15:59:34.705 +03:00 [DBG] Entity Framework Core 9.0.9 initialized 'BillingServiceDBContext' using provider 'Microsoft.EntityFrameworkCore.SqlServer:9.0.9' with options: EngineType=SqlServer 
2025-11-12 15:59:34.841 +03:00 [DBG] Compiling query expression: 
'DbSet<Invoice>()
    .AsNoTracking()
    .Any(inv => inv.ExternalId.ToString() == __idempotentKey_0)'
2025-11-12 15:59:35.149 +03:00 [DBG] Generated query execution expression: 
'queryContext => ShapedQueryCompilingExpressionVisitor.SingleAsync<bool>(
    asyncEnumerable: SingleQueryingEnumerable.Create<bool>(
        relationalQueryContext: (RelationalQueryContext)queryContext, 
        relationalCommandResolver: parameters => [LIFTABLE Constant: RelationalCommandCache.QueryExpression(
            Projection Mapping:
                EmptyProjectionMember -> 0
            SELECT EXISTS (
                SELECT 1
                FROM Invoices AS i
                WHERE COALESCE(CONVERT(varchar(36), i.ExternalId), '') == @__idempotentKey_0)) | Resolver: c => new RelationalCommandCache(
            c.Dependencies.MemoryCache, 
            c.RelationalDependencies.QuerySqlGeneratorFactory, 
            c.RelationalDependencies.RelationalParameterBasedSqlProcessorFactory, 
            Projection Mapping:
                EmptyProjectionMember -> 0
            SELECT EXISTS (
                SELECT 1
                FROM Invoices AS i
                WHERE COALESCE(CONVERT(varchar(36), i.ExternalId), '') == @__idempotentKey_0), 
            False, 
            new HashSet<string>(
                new string[]{ }, 
                StringComparer.Ordinal
            )
        )].GetRelationalCommandTemplate(parameters), 
        readerColumns: null, 
        shaper: (queryContext, dataReader, resultContext, resultCoordinator) => 
        {
            bool? value1;
            value1 = dataReader.IsDBNull(0) ? default(bool?) : (bool?)dataReader.GetBoolean(0);
            return (bool)value1;
        }, 
        contextType: BillingSystem.Infrastructure.EF.BillingServiceDBContext, 
        standAloneStateManager: False, 
        detailedErrorsEnabled: False, 
        threadSafetyChecksEnabled: True), 
    cancellationToken: queryContext.CancellationToken)'
2025-11-12 15:59:35.245 +03:00 [DBG] Creating DbConnection.
2025-11-12 15:59:35.279 +03:00 [DBG] Created DbConnection. (32ms).
2025-11-12 15:59:35.286 +03:00 [DBG] Opening connection to database 'GAC-BillingService' on server '.'.
2025-11-12 15:59:35.666 +03:00 [DBG] Opened connection to database 'GAC-BillingService' on server '.'.
2025-11-12 15:59:35.678 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-11-12 15:59:35.698 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (12ms).
2025-11-12 15:59:35.725 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (48ms).
2025-11-12 15:59:35.749 +03:00 [DBG] Executing DbCommand [Parameters=[@__idempotentKey_0='?' (Size = 36) (DbType = AnsiString)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [Invoices] AS [i]
        WHERE CONVERT(varchar(36), [i].[ExternalId]) = @__idempotentKey_0) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2025-11-12 15:59:35.878 +03:00 [INF] Executed DbCommand (135ms) [Parameters=[@__idempotentKey_0='?' (Size = 36) (DbType = AnsiString)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [Invoices] AS [i]
        WHERE CONVERT(varchar(36), [i].[ExternalId]) = @__idempotentKey_0) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2025-11-12 15:59:35.927 +03:00 [DBG] Closing data reader to 'GAC-BillingService' on server '.'.
2025-11-12 15:59:35.952 +03:00 [DBG] A data reader for 'GAC-BillingService' on server '.' is being disposed after spending 52ms reading results.
2025-11-12 15:59:35.973 +03:00 [DBG] Closing connection to database 'GAC-BillingService' on server '.'.
2025-11-12 15:59:35.996 +03:00 [DBG] Closed connection to database 'GAC-BillingService' on server '.' (23ms).
2025-11-12 15:59:36.212 +03:00 [WRN] You do not have a valid license key for the Lucky Penny software AutoMapper. This is allowed for development and testing scenarios. If you are running in production you are required to have a licensed version. Please visit https://luckypennysoftware.com to obtain a valid license.
2025-11-12 15:59:42.438 +03:00 [DBG] Opening connection to database 'GAC-BillingService' on server '.'.
2025-11-12 15:59:42.447 +03:00 [DBG] Opened connection to database 'GAC-BillingService' on server '.'.
2025-11-12 15:59:42.458 +03:00 [DBG] Beginning transaction with isolation level 'Unspecified'.
2025-11-12 15:59:42.477 +03:00 [DBG] Began transaction with isolation level 'ReadCommitted'.
2025-11-12 15:59:45.622 +03:00 [DBG] 'BillingServiceDBContext' generated a temporary value for the property 'Invoice.Id'. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-11-12 15:59:45.848 +03:00 [DBG] Context 'BillingServiceDBContext' started tracking 'Invoice' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-11-12 15:59:45.856 +03:00 [DBG] 'BillingServiceDBContext' generated a temporary value for the property 'Customer.Id'. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-11-12 15:59:45.964 +03:00 [DBG] The foreign key property 'Invoice.CustomerId' was detected as changed. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see property values.
2025-11-12 15:59:46.004 +03:00 [DBG] Context 'BillingServiceDBContext' started tracking 'Customer' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-11-12 16:04:51.179 +03:00 [ERR] exception occured Self referencing loop detected with type 'BillingSystem.Domain.Entities.Invoice'. Path 'Customer.Invoices'. , stackTrace    at Newtonsoft.Json.Serialization.JsonSerializerInternalWriter.CheckForCircularReference(JsonWriter writer, Object value, JsonProperty property, JsonContract contract, JsonContainerContract containerContract, JsonProperty containerProperty)
   at Newtonsoft.Json.Serialization.JsonSerializerInternalWriter.SerializeList(JsonWriter writer, IEnumerable values, JsonArrayContract contract, JsonProperty member, JsonContainerContract collectionContract, JsonProperty containerProperty)
   at Newtonsoft.Json.Serialization.JsonSerializerInternalWriter.SerializeValue(JsonWriter writer, Object value, JsonContract valueContract, JsonProperty member, JsonContainerContract containerContract, JsonProperty containerProperty)
   at Newtonsoft.Json.Serialization.JsonSerializerInternalWriter.SerializeObject(JsonWriter writer, Object value, JsonObjectContract contract, JsonProperty member, JsonContainerContract collectionContract, JsonProperty containerProperty)
   at Newtonsoft.Json.Serialization.JsonSerializerInternalWriter.SerializeValue(JsonWriter writer, Object value, JsonContract valueContract, JsonProperty member, JsonContainerContract containerContract, JsonProperty containerProperty)
   at Newtonsoft.Json.Serialization.JsonSerializerInternalWriter.SerializeObject(JsonWriter writer, Object value, JsonObjectContract contract, JsonProperty member, JsonContainerContract collectionContract, JsonProperty containerProperty)
   at Newtonsoft.Json.Serialization.JsonSerializerInternalWriter.SerializeValue(JsonWriter writer, Object value, JsonContract valueContract, JsonProperty member, JsonContainerContract containerContract, JsonProperty containerProperty)
   at Newtonsoft.Json.Serialization.JsonSerializerInternalWriter.Serialize(JsonWriter jsonWriter, Object value, Type objectType)
   at Newtonsoft.Json.JsonSerializer.SerializeInternal(JsonWriter jsonWriter, Object value, Type objectType)
   at Newtonsoft.Json.JsonSerializer.Serialize(JsonWriter jsonWriter, Object value, Type objectType)
   at Newtonsoft.Json.JsonConvert.SerializeObjectInternal(Object value, Type type, JsonSerializer jsonSerializer)
   at Newtonsoft.Json.JsonConvert.SerializeObject(Object value, Type type, JsonSerializerSettings settings)
   at Newtonsoft.Json.JsonConvert.SerializeObject(Object value)
   at BillingSystem.Infrastructure.Persistence.EF.InvoiceRepository.Insert(Invoice entity) in C:\Repositories\Gac-BillingSystem\src\BillingSystem.Infrastructure\Persistence\EF\InvoiceRepository.cs:line 69
2025-11-12 16:04:51.201 +03:00 [DBG] Rolling back transaction.
2025-11-12 16:04:51.202 +03:00 [DBG] Disconnect: guest@localhost:5672/
2025-11-12 16:04:51.232 +03:00 [DBG] Rolled back transaction.
2025-11-12 16:04:51.237 +03:00 [DBG] Closing connection to database 'GAC-BillingService' on server '.'.
2025-11-12 16:04:51.247 +03:00 [DBG] Closed connection to database 'GAC-BillingService' on server '.' (9ms).
2025-11-12 16:04:51.248 +03:00 [DBG] Disconnected: guest@localhost:5672/
2025-11-12 16:04:51.276 +03:00 [DBG] Disposing transaction.
2025-11-12 16:04:51.348 +03:00 [ERR] exception occured Self referencing loop detected with type 'BillingSystem.Domain.Entities.Invoice'. Path 'Customer.Invoices'. , stackTrace    at Newtonsoft.Json.Serialization.JsonSerializerInternalWriter.CheckForCircularReference(JsonWriter writer, Object value, JsonProperty property, JsonContract contract, JsonContainerContract containerContract, JsonProperty containerProperty)
   at Newtonsoft.Json.Serialization.JsonSerializerInternalWriter.SerializeList(JsonWriter writer, IEnumerable values, JsonArrayContract contract, JsonProperty member, JsonContainerContract collectionContract, JsonProperty containerProperty)
   at Newtonsoft.Json.Serialization.JsonSerializerInternalWriter.SerializeValue(JsonWriter writer, Object value, JsonContract valueContract, JsonProperty member, JsonContainerContract containerContract, JsonProperty containerProperty)
   at Newtonsoft.Json.Serialization.JsonSerializerInternalWriter.SerializeObject(JsonWriter writer, Object value, JsonObjectContract contract, JsonProperty member, JsonContainerContract collectionContract, JsonProperty containerProperty)
   at Newtonsoft.Json.Serialization.JsonSerializerInternalWriter.SerializeValue(JsonWriter writer, Object value, JsonContract valueContract, JsonProperty member, JsonContainerContract containerContract, JsonProperty containerProperty)
   at Newtonsoft.Json.Serialization.JsonSerializerInternalWriter.SerializeObject(JsonWriter writer, Object value, JsonObjectContract contract, JsonProperty member, JsonContainerContract collectionContract, JsonProperty containerProperty)
   at Newtonsoft.Json.Serialization.JsonSerializerInternalWriter.SerializeValue(JsonWriter writer, Object value, JsonContract valueContract, JsonProperty member, JsonContainerContract containerContract, JsonProperty containerProperty)
   at Newtonsoft.Json.Serialization.JsonSerializerInternalWriter.Serialize(JsonWriter jsonWriter, Object value, Type objectType)
   at Newtonsoft.Json.JsonSerializer.SerializeInternal(JsonWriter jsonWriter, Object value, Type objectType)
   at Newtonsoft.Json.JsonSerializer.Serialize(JsonWriter jsonWriter, Object value, Type objectType)
   at Newtonsoft.Json.JsonConvert.SerializeObjectInternal(Object value, Type type, JsonSerializer jsonSerializer)
   at Newtonsoft.Json.JsonConvert.SerializeObject(Object value, Type type, JsonSerializerSettings settings)
   at Newtonsoft.Json.JsonConvert.SerializeObject(Object value)
   at BillingSystem.Infrastructure.Persistence.EF.InvoiceRepository.Insert(Invoice entity) in C:\Repositories\Gac-BillingSystem\src\BillingSystem.Infrastructure\Persistence\EF\InvoiceRepository.cs:line 69
   at BillingSystem.Application.Commands.CreateInvoiceCommandRequestHandler.Handle(CreateInvoiceRequest request, CancellationToken cancellationToken) in C:\Repositories\Gac-BillingSystem\src\BillingSystem.Application\Commands\CreateInvoiceCommandRequestHandler.cs:line 39
   at BillingSystem.API.Controllers.InvoicesController.Post(CreateInvoiceRequest invoiceRequest) in C:\Repositories\Gac-BillingSystem\src\BillingSystem.API\Controllers\InvoicesController.cs:line 45
2025-11-12 16:04:51.366 +03:00 [DBG] List of registered output formatters, in the following order: ["Microsoft.AspNetCore.Mvc.Formatters.HttpNoContentOutputFormatter","Microsoft.AspNetCore.Mvc.Formatters.StringOutputFormatter","Microsoft.AspNetCore.Mvc.Formatters.StreamOutputFormatter","Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonOutputFormatter"]
2025-11-12 16:04:51.372 +03:00 [DBG] No information found on request to perform content negotiation.
2025-11-12 16:04:51.375 +03:00 [DBG] Attempting to select the first output formatter in the output formatters list which supports a content type from the explicitly specified content types '["application/json","application/problem+json","application/problem+xml"]'.
2025-11-12 16:04:51.382 +03:00 [DBG] Selected output formatter 'Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonOutputFormatter' and content type 'application/json' to write the response.
2025-11-12 16:04:51.386 +03:00 [INF] Executing ObjectResult, writing value of type 'Microsoft.AspNetCore.Mvc.ProblemDetails'.
2025-11-12 16:04:51.416 +03:00 [INF] Executed action BillingSystem.API.Controllers.InvoicesController.Post (BillingSystem.API) in 317960.1464ms
2025-11-12 16:04:51.420 +03:00 [INF] Executed endpoint 'BillingSystem.API.Controllers.InvoicesController.Post (BillingSystem.API)'
2025-11-12 16:04:51.423 +03:00 [ERR] HTTP POST /api/Invoices responded 500 in 323806.5467 ms
2025-11-12 16:04:51.427 +03:00 [DBG] Connection id "0HNH1TD4K9N5L" completed keep alive response.
2025-11-12 16:04:51.433 +03:00 [DBG] 'BillingServiceDBContext' disposed.
2025-11-12 16:04:51.439 +03:00 [DBG] Disposing connection to database 'GAC-BillingService' on server '.'.
2025-11-12 16:04:51.444 +03:00 [DBG] Disposed connection to database '' on server '' (4ms).
2025-11-12 16:04:51.448 +03:00 [INF] Request finished HTTP/1.1 POST https://localhost:7257/api/Invoices - 500 null application/json; charset=utf-8 323866.0471ms
2025-11-12 16:04:52.050 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7257/swagger/index.html - null null
2025-11-12 16:04:52.106 +03:00 [DBG] No candidates found for the request path '/swagger/index.html'
2025-11-12 16:04:52.109 +03:00 [DBG] Request did not match any endpoints
2025-11-12 16:04:52.111 +03:00 [DBG] Response markup is scheduled to include Browser Link script injection.
2025-11-12 16:04:52.113 +03:00 [DBG] Response markup is scheduled to include browser refresh script injection.
2025-11-12 16:04:52.124 +03:00 [INF] HTTP GET /swagger/index.html responded 200 in 13.8760 ms
2025-11-12 16:04:52.140 +03:00 [DBG] Response markup was updated to include Browser Link script injection.
2025-11-12 16:04:52.148 +03:00 [DBG] Response markup was updated to include browser refresh script injection.
2025-11-12 16:04:52.151 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7257/swagger/index.html - 200 null text/html;charset=utf-8 101.0184ms
2025-11-12 16:04:52.173 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7257/_framework/aspnetcore-browser-refresh.js - null null
2025-11-12 16:04:52.173 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7257/_vs/browserLink - null null
2025-11-12 16:04:52.198 +03:00 [DBG] Script injected: /_framework/aspnetcore-browser-refresh.js
2025-11-12 16:04:52.209 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7257/_framework/aspnetcore-browser-refresh.js - 200 16519 application/javascript; charset=utf-8 36.7828ms
2025-11-12 16:04:52.245 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7257/_vs/browserLink - 200 null text/javascript; charset=UTF-8 72.7154ms
2025-11-12 16:04:52.490 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7257/swagger/v1/swagger.json - null null
2025-11-12 16:04:52.505 +03:00 [DBG] No candidates found for the request path '/swagger/v1/swagger.json'
2025-11-12 16:04:52.518 +03:00 [DBG] Request did not match any endpoints
2025-11-12 16:04:52.526 +03:00 [INF] HTTP GET /swagger/v1/swagger.json responded 200 in 6.2299 ms
2025-11-12 16:04:52.532 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7257/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 41.0535ms
2025-11-12 16:05:18.436 +03:00 [DBG] Registered model binder providers, in the following order: ["Microsoft.AspNetCore.Mvc.ModelBinding.Binders.BinderTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ServicesModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.BodyModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.HeaderModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FloatingPointTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.EnumTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.DateTimeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.SimpleTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.TryParseModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.CancellationTokenModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ByteArrayModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FormFileModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FormCollectionModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.KeyValuePairModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.DictionaryModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ArrayModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.CollectionModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ComplexObjectModelBinderProvider"]
2025-11-12 16:05:18.608 +03:00 [DBG] Hosting starting
2025-11-12 16:05:19.010 +03:00 [DBG] Starting bus instances: IBus
2025-11-12 16:05:19.019 +03:00 [DBG] Starting bus: "rabbitmq://localhost/"
2025-11-12 16:05:19.050 +03:00 [DBG] Middleware loaded
2025-11-12 16:05:19.056 +03:00 [DBG] Middleware loaded. Script /_framework/aspnetcore-browser-refresh.js (16519 B).
2025-11-12 16:05:19.061 +03:00 [DBG] Middleware loaded. Script /_framework/blazor-hotreload.js (799 B).
2025-11-12 16:05:19.077 +03:00 [DBG] Connect: guest@localhost:5672/
2025-11-12 16:05:19.211 +03:00 [DBG] Middleware loaded: DOTNET_MODIFIABLE_ASSEMBLIES=debug, __ASPNETCORE_BROWSER_TOOLS=true
2025-11-12 16:05:19.246 +03:00 [DBG] Connected: guest@localhost:5672/ (address: amqp://localhost:5672, local: 62892)
2025-11-12 16:05:19.325 +03:00 [DBG] Endpoint Ready: "rabbitmq://localhost/ECHGHANNAMLP1_BillingSystemAPI_bus_t1syyyyh3bcsypwbbdxnd5bbn7?temporary=true"
2025-11-12 16:05:19.330 +03:00 [INF] Bus started: "rabbitmq://localhost/"
2025-11-12 16:05:19.594 +03:00 [INF] Now listening on: https://localhost:7257
2025-11-12 16:05:19.602 +03:00 [INF] Now listening on: http://localhost:5009
2025-11-12 16:05:19.606 +03:00 [DBG] Loaded hosting startup assembly BillingSystem.API
2025-11-12 16:05:19.612 +03:00 [DBG] Loaded hosting startup assembly Microsoft.WebTools.ApiEndpointDiscovery
2025-11-12 16:05:19.615 +03:00 [DBG] Loaded hosting startup assembly Microsoft.AspNetCore.Watch.BrowserRefresh
2025-11-12 16:05:19.618 +03:00 [DBG] Loaded hosting startup assembly Microsoft.WebTools.BrowserLink.Net
2025-11-12 16:05:19.650 +03:00 [DBG] Connection id "0HNH1TGGT0U62" received FIN.
2025-11-12 16:05:19.652 +03:00 [DBG] Connection id "0HNH1TGGT0U62" accepted.
2025-11-12 16:05:19.667 +03:00 [DBG] Connection id "0HNH1TGGT0U62" started.
2025-11-12 16:05:19.708 +03:00 [DBG] Failed to authenticate HTTPS connection.
System.IO.IOException: Received an unexpected EOF or 0 bytes from the transport stream.
   at System.Net.Security.SslStream.ReceiveHandshakeFrameAsync[TIOAdapter](CancellationToken cancellationToken)
   at System.Net.Security.SslStream.ForceAuthenticationAsync[TIOAdapter](Boolean receiveFirst, Byte[] reAuthenticationData, CancellationToken cancellationToken)
   at System.Net.Security.SslStream.ProcessAuthenticationWithTelemetryAsync(Boolean isAsync, CancellationToken cancellationToken)
   at Microsoft.AspNetCore.Server.Kestrel.Https.Internal.HttpsConnectionMiddleware.OnConnectionAsync(ConnectionContext context)
2025-11-12 16:05:19.758 +03:00 [DBG] Connection id "0HNH1TGGT0U62" stopped.
2025-11-12 16:05:19.771 +03:00 [DBG] Connection id "0HNH1TGGT0U62" sending FIN because: "The Socket transport's send loop completed gracefully."
2025-11-12 16:05:19.842 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-11-12 16:05:19.844 +03:00 [INF] Hosting environment: Development
2025-11-12 16:05:19.850 +03:00 [INF] Content root path: C:\Repositories\Gac-BillingSystem\src\BillingSystem.API
2025-11-12 16:05:19.855 +03:00 [DBG] Hosting started
2025-11-12 16:05:20.455 +03:00 [DBG] Connection id "0HNH1TGGT0U63" accepted.
2025-11-12 16:05:20.459 +03:00 [DBG] Connection id "0HNH1TGGT0U63" started.
2025-11-12 16:05:20.545 +03:00 [DBG] Connection 0HNH1TGGT0U63 established using the following protocol: "Tls13"
2025-11-12 16:05:20.651 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7257/swagger/index.html - null null
2025-11-12 16:05:20.738 +03:00 [DBG] Wildcard detected, all requests with hosts will be allowed.
2025-11-12 16:05:20.773 +03:00 [DBG] No candidates found for the request path '/swagger/index.html'
2025-11-12 16:05:20.782 +03:00 [DBG] Request did not match any endpoints
2025-11-12 16:05:20.893 +03:00 [DBG] Response markup is scheduled to include Browser Link script injection.
2025-11-12 16:05:20.901 +03:00 [DBG] Response markup is scheduled to include browser refresh script injection.
2025-11-12 16:05:20.946 +03:00 [INF] HTTP GET /swagger/index.html responded 200 in 150.3206 ms
2025-11-12 16:05:20.958 +03:00 [DBG] Response markup was updated to include Browser Link script injection.
2025-11-12 16:05:20.963 +03:00 [DBG] Response markup was updated to include browser refresh script injection.
2025-11-12 16:05:20.972 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7257/swagger/index.html - 200 null text/html;charset=utf-8 337.0255ms
2025-11-12 16:05:21.009 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7257/_framework/aspnetcore-browser-refresh.js - null null
2025-11-12 16:05:21.021 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7257/_vs/browserLink - null null
2025-11-12 16:05:21.027 +03:00 [DBG] Script injected: /_framework/aspnetcore-browser-refresh.js
2025-11-12 16:05:21.035 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7257/_framework/aspnetcore-browser-refresh.js - 200 16519 application/javascript; charset=utf-8 26.5148ms
2025-11-12 16:05:21.117 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7257/_vs/browserLink - 200 null text/javascript; charset=UTF-8 95.2649ms
2025-11-12 16:05:21.343 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7257/swagger/v1/swagger.json - null null
2025-11-12 16:05:21.355 +03:00 [DBG] No candidates found for the request path '/swagger/v1/swagger.json'
2025-11-12 16:05:21.360 +03:00 [DBG] Request did not match any endpoints
2025-11-12 16:05:21.392 +03:00 [INF] HTTP GET /swagger/v1/swagger.json responded 200 in 26.2593 ms
2025-11-12 16:05:21.405 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7257/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 63.0507ms
2025-11-12 16:06:01.272 +03:00 [DBG] Connection id "0HNH1TGGT0U64" accepted.
2025-11-12 16:06:01.273 +03:00 [DBG] Connection id "0HNH1TGGT0U64" received FIN.
2025-11-12 16:06:01.278 +03:00 [DBG] Connection id "0HNH1TGGT0U64" started.
2025-11-12 16:06:01.278 +03:00 [DBG] Connection id "0HNH1TGGT0U65" accepted.
2025-11-12 16:06:01.297 +03:00 [DBG] Failed to authenticate HTTPS connection.
System.IO.IOException: Received an unexpected EOF or 0 bytes from the transport stream.
   at System.Net.Security.SslStream.ReceiveHandshakeFrameAsync[TIOAdapter](CancellationToken cancellationToken)
   at System.Net.Security.SslStream.ForceAuthenticationAsync[TIOAdapter](Boolean receiveFirst, Byte[] reAuthenticationData, CancellationToken cancellationToken)
   at System.Net.Security.SslStream.ProcessAuthenticationWithTelemetryAsync(Boolean isAsync, CancellationToken cancellationToken)
   at Microsoft.AspNetCore.Server.Kestrel.Https.Internal.HttpsConnectionMiddleware.OnConnectionAsync(ConnectionContext context)
2025-11-12 16:06:01.298 +03:00 [DBG] Connection id "0HNH1TGGT0U65" started.
2025-11-12 16:06:01.304 +03:00 [DBG] Connection id "0HNH1TGGT0U64" stopped.
2025-11-12 16:06:01.308 +03:00 [DBG] Connection id "0HNH1TGGT0U64" sending FIN because: "The Socket transport's send loop completed gracefully."
2025-11-12 16:06:01.315 +03:00 [DBG] Connection 0HNH1TGGT0U65 established using the following protocol: "Tls13"
2025-11-12 16:06:01.325 +03:00 [INF] Request starting HTTP/1.1 POST https://localhost:7257/api/Invoices - application/json 1316
2025-11-12 16:06:01.337 +03:00 [DBG] 1 candidate(s) found for the request path '/api/Invoices'
2025-11-12 16:06:01.348 +03:00 [DBG] Endpoint 'BillingSystem.API.Controllers.InvoicesController.Post (BillingSystem.API)' with route pattern 'api/Invoices' is valid for the request path '/api/Invoices'
2025-11-12 16:06:01.353 +03:00 [DBG] Request matched endpoint 'BillingSystem.API.Controllers.InvoicesController.Post (BillingSystem.API)'
2025-11-12 16:06:01.363 +03:00 [DBG] Static files was skipped as the request already matched an endpoint.
2025-11-12 16:06:01.586 +03:00 [DBG] An 'IServiceProvider' was created for internal use by Entity Framework.
2025-11-12 16:06:07.033 +03:00 [INF] Executing endpoint 'BillingSystem.API.Controllers.InvoicesController.Post (BillingSystem.API)'
2025-11-12 16:06:07.069 +03:00 [INF] Route matched with {action = "Post", controller = "Invoices"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Post(BillingSystem.Application.Requests.CreateInvoiceRequest) on controller BillingSystem.API.Controllers.InvoicesController (BillingSystem.API).
2025-11-12 16:06:07.075 +03:00 [DBG] Execution plan of authorization filters (in the following order): ["None"]
2025-11-12 16:06:07.080 +03:00 [DBG] Execution plan of resource filters (in the following order): ["None"]
2025-11-12 16:06:07.086 +03:00 [DBG] Execution plan of action filters (in the following order): ["Microsoft.AspNetCore.Mvc.ModelBinding.UnsupportedContentTypeFilter (Order: -3000)","Microsoft.AspNetCore.Mvc.Infrastructure.ModelStateInvalidFilter (Order: -2000)","BillingSystem.API.ActionFilters.AuditBillingRequestsFilter","BillingSystem.API.ActionFilters.IdempotencyFilter (Order: 0)"]
2025-11-12 16:06:07.091 +03:00 [DBG] Execution plan of exception filters (in the following order): ["None"]
2025-11-12 16:06:07.095 +03:00 [DBG] Execution plan of result filters (in the following order): ["Microsoft.AspNetCore.Mvc.Infrastructure.ClientErrorResultFilter (Order: -2000)","Microsoft.AspNetCore.Mvc.ProducesAttribute (Order: 0)","BillingSystem.API.ActionFilters.IdempotencyFilter (Order: 0)"]
2025-11-12 16:06:07.101 +03:00 [DBG] Executing controller factory for controller BillingSystem.API.Controllers.InvoicesController (BillingSystem.API)
2025-11-12 16:06:07.107 +03:00 [WRN] You do not have a valid license key for the Lucky Penny software MediatR. This is allowed for development and testing scenarios. If you are running in production you are required to have a licensed version. Please visit https://luckypennysoftware.com to obtain a valid license.
2025-11-12 16:06:07.155 +03:00 [DBG] Executed controller factory for controller BillingSystem.API.Controllers.InvoicesController (BillingSystem.API)
2025-11-12 16:06:07.175 +03:00 [DBG] Attempting to bind parameter 'invoiceRequest' of type 'BillingSystem.Application.Requests.CreateInvoiceRequest' ...
2025-11-12 16:06:07.181 +03:00 [DBG] Attempting to bind parameter 'invoiceRequest' of type 'BillingSystem.Application.Requests.CreateInvoiceRequest' using the name '' in request data ...
2025-11-12 16:06:07.187 +03:00 [DBG] Selected input formatter 'Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonInputFormatter' for content type 'application/json'.
2025-11-12 16:06:07.223 +03:00 [DBG] Connection id "0HNH1TGGT0U65", Request id "0HNH1TGGT0U65:00000001": started reading request body.
2025-11-12 16:06:07.228 +03:00 [DBG] Connection id "0HNH1TGGT0U65", Request id "0HNH1TGGT0U65:00000001": done reading request body.
2025-11-12 16:06:07.261 +03:00 [DBG] JSON input formatter succeeded, deserializing to type 'BillingSystem.Application.Requests.CreateInvoiceRequest'
2025-11-12 16:06:07.265 +03:00 [DBG] Done attempting to bind parameter 'invoiceRequest' of type 'BillingSystem.Application.Requests.CreateInvoiceRequest'.
2025-11-12 16:06:07.267 +03:00 [DBG] Done attempting to bind parameter 'invoiceRequest' of type 'BillingSystem.Application.Requests.CreateInvoiceRequest'.
2025-11-12 16:06:07.271 +03:00 [DBG] Attempting to validate the bound parameter 'invoiceRequest' of type 'BillingSystem.Application.Requests.CreateInvoiceRequest' ...
2025-11-12 16:06:07.300 +03:00 [DBG] Done attempting to validate the bound parameter 'invoiceRequest' of type 'BillingSystem.Application.Requests.CreateInvoiceRequest'.
2025-11-12 16:06:07.657 +03:00 [DBG] No relationship from 'Invoice' to 'Invoice' has been configured by convention because there are multiple properties on one entity type - {'DiscountedPrimaryInvoice'} that could be matched with the properties on the other entity type - {'InverseDiscountedPrimaryInvoice', 'InversePrimaryInvoice', 'InverseSubstitutionPrimaryInvoice', 'PrimaryInvoice', 'SubstitutionPrimaryInvoice'}. This message can be disregarded if explicit configuration has been specified in 'OnModelCreating'.
2025-11-12 16:06:07.911 +03:00 [DBG] No relationship from 'Invoice' to 'Invoice' has been configured by convention because there are multiple properties on one entity type - {'DiscountedPrimaryInvoice'} that could be matched with the properties on the other entity type - {'InverseDiscountedPrimaryInvoice', 'InversePrimaryInvoice', 'InverseSubstitutionPrimaryInvoice', 'PrimaryInvoice', 'SubstitutionPrimaryInvoice'}. This message can be disregarded if explicit configuration has been specified in 'OnModelCreating'.
2025-11-12 16:06:07.932 +03:00 [DBG] No relationship from 'Invoice' to 'Invoice' has been configured by convention because there are multiple properties on one entity type - {'InversePrimaryInvoice'} that could be matched with the properties on the other entity type - {'InverseSubstitutionPrimaryInvoice', 'PrimaryInvoice', 'SubstitutionPrimaryInvoice'}. This message can be disregarded if explicit configuration has been specified in 'OnModelCreating'.
2025-11-12 16:06:07.941 +03:00 [DBG] No relationship from 'Invoice' to 'Invoice' has been configured by convention because there are multiple properties on one entity type - {'InversePrimaryInvoice'} that could be matched with the properties on the other entity type - {'InverseSubstitutionPrimaryInvoice', 'PrimaryInvoice', 'SubstitutionPrimaryInvoice'}. This message can be disregarded if explicit configuration has been specified in 'OnModelCreating'.
2025-11-12 16:06:08.325 +03:00 [DBG] Entity Framework Core 9.0.9 initialized 'BillingServiceDBContext' using provider 'Microsoft.EntityFrameworkCore.SqlServer:9.0.9' with options: EngineType=SqlServer 
2025-11-12 16:06:08.471 +03:00 [DBG] Compiling query expression: 
'DbSet<Invoice>()
    .AsNoTracking()
    .Any(inv => inv.ExternalId.ToString() == __idempotentKey_0)'
2025-11-12 16:06:08.914 +03:00 [DBG] Generated query execution expression: 
'queryContext => ShapedQueryCompilingExpressionVisitor.SingleAsync<bool>(
    asyncEnumerable: SingleQueryingEnumerable.Create<bool>(
        relationalQueryContext: (RelationalQueryContext)queryContext, 
        relationalCommandResolver: parameters => [LIFTABLE Constant: RelationalCommandCache.QueryExpression(
            Projection Mapping:
                EmptyProjectionMember -> 0
            SELECT EXISTS (
                SELECT 1
                FROM Invoices AS i
                WHERE COALESCE(CONVERT(varchar(36), i.ExternalId), '') == @__idempotentKey_0)) | Resolver: c => new RelationalCommandCache(
            c.Dependencies.MemoryCache, 
            c.RelationalDependencies.QuerySqlGeneratorFactory, 
            c.RelationalDependencies.RelationalParameterBasedSqlProcessorFactory, 
            Projection Mapping:
                EmptyProjectionMember -> 0
            SELECT EXISTS (
                SELECT 1
                FROM Invoices AS i
                WHERE COALESCE(CONVERT(varchar(36), i.ExternalId), '') == @__idempotentKey_0), 
            False, 
            new HashSet<string>(
                new string[]{ }, 
                StringComparer.Ordinal
            )
        )].GetRelationalCommandTemplate(parameters), 
        readerColumns: null, 
        shaper: (queryContext, dataReader, resultContext, resultCoordinator) => 
        {
            bool? value1;
            value1 = dataReader.IsDBNull(0) ? default(bool?) : (bool?)dataReader.GetBoolean(0);
            return (bool)value1;
        }, 
        contextType: BillingSystem.Infrastructure.EF.BillingServiceDBContext, 
        standAloneStateManager: False, 
        detailedErrorsEnabled: False, 
        threadSafetyChecksEnabled: True), 
    cancellationToken: queryContext.CancellationToken)'
2025-11-12 16:06:09.017 +03:00 [DBG] Creating DbConnection.
2025-11-12 16:06:09.058 +03:00 [DBG] Created DbConnection. (36ms).
2025-11-12 16:06:09.074 +03:00 [DBG] Opening connection to database 'GAC-BillingService' on server '.'.
2025-11-12 16:06:09.555 +03:00 [DBG] Opened connection to database 'GAC-BillingService' on server '.'.
2025-11-12 16:06:09.573 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-11-12 16:06:09.599 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (17ms).
2025-11-12 16:06:09.627 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (54ms).
2025-11-12 16:06:09.652 +03:00 [DBG] Executing DbCommand [Parameters=[@__idempotentKey_0='?' (Size = 36) (DbType = AnsiString)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [Invoices] AS [i]
        WHERE CONVERT(varchar(36), [i].[ExternalId]) = @__idempotentKey_0) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2025-11-12 16:06:09.772 +03:00 [INF] Executed DbCommand (122ms) [Parameters=[@__idempotentKey_0='?' (Size = 36) (DbType = AnsiString)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [Invoices] AS [i]
        WHERE CONVERT(varchar(36), [i].[ExternalId]) = @__idempotentKey_0) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2025-11-12 16:06:09.823 +03:00 [DBG] Closing data reader to 'GAC-BillingService' on server '.'.
2025-11-12 16:06:09.843 +03:00 [DBG] A data reader for 'GAC-BillingService' on server '.' is being disposed after spending 48ms reading results.
2025-11-12 16:06:09.857 +03:00 [DBG] Closing connection to database 'GAC-BillingService' on server '.'.
2025-11-12 16:06:09.881 +03:00 [DBG] Closed connection to database 'GAC-BillingService' on server '.' (24ms).
2025-11-12 16:06:10.180 +03:00 [WRN] You do not have a valid license key for the Lucky Penny software AutoMapper. This is allowed for development and testing scenarios. If you are running in production you are required to have a licensed version. Please visit https://luckypennysoftware.com to obtain a valid license.
2025-11-12 16:06:19.357 +03:00 [DBG] Opening connection to database 'GAC-BillingService' on server '.'.
2025-11-12 16:06:19.372 +03:00 [DBG] Opened connection to database 'GAC-BillingService' on server '.'.
2025-11-12 16:06:19.390 +03:00 [DBG] Beginning transaction with isolation level 'Unspecified'.
2025-11-12 16:06:19.413 +03:00 [DBG] Began transaction with isolation level 'ReadCommitted'.
2025-11-12 16:06:31.306 +03:00 [DBG] 'BillingServiceDBContext' generated a temporary value for the property 'Invoice.Id'. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-11-12 16:06:31.447 +03:00 [DBG] Context 'BillingServiceDBContext' started tracking 'Invoice' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-11-12 16:06:31.455 +03:00 [DBG] 'BillingServiceDBContext' generated a temporary value for the property 'Customer.Id'. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-11-12 16:06:31.532 +03:00 [DBG] The foreign key property 'Invoice.CustomerId' was detected as changed. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see property values.
2025-11-12 16:06:31.566 +03:00 [DBG] Context 'BillingServiceDBContext' started tracking 'Customer' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-11-12 16:17:16.761 +03:00 [DBG] Registered model binder providers, in the following order: ["Microsoft.AspNetCore.Mvc.ModelBinding.Binders.BinderTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ServicesModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.BodyModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.HeaderModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FloatingPointTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.EnumTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.DateTimeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.SimpleTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.TryParseModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.CancellationTokenModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ByteArrayModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FormFileModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FormCollectionModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.KeyValuePairModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.DictionaryModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ArrayModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.CollectionModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ComplexObjectModelBinderProvider"]
2025-11-12 16:17:16.925 +03:00 [DBG] Hosting starting
2025-11-12 16:17:17.264 +03:00 [DBG] Starting bus instances: IBus
2025-11-12 16:17:17.274 +03:00 [DBG] Starting bus: "rabbitmq://localhost/"
2025-11-12 16:17:17.309 +03:00 [DBG] Middleware loaded
2025-11-12 16:17:17.315 +03:00 [DBG] Middleware loaded. Script /_framework/aspnetcore-browser-refresh.js (16519 B).
2025-11-12 16:17:17.333 +03:00 [DBG] Middleware loaded. Script /_framework/blazor-hotreload.js (799 B).
2025-11-12 16:17:17.340 +03:00 [DBG] Connect: guest@localhost:5672/
2025-11-12 16:17:17.496 +03:00 [DBG] Middleware loaded: DOTNET_MODIFIABLE_ASSEMBLIES=debug, __ASPNETCORE_BROWSER_TOOLS=true
2025-11-12 16:17:17.525 +03:00 [DBG] Connected: guest@localhost:5672/ (address: amqp://localhost:5672, local: 59134)
2025-11-12 16:17:17.584 +03:00 [DBG] Endpoint Ready: "rabbitmq://localhost/ECHGHANNAMLP1_BillingSystemAPI_bus_7diyyyyh3bcsy9gmbdxnd5qpd9?temporary=true"
2025-11-12 16:17:17.589 +03:00 [INF] Bus started: "rabbitmq://localhost/"
2025-11-12 16:17:17.845 +03:00 [INF] Now listening on: https://localhost:7257
2025-11-12 16:17:17.850 +03:00 [INF] Now listening on: http://localhost:5009
2025-11-12 16:17:17.855 +03:00 [DBG] Loaded hosting startup assembly BillingSystem.API
2025-11-12 16:17:17.858 +03:00 [DBG] Loaded hosting startup assembly Microsoft.WebTools.ApiEndpointDiscovery
2025-11-12 16:17:17.861 +03:00 [DBG] Loaded hosting startup assembly Microsoft.AspNetCore.Watch.BrowserRefresh
2025-11-12 16:17:17.865 +03:00 [DBG] Loaded hosting startup assembly Microsoft.WebTools.BrowserLink.Net
2025-11-12 16:17:17.936 +03:00 [DBG] Connection id "0HNH1TN6V4AFI" accepted.
2025-11-12 16:17:17.943 +03:00 [DBG] Connection id "0HNH1TN6V4AFI" started.
2025-11-12 16:17:17.961 +03:00 [DBG] Connection id "0HNH1TN6V4AFI" received FIN.
2025-11-12 16:17:17.988 +03:00 [DBG] Failed to authenticate HTTPS connection.
System.IO.IOException: Received an unexpected EOF or 0 bytes from the transport stream.
   at System.Net.Security.SslStream.ReceiveHandshakeFrameAsync[TIOAdapter](CancellationToken cancellationToken)
   at System.Net.Security.SslStream.ForceAuthenticationAsync[TIOAdapter](Boolean receiveFirst, Byte[] reAuthenticationData, CancellationToken cancellationToken)
   at System.Net.Security.SslStream.ProcessAuthenticationWithTelemetryAsync(Boolean isAsync, CancellationToken cancellationToken)
   at Microsoft.AspNetCore.Server.Kestrel.Https.Internal.HttpsConnectionMiddleware.OnConnectionAsync(ConnectionContext context)
2025-11-12 16:17:18.021 +03:00 [DBG] Connection id "0HNH1TN6V4AFI" stopped.
2025-11-12 16:17:18.027 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-11-12 16:17:18.030 +03:00 [INF] Hosting environment: Development
2025-11-12 16:17:18.033 +03:00 [DBG] Connection id "0HNH1TN6V4AFI" sending FIN because: "The Socket transport's send loop completed gracefully."
2025-11-12 16:17:18.033 +03:00 [INF] Content root path: C:\Repositories\Gac-BillingSystem\src\BillingSystem.API
2025-11-12 16:17:18.042 +03:00 [DBG] Hosting started
2025-11-12 16:17:18.565 +03:00 [DBG] Connection id "0HNH1TN6V4AFJ" accepted.
2025-11-12 16:17:18.567 +03:00 [DBG] Connection id "0HNH1TN6V4AFJ" started.
2025-11-12 16:17:18.636 +03:00 [DBG] Connection 0HNH1TN6V4AFJ established using the following protocol: "Tls13"
2025-11-12 16:17:18.717 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7257/swagger/index.html - null null
2025-11-12 16:17:18.779 +03:00 [DBG] Wildcard detected, all requests with hosts will be allowed.
2025-11-12 16:17:18.797 +03:00 [DBG] No candidates found for the request path '/swagger/index.html'
2025-11-12 16:17:18.800 +03:00 [DBG] Request did not match any endpoints
2025-11-12 16:17:18.878 +03:00 [DBG] Response markup is scheduled to include Browser Link script injection.
2025-11-12 16:17:18.881 +03:00 [DBG] Response markup is scheduled to include browser refresh script injection.
2025-11-12 16:17:18.908 +03:00 [INF] HTTP GET /swagger/index.html responded 200 in 98.6941 ms
2025-11-12 16:17:18.916 +03:00 [DBG] Response markup was updated to include Browser Link script injection.
2025-11-12 16:17:18.920 +03:00 [DBG] Response markup was updated to include browser refresh script injection.
2025-11-12 16:17:18.927 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7257/swagger/index.html - 200 null text/html;charset=utf-8 218.5298ms
2025-11-12 16:17:18.945 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7257/_framework/aspnetcore-browser-refresh.js - null null
2025-11-12 16:17:18.958 +03:00 [DBG] Script injected: /_framework/aspnetcore-browser-refresh.js
2025-11-12 16:17:18.962 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7257/_framework/aspnetcore-browser-refresh.js - 200 16519 application/javascript; charset=utf-8 17.4535ms
2025-11-12 16:17:18.974 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7257/_vs/browserLink - null null
2025-11-12 16:17:19.032 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7257/_vs/browserLink - 200 null text/javascript; charset=UTF-8 58.1714ms
2025-11-12 16:17:19.095 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7257/swagger/v1/swagger.json - null null
2025-11-12 16:17:19.103 +03:00 [DBG] No candidates found for the request path '/swagger/v1/swagger.json'
2025-11-12 16:17:19.106 +03:00 [DBG] Request did not match any endpoints
2025-11-12 16:17:19.131 +03:00 [INF] HTTP GET /swagger/v1/swagger.json responded 200 in 22.8551 ms
2025-11-12 16:17:19.144 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7257/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 49.1095ms
2025-11-12 16:35:39.385 +03:00 [DBG] Connection id "0HNH1TN6V4AFJ" received FIN.
2025-11-12 16:35:39.404 +03:00 [DBG] The connection queue processing loop for 0HNH1TN6V4AFJ completed.
2025-11-12 16:35:39.408 +03:00 [DBG] Connection id "0HNH1TN6V4AFJ" is closed. The last processed stream ID was 7.
2025-11-12 16:35:39.416 +03:00 [DBG] Connection id "0HNH1TN6V4AFJ" sending FIN because: "The Socket transport's send loop completed gracefully."
2025-11-12 16:35:39.428 +03:00 [DBG] Connection id "0HNH1TN6V4AFJ" stopped.
2025-11-12 16:51:59.882 +03:00 [DBG] Connection id "0HNH1TN6V4AFK" received FIN.
2025-11-12 16:51:59.918 +03:00 [DBG] Connection id "0HNH1TN6V4AFK" accepted.
2025-11-12 16:52:00.008 +03:00 [DBG] Connection id "0HNH1TN6V4AFL" accepted.
2025-11-12 16:52:00.009 +03:00 [DBG] Connection id "0HNH1TN6V4AFK" started.
2025-11-12 16:52:00.062 +03:00 [DBG] Connection id "0HNH1TN6V4AFL" started.
2025-11-12 16:52:00.080 +03:00 [DBG] Failed to authenticate HTTPS connection.
System.IO.IOException: Received an unexpected EOF or 0 bytes from the transport stream.
   at System.Net.Security.SslStream.ReceiveHandshakeFrameAsync[TIOAdapter](CancellationToken cancellationToken)
   at System.Net.Security.SslStream.ForceAuthenticationAsync[TIOAdapter](Boolean receiveFirst, Byte[] reAuthenticationData, CancellationToken cancellationToken)
   at System.Net.Security.SslStream.ProcessAuthenticationWithTelemetryAsync(Boolean isAsync, CancellationToken cancellationToken)
   at Microsoft.AspNetCore.Server.Kestrel.Https.Internal.HttpsConnectionMiddleware.OnConnectionAsync(ConnectionContext context)
2025-11-12 16:52:00.094 +03:00 [DBG] Connection 0HNH1TN6V4AFL established using the following protocol: "Tls13"
2025-11-12 16:52:00.101 +03:00 [DBG] Connection id "0HNH1TN6V4AFK" stopped.
2025-11-12 16:52:00.108 +03:00 [DBG] Connection id "0HNH1TN6V4AFK" sending FIN because: "The Socket transport's send loop completed gracefully."
2025-11-12 16:52:00.111 +03:00 [INF] Request starting HTTP/1.1 POST https://localhost:7257/api/Invoices - application/json 1316
2025-11-12 16:52:00.125 +03:00 [DBG] 1 candidate(s) found for the request path '/api/Invoices'
2025-11-12 16:52:00.135 +03:00 [DBG] Endpoint 'BillingSystem.API.Controllers.InvoicesController.Post (BillingSystem.API)' with route pattern 'api/Invoices' is valid for the request path '/api/Invoices'
2025-11-12 16:52:00.141 +03:00 [DBG] Request matched endpoint 'BillingSystem.API.Controllers.InvoicesController.Post (BillingSystem.API)'
2025-11-12 16:52:00.148 +03:00 [DBG] Static files was skipped as the request already matched an endpoint.
2025-11-12 16:52:00.346 +03:00 [DBG] An 'IServiceProvider' was created for internal use by Entity Framework.
2025-11-12 16:52:05.903 +03:00 [INF] Executing endpoint 'BillingSystem.API.Controllers.InvoicesController.Post (BillingSystem.API)'
2025-11-12 16:52:05.942 +03:00 [INF] Route matched with {action = "Post", controller = "Invoices"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Post(BillingSystem.Application.Requests.CreateInvoiceRequest) on controller BillingSystem.API.Controllers.InvoicesController (BillingSystem.API).
2025-11-12 16:52:05.951 +03:00 [DBG] Execution plan of authorization filters (in the following order): ["None"]
2025-11-12 16:52:05.958 +03:00 [DBG] Execution plan of resource filters (in the following order): ["None"]
2025-11-12 16:52:05.962 +03:00 [DBG] Execution plan of action filters (in the following order): ["Microsoft.AspNetCore.Mvc.ModelBinding.UnsupportedContentTypeFilter (Order: -3000)","Microsoft.AspNetCore.Mvc.Infrastructure.ModelStateInvalidFilter (Order: -2000)","BillingSystem.API.ActionFilters.AuditBillingRequestsFilter","BillingSystem.API.ActionFilters.IdempotencyFilter (Order: 0)"]
2025-11-12 16:52:05.974 +03:00 [DBG] Execution plan of exception filters (in the following order): ["None"]
2025-11-12 16:52:05.978 +03:00 [DBG] Execution plan of result filters (in the following order): ["Microsoft.AspNetCore.Mvc.Infrastructure.ClientErrorResultFilter (Order: -2000)","Microsoft.AspNetCore.Mvc.ProducesAttribute (Order: 0)","BillingSystem.API.ActionFilters.IdempotencyFilter (Order: 0)"]
2025-11-12 16:52:05.992 +03:00 [DBG] Executing controller factory for controller BillingSystem.API.Controllers.InvoicesController (BillingSystem.API)
2025-11-12 16:52:06.005 +03:00 [WRN] You do not have a valid license key for the Lucky Penny software MediatR. This is allowed for development and testing scenarios. If you are running in production you are required to have a licensed version. Please visit https://luckypennysoftware.com to obtain a valid license.
2025-11-12 16:52:06.087 +03:00 [DBG] Executed controller factory for controller BillingSystem.API.Controllers.InvoicesController (BillingSystem.API)
2025-11-12 16:52:06.115 +03:00 [DBG] Attempting to bind parameter 'invoiceRequest' of type 'BillingSystem.Application.Requests.CreateInvoiceRequest' ...
2025-11-12 16:52:06.125 +03:00 [DBG] Attempting to bind parameter 'invoiceRequest' of type 'BillingSystem.Application.Requests.CreateInvoiceRequest' using the name '' in request data ...
2025-11-12 16:52:06.134 +03:00 [DBG] Selected input formatter 'Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonInputFormatter' for content type 'application/json'.
2025-11-12 16:52:06.209 +03:00 [DBG] Connection id "0HNH1TN6V4AFL", Request id "0HNH1TN6V4AFL:00000001": started reading request body.
2025-11-12 16:52:06.216 +03:00 [DBG] Connection id "0HNH1TN6V4AFL", Request id "0HNH1TN6V4AFL:00000001": done reading request body.
2025-11-12 16:52:06.280 +03:00 [DBG] JSON input formatter succeeded, deserializing to type 'BillingSystem.Application.Requests.CreateInvoiceRequest'
2025-11-12 16:52:06.287 +03:00 [DBG] Done attempting to bind parameter 'invoiceRequest' of type 'BillingSystem.Application.Requests.CreateInvoiceRequest'.
2025-11-12 16:52:06.293 +03:00 [DBG] Done attempting to bind parameter 'invoiceRequest' of type 'BillingSystem.Application.Requests.CreateInvoiceRequest'.
2025-11-12 16:52:06.295 +03:00 [DBG] Attempting to validate the bound parameter 'invoiceRequest' of type 'BillingSystem.Application.Requests.CreateInvoiceRequest' ...
2025-11-12 16:52:06.332 +03:00 [DBG] Done attempting to validate the bound parameter 'invoiceRequest' of type 'BillingSystem.Application.Requests.CreateInvoiceRequest'.
2025-11-12 16:52:06.690 +03:00 [DBG] No relationship from 'Invoice' to 'Invoice' has been configured by convention because there are multiple properties on one entity type - {'DiscountedPrimaryInvoice'} that could be matched with the properties on the other entity type - {'InverseDiscountedPrimaryInvoice', 'InversePrimaryInvoice', 'InverseSubstitutionPrimaryInvoice', 'PrimaryInvoice', 'SubstitutionPrimaryInvoice'}. This message can be disregarded if explicit configuration has been specified in 'OnModelCreating'.
2025-11-12 16:52:06.999 +03:00 [DBG] No relationship from 'Invoice' to 'Invoice' has been configured by convention because there are multiple properties on one entity type - {'DiscountedPrimaryInvoice'} that could be matched with the properties on the other entity type - {'InverseDiscountedPrimaryInvoice', 'InversePrimaryInvoice', 'InverseSubstitutionPrimaryInvoice', 'PrimaryInvoice', 'SubstitutionPrimaryInvoice'}. This message can be disregarded if explicit configuration has been specified in 'OnModelCreating'.
2025-11-12 16:52:07.014 +03:00 [DBG] No relationship from 'Invoice' to 'Invoice' has been configured by convention because there are multiple properties on one entity type - {'InversePrimaryInvoice'} that could be matched with the properties on the other entity type - {'InverseSubstitutionPrimaryInvoice', 'PrimaryInvoice', 'SubstitutionPrimaryInvoice'}. This message can be disregarded if explicit configuration has been specified in 'OnModelCreating'.
2025-11-12 16:52:07.029 +03:00 [DBG] No relationship from 'Invoice' to 'Invoice' has been configured by convention because there are multiple properties on one entity type - {'InversePrimaryInvoice'} that could be matched with the properties on the other entity type - {'InverseSubstitutionPrimaryInvoice', 'PrimaryInvoice', 'SubstitutionPrimaryInvoice'}. This message can be disregarded if explicit configuration has been specified in 'OnModelCreating'.
2025-11-12 16:52:07.520 +03:00 [DBG] Entity Framework Core 9.0.9 initialized 'BillingServiceDBContext' using provider 'Microsoft.EntityFrameworkCore.SqlServer:9.0.9' with options: EngineType=SqlServer 
2025-11-12 16:52:07.672 +03:00 [DBG] Compiling query expression: 
'DbSet<Invoice>()
    .AsNoTracking()
    .Any(inv => inv.ExternalId.ToString() == __idempotentKey_0)'
2025-11-12 16:52:08.107 +03:00 [DBG] Generated query execution expression: 
'queryContext => ShapedQueryCompilingExpressionVisitor.SingleAsync<bool>(
    asyncEnumerable: SingleQueryingEnumerable.Create<bool>(
        relationalQueryContext: (RelationalQueryContext)queryContext, 
        relationalCommandResolver: parameters => [LIFTABLE Constant: RelationalCommandCache.QueryExpression(
            Projection Mapping:
                EmptyProjectionMember -> 0
            SELECT EXISTS (
                SELECT 1
                FROM Invoices AS i
                WHERE COALESCE(CONVERT(varchar(36), i.ExternalId), '') == @__idempotentKey_0)) | Resolver: c => new RelationalCommandCache(
            c.Dependencies.MemoryCache, 
            c.RelationalDependencies.QuerySqlGeneratorFactory, 
            c.RelationalDependencies.RelationalParameterBasedSqlProcessorFactory, 
            Projection Mapping:
                EmptyProjectionMember -> 0
            SELECT EXISTS (
                SELECT 1
                FROM Invoices AS i
                WHERE COALESCE(CONVERT(varchar(36), i.ExternalId), '') == @__idempotentKey_0), 
            False, 
            new HashSet<string>(
                new string[]{ }, 
                StringComparer.Ordinal
            )
        )].GetRelationalCommandTemplate(parameters), 
        readerColumns: null, 
        shaper: (queryContext, dataReader, resultContext, resultCoordinator) => 
        {
            bool? value1;
            value1 = dataReader.IsDBNull(0) ? default(bool?) : (bool?)dataReader.GetBoolean(0);
            return (bool)value1;
        }, 
        contextType: BillingSystem.Infrastructure.EF.BillingServiceDBContext, 
        standAloneStateManager: False, 
        detailedErrorsEnabled: False, 
        threadSafetyChecksEnabled: True), 
    cancellationToken: queryContext.CancellationToken)'
2025-11-12 16:52:08.199 +03:00 [DBG] Creating DbConnection.
2025-11-12 16:52:08.236 +03:00 [DBG] Created DbConnection. (34ms).
2025-11-12 16:52:08.246 +03:00 [DBG] Opening connection to database 'GAC-BillingService' on server '.'.
2025-11-12 16:52:08.688 +03:00 [DBG] Opened connection to database 'GAC-BillingService' on server '.'.
2025-11-12 16:52:08.700 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-11-12 16:52:08.716 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (15ms).
2025-11-12 16:52:08.741 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (42ms).
2025-11-12 16:52:08.762 +03:00 [DBG] Executing DbCommand [Parameters=[@__idempotentKey_0='?' (Size = 36) (DbType = AnsiString)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [Invoices] AS [i]
        WHERE CONVERT(varchar(36), [i].[ExternalId]) = @__idempotentKey_0) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2025-11-12 16:52:08.868 +03:00 [INF] Executed DbCommand (110ms) [Parameters=[@__idempotentKey_0='?' (Size = 36) (DbType = AnsiString)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [Invoices] AS [i]
        WHERE CONVERT(varchar(36), [i].[ExternalId]) = @__idempotentKey_0) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2025-11-12 16:52:08.910 +03:00 [DBG] Closing data reader to 'GAC-BillingService' on server '.'.
2025-11-12 16:52:08.930 +03:00 [DBG] A data reader for 'GAC-BillingService' on server '.' is being disposed after spending 40ms reading results.
2025-11-12 16:52:08.945 +03:00 [DBG] Closing connection to database 'GAC-BillingService' on server '.'.
2025-11-12 16:52:08.967 +03:00 [DBG] Closed connection to database 'GAC-BillingService' on server '.' (22ms).
2025-11-12 16:52:09.202 +03:00 [WRN] You do not have a valid license key for the Lucky Penny software AutoMapper. This is allowed for development and testing scenarios. If you are running in production you are required to have a licensed version. Please visit https://luckypennysoftware.com to obtain a valid license.
2025-11-12 16:52:17.639 +03:00 [DBG] Opening connection to database 'GAC-BillingService' on server '.'.
2025-11-12 16:52:17.645 +03:00 [DBG] Opened connection to database 'GAC-BillingService' on server '.'.
2025-11-12 16:52:17.650 +03:00 [DBG] Beginning transaction with isolation level 'Unspecified'.
2025-11-12 16:52:17.666 +03:00 [DBG] Began transaction with isolation level 'ReadCommitted'.
2025-11-12 16:52:19.230 +03:00 [DBG] 'BillingServiceDBContext' generated a temporary value for the property 'Invoice.Id'. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-11-12 16:52:19.452 +03:00 [DBG] Context 'BillingServiceDBContext' started tracking 'Invoice' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-11-12 16:52:19.459 +03:00 [DBG] 'BillingServiceDBContext' generated a temporary value for the property 'Customer.Id'. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-11-12 16:52:19.545 +03:00 [DBG] The foreign key property 'Invoice.CustomerId' was detected as changed. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see property values.
2025-11-12 16:52:19.573 +03:00 [DBG] Context 'BillingServiceDBContext' started tracking 'Customer' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-11-12 16:52:54.485 +03:00 [ERR] exception occured Self referencing loop detected with type 'BillingSystem.Domain.Entities.Invoice'. Path 'Customer.Invoices'. , stackTrace    at Newtonsoft.Json.Serialization.JsonSerializerInternalWriter.CheckForCircularReference(JsonWriter writer, Object value, JsonProperty property, JsonContract contract, JsonContainerContract containerContract, JsonProperty containerProperty)
   at Newtonsoft.Json.Serialization.JsonSerializerInternalWriter.SerializeList(JsonWriter writer, IEnumerable values, JsonArrayContract contract, JsonProperty member, JsonContainerContract collectionContract, JsonProperty containerProperty)
   at Newtonsoft.Json.Serialization.JsonSerializerInternalWriter.SerializeValue(JsonWriter writer, Object value, JsonContract valueContract, JsonProperty member, JsonContainerContract containerContract, JsonProperty containerProperty)
   at Newtonsoft.Json.Serialization.JsonSerializerInternalWriter.SerializeObject(JsonWriter writer, Object value, JsonObjectContract contract, JsonProperty member, JsonContainerContract collectionContract, JsonProperty containerProperty)
   at Newtonsoft.Json.Serialization.JsonSerializerInternalWriter.SerializeValue(JsonWriter writer, Object value, JsonContract valueContract, JsonProperty member, JsonContainerContract containerContract, JsonProperty containerProperty)
   at Newtonsoft.Json.Serialization.JsonSerializerInternalWriter.SerializeObject(JsonWriter writer, Object value, JsonObjectContract contract, JsonProperty member, JsonContainerContract collectionContract, JsonProperty containerProperty)
   at Newtonsoft.Json.Serialization.JsonSerializerInternalWriter.SerializeValue(JsonWriter writer, Object value, JsonContract valueContract, JsonProperty member, JsonContainerContract containerContract, JsonProperty containerProperty)
   at Newtonsoft.Json.Serialization.JsonSerializerInternalWriter.Serialize(JsonWriter jsonWriter, Object value, Type objectType)
   at Newtonsoft.Json.JsonSerializer.SerializeInternal(JsonWriter jsonWriter, Object value, Type objectType)
   at Newtonsoft.Json.JsonSerializer.Serialize(JsonWriter jsonWriter, Object value, Type objectType)
   at Newtonsoft.Json.JsonConvert.SerializeObjectInternal(Object value, Type type, JsonSerializer jsonSerializer)
   at Newtonsoft.Json.JsonConvert.SerializeObject(Object value, Type type, JsonSerializerSettings settings)
   at Newtonsoft.Json.JsonConvert.SerializeObject(Object value)
   at BillingSystem.Infrastructure.Persistence.EF.InvoiceRepository.Insert(Invoice entity) in C:\Repositories\Gac-BillingSystem\src\BillingSystem.Infrastructure\Persistence\EF\InvoiceRepository.cs:line 69
2025-11-12 16:52:54.518 +03:00 [DBG] Rolling back transaction.
2025-11-12 16:52:54.579 +03:00 [DBG] Rolled back transaction.
2025-11-12 16:52:54.601 +03:00 [DBG] Closing connection to database 'GAC-BillingService' on server '.'.
2025-11-12 16:52:54.633 +03:00 [DBG] Closed connection to database 'GAC-BillingService' on server '.' (34ms).
2025-11-12 16:52:54.690 +03:00 [DBG] Disposing transaction.
2025-11-12 16:52:55.551 +03:00 [DBG] Connection id "0HNH1TN6V4AFM" accepted.
2025-11-12 16:52:55.589 +03:00 [DBG] Connection id "0HNH1TN6V4AFM" started.
2025-11-12 16:52:55.642 +03:00 [DBG] Connection 0HNH1TN6V4AFM established using the following protocol: "Tls13"
2025-11-12 16:52:55.738 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7257/swagger/index.html - null null
2025-11-12 16:52:55.808 +03:00 [DBG] No candidates found for the request path '/swagger/index.html'
2025-11-12 16:52:55.818 +03:00 [DBG] Request did not match any endpoints
2025-11-12 16:52:55.825 +03:00 [DBG] Response markup is scheduled to include Browser Link script injection.
2025-11-12 16:52:55.827 +03:00 [DBG] Response markup is scheduled to include browser refresh script injection.
2025-11-12 16:52:55.850 +03:00 [INF] HTTP GET /swagger/index.html responded 200 in 27.2703 ms
2025-11-12 16:52:56.072 +03:00 [DBG] Response markup was updated to include Browser Link script injection.
2025-11-12 16:52:56.210 +03:00 [DBG] Response markup was updated to include browser refresh script injection.
2025-11-12 16:52:56.239 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7257/swagger/index.html - 200 null text/html;charset=utf-8 500.4765ms
2025-11-12 16:52:56.243 +03:00 [ERR] exception occured Self referencing loop detected with type 'BillingSystem.Domain.Entities.Invoice'. Path 'Customer.Invoices'. , stackTrace    at Newtonsoft.Json.Serialization.JsonSerializerInternalWriter.CheckForCircularReference(JsonWriter writer, Object value, JsonProperty property, JsonContract contract, JsonContainerContract containerContract, JsonProperty containerProperty)
   at Newtonsoft.Json.Serialization.JsonSerializerInternalWriter.SerializeList(JsonWriter writer, IEnumerable values, JsonArrayContract contract, JsonProperty member, JsonContainerContract collectionContract, JsonProperty containerProperty)
   at Newtonsoft.Json.Serialization.JsonSerializerInternalWriter.SerializeValue(JsonWriter writer, Object value, JsonContract valueContract, JsonProperty member, JsonContainerContract containerContract, JsonProperty containerProperty)
   at Newtonsoft.Json.Serialization.JsonSerializerInternalWriter.SerializeObject(JsonWriter writer, Object value, JsonObjectContract contract, JsonProperty member, JsonContainerContract collectionContract, JsonProperty containerProperty)
   at Newtonsoft.Json.Serialization.JsonSerializerInternalWriter.SerializeValue(JsonWriter writer, Object value, JsonContract valueContract, JsonProperty member, JsonContainerContract containerContract, JsonProperty containerProperty)
   at Newtonsoft.Json.Serialization.JsonSerializerInternalWriter.SerializeObject(JsonWriter writer, Object value, JsonObjectContract contract, JsonProperty member, JsonContainerContract collectionContract, JsonProperty containerProperty)
   at Newtonsoft.Json.Serialization.JsonSerializerInternalWriter.SerializeValue(JsonWriter writer, Object value, JsonContract valueContract, JsonProperty member, JsonContainerContract containerContract, JsonProperty containerProperty)
   at Newtonsoft.Json.Serialization.JsonSerializerInternalWriter.Serialize(JsonWriter jsonWriter, Object value, Type objectType)
   at Newtonsoft.Json.JsonSerializer.SerializeInternal(JsonWriter jsonWriter, Object value, Type objectType)
   at Newtonsoft.Json.JsonSerializer.Serialize(JsonWriter jsonWriter, Object value, Type objectType)
   at Newtonsoft.Json.JsonConvert.SerializeObjectInternal(Object value, Type type, JsonSerializer jsonSerializer)
   at Newtonsoft.Json.JsonConvert.SerializeObject(Object value, Type type, JsonSerializerSettings settings)
   at Newtonsoft.Json.JsonConvert.SerializeObject(Object value)
   at BillingSystem.Infrastructure.Persistence.EF.InvoiceRepository.Insert(Invoice entity) in C:\Repositories\Gac-BillingSystem\src\BillingSystem.Infrastructure\Persistence\EF\InvoiceRepository.cs:line 69
   at BillingSystem.Application.Commands.CreateInvoiceCommandRequestHandler.Handle(CreateInvoiceRequest request, CancellationToken cancellationToken) in C:\Repositories\Gac-BillingSystem\src\BillingSystem.Application\Commands\CreateInvoiceCommandRequestHandler.cs:line 39
   at BillingSystem.API.Controllers.InvoicesController.Post(CreateInvoiceRequest invoiceRequest) in C:\Repositories\Gac-BillingSystem\src\BillingSystem.API\Controllers\InvoicesController.cs:line 45
2025-11-12 16:52:56.384 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7257/_framework/aspnetcore-browser-refresh.js - null null
2025-11-12 16:52:56.391 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7257/_vs/browserLink - null null
2025-11-12 16:52:56.456 +03:00 [DBG] List of registered output formatters, in the following order: ["Microsoft.AspNetCore.Mvc.Formatters.HttpNoContentOutputFormatter","Microsoft.AspNetCore.Mvc.Formatters.StringOutputFormatter","Microsoft.AspNetCore.Mvc.Formatters.StreamOutputFormatter","Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonOutputFormatter"]
2025-11-12 16:52:56.501 +03:00 [DBG] Script injected: /_framework/aspnetcore-browser-refresh.js
2025-11-12 16:52:56.645 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7257/_vs/browserLink - 200 null text/javascript; charset=UTF-8 254.3948ms
2025-11-12 16:52:56.654 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7257/_framework/aspnetcore-browser-refresh.js - 200 16519 application/javascript; charset=utf-8 268.1877ms
2025-11-12 16:52:56.654 +03:00 [DBG] No information found on request to perform content negotiation.
2025-11-12 16:52:56.786 +03:00 [DBG] Attempting to select the first output formatter in the output formatters list which supports a content type from the explicitly specified content types '["application/json","application/problem+json","application/problem+xml"]'.
2025-11-12 16:52:56.795 +03:00 [DBG] Selected output formatter 'Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonOutputFormatter' and content type 'application/json' to write the response.
2025-11-12 16:52:56.801 +03:00 [INF] Executing ObjectResult, writing value of type 'Microsoft.AspNetCore.Mvc.ProblemDetails'.
2025-11-12 16:52:56.893 +03:00 [INF] Executed action BillingSystem.API.Controllers.InvoicesController.Post (BillingSystem.API) in 50894.6762ms
2025-11-12 16:52:56.903 +03:00 [INF] Executed endpoint 'BillingSystem.API.Controllers.InvoicesController.Post (BillingSystem.API)'
2025-11-12 16:52:56.911 +03:00 [ERR] HTTP POST /api/Invoices responded 500 in 56763.9700 ms
2025-11-12 16:52:56.931 +03:00 [DBG] Connection id "0HNH1TN6V4AFL" completed keep alive response.
2025-11-12 16:52:56.944 +03:00 [DBG] 'BillingServiceDBContext' disposed.
2025-11-12 16:52:56.981 +03:00 [DBG] Disposing connection to database 'GAC-BillingService' on server '.'.
2025-11-12 16:52:57.008 +03:00 [DBG] Disposed connection to database '' on server '' (33ms).
2025-11-12 16:52:57.014 +03:00 [INF] Request finished HTTP/1.1 POST https://localhost:7257/api/Invoices - 500 null application/json; charset=utf-8 56901.863ms
2025-11-12 16:52:57.438 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7257/swagger/v1/swagger.json - null null
2025-11-12 16:52:57.481 +03:00 [DBG] No candidates found for the request path '/swagger/v1/swagger.json'
2025-11-12 16:52:57.493 +03:00 [DBG] Request did not match any endpoints
2025-11-12 16:52:57.523 +03:00 [INF] HTTP GET /swagger/v1/swagger.json responded 200 in 10.4677 ms
2025-11-12 16:52:57.530 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7257/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 96.785ms
2025-11-12 16:53:40.263 +03:00 [DBG] Registered model binder providers, in the following order: ["Microsoft.AspNetCore.Mvc.ModelBinding.Binders.BinderTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ServicesModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.BodyModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.HeaderModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FloatingPointTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.EnumTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.DateTimeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.SimpleTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.TryParseModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.CancellationTokenModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ByteArrayModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FormFileModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FormCollectionModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.KeyValuePairModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.DictionaryModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ArrayModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.CollectionModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ComplexObjectModelBinderProvider"]
2025-11-12 16:53:40.432 +03:00 [DBG] Hosting starting
2025-11-12 16:53:40.791 +03:00 [DBG] Starting bus instances: IBus
2025-11-12 16:53:40.798 +03:00 [DBG] Starting bus: "rabbitmq://localhost/"
2025-11-12 16:53:40.829 +03:00 [DBG] Middleware loaded
2025-11-12 16:53:40.834 +03:00 [DBG] Middleware loaded. Script /_framework/aspnetcore-browser-refresh.js (16519 B).
2025-11-12 16:53:40.839 +03:00 [DBG] Middleware loaded. Script /_framework/blazor-hotreload.js (799 B).
2025-11-12 16:53:40.854 +03:00 [DBG] Connect: guest@localhost:5672/
2025-11-12 16:53:40.984 +03:00 [DBG] Middleware loaded: DOTNET_MODIFIABLE_ASSEMBLIES=debug, __ASPNETCORE_BROWSER_TOOLS=true
2025-11-12 16:53:41.015 +03:00 [DBG] Connected: guest@localhost:5672/ (address: amqp://localhost:5672, local: 52050)
2025-11-12 16:53:41.083 +03:00 [DBG] Endpoint Ready: "rabbitmq://localhost/ECHGHANNAMLP1_BillingSystemAPI_bus_9ycoyyyh3bcsyfx4bdxndhzn8i?temporary=true"
2025-11-12 16:53:41.087 +03:00 [INF] Bus started: "rabbitmq://localhost/"
2025-11-12 16:53:41.306 +03:00 [INF] Now listening on: https://localhost:7257
2025-11-12 16:53:41.311 +03:00 [INF] Now listening on: http://localhost:5009
2025-11-12 16:53:41.316 +03:00 [DBG] Loaded hosting startup assembly BillingSystem.API
2025-11-12 16:53:41.319 +03:00 [DBG] Loaded hosting startup assembly Microsoft.WebTools.ApiEndpointDiscovery
2025-11-12 16:53:41.322 +03:00 [DBG] Loaded hosting startup assembly Microsoft.AspNetCore.Watch.BrowserRefresh
2025-11-12 16:53:41.324 +03:00 [DBG] Loaded hosting startup assembly Microsoft.WebTools.BrowserLink.Net
2025-11-12 16:53:41.488 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-11-12 16:53:41.492 +03:00 [INF] Hosting environment: Development
2025-11-12 16:53:41.495 +03:00 [INF] Content root path: C:\Repositories\Gac-BillingSystem\src\BillingSystem.API
2025-11-12 16:53:41.499 +03:00 [DBG] Hosting started
2025-11-12 16:53:41.570 +03:00 [DBG] Connection id "0HNH1UBHNS78P" accepted.
2025-11-12 16:53:41.570 +03:00 [DBG] Connection id "0HNH1UBHNS78O" accepted.
2025-11-12 16:53:41.581 +03:00 [DBG] Connection id "0HNH1UBHNS78P" started.
2025-11-12 16:53:41.588 +03:00 [DBG] Connection id "0HNH1UBHNS78O" started.
2025-11-12 16:53:41.588 +03:00 [DBG] Connection id "0HNH1UBHNS78O" received FIN.
2025-11-12 16:53:41.588 +03:00 [DBG] Connection id "0HNH1UBHNS78P" received FIN.
2025-11-12 16:53:41.643 +03:00 [DBG] Failed to authenticate HTTPS connection.
System.IO.IOException: Received an unexpected EOF or 0 bytes from the transport stream.
   at System.Net.Security.SslStream.ReceiveHandshakeFrameAsync[TIOAdapter](CancellationToken cancellationToken)
   at System.Net.Security.SslStream.ForceAuthenticationAsync[TIOAdapter](Boolean receiveFirst, Byte[] reAuthenticationData, CancellationToken cancellationToken)
   at System.Net.Security.SslStream.ProcessAuthenticationWithTelemetryAsync(Boolean isAsync, CancellationToken cancellationToken)
   at Microsoft.AspNetCore.Server.Kestrel.Https.Internal.HttpsConnectionMiddleware.OnConnectionAsync(ConnectionContext context)
2025-11-12 16:53:41.643 +03:00 [DBG] Failed to authenticate HTTPS connection.
System.IO.IOException: Received an unexpected EOF or 0 bytes from the transport stream.
   at System.Net.Security.SslStream.ReceiveHandshakeFrameAsync[TIOAdapter](CancellationToken cancellationToken)
   at System.Net.Security.SslStream.ForceAuthenticationAsync[TIOAdapter](Boolean receiveFirst, Byte[] reAuthenticationData, CancellationToken cancellationToken)
   at System.Net.Security.SslStream.ProcessAuthenticationWithTelemetryAsync(Boolean isAsync, CancellationToken cancellationToken)
   at Microsoft.AspNetCore.Server.Kestrel.Https.Internal.HttpsConnectionMiddleware.OnConnectionAsync(ConnectionContext context)
2025-11-12 16:53:41.677 +03:00 [DBG] Connection id "0HNH1UBHNS78O" stopped.
2025-11-12 16:53:41.680 +03:00 [DBG] Connection id "0HNH1UBHNS78P" stopped.
2025-11-12 16:53:41.692 +03:00 [DBG] Connection id "0HNH1UBHNS78P" sending FIN because: "The Socket transport's send loop completed gracefully."
2025-11-12 16:53:41.692 +03:00 [DBG] Connection id "0HNH1UBHNS78O" sending FIN because: "The Socket transport's send loop completed gracefully."
2025-11-12 16:53:42.282 +03:00 [DBG] Connection id "0HNH1UBHNS78Q" accepted.
2025-11-12 16:53:42.286 +03:00 [DBG] Connection id "0HNH1UBHNS78Q" started.
2025-11-12 16:53:42.353 +03:00 [DBG] Connection 0HNH1UBHNS78Q established using the following protocol: "Tls13"
2025-11-12 16:53:42.432 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7257/swagger/index.html - null null
2025-11-12 16:53:42.487 +03:00 [DBG] Wildcard detected, all requests with hosts will be allowed.
2025-11-12 16:53:42.506 +03:00 [DBG] No candidates found for the request path '/swagger/index.html'
2025-11-12 16:53:42.510 +03:00 [DBG] Request did not match any endpoints
2025-11-12 16:53:42.578 +03:00 [DBG] Response markup is scheduled to include Browser Link script injection.
2025-11-12 16:53:42.583 +03:00 [DBG] Response markup is scheduled to include browser refresh script injection.
2025-11-12 16:53:42.613 +03:00 [INF] HTTP GET /swagger/index.html responded 200 in 95.7149 ms
2025-11-12 16:53:42.623 +03:00 [DBG] Response markup was updated to include Browser Link script injection.
2025-11-12 16:53:42.628 +03:00 [DBG] Response markup was updated to include browser refresh script injection.
2025-11-12 16:53:42.635 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7257/swagger/index.html - 200 null text/html;charset=utf-8 214.5041ms
2025-11-12 16:53:42.683 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7257/_vs/browserLink - null null
2025-11-12 16:53:42.683 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7257/_framework/aspnetcore-browser-refresh.js - null null
2025-11-12 16:53:42.703 +03:00 [DBG] Script injected: /_framework/aspnetcore-browser-refresh.js
2025-11-12 16:53:42.708 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7257/_framework/aspnetcore-browser-refresh.js - 200 16519 application/javascript; charset=utf-8 26.427ms
2025-11-12 16:53:42.748 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7257/_vs/browserLink - 200 null text/javascript; charset=UTF-8 65.8961ms
2025-11-12 16:53:42.862 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7257/swagger/v1/swagger.json - null null
2025-11-12 16:53:42.870 +03:00 [DBG] No candidates found for the request path '/swagger/v1/swagger.json'
2025-11-12 16:53:42.873 +03:00 [DBG] Request did not match any endpoints
2025-11-12 16:53:42.899 +03:00 [INF] HTTP GET /swagger/v1/swagger.json responded 200 in 21.8742 ms
2025-11-12 16:53:42.910 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7257/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 47.7589ms
2025-11-12 16:57:13.463 +03:00 [DBG] Connection id "0HNH1UBHNS78R" accepted.
2025-11-12 16:57:13.463 +03:00 [DBG] Connection id "0HNH1UBHNS78R" received FIN.
2025-11-12 16:57:13.474 +03:00 [DBG] Connection id "0HNH1UBHNS78R" started.
2025-11-12 16:57:13.482 +03:00 [DBG] Connection id "0HNH1UBHNS78S" accepted.
2025-11-12 16:57:13.494 +03:00 [DBG] Failed to authenticate HTTPS connection.
System.IO.IOException: Received an unexpected EOF or 0 bytes from the transport stream.
   at System.Net.Security.SslStream.ReceiveHandshakeFrameAsync[TIOAdapter](CancellationToken cancellationToken)
   at System.Net.Security.SslStream.ForceAuthenticationAsync[TIOAdapter](Boolean receiveFirst, Byte[] reAuthenticationData, CancellationToken cancellationToken)
   at System.Net.Security.SslStream.ProcessAuthenticationWithTelemetryAsync(Boolean isAsync, CancellationToken cancellationToken)
   at Microsoft.AspNetCore.Server.Kestrel.Https.Internal.HttpsConnectionMiddleware.OnConnectionAsync(ConnectionContext context)
2025-11-12 16:57:13.495 +03:00 [DBG] Connection id "0HNH1UBHNS78S" started.
2025-11-12 16:57:13.500 +03:00 [DBG] Connection id "0HNH1UBHNS78R" stopped.
2025-11-12 16:57:13.504 +03:00 [DBG] Connection id "0HNH1UBHNS78R" sending FIN because: "The Socket transport's send loop completed gracefully."
2025-11-12 16:57:13.506 +03:00 [DBG] Connection 0HNH1UBHNS78S established using the following protocol: "Tls13"
2025-11-12 16:57:13.516 +03:00 [INF] Request starting HTTP/1.1 POST https://localhost:7257/api/Invoices - application/json 1316
2025-11-12 16:57:13.527 +03:00 [DBG] 1 candidate(s) found for the request path '/api/Invoices'
2025-11-12 16:57:13.537 +03:00 [DBG] Endpoint 'BillingSystem.API.Controllers.InvoicesController.Post (BillingSystem.API)' with route pattern 'api/Invoices' is valid for the request path '/api/Invoices'
2025-11-12 16:57:13.548 +03:00 [DBG] Request matched endpoint 'BillingSystem.API.Controllers.InvoicesController.Post (BillingSystem.API)'
2025-11-12 16:57:13.559 +03:00 [DBG] Static files was skipped as the request already matched an endpoint.
2025-11-12 16:57:13.783 +03:00 [DBG] An 'IServiceProvider' was created for internal use by Entity Framework.
2025-11-12 16:57:19.214 +03:00 [INF] Executing endpoint 'BillingSystem.API.Controllers.InvoicesController.Post (BillingSystem.API)'
2025-11-12 16:57:19.260 +03:00 [INF] Route matched with {action = "Post", controller = "Invoices"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Post(BillingSystem.Application.Requests.CreateInvoiceRequest) on controller BillingSystem.API.Controllers.InvoicesController (BillingSystem.API).
2025-11-12 16:57:19.269 +03:00 [DBG] Execution plan of authorization filters (in the following order): ["None"]
2025-11-12 16:57:19.274 +03:00 [DBG] Execution plan of resource filters (in the following order): ["None"]
2025-11-12 16:57:19.280 +03:00 [DBG] Execution plan of action filters (in the following order): ["Microsoft.AspNetCore.Mvc.ModelBinding.UnsupportedContentTypeFilter (Order: -3000)","Microsoft.AspNetCore.Mvc.Infrastructure.ModelStateInvalidFilter (Order: -2000)","BillingSystem.API.ActionFilters.AuditBillingRequestsFilter","BillingSystem.API.ActionFilters.IdempotencyFilter (Order: 0)"]
2025-11-12 16:57:19.286 +03:00 [DBG] Execution plan of exception filters (in the following order): ["None"]
2025-11-12 16:57:19.290 +03:00 [DBG] Execution plan of result filters (in the following order): ["Microsoft.AspNetCore.Mvc.Infrastructure.ClientErrorResultFilter (Order: -2000)","Microsoft.AspNetCore.Mvc.ProducesAttribute (Order: 0)","BillingSystem.API.ActionFilters.IdempotencyFilter (Order: 0)"]
2025-11-12 16:57:19.298 +03:00 [DBG] Executing controller factory for controller BillingSystem.API.Controllers.InvoicesController (BillingSystem.API)
2025-11-12 16:57:19.308 +03:00 [WRN] You do not have a valid license key for the Lucky Penny software MediatR. This is allowed for development and testing scenarios. If you are running in production you are required to have a licensed version. Please visit https://luckypennysoftware.com to obtain a valid license.
2025-11-12 16:57:19.369 +03:00 [DBG] Executed controller factory for controller BillingSystem.API.Controllers.InvoicesController (BillingSystem.API)
2025-11-12 16:57:19.392 +03:00 [DBG] Attempting to bind parameter 'invoiceRequest' of type 'BillingSystem.Application.Requests.CreateInvoiceRequest' ...
2025-11-12 16:57:19.399 +03:00 [DBG] Attempting to bind parameter 'invoiceRequest' of type 'BillingSystem.Application.Requests.CreateInvoiceRequest' using the name '' in request data ...
2025-11-12 16:57:19.407 +03:00 [DBG] Selected input formatter 'Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonInputFormatter' for content type 'application/json'.
2025-11-12 16:57:19.456 +03:00 [DBG] Connection id "0HNH1UBHNS78S", Request id "0HNH1UBHNS78S:00000001": started reading request body.
2025-11-12 16:57:19.463 +03:00 [DBG] Connection id "0HNH1UBHNS78S", Request id "0HNH1UBHNS78S:00000001": done reading request body.
2025-11-12 16:57:19.506 +03:00 [DBG] JSON input formatter succeeded, deserializing to type 'BillingSystem.Application.Requests.CreateInvoiceRequest'
2025-11-12 16:57:19.513 +03:00 [DBG] Done attempting to bind parameter 'invoiceRequest' of type 'BillingSystem.Application.Requests.CreateInvoiceRequest'.
2025-11-12 16:57:19.516 +03:00 [DBG] Done attempting to bind parameter 'invoiceRequest' of type 'BillingSystem.Application.Requests.CreateInvoiceRequest'.
2025-11-12 16:57:19.518 +03:00 [DBG] Attempting to validate the bound parameter 'invoiceRequest' of type 'BillingSystem.Application.Requests.CreateInvoiceRequest' ...
2025-11-12 16:57:19.550 +03:00 [DBG] Done attempting to validate the bound parameter 'invoiceRequest' of type 'BillingSystem.Application.Requests.CreateInvoiceRequest'.
2025-11-12 16:57:19.913 +03:00 [DBG] No relationship from 'Invoice' to 'Invoice' has been configured by convention because there are multiple properties on one entity type - {'DiscountedPrimaryInvoice'} that could be matched with the properties on the other entity type - {'InverseDiscountedPrimaryInvoice', 'InversePrimaryInvoice', 'InverseSubstitutionPrimaryInvoice', 'PrimaryInvoice', 'SubstitutionPrimaryInvoice'}. This message can be disregarded if explicit configuration has been specified in 'OnModelCreating'.
2025-11-12 16:57:20.130 +03:00 [DBG] No relationship from 'Invoice' to 'Invoice' has been configured by convention because there are multiple properties on one entity type - {'DiscountedPrimaryInvoice'} that could be matched with the properties on the other entity type - {'InverseDiscountedPrimaryInvoice', 'InversePrimaryInvoice', 'InverseSubstitutionPrimaryInvoice', 'PrimaryInvoice', 'SubstitutionPrimaryInvoice'}. This message can be disregarded if explicit configuration has been specified in 'OnModelCreating'.
2025-11-12 16:57:20.143 +03:00 [DBG] No relationship from 'Invoice' to 'Invoice' has been configured by convention because there are multiple properties on one entity type - {'InversePrimaryInvoice'} that could be matched with the properties on the other entity type - {'InverseSubstitutionPrimaryInvoice', 'PrimaryInvoice', 'SubstitutionPrimaryInvoice'}. This message can be disregarded if explicit configuration has been specified in 'OnModelCreating'.
2025-11-12 16:57:20.152 +03:00 [DBG] No relationship from 'Invoice' to 'Invoice' has been configured by convention because there are multiple properties on one entity type - {'InversePrimaryInvoice'} that could be matched with the properties on the other entity type - {'InverseSubstitutionPrimaryInvoice', 'PrimaryInvoice', 'SubstitutionPrimaryInvoice'}. This message can be disregarded if explicit configuration has been specified in 'OnModelCreating'.
2025-11-12 16:57:20.592 +03:00 [DBG] Entity Framework Core 9.0.9 initialized 'BillingServiceDBContext' using provider 'Microsoft.EntityFrameworkCore.SqlServer:9.0.9' with options: EngineType=SqlServer 
2025-11-12 16:57:20.769 +03:00 [DBG] Compiling query expression: 
'DbSet<Invoice>()
    .AsNoTracking()
    .Any(inv => inv.ExternalId.ToString() == __idempotentKey_0)'
2025-11-12 16:57:21.095 +03:00 [DBG] Generated query execution expression: 
'queryContext => ShapedQueryCompilingExpressionVisitor.SingleAsync<bool>(
    asyncEnumerable: SingleQueryingEnumerable.Create<bool>(
        relationalQueryContext: (RelationalQueryContext)queryContext, 
        relationalCommandResolver: parameters => [LIFTABLE Constant: RelationalCommandCache.QueryExpression(
            Projection Mapping:
                EmptyProjectionMember -> 0
            SELECT EXISTS (
                SELECT 1
                FROM Invoices AS i
                WHERE COALESCE(CONVERT(varchar(36), i.ExternalId), '') == @__idempotentKey_0)) | Resolver: c => new RelationalCommandCache(
            c.Dependencies.MemoryCache, 
            c.RelationalDependencies.QuerySqlGeneratorFactory, 
            c.RelationalDependencies.RelationalParameterBasedSqlProcessorFactory, 
            Projection Mapping:
                EmptyProjectionMember -> 0
            SELECT EXISTS (
                SELECT 1
                FROM Invoices AS i
                WHERE COALESCE(CONVERT(varchar(36), i.ExternalId), '') == @__idempotentKey_0), 
            False, 
            new HashSet<string>(
                new string[]{ }, 
                StringComparer.Ordinal
            )
        )].GetRelationalCommandTemplate(parameters), 
        readerColumns: null, 
        shaper: (queryContext, dataReader, resultContext, resultCoordinator) => 
        {
            bool? value1;
            value1 = dataReader.IsDBNull(0) ? default(bool?) : (bool?)dataReader.GetBoolean(0);
            return (bool)value1;
        }, 
        contextType: BillingSystem.Infrastructure.EF.BillingServiceDBContext, 
        standAloneStateManager: False, 
        detailedErrorsEnabled: False, 
        threadSafetyChecksEnabled: True), 
    cancellationToken: queryContext.CancellationToken)'
2025-11-12 16:57:21.152 +03:00 [DBG] Creating DbConnection.
2025-11-12 16:57:21.176 +03:00 [DBG] Created DbConnection. (22ms).
2025-11-12 16:57:21.185 +03:00 [DBG] Opening connection to database 'GAC-BillingService' on server '.'.
2025-11-12 16:57:21.577 +03:00 [DBG] Opened connection to database 'GAC-BillingService' on server '.'.
2025-11-12 16:57:21.586 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-11-12 16:57:21.601 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (11ms).
2025-11-12 16:57:21.616 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (31ms).
2025-11-12 16:57:21.629 +03:00 [DBG] Executing DbCommand [Parameters=[@__idempotentKey_0='?' (Size = 36) (DbType = AnsiString)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [Invoices] AS [i]
        WHERE CONVERT(varchar(36), [i].[ExternalId]) = @__idempotentKey_0) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2025-11-12 16:57:21.720 +03:00 [INF] Executed DbCommand (88ms) [Parameters=[@__idempotentKey_0='?' (Size = 36) (DbType = AnsiString)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [Invoices] AS [i]
        WHERE CONVERT(varchar(36), [i].[ExternalId]) = @__idempotentKey_0) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2025-11-12 16:57:21.772 +03:00 [DBG] Closing data reader to 'GAC-BillingService' on server '.'.
2025-11-12 16:57:21.802 +03:00 [DBG] A data reader for 'GAC-BillingService' on server '.' is being disposed after spending 61ms reading results.
2025-11-12 16:57:21.813 +03:00 [DBG] Closing connection to database 'GAC-BillingService' on server '.'.
2025-11-12 16:57:21.825 +03:00 [DBG] Closed connection to database 'GAC-BillingService' on server '.' (12ms).
2025-11-12 16:57:22.068 +03:00 [WRN] You do not have a valid license key for the Lucky Penny software AutoMapper. This is allowed for development and testing scenarios. If you are running in production you are required to have a licensed version. Please visit https://luckypennysoftware.com to obtain a valid license.
2025-11-12 16:57:29.470 +03:00 [DBG] Opening connection to database 'GAC-BillingService' on server '.'.
2025-11-12 16:57:29.481 +03:00 [DBG] Opened connection to database 'GAC-BillingService' on server '.'.
2025-11-12 16:57:29.488 +03:00 [DBG] Beginning transaction with isolation level 'Unspecified'.
2025-11-12 16:57:29.509 +03:00 [DBG] Began transaction with isolation level 'ReadCommitted'.
2025-11-12 16:57:30.335 +03:00 [DBG] 'BillingServiceDBContext' generated a temporary value for the property 'Invoice.Id'. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-11-12 16:57:30.503 +03:00 [DBG] Context 'BillingServiceDBContext' started tracking 'Invoice' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-11-12 16:57:30.509 +03:00 [DBG] 'BillingServiceDBContext' generated a temporary value for the property 'Customer.Id'. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-11-12 16:57:30.567 +03:00 [DBG] The foreign key property 'Invoice.CustomerId' was detected as changed. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see property values.
2025-11-12 16:57:30.596 +03:00 [DBG] Context 'BillingServiceDBContext' started tracking 'Customer' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-11-12 17:09:46.329 +03:00 [ERR] exception occured Self referencing loop detected with type 'BillingSystem.Domain.Entities.Invoice'. Path 'Customer.Invoices'. , stackTrace    at Newtonsoft.Json.Serialization.JsonSerializerInternalWriter.CheckForCircularReference(JsonWriter writer, Object value, JsonProperty property, JsonContract contract, JsonContainerContract containerContract, JsonProperty containerProperty)
   at Newtonsoft.Json.Serialization.JsonSerializerInternalWriter.SerializeList(JsonWriter writer, IEnumerable values, JsonArrayContract contract, JsonProperty member, JsonContainerContract collectionContract, JsonProperty containerProperty)
   at Newtonsoft.Json.Serialization.JsonSerializerInternalWriter.SerializeValue(JsonWriter writer, Object value, JsonContract valueContract, JsonProperty member, JsonContainerContract containerContract, JsonProperty containerProperty)
   at Newtonsoft.Json.Serialization.JsonSerializerInternalWriter.SerializeObject(JsonWriter writer, Object value, JsonObjectContract contract, JsonProperty member, JsonContainerContract collectionContract, JsonProperty containerProperty)
   at Newtonsoft.Json.Serialization.JsonSerializerInternalWriter.SerializeValue(JsonWriter writer, Object value, JsonContract valueContract, JsonProperty member, JsonContainerContract containerContract, JsonProperty containerProperty)
   at Newtonsoft.Json.Serialization.JsonSerializerInternalWriter.SerializeObject(JsonWriter writer, Object value, JsonObjectContract contract, JsonProperty member, JsonContainerContract collectionContract, JsonProperty containerProperty)
   at Newtonsoft.Json.Serialization.JsonSerializerInternalWriter.SerializeValue(JsonWriter writer, Object value, JsonContract valueContract, JsonProperty member, JsonContainerContract containerContract, JsonProperty containerProperty)
   at Newtonsoft.Json.Serialization.JsonSerializerInternalWriter.Serialize(JsonWriter jsonWriter, Object value, Type objectType)
   at Newtonsoft.Json.JsonSerializer.SerializeInternal(JsonWriter jsonWriter, Object value, Type objectType)
   at Newtonsoft.Json.JsonSerializer.Serialize(JsonWriter jsonWriter, Object value, Type objectType)
   at Newtonsoft.Json.JsonConvert.SerializeObjectInternal(Object value, Type type, JsonSerializer jsonSerializer)
   at Newtonsoft.Json.JsonConvert.SerializeObject(Object value, Type type, JsonSerializerSettings settings)
   at Newtonsoft.Json.JsonConvert.SerializeObject(Object value)
   at BillingSystem.Infrastructure.Persistence.EF.InvoiceRepository.Insert(Invoice entity) in C:\Repositories\Gac-BillingSystem\src\BillingSystem.Infrastructure\Persistence\EF\InvoiceRepository.cs:line 69
2025-11-12 17:09:46.340 +03:00 [DBG] Rolling back transaction.
2025-11-12 17:09:46.340 +03:00 [DBG] Disconnect: guest@localhost:5672/
2025-11-12 17:09:46.386 +03:00 [DBG] Rolled back transaction.
2025-11-12 17:09:46.412 +03:00 [DBG] Closing connection to database 'GAC-BillingService' on server '.'.
2025-11-12 17:09:46.421 +03:00 [DBG] Closed connection to database 'GAC-BillingService' on server '.' (8ms).
2025-11-12 17:09:46.426 +03:00 [DBG] Disconnected: guest@localhost:5672/
2025-11-12 17:09:46.452 +03:00 [DBG] Disposing transaction.
2025-11-12 17:09:46.783 +03:00 [ERR] exception occured Self referencing loop detected with type 'BillingSystem.Domain.Entities.Invoice'. Path 'Customer.Invoices'. , stackTrace    at Newtonsoft.Json.Serialization.JsonSerializerInternalWriter.CheckForCircularReference(JsonWriter writer, Object value, JsonProperty property, JsonContract contract, JsonContainerContract containerContract, JsonProperty containerProperty)
   at Newtonsoft.Json.Serialization.JsonSerializerInternalWriter.SerializeList(JsonWriter writer, IEnumerable values, JsonArrayContract contract, JsonProperty member, JsonContainerContract collectionContract, JsonProperty containerProperty)
   at Newtonsoft.Json.Serialization.JsonSerializerInternalWriter.SerializeValue(JsonWriter writer, Object value, JsonContract valueContract, JsonProperty member, JsonContainerContract containerContract, JsonProperty containerProperty)
   at Newtonsoft.Json.Serialization.JsonSerializerInternalWriter.SerializeObject(JsonWriter writer, Object value, JsonObjectContract contract, JsonProperty member, JsonContainerContract collectionContract, JsonProperty containerProperty)
   at Newtonsoft.Json.Serialization.JsonSerializerInternalWriter.SerializeValue(JsonWriter writer, Object value, JsonContract valueContract, JsonProperty member, JsonContainerContract containerContract, JsonProperty containerProperty)
   at Newtonsoft.Json.Serialization.JsonSerializerInternalWriter.SerializeObject(JsonWriter writer, Object value, JsonObjectContract contract, JsonProperty member, JsonContainerContract collectionContract, JsonProperty containerProperty)
   at Newtonsoft.Json.Serialization.JsonSerializerInternalWriter.SerializeValue(JsonWriter writer, Object value, JsonContract valueContract, JsonProperty member, JsonContainerContract containerContract, JsonProperty containerProperty)
   at Newtonsoft.Json.Serialization.JsonSerializerInternalWriter.Serialize(JsonWriter jsonWriter, Object value, Type objectType)
   at Newtonsoft.Json.JsonSerializer.SerializeInternal(JsonWriter jsonWriter, Object value, Type objectType)
   at Newtonsoft.Json.JsonSerializer.Serialize(JsonWriter jsonWriter, Object value, Type objectType)
   at Newtonsoft.Json.JsonConvert.SerializeObjectInternal(Object value, Type type, JsonSerializer jsonSerializer)
   at Newtonsoft.Json.JsonConvert.SerializeObject(Object value, Type type, JsonSerializerSettings settings)
   at Newtonsoft.Json.JsonConvert.SerializeObject(Object value)
   at BillingSystem.Infrastructure.Persistence.EF.InvoiceRepository.Insert(Invoice entity) in C:\Repositories\Gac-BillingSystem\src\BillingSystem.Infrastructure\Persistence\EF\InvoiceRepository.cs:line 69
   at BillingSystem.Application.Commands.CreateInvoiceCommandRequestHandler.Handle(CreateInvoiceRequest request, CancellationToken cancellationToken) in C:\Repositories\Gac-BillingSystem\src\BillingSystem.Application\Commands\CreateInvoiceCommandRequestHandler.cs:line 39
   at BillingSystem.API.Controllers.InvoicesController.Post(CreateInvoiceRequest invoiceRequest) in C:\Repositories\Gac-BillingSystem\src\BillingSystem.API\Controllers\InvoicesController.cs:line 45
2025-11-12 17:09:46.806 +03:00 [DBG] List of registered output formatters, in the following order: ["Microsoft.AspNetCore.Mvc.Formatters.HttpNoContentOutputFormatter","Microsoft.AspNetCore.Mvc.Formatters.StringOutputFormatter","Microsoft.AspNetCore.Mvc.Formatters.StreamOutputFormatter","Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonOutputFormatter"]
2025-11-12 17:09:46.817 +03:00 [DBG] No information found on request to perform content negotiation.
2025-11-12 17:09:46.820 +03:00 [DBG] Attempting to select the first output formatter in the output formatters list which supports a content type from the explicitly specified content types '["application/json","application/problem+json","application/problem+xml"]'.
2025-11-12 17:09:46.827 +03:00 [DBG] Selected output formatter 'Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonOutputFormatter' and content type 'application/json' to write the response.
2025-11-12 17:09:46.830 +03:00 [INF] Executing ObjectResult, writing value of type 'Microsoft.AspNetCore.Mvc.ProblemDetails'.
2025-11-12 17:09:46.871 +03:00 [INF] Executed action BillingSystem.API.Controllers.InvoicesController.Post (BillingSystem.API) in 747554.333ms
2025-11-12 17:09:46.877 +03:00 [INF] Executed endpoint 'BillingSystem.API.Controllers.InvoicesController.Post (BillingSystem.API)'
2025-11-12 17:09:46.880 +03:00 [ERR] HTTP POST /api/Invoices responded 500 in 753306.3386 ms
2025-11-12 17:09:46.886 +03:00 [DBG] Connection id "0HNH1UBHNS78S" completed keep alive response.
2025-11-12 17:09:46.894 +03:00 [DBG] 'BillingServiceDBContext' disposed.
2025-11-12 17:09:46.904 +03:00 [DBG] Disposing connection to database 'GAC-BillingService' on server '.'.
2025-11-12 17:09:46.912 +03:00 [DBG] Disposed connection to database '' on server '' (6ms).
2025-11-12 17:09:46.916 +03:00 [INF] Request finished HTTP/1.1 POST https://localhost:7257/api/Invoices - 500 null application/json; charset=utf-8 753382.7002ms
2025-11-12 17:26:18.635 +03:00 [DBG] Registered model binder providers, in the following order: ["Microsoft.AspNetCore.Mvc.ModelBinding.Binders.BinderTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ServicesModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.BodyModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.HeaderModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FloatingPointTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.EnumTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.DateTimeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.SimpleTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.TryParseModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.CancellationTokenModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ByteArrayModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FormFileModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FormCollectionModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.KeyValuePairModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.DictionaryModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ArrayModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.CollectionModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ComplexObjectModelBinderProvider"]
2025-11-12 17:26:18.803 +03:00 [DBG] Hosting starting
2025-11-12 17:26:19.151 +03:00 [DBG] Starting bus instances: IBus
2025-11-12 17:26:19.158 +03:00 [DBG] Starting bus: "rabbitmq://localhost/"
2025-11-12 17:26:19.186 +03:00 [DBG] Middleware loaded
2025-11-12 17:26:19.190 +03:00 [DBG] Middleware loaded. Script /_framework/aspnetcore-browser-refresh.js (16519 B).
2025-11-12 17:26:19.197 +03:00 [DBG] Middleware loaded. Script /_framework/blazor-hotreload.js (799 B).
2025-11-12 17:26:19.215 +03:00 [DBG] Connect: guest@localhost:5672/
2025-11-12 17:26:19.441 +03:00 [DBG] Middleware loaded: DOTNET_MODIFIABLE_ASSEMBLIES=debug, __ASPNETCORE_BROWSER_TOOLS=true
2025-11-12 17:26:19.507 +03:00 [DBG] Connected: guest@localhost:5672/ (address: amqp://localhost:5672, local: 64867)
2025-11-12 17:26:19.588 +03:00 [DBG] Endpoint Ready: "rabbitmq://localhost/ECHGHANNAMLP1_BillingSystemAPI_bus_gopoyyyh3bcsbzp6bdxnd751b6?temporary=true"
2025-11-12 17:26:19.593 +03:00 [INF] Bus started: "rabbitmq://localhost/"
2025-11-12 17:26:19.817 +03:00 [INF] Now listening on: https://localhost:7257
2025-11-12 17:26:19.821 +03:00 [INF] Now listening on: http://localhost:5009
2025-11-12 17:26:19.824 +03:00 [DBG] Loaded hosting startup assembly BillingSystem.API
2025-11-12 17:26:19.826 +03:00 [DBG] Loaded hosting startup assembly Microsoft.WebTools.ApiEndpointDiscovery
2025-11-12 17:26:19.829 +03:00 [DBG] Loaded hosting startup assembly Microsoft.AspNetCore.Watch.BrowserRefresh
2025-11-12 17:26:19.831 +03:00 [DBG] Loaded hosting startup assembly Microsoft.WebTools.BrowserLink.Net
2025-11-12 17:26:19.978 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-11-12 17:26:19.980 +03:00 [INF] Hosting environment: Development
2025-11-12 17:26:19.984 +03:00 [INF] Content root path: C:\Repositories\Gac-BillingSystem\src\BillingSystem.API
2025-11-12 17:26:19.987 +03:00 [DBG] Hosting started
2025-11-12 17:26:20.102 +03:00 [DBG] Connection id "0HNH1UTPDT2I1" accepted.
2025-11-12 17:26:20.110 +03:00 [DBG] Connection id "0HNH1UTPDT2I1" started.
2025-11-12 17:26:20.142 +03:00 [DBG] Connection id "0HNH1UTPDT2I1" received FIN.
2025-11-12 17:26:20.162 +03:00 [DBG] Failed to authenticate HTTPS connection.
System.IO.IOException: Received an unexpected EOF or 0 bytes from the transport stream.
   at System.Net.Security.SslStream.ReceiveHandshakeFrameAsync[TIOAdapter](CancellationToken cancellationToken)
   at System.Net.Security.SslStream.ForceAuthenticationAsync[TIOAdapter](Boolean receiveFirst, Byte[] reAuthenticationData, CancellationToken cancellationToken)
   at System.Net.Security.SslStream.ProcessAuthenticationWithTelemetryAsync(Boolean isAsync, CancellationToken cancellationToken)
   at Microsoft.AspNetCore.Server.Kestrel.Https.Internal.HttpsConnectionMiddleware.OnConnectionAsync(ConnectionContext context)
2025-11-12 17:26:20.193 +03:00 [DBG] Connection id "0HNH1UTPDT2I1" stopped.
2025-11-12 17:26:20.203 +03:00 [DBG] Connection id "0HNH1UTPDT2I1" sending FIN because: "The Socket transport's send loop completed gracefully."
2025-11-12 17:26:20.795 +03:00 [DBG] Connection id "0HNH1UTPDT2I2" accepted.
2025-11-12 17:26:20.800 +03:00 [DBG] Connection id "0HNH1UTPDT2I2" started.
2025-11-12 17:26:20.859 +03:00 [DBG] Connection 0HNH1UTPDT2I2 established using the following protocol: "Tls13"
2025-11-12 17:26:20.937 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7257/swagger/index.html - null null
2025-11-12 17:26:21.002 +03:00 [DBG] Wildcard detected, all requests with hosts will be allowed.
2025-11-12 17:26:21.023 +03:00 [DBG] No candidates found for the request path '/swagger/index.html'
2025-11-12 17:26:21.027 +03:00 [DBG] Request did not match any endpoints
2025-11-12 17:26:21.098 +03:00 [DBG] Response markup is scheduled to include Browser Link script injection.
2025-11-12 17:26:21.102 +03:00 [DBG] Response markup is scheduled to include browser refresh script injection.
2025-11-12 17:26:21.123 +03:00 [INF] HTTP GET /swagger/index.html responded 200 in 88.2775 ms
2025-11-12 17:26:21.131 +03:00 [DBG] Response markup was updated to include Browser Link script injection.
2025-11-12 17:26:21.134 +03:00 [DBG] Response markup was updated to include browser refresh script injection.
2025-11-12 17:26:21.139 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7257/swagger/index.html - 200 null text/html;charset=utf-8 211.8273ms
2025-11-12 17:26:21.164 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7257/_framework/aspnetcore-browser-refresh.js - null null
2025-11-12 17:26:21.179 +03:00 [DBG] Script injected: /_framework/aspnetcore-browser-refresh.js
2025-11-12 17:26:21.184 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7257/_framework/aspnetcore-browser-refresh.js - 200 16519 application/javascript; charset=utf-8 20.1361ms
2025-11-12 17:26:21.193 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7257/_vs/browserLink - null null
2025-11-12 17:26:21.254 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7257/_vs/browserLink - 200 null text/javascript; charset=UTF-8 60.5112ms
2025-11-12 17:26:21.304 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7257/swagger/v1/swagger.json - null null
2025-11-12 17:26:21.311 +03:00 [DBG] No candidates found for the request path '/swagger/v1/swagger.json'
2025-11-12 17:26:21.314 +03:00 [DBG] Request did not match any endpoints
2025-11-12 17:26:21.341 +03:00 [INF] HTTP GET /swagger/v1/swagger.json responded 200 in 23.4831 ms
2025-11-12 17:26:21.351 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7257/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 48.1478ms
2025-11-12 17:26:45.850 +03:00 [DBG] Connection id "0HNH1UTPDT2I3" accepted.
2025-11-12 17:26:45.850 +03:00 [DBG] Connection id "0HNH1UTPDT2I3" received FIN.
2025-11-12 17:26:45.857 +03:00 [DBG] Connection id "0HNH1UTPDT2I4" accepted.
2025-11-12 17:26:45.856 +03:00 [DBG] Connection id "0HNH1UTPDT2I3" started.
2025-11-12 17:26:45.870 +03:00 [DBG] Connection id "0HNH1UTPDT2I4" started.
2025-11-12 17:26:45.874 +03:00 [DBG] Failed to authenticate HTTPS connection.
System.IO.IOException: Received an unexpected EOF or 0 bytes from the transport stream.
   at System.Net.Security.SslStream.ReceiveHandshakeFrameAsync[TIOAdapter](CancellationToken cancellationToken)
   at System.Net.Security.SslStream.ForceAuthenticationAsync[TIOAdapter](Boolean receiveFirst, Byte[] reAuthenticationData, CancellationToken cancellationToken)
   at System.Net.Security.SslStream.ProcessAuthenticationWithTelemetryAsync(Boolean isAsync, CancellationToken cancellationToken)
   at Microsoft.AspNetCore.Server.Kestrel.Https.Internal.HttpsConnectionMiddleware.OnConnectionAsync(ConnectionContext context)
2025-11-12 17:26:45.882 +03:00 [DBG] Connection id "0HNH1UTPDT2I3" stopped.
2025-11-12 17:26:45.882 +03:00 [DBG] Connection 0HNH1UTPDT2I4 established using the following protocol: "Tls13"
2025-11-12 17:26:45.885 +03:00 [DBG] Connection id "0HNH1UTPDT2I3" sending FIN because: "The Socket transport's send loop completed gracefully."
2025-11-12 17:26:45.894 +03:00 [INF] Request starting HTTP/1.1 POST https://localhost:7257/api/Invoices - application/json 1316
2025-11-12 17:26:45.903 +03:00 [DBG] 1 candidate(s) found for the request path '/api/Invoices'
2025-11-12 17:26:45.913 +03:00 [DBG] Endpoint 'BillingSystem.API.Controllers.InvoicesController.Post (BillingSystem.API)' with route pattern 'api/Invoices' is valid for the request path '/api/Invoices'
2025-11-12 17:26:45.918 +03:00 [DBG] Request matched endpoint 'BillingSystem.API.Controllers.InvoicesController.Post (BillingSystem.API)'
2025-11-12 17:26:45.928 +03:00 [DBG] Static files was skipped as the request already matched an endpoint.
2025-11-12 17:26:46.153 +03:00 [DBG] An 'IServiceProvider' was created for internal use by Entity Framework.
2025-11-12 17:26:51.622 +03:00 [INF] Executing endpoint 'BillingSystem.API.Controllers.InvoicesController.Post (BillingSystem.API)'
2025-11-12 17:26:51.661 +03:00 [INF] Route matched with {action = "Post", controller = "Invoices"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Post(BillingSystem.Application.Requests.CreateInvoiceRequest) on controller BillingSystem.API.Controllers.InvoicesController (BillingSystem.API).
2025-11-12 17:26:51.671 +03:00 [DBG] Execution plan of authorization filters (in the following order): ["None"]
2025-11-12 17:26:51.676 +03:00 [DBG] Execution plan of resource filters (in the following order): ["None"]
2025-11-12 17:26:51.680 +03:00 [DBG] Execution plan of action filters (in the following order): ["Microsoft.AspNetCore.Mvc.ModelBinding.UnsupportedContentTypeFilter (Order: -3000)","Microsoft.AspNetCore.Mvc.Infrastructure.ModelStateInvalidFilter (Order: -2000)","BillingSystem.API.ActionFilters.AuditBillingRequestsFilter","BillingSystem.API.ActionFilters.IdempotencyFilter (Order: 0)"]
2025-11-12 17:26:51.689 +03:00 [DBG] Execution plan of exception filters (in the following order): ["None"]
2025-11-12 17:26:51.694 +03:00 [DBG] Execution plan of result filters (in the following order): ["Microsoft.AspNetCore.Mvc.Infrastructure.ClientErrorResultFilter (Order: -2000)","Microsoft.AspNetCore.Mvc.ProducesAttribute (Order: 0)","BillingSystem.API.ActionFilters.IdempotencyFilter (Order: 0)"]
2025-11-12 17:26:51.702 +03:00 [DBG] Executing controller factory for controller BillingSystem.API.Controllers.InvoicesController (BillingSystem.API)
2025-11-12 17:26:51.711 +03:00 [WRN] You do not have a valid license key for the Lucky Penny software MediatR. This is allowed for development and testing scenarios. If you are running in production you are required to have a licensed version. Please visit https://luckypennysoftware.com to obtain a valid license.
2025-11-12 17:26:51.768 +03:00 [DBG] Executed controller factory for controller BillingSystem.API.Controllers.InvoicesController (BillingSystem.API)
2025-11-12 17:26:51.796 +03:00 [DBG] Attempting to bind parameter 'invoiceRequest' of type 'BillingSystem.Application.Requests.CreateInvoiceRequest' ...
2025-11-12 17:26:51.803 +03:00 [DBG] Attempting to bind parameter 'invoiceRequest' of type 'BillingSystem.Application.Requests.CreateInvoiceRequest' using the name '' in request data ...
2025-11-12 17:26:51.813 +03:00 [DBG] Selected input formatter 'Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonInputFormatter' for content type 'application/json'.
2025-11-12 17:26:51.872 +03:00 [DBG] Connection id "0HNH1UTPDT2I4", Request id "0HNH1UTPDT2I4:00000001": started reading request body.
2025-11-12 17:26:51.881 +03:00 [DBG] Connection id "0HNH1UTPDT2I4", Request id "0HNH1UTPDT2I4:00000001": done reading request body.
2025-11-12 17:26:51.926 +03:00 [DBG] JSON input formatter succeeded, deserializing to type 'BillingSystem.Application.Requests.CreateInvoiceRequest'
2025-11-12 17:26:51.931 +03:00 [DBG] Done attempting to bind parameter 'invoiceRequest' of type 'BillingSystem.Application.Requests.CreateInvoiceRequest'.
2025-11-12 17:26:51.937 +03:00 [DBG] Done attempting to bind parameter 'invoiceRequest' of type 'BillingSystem.Application.Requests.CreateInvoiceRequest'.
2025-11-12 17:26:51.943 +03:00 [DBG] Attempting to validate the bound parameter 'invoiceRequest' of type 'BillingSystem.Application.Requests.CreateInvoiceRequest' ...
2025-11-12 17:26:51.973 +03:00 [DBG] Done attempting to validate the bound parameter 'invoiceRequest' of type 'BillingSystem.Application.Requests.CreateInvoiceRequest'.
2025-11-12 17:26:52.273 +03:00 [DBG] No relationship from 'Invoice' to 'Invoice' has been configured by convention because there are multiple properties on one entity type - {'DiscountedPrimaryInvoice'} that could be matched with the properties on the other entity type - {'InverseDiscountedPrimaryInvoice', 'InversePrimaryInvoice', 'InverseSubstitutionPrimaryInvoice', 'PrimaryInvoice', 'SubstitutionPrimaryInvoice'}. This message can be disregarded if explicit configuration has been specified in 'OnModelCreating'.
2025-11-12 17:26:52.496 +03:00 [DBG] No relationship from 'Invoice' to 'Invoice' has been configured by convention because there are multiple properties on one entity type - {'DiscountedPrimaryInvoice'} that could be matched with the properties on the other entity type - {'InverseDiscountedPrimaryInvoice', 'InversePrimaryInvoice', 'InverseSubstitutionPrimaryInvoice', 'PrimaryInvoice', 'SubstitutionPrimaryInvoice'}. This message can be disregarded if explicit configuration has been specified in 'OnModelCreating'.
2025-11-12 17:26:52.507 +03:00 [DBG] No relationship from 'Invoice' to 'Invoice' has been configured by convention because there are multiple properties on one entity type - {'InversePrimaryInvoice'} that could be matched with the properties on the other entity type - {'InverseSubstitutionPrimaryInvoice', 'PrimaryInvoice', 'SubstitutionPrimaryInvoice'}. This message can be disregarded if explicit configuration has been specified in 'OnModelCreating'.
2025-11-12 17:26:52.516 +03:00 [DBG] No relationship from 'Invoice' to 'Invoice' has been configured by convention because there are multiple properties on one entity type - {'InversePrimaryInvoice'} that could be matched with the properties on the other entity type - {'InverseSubstitutionPrimaryInvoice', 'PrimaryInvoice', 'SubstitutionPrimaryInvoice'}. This message can be disregarded if explicit configuration has been specified in 'OnModelCreating'.
2025-11-12 17:26:52.928 +03:00 [DBG] Entity Framework Core 9.0.9 initialized 'BillingServiceDBContext' using provider 'Microsoft.EntityFrameworkCore.SqlServer:9.0.9' with options: EngineType=SqlServer 
2025-11-12 17:26:53.070 +03:00 [DBG] Compiling query expression: 
'DbSet<Invoice>()
    .AsNoTracking()
    .Any(inv => inv.ExternalId.ToString() == __idempotentKey_0)'
2025-11-12 17:26:53.438 +03:00 [DBG] Generated query execution expression: 
'queryContext => ShapedQueryCompilingExpressionVisitor.SingleAsync<bool>(
    asyncEnumerable: SingleQueryingEnumerable.Create<bool>(
        relationalQueryContext: (RelationalQueryContext)queryContext, 
        relationalCommandResolver: parameters => [LIFTABLE Constant: RelationalCommandCache.QueryExpression(
            Projection Mapping:
                EmptyProjectionMember -> 0
            SELECT EXISTS (
                SELECT 1
                FROM Invoices AS i
                WHERE COALESCE(CONVERT(varchar(36), i.ExternalId), '') == @__idempotentKey_0)) | Resolver: c => new RelationalCommandCache(
            c.Dependencies.MemoryCache, 
            c.RelationalDependencies.QuerySqlGeneratorFactory, 
            c.RelationalDependencies.RelationalParameterBasedSqlProcessorFactory, 
            Projection Mapping:
                EmptyProjectionMember -> 0
            SELECT EXISTS (
                SELECT 1
                FROM Invoices AS i
                WHERE COALESCE(CONVERT(varchar(36), i.ExternalId), '') == @__idempotentKey_0), 
            False, 
            new HashSet<string>(
                new string[]{ }, 
                StringComparer.Ordinal
            )
        )].GetRelationalCommandTemplate(parameters), 
        readerColumns: null, 
        shaper: (queryContext, dataReader, resultContext, resultCoordinator) => 
        {
            bool? value1;
            value1 = dataReader.IsDBNull(0) ? default(bool?) : (bool?)dataReader.GetBoolean(0);
            return (bool)value1;
        }, 
        contextType: BillingSystem.Infrastructure.EF.BillingServiceDBContext, 
        standAloneStateManager: False, 
        detailedErrorsEnabled: False, 
        threadSafetyChecksEnabled: True), 
    cancellationToken: queryContext.CancellationToken)'
2025-11-12 17:26:53.511 +03:00 [DBG] Creating DbConnection.
2025-11-12 17:26:53.552 +03:00 [DBG] Created DbConnection. (38ms).
2025-11-12 17:26:53.561 +03:00 [DBG] Opening connection to database 'GAC-BillingService' on server '.'.
2025-11-12 17:26:53.966 +03:00 [DBG] Opened connection to database 'GAC-BillingService' on server '.'.
2025-11-12 17:26:53.978 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-11-12 17:26:53.990 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (9ms).
2025-11-12 17:26:54.003 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (26ms).
2025-11-12 17:26:54.021 +03:00 [DBG] Executing DbCommand [Parameters=[@__idempotentKey_0='?' (Size = 36) (DbType = AnsiString)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [Invoices] AS [i]
        WHERE CONVERT(varchar(36), [i].[ExternalId]) = @__idempotentKey_0) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2025-11-12 17:26:54.114 +03:00 [INF] Executed DbCommand (96ms) [Parameters=[@__idempotentKey_0='?' (Size = 36) (DbType = AnsiString)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [Invoices] AS [i]
        WHERE CONVERT(varchar(36), [i].[ExternalId]) = @__idempotentKey_0) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2025-11-12 17:26:54.156 +03:00 [DBG] Closing data reader to 'GAC-BillingService' on server '.'.
2025-11-12 17:26:54.175 +03:00 [DBG] A data reader for 'GAC-BillingService' on server '.' is being disposed after spending 42ms reading results.
2025-11-12 17:26:54.186 +03:00 [DBG] Closing connection to database 'GAC-BillingService' on server '.'.
2025-11-12 17:26:54.201 +03:00 [DBG] Closed connection to database 'GAC-BillingService' on server '.' (14ms).
2025-11-12 17:26:54.419 +03:00 [WRN] You do not have a valid license key for the Lucky Penny software AutoMapper. This is allowed for development and testing scenarios. If you are running in production you are required to have a licensed version. Please visit https://luckypennysoftware.com to obtain a valid license.
2025-11-12 17:27:07.836 +03:00 [DBG] Opening connection to database 'GAC-BillingService' on server '.'.
2025-11-12 17:27:07.852 +03:00 [DBG] Opened connection to database 'GAC-BillingService' on server '.'.
2025-11-12 17:27:07.861 +03:00 [DBG] Beginning transaction with isolation level 'Unspecified'.
2025-11-12 17:27:07.878 +03:00 [DBG] Began transaction with isolation level 'ReadCommitted'.
2025-11-12 17:27:09.464 +03:00 [DBG] 'BillingServiceDBContext' generated a temporary value for the property 'Invoice.Id'. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-11-12 17:27:09.682 +03:00 [DBG] Context 'BillingServiceDBContext' started tracking 'Invoice' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-11-12 17:27:09.690 +03:00 [DBG] 'BillingServiceDBContext' generated a temporary value for the property 'Customer.Id'. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-11-12 17:27:09.779 +03:00 [DBG] The foreign key property 'Invoice.CustomerId' was detected as changed. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see property values.
2025-11-12 17:27:09.811 +03:00 [DBG] Context 'BillingServiceDBContext' started tracking 'Customer' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-11-12 17:27:10.692 +03:00 [DBG] 'BillingServiceDBContext' generated a temporary value for the property 'OutboxEvent.Id'. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-11-12 17:27:10.721 +03:00 [DBG] Context 'BillingServiceDBContext' started tracking 'OutboxEvent' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-11-12 17:27:19.395 +03:00 [DBG] SaveChanges starting for 'BillingServiceDBContext'.
2025-11-12 17:27:19.404 +03:00 [DBG] DetectChanges starting for 'BillingServiceDBContext'.
2025-11-12 17:27:19.472 +03:00 [DBG] DetectChanges completed for 'BillingServiceDBContext'.
2025-11-12 17:27:19.553 +03:00 [DBG] Executing 2 update commands as a batch.
2025-11-12 17:27:19.561 +03:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-11-12 17:27:19.567 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-11-12 17:27:19.571 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (3ms).
2025-11-12 17:27:19.577 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (10ms).
2025-11-12 17:27:19.588 +03:00 [DBG] Executing DbCommand [Parameters=[@p0='?' (Size = 200), @p1='?' (Size = 200), @p2='?' (Size = 200), @p3='?' (Size = 200), @p4='?' (Size = 50), @p5='?' (Size = 200), @p6='?' (Size = 200), @p7='?' (Size = 50), @p8='?' (DbType = DateTime), @p9='?' (Size = 100), @p10='?' (Size = 80), @p11='?' (Size = 500), @p12='?' (Size = 100), @p13='?' (DbType = Int32), @p14='?' (DbType = Boolean), @p15='?' (DbType = DateTime), @p16='?' (Precision = 18) (DbType = Decimal), @p17='?' (Size = 50), @p18='?' (Size = 100), @p19='?' (DbType = Int64), @p20='?' (DbType = DateTime), @p21='?' (Size = 4000), @p22='?' (Size = 300), @p23='?' (Size = 4000), @p24='?' (DbType = Boolean), @p25='?' (Size = 20) (DbType = AnsiString)], CommandType='"Text"', CommandTimeout='30']
SET NOCOUNT ON;
INSERT INTO [Customers] ([Address_BuildingNumber], [Address_City], [Address_Country], [Address_District], [Address_PostalCode], [Address_Street], [Address_SubNumber], [CreatedBy], [CreatedDate], [CustomerType], [EmailAddress], [FullName], [IdentityNumber], [IdentityType], [IsDeleted], [LastUpdatedDate], [OverpaymentBalance], [PhoneNumber], [VATNumber])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18);
INSERT INTO [Outbox_events] ([Aggregate_id], [CreatedDate], [ErrorMsg], [Event_type], [Payload], [Processed], [ProcessingStatus])
OUTPUT INSERTED.[Id]
VALUES (@p19, @p20, @p21, @p22, @p23, @p24, @p25);
2025-11-12 17:27:19.611 +03:00 [ERR] Failed executing DbCommand (28ms) [Parameters=[@p0='?' (Size = 200), @p1='?' (Size = 200), @p2='?' (Size = 200), @p3='?' (Size = 200), @p4='?' (Size = 50), @p5='?' (Size = 200), @p6='?' (Size = 200), @p7='?' (Size = 50), @p8='?' (DbType = DateTime), @p9='?' (Size = 100), @p10='?' (Size = 80), @p11='?' (Size = 500), @p12='?' (Size = 100), @p13='?' (DbType = Int32), @p14='?' (DbType = Boolean), @p15='?' (DbType = DateTime), @p16='?' (Precision = 18) (DbType = Decimal), @p17='?' (Size = 50), @p18='?' (Size = 100), @p19='?' (DbType = Int64), @p20='?' (DbType = DateTime), @p21='?' (Size = 4000), @p22='?' (Size = 300), @p23='?' (Size = 4000), @p24='?' (DbType = Boolean), @p25='?' (Size = 20) (DbType = AnsiString)], CommandType='"Text"', CommandTimeout='30']
SET NOCOUNT ON;
INSERT INTO [Customers] ([Address_BuildingNumber], [Address_City], [Address_Country], [Address_District], [Address_PostalCode], [Address_Street], [Address_SubNumber], [CreatedBy], [CreatedDate], [CustomerType], [EmailAddress], [FullName], [IdentityNumber], [IdentityType], [IsDeleted], [LastUpdatedDate], [OverpaymentBalance], [PhoneNumber], [VATNumber])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18);
INSERT INTO [Outbox_events] ([Aggregate_id], [CreatedDate], [ErrorMsg], [Event_type], [Payload], [Processed], [ProcessingStatus])
OUTPUT INSERTED.[Id]
VALUES (@p19, @p20, @p21, @p22, @p23, @p24, @p25);
2025-11-12 17:27:19.666 +03:00 [ERR] An exception occurred in the database while saving changes for context type 'BillingSystem.Infrastructure.EF.BillingServiceDBContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> System.Data.SqlTypes.SqlTypeException: SqlDateTime overflow. Must be between 1/1/1753 12:00:00 AM and 12/31/9999 11:59:59 PM.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__211_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalDatabase.SaveChangesAsync(IList`1 entries, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> System.Data.SqlTypes.SqlTypeException: SqlDateTime overflow. Must be between 1/1/1753 12:00:00 AM and 12/31/9999 11:59:59 PM.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__211_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalDatabase.SaveChangesAsync(IList`1 entries, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2025-11-12 17:28:08.775 +03:00 [DBG] Registered model binder providers, in the following order: ["Microsoft.AspNetCore.Mvc.ModelBinding.Binders.BinderTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ServicesModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.BodyModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.HeaderModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FloatingPointTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.EnumTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.DateTimeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.SimpleTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.TryParseModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.CancellationTokenModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ByteArrayModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FormFileModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FormCollectionModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.KeyValuePairModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.DictionaryModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ArrayModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.CollectionModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ComplexObjectModelBinderProvider"]
2025-11-12 17:28:08.990 +03:00 [DBG] Hosting starting
2025-11-12 17:28:09.434 +03:00 [DBG] Starting bus instances: IBus
2025-11-12 17:28:09.442 +03:00 [DBG] Starting bus: "rabbitmq://localhost/"
2025-11-12 17:28:09.475 +03:00 [DBG] Middleware loaded
2025-11-12 17:28:09.481 +03:00 [DBG] Middleware loaded. Script /_framework/aspnetcore-browser-refresh.js (16519 B).
2025-11-12 17:28:09.492 +03:00 [DBG] Middleware loaded. Script /_framework/blazor-hotreload.js (799 B).
2025-11-12 17:28:09.509 +03:00 [DBG] Connect: guest@localhost:5672/
2025-11-12 17:28:09.692 +03:00 [DBG] Middleware loaded: DOTNET_MODIFIABLE_ASSEMBLIES=debug, __ASPNETCORE_BROWSER_TOOLS=true
2025-11-12 17:28:09.718 +03:00 [DBG] Connected: guest@localhost:5672/ (address: amqp://localhost:5672, local: 58235)
2025-11-12 17:28:09.798 +03:00 [DBG] Endpoint Ready: "rabbitmq://localhost/ECHGHANNAMLP1_BillingSystemAPI_bus_etnyyyyh3bcsbxs4bdxnd77u8s?temporary=true"
2025-11-12 17:28:09.803 +03:00 [INF] Bus started: "rabbitmq://localhost/"
2025-11-12 17:28:10.145 +03:00 [INF] Now listening on: https://localhost:7257
2025-11-12 17:28:10.149 +03:00 [INF] Now listening on: http://localhost:5009
2025-11-12 17:28:10.152 +03:00 [DBG] Loaded hosting startup assembly BillingSystem.API
2025-11-12 17:28:10.156 +03:00 [DBG] Loaded hosting startup assembly Microsoft.WebTools.ApiEndpointDiscovery
2025-11-12 17:28:10.163 +03:00 [DBG] Loaded hosting startup assembly Microsoft.AspNetCore.Watch.BrowserRefresh
2025-11-12 17:28:10.170 +03:00 [DBG] Loaded hosting startup assembly Microsoft.WebTools.BrowserLink.Net
2025-11-12 17:28:10.338 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-11-12 17:28:10.340 +03:00 [INF] Hosting environment: Development
2025-11-12 17:28:10.343 +03:00 [INF] Content root path: C:\Repositories\Gac-BillingSystem\src\BillingSystem.API
2025-11-12 17:28:10.345 +03:00 [DBG] Hosting started
2025-11-12 17:28:10.371 +03:00 [DBG] Connection id "0HNH1UUQ9GIQV" accepted.
2025-11-12 17:28:10.376 +03:00 [DBG] Connection id "0HNH1UUQ9GIQV" started.
2025-11-12 17:28:10.405 +03:00 [DBG] Connection id "0HNH1UUQ9GIQV" received FIN.
2025-11-12 17:28:10.422 +03:00 [DBG] Failed to authenticate HTTPS connection.
System.IO.IOException: Received an unexpected EOF or 0 bytes from the transport stream.
   at System.Net.Security.SslStream.ReceiveHandshakeFrameAsync[TIOAdapter](CancellationToken cancellationToken)
   at System.Net.Security.SslStream.ForceAuthenticationAsync[TIOAdapter](Boolean receiveFirst, Byte[] reAuthenticationData, CancellationToken cancellationToken)
   at System.Net.Security.SslStream.ProcessAuthenticationWithTelemetryAsync(Boolean isAsync, CancellationToken cancellationToken)
   at Microsoft.AspNetCore.Server.Kestrel.Https.Internal.HttpsConnectionMiddleware.OnConnectionAsync(ConnectionContext context)
2025-11-12 17:28:10.453 +03:00 [DBG] Connection id "0HNH1UUQ9GIQV" stopped.
2025-11-12 17:28:10.464 +03:00 [DBG] Connection id "0HNH1UUQ9GIQV" sending FIN because: "The Socket transport's send loop completed gracefully."
2025-11-12 17:28:11.091 +03:00 [DBG] Connection id "0HNH1UUQ9GIR0" accepted.
2025-11-12 17:28:11.094 +03:00 [DBG] Connection id "0HNH1UUQ9GIR0" started.
2025-11-12 17:28:11.155 +03:00 [DBG] Connection 0HNH1UUQ9GIR0 established using the following protocol: "Tls13"
2025-11-12 17:28:11.243 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7257/swagger/index.html - null null
2025-11-12 17:28:11.313 +03:00 [DBG] Wildcard detected, all requests with hosts will be allowed.
2025-11-12 17:28:11.340 +03:00 [DBG] No candidates found for the request path '/swagger/index.html'
2025-11-12 17:28:11.344 +03:00 [DBG] Request did not match any endpoints
2025-11-12 17:28:11.435 +03:00 [DBG] Response markup is scheduled to include Browser Link script injection.
2025-11-12 17:28:11.440 +03:00 [DBG] Response markup is scheduled to include browser refresh script injection.
2025-11-12 17:28:11.472 +03:00 [INF] HTTP GET /swagger/index.html responded 200 in 113.1658 ms
2025-11-12 17:28:11.479 +03:00 [DBG] Response markup was updated to include Browser Link script injection.
2025-11-12 17:28:11.483 +03:00 [DBG] Response markup was updated to include browser refresh script injection.
2025-11-12 17:28:11.490 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7257/_framework/aspnetcore-browser-refresh.js - null null
2025-11-12 17:28:11.490 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7257/swagger/index.html - 200 null text/html;charset=utf-8 261.4793ms
2025-11-12 17:28:11.504 +03:00 [DBG] Script injected: /_framework/aspnetcore-browser-refresh.js
2025-11-12 17:28:11.509 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7257/_framework/aspnetcore-browser-refresh.js - 200 16519 application/javascript; charset=utf-8 18.7548ms
2025-11-12 17:28:11.545 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7257/_vs/browserLink - null null
2025-11-12 17:28:11.624 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7257/_vs/browserLink - 200 null text/javascript; charset=UTF-8 79.2109ms
2025-11-12 17:28:11.719 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7257/swagger/v1/swagger.json - null null
2025-11-12 17:28:11.727 +03:00 [DBG] No candidates found for the request path '/swagger/v1/swagger.json'
2025-11-12 17:28:11.730 +03:00 [DBG] Request did not match any endpoints
2025-11-12 17:28:11.755 +03:00 [INF] HTTP GET /swagger/v1/swagger.json responded 200 in 21.5985 ms
2025-11-12 17:28:11.764 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7257/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 44.5692ms
2025-11-12 17:28:16.423 +03:00 [DBG] Connection id "0HNH1UUQ9GIR1" received FIN.
2025-11-12 17:28:16.423 +03:00 [DBG] Connection id "0HNH1UUQ9GIR1" accepted.
2025-11-12 17:28:16.430 +03:00 [DBG] Connection id "0HNH1UUQ9GIR1" started.
2025-11-12 17:28:16.432 +03:00 [DBG] Connection id "0HNH1UUQ9GIR2" accepted.
2025-11-12 17:28:16.435 +03:00 [DBG] Failed to authenticate HTTPS connection.
System.IO.IOException: Received an unexpected EOF or 0 bytes from the transport stream.
   at System.Net.Security.SslStream.ReceiveHandshakeFrameAsync[TIOAdapter](CancellationToken cancellationToken)
   at System.Net.Security.SslStream.ForceAuthenticationAsync[TIOAdapter](Boolean receiveFirst, Byte[] reAuthenticationData, CancellationToken cancellationToken)
   at System.Net.Security.SslStream.ProcessAuthenticationWithTelemetryAsync(Boolean isAsync, CancellationToken cancellationToken)
   at Microsoft.AspNetCore.Server.Kestrel.Https.Internal.HttpsConnectionMiddleware.OnConnectionAsync(ConnectionContext context)
2025-11-12 17:28:16.436 +03:00 [DBG] Connection id "0HNH1UUQ9GIR2" started.
2025-11-12 17:28:16.440 +03:00 [DBG] Connection id "0HNH1UUQ9GIR1" stopped.
2025-11-12 17:28:16.445 +03:00 [DBG] Connection id "0HNH1UUQ9GIR1" sending FIN because: "The Socket transport's send loop completed gracefully."
2025-11-12 17:28:16.448 +03:00 [DBG] Connection 0HNH1UUQ9GIR2 established using the following protocol: "Tls13"
2025-11-12 17:28:16.455 +03:00 [INF] Request starting HTTP/1.1 POST https://localhost:7257/api/Invoices - application/json 1316
2025-11-12 17:28:16.463 +03:00 [DBG] 1 candidate(s) found for the request path '/api/Invoices'
2025-11-12 17:28:16.470 +03:00 [DBG] Endpoint 'BillingSystem.API.Controllers.InvoicesController.Post (BillingSystem.API)' with route pattern 'api/Invoices' is valid for the request path '/api/Invoices'
2025-11-12 17:28:16.474 +03:00 [DBG] Request matched endpoint 'BillingSystem.API.Controllers.InvoicesController.Post (BillingSystem.API)'
2025-11-12 17:28:16.481 +03:00 [DBG] Static files was skipped as the request already matched an endpoint.
2025-11-12 17:28:16.675 +03:00 [DBG] An 'IServiceProvider' was created for internal use by Entity Framework.
2025-11-12 17:28:22.147 +03:00 [INF] Executing endpoint 'BillingSystem.API.Controllers.InvoicesController.Post (BillingSystem.API)'
2025-11-12 17:28:22.192 +03:00 [INF] Route matched with {action = "Post", controller = "Invoices"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Post(BillingSystem.Application.Requests.CreateInvoiceRequest) on controller BillingSystem.API.Controllers.InvoicesController (BillingSystem.API).
2025-11-12 17:28:22.200 +03:00 [DBG] Execution plan of authorization filters (in the following order): ["None"]
2025-11-12 17:28:22.204 +03:00 [DBG] Execution plan of resource filters (in the following order): ["None"]
2025-11-12 17:28:22.209 +03:00 [DBG] Execution plan of action filters (in the following order): ["Microsoft.AspNetCore.Mvc.ModelBinding.UnsupportedContentTypeFilter (Order: -3000)","Microsoft.AspNetCore.Mvc.Infrastructure.ModelStateInvalidFilter (Order: -2000)","BillingSystem.API.ActionFilters.AuditBillingRequestsFilter","BillingSystem.API.ActionFilters.IdempotencyFilter (Order: 0)"]
2025-11-12 17:28:22.216 +03:00 [DBG] Execution plan of exception filters (in the following order): ["None"]
2025-11-12 17:28:22.220 +03:00 [DBG] Execution plan of result filters (in the following order): ["Microsoft.AspNetCore.Mvc.Infrastructure.ClientErrorResultFilter (Order: -2000)","Microsoft.AspNetCore.Mvc.ProducesAttribute (Order: 0)","BillingSystem.API.ActionFilters.IdempotencyFilter (Order: 0)"]
2025-11-12 17:28:22.227 +03:00 [DBG] Executing controller factory for controller BillingSystem.API.Controllers.InvoicesController (BillingSystem.API)
2025-11-12 17:28:22.235 +03:00 [WRN] You do not have a valid license key for the Lucky Penny software MediatR. This is allowed for development and testing scenarios. If you are running in production you are required to have a licensed version. Please visit https://luckypennysoftware.com to obtain a valid license.
2025-11-12 17:28:22.294 +03:00 [DBG] Executed controller factory for controller BillingSystem.API.Controllers.InvoicesController (BillingSystem.API)
2025-11-12 17:28:22.328 +03:00 [DBG] Attempting to bind parameter 'invoiceRequest' of type 'BillingSystem.Application.Requests.CreateInvoiceRequest' ...
2025-11-12 17:28:22.335 +03:00 [DBG] Attempting to bind parameter 'invoiceRequest' of type 'BillingSystem.Application.Requests.CreateInvoiceRequest' using the name '' in request data ...
2025-11-12 17:28:22.340 +03:00 [DBG] Selected input formatter 'Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonInputFormatter' for content type 'application/json'.
2025-11-12 17:28:22.402 +03:00 [DBG] Connection id "0HNH1UUQ9GIR2", Request id "0HNH1UUQ9GIR2:00000001": started reading request body.
2025-11-12 17:28:22.406 +03:00 [DBG] Connection id "0HNH1UUQ9GIR2", Request id "0HNH1UUQ9GIR2:00000001": done reading request body.
2025-11-12 17:28:22.452 +03:00 [DBG] JSON input formatter succeeded, deserializing to type 'BillingSystem.Application.Requests.CreateInvoiceRequest'
2025-11-12 17:28:22.458 +03:00 [DBG] Done attempting to bind parameter 'invoiceRequest' of type 'BillingSystem.Application.Requests.CreateInvoiceRequest'.
2025-11-12 17:28:22.461 +03:00 [DBG] Done attempting to bind parameter 'invoiceRequest' of type 'BillingSystem.Application.Requests.CreateInvoiceRequest'.
2025-11-12 17:28:22.464 +03:00 [DBG] Attempting to validate the bound parameter 'invoiceRequest' of type 'BillingSystem.Application.Requests.CreateInvoiceRequest' ...
2025-11-12 17:28:22.497 +03:00 [DBG] Done attempting to validate the bound parameter 'invoiceRequest' of type 'BillingSystem.Application.Requests.CreateInvoiceRequest'.
2025-11-12 17:28:22.853 +03:00 [DBG] No relationship from 'Invoice' to 'Invoice' has been configured by convention because there are multiple properties on one entity type - {'DiscountedPrimaryInvoice'} that could be matched with the properties on the other entity type - {'InverseDiscountedPrimaryInvoice', 'InversePrimaryInvoice', 'InverseSubstitutionPrimaryInvoice', 'PrimaryInvoice', 'SubstitutionPrimaryInvoice'}. This message can be disregarded if explicit configuration has been specified in 'OnModelCreating'.
2025-11-12 17:28:23.175 +03:00 [DBG] No relationship from 'Invoice' to 'Invoice' has been configured by convention because there are multiple properties on one entity type - {'DiscountedPrimaryInvoice'} that could be matched with the properties on the other entity type - {'InverseDiscountedPrimaryInvoice', 'InversePrimaryInvoice', 'InverseSubstitutionPrimaryInvoice', 'PrimaryInvoice', 'SubstitutionPrimaryInvoice'}. This message can be disregarded if explicit configuration has been specified in 'OnModelCreating'.
2025-11-12 17:28:23.189 +03:00 [DBG] No relationship from 'Invoice' to 'Invoice' has been configured by convention because there are multiple properties on one entity type - {'InversePrimaryInvoice'} that could be matched with the properties on the other entity type - {'InverseSubstitutionPrimaryInvoice', 'PrimaryInvoice', 'SubstitutionPrimaryInvoice'}. This message can be disregarded if explicit configuration has been specified in 'OnModelCreating'.
2025-11-12 17:28:23.198 +03:00 [DBG] No relationship from 'Invoice' to 'Invoice' has been configured by convention because there are multiple properties on one entity type - {'InversePrimaryInvoice'} that could be matched with the properties on the other entity type - {'InverseSubstitutionPrimaryInvoice', 'PrimaryInvoice', 'SubstitutionPrimaryInvoice'}. This message can be disregarded if explicit configuration has been specified in 'OnModelCreating'.
2025-11-12 17:28:23.592 +03:00 [DBG] Entity Framework Core 9.0.9 initialized 'BillingServiceDBContext' using provider 'Microsoft.EntityFrameworkCore.SqlServer:9.0.9' with options: EngineType=SqlServer 
2025-11-12 17:28:23.722 +03:00 [DBG] Compiling query expression: 
'DbSet<Invoice>()
    .AsNoTracking()
    .Any(inv => inv.ExternalId.ToString() == __idempotentKey_0)'
2025-11-12 17:28:24.134 +03:00 [DBG] Generated query execution expression: 
'queryContext => ShapedQueryCompilingExpressionVisitor.SingleAsync<bool>(
    asyncEnumerable: SingleQueryingEnumerable.Create<bool>(
        relationalQueryContext: (RelationalQueryContext)queryContext, 
        relationalCommandResolver: parameters => [LIFTABLE Constant: RelationalCommandCache.QueryExpression(
            Projection Mapping:
                EmptyProjectionMember -> 0
            SELECT EXISTS (
                SELECT 1
                FROM Invoices AS i
                WHERE COALESCE(CONVERT(varchar(36), i.ExternalId), '') == @__idempotentKey_0)) | Resolver: c => new RelationalCommandCache(
            c.Dependencies.MemoryCache, 
            c.RelationalDependencies.QuerySqlGeneratorFactory, 
            c.RelationalDependencies.RelationalParameterBasedSqlProcessorFactory, 
            Projection Mapping:
                EmptyProjectionMember -> 0
            SELECT EXISTS (
                SELECT 1
                FROM Invoices AS i
                WHERE COALESCE(CONVERT(varchar(36), i.ExternalId), '') == @__idempotentKey_0), 
            False, 
            new HashSet<string>(
                new string[]{ }, 
                StringComparer.Ordinal
            )
        )].GetRelationalCommandTemplate(parameters), 
        readerColumns: null, 
        shaper: (queryContext, dataReader, resultContext, resultCoordinator) => 
        {
            bool? value1;
            value1 = dataReader.IsDBNull(0) ? default(bool?) : (bool?)dataReader.GetBoolean(0);
            return (bool)value1;
        }, 
        contextType: BillingSystem.Infrastructure.EF.BillingServiceDBContext, 
        standAloneStateManager: False, 
        detailedErrorsEnabled: False, 
        threadSafetyChecksEnabled: True), 
    cancellationToken: queryContext.CancellationToken)'
2025-11-12 17:28:24.209 +03:00 [DBG] Creating DbConnection.
2025-11-12 17:28:24.243 +03:00 [DBG] Created DbConnection. (29ms).
2025-11-12 17:28:24.253 +03:00 [DBG] Opening connection to database 'GAC-BillingService' on server '.'.
2025-11-12 17:28:24.648 +03:00 [DBG] Opened connection to database 'GAC-BillingService' on server '.'.
2025-11-12 17:28:24.664 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-11-12 17:28:24.681 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (13ms).
2025-11-12 17:28:24.696 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (35ms).
2025-11-12 17:28:24.713 +03:00 [DBG] Executing DbCommand [Parameters=[@__idempotentKey_0='?' (Size = 36) (DbType = AnsiString)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [Invoices] AS [i]
        WHERE CONVERT(varchar(36), [i].[ExternalId]) = @__idempotentKey_0) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2025-11-12 17:28:24.802 +03:00 [INF] Executed DbCommand (90ms) [Parameters=[@__idempotentKey_0='?' (Size = 36) (DbType = AnsiString)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [Invoices] AS [i]
        WHERE CONVERT(varchar(36), [i].[ExternalId]) = @__idempotentKey_0) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2025-11-12 17:28:24.836 +03:00 [DBG] Closing data reader to 'GAC-BillingService' on server '.'.
2025-11-12 17:28:24.853 +03:00 [DBG] A data reader for 'GAC-BillingService' on server '.' is being disposed after spending 36ms reading results.
2025-11-12 17:28:24.863 +03:00 [DBG] Closing connection to database 'GAC-BillingService' on server '.'.
2025-11-12 17:28:24.874 +03:00 [DBG] Closed connection to database 'GAC-BillingService' on server '.' (11ms).
2025-11-12 17:28:25.105 +03:00 [WRN] You do not have a valid license key for the Lucky Penny software AutoMapper. This is allowed for development and testing scenarios. If you are running in production you are required to have a licensed version. Please visit https://luckypennysoftware.com to obtain a valid license.
2025-11-12 17:28:31.605 +03:00 [DBG] Opening connection to database 'GAC-BillingService' on server '.'.
2025-11-12 17:28:31.612 +03:00 [DBG] Opened connection to database 'GAC-BillingService' on server '.'.
2025-11-12 17:28:31.617 +03:00 [DBG] Beginning transaction with isolation level 'Unspecified'.
2025-11-12 17:28:31.632 +03:00 [DBG] Began transaction with isolation level 'ReadCommitted'.
2025-11-12 17:28:32.365 +03:00 [DBG] 'BillingServiceDBContext' generated a temporary value for the property 'Invoice.Id'. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-11-12 17:28:32.549 +03:00 [DBG] Context 'BillingServiceDBContext' started tracking 'Invoice' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-11-12 17:28:32.557 +03:00 [DBG] 'BillingServiceDBContext' generated a temporary value for the property 'Customer.Id'. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-11-12 17:28:32.645 +03:00 [DBG] The foreign key property 'Invoice.CustomerId' was detected as changed. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see property values.
2025-11-12 17:28:32.669 +03:00 [DBG] Context 'BillingServiceDBContext' started tracking 'Customer' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-11-12 17:28:33.344 +03:00 [DBG] 'BillingServiceDBContext' generated a temporary value for the property 'OutboxEvent.Id'. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-11-12 17:28:33.377 +03:00 [DBG] Context 'BillingServiceDBContext' started tracking 'OutboxEvent' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-11-12 17:28:33.894 +03:00 [DBG] SaveChanges starting for 'BillingServiceDBContext'.
2025-11-12 17:28:33.903 +03:00 [DBG] DetectChanges starting for 'BillingServiceDBContext'.
2025-11-12 17:28:33.957 +03:00 [DBG] DetectChanges completed for 'BillingServiceDBContext'.
2025-11-12 17:28:34.051 +03:00 [DBG] Executing 2 update commands as a batch.
2025-11-12 17:28:34.060 +03:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-11-12 17:28:34.066 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-11-12 17:28:34.068 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (2ms).
2025-11-12 17:28:34.075 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (8ms).
2025-11-12 17:28:34.084 +03:00 [DBG] Executing DbCommand [Parameters=[@p0='?' (Size = 200), @p1='?' (Size = 200), @p2='?' (Size = 200), @p3='?' (Size = 200), @p4='?' (Size = 50), @p5='?' (Size = 200), @p6='?' (Size = 200), @p7='?' (Size = 50), @p8='?' (DbType = DateTime), @p9='?' (Size = 100), @p10='?' (Size = 80), @p11='?' (Size = 500), @p12='?' (Size = 100), @p13='?' (DbType = Int32), @p14='?' (DbType = Boolean), @p15='?' (DbType = DateTime), @p16='?' (Precision = 18) (DbType = Decimal), @p17='?' (Size = 50), @p18='?' (Size = 100), @p19='?' (DbType = Int64), @p20='?' (DbType = DateTime), @p21='?' (Size = 4000), @p22='?' (Size = 300), @p23='?' (Size = 4000), @p24='?' (DbType = Boolean), @p25='?' (Size = 20) (DbType = AnsiString)], CommandType='"Text"', CommandTimeout='30']
SET NOCOUNT ON;
INSERT INTO [Customers] ([Address_BuildingNumber], [Address_City], [Address_Country], [Address_District], [Address_PostalCode], [Address_Street], [Address_SubNumber], [CreatedBy], [CreatedDate], [CustomerType], [EmailAddress], [FullName], [IdentityNumber], [IdentityType], [IsDeleted], [LastUpdatedDate], [OverpaymentBalance], [PhoneNumber], [VATNumber])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18);
INSERT INTO [Outbox_events] ([Aggregate_id], [CreatedDate], [ErrorMsg], [Event_type], [Payload], [Processed], [ProcessingStatus])
OUTPUT INSERTED.[Id]
VALUES (@p19, @p20, @p21, @p22, @p23, @p24, @p25);
2025-11-12 17:28:34.099 +03:00 [ERR] Failed executing DbCommand (17ms) [Parameters=[@p0='?' (Size = 200), @p1='?' (Size = 200), @p2='?' (Size = 200), @p3='?' (Size = 200), @p4='?' (Size = 50), @p5='?' (Size = 200), @p6='?' (Size = 200), @p7='?' (Size = 50), @p8='?' (DbType = DateTime), @p9='?' (Size = 100), @p10='?' (Size = 80), @p11='?' (Size = 500), @p12='?' (Size = 100), @p13='?' (DbType = Int32), @p14='?' (DbType = Boolean), @p15='?' (DbType = DateTime), @p16='?' (Precision = 18) (DbType = Decimal), @p17='?' (Size = 50), @p18='?' (Size = 100), @p19='?' (DbType = Int64), @p20='?' (DbType = DateTime), @p21='?' (Size = 4000), @p22='?' (Size = 300), @p23='?' (Size = 4000), @p24='?' (DbType = Boolean), @p25='?' (Size = 20) (DbType = AnsiString)], CommandType='"Text"', CommandTimeout='30']
SET NOCOUNT ON;
INSERT INTO [Customers] ([Address_BuildingNumber], [Address_City], [Address_Country], [Address_District], [Address_PostalCode], [Address_Street], [Address_SubNumber], [CreatedBy], [CreatedDate], [CustomerType], [EmailAddress], [FullName], [IdentityNumber], [IdentityType], [IsDeleted], [LastUpdatedDate], [OverpaymentBalance], [PhoneNumber], [VATNumber])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18);
INSERT INTO [Outbox_events] ([Aggregate_id], [CreatedDate], [ErrorMsg], [Event_type], [Payload], [Processed], [ProcessingStatus])
OUTPUT INSERTED.[Id]
VALUES (@p19, @p20, @p21, @p22, @p23, @p24, @p25);
2025-11-12 17:28:34.149 +03:00 [ERR] An exception occurred in the database while saving changes for context type 'BillingSystem.Infrastructure.EF.BillingServiceDBContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> System.Data.SqlTypes.SqlTypeException: SqlDateTime overflow. Must be between 1/1/1753 12:00:00 AM and 12/31/9999 11:59:59 PM.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__211_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalDatabase.SaveChangesAsync(IList`1 entries, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> System.Data.SqlTypes.SqlTypeException: SqlDateTime overflow. Must be between 1/1/1753 12:00:00 AM and 12/31/9999 11:59:59 PM.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__211_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalDatabase.SaveChangesAsync(IList`1 entries, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2025-11-12 17:29:53.173 +03:00 [DBG] Registered model binder providers, in the following order: ["Microsoft.AspNetCore.Mvc.ModelBinding.Binders.BinderTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ServicesModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.BodyModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.HeaderModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FloatingPointTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.EnumTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.DateTimeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.SimpleTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.TryParseModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.CancellationTokenModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ByteArrayModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FormFileModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FormCollectionModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.KeyValuePairModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.DictionaryModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ArrayModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.CollectionModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ComplexObjectModelBinderProvider"]
2025-11-12 17:29:53.767 +03:00 [DBG] Hosting starting
2025-11-12 17:29:54.522 +03:00 [DBG] Starting bus instances: IBus
2025-11-12 17:29:54.544 +03:00 [DBG] Starting bus: "rabbitmq://localhost/"
2025-11-12 17:29:54.647 +03:00 [DBG] Middleware loaded
2025-11-12 17:29:54.661 +03:00 [DBG] Middleware loaded. Script /_framework/aspnetcore-browser-refresh.js (16519 B).
2025-11-12 17:29:54.761 +03:00 [DBG] Middleware loaded. Script /_framework/blazor-hotreload.js (799 B).
2025-11-12 17:29:54.769 +03:00 [DBG] Connect: guest@localhost:5672/
2025-11-12 17:29:54.982 +03:00 [DBG] Middleware loaded: DOTNET_MODIFIABLE_ASSEMBLIES=debug, __ASPNETCORE_BROWSER_TOOLS=true
2025-11-12 17:29:55.026 +03:00 [DBG] Connected: guest@localhost:5672/ (address: amqp://localhost:5672, local: 53829)
2025-11-12 17:29:55.171 +03:00 [DBG] Endpoint Ready: "rabbitmq://localhost/ECHGHANNAMLP1_BillingSystemAPI_bus_r1joyyyh3bcsbx7ibdxnd791re?temporary=true"
2025-11-12 17:29:55.176 +03:00 [INF] Bus started: "rabbitmq://localhost/"
2025-11-12 17:29:55.585 +03:00 [INF] Now listening on: https://localhost:7257
2025-11-12 17:29:55.589 +03:00 [INF] Now listening on: http://localhost:5009
2025-11-12 17:29:55.592 +03:00 [DBG] Loaded hosting startup assembly BillingSystem.API
2025-11-12 17:29:55.595 +03:00 [DBG] Loaded hosting startup assembly Microsoft.WebTools.ApiEndpointDiscovery
2025-11-12 17:29:55.597 +03:00 [DBG] Loaded hosting startup assembly Microsoft.AspNetCore.Watch.BrowserRefresh
2025-11-12 17:29:55.600 +03:00 [DBG] Loaded hosting startup assembly Microsoft.WebTools.BrowserLink.Net
2025-11-12 17:29:55.694 +03:00 [DBG] Connection id "0HNH1UVPLUOQ9" received FIN.
2025-11-12 17:29:55.714 +03:00 [DBG] Connection id "0HNH1UVPLUOQ9" accepted.
2025-11-12 17:29:55.726 +03:00 [DBG] Connection id "0HNH1UVPLUOQ9" started.
2025-11-12 17:29:55.775 +03:00 [DBG] Failed to authenticate HTTPS connection.
System.IO.IOException: Received an unexpected EOF or 0 bytes from the transport stream.
   at System.Net.Security.SslStream.ReceiveHandshakeFrameAsync[TIOAdapter](CancellationToken cancellationToken)
   at System.Net.Security.SslStream.ForceAuthenticationAsync[TIOAdapter](Boolean receiveFirst, Byte[] reAuthenticationData, CancellationToken cancellationToken)
   at System.Net.Security.SslStream.ProcessAuthenticationWithTelemetryAsync(Boolean isAsync, CancellationToken cancellationToken)
   at Microsoft.AspNetCore.Server.Kestrel.Https.Internal.HttpsConnectionMiddleware.OnConnectionAsync(ConnectionContext context)
2025-11-12 17:29:55.833 +03:00 [DBG] Connection id "0HNH1UVPLUOQ9" stopped.
2025-11-12 17:29:55.859 +03:00 [DBG] Connection id "0HNH1UVPLUOQ9" sending FIN because: "The Socket transport's send loop completed gracefully."
2025-11-12 17:29:55.914 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-11-12 17:29:55.917 +03:00 [INF] Hosting environment: Development
2025-11-12 17:29:55.926 +03:00 [INF] Content root path: C:\Repositories\Gac-BillingSystem\src\BillingSystem.API
2025-11-12 17:29:55.931 +03:00 [DBG] Hosting started
2025-11-12 17:29:56.843 +03:00 [DBG] Connection id "0HNH1UVPLUOQA" accepted.
2025-11-12 17:29:56.849 +03:00 [DBG] Connection id "0HNH1UVPLUOQA" started.
2025-11-12 17:29:56.975 +03:00 [DBG] Connection 0HNH1UVPLUOQA established using the following protocol: "Tls13"
2025-11-12 17:29:57.108 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7257/swagger/index.html - null null
2025-11-12 17:29:57.203 +03:00 [DBG] Wildcard detected, all requests with hosts will be allowed.
2025-11-12 17:29:57.246 +03:00 [DBG] No candidates found for the request path '/swagger/index.html'
2025-11-12 17:29:57.253 +03:00 [DBG] Request did not match any endpoints
2025-11-12 17:29:57.455 +03:00 [DBG] Response markup is scheduled to include Browser Link script injection.
2025-11-12 17:29:57.462 +03:00 [DBG] Response markup is scheduled to include browser refresh script injection.
2025-11-12 17:29:57.532 +03:00 [INF] HTTP GET /swagger/index.html responded 200 in 260.9118 ms
2025-11-12 17:29:57.544 +03:00 [DBG] Response markup was updated to include Browser Link script injection.
2025-11-12 17:29:57.549 +03:00 [DBG] Response markup was updated to include browser refresh script injection.
2025-11-12 17:29:57.559 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7257/swagger/index.html - 200 null text/html;charset=utf-8 469.1115ms
2025-11-12 17:29:57.649 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7257/_framework/aspnetcore-browser-refresh.js - null null
2025-11-12 17:29:57.649 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7257/_vs/browserLink - null null
2025-11-12 17:29:57.670 +03:00 [DBG] Script injected: /_framework/aspnetcore-browser-refresh.js
2025-11-12 17:29:57.679 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7257/_framework/aspnetcore-browser-refresh.js - 200 16519 application/javascript; charset=utf-8 31.4888ms
2025-11-12 17:29:57.787 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7257/_vs/browserLink - 200 null text/javascript; charset=UTF-8 139.1382ms
2025-11-12 17:29:57.905 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7257/swagger/v1/swagger.json - null null
2025-11-12 17:29:57.918 +03:00 [DBG] No candidates found for the request path '/swagger/v1/swagger.json'
2025-11-12 17:29:57.922 +03:00 [DBG] Request did not match any endpoints
2025-11-12 17:29:57.957 +03:00 [INF] HTTP GET /swagger/v1/swagger.json responded 200 in 29.5534 ms
2025-11-12 17:29:57.972 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7257/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 68.3117ms
2025-11-12 17:31:10.743 +03:00 [DBG] Connection id "0HNH1UVPLUOQB" accepted.
2025-11-12 17:31:10.743 +03:00 [DBG] Connection id "0HNH1UVPLUOQB" received FIN.
2025-11-12 17:31:10.760 +03:00 [DBG] Connection id "0HNH1UVPLUOQC" accepted.
2025-11-12 17:31:10.758 +03:00 [DBG] Connection id "0HNH1UVPLUOQB" started.
2025-11-12 17:31:10.782 +03:00 [DBG] Connection id "0HNH1UVPLUOQC" started.
2025-11-12 17:31:10.785 +03:00 [DBG] Failed to authenticate HTTPS connection.
System.IO.IOException: Received an unexpected EOF or 0 bytes from the transport stream.
   at System.Net.Security.SslStream.ReceiveHandshakeFrameAsync[TIOAdapter](CancellationToken cancellationToken)
   at System.Net.Security.SslStream.ForceAuthenticationAsync[TIOAdapter](Boolean receiveFirst, Byte[] reAuthenticationData, CancellationToken cancellationToken)
   at System.Net.Security.SslStream.ProcessAuthenticationWithTelemetryAsync(Boolean isAsync, CancellationToken cancellationToken)
   at Microsoft.AspNetCore.Server.Kestrel.Https.Internal.HttpsConnectionMiddleware.OnConnectionAsync(ConnectionContext context)
2025-11-12 17:31:10.792 +03:00 [DBG] Connection id "0HNH1UVPLUOQB" stopped.
2025-11-12 17:31:10.797 +03:00 [DBG] Connection id "0HNH1UVPLUOQB" sending FIN because: "The Socket transport's send loop completed gracefully."
2025-11-12 17:31:10.799 +03:00 [DBG] Connection 0HNH1UVPLUOQC established using the following protocol: "Tls13"
2025-11-12 17:31:10.813 +03:00 [INF] Request starting HTTP/1.1 POST https://localhost:7257/api/Invoices - application/json 1316
2025-11-12 17:31:10.828 +03:00 [DBG] 1 candidate(s) found for the request path '/api/Invoices'
2025-11-12 17:31:10.840 +03:00 [DBG] Endpoint 'BillingSystem.API.Controllers.InvoicesController.Post (BillingSystem.API)' with route pattern 'api/Invoices' is valid for the request path '/api/Invoices'
2025-11-12 17:31:10.846 +03:00 [DBG] Request matched endpoint 'BillingSystem.API.Controllers.InvoicesController.Post (BillingSystem.API)'
2025-11-12 17:31:10.854 +03:00 [DBG] Static files was skipped as the request already matched an endpoint.
2025-11-12 17:31:11.064 +03:00 [DBG] An 'IServiceProvider' was created for internal use by Entity Framework.
2025-11-12 17:31:16.494 +03:00 [INF] Executing endpoint 'BillingSystem.API.Controllers.InvoicesController.Post (BillingSystem.API)'
2025-11-12 17:31:16.555 +03:00 [INF] Route matched with {action = "Post", controller = "Invoices"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Post(BillingSystem.Application.Requests.CreateInvoiceRequest) on controller BillingSystem.API.Controllers.InvoicesController (BillingSystem.API).
2025-11-12 17:31:16.566 +03:00 [DBG] Execution plan of authorization filters (in the following order): ["None"]
2025-11-12 17:31:16.571 +03:00 [DBG] Execution plan of resource filters (in the following order): ["None"]
2025-11-12 17:31:16.578 +03:00 [DBG] Execution plan of action filters (in the following order): ["Microsoft.AspNetCore.Mvc.ModelBinding.UnsupportedContentTypeFilter (Order: -3000)","Microsoft.AspNetCore.Mvc.Infrastructure.ModelStateInvalidFilter (Order: -2000)","BillingSystem.API.ActionFilters.AuditBillingRequestsFilter","BillingSystem.API.ActionFilters.IdempotencyFilter (Order: 0)"]
2025-11-12 17:31:16.586 +03:00 [DBG] Execution plan of exception filters (in the following order): ["None"]
2025-11-12 17:31:16.590 +03:00 [DBG] Execution plan of result filters (in the following order): ["Microsoft.AspNetCore.Mvc.Infrastructure.ClientErrorResultFilter (Order: -2000)","Microsoft.AspNetCore.Mvc.ProducesAttribute (Order: 0)","BillingSystem.API.ActionFilters.IdempotencyFilter (Order: 0)"]
2025-11-12 17:31:16.599 +03:00 [DBG] Executing controller factory for controller BillingSystem.API.Controllers.InvoicesController (BillingSystem.API)
2025-11-12 17:31:16.609 +03:00 [WRN] You do not have a valid license key for the Lucky Penny software MediatR. This is allowed for development and testing scenarios. If you are running in production you are required to have a licensed version. Please visit https://luckypennysoftware.com to obtain a valid license.
2025-11-12 17:31:16.663 +03:00 [DBG] Executed controller factory for controller BillingSystem.API.Controllers.InvoicesController (BillingSystem.API)
2025-11-12 17:31:16.690 +03:00 [DBG] Attempting to bind parameter 'invoiceRequest' of type 'BillingSystem.Application.Requests.CreateInvoiceRequest' ...
2025-11-12 17:31:16.700 +03:00 [DBG] Attempting to bind parameter 'invoiceRequest' of type 'BillingSystem.Application.Requests.CreateInvoiceRequest' using the name '' in request data ...
2025-11-12 17:31:16.705 +03:00 [DBG] Selected input formatter 'Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonInputFormatter' for content type 'application/json'.
2025-11-12 17:31:16.744 +03:00 [DBG] Connection id "0HNH1UVPLUOQC", Request id "0HNH1UVPLUOQC:00000001": started reading request body.
2025-11-12 17:31:16.750 +03:00 [DBG] Connection id "0HNH1UVPLUOQC", Request id "0HNH1UVPLUOQC:00000001": done reading request body.
2025-11-12 17:31:16.791 +03:00 [DBG] JSON input formatter succeeded, deserializing to type 'BillingSystem.Application.Requests.CreateInvoiceRequest'
2025-11-12 17:31:16.795 +03:00 [DBG] Done attempting to bind parameter 'invoiceRequest' of type 'BillingSystem.Application.Requests.CreateInvoiceRequest'.
2025-11-12 17:31:16.800 +03:00 [DBG] Done attempting to bind parameter 'invoiceRequest' of type 'BillingSystem.Application.Requests.CreateInvoiceRequest'.
2025-11-12 17:31:16.804 +03:00 [DBG] Attempting to validate the bound parameter 'invoiceRequest' of type 'BillingSystem.Application.Requests.CreateInvoiceRequest' ...
2025-11-12 17:31:16.838 +03:00 [DBG] Done attempting to validate the bound parameter 'invoiceRequest' of type 'BillingSystem.Application.Requests.CreateInvoiceRequest'.
2025-11-12 17:31:17.136 +03:00 [DBG] No relationship from 'Invoice' to 'Invoice' has been configured by convention because there are multiple properties on one entity type - {'DiscountedPrimaryInvoice'} that could be matched with the properties on the other entity type - {'InverseDiscountedPrimaryInvoice', 'InversePrimaryInvoice', 'InverseSubstitutionPrimaryInvoice', 'PrimaryInvoice', 'SubstitutionPrimaryInvoice'}. This message can be disregarded if explicit configuration has been specified in 'OnModelCreating'.
2025-11-12 17:31:17.375 +03:00 [DBG] No relationship from 'Invoice' to 'Invoice' has been configured by convention because there are multiple properties on one entity type - {'DiscountedPrimaryInvoice'} that could be matched with the properties on the other entity type - {'InverseDiscountedPrimaryInvoice', 'InversePrimaryInvoice', 'InverseSubstitutionPrimaryInvoice', 'PrimaryInvoice', 'SubstitutionPrimaryInvoice'}. This message can be disregarded if explicit configuration has been specified in 'OnModelCreating'.
2025-11-12 17:31:17.391 +03:00 [DBG] No relationship from 'Invoice' to 'Invoice' has been configured by convention because there are multiple properties on one entity type - {'InversePrimaryInvoice'} that could be matched with the properties on the other entity type - {'InverseSubstitutionPrimaryInvoice', 'PrimaryInvoice', 'SubstitutionPrimaryInvoice'}. This message can be disregarded if explicit configuration has been specified in 'OnModelCreating'.
2025-11-12 17:31:17.405 +03:00 [DBG] No relationship from 'Invoice' to 'Invoice' has been configured by convention because there are multiple properties on one entity type - {'InversePrimaryInvoice'} that could be matched with the properties on the other entity type - {'InverseSubstitutionPrimaryInvoice', 'PrimaryInvoice', 'SubstitutionPrimaryInvoice'}. This message can be disregarded if explicit configuration has been specified in 'OnModelCreating'.
2025-11-12 17:31:17.740 +03:00 [DBG] Entity Framework Core 9.0.9 initialized 'BillingServiceDBContext' using provider 'Microsoft.EntityFrameworkCore.SqlServer:9.0.9' with options: EngineType=SqlServer 
2025-11-12 17:31:17.856 +03:00 [DBG] Compiling query expression: 
'DbSet<Invoice>()
    .AsNoTracking()
    .Any(inv => inv.ExternalId.ToString() == __idempotentKey_0)'
2025-11-12 17:31:18.163 +03:00 [DBG] Generated query execution expression: 
'queryContext => ShapedQueryCompilingExpressionVisitor.SingleAsync<bool>(
    asyncEnumerable: SingleQueryingEnumerable.Create<bool>(
        relationalQueryContext: (RelationalQueryContext)queryContext, 
        relationalCommandResolver: parameters => [LIFTABLE Constant: RelationalCommandCache.QueryExpression(
            Projection Mapping:
                EmptyProjectionMember -> 0
            SELECT EXISTS (
                SELECT 1
                FROM Invoices AS i
                WHERE COALESCE(CONVERT(varchar(36), i.ExternalId), '') == @__idempotentKey_0)) | Resolver: c => new RelationalCommandCache(
            c.Dependencies.MemoryCache, 
            c.RelationalDependencies.QuerySqlGeneratorFactory, 
            c.RelationalDependencies.RelationalParameterBasedSqlProcessorFactory, 
            Projection Mapping:
                EmptyProjectionMember -> 0
            SELECT EXISTS (
                SELECT 1
                FROM Invoices AS i
                WHERE COALESCE(CONVERT(varchar(36), i.ExternalId), '') == @__idempotentKey_0), 
            False, 
            new HashSet<string>(
                new string[]{ }, 
                StringComparer.Ordinal
            )
        )].GetRelationalCommandTemplate(parameters), 
        readerColumns: null, 
        shaper: (queryContext, dataReader, resultContext, resultCoordinator) => 
        {
            bool? value1;
            value1 = dataReader.IsDBNull(0) ? default(bool?) : (bool?)dataReader.GetBoolean(0);
            return (bool)value1;
        }, 
        contextType: BillingSystem.Infrastructure.EF.BillingServiceDBContext, 
        standAloneStateManager: False, 
        detailedErrorsEnabled: False, 
        threadSafetyChecksEnabled: True), 
    cancellationToken: queryContext.CancellationToken)'
2025-11-12 17:31:18.248 +03:00 [DBG] Creating DbConnection.
2025-11-12 17:31:18.291 +03:00 [DBG] Created DbConnection. (39ms).
2025-11-12 17:31:18.300 +03:00 [DBG] Opening connection to database 'GAC-BillingService' on server '.'.
2025-11-12 17:31:18.759 +03:00 [DBG] Opened connection to database 'GAC-BillingService' on server '.'.
2025-11-12 17:31:18.770 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-11-12 17:31:18.793 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (12ms).
2025-11-12 17:31:18.823 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (52ms).
2025-11-12 17:31:18.845 +03:00 [DBG] Executing DbCommand [Parameters=[@__idempotentKey_0='?' (Size = 36) (DbType = AnsiString)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [Invoices] AS [i]
        WHERE CONVERT(varchar(36), [i].[ExternalId]) = @__idempotentKey_0) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2025-11-12 17:31:18.926 +03:00 [INF] Executed DbCommand (87ms) [Parameters=[@__idempotentKey_0='?' (Size = 36) (DbType = AnsiString)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [Invoices] AS [i]
        WHERE CONVERT(varchar(36), [i].[ExternalId]) = @__idempotentKey_0) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2025-11-12 17:31:18.954 +03:00 [DBG] Closing data reader to 'GAC-BillingService' on server '.'.
2025-11-12 17:31:18.971 +03:00 [DBG] A data reader for 'GAC-BillingService' on server '.' is being disposed after spending 30ms reading results.
2025-11-12 17:31:18.982 +03:00 [DBG] Closing connection to database 'GAC-BillingService' on server '.'.
2025-11-12 17:31:18.997 +03:00 [DBG] Closed connection to database 'GAC-BillingService' on server '.' (15ms).
2025-11-12 17:31:19.196 +03:00 [WRN] You do not have a valid license key for the Lucky Penny software AutoMapper. This is allowed for development and testing scenarios. If you are running in production you are required to have a licensed version. Please visit https://luckypennysoftware.com to obtain a valid license.
2025-11-12 17:31:32.162 +03:00 [DBG] Opening connection to database 'GAC-BillingService' on server '.'.
2025-11-12 17:31:32.173 +03:00 [DBG] Opened connection to database 'GAC-BillingService' on server '.'.
2025-11-12 17:31:32.184 +03:00 [DBG] Beginning transaction with isolation level 'Unspecified'.
2025-11-12 17:31:32.212 +03:00 [DBG] Began transaction with isolation level 'ReadCommitted'.
2025-11-12 17:31:32.308 +03:00 [DBG] 'BillingServiceDBContext' generated a temporary value for the property 'Invoice.Id'. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-11-12 17:31:32.501 +03:00 [DBG] Context 'BillingServiceDBContext' started tracking 'Invoice' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-11-12 17:31:32.508 +03:00 [DBG] 'BillingServiceDBContext' generated a temporary value for the property 'Customer.Id'. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-11-12 17:31:32.575 +03:00 [DBG] The foreign key property 'Invoice.CustomerId' was detected as changed. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see property values.
2025-11-12 17:31:32.596 +03:00 [DBG] Context 'BillingServiceDBContext' started tracking 'Customer' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-11-12 17:31:32.606 +03:00 [DBG] 'BillingServiceDBContext' generated a temporary value for the property 'OutboxEvent.Id'. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-11-12 17:31:32.635 +03:00 [DBG] Context 'BillingServiceDBContext' started tracking 'OutboxEvent' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-11-12 17:31:32.644 +03:00 [DBG] SaveChanges starting for 'BillingServiceDBContext'.
2025-11-12 17:31:32.651 +03:00 [DBG] DetectChanges starting for 'BillingServiceDBContext'.
2025-11-12 17:31:32.764 +03:00 [DBG] DetectChanges completed for 'BillingServiceDBContext'.
2025-11-12 17:31:32.884 +03:00 [DBG] Executing 2 update commands as a batch.
2025-11-12 17:31:32.891 +03:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-11-12 17:31:32.897 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-11-12 17:31:32.900 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (2ms).
2025-11-12 17:31:32.907 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (10ms).
2025-11-12 17:31:32.919 +03:00 [DBG] Executing DbCommand [Parameters=[@p0='?' (Size = 200), @p1='?' (Size = 200), @p2='?' (Size = 200), @p3='?' (Size = 200), @p4='?' (Size = 50), @p5='?' (Size = 200), @p6='?' (Size = 200), @p7='?' (Size = 50), @p8='?' (DbType = DateTime), @p9='?' (Size = 100), @p10='?' (Size = 80), @p11='?' (Size = 500), @p12='?' (Size = 100), @p13='?' (DbType = Int32), @p14='?' (DbType = Boolean), @p15='?' (DbType = DateTime), @p16='?' (Precision = 18) (DbType = Decimal), @p17='?' (Size = 50), @p18='?' (Size = 100), @p19='?' (DbType = Int64), @p20='?' (DbType = DateTime), @p21='?' (Size = 4000), @p22='?' (Size = 300), @p23='?' (Size = 4000), @p24='?' (DbType = Boolean), @p25='?' (Size = 20) (DbType = AnsiString)], CommandType='"Text"', CommandTimeout='30']
SET NOCOUNT ON;
INSERT INTO [Customers] ([Address_BuildingNumber], [Address_City], [Address_Country], [Address_District], [Address_PostalCode], [Address_Street], [Address_SubNumber], [CreatedBy], [CreatedDate], [CustomerType], [EmailAddress], [FullName], [IdentityNumber], [IdentityType], [IsDeleted], [LastUpdatedDate], [OverpaymentBalance], [PhoneNumber], [VATNumber])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18);
INSERT INTO [Outbox_events] ([Aggregate_id], [CreatedDate], [ErrorMsg], [Event_type], [Payload], [Processed], [ProcessingStatus])
OUTPUT INSERTED.[Id]
VALUES (@p19, @p20, @p21, @p22, @p23, @p24, @p25);
2025-11-12 17:31:32.962 +03:00 [INF] Executed DbCommand (48ms) [Parameters=[@p0='?' (Size = 200), @p1='?' (Size = 200), @p2='?' (Size = 200), @p3='?' (Size = 200), @p4='?' (Size = 50), @p5='?' (Size = 200), @p6='?' (Size = 200), @p7='?' (Size = 50), @p8='?' (DbType = DateTime), @p9='?' (Size = 100), @p10='?' (Size = 80), @p11='?' (Size = 500), @p12='?' (Size = 100), @p13='?' (DbType = Int32), @p14='?' (DbType = Boolean), @p15='?' (DbType = DateTime), @p16='?' (Precision = 18) (DbType = Decimal), @p17='?' (Size = 50), @p18='?' (Size = 100), @p19='?' (DbType = Int64), @p20='?' (DbType = DateTime), @p21='?' (Size = 4000), @p22='?' (Size = 300), @p23='?' (Size = 4000), @p24='?' (DbType = Boolean), @p25='?' (Size = 20) (DbType = AnsiString)], CommandType='"Text"', CommandTimeout='30']
SET NOCOUNT ON;
INSERT INTO [Customers] ([Address_BuildingNumber], [Address_City], [Address_Country], [Address_District], [Address_PostalCode], [Address_Street], [Address_SubNumber], [CreatedBy], [CreatedDate], [CustomerType], [EmailAddress], [FullName], [IdentityNumber], [IdentityType], [IsDeleted], [LastUpdatedDate], [OverpaymentBalance], [PhoneNumber], [VATNumber])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18);
INSERT INTO [Outbox_events] ([Aggregate_id], [CreatedDate], [ErrorMsg], [Event_type], [Payload], [Processed], [ProcessingStatus])
OUTPUT INSERTED.[Id]
VALUES (@p19, @p20, @p21, @p22, @p23, @p24, @p25);
2025-11-12 17:31:32.980 +03:00 [DBG] Closing data reader to 'GAC-BillingService' on server '.'.
2025-11-12 17:31:32.986 +03:00 [DBG] A data reader for 'GAC-BillingService' on server '.' is being disposed after spending 17ms reading results.
2025-11-12 17:31:33.007 +03:00 [ERR] An exception occurred in the database while saving changes for context type 'BillingSystem.Infrastructure.EF.BillingServiceDBContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): Cannot insert the value NULL into column 'CreatedBy', table 'GAC-BillingService.dbo.Customers'; column does not allow nulls. INSERT fails.
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:b3e4bdfb-c459-47ad-9f2e-2f9caf8a0165
Error Number:515,State:2,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalDatabase.SaveChangesAsync(IList`1 entries, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): Cannot insert the value NULL into column 'CreatedBy', table 'GAC-BillingService.dbo.Customers'; column does not allow nulls. INSERT fails.
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:b3e4bdfb-c459-47ad-9f2e-2f9caf8a0165
Error Number:515,State:2,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalDatabase.SaveChangesAsync(IList`1 entries, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2025-11-12 17:31:33.087 +03:00 [ERR] exception occured An error occurred while saving the entity changes. See the inner exception for details. , stackTrace    at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalDatabase.SaveChangesAsync(IList`1 entries, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at BillingSystem.Infrastructure.Persistence.EF.InvoiceRepository.Insert(Invoice entity) in C:\Repositories\Gac-BillingSystem\src\BillingSystem.Infrastructure\Persistence\EF\InvoiceRepository.cs:line 78
2025-11-12 17:31:33.095 +03:00 [ERR] exception inner exception Cannot insert the value NULL into column 'CreatedBy', table 'GAC-BillingService.dbo.Customers'; column does not allow nulls. INSERT fails. , stackTrace    at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
2025-11-12 17:31:33.101 +03:00 [DBG] Rolling back transaction.
2025-11-12 17:31:33.113 +03:00 [DBG] Rolled back transaction.
2025-11-12 17:31:33.119 +03:00 [DBG] Closing connection to database 'GAC-BillingService' on server '.'.
2025-11-12 17:31:33.126 +03:00 [DBG] Closed connection to database 'GAC-BillingService' on server '.' (6ms).
2025-11-12 17:31:33.161 +03:00 [DBG] Disposing transaction.
2025-11-12 17:31:33.235 +03:00 [ERR] exception occured An error occurred while saving the entity changes. See the inner exception for details. , stackTrace    at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalDatabase.SaveChangesAsync(IList`1 entries, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at BillingSystem.Infrastructure.Persistence.EF.InvoiceRepository.Insert(Invoice entity) in C:\Repositories\Gac-BillingSystem\src\BillingSystem.Infrastructure\Persistence\EF\InvoiceRepository.cs:line 78
   at BillingSystem.Application.Commands.CreateInvoiceCommandRequestHandler.Handle(CreateInvoiceRequest request, CancellationToken cancellationToken) in C:\Repositories\Gac-BillingSystem\src\BillingSystem.Application\Commands\CreateInvoiceCommandRequestHandler.cs:line 43
   at BillingSystem.API.Controllers.InvoicesController.Post(CreateInvoiceRequest invoiceRequest) in C:\Repositories\Gac-BillingSystem\src\BillingSystem.API\Controllers\InvoicesController.cs:line 45
2025-11-12 17:31:33.242 +03:00 [ERR] exception inner exception Cannot insert the value NULL into column 'CreatedBy', table 'GAC-BillingService.dbo.Customers'; column does not allow nulls. INSERT fails. , stackTrace    at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
2025-11-12 17:31:33.268 +03:00 [DBG] List of registered output formatters, in the following order: ["Microsoft.AspNetCore.Mvc.Formatters.HttpNoContentOutputFormatter","Microsoft.AspNetCore.Mvc.Formatters.StringOutputFormatter","Microsoft.AspNetCore.Mvc.Formatters.StreamOutputFormatter","Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonOutputFormatter"]
2025-11-12 17:31:33.276 +03:00 [DBG] No information found on request to perform content negotiation.
2025-11-12 17:31:33.281 +03:00 [DBG] Attempting to select the first output formatter in the output formatters list which supports a content type from the explicitly specified content types '["application/json","application/problem+json","application/problem+xml"]'.
2025-11-12 17:31:33.289 +03:00 [DBG] Selected output formatter 'Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonOutputFormatter' and content type 'application/json' to write the response.
2025-11-12 17:31:33.294 +03:00 [INF] Executing ObjectResult, writing value of type 'Microsoft.AspNetCore.Mvc.ProblemDetails'.
2025-11-12 17:31:33.329 +03:00 [INF] Executed action BillingSystem.API.Controllers.InvoicesController.Post (BillingSystem.API) in 16727.6767ms
2025-11-12 17:31:33.334 +03:00 [INF] Executed endpoint 'BillingSystem.API.Controllers.InvoicesController.Post (BillingSystem.API)'
2025-11-12 17:31:33.339 +03:00 [ERR] HTTP POST /api/Invoices responded 500 in 22486.7037 ms
2025-11-12 17:31:33.344 +03:00 [DBG] Connection id "0HNH1UVPLUOQC" completed keep alive response.
2025-11-12 17:31:33.351 +03:00 [DBG] 'BillingServiceDBContext' disposed.
2025-11-12 17:31:33.358 +03:00 [DBG] Disposing connection to database 'GAC-BillingService' on server '.'.
2025-11-12 17:31:33.363 +03:00 [DBG] Disposed connection to database '' on server '' (4ms).
2025-11-12 17:31:33.366 +03:00 [INF] Request finished HTTP/1.1 POST https://localhost:7257/api/Invoices - 500 null application/json; charset=utf-8 22553.3288ms
