2025-11-18 12:50:07.390 +03:00 [DBG] Registered model binder providers, in the following order: ["Microsoft.AspNetCore.Mvc.ModelBinding.Binders.BinderTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ServicesModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.BodyModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.HeaderModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FloatingPointTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.EnumTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.DateTimeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.SimpleTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.TryParseModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.CancellationTokenModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ByteArrayModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FormFileModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FormCollectionModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.KeyValuePairModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.DictionaryModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ArrayModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.CollectionModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ComplexObjectModelBinderProvider"]
2025-11-18 12:50:07.678 +03:00 [DBG] Hosting starting
2025-11-18 12:50:08.166 +03:00 [DBG] Starting bus instances: IBus
2025-11-18 12:50:08.176 +03:00 [DBG] Starting bus: "rabbitmq://localhost/"
2025-11-18 12:50:08.220 +03:00 [DBG] Middleware loaded
2025-11-18 12:50:08.230 +03:00 [DBG] Middleware loaded. Script /_framework/aspnetcore-browser-refresh.js (16519 B).
2025-11-18 12:50:08.236 +03:00 [DBG] Middleware loaded. Script /_framework/blazor-hotreload.js (799 B).
2025-11-18 12:50:08.326 +03:00 [DBG] Connect: guest@localhost:5672/
2025-11-18 12:50:08.567 +03:00 [DBG] Connected: guest@localhost:5672/ (address: amqp://localhost:5672, local: 55086)
2025-11-18 12:50:08.658 +03:00 [DBG] Endpoint Ready: "rabbitmq://localhost/ECHGHANNAMLP1_BillingSystemAPI_bus_yb5yyyyh3bcsbqspbdxnpb65r7?temporary=true"
2025-11-18 12:50:08.668 +03:00 [INF] Bus started: "rabbitmq://localhost/"
2025-11-18 12:50:08.916 +03:00 [DBG] Middleware loaded: DOTNET_MODIFIABLE_ASSEMBLIES=debug, __ASPNETCORE_BROWSER_TOOLS=true
2025-11-18 12:50:09.249 +03:00 [INF] Now listening on: https://localhost:7257
2025-11-18 12:50:09.254 +03:00 [INF] Now listening on: http://localhost:5009
2025-11-18 12:50:09.258 +03:00 [DBG] Loaded hosting startup assembly BillingSystem.API
2025-11-18 12:50:09.260 +03:00 [DBG] Loaded hosting startup assembly Microsoft.WebTools.ApiEndpointDiscovery
2025-11-18 12:50:09.263 +03:00 [DBG] Loaded hosting startup assembly Microsoft.AspNetCore.Watch.BrowserRefresh
2025-11-18 12:50:09.266 +03:00 [DBG] Loaded hosting startup assembly Microsoft.WebTools.BrowserLink.Net
2025-11-18 12:50:09.383 +03:00 [DBG] Connection id "0HNH6GVE6S2SF" accepted.
2025-11-18 12:50:09.391 +03:00 [DBG] Connection id "0HNH6GVE6S2SF" started.
2025-11-18 12:50:09.415 +03:00 [DBG] Connection id "0HNH6GVE6S2SF" received FIN.
2025-11-18 12:50:09.437 +03:00 [DBG] Failed to authenticate HTTPS connection.
System.IO.IOException: Received an unexpected EOF or 0 bytes from the transport stream.
   at System.Net.Security.SslStream.ReceiveHandshakeFrameAsync[TIOAdapter](CancellationToken cancellationToken)
   at System.Net.Security.SslStream.ForceAuthenticationAsync[TIOAdapter](Boolean receiveFirst, Byte[] reAuthenticationData, CancellationToken cancellationToken)
   at System.Net.Security.SslStream.ProcessAuthenticationWithTelemetryAsync(Boolean isAsync, CancellationToken cancellationToken)
   at Microsoft.AspNetCore.Server.Kestrel.Https.Internal.HttpsConnectionMiddleware.OnConnectionAsync(ConnectionContext context)
2025-11-18 12:50:09.453 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-11-18 12:50:09.532 +03:00 [INF] Hosting environment: Development
2025-11-18 12:50:09.536 +03:00 [DBG] Connection id "0HNH6GVE6S2SF" stopped.
2025-11-18 12:50:09.537 +03:00 [INF] Content root path: C:\Repositories\Gac-BillingSystem\src\BillingSystem.API
2025-11-18 12:50:09.546 +03:00 [DBG] Hosting started
2025-11-18 12:50:09.549 +03:00 [DBG] Connection id "0HNH6GVE6S2SF" sending FIN because: "The Socket transport's send loop completed gracefully."
2025-11-18 12:50:10.219 +03:00 [DBG] Connection id "0HNH6GVE6S2SG" accepted.
2025-11-18 12:50:10.223 +03:00 [DBG] Connection id "0HNH6GVE6S2SG" started.
2025-11-18 12:50:10.294 +03:00 [DBG] Connection 0HNH6GVE6S2SG established using the following protocol: "Tls13"
2025-11-18 12:50:10.435 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7257/swagger/index.html - null null
2025-11-18 12:50:10.579 +03:00 [DBG] Wildcard detected, all requests with hosts will be allowed.
2025-11-18 12:50:10.606 +03:00 [DBG] No candidates found for the request path '/swagger/index.html'
2025-11-18 12:50:10.610 +03:00 [DBG] Request did not match any endpoints
2025-11-18 12:50:10.693 +03:00 [DBG] Response markup is scheduled to include Browser Link script injection.
2025-11-18 12:50:10.696 +03:00 [DBG] Response markup is scheduled to include browser refresh script injection.
2025-11-18 12:50:10.721 +03:00 [INF] HTTP GET /swagger/index.html responded 200 in 100.7982 ms
2025-11-18 12:50:10.730 +03:00 [DBG] Response markup was updated to include Browser Link script injection.
2025-11-18 12:50:10.733 +03:00 [DBG] Response markup was updated to include browser refresh script injection.
2025-11-18 12:50:10.751 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7257/swagger/index.html - 200 null text/html;charset=utf-8 324.6457ms
2025-11-18 12:50:10.943 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7257/_framework/aspnetcore-browser-refresh.js - null null
2025-11-18 12:50:10.943 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7257/_vs/browserLink - null null
2025-11-18 12:50:10.956 +03:00 [DBG] Script injected: /_framework/aspnetcore-browser-refresh.js
2025-11-18 12:50:10.962 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7257/_framework/aspnetcore-browser-refresh.js - 200 16519 application/javascript; charset=utf-8 20.1044ms
2025-11-18 12:50:11.039 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7257/_vs/browserLink - 200 null text/javascript; charset=UTF-8 96.1555ms
2025-11-18 12:50:11.144 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7257/swagger/v1/swagger.json - null null
2025-11-18 12:50:11.155 +03:00 [DBG] No candidates found for the request path '/swagger/v1/swagger.json'
2025-11-18 12:50:11.158 +03:00 [DBG] Request did not match any endpoints
2025-11-18 12:50:11.183 +03:00 [INF] HTTP GET /swagger/v1/swagger.json responded 200 in 21.4358 ms
2025-11-18 12:50:11.191 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7257/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 48.211ms
2025-11-18 14:06:43.939 +03:00 [DBG] Registered model binder providers, in the following order: ["Microsoft.AspNetCore.Mvc.ModelBinding.Binders.BinderTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ServicesModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.BodyModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.HeaderModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FloatingPointTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.EnumTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.DateTimeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.SimpleTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.TryParseModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.CancellationTokenModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ByteArrayModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FormFileModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FormCollectionModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.KeyValuePairModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.DictionaryModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ArrayModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.CollectionModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ComplexObjectModelBinderProvider"]
2025-11-18 14:06:44.208 +03:00 [DBG] Hosting starting
2025-11-18 14:06:45.209 +03:00 [DBG] Starting bus instances: IBus
2025-11-18 14:06:45.224 +03:00 [DBG] Starting bus: "rabbitmq://localhost/"
2025-11-18 14:06:45.336 +03:00 [DBG] Middleware loaded
2025-11-18 14:06:45.346 +03:00 [DBG] Middleware loaded. Script /_framework/aspnetcore-browser-refresh.js (16519 B).
2025-11-18 14:06:45.356 +03:00 [DBG] Middleware loaded. Script /_framework/blazor-hotreload.js (799 B).
2025-11-18 14:06:45.390 +03:00 [DBG] Connect: guest@localhost:5672/
2025-11-18 14:06:45.669 +03:00 [DBG] Middleware loaded: DOTNET_MODIFIABLE_ASSEMBLIES=debug, __ASPNETCORE_BROWSER_TOOLS=true
2025-11-18 14:06:45.740 +03:00 [DBG] Connected: guest@localhost:5672/ (address: amqp://localhost:5672, local: 59530)
2025-11-18 14:06:45.848 +03:00 [DBG] Endpoint Ready: "rabbitmq://localhost/ECHGHANNAMLP1_BillingSystemAPI_bus_aniyyyyh3bcsbtefbdxnprwxrh?temporary=true"
2025-11-18 14:06:45.853 +03:00 [INF] Bus started: "rabbitmq://localhost/"
2025-11-18 14:06:46.181 +03:00 [INF] Now listening on: https://localhost:7257
2025-11-18 14:06:46.190 +03:00 [INF] Now listening on: http://localhost:5009
2025-11-18 14:06:46.195 +03:00 [DBG] Loaded hosting startup assembly BillingSystem.API
2025-11-18 14:06:46.198 +03:00 [DBG] Loaded hosting startup assembly Microsoft.WebTools.ApiEndpointDiscovery
2025-11-18 14:06:46.203 +03:00 [DBG] Loaded hosting startup assembly Microsoft.AspNetCore.Watch.BrowserRefresh
2025-11-18 14:06:46.206 +03:00 [DBG] Loaded hosting startup assembly Microsoft.WebTools.BrowserLink.Net
2025-11-18 14:06:46.421 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-11-18 14:06:46.435 +03:00 [INF] Hosting environment: Development
2025-11-18 14:06:46.438 +03:00 [INF] Content root path: C:\Repositories\Gac-BillingSystem\src\BillingSystem.API
2025-11-18 14:06:46.445 +03:00 [DBG] Hosting started
2025-11-18 14:06:46.595 +03:00 [DBG] Connection id "0HNH6IA899J2L" accepted.
2025-11-18 14:06:46.603 +03:00 [DBG] Connection id "0HNH6IA899J2L" received FIN.
2025-11-18 14:06:46.622 +03:00 [DBG] Connection id "0HNH6IA899J2L" started.
2025-11-18 14:06:46.779 +03:00 [DBG] Failed to authenticate HTTPS connection.
System.IO.IOException: Received an unexpected EOF or 0 bytes from the transport stream.
   at System.Net.Security.SslStream.ReceiveHandshakeFrameAsync[TIOAdapter](CancellationToken cancellationToken)
   at System.Net.Security.SslStream.ForceAuthenticationAsync[TIOAdapter](Boolean receiveFirst, Byte[] reAuthenticationData, CancellationToken cancellationToken)
   at System.Net.Security.SslStream.ProcessAuthenticationWithTelemetryAsync(Boolean isAsync, CancellationToken cancellationToken)
   at Microsoft.AspNetCore.Server.Kestrel.Https.Internal.HttpsConnectionMiddleware.OnConnectionAsync(ConnectionContext context)
2025-11-18 14:06:46.845 +03:00 [DBG] Connection id "0HNH6IA899J2L" stopped.
2025-11-18 14:06:46.892 +03:00 [DBG] Connection id "0HNH6IA899J2L" sending FIN because: "The Socket transport's send loop completed gracefully."
2025-11-18 14:06:47.566 +03:00 [DBG] Connection id "0HNH6IA899J2M" accepted.
2025-11-18 14:06:47.576 +03:00 [DBG] Connection id "0HNH6IA899J2M" started.
2025-11-18 14:06:47.841 +03:00 [DBG] Connection 0HNH6IA899J2M established using the following protocol: "Tls13"
2025-11-18 14:06:48.195 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7257/swagger/index.html - null null
2025-11-18 14:06:48.353 +03:00 [DBG] Wildcard detected, all requests with hosts will be allowed.
2025-11-18 14:06:48.383 +03:00 [DBG] No candidates found for the request path '/swagger/index.html'
2025-11-18 14:06:48.389 +03:00 [DBG] Request did not match any endpoints
2025-11-18 14:06:48.528 +03:00 [DBG] Response markup is scheduled to include Browser Link script injection.
2025-11-18 14:06:48.534 +03:00 [DBG] Response markup is scheduled to include browser refresh script injection.
2025-11-18 14:06:48.582 +03:00 [INF] HTTP GET /swagger/index.html responded 200 in 178.6523 ms
2025-11-18 14:06:48.591 +03:00 [DBG] Response markup was updated to include Browser Link script injection.
2025-11-18 14:06:48.596 +03:00 [DBG] Response markup was updated to include browser refresh script injection.
2025-11-18 14:06:48.607 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7257/swagger/index.html - 200 null text/html;charset=utf-8 472.8676ms
2025-11-18 14:06:48.664 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7257/_framework/aspnetcore-browser-refresh.js - null null
2025-11-18 14:06:48.673 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7257/_vs/browserLink - null null
2025-11-18 14:06:48.683 +03:00 [DBG] Script injected: /_framework/aspnetcore-browser-refresh.js
2025-11-18 14:06:48.691 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7257/_framework/aspnetcore-browser-refresh.js - 200 16519 application/javascript; charset=utf-8 27.0898ms
2025-11-18 14:06:48.804 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7257/_vs/browserLink - 200 null text/javascript; charset=UTF-8 130.9593ms
2025-11-18 14:06:48.948 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7257/swagger/v1/swagger.json - null null
2025-11-18 14:06:48.961 +03:00 [DBG] No candidates found for the request path '/swagger/v1/swagger.json'
2025-11-18 14:06:48.966 +03:00 [DBG] Request did not match any endpoints
2025-11-18 14:06:49.006 +03:00 [INF] HTTP GET /swagger/v1/swagger.json responded 200 in 34.1230 ms
2025-11-18 14:06:49.021 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7257/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 74.1949ms
2025-11-18 14:08:20.311 +03:00 [DBG] Connection id "0HNH6IA899J2M" received FIN.
2025-11-18 14:08:20.320 +03:00 [DBG] The connection queue processing loop for 0HNH6IA899J2M completed.
2025-11-18 14:08:20.325 +03:00 [DBG] Connection id "0HNH6IA899J2M" is closed. The last processed stream ID was 7.
2025-11-18 14:08:20.333 +03:00 [DBG] Connection id "0HNH6IA899J2M" sending FIN because: "The Socket transport's send loop completed gracefully."
2025-11-18 14:08:20.354 +03:00 [DBG] Connection id "0HNH6IA899J2M" stopped.
2025-11-18 15:09:40.534 +03:00 [DBG] Connection id "0HNH6IA899J2N" received FIN.
2025-11-18 15:09:40.551 +03:00 [DBG] Connection id "0HNH6IA899J2N" accepted.
2025-11-18 15:09:40.563 +03:00 [DBG] Connection id "0HNH6IA899J2N" started.
2025-11-18 15:09:40.564 +03:00 [DBG] Connection id "0HNH6IA899J2O" accepted.
2025-11-18 15:09:40.575 +03:00 [DBG] Failed to authenticate HTTPS connection.
System.IO.IOException: Received an unexpected EOF or 0 bytes from the transport stream.
   at System.Net.Security.SslStream.ReceiveHandshakeFrameAsync[TIOAdapter](CancellationToken cancellationToken)
   at System.Net.Security.SslStream.ForceAuthenticationAsync[TIOAdapter](Boolean receiveFirst, Byte[] reAuthenticationData, CancellationToken cancellationToken)
   at System.Net.Security.SslStream.ProcessAuthenticationWithTelemetryAsync(Boolean isAsync, CancellationToken cancellationToken)
   at Microsoft.AspNetCore.Server.Kestrel.Https.Internal.HttpsConnectionMiddleware.OnConnectionAsync(ConnectionContext context)
2025-11-18 15:09:40.576 +03:00 [DBG] Connection id "0HNH6IA899J2O" started.
2025-11-18 15:09:40.581 +03:00 [DBG] Connection id "0HNH6IA899J2N" stopped.
2025-11-18 15:09:40.586 +03:00 [DBG] Connection id "0HNH6IA899J2N" sending FIN because: "The Socket transport's send loop completed gracefully."
2025-11-18 15:09:40.593 +03:00 [DBG] Connection 0HNH6IA899J2O established using the following protocol: "Tls13"
2025-11-18 15:09:40.601 +03:00 [INF] Request starting HTTP/1.1 POST https://localhost:7257/api/Invoices - application/json 1351
2025-11-18 15:09:40.613 +03:00 [DBG] 1 candidate(s) found for the request path '/api/Invoices'
2025-11-18 15:09:40.621 +03:00 [DBG] Endpoint 'BillingSystem.API.Controllers.InvoicesController.Post (BillingSystem.API)' with route pattern 'api/Invoices' is valid for the request path '/api/Invoices'
2025-11-18 15:09:40.626 +03:00 [DBG] Request matched endpoint 'BillingSystem.API.Controllers.InvoicesController.Post (BillingSystem.API)'
2025-11-18 15:09:40.632 +03:00 [DBG] Static files was skipped as the request already matched an endpoint.
2025-11-18 15:09:41.588 +03:00 [DBG] An 'IServiceProvider' was created for internal use by Entity Framework.
2025-11-18 15:09:47.663 +03:00 [INF] Executing endpoint 'BillingSystem.API.Controllers.InvoicesController.Post (BillingSystem.API)'
2025-11-18 15:09:47.723 +03:00 [INF] Route matched with {action = "Post", controller = "Invoices"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Post(BillingSystem.Application.Requests.CreateInvoiceRequest) on controller BillingSystem.API.Controllers.InvoicesController (BillingSystem.API).
2025-11-18 15:09:47.734 +03:00 [DBG] Execution plan of authorization filters (in the following order): ["None"]
2025-11-18 15:09:47.740 +03:00 [DBG] Execution plan of resource filters (in the following order): ["None"]
2025-11-18 15:09:47.747 +03:00 [DBG] Execution plan of action filters (in the following order): ["Microsoft.AspNetCore.Mvc.ModelBinding.UnsupportedContentTypeFilter (Order: -3000)","Microsoft.AspNetCore.Mvc.Infrastructure.ModelStateInvalidFilter (Order: -2000)","BillingSystem.API.ActionFilters.AuditBillingRequestsFilter","BillingSystem.API.ActionFilters.IdempotencyFilter (Order: 0)"]
2025-11-18 15:09:47.753 +03:00 [DBG] Execution plan of exception filters (in the following order): ["None"]
2025-11-18 15:09:47.759 +03:00 [DBG] Execution plan of result filters (in the following order): ["Microsoft.AspNetCore.Mvc.Infrastructure.ClientErrorResultFilter (Order: -2000)","Microsoft.AspNetCore.Mvc.ProducesAttribute (Order: 0)","BillingSystem.API.ActionFilters.IdempotencyFilter (Order: 0)"]
2025-11-18 15:09:47.771 +03:00 [DBG] Executing controller factory for controller BillingSystem.API.Controllers.InvoicesController (BillingSystem.API)
2025-11-18 15:09:47.784 +03:00 [WRN] You do not have a valid license key for the Lucky Penny software MediatR. This is allowed for development and testing scenarios. If you are running in production you are required to have a licensed version. Please visit https://luckypennysoftware.com to obtain a valid license.
2025-11-18 15:09:47.844 +03:00 [DBG] Executed controller factory for controller BillingSystem.API.Controllers.InvoicesController (BillingSystem.API)
2025-11-18 15:09:47.932 +03:00 [DBG] Attempting to bind parameter 'invoiceRequest' of type 'BillingSystem.Application.Requests.CreateInvoiceRequest' ...
2025-11-18 15:09:47.939 +03:00 [DBG] Attempting to bind parameter 'invoiceRequest' of type 'BillingSystem.Application.Requests.CreateInvoiceRequest' using the name '' in request data ...
2025-11-18 15:09:47.945 +03:00 [DBG] Selected input formatter 'Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonInputFormatter' for content type 'application/json'.
2025-11-18 15:09:48.003 +03:00 [DBG] Connection id "0HNH6IA899J2O", Request id "0HNH6IA899J2O:00000001": started reading request body.
2025-11-18 15:09:48.007 +03:00 [DBG] Connection id "0HNH6IA899J2O", Request id "0HNH6IA899J2O:00000001": done reading request body.
2025-11-18 15:09:48.039 +03:00 [DBG] JSON input formatter succeeded, deserializing to type 'BillingSystem.Application.Requests.CreateInvoiceRequest'
2025-11-18 15:09:48.045 +03:00 [DBG] Done attempting to bind parameter 'invoiceRequest' of type 'BillingSystem.Application.Requests.CreateInvoiceRequest'.
2025-11-18 15:09:48.049 +03:00 [DBG] Done attempting to bind parameter 'invoiceRequest' of type 'BillingSystem.Application.Requests.CreateInvoiceRequest'.
2025-11-18 15:09:48.053 +03:00 [DBG] Attempting to validate the bound parameter 'invoiceRequest' of type 'BillingSystem.Application.Requests.CreateInvoiceRequest' ...
2025-11-18 15:09:48.085 +03:00 [DBG] Done attempting to validate the bound parameter 'invoiceRequest' of type 'BillingSystem.Application.Requests.CreateInvoiceRequest'.
2025-11-18 15:09:48.506 +03:00 [DBG] No relationship from 'Invoice' to 'Invoice' has been configured by convention because there are multiple properties on one entity type - {'DiscountedPrimaryInvoice'} that could be matched with the properties on the other entity type - {'InverseDiscountedPrimaryInvoice', 'InversePrimaryInvoice', 'InverseSubstitutionPrimaryInvoice', 'PrimaryInvoice', 'SubstitutionPrimaryInvoice'}. This message can be disregarded if explicit configuration has been specified in 'OnModelCreating'.
2025-11-18 15:09:48.752 +03:00 [DBG] No relationship from 'Invoice' to 'Invoice' has been configured by convention because there are multiple properties on one entity type - {'DiscountedPrimaryInvoice'} that could be matched with the properties on the other entity type - {'InverseDiscountedPrimaryInvoice', 'InversePrimaryInvoice', 'InverseSubstitutionPrimaryInvoice', 'PrimaryInvoice', 'SubstitutionPrimaryInvoice'}. This message can be disregarded if explicit configuration has been specified in 'OnModelCreating'.
2025-11-18 15:09:48.769 +03:00 [DBG] No relationship from 'Invoice' to 'Invoice' has been configured by convention because there are multiple properties on one entity type - {'InversePrimaryInvoice'} that could be matched with the properties on the other entity type - {'InverseSubstitutionPrimaryInvoice', 'PrimaryInvoice', 'SubstitutionPrimaryInvoice'}. This message can be disregarded if explicit configuration has been specified in 'OnModelCreating'.
2025-11-18 15:09:48.782 +03:00 [DBG] No relationship from 'Invoice' to 'Invoice' has been configured by convention because there are multiple properties on one entity type - {'InversePrimaryInvoice'} that could be matched with the properties on the other entity type - {'InverseSubstitutionPrimaryInvoice', 'PrimaryInvoice', 'SubstitutionPrimaryInvoice'}. This message can be disregarded if explicit configuration has been specified in 'OnModelCreating'.
2025-11-18 15:09:49.165 +03:00 [DBG] Entity Framework Core 9.0.9 initialized 'BillingServiceDBContext' using provider 'Microsoft.EntityFrameworkCore.SqlServer:9.0.9' with options: EngineType=SqlServer 
2025-11-18 15:09:49.473 +03:00 [DBG] Compiling query expression: 
'DbSet<Invoice>()
    .AsNoTracking()
    .Any(inv => inv.ExternalId.ToString() == __idempotentKey_0)'
2025-11-18 15:09:49.845 +03:00 [DBG] Generated query execution expression: 
'queryContext => ShapedQueryCompilingExpressionVisitor.SingleAsync<bool>(
    asyncEnumerable: SingleQueryingEnumerable.Create<bool>(
        relationalQueryContext: (RelationalQueryContext)queryContext, 
        relationalCommandResolver: parameters => [LIFTABLE Constant: RelationalCommandCache.QueryExpression(
            Projection Mapping:
                EmptyProjectionMember -> 0
            SELECT EXISTS (
                SELECT 1
                FROM Invoices AS i
                WHERE COALESCE(CONVERT(varchar(36), i.ExternalId), '') == @__idempotentKey_0)) | Resolver: c => new RelationalCommandCache(
            c.Dependencies.MemoryCache, 
            c.RelationalDependencies.QuerySqlGeneratorFactory, 
            c.RelationalDependencies.RelationalParameterBasedSqlProcessorFactory, 
            Projection Mapping:
                EmptyProjectionMember -> 0
            SELECT EXISTS (
                SELECT 1
                FROM Invoices AS i
                WHERE COALESCE(CONVERT(varchar(36), i.ExternalId), '') == @__idempotentKey_0), 
            False, 
            new HashSet<string>(
                new string[]{ }, 
                StringComparer.Ordinal
            )
        )].GetRelationalCommandTemplate(parameters), 
        readerColumns: null, 
        shaper: (queryContext, dataReader, resultContext, resultCoordinator) => 
        {
            bool? value1;
            value1 = dataReader.IsDBNull(0) ? default(bool?) : (bool?)dataReader.GetBoolean(0);
            return (bool)value1;
        }, 
        contextType: BillingSystem.Infrastructure.EF.BillingServiceDBContext, 
        standAloneStateManager: False, 
        detailedErrorsEnabled: False, 
        threadSafetyChecksEnabled: True), 
    cancellationToken: queryContext.CancellationToken)'
2025-11-18 15:09:49.932 +03:00 [DBG] Creating DbConnection.
2025-11-18 15:09:49.999 +03:00 [DBG] Created DbConnection. (63ms).
2025-11-18 15:09:50.011 +03:00 [DBG] Opening connection to database 'GAC-BillingService' on server '.'.
2025-11-18 15:09:50.887 +03:00 [DBG] Opened connection to database 'GAC-BillingService' on server '.'.
2025-11-18 15:09:50.895 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-11-18 15:09:50.902 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (7ms).
2025-11-18 15:09:50.915 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (20ms).
2025-11-18 15:09:50.930 +03:00 [DBG] Executing DbCommand [Parameters=[@__idempotentKey_0='?' (Size = 36) (DbType = AnsiString)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [Invoices] AS [i]
        WHERE CONVERT(varchar(36), [i].[ExternalId]) = @__idempotentKey_0) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2025-11-18 15:09:51.127 +03:00 [INF] Executed DbCommand (192ms) [Parameters=[@__idempotentKey_0='?' (Size = 36) (DbType = AnsiString)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [Invoices] AS [i]
        WHERE CONVERT(varchar(36), [i].[ExternalId]) = @__idempotentKey_0) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2025-11-18 15:09:51.164 +03:00 [DBG] Closing data reader to 'GAC-BillingService' on server '.'.
2025-11-18 15:09:51.177 +03:00 [DBG] A data reader for 'GAC-BillingService' on server '.' is being disposed after spending 30ms reading results.
2025-11-18 15:09:51.188 +03:00 [DBG] Closing connection to database 'GAC-BillingService' on server '.'.
2025-11-18 15:09:51.200 +03:00 [DBG] Closed connection to database 'GAC-BillingService' on server '.' (13ms).
2025-11-18 15:09:51.380 +03:00 [WRN] You do not have a valid license key for the Lucky Penny software AutoMapper. This is allowed for development and testing scenarios. If you are running in production you are required to have a licensed version. Please visit https://luckypennysoftware.com to obtain a valid license.
2025-11-18 15:09:51.481 +03:00 [DBG] Opening connection to database 'GAC-BillingService' on server '.'.
2025-11-18 15:09:51.490 +03:00 [DBG] Opened connection to database 'GAC-BillingService' on server '.'.
2025-11-18 15:09:51.497 +03:00 [DBG] Beginning transaction with isolation level 'Unspecified'.
2025-11-18 15:09:51.516 +03:00 [DBG] Began transaction with isolation level 'ReadCommitted'.
2025-11-18 15:09:51.527 +03:00 [DBG] Compiling query expression: 
'DbSet<InvoiceSequenceValue>().FromSql(EXECUTE dbo.GetNextInvoiceNumber, __p_0)
'
2025-11-18 15:09:51.586 +03:00 [DBG] Generated query execution expression: 
'queryContext => FromSqlQueryingEnumerable.Create<InvoiceSequenceValue>(
    relationalQueryContext: (RelationalQueryContext)queryContext, 
    relationalCommandResolver: parameters => [LIFTABLE Constant: RelationalCommandCache.QueryExpression(
        Projection Mapping:
            EmptyProjectionMember -> Dictionary<IProperty, int> { [Property: InvoiceSequenceValue.Value (long) Required, 0] }
        SELECT b.Value
        FROM EXECUTE dbo.GetNextInvoiceNumber) | Resolver: c => new RelationalCommandCache(
        c.Dependencies.MemoryCache, 
        c.RelationalDependencies.QuerySqlGeneratorFactory, 
        c.RelationalDependencies.RelationalParameterBasedSqlProcessorFactory, 
        Projection Mapping:
            EmptyProjectionMember -> Dictionary<IProperty, int> { [Property: InvoiceSequenceValue.Value (long) Required, 0] }
        SELECT b.Value
        FROM EXECUTE dbo.GetNextInvoiceNumber, 
        False, 
        new HashSet<string>(
            new string[]{ }, 
            StringComparer.Ordinal
        )
    )].GetRelationalCommandTemplate(parameters), 
    readerColumns: null, 
    columnNames: [LIFTABLE Constant: string[] { "Value" } | Resolver: _ => new string[]{ "Value" }], 
    shaper: (queryContext, dataReader, indexMap) => 
    {
        InvoiceSequenceValue entity;
        entity = 
        {
            MaterializationContext materializationContext1;
            IEntityType entityType1;
            InvoiceSequenceValue instance1;
            materializationContext1 = new MaterializationContext(
                [LIFTABLE Constant: ValueBuffer | Resolver: _ => (object)ValueBuffer.Empty], 
                queryContext.Context
            );
            instance1 = default(InvoiceSequenceValue);
            {
                ISnapshot shadowSnapshot1;
                shadowSnapshot1 = [LIFTABLE Constant: Snapshot | Resolver: _ => Snapshot.Empty];
                entityType1 = [LIFTABLE Constant: EntityType: InvoiceSequenceValue Keyless | Resolver: namelessParameter{0} => namelessParameter{0}.Dependencies.Model.FindEntityType("BillingSystem.Domain.Entities.InvoiceSequenceValue")];
                instance1 = switch (entityType1)
                {
                    case [LIFTABLE Constant: EntityType: InvoiceSequenceValue Keyless | Resolver: namelessParameter{1} => namelessParameter{1}.Dependencies.Model.FindEntityType("BillingSystem.Domain.Entities.InvoiceSequenceValue")]: 
                        {
                            return 
                            {
                                InvoiceSequenceValue instance;
                                instance = new InvoiceSequenceValue();
                                instance.<Value>k__BackingField = dataReader.GetInt64(indexMap[0]);
                                (instance is IInjectableService) ? ((IInjectableService)instance).Injected(
                                    context: materializationContext1.Context, 
                                    entity: instance, 
                                    queryTrackingBehavior: TrackAll, 
                                    structuralType: [LIFTABLE Constant: EntityType: InvoiceSequenceValue Keyless | Resolver: namelessParameter{2} => namelessParameter{2}.Dependencies.Model.FindEntityType("BillingSystem.Domain.Entities.InvoiceSequenceValue")]) : default(void);
                                return instance;
                            }}
                    default: 
                        default(InvoiceSequenceValue)
                }
                ;
                return instance1;
            }return instance1;
        };
        return entity;
    }, 
    contextType: BillingSystem.Infrastructure.EF.BillingServiceDBContext, 
    standAloneStateManager: False, 
    detailedErrorsEnabled: False, 
    threadSafetyChecksEnabled: True)'
2025-11-18 15:09:51.605 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-11-18 15:09:51.610 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (5ms).
2025-11-18 15:09:51.617 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (12ms).
2025-11-18 15:09:51.623 +03:00 [DBG] Executing DbCommand [Parameters=[], CommandType='"Text"', CommandTimeout='30']
EXECUTE dbo.GetNextInvoiceNumber
2025-11-18 15:09:51.639 +03:00 [INF] Executed DbCommand (16ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
EXECUTE dbo.GetNextInvoiceNumber
2025-11-18 15:09:51.650 +03:00 [DBG] Closing data reader to 'GAC-BillingService' on server '.'.
2025-11-18 15:09:51.654 +03:00 [DBG] A data reader for 'GAC-BillingService' on server '.' is being disposed after spending 9ms reading results.
2025-11-18 15:09:51.663 +03:00 [DBG] Compiling query expression: 
'DbSet<Customer>()
    .FirstOrDefault(c => c.IdentityNumber == __cutomerIdentityNumber_0)'
2025-11-18 15:09:51.696 +03:00 [DBG] Generated query execution expression: 
'queryContext => SingleQueryingEnumerable.Create<Customer>(
    relationalQueryContext: (RelationalQueryContext)queryContext, 
    relationalCommandResolver: parameters => [LIFTABLE Constant: RelationalCommandCache.QueryExpression(
        Projection Mapping:
            EmptyProjectionMember -> Dictionary<IProperty, int> { [Property: Customer.Id (long) Required PK AfterSave:Throw ValueGenerated.OnAdd, 0], [Property: Customer.AddressBuildingNumber (string) MaxLength(200), 1], [Property: Customer.AddressCity (string) Required MaxLength(200), 2], [Property: Customer.AddressCountry (string) Required MaxLength(200), 3], [Property: Customer.AddressDistrict (string) Required MaxLength(200), 4], [Property: Customer.AddressPostalCode (string) Required MaxLength(50), 5], [Property: Customer.AddressStreet (string) MaxLength(200), 6], [Property: Customer.AddressSubNumber (string) MaxLength(200), 7], [Property: Customer.CreatedBy (string) Required MaxLength(50), 8], [Property: Customer.CreatedDate (DateTime) Required, 9], [Property: Customer.CustomerType (string) Required MaxLength(100), 10], [Property: Customer.EmailAddress (string) MaxLength(80), 11], [Property: Customer.FullName (string) Required MaxLength(500), 12], [Property: Customer.IdentityNumber (string) Required MaxLength(100), 13], [Property: Customer.IdentityType (int?), 14], [Property: Customer.IsDeleted (bool) Required, 15], [Property: Customer.LastUpdatedDate (DateTime?), 16], [Property: Customer.OverpaymentBalance (decimal?), 17], [Property: Customer.PhoneNumber (string) MaxLength(50), 18], [Property: Customer.Vatnumber (string) MaxLength(100), 19] }
        SELECT TOP(1) c.Id, c.Address_BuildingNumber, c.Address_City, c.Address_Country, c.Address_District, c.Address_PostalCode, c.Address_Street, c.Address_SubNumber, c.CreatedBy, c.CreatedDate, c.CustomerType, c.EmailAddress, c.FullName, c.IdentityNumber, c.IdentityType, c.IsDeleted, c.LastUpdatedDate, c.OverpaymentBalance, c.PhoneNumber, c.VATNumber
        FROM Customers AS c
        WHERE c.IdentityNumber == @__cutomerIdentityNumber_0) | Resolver: c => new RelationalCommandCache(
        c.Dependencies.MemoryCache, 
        c.RelationalDependencies.QuerySqlGeneratorFactory, 
        c.RelationalDependencies.RelationalParameterBasedSqlProcessorFactory, 
        Projection Mapping:
            EmptyProjectionMember -> Dictionary<IProperty, int> { [Property: Customer.Id (long) Required PK AfterSave:Throw ValueGenerated.OnAdd, 0], [Property: Customer.AddressBuildingNumber (string) MaxLength(200), 1], [Property: Customer.AddressCity (string) Required MaxLength(200), 2], [Property: Customer.AddressCountry (string) Required MaxLength(200), 3], [Property: Customer.AddressDistrict (string) Required MaxLength(200), 4], [Property: Customer.AddressPostalCode (string) Required MaxLength(50), 5], [Property: Customer.AddressStreet (string) MaxLength(200), 6], [Property: Customer.AddressSubNumber (string) MaxLength(200), 7], [Property: Customer.CreatedBy (string) Required MaxLength(50), 8], [Property: Customer.CreatedDate (DateTime) Required, 9], [Property: Customer.CustomerType (string) Required MaxLength(100), 10], [Property: Customer.EmailAddress (string) MaxLength(80), 11], [Property: Customer.FullName (string) Required MaxLength(500), 12], [Property: Customer.IdentityNumber (string) Required MaxLength(100), 13], [Property: Customer.IdentityType (int?), 14], [Property: Customer.IsDeleted (bool) Required, 15], [Property: Customer.LastUpdatedDate (DateTime?), 16], [Property: Customer.OverpaymentBalance (decimal?), 17], [Property: Customer.PhoneNumber (string) MaxLength(50), 18], [Property: Customer.Vatnumber (string) MaxLength(100), 19] }
        SELECT TOP(1) c.Id, c.Address_BuildingNumber, c.Address_City, c.Address_Country, c.Address_District, c.Address_PostalCode, c.Address_Street, c.Address_SubNumber, c.CreatedBy, c.CreatedDate, c.CustomerType, c.EmailAddress, c.FullName, c.IdentityNumber, c.IdentityType, c.IsDeleted, c.LastUpdatedDate, c.OverpaymentBalance, c.PhoneNumber, c.VATNumber
        FROM Customers AS c
        WHERE c.IdentityNumber == @__cutomerIdentityNumber_0, 
        False, 
        new HashSet<string>(
            new string[]{ }, 
            StringComparer.Ordinal
        )
    )].GetRelationalCommandTemplate(parameters), 
    readerColumns: null, 
    shaper: (queryContext, dataReader, resultContext, resultCoordinator) => 
    {
        Customer entity;
        entity = 
        {
            MaterializationContext materializationContext1;
            IEntityType entityType1;
            Customer instance1;
            InternalEntityEntry entry1;
            bool hasNullKey1;
            materializationContext1 = new MaterializationContext(
                [LIFTABLE Constant: ValueBuffer | Resolver: _ => (object)ValueBuffer.Empty], 
                queryContext.Context
            );
            instance1 = default(Customer);
            entry1 = queryContext.TryGetEntry(
                key: [LIFTABLE Constant: Key: Customer.Id PK | Resolver: c => c.Dependencies.Model.FindEntityType("BillingSystem.Domain.Entities.Customer").FindPrimaryKey()], 
                keyValues: new object[]{ (object)dataReader.GetInt64(0) }, 
                throwOnNullKey: True, 
                hasNullKey: hasNullKey1);
            !(hasNullKey1) ? entry1 != default(InternalEntityEntry) ? 
            {
                entityType1 = entry1.EntityType;
                return instance1 = (Customer)entry1.Entity;
            } : 
            {
                ISnapshot shadowSnapshot1;
                shadowSnapshot1 = [LIFTABLE Constant: Snapshot | Resolver: _ => Snapshot.Empty];
                entityType1 = [LIFTABLE Constant: EntityType: Customer | Resolver: namelessParameter{0} => namelessParameter{0}.Dependencies.Model.FindEntityType("BillingSystem.Domain.Entities.Customer")];
                instance1 = switch (entityType1)
                {
                    case [LIFTABLE Constant: EntityType: Customer | Resolver: namelessParameter{1} => namelessParameter{1}.Dependencies.Model.FindEntityType("BillingSystem.Domain.Entities.Customer")]: 
                        {
                            return 
                            {
                                Customer instance;
                                instance = new Customer();
                                instance.<Id>k__BackingField = dataReader.GetInt64(0);
                                instance.<AddressBuildingNumber>k__BackingField = dataReader.IsDBNull(1) ? default(string) : dataReader.GetString(1);
                                instance.<AddressCity>k__BackingField = dataReader.GetString(2);
                                instance.<AddressCountry>k__BackingField = dataReader.GetString(3);
                                instance.<AddressDistrict>k__BackingField = dataReader.GetString(4);
                                instance.<AddressPostalCode>k__BackingField = dataReader.GetString(5);
                                instance.<AddressStreet>k__BackingField = dataReader.IsDBNull(6) ? default(string) : dataReader.GetString(6);
                                instance.<AddressSubNumber>k__BackingField = dataReader.IsDBNull(7) ? default(string) : dataReader.GetString(7);
                                instance.<CreatedBy>k__BackingField = dataReader.GetString(8);
                                instance.<CreatedDate>k__BackingField = dataReader.GetDateTime(9);
                                instance.<CustomerType>k__BackingField = dataReader.GetString(10);
                                instance.<EmailAddress>k__BackingField = dataReader.IsDBNull(11) ? default(string) : dataReader.GetString(11);
                                instance.<FullName>k__BackingField = dataReader.GetString(12);
                                instance.<IdentityNumber>k__BackingField = dataReader.GetString(13);
                                instance.<IdentityType>k__BackingField = dataReader.IsDBNull(14) ? default(int?) : (int?)dataReader.GetInt32(14);
                                instance.<IsDeleted>k__BackingField = dataReader.GetBoolean(15);
                                instance.<LastUpdatedDate>k__BackingField = dataReader.IsDBNull(16) ? default(DateTime?) : (DateTime?)dataReader.GetDateTime(16);
                                instance.<OverpaymentBalance>k__BackingField = dataReader.IsDBNull(17) ? default(decimal?) : (decimal?)dataReader.GetDecimal(17);
                                instance.<PhoneNumber>k__BackingField = dataReader.IsDBNull(18) ? default(string) : dataReader.GetString(18);
                                instance.<Vatnumber>k__BackingField = dataReader.IsDBNull(19) ? default(string) : dataReader.GetString(19);
                                (instance is IInjectableService) ? ((IInjectableService)instance).Injected(
                                    context: materializationContext1.Context, 
                                    entity: instance, 
                                    queryTrackingBehavior: TrackAll, 
                                    structuralType: [LIFTABLE Constant: EntityType: Customer | Resolver: namelessParameter{2} => namelessParameter{2}.Dependencies.Model.FindEntityType("BillingSystem.Domain.Entities.Customer")]) : default(void);
                                return instance;
                            }}
                    default: 
                        default(Customer)
                }
                ;
                entry1 = entityType1 == default(IEntityType) ? default(InternalEntityEntry) : queryContext.StartTracking(
                    entityType: entityType1, 
                    entity: instance1, 
                    snapshot: shadowSnapshot1);
                return instance1;
            } : default(void);
            return instance1;
        };
        return entity;
    }, 
    contextType: BillingSystem.Infrastructure.EF.BillingServiceDBContext, 
    standAloneStateManager: False, 
    detailedErrorsEnabled: False, 
    threadSafetyChecksEnabled: True)
    .SingleOrDefault()'
2025-11-18 15:09:51.719 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-11-18 15:09:51.725 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (6ms).
2025-11-18 15:09:51.730 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (11ms).
2025-11-18 15:09:51.734 +03:00 [DBG] Executing DbCommand [Parameters=[@__cutomerIdentityNumber_0='?' (Size = 100)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[Id], [c].[Address_BuildingNumber], [c].[Address_City], [c].[Address_Country], [c].[Address_District], [c].[Address_PostalCode], [c].[Address_Street], [c].[Address_SubNumber], [c].[CreatedBy], [c].[CreatedDate], [c].[CustomerType], [c].[EmailAddress], [c].[FullName], [c].[IdentityNumber], [c].[IdentityType], [c].[IsDeleted], [c].[LastUpdatedDate], [c].[OverpaymentBalance], [c].[PhoneNumber], [c].[VATNumber]
FROM [Customers] AS [c]
WHERE [c].[IdentityNumber] = @__cutomerIdentityNumber_0
2025-11-18 15:09:51.744 +03:00 [INF] Executed DbCommand (10ms) [Parameters=[@__cutomerIdentityNumber_0='?' (Size = 100)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[Id], [c].[Address_BuildingNumber], [c].[Address_City], [c].[Address_Country], [c].[Address_District], [c].[Address_PostalCode], [c].[Address_Street], [c].[Address_SubNumber], [c].[CreatedBy], [c].[CreatedDate], [c].[CustomerType], [c].[EmailAddress], [c].[FullName], [c].[IdentityNumber], [c].[IdentityType], [c].[IsDeleted], [c].[LastUpdatedDate], [c].[OverpaymentBalance], [c].[PhoneNumber], [c].[VATNumber]
FROM [Customers] AS [c]
WHERE [c].[IdentityNumber] = @__cutomerIdentityNumber_0
2025-11-18 15:09:51.794 +03:00 [DBG] Context 'BillingServiceDBContext' started tracking 'Customer' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-11-18 15:09:51.887 +03:00 [DBG] Closing data reader to 'GAC-BillingService' on server '.'.
2025-11-18 15:09:51.891 +03:00 [DBG] A data reader for 'GAC-BillingService' on server '.' is being disposed after spending 141ms reading results.
2025-11-18 15:09:52.019 +03:00 [ERR] exception occured The property 'Customer.Id' is part of a key and so cannot be modified or marked as modified. To change the principal of an existing entity with an identifying foreign key, first delete the dependent and invoke 'SaveChanges', and then associate the dependent with the new principal. , stackTrace    at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.InternalEntityEntry.SetPropertyModified(IProperty property, Boolean changeState, Boolean isModified, Boolean isConceptualNull, Boolean acceptChanges)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.ChangeDetector.PropertyChanged(InternalEntityEntry entry, IPropertyBase propertyBase, Boolean setModified)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.InternalEntityEntryNotifier.PropertyChanged(InternalEntityEntry entry, IPropertyBase property, Boolean setModified)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.InternalEntityEntry.SetProperty(IPropertyBase propertyBase, Object value, Boolean isMaterialization, Boolean setModified, Boolean isCascadeDelete, CurrentValueType valueType)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.InternalEntityEntry.SetProperty(IPropertyBase propertyBase, Object value, Boolean isMaterialization, Boolean setModified, Boolean isCascadeDelete)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.InternalEntityEntry.set_Item(IPropertyBase propertyBase, Object value)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.CurrentPropertyValues.SetValueInternal(IProperty property, Object value)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.EntryPropertyValues.SetValues(Object obj)
   at BillingSystem.Infrastructure.Persistence.EF.InvoiceRepository.InsertTransactional(Invoice entity, OutboxEvent outboxEvent, AuditEvent auditEvent) in C:\Repositories\Gac-BillingSystem\src\BillingSystem.Infrastructure\Persistence\EF\InvoiceRepository.cs:line 79
2025-11-18 15:09:52.031 +03:00 [DBG] Rolling back transaction.
2025-11-18 15:09:52.043 +03:00 [DBG] Rolled back transaction.
2025-11-18 15:09:52.049 +03:00 [DBG] Closing connection to database 'GAC-BillingService' on server '.'.
2025-11-18 15:09:52.056 +03:00 [DBG] Closed connection to database 'GAC-BillingService' on server '.' (6ms).
2025-11-18 15:09:52.088 +03:00 [DBG] Disposing transaction.
2025-11-18 15:09:52.141 +03:00 [ERR] exception occured The property 'Customer.Id' is part of a key and so cannot be modified or marked as modified. To change the principal of an existing entity with an identifying foreign key, first delete the dependent and invoke 'SaveChanges', and then associate the dependent with the new principal. , stackTrace    at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.InternalEntityEntry.SetPropertyModified(IProperty property, Boolean changeState, Boolean isModified, Boolean isConceptualNull, Boolean acceptChanges)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.ChangeDetector.PropertyChanged(InternalEntityEntry entry, IPropertyBase propertyBase, Boolean setModified)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.InternalEntityEntryNotifier.PropertyChanged(InternalEntityEntry entry, IPropertyBase property, Boolean setModified)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.InternalEntityEntry.SetProperty(IPropertyBase propertyBase, Object value, Boolean isMaterialization, Boolean setModified, Boolean isCascadeDelete, CurrentValueType valueType)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.InternalEntityEntry.SetProperty(IPropertyBase propertyBase, Object value, Boolean isMaterialization, Boolean setModified, Boolean isCascadeDelete)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.InternalEntityEntry.set_Item(IPropertyBase propertyBase, Object value)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.CurrentPropertyValues.SetValueInternal(IProperty property, Object value)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.EntryPropertyValues.SetValues(Object obj)
   at BillingSystem.Infrastructure.Persistence.EF.InvoiceRepository.InsertTransactional(Invoice entity, OutboxEvent outboxEvent, AuditEvent auditEvent) in C:\Repositories\Gac-BillingSystem\src\BillingSystem.Infrastructure\Persistence\EF\InvoiceRepository.cs:line 79
   at BillingSystem.Application.Commands.CreateInvoiceCommandRequestHandler.Handle(CreateInvoiceRequest request, CancellationToken cancellationToken) in C:\Repositories\Gac-BillingSystem\src\BillingSystem.Application\Commands\CreateInvoiceCommandRequestHandler.cs:line 75
   at BillingSystem.API.Controllers.InvoicesController.Post(CreateInvoiceRequest invoiceRequest) in C:\Repositories\Gac-BillingSystem\src\BillingSystem.API\Controllers\InvoicesController.cs:line 45
2025-11-18 15:09:52.158 +03:00 [DBG] List of registered output formatters, in the following order: ["Microsoft.AspNetCore.Mvc.Formatters.HttpNoContentOutputFormatter","Microsoft.AspNetCore.Mvc.Formatters.StringOutputFormatter","Microsoft.AspNetCore.Mvc.Formatters.StreamOutputFormatter","Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonOutputFormatter"]
2025-11-18 15:09:52.171 +03:00 [DBG] No information found on request to perform content negotiation.
2025-11-18 15:09:52.176 +03:00 [DBG] Attempting to select the first output formatter in the output formatters list which supports a content type from the explicitly specified content types '["application/json","application/problem+json","application/problem+xml"]'.
2025-11-18 15:09:52.188 +03:00 [DBG] Selected output formatter 'Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonOutputFormatter' and content type 'application/json' to write the response.
2025-11-18 15:09:52.197 +03:00 [INF] Executing ObjectResult, writing value of type 'Microsoft.AspNetCore.Mvc.ProblemDetails'.
2025-11-18 15:09:52.240 +03:00 [INF] Executed action BillingSystem.API.Controllers.InvoicesController.Post (BillingSystem.API) in 4469.8371ms
2025-11-18 15:09:52.245 +03:00 [INF] Executed endpoint 'BillingSystem.API.Controllers.InvoicesController.Post (BillingSystem.API)'
2025-11-18 15:09:52.250 +03:00 [ERR] HTTP POST /api/Invoices responded 500 in 11619.3164 ms
2025-11-18 15:09:52.257 +03:00 [DBG] Connection id "0HNH6IA899J2O" completed keep alive response.
2025-11-18 15:09:52.265 +03:00 [DBG] 'BillingServiceDBContext' disposed.
2025-11-18 15:09:52.272 +03:00 [DBG] Disposing connection to database 'GAC-BillingService' on server '.'.
2025-11-18 15:09:52.279 +03:00 [DBG] Disposed connection to database '' on server '' (5ms).
2025-11-18 15:09:52.292 +03:00 [INF] Request finished HTTP/1.1 POST https://localhost:7257/api/Invoices - 500 null application/json; charset=utf-8 11690.312ms
2025-11-18 15:10:43.493 +03:00 [DBG] Connection id "0HNH6IA899J2P" accepted.
2025-11-18 15:10:43.493 +03:00 [DBG] Connection id "0HNH6IA899J2P" received FIN.
2025-11-18 15:10:43.499 +03:00 [DBG] Connection id "0HNH6IA899J2P" started.
2025-11-18 15:10:43.500 +03:00 [DBG] Connection id "0HNH6IA899J2Q" accepted.
2025-11-18 15:10:43.509 +03:00 [DBG] Failed to authenticate HTTPS connection.
System.IO.IOException: Received an unexpected EOF or 0 bytes from the transport stream.
   at System.Net.Security.SslStream.ReceiveHandshakeFrameAsync[TIOAdapter](CancellationToken cancellationToken)
   at System.Net.Security.SslStream.ForceAuthenticationAsync[TIOAdapter](Boolean receiveFirst, Byte[] reAuthenticationData, CancellationToken cancellationToken)
   at System.Net.Security.SslStream.ProcessAuthenticationWithTelemetryAsync(Boolean isAsync, CancellationToken cancellationToken)
   at Microsoft.AspNetCore.Server.Kestrel.Https.Internal.HttpsConnectionMiddleware.OnConnectionAsync(ConnectionContext context)
2025-11-18 15:10:43.510 +03:00 [DBG] Connection id "0HNH6IA899J2Q" started.
2025-11-18 15:10:43.515 +03:00 [DBG] Connection id "0HNH6IA899J2P" stopped.
2025-11-18 15:10:43.525 +03:00 [DBG] Connection id "0HNH6IA899J2P" sending FIN because: "The Socket transport's send loop completed gracefully."
2025-11-18 15:10:43.530 +03:00 [DBG] Connection 0HNH6IA899J2Q established using the following protocol: "Tls13"
2025-11-18 15:10:43.535 +03:00 [INF] Request starting HTTP/1.1 POST https://localhost:7257/api/Invoices - application/json 1351
2025-11-18 15:10:43.544 +03:00 [DBG] 1 candidate(s) found for the request path '/api/Invoices'
2025-11-18 15:10:43.550 +03:00 [DBG] Endpoint 'BillingSystem.API.Controllers.InvoicesController.Post (BillingSystem.API)' with route pattern 'api/Invoices' is valid for the request path '/api/Invoices'
2025-11-18 15:10:43.560 +03:00 [DBG] Request matched endpoint 'BillingSystem.API.Controllers.InvoicesController.Post (BillingSystem.API)'
2025-11-18 15:10:43.564 +03:00 [DBG] Static files was skipped as the request already matched an endpoint.
2025-11-18 15:10:43.582 +03:00 [INF] Executing endpoint 'BillingSystem.API.Controllers.InvoicesController.Post (BillingSystem.API)'
2025-11-18 15:10:43.591 +03:00 [INF] Route matched with {action = "Post", controller = "Invoices"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Post(BillingSystem.Application.Requests.CreateInvoiceRequest) on controller BillingSystem.API.Controllers.InvoicesController (BillingSystem.API).
2025-11-18 15:10:43.595 +03:00 [DBG] Execution plan of authorization filters (in the following order): ["None"]
2025-11-18 15:10:43.599 +03:00 [DBG] Execution plan of resource filters (in the following order): ["None"]
2025-11-18 15:10:43.609 +03:00 [DBG] Execution plan of action filters (in the following order): ["Microsoft.AspNetCore.Mvc.ModelBinding.UnsupportedContentTypeFilter (Order: -3000)","Microsoft.AspNetCore.Mvc.Infrastructure.ModelStateInvalidFilter (Order: -2000)","BillingSystem.API.ActionFilters.AuditBillingRequestsFilter","BillingSystem.API.ActionFilters.IdempotencyFilter (Order: 0)"]
2025-11-18 15:10:43.615 +03:00 [DBG] Execution plan of exception filters (in the following order): ["None"]
2025-11-18 15:10:43.622 +03:00 [DBG] Execution plan of result filters (in the following order): ["Microsoft.AspNetCore.Mvc.Infrastructure.ClientErrorResultFilter (Order: -2000)","Microsoft.AspNetCore.Mvc.ProducesAttribute (Order: 0)","BillingSystem.API.ActionFilters.IdempotencyFilter (Order: 0)"]
2025-11-18 15:10:43.627 +03:00 [DBG] Executing controller factory for controller BillingSystem.API.Controllers.InvoicesController (BillingSystem.API)
2025-11-18 15:10:43.634 +03:00 [DBG] Executed controller factory for controller BillingSystem.API.Controllers.InvoicesController (BillingSystem.API)
2025-11-18 15:10:43.637 +03:00 [DBG] Attempting to bind parameter 'invoiceRequest' of type 'BillingSystem.Application.Requests.CreateInvoiceRequest' ...
2025-11-18 15:10:43.642 +03:00 [DBG] Attempting to bind parameter 'invoiceRequest' of type 'BillingSystem.Application.Requests.CreateInvoiceRequest' using the name '' in request data ...
2025-11-18 15:10:43.645 +03:00 [DBG] Selected input formatter 'Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonInputFormatter' for content type 'application/json'.
2025-11-18 15:10:43.647 +03:00 [DBG] Connection id "0HNH6IA899J2Q", Request id "0HNH6IA899J2Q:00000001": started reading request body.
2025-11-18 15:10:43.650 +03:00 [DBG] Connection id "0HNH6IA899J2Q", Request id "0HNH6IA899J2Q:00000001": done reading request body.
2025-11-18 15:10:43.655 +03:00 [DBG] JSON input formatter succeeded, deserializing to type 'BillingSystem.Application.Requests.CreateInvoiceRequest'
2025-11-18 15:10:43.661 +03:00 [DBG] Done attempting to bind parameter 'invoiceRequest' of type 'BillingSystem.Application.Requests.CreateInvoiceRequest'.
2025-11-18 15:10:43.668 +03:00 [DBG] Done attempting to bind parameter 'invoiceRequest' of type 'BillingSystem.Application.Requests.CreateInvoiceRequest'.
2025-11-18 15:10:43.676 +03:00 [DBG] Attempting to validate the bound parameter 'invoiceRequest' of type 'BillingSystem.Application.Requests.CreateInvoiceRequest' ...
2025-11-18 15:10:43.684 +03:00 [DBG] Done attempting to validate the bound parameter 'invoiceRequest' of type 'BillingSystem.Application.Requests.CreateInvoiceRequest'.
2025-11-18 15:10:43.722 +03:00 [DBG] Entity Framework Core 9.0.9 initialized 'BillingServiceDBContext' using provider 'Microsoft.EntityFrameworkCore.SqlServer:9.0.9' with options: EngineType=SqlServer 
2025-11-18 15:10:43.734 +03:00 [DBG] Creating DbConnection.
2025-11-18 15:10:43.738 +03:00 [DBG] Created DbConnection. (3ms).
2025-11-18 15:10:43.740 +03:00 [DBG] Opening connection to database 'GAC-BillingService' on server '.'.
2025-11-18 15:10:43.743 +03:00 [DBG] Opened connection to database 'GAC-BillingService' on server '.'.
2025-11-18 15:10:43.746 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-11-18 15:10:43.749 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (2ms).
2025-11-18 15:10:43.752 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (5ms).
2025-11-18 15:10:43.756 +03:00 [DBG] Executing DbCommand [Parameters=[@__idempotentKey_0='?' (Size = 36) (DbType = AnsiString)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [Invoices] AS [i]
        WHERE CONVERT(varchar(36), [i].[ExternalId]) = @__idempotentKey_0) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2025-11-18 15:10:43.763 +03:00 [INF] Executed DbCommand (7ms) [Parameters=[@__idempotentKey_0='?' (Size = 36) (DbType = AnsiString)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [Invoices] AS [i]
        WHERE CONVERT(varchar(36), [i].[ExternalId]) = @__idempotentKey_0) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2025-11-18 15:10:43.769 +03:00 [DBG] Closing data reader to 'GAC-BillingService' on server '.'.
2025-11-18 15:10:43.771 +03:00 [DBG] A data reader for 'GAC-BillingService' on server '.' is being disposed after spending 3ms reading results.
2025-11-18 15:10:43.775 +03:00 [DBG] Closing connection to database 'GAC-BillingService' on server '.'.
2025-11-18 15:10:43.779 +03:00 [DBG] Closed connection to database 'GAC-BillingService' on server '.' (4ms).
2025-11-18 15:11:33.950 +03:00 [DBG] Opening connection to database 'GAC-BillingService' on server '.'.
2025-11-18 15:11:33.959 +03:00 [DBG] Opened connection to database 'GAC-BillingService' on server '.'.
2025-11-18 15:11:33.970 +03:00 [DBG] Beginning transaction with isolation level 'Unspecified'.
2025-11-18 15:11:33.979 +03:00 [DBG] Began transaction with isolation level 'ReadCommitted'.
2025-11-18 15:11:35.463 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-11-18 15:11:35.466 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (3ms).
2025-11-18 15:11:35.471 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (7ms).
2025-11-18 15:11:35.476 +03:00 [DBG] Executing DbCommand [Parameters=[], CommandType='"Text"', CommandTimeout='30']
EXECUTE dbo.GetNextInvoiceNumber
2025-11-18 15:11:35.485 +03:00 [INF] Executed DbCommand (9ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
EXECUTE dbo.GetNextInvoiceNumber
2025-11-18 15:11:35.491 +03:00 [DBG] Closing data reader to 'GAC-BillingService' on server '.'.
2025-11-18 15:11:35.494 +03:00 [DBG] A data reader for 'GAC-BillingService' on server '.' is being disposed after spending 3ms reading results.
2025-11-18 15:11:56.570 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-11-18 15:11:56.574 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (3ms).
2025-11-18 15:11:56.578 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (7ms).
2025-11-18 15:11:56.583 +03:00 [DBG] Executing DbCommand [Parameters=[@__cutomerIdentityNumber_0='?' (Size = 100)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[Id], [c].[Address_BuildingNumber], [c].[Address_City], [c].[Address_Country], [c].[Address_District], [c].[Address_PostalCode], [c].[Address_Street], [c].[Address_SubNumber], [c].[CreatedBy], [c].[CreatedDate], [c].[CustomerType], [c].[EmailAddress], [c].[FullName], [c].[IdentityNumber], [c].[IdentityType], [c].[IsDeleted], [c].[LastUpdatedDate], [c].[OverpaymentBalance], [c].[PhoneNumber], [c].[VATNumber]
FROM [Customers] AS [c]
WHERE [c].[IdentityNumber] = @__cutomerIdentityNumber_0
2025-11-18 15:11:56.592 +03:00 [INF] Executed DbCommand (9ms) [Parameters=[@__cutomerIdentityNumber_0='?' (Size = 100)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[Id], [c].[Address_BuildingNumber], [c].[Address_City], [c].[Address_Country], [c].[Address_District], [c].[Address_PostalCode], [c].[Address_Street], [c].[Address_SubNumber], [c].[CreatedBy], [c].[CreatedDate], [c].[CustomerType], [c].[EmailAddress], [c].[FullName], [c].[IdentityNumber], [c].[IdentityType], [c].[IsDeleted], [c].[LastUpdatedDate], [c].[OverpaymentBalance], [c].[PhoneNumber], [c].[VATNumber]
FROM [Customers] AS [c]
WHERE [c].[IdentityNumber] = @__cutomerIdentityNumber_0
2025-11-18 15:11:56.600 +03:00 [DBG] Context 'BillingServiceDBContext' started tracking 'Customer' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-11-18 15:11:56.606 +03:00 [DBG] Closing data reader to 'GAC-BillingService' on server '.'.
2025-11-18 15:11:56.609 +03:00 [DBG] A data reader for 'GAC-BillingService' on server '.' is being disposed after spending 10ms reading results.
2025-11-18 15:33:14.259 +03:00 [DBG] Registered model binder providers, in the following order: ["Microsoft.AspNetCore.Mvc.ModelBinding.Binders.BinderTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ServicesModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.BodyModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.HeaderModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FloatingPointTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.EnumTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.DateTimeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.SimpleTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.TryParseModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.CancellationTokenModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ByteArrayModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FormFileModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FormCollectionModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.KeyValuePairModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.DictionaryModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ArrayModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.CollectionModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ComplexObjectModelBinderProvider"]
2025-11-18 15:33:14.486 +03:00 [DBG] Hosting starting
2025-11-18 15:33:15.000 +03:00 [DBG] Starting bus instances: IBus
2025-11-18 15:33:15.011 +03:00 [DBG] Starting bus: "rabbitmq://localhost/"
2025-11-18 15:33:15.043 +03:00 [DBG] Middleware loaded
2025-11-18 15:33:15.051 +03:00 [DBG] Middleware loaded. Script /_framework/aspnetcore-browser-refresh.js (16519 B).
2025-11-18 15:33:15.066 +03:00 [DBG] Middleware loaded. Script /_framework/blazor-hotreload.js (799 B).
2025-11-18 15:33:15.070 +03:00 [DBG] Connect: guest@localhost:5672/
2025-11-18 15:33:15.233 +03:00 [DBG] Middleware loaded: DOTNET_MODIFIABLE_ASSEMBLIES=debug, __ASPNETCORE_BROWSER_TOOLS=true
2025-11-18 15:33:15.257 +03:00 [DBG] Connected: guest@localhost:5672/ (address: amqp://localhost:5672, local: 52352)
2025-11-18 15:33:15.318 +03:00 [DBG] Endpoint Ready: "rabbitmq://localhost/ECHGHANNAMLP1_BillingSystemAPI_bus_nddyyyyh3bcsyzwibdxnp8ifyg?temporary=true"
2025-11-18 15:33:15.322 +03:00 [INF] Bus started: "rabbitmq://localhost/"
2025-11-18 15:33:15.484 +03:00 [INF] Now listening on: https://localhost:7257
2025-11-18 15:33:15.488 +03:00 [INF] Now listening on: http://localhost:5009
2025-11-18 15:33:15.491 +03:00 [DBG] Loaded hosting startup assembly BillingSystem.API
2025-11-18 15:33:15.494 +03:00 [DBG] Loaded hosting startup assembly Microsoft.WebTools.ApiEndpointDiscovery
2025-11-18 15:33:15.496 +03:00 [DBG] Loaded hosting startup assembly Microsoft.AspNetCore.Watch.BrowserRefresh
2025-11-18 15:33:15.499 +03:00 [DBG] Loaded hosting startup assembly Microsoft.WebTools.BrowserLink.Net
2025-11-18 15:33:15.592 +03:00 [DBG] Connection id "0HNH6JQINDSTD" accepted.
2025-11-18 15:33:15.595 +03:00 [DBG] Connection id "0HNH6JQINDSTD" received FIN.
2025-11-18 15:33:15.598 +03:00 [DBG] Connection id "0HNH6JQINDSTD" started.
2025-11-18 15:33:15.629 +03:00 [DBG] Failed to authenticate HTTPS connection.
System.IO.IOException: Received an unexpected EOF or 0 bytes from the transport stream.
   at System.Net.Security.SslStream.ReceiveHandshakeFrameAsync[TIOAdapter](CancellationToken cancellationToken)
   at System.Net.Security.SslStream.ForceAuthenticationAsync[TIOAdapter](Boolean receiveFirst, Byte[] reAuthenticationData, CancellationToken cancellationToken)
   at System.Net.Security.SslStream.ProcessAuthenticationWithTelemetryAsync(Boolean isAsync, CancellationToken cancellationToken)
   at Microsoft.AspNetCore.Server.Kestrel.Https.Internal.HttpsConnectionMiddleware.OnConnectionAsync(ConnectionContext context)
2025-11-18 15:33:15.663 +03:00 [DBG] Connection id "0HNH6JQINDSTD" stopped.
2025-11-18 15:33:15.681 +03:00 [DBG] Connection id "0HNH6JQINDSTD" sending FIN because: "The Socket transport's send loop completed gracefully."
2025-11-18 15:33:15.681 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-11-18 15:33:15.686 +03:00 [INF] Hosting environment: Development
2025-11-18 15:33:15.689 +03:00 [INF] Content root path: C:\Repositories\Gac-BillingSystem\src\BillingSystem.API
2025-11-18 15:33:15.692 +03:00 [DBG] Hosting started
2025-11-18 15:33:16.305 +03:00 [DBG] Connection id "0HNH6JQINDSTE" accepted.
2025-11-18 15:33:16.311 +03:00 [DBG] Connection id "0HNH6JQINDSTE" started.
2025-11-18 15:33:16.384 +03:00 [DBG] Connection 0HNH6JQINDSTE established using the following protocol: "Tls13"
2025-11-18 15:33:16.457 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7257/swagger/index.html - null null
2025-11-18 15:33:16.525 +03:00 [DBG] Wildcard detected, all requests with hosts will be allowed.
2025-11-18 15:33:16.556 +03:00 [DBG] No candidates found for the request path '/swagger/index.html'
2025-11-18 15:33:16.565 +03:00 [DBG] Request did not match any endpoints
2025-11-18 15:33:16.653 +03:00 [DBG] Response markup is scheduled to include Browser Link script injection.
2025-11-18 15:33:16.660 +03:00 [DBG] Response markup is scheduled to include browser refresh script injection.
2025-11-18 15:33:16.697 +03:00 [INF] HTTP GET /swagger/index.html responded 200 in 117.6869 ms
2025-11-18 15:33:16.707 +03:00 [DBG] Response markup was updated to include Browser Link script injection.
2025-11-18 15:33:16.711 +03:00 [DBG] Response markup was updated to include browser refresh script injection.
2025-11-18 15:33:16.718 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7257/swagger/index.html - 200 null text/html;charset=utf-8 268.8756ms
2025-11-18 15:33:16.738 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7257/_framework/aspnetcore-browser-refresh.js - null null
2025-11-18 15:33:16.751 +03:00 [DBG] Script injected: /_framework/aspnetcore-browser-refresh.js
2025-11-18 15:33:16.751 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7257/_vs/browserLink - null null
2025-11-18 15:33:16.754 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7257/_framework/aspnetcore-browser-refresh.js - 200 16519 application/javascript; charset=utf-8 16.1806ms
2025-11-18 15:33:16.822 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7257/_vs/browserLink - 200 null text/javascript; charset=UTF-8 71.2871ms
2025-11-18 15:33:16.924 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7257/swagger/v1/swagger.json - null null
2025-11-18 15:33:16.930 +03:00 [DBG] No candidates found for the request path '/swagger/v1/swagger.json'
2025-11-18 15:33:16.934 +03:00 [DBG] Request did not match any endpoints
2025-11-18 15:33:16.958 +03:00 [INF] HTTP GET /swagger/v1/swagger.json responded 200 in 21.2153 ms
2025-11-18 15:33:16.970 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7257/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 46.2833ms
2025-11-18 15:33:32.083 +03:00 [DBG] Connection id "0HNH6JQINDSTF" received FIN.
2025-11-18 15:33:32.083 +03:00 [DBG] Connection id "0HNH6JQINDSTF" accepted.
2025-11-18 15:33:32.091 +03:00 [DBG] Connection id "0HNH6JQINDSTF" started.
2025-11-18 15:33:32.092 +03:00 [DBG] Connection id "0HNH6JQINDSTG" accepted.
2025-11-18 15:33:32.097 +03:00 [DBG] Failed to authenticate HTTPS connection.
System.IO.IOException: Received an unexpected EOF or 0 bytes from the transport stream.
   at System.Net.Security.SslStream.ReceiveHandshakeFrameAsync[TIOAdapter](CancellationToken cancellationToken)
   at System.Net.Security.SslStream.ForceAuthenticationAsync[TIOAdapter](Boolean receiveFirst, Byte[] reAuthenticationData, CancellationToken cancellationToken)
   at System.Net.Security.SslStream.ProcessAuthenticationWithTelemetryAsync(Boolean isAsync, CancellationToken cancellationToken)
   at Microsoft.AspNetCore.Server.Kestrel.Https.Internal.HttpsConnectionMiddleware.OnConnectionAsync(ConnectionContext context)
2025-11-18 15:33:32.098 +03:00 [DBG] Connection id "0HNH6JQINDSTG" started.
2025-11-18 15:33:32.103 +03:00 [DBG] Connection id "0HNH6JQINDSTF" stopped.
2025-11-18 15:33:32.109 +03:00 [DBG] Connection id "0HNH6JQINDSTF" sending FIN because: "The Socket transport's send loop completed gracefully."
2025-11-18 15:33:32.113 +03:00 [DBG] Connection 0HNH6JQINDSTG established using the following protocol: "Tls13"
2025-11-18 15:33:32.122 +03:00 [INF] Request starting HTTP/1.1 POST https://localhost:7257/api/Invoices - application/json 1351
2025-11-18 15:33:32.133 +03:00 [DBG] 1 candidate(s) found for the request path '/api/Invoices'
2025-11-18 15:33:32.142 +03:00 [DBG] Endpoint 'BillingSystem.API.Controllers.InvoicesController.Post (BillingSystem.API)' with route pattern 'api/Invoices' is valid for the request path '/api/Invoices'
2025-11-18 15:33:32.148 +03:00 [DBG] Request matched endpoint 'BillingSystem.API.Controllers.InvoicesController.Post (BillingSystem.API)'
2025-11-18 15:33:32.156 +03:00 [DBG] Static files was skipped as the request already matched an endpoint.
2025-11-18 15:33:32.356 +03:00 [DBG] An 'IServiceProvider' was created for internal use by Entity Framework.
2025-11-18 15:33:37.782 +03:00 [INF] Executing endpoint 'BillingSystem.API.Controllers.InvoicesController.Post (BillingSystem.API)'
2025-11-18 15:33:37.834 +03:00 [INF] Route matched with {action = "Post", controller = "Invoices"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Post(BillingSystem.Application.Requests.CreateInvoiceRequest) on controller BillingSystem.API.Controllers.InvoicesController (BillingSystem.API).
2025-11-18 15:33:37.843 +03:00 [DBG] Execution plan of authorization filters (in the following order): ["None"]
2025-11-18 15:33:37.848 +03:00 [DBG] Execution plan of resource filters (in the following order): ["None"]
2025-11-18 15:33:37.853 +03:00 [DBG] Execution plan of action filters (in the following order): ["Microsoft.AspNetCore.Mvc.ModelBinding.UnsupportedContentTypeFilter (Order: -3000)","Microsoft.AspNetCore.Mvc.Infrastructure.ModelStateInvalidFilter (Order: -2000)","BillingSystem.API.ActionFilters.AuditBillingRequestsFilter","BillingSystem.API.ActionFilters.IdempotencyFilter (Order: 0)"]
2025-11-18 15:33:37.862 +03:00 [DBG] Execution plan of exception filters (in the following order): ["None"]
2025-11-18 15:33:37.867 +03:00 [DBG] Execution plan of result filters (in the following order): ["Microsoft.AspNetCore.Mvc.Infrastructure.ClientErrorResultFilter (Order: -2000)","Microsoft.AspNetCore.Mvc.ProducesAttribute (Order: 0)","BillingSystem.API.ActionFilters.IdempotencyFilter (Order: 0)"]
2025-11-18 15:33:37.875 +03:00 [DBG] Executing controller factory for controller BillingSystem.API.Controllers.InvoicesController (BillingSystem.API)
2025-11-18 15:33:37.884 +03:00 [WRN] You do not have a valid license key for the Lucky Penny software MediatR. This is allowed for development and testing scenarios. If you are running in production you are required to have a licensed version. Please visit https://luckypennysoftware.com to obtain a valid license.
2025-11-18 15:33:37.932 +03:00 [DBG] Executed controller factory for controller BillingSystem.API.Controllers.InvoicesController (BillingSystem.API)
2025-11-18 15:33:37.955 +03:00 [DBG] Attempting to bind parameter 'invoiceRequest' of type 'BillingSystem.Application.Requests.CreateInvoiceRequest' ...
2025-11-18 15:33:37.963 +03:00 [DBG] Attempting to bind parameter 'invoiceRequest' of type 'BillingSystem.Application.Requests.CreateInvoiceRequest' using the name '' in request data ...
2025-11-18 15:33:37.967 +03:00 [DBG] Selected input formatter 'Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonInputFormatter' for content type 'application/json'.
2025-11-18 15:33:38.006 +03:00 [DBG] Connection id "0HNH6JQINDSTG", Request id "0HNH6JQINDSTG:00000001": started reading request body.
2025-11-18 15:33:38.012 +03:00 [DBG] Connection id "0HNH6JQINDSTG", Request id "0HNH6JQINDSTG:00000001": done reading request body.
2025-11-18 15:33:38.046 +03:00 [DBG] JSON input formatter succeeded, deserializing to type 'BillingSystem.Application.Requests.CreateInvoiceRequest'
2025-11-18 15:33:38.051 +03:00 [DBG] Done attempting to bind parameter 'invoiceRequest' of type 'BillingSystem.Application.Requests.CreateInvoiceRequest'.
2025-11-18 15:33:38.055 +03:00 [DBG] Done attempting to bind parameter 'invoiceRequest' of type 'BillingSystem.Application.Requests.CreateInvoiceRequest'.
2025-11-18 15:33:38.058 +03:00 [DBG] Attempting to validate the bound parameter 'invoiceRequest' of type 'BillingSystem.Application.Requests.CreateInvoiceRequest' ...
2025-11-18 15:33:38.082 +03:00 [DBG] Done attempting to validate the bound parameter 'invoiceRequest' of type 'BillingSystem.Application.Requests.CreateInvoiceRequest'.
2025-11-18 15:33:38.394 +03:00 [DBG] No relationship from 'Invoice' to 'Invoice' has been configured by convention because there are multiple properties on one entity type - {'DiscountedPrimaryInvoice'} that could be matched with the properties on the other entity type - {'InverseDiscountedPrimaryInvoice', 'InversePrimaryInvoice', 'InverseSubstitutionPrimaryInvoice', 'PrimaryInvoice', 'SubstitutionPrimaryInvoice'}. This message can be disregarded if explicit configuration has been specified in 'OnModelCreating'.
2025-11-18 15:33:38.633 +03:00 [DBG] No relationship from 'Invoice' to 'Invoice' has been configured by convention because there are multiple properties on one entity type - {'DiscountedPrimaryInvoice'} that could be matched with the properties on the other entity type - {'InverseDiscountedPrimaryInvoice', 'InversePrimaryInvoice', 'InverseSubstitutionPrimaryInvoice', 'PrimaryInvoice', 'SubstitutionPrimaryInvoice'}. This message can be disregarded if explicit configuration has been specified in 'OnModelCreating'.
2025-11-18 15:33:38.650 +03:00 [DBG] No relationship from 'Invoice' to 'Invoice' has been configured by convention because there are multiple properties on one entity type - {'InversePrimaryInvoice'} that could be matched with the properties on the other entity type - {'InverseSubstitutionPrimaryInvoice', 'PrimaryInvoice', 'SubstitutionPrimaryInvoice'}. This message can be disregarded if explicit configuration has been specified in 'OnModelCreating'.
2025-11-18 15:33:38.661 +03:00 [DBG] No relationship from 'Invoice' to 'Invoice' has been configured by convention because there are multiple properties on one entity type - {'InversePrimaryInvoice'} that could be matched with the properties on the other entity type - {'InverseSubstitutionPrimaryInvoice', 'PrimaryInvoice', 'SubstitutionPrimaryInvoice'}. This message can be disregarded if explicit configuration has been specified in 'OnModelCreating'.
2025-11-18 15:33:39.045 +03:00 [DBG] Entity Framework Core 9.0.9 initialized 'BillingServiceDBContext' using provider 'Microsoft.EntityFrameworkCore.SqlServer:9.0.9' with options: EngineType=SqlServer 
2025-11-18 15:33:39.183 +03:00 [DBG] Compiling query expression: 
'DbSet<Invoice>()
    .AsNoTracking()
    .Any(inv => inv.ExternalId.ToString() == __idempotentKey_0)'
2025-11-18 15:33:39.514 +03:00 [DBG] Generated query execution expression: 
'queryContext => ShapedQueryCompilingExpressionVisitor.SingleAsync<bool>(
    asyncEnumerable: SingleQueryingEnumerable.Create<bool>(
        relationalQueryContext: (RelationalQueryContext)queryContext, 
        relationalCommandResolver: parameters => [LIFTABLE Constant: RelationalCommandCache.QueryExpression(
            Projection Mapping:
                EmptyProjectionMember -> 0
            SELECT EXISTS (
                SELECT 1
                FROM Invoices AS i
                WHERE COALESCE(CONVERT(varchar(36), i.ExternalId), '') == @__idempotentKey_0)) | Resolver: c => new RelationalCommandCache(
            c.Dependencies.MemoryCache, 
            c.RelationalDependencies.QuerySqlGeneratorFactory, 
            c.RelationalDependencies.RelationalParameterBasedSqlProcessorFactory, 
            Projection Mapping:
                EmptyProjectionMember -> 0
            SELECT EXISTS (
                SELECT 1
                FROM Invoices AS i
                WHERE COALESCE(CONVERT(varchar(36), i.ExternalId), '') == @__idempotentKey_0), 
            False, 
            new HashSet<string>(
                new string[]{ }, 
                StringComparer.Ordinal
            )
        )].GetRelationalCommandTemplate(parameters), 
        readerColumns: null, 
        shaper: (queryContext, dataReader, resultContext, resultCoordinator) => 
        {
            bool? value1;
            value1 = dataReader.IsDBNull(0) ? default(bool?) : (bool?)dataReader.GetBoolean(0);
            return (bool)value1;
        }, 
        contextType: BillingSystem.Infrastructure.EF.BillingServiceDBContext, 
        standAloneStateManager: False, 
        detailedErrorsEnabled: False, 
        threadSafetyChecksEnabled: True), 
    cancellationToken: queryContext.CancellationToken)'
2025-11-18 15:33:39.588 +03:00 [DBG] Creating DbConnection.
2025-11-18 15:33:39.626 +03:00 [DBG] Created DbConnection. (33ms).
2025-11-18 15:33:39.635 +03:00 [DBG] Opening connection to database 'GAC-BillingService' on server '.'.
2025-11-18 15:33:39.960 +03:00 [DBG] Opened connection to database 'GAC-BillingService' on server '.'.
2025-11-18 15:33:39.972 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-11-18 15:33:39.988 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (10ms).
2025-11-18 15:33:40.008 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (36ms).
2025-11-18 15:33:40.022 +03:00 [DBG] Executing DbCommand [Parameters=[@__idempotentKey_0='?' (Size = 36) (DbType = AnsiString)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [Invoices] AS [i]
        WHERE CONVERT(varchar(36), [i].[ExternalId]) = @__idempotentKey_0) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2025-11-18 15:33:40.099 +03:00 [INF] Executed DbCommand (81ms) [Parameters=[@__idempotentKey_0='?' (Size = 36) (DbType = AnsiString)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [Invoices] AS [i]
        WHERE CONVERT(varchar(36), [i].[ExternalId]) = @__idempotentKey_0) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2025-11-18 15:33:40.126 +03:00 [DBG] Closing data reader to 'GAC-BillingService' on server '.'.
2025-11-18 15:33:40.142 +03:00 [DBG] A data reader for 'GAC-BillingService' on server '.' is being disposed after spending 30ms reading results.
2025-11-18 15:33:40.151 +03:00 [DBG] Closing connection to database 'GAC-BillingService' on server '.'.
2025-11-18 15:33:40.165 +03:00 [DBG] Closed connection to database 'GAC-BillingService' on server '.' (13ms).
2025-11-18 15:33:40.364 +03:00 [WRN] You do not have a valid license key for the Lucky Penny software AutoMapper. This is allowed for development and testing scenarios. If you are running in production you are required to have a licensed version. Please visit https://luckypennysoftware.com to obtain a valid license.
2025-11-18 15:33:47.933 +03:00 [DBG] Opening connection to database 'GAC-BillingService' on server '.'.
2025-11-18 15:33:47.944 +03:00 [DBG] Opened connection to database 'GAC-BillingService' on server '.'.
2025-11-18 15:33:47.951 +03:00 [DBG] Beginning transaction with isolation level 'Unspecified'.
2025-11-18 15:33:47.965 +03:00 [DBG] Began transaction with isolation level 'ReadCommitted'.
2025-11-18 15:33:47.973 +03:00 [DBG] Compiling query expression: 
'DbSet<InvoiceSequenceValue>().FromSql(EXECUTE dbo.GetNextInvoiceNumber, __p_0)
'
2025-11-18 15:33:48.023 +03:00 [DBG] Generated query execution expression: 
'queryContext => FromSqlQueryingEnumerable.Create<InvoiceSequenceValue>(
    relationalQueryContext: (RelationalQueryContext)queryContext, 
    relationalCommandResolver: parameters => [LIFTABLE Constant: RelationalCommandCache.QueryExpression(
        Projection Mapping:
            EmptyProjectionMember -> Dictionary<IProperty, int> { [Property: InvoiceSequenceValue.Value (long) Required, 0] }
        SELECT b.Value
        FROM EXECUTE dbo.GetNextInvoiceNumber) | Resolver: c => new RelationalCommandCache(
        c.Dependencies.MemoryCache, 
        c.RelationalDependencies.QuerySqlGeneratorFactory, 
        c.RelationalDependencies.RelationalParameterBasedSqlProcessorFactory, 
        Projection Mapping:
            EmptyProjectionMember -> Dictionary<IProperty, int> { [Property: InvoiceSequenceValue.Value (long) Required, 0] }
        SELECT b.Value
        FROM EXECUTE dbo.GetNextInvoiceNumber, 
        False, 
        new HashSet<string>(
            new string[]{ }, 
            StringComparer.Ordinal
        )
    )].GetRelationalCommandTemplate(parameters), 
    readerColumns: null, 
    columnNames: [LIFTABLE Constant: string[] { "Value" } | Resolver: _ => new string[]{ "Value" }], 
    shaper: (queryContext, dataReader, indexMap) => 
    {
        InvoiceSequenceValue entity;
        entity = 
        {
            MaterializationContext materializationContext1;
            IEntityType entityType1;
            InvoiceSequenceValue instance1;
            materializationContext1 = new MaterializationContext(
                [LIFTABLE Constant: ValueBuffer | Resolver: _ => (object)ValueBuffer.Empty], 
                queryContext.Context
            );
            instance1 = default(InvoiceSequenceValue);
            {
                ISnapshot shadowSnapshot1;
                shadowSnapshot1 = [LIFTABLE Constant: Snapshot | Resolver: _ => Snapshot.Empty];
                entityType1 = [LIFTABLE Constant: EntityType: InvoiceSequenceValue Keyless | Resolver: namelessParameter{0} => namelessParameter{0}.Dependencies.Model.FindEntityType("BillingSystem.Domain.Entities.InvoiceSequenceValue")];
                instance1 = switch (entityType1)
                {
                    case [LIFTABLE Constant: EntityType: InvoiceSequenceValue Keyless | Resolver: namelessParameter{1} => namelessParameter{1}.Dependencies.Model.FindEntityType("BillingSystem.Domain.Entities.InvoiceSequenceValue")]: 
                        {
                            return 
                            {
                                InvoiceSequenceValue instance;
                                instance = new InvoiceSequenceValue();
                                instance.<Value>k__BackingField = dataReader.GetInt64(indexMap[0]);
                                (instance is IInjectableService) ? ((IInjectableService)instance).Injected(
                                    context: materializationContext1.Context, 
                                    entity: instance, 
                                    queryTrackingBehavior: TrackAll, 
                                    structuralType: [LIFTABLE Constant: EntityType: InvoiceSequenceValue Keyless | Resolver: namelessParameter{2} => namelessParameter{2}.Dependencies.Model.FindEntityType("BillingSystem.Domain.Entities.InvoiceSequenceValue")]) : default(void);
                                return instance;
                            }}
                    default: 
                        default(InvoiceSequenceValue)
                }
                ;
                return instance1;
            }return instance1;
        };
        return entity;
    }, 
    contextType: BillingSystem.Infrastructure.EF.BillingServiceDBContext, 
    standAloneStateManager: False, 
    detailedErrorsEnabled: False, 
    threadSafetyChecksEnabled: True)'
2025-11-18 15:33:48.038 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-11-18 15:33:48.042 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (4ms).
2025-11-18 15:33:48.048 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (9ms).
2025-11-18 15:33:48.052 +03:00 [DBG] Executing DbCommand [Parameters=[], CommandType='"Text"', CommandTimeout='30']
EXECUTE dbo.GetNextInvoiceNumber
2025-11-18 15:33:48.064 +03:00 [INF] Executed DbCommand (12ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
EXECUTE dbo.GetNextInvoiceNumber
2025-11-18 15:33:48.075 +03:00 [DBG] Closing data reader to 'GAC-BillingService' on server '.'.
2025-11-18 15:33:48.080 +03:00 [DBG] A data reader for 'GAC-BillingService' on server '.' is being disposed after spending 9ms reading results.
2025-11-18 15:33:48.087 +03:00 [DBG] Compiling query expression: 
'DbSet<Customer>()
    .FirstOrDefault(c => c.IdentityNumber == __cutomerIdentityNumber_0)'
2025-11-18 15:33:48.107 +03:00 [DBG] Generated query execution expression: 
'queryContext => SingleQueryingEnumerable.Create<Customer>(
    relationalQueryContext: (RelationalQueryContext)queryContext, 
    relationalCommandResolver: parameters => [LIFTABLE Constant: RelationalCommandCache.QueryExpression(
        Projection Mapping:
            EmptyProjectionMember -> Dictionary<IProperty, int> { [Property: Customer.Id (long) Required PK AfterSave:Throw ValueGenerated.OnAdd, 0], [Property: Customer.AddressBuildingNumber (string) MaxLength(200), 1], [Property: Customer.AddressCity (string) Required MaxLength(200), 2], [Property: Customer.AddressCountry (string) Required MaxLength(200), 3], [Property: Customer.AddressDistrict (string) Required MaxLength(200), 4], [Property: Customer.AddressPostalCode (string) Required MaxLength(50), 5], [Property: Customer.AddressStreet (string) MaxLength(200), 6], [Property: Customer.AddressSubNumber (string) MaxLength(200), 7], [Property: Customer.CreatedBy (string) Required MaxLength(50), 8], [Property: Customer.CreatedDate (DateTime) Required, 9], [Property: Customer.CustomerType (string) Required MaxLength(100), 10], [Property: Customer.EmailAddress (string) MaxLength(80), 11], [Property: Customer.FullName (string) Required MaxLength(500), 12], [Property: Customer.IdentityNumber (string) Required MaxLength(100), 13], [Property: Customer.IdentityType (int?), 14], [Property: Customer.IsDeleted (bool) Required, 15], [Property: Customer.LastUpdatedDate (DateTime?), 16], [Property: Customer.OverpaymentBalance (decimal?), 17], [Property: Customer.PhoneNumber (string) MaxLength(50), 18], [Property: Customer.Vatnumber (string) MaxLength(100), 19] }
        SELECT TOP(1) c.Id, c.Address_BuildingNumber, c.Address_City, c.Address_Country, c.Address_District, c.Address_PostalCode, c.Address_Street, c.Address_SubNumber, c.CreatedBy, c.CreatedDate, c.CustomerType, c.EmailAddress, c.FullName, c.IdentityNumber, c.IdentityType, c.IsDeleted, c.LastUpdatedDate, c.OverpaymentBalance, c.PhoneNumber, c.VATNumber
        FROM Customers AS c
        WHERE c.IdentityNumber == @__cutomerIdentityNumber_0) | Resolver: c => new RelationalCommandCache(
        c.Dependencies.MemoryCache, 
        c.RelationalDependencies.QuerySqlGeneratorFactory, 
        c.RelationalDependencies.RelationalParameterBasedSqlProcessorFactory, 
        Projection Mapping:
            EmptyProjectionMember -> Dictionary<IProperty, int> { [Property: Customer.Id (long) Required PK AfterSave:Throw ValueGenerated.OnAdd, 0], [Property: Customer.AddressBuildingNumber (string) MaxLength(200), 1], [Property: Customer.AddressCity (string) Required MaxLength(200), 2], [Property: Customer.AddressCountry (string) Required MaxLength(200), 3], [Property: Customer.AddressDistrict (string) Required MaxLength(200), 4], [Property: Customer.AddressPostalCode (string) Required MaxLength(50), 5], [Property: Customer.AddressStreet (string) MaxLength(200), 6], [Property: Customer.AddressSubNumber (string) MaxLength(200), 7], [Property: Customer.CreatedBy (string) Required MaxLength(50), 8], [Property: Customer.CreatedDate (DateTime) Required, 9], [Property: Customer.CustomerType (string) Required MaxLength(100), 10], [Property: Customer.EmailAddress (string) MaxLength(80), 11], [Property: Customer.FullName (string) Required MaxLength(500), 12], [Property: Customer.IdentityNumber (string) Required MaxLength(100), 13], [Property: Customer.IdentityType (int?), 14], [Property: Customer.IsDeleted (bool) Required, 15], [Property: Customer.LastUpdatedDate (DateTime?), 16], [Property: Customer.OverpaymentBalance (decimal?), 17], [Property: Customer.PhoneNumber (string) MaxLength(50), 18], [Property: Customer.Vatnumber (string) MaxLength(100), 19] }
        SELECT TOP(1) c.Id, c.Address_BuildingNumber, c.Address_City, c.Address_Country, c.Address_District, c.Address_PostalCode, c.Address_Street, c.Address_SubNumber, c.CreatedBy, c.CreatedDate, c.CustomerType, c.EmailAddress, c.FullName, c.IdentityNumber, c.IdentityType, c.IsDeleted, c.LastUpdatedDate, c.OverpaymentBalance, c.PhoneNumber, c.VATNumber
        FROM Customers AS c
        WHERE c.IdentityNumber == @__cutomerIdentityNumber_0, 
        False, 
        new HashSet<string>(
            new string[]{ }, 
            StringComparer.Ordinal
        )
    )].GetRelationalCommandTemplate(parameters), 
    readerColumns: null, 
    shaper: (queryContext, dataReader, resultContext, resultCoordinator) => 
    {
        Customer entity;
        entity = 
        {
            MaterializationContext materializationContext1;
            IEntityType entityType1;
            Customer instance1;
            InternalEntityEntry entry1;
            bool hasNullKey1;
            materializationContext1 = new MaterializationContext(
                [LIFTABLE Constant: ValueBuffer | Resolver: _ => (object)ValueBuffer.Empty], 
                queryContext.Context
            );
            instance1 = default(Customer);
            entry1 = queryContext.TryGetEntry(
                key: [LIFTABLE Constant: Key: Customer.Id PK | Resolver: c => c.Dependencies.Model.FindEntityType("BillingSystem.Domain.Entities.Customer").FindPrimaryKey()], 
                keyValues: new object[]{ (object)dataReader.GetInt64(0) }, 
                throwOnNullKey: True, 
                hasNullKey: hasNullKey1);
            !(hasNullKey1) ? entry1 != default(InternalEntityEntry) ? 
            {
                entityType1 = entry1.EntityType;
                return instance1 = (Customer)entry1.Entity;
            } : 
            {
                ISnapshot shadowSnapshot1;
                shadowSnapshot1 = [LIFTABLE Constant: Snapshot | Resolver: _ => Snapshot.Empty];
                entityType1 = [LIFTABLE Constant: EntityType: Customer | Resolver: namelessParameter{0} => namelessParameter{0}.Dependencies.Model.FindEntityType("BillingSystem.Domain.Entities.Customer")];
                instance1 = switch (entityType1)
                {
                    case [LIFTABLE Constant: EntityType: Customer | Resolver: namelessParameter{1} => namelessParameter{1}.Dependencies.Model.FindEntityType("BillingSystem.Domain.Entities.Customer")]: 
                        {
                            return 
                            {
                                Customer instance;
                                instance = new Customer();
                                instance.<Id>k__BackingField = dataReader.GetInt64(0);
                                instance.<AddressBuildingNumber>k__BackingField = dataReader.IsDBNull(1) ? default(string) : dataReader.GetString(1);
                                instance.<AddressCity>k__BackingField = dataReader.GetString(2);
                                instance.<AddressCountry>k__BackingField = dataReader.GetString(3);
                                instance.<AddressDistrict>k__BackingField = dataReader.GetString(4);
                                instance.<AddressPostalCode>k__BackingField = dataReader.GetString(5);
                                instance.<AddressStreet>k__BackingField = dataReader.IsDBNull(6) ? default(string) : dataReader.GetString(6);
                                instance.<AddressSubNumber>k__BackingField = dataReader.IsDBNull(7) ? default(string) : dataReader.GetString(7);
                                instance.<CreatedBy>k__BackingField = dataReader.GetString(8);
                                instance.<CreatedDate>k__BackingField = dataReader.GetDateTime(9);
                                instance.<CustomerType>k__BackingField = dataReader.GetString(10);
                                instance.<EmailAddress>k__BackingField = dataReader.IsDBNull(11) ? default(string) : dataReader.GetString(11);
                                instance.<FullName>k__BackingField = dataReader.GetString(12);
                                instance.<IdentityNumber>k__BackingField = dataReader.GetString(13);
                                instance.<IdentityType>k__BackingField = dataReader.IsDBNull(14) ? default(int?) : (int?)dataReader.GetInt32(14);
                                instance.<IsDeleted>k__BackingField = dataReader.GetBoolean(15);
                                instance.<LastUpdatedDate>k__BackingField = dataReader.IsDBNull(16) ? default(DateTime?) : (DateTime?)dataReader.GetDateTime(16);
                                instance.<OverpaymentBalance>k__BackingField = dataReader.IsDBNull(17) ? default(decimal?) : (decimal?)dataReader.GetDecimal(17);
                                instance.<PhoneNumber>k__BackingField = dataReader.IsDBNull(18) ? default(string) : dataReader.GetString(18);
                                instance.<Vatnumber>k__BackingField = dataReader.IsDBNull(19) ? default(string) : dataReader.GetString(19);
                                (instance is IInjectableService) ? ((IInjectableService)instance).Injected(
                                    context: materializationContext1.Context, 
                                    entity: instance, 
                                    queryTrackingBehavior: TrackAll, 
                                    structuralType: [LIFTABLE Constant: EntityType: Customer | Resolver: namelessParameter{2} => namelessParameter{2}.Dependencies.Model.FindEntityType("BillingSystem.Domain.Entities.Customer")]) : default(void);
                                return instance;
                            }}
                    default: 
                        default(Customer)
                }
                ;
                entry1 = entityType1 == default(IEntityType) ? default(InternalEntityEntry) : queryContext.StartTracking(
                    entityType: entityType1, 
                    entity: instance1, 
                    snapshot: shadowSnapshot1);
                return instance1;
            } : default(void);
            return instance1;
        };
        return entity;
    }, 
    contextType: BillingSystem.Infrastructure.EF.BillingServiceDBContext, 
    standAloneStateManager: False, 
    detailedErrorsEnabled: False, 
    threadSafetyChecksEnabled: True)
    .SingleOrDefault()'
2025-11-18 15:33:48.122 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-11-18 15:33:48.125 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (3ms).
2025-11-18 15:33:48.129 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (6ms).
2025-11-18 15:33:48.133 +03:00 [DBG] Executing DbCommand [Parameters=[@__cutomerIdentityNumber_0='?' (Size = 100)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[Id], [c].[Address_BuildingNumber], [c].[Address_City], [c].[Address_Country], [c].[Address_District], [c].[Address_PostalCode], [c].[Address_Street], [c].[Address_SubNumber], [c].[CreatedBy], [c].[CreatedDate], [c].[CustomerType], [c].[EmailAddress], [c].[FullName], [c].[IdentityNumber], [c].[IdentityType], [c].[IsDeleted], [c].[LastUpdatedDate], [c].[OverpaymentBalance], [c].[PhoneNumber], [c].[VATNumber]
FROM [Customers] AS [c]
WHERE [c].[IdentityNumber] = @__cutomerIdentityNumber_0
2025-11-18 15:33:48.141 +03:00 [INF] Executed DbCommand (9ms) [Parameters=[@__cutomerIdentityNumber_0='?' (Size = 100)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[Id], [c].[Address_BuildingNumber], [c].[Address_City], [c].[Address_Country], [c].[Address_District], [c].[Address_PostalCode], [c].[Address_Street], [c].[Address_SubNumber], [c].[CreatedBy], [c].[CreatedDate], [c].[CustomerType], [c].[EmailAddress], [c].[FullName], [c].[IdentityNumber], [c].[IdentityType], [c].[IsDeleted], [c].[LastUpdatedDate], [c].[OverpaymentBalance], [c].[PhoneNumber], [c].[VATNumber]
FROM [Customers] AS [c]
WHERE [c].[IdentityNumber] = @__cutomerIdentityNumber_0
2025-11-18 15:33:48.183 +03:00 [DBG] Context 'BillingServiceDBContext' started tracking 'Customer' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-11-18 15:33:48.238 +03:00 [DBG] Closing data reader to 'GAC-BillingService' on server '.'.
2025-11-18 15:33:48.246 +03:00 [DBG] A data reader for 'GAC-BillingService' on server '.' is being disposed after spending 99ms reading results.
2025-11-18 15:33:48.281 +03:00 [DBG] 'BillingServiceDBContext' generated a temporary value for the property 'Invoice.Id'. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-11-18 15:33:48.379 +03:00 [DBG] Context 'BillingServiceDBContext' started tracking 'Invoice' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-11-18 15:33:48.388 +03:00 [DBG] 'BillingServiceDBContext' generated a temporary value for the property 'Customer.Id'. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-11-18 15:33:48.406 +03:00 [DBG] The foreign key property 'Invoice.CustomerId' was detected as changed. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see property values.
2025-11-18 15:33:48.437 +03:00 [DBG] Context 'BillingServiceDBContext' started tracking 'Customer' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-11-18 15:33:48.449 +03:00 [DBG] SaveChanges starting for 'BillingServiceDBContext'.
2025-11-18 15:33:48.461 +03:00 [DBG] DetectChanges starting for 'BillingServiceDBContext'.
2025-11-18 15:33:48.542 +03:00 [DBG] The unchanged property 'Customer.AddressSubNumber' was detected as changed and will be marked as modified. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see property values.
2025-11-18 15:33:48.555 +03:00 [DBG] An entity of type 'Customer' tracked by 'BillingServiceDBContext' changed state from '"Unchanged"' to '"Modified"'. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-11-18 15:33:48.564 +03:00 [DBG] DetectChanges completed for 'BillingServiceDBContext'.
2025-11-18 15:33:48.697 +03:00 [DBG] Executing 2 update commands as a batch.
2025-11-18 15:33:48.710 +03:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-11-18 15:33:48.717 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-11-18 15:33:48.721 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (4ms).
2025-11-18 15:33:48.728 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (11ms).
2025-11-18 15:33:48.741 +03:00 [DBG] Executing DbCommand [Parameters=[@p1='?' (DbType = Int64), @p0='?' (Size = 200), @p2='?' (Size = 200), @p3='?' (Size = 200), @p4='?' (Size = 200), @p5='?' (Size = 200), @p6='?' (Size = 50), @p7='?' (Size = 200), @p8='?' (Size = 200), @p9='?' (Size = 50), @p10='?' (DbType = DateTime), @p11='?' (Size = 100), @p12='?' (Size = 80), @p13='?' (Size = 500), @p14='?' (Size = 100), @p15='?' (DbType = Int32), @p16='?' (DbType = Boolean), @p17='?' (DbType = DateTime), @p18='?' (Precision = 18) (DbType = Decimal), @p19='?' (Size = 50), @p20='?' (Size = 100)], CommandType='"Text"', CommandTimeout='30']
SET NOCOUNT ON;
UPDATE [Customers] SET [Address_SubNumber] = @p0
OUTPUT 1
WHERE [Id] = @p1;
INSERT INTO [Customers] ([Address_BuildingNumber], [Address_City], [Address_Country], [Address_District], [Address_PostalCode], [Address_Street], [Address_SubNumber], [CreatedBy], [CreatedDate], [CustomerType], [EmailAddress], [FullName], [IdentityNumber], [IdentityType], [IsDeleted], [LastUpdatedDate], [OverpaymentBalance], [PhoneNumber], [VATNumber])
OUTPUT INSERTED.[Id]
VALUES (@p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18, @p19, @p20);
2025-11-18 15:33:48.781 +03:00 [INF] Executed DbCommand (49ms) [Parameters=[@p1='?' (DbType = Int64), @p0='?' (Size = 200), @p2='?' (Size = 200), @p3='?' (Size = 200), @p4='?' (Size = 200), @p5='?' (Size = 200), @p6='?' (Size = 50), @p7='?' (Size = 200), @p8='?' (Size = 200), @p9='?' (Size = 50), @p10='?' (DbType = DateTime), @p11='?' (Size = 100), @p12='?' (Size = 80), @p13='?' (Size = 500), @p14='?' (Size = 100), @p15='?' (DbType = Int32), @p16='?' (DbType = Boolean), @p17='?' (DbType = DateTime), @p18='?' (Precision = 18) (DbType = Decimal), @p19='?' (Size = 50), @p20='?' (Size = 100)], CommandType='"Text"', CommandTimeout='30']
SET NOCOUNT ON;
UPDATE [Customers] SET [Address_SubNumber] = @p0
OUTPUT 1
WHERE [Id] = @p1;
INSERT INTO [Customers] ([Address_BuildingNumber], [Address_City], [Address_Country], [Address_District], [Address_PostalCode], [Address_Street], [Address_SubNumber], [CreatedBy], [CreatedDate], [CustomerType], [EmailAddress], [FullName], [IdentityNumber], [IdentityType], [IsDeleted], [LastUpdatedDate], [OverpaymentBalance], [PhoneNumber], [VATNumber])
OUTPUT INSERTED.[Id]
VALUES (@p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18, @p19, @p20);
2025-11-18 15:33:48.822 +03:00 [DBG] The foreign key property 'Customer.Id' was detected as changed. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see property values.
2025-11-18 15:33:48.857 +03:00 [DBG] The foreign key property 'Invoice.CustomerId' was detected as changed. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see property values.
2025-11-18 15:33:48.862 +03:00 [DBG] Closing data reader to 'GAC-BillingService' on server '.'.
2025-11-18 15:33:48.866 +03:00 [DBG] A data reader for 'GAC-BillingService' on server '.' is being disposed after spending 63ms reading results.
2025-11-18 15:33:48.873 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-11-18 15:33:48.875 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (2ms).
2025-11-18 15:33:48.878 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (5ms).
2025-11-18 15:33:48.883 +03:00 [DBG] Executing DbCommand [Parameters=[@p21='?' (Precision = 18) (DbType = Decimal), @p22='?' (Size = 3000), @p23='?' (Size = 100), @p24='?' (Size = 50), @p25='?' (DbType = DateTime), @p26='?' (Size = 50), @p27='?' (DbType = Int64), @p28='?' (DbType = Int64), @p29='?' (DbType = DateTime), @p30='?' (DbType = Guid), @p31='?' (Size = 50), @p32='?' (DbType = Int32), @p33='?' (DbType = Int32), @p34='?' (DbType = Boolean), @p35='?' (DbType = Boolean), @p36='?' (DbType = Boolean), @p37='?' (DbType = Boolean), @p38='?' (DbType = DateTime), @p39='?' (DbType = DateTime), @p40='?' (Size = 4000), @p41='?' (Size = 100), @p42='?' (Size = 100), @p43='?' (DbType = Int64), @p44='?' (Size = 4000), @p45='?' (DbType = Int64), @p46='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [Invoices] ([Amount], [CancelationReasons], [ClientReferenceNumber], [CreatedBy], [CreatedDate], [Currency], [CustomerID], [DiscountedPrimaryInvoiceID], [DueAt], [ExternalId], [InvoiceNumber], [InvoiceStatus], [InvoiceType], [IsDeleted], [IsDiscounted], [IsSubInvoice], [IsSubstitution], [IssuedAt], [LastUpdatedDate], [Metadata], [PaymentProvider], [PaymentReference], [PrimaryInvoiceID], [ProviderResponse], [SubstitutionPrimaryInvoiceID], [TenantId])
OUTPUT INSERTED.[Id]
VALUES (@p21, @p22, @p23, @p24, @p25, @p26, @p27, @p28, @p29, @p30, @p31, @p32, @p33, @p34, @p35, @p36, @p37, @p38, @p39, @p40, @p41, @p42, @p43, @p44, @p45, @p46);
2025-11-18 15:33:48.901 +03:00 [INF] Executed DbCommand (18ms) [Parameters=[@p21='?' (Precision = 18) (DbType = Decimal), @p22='?' (Size = 3000), @p23='?' (Size = 100), @p24='?' (Size = 50), @p25='?' (DbType = DateTime), @p26='?' (Size = 50), @p27='?' (DbType = Int64), @p28='?' (DbType = Int64), @p29='?' (DbType = DateTime), @p30='?' (DbType = Guid), @p31='?' (Size = 50), @p32='?' (DbType = Int32), @p33='?' (DbType = Int32), @p34='?' (DbType = Boolean), @p35='?' (DbType = Boolean), @p36='?' (DbType = Boolean), @p37='?' (DbType = Boolean), @p38='?' (DbType = DateTime), @p39='?' (DbType = DateTime), @p40='?' (Size = 4000), @p41='?' (Size = 100), @p42='?' (Size = 100), @p43='?' (DbType = Int64), @p44='?' (Size = 4000), @p45='?' (DbType = Int64), @p46='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [Invoices] ([Amount], [CancelationReasons], [ClientReferenceNumber], [CreatedBy], [CreatedDate], [Currency], [CustomerID], [DiscountedPrimaryInvoiceID], [DueAt], [ExternalId], [InvoiceNumber], [InvoiceStatus], [InvoiceType], [IsDeleted], [IsDiscounted], [IsSubInvoice], [IsSubstitution], [IssuedAt], [LastUpdatedDate], [Metadata], [PaymentProvider], [PaymentReference], [PrimaryInvoiceID], [ProviderResponse], [SubstitutionPrimaryInvoiceID], [TenantId])
OUTPUT INSERTED.[Id]
VALUES (@p21, @p22, @p23, @p24, @p25, @p26, @p27, @p28, @p29, @p30, @p31, @p32, @p33, @p34, @p35, @p36, @p37, @p38, @p39, @p40, @p41, @p42, @p43, @p44, @p45, @p46);
2025-11-18 15:33:48.910 +03:00 [DBG] The foreign key property 'Invoice.Id' was detected as changed. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see property values.
2025-11-18 15:33:48.916 +03:00 [DBG] Closing data reader to 'GAC-BillingService' on server '.'.
2025-11-18 15:33:48.919 +03:00 [DBG] A data reader for 'GAC-BillingService' on server '.' is being disposed after spending 9ms reading results.
2025-11-18 15:33:48.934 +03:00 [DBG] An entity of type 'Invoice' tracked by 'BillingServiceDBContext' changed state from '"Added"' to '"Unchanged"'. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-11-18 15:33:48.944 +03:00 [DBG] An entity of type 'Customer' tracked by 'BillingServiceDBContext' changed state from '"Added"' to '"Unchanged"'. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-11-18 15:33:48.947 +03:00 [DBG] An entity of type 'Customer' tracked by 'BillingServiceDBContext' changed state from '"Modified"' to '"Unchanged"'. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-11-18 15:33:48.957 +03:00 [DBG] SaveChanges completed for 'BillingServiceDBContext' with 3 entities written to the database.
2025-11-18 15:33:48.965 +03:00 [DBG] 'BillingServiceDBContext' generated a temporary value for the property 'OutboxEvent.Id'. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-11-18 15:33:48.997 +03:00 [DBG] Context 'BillingServiceDBContext' started tracking 'OutboxEvent' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-11-18 15:33:49.007 +03:00 [DBG] 'BillingServiceDBContext' generated a temporary value for the property 'AuditEvent.Id'. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-11-18 15:33:49.028 +03:00 [DBG] Context 'BillingServiceDBContext' started tracking 'AuditEvent' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-11-18 15:33:49.033 +03:00 [DBG] SaveChanges starting for 'BillingServiceDBContext'.
2025-11-18 15:33:49.038 +03:00 [DBG] DetectChanges starting for 'BillingServiceDBContext'.
2025-11-18 15:33:49.050 +03:00 [DBG] DetectChanges completed for 'BillingServiceDBContext'.
2025-11-18 15:33:49.056 +03:00 [DBG] Executing 2 update commands as a batch.
2025-11-18 15:33:49.059 +03:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-11-18 15:33:49.061 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-11-18 15:33:49.063 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (2ms).
2025-11-18 15:33:49.068 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (6ms).
2025-11-18 15:33:49.071 +03:00 [DBG] Executing DbCommand [Parameters=[@p0='?' (Size = 100), @p1='?' (Size = 4000), @p2='?' (Size = 50), @p3='?' (DbType = DateTime), @p4='?' (Size = 500), @p5='?' (Size = 20), @p6='?' (Size = 100), @p7='?' (Size = 100), @p8='?' (DbType = Int64), @p9='?' (DbType = DateTime), @p10='?' (Size = 4000), @p11='?' (Size = 300), @p12='?' (Size = 4000), @p13='?' (DbType = Boolean), @p14='?' (Size = 20) (DbType = AnsiString)], CommandType='"Text"', CommandTimeout='30']
SET NOCOUNT ON;
INSERT INTO [audit].[AuditEvents] ([Action], [Changes], [CreatedBy], [CreatedDate], [Description], [EntityId], [EntityType], [UserId])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
INSERT INTO [Outbox_events] ([Aggregate_id], [CreatedDate], [ErrorMsg], [Event_type], [Payload], [Processed], [ProcessingStatus])
OUTPUT INSERTED.[Id]
VALUES (@p8, @p9, @p10, @p11, @p12, @p13, @p14);
2025-11-18 15:33:49.082 +03:00 [INF] Executed DbCommand (11ms) [Parameters=[@p0='?' (Size = 100), @p1='?' (Size = 4000), @p2='?' (Size = 50), @p3='?' (DbType = DateTime), @p4='?' (Size = 500), @p5='?' (Size = 20), @p6='?' (Size = 100), @p7='?' (Size = 100), @p8='?' (DbType = Int64), @p9='?' (DbType = DateTime), @p10='?' (Size = 4000), @p11='?' (Size = 300), @p12='?' (Size = 4000), @p13='?' (DbType = Boolean), @p14='?' (Size = 20) (DbType = AnsiString)], CommandType='"Text"', CommandTimeout='30']
SET NOCOUNT ON;
INSERT INTO [audit].[AuditEvents] ([Action], [Changes], [CreatedBy], [CreatedDate], [Description], [EntityId], [EntityType], [UserId])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
INSERT INTO [Outbox_events] ([Aggregate_id], [CreatedDate], [ErrorMsg], [Event_type], [Payload], [Processed], [ProcessingStatus])
OUTPUT INSERTED.[Id]
VALUES (@p8, @p9, @p10, @p11, @p12, @p13, @p14);
2025-11-18 15:33:49.087 +03:00 [DBG] The foreign key property 'AuditEvent.Id' was detected as changed. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see property values.
2025-11-18 15:33:49.092 +03:00 [DBG] The foreign key property 'OutboxEvent.Id' was detected as changed. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see property values.
2025-11-18 15:33:49.096 +03:00 [DBG] Closing data reader to 'GAC-BillingService' on server '.'.
2025-11-18 15:33:49.101 +03:00 [DBG] A data reader for 'GAC-BillingService' on server '.' is being disposed after spending 14ms reading results.
2025-11-18 15:33:49.106 +03:00 [DBG] An entity of type 'AuditEvent' tracked by 'BillingServiceDBContext' changed state from '"Added"' to '"Unchanged"'. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-11-18 15:33:49.112 +03:00 [DBG] An entity of type 'OutboxEvent' tracked by 'BillingServiceDBContext' changed state from '"Added"' to '"Unchanged"'. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-11-18 15:33:49.118 +03:00 [DBG] SaveChanges completed for 'BillingServiceDBContext' with 2 entities written to the database.
2025-11-18 15:33:49.124 +03:00 [DBG] Committing transaction.
2025-11-18 15:33:49.154 +03:00 [DBG] Committed transaction.
2025-11-18 15:33:49.160 +03:00 [DBG] Closing connection to database 'GAC-BillingService' on server '.'.
2025-11-18 15:33:49.164 +03:00 [DBG] Closed connection to database 'GAC-BillingService' on server '.' (3ms).
2025-11-18 15:33:49.172 +03:00 [DBG] Disposing transaction.
2025-11-18 15:33:54.055 +03:00 [DBG] List of registered output formatters, in the following order: ["Microsoft.AspNetCore.Mvc.Formatters.HttpNoContentOutputFormatter","Microsoft.AspNetCore.Mvc.Formatters.StringOutputFormatter","Microsoft.AspNetCore.Mvc.Formatters.StreamOutputFormatter","Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonOutputFormatter"]
2025-11-18 15:33:54.066 +03:00 [DBG] No information found on request to perform content negotiation.
2025-11-18 15:33:54.071 +03:00 [DBG] Attempting to select the first output formatter in the output formatters list which supports a content type from the explicitly specified content types '["application/json"]'.
2025-11-18 15:33:54.076 +03:00 [DBG] Selected output formatter 'Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonOutputFormatter' and content type 'application/json' to write the response.
2025-11-18 15:33:54.079 +03:00 [INF] Executing OkObjectResult, writing value of type 'BillingSystem.SharedKernel.ApiResponse`1[[System.Int64, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-11-18 15:33:54.102 +03:00 [INF] Executed action BillingSystem.API.Controllers.InvoicesController.Post (BillingSystem.API) in 16224.1385ms
2025-11-18 15:33:54.106 +03:00 [INF] Executed endpoint 'BillingSystem.API.Controllers.InvoicesController.Post (BillingSystem.API)'
2025-11-18 15:33:54.112 +03:00 [INF] HTTP POST /api/Invoices responded 200 in 21956.1861 ms
2025-11-18 15:33:54.118 +03:00 [DBG] Connection id "0HNH6JQINDSTG" completed keep alive response.
2025-11-18 15:33:54.125 +03:00 [DBG] 'BillingServiceDBContext' disposed.
2025-11-18 15:33:54.132 +03:00 [DBG] Disposing connection to database 'GAC-BillingService' on server '.'.
2025-11-18 15:33:54.137 +03:00 [DBG] Disposed connection to database '' on server '' (4ms).
2025-11-18 15:33:54.140 +03:00 [INF] Request finished HTTP/1.1 POST https://localhost:7257/api/Invoices - 200 null application/json; charset=utf-8 22017.8917ms
2025-11-18 15:38:20.176 +03:00 [DBG] Connection id "0HNH6JQINDSTE" received FIN.
2025-11-18 15:38:20.183 +03:00 [DBG] Connection id "0HNH6JQINDSTE" is closed. The last processed stream ID was 7.
2025-11-18 15:38:20.183 +03:00 [DBG] The connection queue processing loop for 0HNH6JQINDSTE completed.
2025-11-18 15:38:20.189 +03:00 [DBG] Connection id "0HNH6JQINDSTE" sending FIN because: "The Socket transport's send loop completed gracefully."
2025-11-18 15:38:20.202 +03:00 [DBG] Connection id "0HNH6JQINDSTE" stopped.
2025-11-18 15:41:51.932 +03:00 [DBG] Registered model binder providers, in the following order: ["Microsoft.AspNetCore.Mvc.ModelBinding.Binders.BinderTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ServicesModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.BodyModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.HeaderModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FloatingPointTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.EnumTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.DateTimeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.SimpleTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.TryParseModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.CancellationTokenModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ByteArrayModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FormFileModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FormCollectionModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.KeyValuePairModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.DictionaryModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ArrayModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.CollectionModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ComplexObjectModelBinderProvider"]
2025-11-18 15:41:52.171 +03:00 [DBG] Hosting starting
2025-11-18 15:41:52.684 +03:00 [DBG] Starting bus instances: IBus
2025-11-18 15:41:52.696 +03:00 [DBG] Starting bus: "rabbitmq://localhost/"
2025-11-18 15:41:52.761 +03:00 [DBG] Middleware loaded
2025-11-18 15:41:52.768 +03:00 [DBG] Middleware loaded. Script /_framework/aspnetcore-browser-refresh.js (16519 B).
2025-11-18 15:41:52.789 +03:00 [DBG] Middleware loaded. Script /_framework/blazor-hotreload.js (799 B).
2025-11-18 15:41:52.850 +03:00 [DBG] Connect: guest@localhost:5672/
2025-11-18 15:41:53.044 +03:00 [DBG] Middleware loaded: DOTNET_MODIFIABLE_ASSEMBLIES=debug, __ASPNETCORE_BROWSER_TOOLS=true
2025-11-18 15:41:53.081 +03:00 [DBG] Connected: guest@localhost:5672/ (address: amqp://localhost:5672, local: 60068)
2025-11-18 15:41:53.136 +03:00 [DBG] Endpoint Ready: "rabbitmq://localhost/ECHGHANNAMLP1_BillingSystemAPI_bus_wohoyyyh3bcsbzsgbdxnp863ru?temporary=true"
2025-11-18 15:41:53.141 +03:00 [INF] Bus started: "rabbitmq://localhost/"
2025-11-18 15:41:53.335 +03:00 [INF] Now listening on: https://localhost:7257
2025-11-18 15:41:53.341 +03:00 [INF] Now listening on: http://localhost:5009
2025-11-18 15:41:53.345 +03:00 [DBG] Loaded hosting startup assembly BillingSystem.API
2025-11-18 15:41:53.349 +03:00 [DBG] Loaded hosting startup assembly Microsoft.WebTools.ApiEndpointDiscovery
2025-11-18 15:41:53.354 +03:00 [DBG] Loaded hosting startup assembly Microsoft.AspNetCore.Watch.BrowserRefresh
2025-11-18 15:41:53.357 +03:00 [DBG] Loaded hosting startup assembly Microsoft.WebTools.BrowserLink.Net
2025-11-18 15:41:53.507 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-11-18 15:41:53.510 +03:00 [INF] Hosting environment: Development
2025-11-18 15:41:53.513 +03:00 [INF] Content root path: C:\Repositories\Gac-BillingSystem\src\BillingSystem.API
2025-11-18 15:41:53.516 +03:00 [DBG] Hosting started
2025-11-18 15:41:53.585 +03:00 [DBG] Connection id "0HNH6JVD3CSC4" received FIN.
2025-11-18 15:41:53.585 +03:00 [DBG] Connection id "0HNH6JVD3CSC4" accepted.
2025-11-18 15:41:53.595 +03:00 [DBG] Connection id "0HNH6JVD3CSC4" started.
2025-11-18 15:41:53.629 +03:00 [DBG] Failed to authenticate HTTPS connection.
System.IO.IOException: Received an unexpected EOF or 0 bytes from the transport stream.
   at System.Net.Security.SslStream.ReceiveHandshakeFrameAsync[TIOAdapter](CancellationToken cancellationToken)
   at System.Net.Security.SslStream.ForceAuthenticationAsync[TIOAdapter](Boolean receiveFirst, Byte[] reAuthenticationData, CancellationToken cancellationToken)
   at System.Net.Security.SslStream.ProcessAuthenticationWithTelemetryAsync(Boolean isAsync, CancellationToken cancellationToken)
   at Microsoft.AspNetCore.Server.Kestrel.Https.Internal.HttpsConnectionMiddleware.OnConnectionAsync(ConnectionContext context)
2025-11-18 15:41:53.664 +03:00 [DBG] Connection id "0HNH6JVD3CSC4" stopped.
2025-11-18 15:41:53.676 +03:00 [DBG] Connection id "0HNH6JVD3CSC4" sending FIN because: "The Socket transport's send loop completed gracefully."
2025-11-18 15:41:54.217 +03:00 [DBG] Connection id "0HNH6JVD3CSC5" accepted.
2025-11-18 15:41:54.221 +03:00 [DBG] Connection id "0HNH6JVD3CSC5" started.
2025-11-18 15:41:54.316 +03:00 [DBG] Connection 0HNH6JVD3CSC5 established using the following protocol: "Tls13"
2025-11-18 15:41:54.416 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7257/swagger/index.html - null null
2025-11-18 15:41:54.488 +03:00 [DBG] Wildcard detected, all requests with hosts will be allowed.
2025-11-18 15:41:54.513 +03:00 [DBG] No candidates found for the request path '/swagger/index.html'
2025-11-18 15:41:54.519 +03:00 [DBG] Request did not match any endpoints
2025-11-18 15:41:54.631 +03:00 [DBG] Response markup is scheduled to include Browser Link script injection.
2025-11-18 15:41:54.637 +03:00 [DBG] Response markup is scheduled to include browser refresh script injection.
2025-11-18 15:41:54.686 +03:00 [INF] HTTP GET /swagger/index.html responded 200 in 154.7146 ms
2025-11-18 15:41:54.696 +03:00 [DBG] Response markup was updated to include Browser Link script injection.
2025-11-18 15:41:54.700 +03:00 [DBG] Response markup was updated to include browser refresh script injection.
2025-11-18 15:41:54.708 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7257/_framework/aspnetcore-browser-refresh.js - null null
2025-11-18 15:41:54.709 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7257/swagger/index.html - 200 null text/html;charset=utf-8 311.3792ms
2025-11-18 15:41:54.721 +03:00 [DBG] Script injected: /_framework/aspnetcore-browser-refresh.js
2025-11-18 15:41:54.728 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7257/_framework/aspnetcore-browser-refresh.js - 200 16519 application/javascript; charset=utf-8 20.5799ms
2025-11-18 15:41:54.756 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7257/_vs/browserLink - null null
2025-11-18 15:41:54.841 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7257/_vs/browserLink - 200 null text/javascript; charset=UTF-8 84.5478ms
2025-11-18 15:41:54.911 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7257/swagger/v1/swagger.json - null null
2025-11-18 15:41:54.922 +03:00 [DBG] No candidates found for the request path '/swagger/v1/swagger.json'
2025-11-18 15:41:54.925 +03:00 [DBG] Request did not match any endpoints
2025-11-18 15:41:54.966 +03:00 [INF] HTTP GET /swagger/v1/swagger.json responded 200 in 37.7423 ms
2025-11-18 15:41:54.974 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7257/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 64.2219ms
2025-11-18 15:43:02.102 +03:00 [DBG] Connection id "0HNH6JVD3CSC6" accepted.
2025-11-18 15:43:02.103 +03:00 [DBG] Connection id "0HNH6JVD3CSC6" received FIN.
2025-11-18 15:43:02.120 +03:00 [DBG] Connection id "0HNH6JVD3CSC6" started.
2025-11-18 15:43:02.122 +03:00 [DBG] Connection id "0HNH6JVD3CSC7" accepted.
2025-11-18 15:43:02.142 +03:00 [DBG] Failed to authenticate HTTPS connection.
System.IO.IOException: Received an unexpected EOF or 0 bytes from the transport stream.
   at System.Net.Security.SslStream.ReceiveHandshakeFrameAsync[TIOAdapter](CancellationToken cancellationToken)
   at System.Net.Security.SslStream.ForceAuthenticationAsync[TIOAdapter](Boolean receiveFirst, Byte[] reAuthenticationData, CancellationToken cancellationToken)
   at System.Net.Security.SslStream.ProcessAuthenticationWithTelemetryAsync(Boolean isAsync, CancellationToken cancellationToken)
   at Microsoft.AspNetCore.Server.Kestrel.Https.Internal.HttpsConnectionMiddleware.OnConnectionAsync(ConnectionContext context)
2025-11-18 15:43:02.144 +03:00 [DBG] Connection id "0HNH6JVD3CSC7" started.
2025-11-18 15:43:02.148 +03:00 [DBG] Connection id "0HNH6JVD3CSC6" stopped.
2025-11-18 15:43:02.152 +03:00 [DBG] Connection id "0HNH6JVD3CSC6" sending FIN because: "The Socket transport's send loop completed gracefully."
2025-11-18 15:43:02.157 +03:00 [DBG] Connection 0HNH6JVD3CSC7 established using the following protocol: "Tls13"
2025-11-18 15:43:02.166 +03:00 [INF] Request starting HTTP/1.1 POST https://localhost:7257/api/Invoices - application/json 1352
2025-11-18 15:43:02.182 +03:00 [DBG] 1 candidate(s) found for the request path '/api/Invoices'
2025-11-18 15:43:02.193 +03:00 [DBG] Endpoint 'BillingSystem.API.Controllers.InvoicesController.Post (BillingSystem.API)' with route pattern 'api/Invoices' is valid for the request path '/api/Invoices'
2025-11-18 15:43:02.199 +03:00 [DBG] Request matched endpoint 'BillingSystem.API.Controllers.InvoicesController.Post (BillingSystem.API)'
2025-11-18 15:43:02.208 +03:00 [DBG] Static files was skipped as the request already matched an endpoint.
2025-11-18 15:43:02.434 +03:00 [DBG] An 'IServiceProvider' was created for internal use by Entity Framework.
2025-11-18 15:43:07.889 +03:00 [INF] Executing endpoint 'BillingSystem.API.Controllers.InvoicesController.Post (BillingSystem.API)'
2025-11-18 15:43:07.936 +03:00 [INF] Route matched with {action = "Post", controller = "Invoices"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Post(BillingSystem.Application.Requests.CreateInvoiceRequest) on controller BillingSystem.API.Controllers.InvoicesController (BillingSystem.API).
2025-11-18 15:43:07.944 +03:00 [DBG] Execution plan of authorization filters (in the following order): ["None"]
2025-11-18 15:43:07.950 +03:00 [DBG] Execution plan of resource filters (in the following order): ["None"]
2025-11-18 15:43:07.955 +03:00 [DBG] Execution plan of action filters (in the following order): ["Microsoft.AspNetCore.Mvc.ModelBinding.UnsupportedContentTypeFilter (Order: -3000)","Microsoft.AspNetCore.Mvc.Infrastructure.ModelStateInvalidFilter (Order: -2000)","BillingSystem.API.ActionFilters.AuditBillingRequestsFilter","BillingSystem.API.ActionFilters.IdempotencyFilter (Order: 0)"]
2025-11-18 15:43:07.961 +03:00 [DBG] Execution plan of exception filters (in the following order): ["None"]
2025-11-18 15:43:07.965 +03:00 [DBG] Execution plan of result filters (in the following order): ["Microsoft.AspNetCore.Mvc.Infrastructure.ClientErrorResultFilter (Order: -2000)","Microsoft.AspNetCore.Mvc.ProducesAttribute (Order: 0)","BillingSystem.API.ActionFilters.IdempotencyFilter (Order: 0)"]
2025-11-18 15:43:07.972 +03:00 [DBG] Executing controller factory for controller BillingSystem.API.Controllers.InvoicesController (BillingSystem.API)
2025-11-18 15:43:07.980 +03:00 [WRN] You do not have a valid license key for the Lucky Penny software MediatR. This is allowed for development and testing scenarios. If you are running in production you are required to have a licensed version. Please visit https://luckypennysoftware.com to obtain a valid license.
2025-11-18 15:43:08.036 +03:00 [DBG] Executed controller factory for controller BillingSystem.API.Controllers.InvoicesController (BillingSystem.API)
2025-11-18 15:43:08.065 +03:00 [DBG] Attempting to bind parameter 'invoiceRequest' of type 'BillingSystem.Application.Requests.CreateInvoiceRequest' ...
2025-11-18 15:43:08.075 +03:00 [DBG] Attempting to bind parameter 'invoiceRequest' of type 'BillingSystem.Application.Requests.CreateInvoiceRequest' using the name '' in request data ...
2025-11-18 15:43:08.084 +03:00 [DBG] Selected input formatter 'Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonInputFormatter' for content type 'application/json'.
2025-11-18 15:43:08.134 +03:00 [DBG] Connection id "0HNH6JVD3CSC7", Request id "0HNH6JVD3CSC7:00000001": started reading request body.
2025-11-18 15:43:08.143 +03:00 [DBG] Connection id "0HNH6JVD3CSC7", Request id "0HNH6JVD3CSC7:00000001": done reading request body.
2025-11-18 15:43:08.179 +03:00 [DBG] JSON input formatter succeeded, deserializing to type 'BillingSystem.Application.Requests.CreateInvoiceRequest'
2025-11-18 15:43:08.184 +03:00 [DBG] Done attempting to bind parameter 'invoiceRequest' of type 'BillingSystem.Application.Requests.CreateInvoiceRequest'.
2025-11-18 15:43:08.187 +03:00 [DBG] Done attempting to bind parameter 'invoiceRequest' of type 'BillingSystem.Application.Requests.CreateInvoiceRequest'.
2025-11-18 15:43:08.190 +03:00 [DBG] Attempting to validate the bound parameter 'invoiceRequest' of type 'BillingSystem.Application.Requests.CreateInvoiceRequest' ...
2025-11-18 15:43:08.219 +03:00 [DBG] Done attempting to validate the bound parameter 'invoiceRequest' of type 'BillingSystem.Application.Requests.CreateInvoiceRequest'.
2025-11-18 15:43:08.612 +03:00 [DBG] No relationship from 'Invoice' to 'Invoice' has been configured by convention because there are multiple properties on one entity type - {'DiscountedPrimaryInvoice'} that could be matched with the properties on the other entity type - {'InverseDiscountedPrimaryInvoice', 'InversePrimaryInvoice', 'InverseSubstitutionPrimaryInvoice', 'PrimaryInvoice', 'SubstitutionPrimaryInvoice'}. This message can be disregarded if explicit configuration has been specified in 'OnModelCreating'.
2025-11-18 15:43:08.841 +03:00 [DBG] No relationship from 'Invoice' to 'Invoice' has been configured by convention because there are multiple properties on one entity type - {'DiscountedPrimaryInvoice'} that could be matched with the properties on the other entity type - {'InverseDiscountedPrimaryInvoice', 'InversePrimaryInvoice', 'InverseSubstitutionPrimaryInvoice', 'PrimaryInvoice', 'SubstitutionPrimaryInvoice'}. This message can be disregarded if explicit configuration has been specified in 'OnModelCreating'.
2025-11-18 15:43:08.854 +03:00 [DBG] No relationship from 'Invoice' to 'Invoice' has been configured by convention because there are multiple properties on one entity type - {'InversePrimaryInvoice'} that could be matched with the properties on the other entity type - {'InverseSubstitutionPrimaryInvoice', 'PrimaryInvoice', 'SubstitutionPrimaryInvoice'}. This message can be disregarded if explicit configuration has been specified in 'OnModelCreating'.
2025-11-18 15:43:08.864 +03:00 [DBG] No relationship from 'Invoice' to 'Invoice' has been configured by convention because there are multiple properties on one entity type - {'InversePrimaryInvoice'} that could be matched with the properties on the other entity type - {'InverseSubstitutionPrimaryInvoice', 'PrimaryInvoice', 'SubstitutionPrimaryInvoice'}. This message can be disregarded if explicit configuration has been specified in 'OnModelCreating'.
2025-11-18 15:43:09.203 +03:00 [DBG] Entity Framework Core 9.0.9 initialized 'BillingServiceDBContext' using provider 'Microsoft.EntityFrameworkCore.SqlServer:9.0.9' with options: EngineType=SqlServer 
2025-11-18 15:43:09.351 +03:00 [DBG] Compiling query expression: 
'DbSet<Invoice>()
    .AsNoTracking()
    .Any(inv => inv.ExternalId.ToString() == __idempotentKey_0)'
2025-11-18 15:43:09.657 +03:00 [DBG] Generated query execution expression: 
'queryContext => ShapedQueryCompilingExpressionVisitor.SingleAsync<bool>(
    asyncEnumerable: SingleQueryingEnumerable.Create<bool>(
        relationalQueryContext: (RelationalQueryContext)queryContext, 
        relationalCommandResolver: parameters => [LIFTABLE Constant: RelationalCommandCache.QueryExpression(
            Projection Mapping:
                EmptyProjectionMember -> 0
            SELECT EXISTS (
                SELECT 1
                FROM Invoices AS i
                WHERE COALESCE(CONVERT(varchar(36), i.ExternalId), '') == @__idempotentKey_0)) | Resolver: c => new RelationalCommandCache(
            c.Dependencies.MemoryCache, 
            c.RelationalDependencies.QuerySqlGeneratorFactory, 
            c.RelationalDependencies.RelationalParameterBasedSqlProcessorFactory, 
            Projection Mapping:
                EmptyProjectionMember -> 0
            SELECT EXISTS (
                SELECT 1
                FROM Invoices AS i
                WHERE COALESCE(CONVERT(varchar(36), i.ExternalId), '') == @__idempotentKey_0), 
            False, 
            new HashSet<string>(
                new string[]{ }, 
                StringComparer.Ordinal
            )
        )].GetRelationalCommandTemplate(parameters), 
        readerColumns: null, 
        shaper: (queryContext, dataReader, resultContext, resultCoordinator) => 
        {
            bool? value1;
            value1 = dataReader.IsDBNull(0) ? default(bool?) : (bool?)dataReader.GetBoolean(0);
            return (bool)value1;
        }, 
        contextType: BillingSystem.Infrastructure.EF.BillingServiceDBContext, 
        standAloneStateManager: False, 
        detailedErrorsEnabled: False, 
        threadSafetyChecksEnabled: True), 
    cancellationToken: queryContext.CancellationToken)'
2025-11-18 15:43:09.762 +03:00 [DBG] Creating DbConnection.
2025-11-18 15:43:09.807 +03:00 [DBG] Created DbConnection. (42ms).
2025-11-18 15:43:09.819 +03:00 [DBG] Opening connection to database 'GAC-BillingService' on server '.'.
2025-11-18 15:43:10.147 +03:00 [DBG] Opened connection to database 'GAC-BillingService' on server '.'.
2025-11-18 15:43:10.158 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-11-18 15:43:10.171 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (10ms).
2025-11-18 15:43:10.194 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (37ms).
2025-11-18 15:43:10.214 +03:00 [DBG] Executing DbCommand [Parameters=[@__idempotentKey_0='?' (Size = 36) (DbType = AnsiString)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [Invoices] AS [i]
        WHERE CONVERT(varchar(36), [i].[ExternalId]) = @__idempotentKey_0) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2025-11-18 15:43:10.302 +03:00 [INF] Executed DbCommand (92ms) [Parameters=[@__idempotentKey_0='?' (Size = 36) (DbType = AnsiString)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [Invoices] AS [i]
        WHERE CONVERT(varchar(36), [i].[ExternalId]) = @__idempotentKey_0) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2025-11-18 15:43:10.336 +03:00 [DBG] Closing data reader to 'GAC-BillingService' on server '.'.
2025-11-18 15:43:10.359 +03:00 [DBG] A data reader for 'GAC-BillingService' on server '.' is being disposed after spending 40ms reading results.
2025-11-18 15:43:10.371 +03:00 [DBG] Closing connection to database 'GAC-BillingService' on server '.'.
2025-11-18 15:43:10.388 +03:00 [DBG] Closed connection to database 'GAC-BillingService' on server '.' (17ms).
2025-11-18 15:43:10.397 +03:00 [DBG] Request was short circuited at action filter 'BillingSystem.API.ActionFilters.IdempotencyFilter'.
2025-11-18 15:43:10.424 +03:00 [DBG] List of registered output formatters, in the following order: ["Microsoft.AspNetCore.Mvc.Formatters.HttpNoContentOutputFormatter","Microsoft.AspNetCore.Mvc.Formatters.StringOutputFormatter","Microsoft.AspNetCore.Mvc.Formatters.StreamOutputFormatter","Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonOutputFormatter"]
2025-11-18 15:43:10.436 +03:00 [DBG] No information found on request to perform content negotiation.
2025-11-18 15:43:10.441 +03:00 [DBG] Attempting to select the first output formatter in the output formatters list which supports a content type from the explicitly specified content types '["application/json"]'.
2025-11-18 15:43:10.446 +03:00 [DBG] Selected output formatter 'Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonOutputFormatter' and content type 'application/json' to write the response.
2025-11-18 15:43:10.449 +03:00 [INF] Executing ConflictObjectResult, writing value of type 'System.String'.
2025-11-18 15:43:10.464 +03:00 [INF] Executed action BillingSystem.API.Controllers.InvoicesController.Post (BillingSystem.API) in 2490.4042ms
2025-11-18 15:43:10.472 +03:00 [INF] Executed endpoint 'BillingSystem.API.Controllers.InvoicesController.Post (BillingSystem.API)'
2025-11-18 15:43:10.478 +03:00 [INF] HTTP POST /api/Invoices responded 409 in 8270.8517 ms
2025-11-18 15:43:10.485 +03:00 [DBG] Connection id "0HNH6JVD3CSC7" completed keep alive response.
2025-11-18 15:43:10.494 +03:00 [DBG] 'BillingServiceDBContext' disposed.
2025-11-18 15:43:10.507 +03:00 [DBG] Disposing connection to database 'GAC-BillingService' on server '.'.
2025-11-18 15:43:10.517 +03:00 [DBG] Disposed connection to database '' on server '' (11ms).
2025-11-18 15:43:10.524 +03:00 [INF] Request finished HTTP/1.1 POST https://localhost:7257/api/Invoices - 409 null application/json; charset=utf-8 8358.0765ms
2025-11-18 15:44:31.025 +03:00 [DBG] Connection id "0HNH6JVD3CSC8" accepted.
2025-11-18 15:44:31.026 +03:00 [DBG] Connection id "0HNH6JVD3CSC8" received FIN.
2025-11-18 15:44:31.029 +03:00 [DBG] Connection id "0HNH6JVD3CSC8" started.
2025-11-18 15:44:31.031 +03:00 [DBG] Connection id "0HNH6JVD3CSC9" accepted.
2025-11-18 15:44:31.037 +03:00 [DBG] Failed to authenticate HTTPS connection.
System.IO.IOException: Received an unexpected EOF or 0 bytes from the transport stream.
   at System.Net.Security.SslStream.ReceiveHandshakeFrameAsync[TIOAdapter](CancellationToken cancellationToken)
   at System.Net.Security.SslStream.ForceAuthenticationAsync[TIOAdapter](Boolean receiveFirst, Byte[] reAuthenticationData, CancellationToken cancellationToken)
   at System.Net.Security.SslStream.ProcessAuthenticationWithTelemetryAsync(Boolean isAsync, CancellationToken cancellationToken)
   at Microsoft.AspNetCore.Server.Kestrel.Https.Internal.HttpsConnectionMiddleware.OnConnectionAsync(ConnectionContext context)
2025-11-18 15:44:31.038 +03:00 [DBG] Connection id "0HNH6JVD3CSC9" started.
2025-11-18 15:44:31.044 +03:00 [DBG] Connection id "0HNH6JVD3CSC8" stopped.
2025-11-18 15:44:31.049 +03:00 [DBG] Connection id "0HNH6JVD3CSC8" sending FIN because: "The Socket transport's send loop completed gracefully."
2025-11-18 15:44:31.054 +03:00 [DBG] Connection 0HNH6JVD3CSC9 established using the following protocol: "Tls13"
2025-11-18 15:44:31.060 +03:00 [INF] Request starting HTTP/1.1 POST https://localhost:7257/api/Invoices - application/json 1352
2025-11-18 15:44:31.065 +03:00 [DBG] 1 candidate(s) found for the request path '/api/Invoices'
2025-11-18 15:44:31.067 +03:00 [DBG] Endpoint 'BillingSystem.API.Controllers.InvoicesController.Post (BillingSystem.API)' with route pattern 'api/Invoices' is valid for the request path '/api/Invoices'
2025-11-18 15:44:31.071 +03:00 [DBG] Request matched endpoint 'BillingSystem.API.Controllers.InvoicesController.Post (BillingSystem.API)'
2025-11-18 15:44:31.076 +03:00 [DBG] Static files was skipped as the request already matched an endpoint.
2025-11-18 15:44:31.083 +03:00 [INF] Executing endpoint 'BillingSystem.API.Controllers.InvoicesController.Post (BillingSystem.API)'
2025-11-18 15:44:31.087 +03:00 [INF] Route matched with {action = "Post", controller = "Invoices"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Post(BillingSystem.Application.Requests.CreateInvoiceRequest) on controller BillingSystem.API.Controllers.InvoicesController (BillingSystem.API).
2025-11-18 15:44:31.091 +03:00 [DBG] Execution plan of authorization filters (in the following order): ["None"]
2025-11-18 15:44:31.094 +03:00 [DBG] Execution plan of resource filters (in the following order): ["None"]
2025-11-18 15:44:31.098 +03:00 [DBG] Execution plan of action filters (in the following order): ["Microsoft.AspNetCore.Mvc.ModelBinding.UnsupportedContentTypeFilter (Order: -3000)","Microsoft.AspNetCore.Mvc.Infrastructure.ModelStateInvalidFilter (Order: -2000)","BillingSystem.API.ActionFilters.AuditBillingRequestsFilter","BillingSystem.API.ActionFilters.IdempotencyFilter (Order: 0)"]
2025-11-18 15:44:31.103 +03:00 [DBG] Execution plan of exception filters (in the following order): ["None"]
2025-11-18 15:44:31.108 +03:00 [DBG] Execution plan of result filters (in the following order): ["Microsoft.AspNetCore.Mvc.Infrastructure.ClientErrorResultFilter (Order: -2000)","Microsoft.AspNetCore.Mvc.ProducesAttribute (Order: 0)","BillingSystem.API.ActionFilters.IdempotencyFilter (Order: 0)"]
2025-11-18 15:44:31.114 +03:00 [DBG] Executing controller factory for controller BillingSystem.API.Controllers.InvoicesController (BillingSystem.API)
2025-11-18 15:44:31.120 +03:00 [DBG] Executed controller factory for controller BillingSystem.API.Controllers.InvoicesController (BillingSystem.API)
2025-11-18 15:44:31.126 +03:00 [DBG] Attempting to bind parameter 'invoiceRequest' of type 'BillingSystem.Application.Requests.CreateInvoiceRequest' ...
2025-11-18 15:44:31.131 +03:00 [DBG] Attempting to bind parameter 'invoiceRequest' of type 'BillingSystem.Application.Requests.CreateInvoiceRequest' using the name '' in request data ...
2025-11-18 15:44:31.135 +03:00 [DBG] Selected input formatter 'Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonInputFormatter' for content type 'application/json'.
2025-11-18 15:44:31.140 +03:00 [DBG] Connection id "0HNH6JVD3CSC9", Request id "0HNH6JVD3CSC9:00000001": started reading request body.
2025-11-18 15:44:31.145 +03:00 [DBG] Connection id "0HNH6JVD3CSC9", Request id "0HNH6JVD3CSC9:00000001": done reading request body.
2025-11-18 15:44:31.148 +03:00 [DBG] JSON input formatter succeeded, deserializing to type 'BillingSystem.Application.Requests.CreateInvoiceRequest'
2025-11-18 15:44:31.152 +03:00 [DBG] Done attempting to bind parameter 'invoiceRequest' of type 'BillingSystem.Application.Requests.CreateInvoiceRequest'.
2025-11-18 15:44:31.155 +03:00 [DBG] Done attempting to bind parameter 'invoiceRequest' of type 'BillingSystem.Application.Requests.CreateInvoiceRequest'.
2025-11-18 15:44:31.160 +03:00 [DBG] Attempting to validate the bound parameter 'invoiceRequest' of type 'BillingSystem.Application.Requests.CreateInvoiceRequest' ...
2025-11-18 15:44:31.165 +03:00 [DBG] Done attempting to validate the bound parameter 'invoiceRequest' of type 'BillingSystem.Application.Requests.CreateInvoiceRequest'.
2025-11-18 15:44:31.211 +03:00 [DBG] Entity Framework Core 9.0.9 initialized 'BillingServiceDBContext' using provider 'Microsoft.EntityFrameworkCore.SqlServer:9.0.9' with options: EngineType=SqlServer 
2025-11-18 15:44:31.222 +03:00 [DBG] Creating DbConnection.
2025-11-18 15:44:31.229 +03:00 [DBG] Created DbConnection. (6ms).
2025-11-18 15:44:31.233 +03:00 [DBG] Opening connection to database 'GAC-BillingService' on server '.'.
2025-11-18 15:44:31.238 +03:00 [DBG] Opened connection to database 'GAC-BillingService' on server '.'.
2025-11-18 15:44:31.241 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-11-18 15:44:31.244 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (3ms).
2025-11-18 15:44:31.247 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (6ms).
2025-11-18 15:44:31.253 +03:00 [DBG] Executing DbCommand [Parameters=[@__idempotentKey_0='?' (Size = 36) (DbType = AnsiString)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [Invoices] AS [i]
        WHERE CONVERT(varchar(36), [i].[ExternalId]) = @__idempotentKey_0) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2025-11-18 15:44:31.271 +03:00 [INF] Executed DbCommand (18ms) [Parameters=[@__idempotentKey_0='?' (Size = 36) (DbType = AnsiString)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [Invoices] AS [i]
        WHERE CONVERT(varchar(36), [i].[ExternalId]) = @__idempotentKey_0) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2025-11-18 15:44:31.277 +03:00 [DBG] Closing data reader to 'GAC-BillingService' on server '.'.
2025-11-18 15:44:31.279 +03:00 [DBG] A data reader for 'GAC-BillingService' on server '.' is being disposed after spending 3ms reading results.
2025-11-18 15:44:31.283 +03:00 [DBG] Closing connection to database 'GAC-BillingService' on server '.'.
2025-11-18 15:44:31.286 +03:00 [DBG] Closed connection to database 'GAC-BillingService' on server '.' (3ms).
2025-11-18 15:44:31.535 +03:00 [WRN] You do not have a valid license key for the Lucky Penny software AutoMapper. This is allowed for development and testing scenarios. If you are running in production you are required to have a licensed version. Please visit https://luckypennysoftware.com to obtain a valid license.
2025-11-18 15:44:39.668 +03:00 [DBG] Opening connection to database 'GAC-BillingService' on server '.'.
2025-11-18 15:44:39.674 +03:00 [DBG] Opened connection to database 'GAC-BillingService' on server '.'.
2025-11-18 15:44:39.680 +03:00 [DBG] Beginning transaction with isolation level 'Unspecified'.
2025-11-18 15:44:39.695 +03:00 [DBG] Began transaction with isolation level 'ReadCommitted'.
2025-11-18 15:44:39.705 +03:00 [DBG] Compiling query expression: 
'DbSet<InvoiceSequenceValue>().FromSql(EXECUTE dbo.GetNextInvoiceNumber, __p_0)
'
2025-11-18 15:44:39.769 +03:00 [DBG] Generated query execution expression: 
'queryContext => FromSqlQueryingEnumerable.Create<InvoiceSequenceValue>(
    relationalQueryContext: (RelationalQueryContext)queryContext, 
    relationalCommandResolver: parameters => [LIFTABLE Constant: RelationalCommandCache.QueryExpression(
        Projection Mapping:
            EmptyProjectionMember -> Dictionary<IProperty, int> { [Property: InvoiceSequenceValue.Value (long) Required, 0] }
        SELECT b.Value
        FROM EXECUTE dbo.GetNextInvoiceNumber) | Resolver: c => new RelationalCommandCache(
        c.Dependencies.MemoryCache, 
        c.RelationalDependencies.QuerySqlGeneratorFactory, 
        c.RelationalDependencies.RelationalParameterBasedSqlProcessorFactory, 
        Projection Mapping:
            EmptyProjectionMember -> Dictionary<IProperty, int> { [Property: InvoiceSequenceValue.Value (long) Required, 0] }
        SELECT b.Value
        FROM EXECUTE dbo.GetNextInvoiceNumber, 
        False, 
        new HashSet<string>(
            new string[]{ }, 
            StringComparer.Ordinal
        )
    )].GetRelationalCommandTemplate(parameters), 
    readerColumns: null, 
    columnNames: [LIFTABLE Constant: string[] { "Value" } | Resolver: _ => new string[]{ "Value" }], 
    shaper: (queryContext, dataReader, indexMap) => 
    {
        InvoiceSequenceValue entity;
        entity = 
        {
            MaterializationContext materializationContext1;
            IEntityType entityType1;
            InvoiceSequenceValue instance1;
            materializationContext1 = new MaterializationContext(
                [LIFTABLE Constant: ValueBuffer | Resolver: _ => (object)ValueBuffer.Empty], 
                queryContext.Context
            );
            instance1 = default(InvoiceSequenceValue);
            {
                ISnapshot shadowSnapshot1;
                shadowSnapshot1 = [LIFTABLE Constant: Snapshot | Resolver: _ => Snapshot.Empty];
                entityType1 = [LIFTABLE Constant: EntityType: InvoiceSequenceValue Keyless | Resolver: namelessParameter{0} => namelessParameter{0}.Dependencies.Model.FindEntityType("BillingSystem.Domain.Entities.InvoiceSequenceValue")];
                instance1 = switch (entityType1)
                {
                    case [LIFTABLE Constant: EntityType: InvoiceSequenceValue Keyless | Resolver: namelessParameter{1} => namelessParameter{1}.Dependencies.Model.FindEntityType("BillingSystem.Domain.Entities.InvoiceSequenceValue")]: 
                        {
                            return 
                            {
                                InvoiceSequenceValue instance;
                                instance = new InvoiceSequenceValue();
                                instance.<Value>k__BackingField = dataReader.GetInt64(indexMap[0]);
                                (instance is IInjectableService) ? ((IInjectableService)instance).Injected(
                                    context: materializationContext1.Context, 
                                    entity: instance, 
                                    queryTrackingBehavior: TrackAll, 
                                    structuralType: [LIFTABLE Constant: EntityType: InvoiceSequenceValue Keyless | Resolver: namelessParameter{2} => namelessParameter{2}.Dependencies.Model.FindEntityType("BillingSystem.Domain.Entities.InvoiceSequenceValue")]) : default(void);
                                return instance;
                            }}
                    default: 
                        default(InvoiceSequenceValue)
                }
                ;
                return instance1;
            }return instance1;
        };
        return entity;
    }, 
    contextType: BillingSystem.Infrastructure.EF.BillingServiceDBContext, 
    standAloneStateManager: False, 
    detailedErrorsEnabled: False, 
    threadSafetyChecksEnabled: True)'
2025-11-18 15:44:39.783 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-11-18 15:44:39.786 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (2ms).
2025-11-18 15:44:39.792 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (9ms).
2025-11-18 15:44:39.798 +03:00 [DBG] Executing DbCommand [Parameters=[], CommandType='"Text"', CommandTimeout='30']
EXECUTE dbo.GetNextInvoiceNumber
2025-11-18 15:44:39.807 +03:00 [INF] Executed DbCommand (9ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
EXECUTE dbo.GetNextInvoiceNumber
2025-11-18 15:44:39.816 +03:00 [DBG] Closing data reader to 'GAC-BillingService' on server '.'.
2025-11-18 15:44:39.820 +03:00 [DBG] A data reader for 'GAC-BillingService' on server '.' is being disposed after spending 7ms reading results.
2025-11-18 15:44:39.828 +03:00 [DBG] Compiling query expression: 
'DbSet<Customer>()
    .FirstOrDefault(c => c.IdentityNumber == __cutomerIdentityNumber_0)'
2025-11-18 15:44:39.849 +03:00 [DBG] Generated query execution expression: 
'queryContext => SingleQueryingEnumerable.Create<Customer>(
    relationalQueryContext: (RelationalQueryContext)queryContext, 
    relationalCommandResolver: parameters => [LIFTABLE Constant: RelationalCommandCache.QueryExpression(
        Projection Mapping:
            EmptyProjectionMember -> Dictionary<IProperty, int> { [Property: Customer.Id (long) Required PK AfterSave:Throw ValueGenerated.OnAdd, 0], [Property: Customer.AddressBuildingNumber (string) MaxLength(200), 1], [Property: Customer.AddressCity (string) Required MaxLength(200), 2], [Property: Customer.AddressCountry (string) Required MaxLength(200), 3], [Property: Customer.AddressDistrict (string) Required MaxLength(200), 4], [Property: Customer.AddressPostalCode (string) Required MaxLength(50), 5], [Property: Customer.AddressStreet (string) MaxLength(200), 6], [Property: Customer.AddressSubNumber (string) MaxLength(200), 7], [Property: Customer.CreatedBy (string) Required MaxLength(50), 8], [Property: Customer.CreatedDate (DateTime) Required, 9], [Property: Customer.CustomerType (string) Required MaxLength(100), 10], [Property: Customer.EmailAddress (string) MaxLength(80), 11], [Property: Customer.FullName (string) Required MaxLength(500), 12], [Property: Customer.IdentityNumber (string) Required MaxLength(100), 13], [Property: Customer.IdentityType (int?), 14], [Property: Customer.IsDeleted (bool) Required, 15], [Property: Customer.LastUpdatedDate (DateTime?), 16], [Property: Customer.OverpaymentBalance (decimal?), 17], [Property: Customer.PhoneNumber (string) MaxLength(50), 18], [Property: Customer.Vatnumber (string) MaxLength(100), 19] }
        SELECT TOP(1) c.Id, c.Address_BuildingNumber, c.Address_City, c.Address_Country, c.Address_District, c.Address_PostalCode, c.Address_Street, c.Address_SubNumber, c.CreatedBy, c.CreatedDate, c.CustomerType, c.EmailAddress, c.FullName, c.IdentityNumber, c.IdentityType, c.IsDeleted, c.LastUpdatedDate, c.OverpaymentBalance, c.PhoneNumber, c.VATNumber
        FROM Customers AS c
        WHERE c.IdentityNumber == @__cutomerIdentityNumber_0) | Resolver: c => new RelationalCommandCache(
        c.Dependencies.MemoryCache, 
        c.RelationalDependencies.QuerySqlGeneratorFactory, 
        c.RelationalDependencies.RelationalParameterBasedSqlProcessorFactory, 
        Projection Mapping:
            EmptyProjectionMember -> Dictionary<IProperty, int> { [Property: Customer.Id (long) Required PK AfterSave:Throw ValueGenerated.OnAdd, 0], [Property: Customer.AddressBuildingNumber (string) MaxLength(200), 1], [Property: Customer.AddressCity (string) Required MaxLength(200), 2], [Property: Customer.AddressCountry (string) Required MaxLength(200), 3], [Property: Customer.AddressDistrict (string) Required MaxLength(200), 4], [Property: Customer.AddressPostalCode (string) Required MaxLength(50), 5], [Property: Customer.AddressStreet (string) MaxLength(200), 6], [Property: Customer.AddressSubNumber (string) MaxLength(200), 7], [Property: Customer.CreatedBy (string) Required MaxLength(50), 8], [Property: Customer.CreatedDate (DateTime) Required, 9], [Property: Customer.CustomerType (string) Required MaxLength(100), 10], [Property: Customer.EmailAddress (string) MaxLength(80), 11], [Property: Customer.FullName (string) Required MaxLength(500), 12], [Property: Customer.IdentityNumber (string) Required MaxLength(100), 13], [Property: Customer.IdentityType (int?), 14], [Property: Customer.IsDeleted (bool) Required, 15], [Property: Customer.LastUpdatedDate (DateTime?), 16], [Property: Customer.OverpaymentBalance (decimal?), 17], [Property: Customer.PhoneNumber (string) MaxLength(50), 18], [Property: Customer.Vatnumber (string) MaxLength(100), 19] }
        SELECT TOP(1) c.Id, c.Address_BuildingNumber, c.Address_City, c.Address_Country, c.Address_District, c.Address_PostalCode, c.Address_Street, c.Address_SubNumber, c.CreatedBy, c.CreatedDate, c.CustomerType, c.EmailAddress, c.FullName, c.IdentityNumber, c.IdentityType, c.IsDeleted, c.LastUpdatedDate, c.OverpaymentBalance, c.PhoneNumber, c.VATNumber
        FROM Customers AS c
        WHERE c.IdentityNumber == @__cutomerIdentityNumber_0, 
        False, 
        new HashSet<string>(
            new string[]{ }, 
            StringComparer.Ordinal
        )
    )].GetRelationalCommandTemplate(parameters), 
    readerColumns: null, 
    shaper: (queryContext, dataReader, resultContext, resultCoordinator) => 
    {
        Customer entity;
        entity = 
        {
            MaterializationContext materializationContext1;
            IEntityType entityType1;
            Customer instance1;
            InternalEntityEntry entry1;
            bool hasNullKey1;
            materializationContext1 = new MaterializationContext(
                [LIFTABLE Constant: ValueBuffer | Resolver: _ => (object)ValueBuffer.Empty], 
                queryContext.Context
            );
            instance1 = default(Customer);
            entry1 = queryContext.TryGetEntry(
                key: [LIFTABLE Constant: Key: Customer.Id PK | Resolver: c => c.Dependencies.Model.FindEntityType("BillingSystem.Domain.Entities.Customer").FindPrimaryKey()], 
                keyValues: new object[]{ (object)dataReader.GetInt64(0) }, 
                throwOnNullKey: True, 
                hasNullKey: hasNullKey1);
            !(hasNullKey1) ? entry1 != default(InternalEntityEntry) ? 
            {
                entityType1 = entry1.EntityType;
                return instance1 = (Customer)entry1.Entity;
            } : 
            {
                ISnapshot shadowSnapshot1;
                shadowSnapshot1 = [LIFTABLE Constant: Snapshot | Resolver: _ => Snapshot.Empty];
                entityType1 = [LIFTABLE Constant: EntityType: Customer | Resolver: namelessParameter{0} => namelessParameter{0}.Dependencies.Model.FindEntityType("BillingSystem.Domain.Entities.Customer")];
                instance1 = switch (entityType1)
                {
                    case [LIFTABLE Constant: EntityType: Customer | Resolver: namelessParameter{1} => namelessParameter{1}.Dependencies.Model.FindEntityType("BillingSystem.Domain.Entities.Customer")]: 
                        {
                            return 
                            {
                                Customer instance;
                                instance = new Customer();
                                instance.<Id>k__BackingField = dataReader.GetInt64(0);
                                instance.<AddressBuildingNumber>k__BackingField = dataReader.IsDBNull(1) ? default(string) : dataReader.GetString(1);
                                instance.<AddressCity>k__BackingField = dataReader.GetString(2);
                                instance.<AddressCountry>k__BackingField = dataReader.GetString(3);
                                instance.<AddressDistrict>k__BackingField = dataReader.GetString(4);
                                instance.<AddressPostalCode>k__BackingField = dataReader.GetString(5);
                                instance.<AddressStreet>k__BackingField = dataReader.IsDBNull(6) ? default(string) : dataReader.GetString(6);
                                instance.<AddressSubNumber>k__BackingField = dataReader.IsDBNull(7) ? default(string) : dataReader.GetString(7);
                                instance.<CreatedBy>k__BackingField = dataReader.GetString(8);
                                instance.<CreatedDate>k__BackingField = dataReader.GetDateTime(9);
                                instance.<CustomerType>k__BackingField = dataReader.GetString(10);
                                instance.<EmailAddress>k__BackingField = dataReader.IsDBNull(11) ? default(string) : dataReader.GetString(11);
                                instance.<FullName>k__BackingField = dataReader.GetString(12);
                                instance.<IdentityNumber>k__BackingField = dataReader.GetString(13);
                                instance.<IdentityType>k__BackingField = dataReader.IsDBNull(14) ? default(int?) : (int?)dataReader.GetInt32(14);
                                instance.<IsDeleted>k__BackingField = dataReader.GetBoolean(15);
                                instance.<LastUpdatedDate>k__BackingField = dataReader.IsDBNull(16) ? default(DateTime?) : (DateTime?)dataReader.GetDateTime(16);
                                instance.<OverpaymentBalance>k__BackingField = dataReader.IsDBNull(17) ? default(decimal?) : (decimal?)dataReader.GetDecimal(17);
                                instance.<PhoneNumber>k__BackingField = dataReader.IsDBNull(18) ? default(string) : dataReader.GetString(18);
                                instance.<Vatnumber>k__BackingField = dataReader.IsDBNull(19) ? default(string) : dataReader.GetString(19);
                                (instance is IInjectableService) ? ((IInjectableService)instance).Injected(
                                    context: materializationContext1.Context, 
                                    entity: instance, 
                                    queryTrackingBehavior: TrackAll, 
                                    structuralType: [LIFTABLE Constant: EntityType: Customer | Resolver: namelessParameter{2} => namelessParameter{2}.Dependencies.Model.FindEntityType("BillingSystem.Domain.Entities.Customer")]) : default(void);
                                return instance;
                            }}
                    default: 
                        default(Customer)
                }
                ;
                entry1 = entityType1 == default(IEntityType) ? default(InternalEntityEntry) : queryContext.StartTracking(
                    entityType: entityType1, 
                    entity: instance1, 
                    snapshot: shadowSnapshot1);
                return instance1;
            } : default(void);
            return instance1;
        };
        return entity;
    }, 
    contextType: BillingSystem.Infrastructure.EF.BillingServiceDBContext, 
    standAloneStateManager: False, 
    detailedErrorsEnabled: False, 
    threadSafetyChecksEnabled: True)
    .SingleOrDefault()'
2025-11-18 15:44:39.866 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-11-18 15:44:39.869 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (3ms).
2025-11-18 15:44:39.874 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (8ms).
2025-11-18 15:44:39.878 +03:00 [DBG] Executing DbCommand [Parameters=[@__cutomerIdentityNumber_0='?' (Size = 100)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[Id], [c].[Address_BuildingNumber], [c].[Address_City], [c].[Address_Country], [c].[Address_District], [c].[Address_PostalCode], [c].[Address_Street], [c].[Address_SubNumber], [c].[CreatedBy], [c].[CreatedDate], [c].[CustomerType], [c].[EmailAddress], [c].[FullName], [c].[IdentityNumber], [c].[IdentityType], [c].[IsDeleted], [c].[LastUpdatedDate], [c].[OverpaymentBalance], [c].[PhoneNumber], [c].[VATNumber]
FROM [Customers] AS [c]
WHERE [c].[IdentityNumber] = @__cutomerIdentityNumber_0
2025-11-18 15:44:39.885 +03:00 [INF] Executed DbCommand (7ms) [Parameters=[@__cutomerIdentityNumber_0='?' (Size = 100)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[Id], [c].[Address_BuildingNumber], [c].[Address_City], [c].[Address_Country], [c].[Address_District], [c].[Address_PostalCode], [c].[Address_Street], [c].[Address_SubNumber], [c].[CreatedBy], [c].[CreatedDate], [c].[CustomerType], [c].[EmailAddress], [c].[FullName], [c].[IdentityNumber], [c].[IdentityType], [c].[IsDeleted], [c].[LastUpdatedDate], [c].[OverpaymentBalance], [c].[PhoneNumber], [c].[VATNumber]
FROM [Customers] AS [c]
WHERE [c].[IdentityNumber] = @__cutomerIdentityNumber_0
2025-11-18 15:44:39.935 +03:00 [DBG] Context 'BillingServiceDBContext' started tracking 'Customer' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-11-18 15:44:40.004 +03:00 [DBG] Closing data reader to 'GAC-BillingService' on server '.'.
2025-11-18 15:44:40.011 +03:00 [DBG] A data reader for 'GAC-BillingService' on server '.' is being disposed after spending 120ms reading results.
2025-11-18 15:44:40.044 +03:00 [DBG] 'BillingServiceDBContext' generated a temporary value for the property 'Customer.Id'. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-11-18 15:44:40.063 +03:00 [DBG] Context 'BillingServiceDBContext' started tracking 'Customer' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-11-18 15:44:40.126 +03:00 [ERR] exception occured The property 'Customer.Id' has a temporary value while attempting to change the entity's state to 'Modified'. Either set a permanent value explicitly, or ensure that the database is configured to generate values for this property. , stackTrace    at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.InternalEntityEntry.SetEntityState(EntityState oldState, EntityState newState, Boolean acceptChanges, Boolean modifyProperties)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.InternalEntityEntry.SetEntityState(EntityState entityState, Boolean acceptChanges, Boolean modifyProperties, Nullable`1 forceStateWhenUnknownKey, Nullable`1 fallbackState)
   at Microsoft.EntityFrameworkCore.ChangeTracking.EntityEntry.set_State(EntityState value)
   at BillingSystem.Infrastructure.Persistence.EF.InvoiceRepository.InsertTransactional(Invoice entity, OutboxEvent outboxEvent, AuditEvent auditEvent) in C:\Repositories\Gac-BillingSystem\src\BillingSystem.Infrastructure\Persistence\EF\InvoiceRepository.cs:line 81
2025-11-18 15:44:40.140 +03:00 [DBG] Rolling back transaction.
2025-11-18 15:44:40.158 +03:00 [DBG] Rolled back transaction.
2025-11-18 15:44:40.167 +03:00 [DBG] Closing connection to database 'GAC-BillingService' on server '.'.
2025-11-18 15:44:40.173 +03:00 [DBG] Closed connection to database 'GAC-BillingService' on server '.' (6ms).
2025-11-18 15:44:40.210 +03:00 [DBG] Disposing transaction.
2025-11-18 15:52:07.534 +03:00 [DBG] Registered model binder providers, in the following order: ["Microsoft.AspNetCore.Mvc.ModelBinding.Binders.BinderTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ServicesModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.BodyModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.HeaderModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FloatingPointTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.EnumTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.DateTimeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.SimpleTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.TryParseModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.CancellationTokenModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ByteArrayModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FormFileModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FormCollectionModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.KeyValuePairModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.DictionaryModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ArrayModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.CollectionModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ComplexObjectModelBinderProvider"]
2025-11-18 15:52:08.040 +03:00 [DBG] Hosting starting
2025-11-18 15:52:08.586 +03:00 [DBG] Starting bus instances: IBus
2025-11-18 15:52:08.603 +03:00 [DBG] Starting bus: "rabbitmq://localhost/"
2025-11-18 15:52:08.656 +03:00 [DBG] Middleware loaded
2025-11-18 15:52:08.668 +03:00 [DBG] Middleware loaded. Script /_framework/aspnetcore-browser-refresh.js (16519 B).
2025-11-18 15:52:08.687 +03:00 [DBG] Middleware loaded. Script /_framework/blazor-hotreload.js (799 B).
2025-11-18 15:52:08.695 +03:00 [DBG] Connect: guest@localhost:5672/
2025-11-18 15:52:08.907 +03:00 [DBG] Middleware loaded: DOTNET_MODIFIABLE_ASSEMBLIES=debug, __ASPNETCORE_BROWSER_TOOLS=true
2025-11-18 15:52:08.939 +03:00 [DBG] Connected: guest@localhost:5672/ (address: amqp://localhost:5672, local: 64255)
2025-11-18 15:52:09.026 +03:00 [DBG] Endpoint Ready: "rabbitmq://localhost/ECHGHANNAMLP1_BillingSystemAPI_bus_fbfyyyyh3bcsyarebdxnpekefx?temporary=true"
2025-11-18 15:52:09.033 +03:00 [INF] Bus started: "rabbitmq://localhost/"
2025-11-18 15:52:09.345 +03:00 [INF] Now listening on: https://localhost:7257
2025-11-18 15:52:09.352 +03:00 [INF] Now listening on: http://localhost:5009
2025-11-18 15:52:09.355 +03:00 [DBG] Loaded hosting startup assembly BillingSystem.API
2025-11-18 15:52:09.359 +03:00 [DBG] Loaded hosting startup assembly Microsoft.WebTools.ApiEndpointDiscovery
2025-11-18 15:52:09.363 +03:00 [DBG] Loaded hosting startup assembly Microsoft.AspNetCore.Watch.BrowserRefresh
2025-11-18 15:52:09.368 +03:00 [DBG] Loaded hosting startup assembly Microsoft.WebTools.BrowserLink.Net
2025-11-18 15:52:09.548 +03:00 [DBG] Connection id "0HNH6K54LLOJ3" accepted.
2025-11-18 15:52:09.556 +03:00 [DBG] Connection id "0HNH6K54LLOJ3" received FIN.
2025-11-18 15:52:09.557 +03:00 [DBG] Connection id "0HNH6K54LLOJ3" started.
2025-11-18 15:52:09.608 +03:00 [DBG] Failed to authenticate HTTPS connection.
System.IO.IOException: Received an unexpected EOF or 0 bytes from the transport stream.
   at System.Net.Security.SslStream.ReceiveHandshakeFrameAsync[TIOAdapter](CancellationToken cancellationToken)
   at System.Net.Security.SslStream.ForceAuthenticationAsync[TIOAdapter](Boolean receiveFirst, Byte[] reAuthenticationData, CancellationToken cancellationToken)
   at System.Net.Security.SslStream.ProcessAuthenticationWithTelemetryAsync(Boolean isAsync, CancellationToken cancellationToken)
   at Microsoft.AspNetCore.Server.Kestrel.Https.Internal.HttpsConnectionMiddleware.OnConnectionAsync(ConnectionContext context)
2025-11-18 15:52:09.642 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-11-18 15:52:09.662 +03:00 [INF] Hosting environment: Development
2025-11-18 15:52:09.665 +03:00 [DBG] Connection id "0HNH6K54LLOJ3" stopped.
2025-11-18 15:52:09.669 +03:00 [INF] Content root path: C:\Repositories\Gac-BillingSystem\src\BillingSystem.API
2025-11-18 15:52:09.686 +03:00 [DBG] Hosting started
2025-11-18 15:52:09.696 +03:00 [DBG] Connection id "0HNH6K54LLOJ3" sending FIN because: "The Socket transport's send loop completed gracefully."
2025-11-18 15:52:10.464 +03:00 [DBG] Connection id "0HNH6K54LLOJ4" accepted.
2025-11-18 15:52:10.472 +03:00 [DBG] Connection id "0HNH6K54LLOJ4" started.
2025-11-18 15:52:10.664 +03:00 [DBG] Connection 0HNH6K54LLOJ4 established using the following protocol: "Tls13"
2025-11-18 15:52:10.842 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7257/swagger/index.html - null null
2025-11-18 15:52:10.948 +03:00 [DBG] Wildcard detected, all requests with hosts will be allowed.
2025-11-18 15:52:10.990 +03:00 [DBG] No candidates found for the request path '/swagger/index.html'
2025-11-18 15:52:10.996 +03:00 [DBG] Request did not match any endpoints
2025-11-18 15:52:11.166 +03:00 [DBG] Response markup is scheduled to include Browser Link script injection.
2025-11-18 15:52:11.173 +03:00 [DBG] Response markup is scheduled to include browser refresh script injection.
2025-11-18 15:52:11.284 +03:00 [INF] HTTP GET /swagger/index.html responded 200 in 263.5280 ms
2025-11-18 15:52:11.305 +03:00 [DBG] Response markup was updated to include Browser Link script injection.
2025-11-18 15:52:11.314 +03:00 [DBG] Response markup was updated to include browser refresh script injection.
2025-11-18 15:52:11.326 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7257/_framework/aspnetcore-browser-refresh.js - null null
2025-11-18 15:52:11.326 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7257/_vs/browserLink - null null
2025-11-18 15:52:11.330 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7257/swagger/index.html - 200 null text/html;charset=utf-8 527.1476ms
2025-11-18 15:52:11.360 +03:00 [DBG] Script injected: /_framework/aspnetcore-browser-refresh.js
2025-11-18 15:52:11.438 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7257/_framework/aspnetcore-browser-refresh.js - 200 16519 application/javascript; charset=utf-8 112.2394ms
2025-11-18 15:52:11.517 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7257/_vs/browserLink - 200 null text/javascript; charset=UTF-8 192.6711ms
2025-11-18 15:52:11.656 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7257/swagger/v1/swagger.json - null null
2025-11-18 15:52:11.673 +03:00 [DBG] No candidates found for the request path '/swagger/v1/swagger.json'
2025-11-18 15:52:11.680 +03:00 [DBG] Request did not match any endpoints
2025-11-18 15:52:11.720 +03:00 [INF] HTTP GET /swagger/v1/swagger.json responded 200 in 32.4616 ms
2025-11-18 15:52:11.730 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7257/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 74.9926ms
2025-11-18 15:52:17.695 +03:00 [DBG] Connection id "0HNH6K54LLOJ5" accepted.
2025-11-18 15:52:17.695 +03:00 [DBG] Connection id "0HNH6K54LLOJ5" received FIN.
2025-11-18 15:52:17.700 +03:00 [DBG] Connection id "0HNH6K54LLOJ5" started.
2025-11-18 15:52:17.701 +03:00 [DBG] Connection id "0HNH6K54LLOJ6" accepted.
2025-11-18 15:52:17.707 +03:00 [DBG] Failed to authenticate HTTPS connection.
System.IO.IOException: Received an unexpected EOF or 0 bytes from the transport stream.
   at System.Net.Security.SslStream.ReceiveHandshakeFrameAsync[TIOAdapter](CancellationToken cancellationToken)
   at System.Net.Security.SslStream.ForceAuthenticationAsync[TIOAdapter](Boolean receiveFirst, Byte[] reAuthenticationData, CancellationToken cancellationToken)
   at System.Net.Security.SslStream.ProcessAuthenticationWithTelemetryAsync(Boolean isAsync, CancellationToken cancellationToken)
   at Microsoft.AspNetCore.Server.Kestrel.Https.Internal.HttpsConnectionMiddleware.OnConnectionAsync(ConnectionContext context)
2025-11-18 15:52:17.709 +03:00 [DBG] Connection id "0HNH6K54LLOJ6" started.
2025-11-18 15:52:17.713 +03:00 [DBG] Connection id "0HNH6K54LLOJ5" stopped.
2025-11-18 15:52:17.718 +03:00 [DBG] Connection id "0HNH6K54LLOJ5" sending FIN because: "The Socket transport's send loop completed gracefully."
2025-11-18 15:52:17.721 +03:00 [DBG] Connection 0HNH6K54LLOJ6 established using the following protocol: "Tls13"
2025-11-18 15:52:17.728 +03:00 [INF] Request starting HTTP/1.1 POST https://localhost:7257/api/Invoices - application/json 1352
2025-11-18 15:52:17.737 +03:00 [DBG] 1 candidate(s) found for the request path '/api/Invoices'
2025-11-18 15:52:17.746 +03:00 [DBG] Endpoint 'BillingSystem.API.Controllers.InvoicesController.Post (BillingSystem.API)' with route pattern 'api/Invoices' is valid for the request path '/api/Invoices'
2025-11-18 15:52:17.752 +03:00 [DBG] Request matched endpoint 'BillingSystem.API.Controllers.InvoicesController.Post (BillingSystem.API)'
2025-11-18 15:52:17.760 +03:00 [DBG] Static files was skipped as the request already matched an endpoint.
2025-11-18 15:52:17.930 +03:00 [DBG] An 'IServiceProvider' was created for internal use by Entity Framework.
2025-11-18 15:52:23.403 +03:00 [INF] Executing endpoint 'BillingSystem.API.Controllers.InvoicesController.Post (BillingSystem.API)'
2025-11-18 15:52:23.444 +03:00 [INF] Route matched with {action = "Post", controller = "Invoices"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Post(BillingSystem.Application.Requests.CreateInvoiceRequest) on controller BillingSystem.API.Controllers.InvoicesController (BillingSystem.API).
2025-11-18 15:52:23.453 +03:00 [DBG] Execution plan of authorization filters (in the following order): ["None"]
2025-11-18 15:52:23.457 +03:00 [DBG] Execution plan of resource filters (in the following order): ["None"]
2025-11-18 15:52:23.461 +03:00 [DBG] Execution plan of action filters (in the following order): ["Microsoft.AspNetCore.Mvc.ModelBinding.UnsupportedContentTypeFilter (Order: -3000)","Microsoft.AspNetCore.Mvc.Infrastructure.ModelStateInvalidFilter (Order: -2000)","BillingSystem.API.ActionFilters.AuditBillingRequestsFilter","BillingSystem.API.ActionFilters.IdempotencyFilter (Order: 0)"]
2025-11-18 15:52:23.467 +03:00 [DBG] Execution plan of exception filters (in the following order): ["None"]
2025-11-18 15:52:23.471 +03:00 [DBG] Execution plan of result filters (in the following order): ["Microsoft.AspNetCore.Mvc.Infrastructure.ClientErrorResultFilter (Order: -2000)","Microsoft.AspNetCore.Mvc.ProducesAttribute (Order: 0)","BillingSystem.API.ActionFilters.IdempotencyFilter (Order: 0)"]
2025-11-18 15:52:23.478 +03:00 [DBG] Executing controller factory for controller BillingSystem.API.Controllers.InvoicesController (BillingSystem.API)
2025-11-18 15:52:23.484 +03:00 [WRN] You do not have a valid license key for the Lucky Penny software MediatR. This is allowed for development and testing scenarios. If you are running in production you are required to have a licensed version. Please visit https://luckypennysoftware.com to obtain a valid license.
2025-11-18 15:52:23.526 +03:00 [DBG] Executed controller factory for controller BillingSystem.API.Controllers.InvoicesController (BillingSystem.API)
2025-11-18 15:52:23.552 +03:00 [DBG] Attempting to bind parameter 'invoiceRequest' of type 'BillingSystem.Application.Requests.CreateInvoiceRequest' ...
2025-11-18 15:52:23.561 +03:00 [DBG] Attempting to bind parameter 'invoiceRequest' of type 'BillingSystem.Application.Requests.CreateInvoiceRequest' using the name '' in request data ...
2025-11-18 15:52:23.567 +03:00 [DBG] Selected input formatter 'Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonInputFormatter' for content type 'application/json'.
2025-11-18 15:52:23.605 +03:00 [DBG] Connection id "0HNH6K54LLOJ6", Request id "0HNH6K54LLOJ6:00000001": started reading request body.
2025-11-18 15:52:23.609 +03:00 [DBG] Connection id "0HNH6K54LLOJ6", Request id "0HNH6K54LLOJ6:00000001": done reading request body.
2025-11-18 15:52:23.663 +03:00 [DBG] JSON input formatter succeeded, deserializing to type 'BillingSystem.Application.Requests.CreateInvoiceRequest'
2025-11-18 15:52:23.669 +03:00 [DBG] Done attempting to bind parameter 'invoiceRequest' of type 'BillingSystem.Application.Requests.CreateInvoiceRequest'.
2025-11-18 15:52:23.676 +03:00 [DBG] Done attempting to bind parameter 'invoiceRequest' of type 'BillingSystem.Application.Requests.CreateInvoiceRequest'.
2025-11-18 15:52:23.680 +03:00 [DBG] Attempting to validate the bound parameter 'invoiceRequest' of type 'BillingSystem.Application.Requests.CreateInvoiceRequest' ...
2025-11-18 15:52:23.726 +03:00 [DBG] Done attempting to validate the bound parameter 'invoiceRequest' of type 'BillingSystem.Application.Requests.CreateInvoiceRequest'.
2025-11-18 15:52:24.211 +03:00 [DBG] No relationship from 'Invoice' to 'Invoice' has been configured by convention because there are multiple properties on one entity type - {'DiscountedPrimaryInvoice'} that could be matched with the properties on the other entity type - {'InverseDiscountedPrimaryInvoice', 'InversePrimaryInvoice', 'InverseSubstitutionPrimaryInvoice', 'PrimaryInvoice', 'SubstitutionPrimaryInvoice'}. This message can be disregarded if explicit configuration has been specified in 'OnModelCreating'.
2025-11-18 15:52:24.530 +03:00 [DBG] No relationship from 'Invoice' to 'Invoice' has been configured by convention because there are multiple properties on one entity type - {'DiscountedPrimaryInvoice'} that could be matched with the properties on the other entity type - {'InverseDiscountedPrimaryInvoice', 'InversePrimaryInvoice', 'InverseSubstitutionPrimaryInvoice', 'PrimaryInvoice', 'SubstitutionPrimaryInvoice'}. This message can be disregarded if explicit configuration has been specified in 'OnModelCreating'.
2025-11-18 15:52:24.543 +03:00 [DBG] No relationship from 'Invoice' to 'Invoice' has been configured by convention because there are multiple properties on one entity type - {'InversePrimaryInvoice'} that could be matched with the properties on the other entity type - {'InverseSubstitutionPrimaryInvoice', 'PrimaryInvoice', 'SubstitutionPrimaryInvoice'}. This message can be disregarded if explicit configuration has been specified in 'OnModelCreating'.
2025-11-18 15:52:24.555 +03:00 [DBG] No relationship from 'Invoice' to 'Invoice' has been configured by convention because there are multiple properties on one entity type - {'InversePrimaryInvoice'} that could be matched with the properties on the other entity type - {'InverseSubstitutionPrimaryInvoice', 'PrimaryInvoice', 'SubstitutionPrimaryInvoice'}. This message can be disregarded if explicit configuration has been specified in 'OnModelCreating'.
2025-11-18 15:52:24.948 +03:00 [DBG] Entity Framework Core 9.0.9 initialized 'BillingServiceDBContext' using provider 'Microsoft.EntityFrameworkCore.SqlServer:9.0.9' with options: EngineType=SqlServer 
2025-11-18 15:52:25.101 +03:00 [DBG] Compiling query expression: 
'DbSet<Invoice>()
    .AsNoTracking()
    .Any(inv => inv.ExternalId.ToString() == __idempotentKey_0)'
2025-11-18 15:52:25.476 +03:00 [DBG] Generated query execution expression: 
'queryContext => ShapedQueryCompilingExpressionVisitor.SingleAsync<bool>(
    asyncEnumerable: SingleQueryingEnumerable.Create<bool>(
        relationalQueryContext: (RelationalQueryContext)queryContext, 
        relationalCommandResolver: parameters => [LIFTABLE Constant: RelationalCommandCache.QueryExpression(
            Projection Mapping:
                EmptyProjectionMember -> 0
            SELECT EXISTS (
                SELECT 1
                FROM Invoices AS i
                WHERE COALESCE(CONVERT(varchar(36), i.ExternalId), '') == @__idempotentKey_0)) | Resolver: c => new RelationalCommandCache(
            c.Dependencies.MemoryCache, 
            c.RelationalDependencies.QuerySqlGeneratorFactory, 
            c.RelationalDependencies.RelationalParameterBasedSqlProcessorFactory, 
            Projection Mapping:
                EmptyProjectionMember -> 0
            SELECT EXISTS (
                SELECT 1
                FROM Invoices AS i
                WHERE COALESCE(CONVERT(varchar(36), i.ExternalId), '') == @__idempotentKey_0), 
            False, 
            new HashSet<string>(
                new string[]{ }, 
                StringComparer.Ordinal
            )
        )].GetRelationalCommandTemplate(parameters), 
        readerColumns: null, 
        shaper: (queryContext, dataReader, resultContext, resultCoordinator) => 
        {
            bool? value1;
            value1 = dataReader.IsDBNull(0) ? default(bool?) : (bool?)dataReader.GetBoolean(0);
            return (bool)value1;
        }, 
        contextType: BillingSystem.Infrastructure.EF.BillingServiceDBContext, 
        standAloneStateManager: False, 
        detailedErrorsEnabled: False, 
        threadSafetyChecksEnabled: True), 
    cancellationToken: queryContext.CancellationToken)'
2025-11-18 15:52:25.546 +03:00 [DBG] Creating DbConnection.
2025-11-18 15:52:25.569 +03:00 [DBG] Created DbConnection. (21ms).
2025-11-18 15:52:25.577 +03:00 [DBG] Opening connection to database 'GAC-BillingService' on server '.'.
2025-11-18 15:52:25.878 +03:00 [DBG] Opened connection to database 'GAC-BillingService' on server '.'.
2025-11-18 15:52:25.887 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-11-18 15:52:25.895 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (5ms).
2025-11-18 15:52:25.908 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (21ms).
2025-11-18 15:52:25.923 +03:00 [DBG] Executing DbCommand [Parameters=[@__idempotentKey_0='?' (Size = 36) (DbType = AnsiString)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [Invoices] AS [i]
        WHERE CONVERT(varchar(36), [i].[ExternalId]) = @__idempotentKey_0) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2025-11-18 15:52:26.008 +03:00 [INF] Executed DbCommand (84ms) [Parameters=[@__idempotentKey_0='?' (Size = 36) (DbType = AnsiString)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [Invoices] AS [i]
        WHERE CONVERT(varchar(36), [i].[ExternalId]) = @__idempotentKey_0) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2025-11-18 15:52:26.048 +03:00 [DBG] Closing data reader to 'GAC-BillingService' on server '.'.
2025-11-18 15:52:26.069 +03:00 [DBG] A data reader for 'GAC-BillingService' on server '.' is being disposed after spending 42ms reading results.
2025-11-18 15:52:26.079 +03:00 [DBG] Closing connection to database 'GAC-BillingService' on server '.'.
2025-11-18 15:52:26.096 +03:00 [DBG] Closed connection to database 'GAC-BillingService' on server '.' (17ms).
2025-11-18 15:52:26.354 +03:00 [WRN] You do not have a valid license key for the Lucky Penny software AutoMapper. This is allowed for development and testing scenarios. If you are running in production you are required to have a licensed version. Please visit https://luckypennysoftware.com to obtain a valid license.
2025-11-18 15:52:34.667 +03:00 [DBG] Opening connection to database 'GAC-BillingService' on server '.'.
2025-11-18 15:52:34.673 +03:00 [DBG] Opened connection to database 'GAC-BillingService' on server '.'.
2025-11-18 15:52:34.683 +03:00 [DBG] Beginning transaction with isolation level 'Unspecified'.
2025-11-18 15:52:34.698 +03:00 [DBG] Began transaction with isolation level 'ReadCommitted'.
2025-11-18 15:52:35.668 +03:00 [DBG] Compiling query expression: 
'DbSet<InvoiceSequenceValue>().FromSql(EXECUTE dbo.GetNextInvoiceNumber, __p_0)
'
2025-11-18 15:52:35.768 +03:00 [DBG] Generated query execution expression: 
'queryContext => FromSqlQueryingEnumerable.Create<InvoiceSequenceValue>(
    relationalQueryContext: (RelationalQueryContext)queryContext, 
    relationalCommandResolver: parameters => [LIFTABLE Constant: RelationalCommandCache.QueryExpression(
        Projection Mapping:
            EmptyProjectionMember -> Dictionary<IProperty, int> { [Property: InvoiceSequenceValue.Value (long) Required, 0] }
        SELECT b.Value
        FROM EXECUTE dbo.GetNextInvoiceNumber) | Resolver: c => new RelationalCommandCache(
        c.Dependencies.MemoryCache, 
        c.RelationalDependencies.QuerySqlGeneratorFactory, 
        c.RelationalDependencies.RelationalParameterBasedSqlProcessorFactory, 
        Projection Mapping:
            EmptyProjectionMember -> Dictionary<IProperty, int> { [Property: InvoiceSequenceValue.Value (long) Required, 0] }
        SELECT b.Value
        FROM EXECUTE dbo.GetNextInvoiceNumber, 
        False, 
        new HashSet<string>(
            new string[]{ }, 
            StringComparer.Ordinal
        )
    )].GetRelationalCommandTemplate(parameters), 
    readerColumns: null, 
    columnNames: [LIFTABLE Constant: string[] { "Value" } | Resolver: _ => new string[]{ "Value" }], 
    shaper: (queryContext, dataReader, indexMap) => 
    {
        InvoiceSequenceValue entity;
        entity = 
        {
            MaterializationContext materializationContext1;
            IEntityType entityType1;
            InvoiceSequenceValue instance1;
            materializationContext1 = new MaterializationContext(
                [LIFTABLE Constant: ValueBuffer | Resolver: _ => (object)ValueBuffer.Empty], 
                queryContext.Context
            );
            instance1 = default(InvoiceSequenceValue);
            {
                ISnapshot shadowSnapshot1;
                shadowSnapshot1 = [LIFTABLE Constant: Snapshot | Resolver: _ => Snapshot.Empty];
                entityType1 = [LIFTABLE Constant: EntityType: InvoiceSequenceValue Keyless | Resolver: namelessParameter{0} => namelessParameter{0}.Dependencies.Model.FindEntityType("BillingSystem.Domain.Entities.InvoiceSequenceValue")];
                instance1 = switch (entityType1)
                {
                    case [LIFTABLE Constant: EntityType: InvoiceSequenceValue Keyless | Resolver: namelessParameter{1} => namelessParameter{1}.Dependencies.Model.FindEntityType("BillingSystem.Domain.Entities.InvoiceSequenceValue")]: 
                        {
                            return 
                            {
                                InvoiceSequenceValue instance;
                                instance = new InvoiceSequenceValue();
                                instance.<Value>k__BackingField = dataReader.GetInt64(indexMap[0]);
                                (instance is IInjectableService) ? ((IInjectableService)instance).Injected(
                                    context: materializationContext1.Context, 
                                    entity: instance, 
                                    queryTrackingBehavior: TrackAll, 
                                    structuralType: [LIFTABLE Constant: EntityType: InvoiceSequenceValue Keyless | Resolver: namelessParameter{2} => namelessParameter{2}.Dependencies.Model.FindEntityType("BillingSystem.Domain.Entities.InvoiceSequenceValue")]) : default(void);
                                return instance;
                            }}
                    default: 
                        default(InvoiceSequenceValue)
                }
                ;
                return instance1;
            }return instance1;
        };
        return entity;
    }, 
    contextType: BillingSystem.Infrastructure.EF.BillingServiceDBContext, 
    standAloneStateManager: False, 
    detailedErrorsEnabled: False, 
    threadSafetyChecksEnabled: True)'
2025-11-18 15:52:35.793 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-11-18 15:52:35.798 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (5ms).
2025-11-18 15:52:35.805 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (12ms).
2025-11-18 15:52:35.820 +03:00 [DBG] Executing DbCommand [Parameters=[], CommandType='"Text"', CommandTimeout='30']
EXECUTE dbo.GetNextInvoiceNumber
2025-11-18 15:52:35.843 +03:00 [INF] Executed DbCommand (23ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
EXECUTE dbo.GetNextInvoiceNumber
2025-11-18 15:52:35.860 +03:00 [DBG] Closing data reader to 'GAC-BillingService' on server '.'.
2025-11-18 15:52:35.870 +03:00 [DBG] A data reader for 'GAC-BillingService' on server '.' is being disposed after spending 20ms reading results.
2025-11-18 15:52:41.041 +03:00 [DBG] Compiling query expression: 
'DbSet<Customer>()
    .FirstOrDefault(c => c.IdentityNumber == __cutomerIdentityNumber_0)'
2025-11-18 15:52:41.072 +03:00 [DBG] Generated query execution expression: 
'queryContext => SingleQueryingEnumerable.Create<Customer>(
    relationalQueryContext: (RelationalQueryContext)queryContext, 
    relationalCommandResolver: parameters => [LIFTABLE Constant: RelationalCommandCache.QueryExpression(
        Projection Mapping:
            EmptyProjectionMember -> Dictionary<IProperty, int> { [Property: Customer.Id (long) Required PK AfterSave:Throw ValueGenerated.OnAdd, 0], [Property: Customer.AddressBuildingNumber (string) MaxLength(200), 1], [Property: Customer.AddressCity (string) Required MaxLength(200), 2], [Property: Customer.AddressCountry (string) Required MaxLength(200), 3], [Property: Customer.AddressDistrict (string) Required MaxLength(200), 4], [Property: Customer.AddressPostalCode (string) Required MaxLength(50), 5], [Property: Customer.AddressStreet (string) MaxLength(200), 6], [Property: Customer.AddressSubNumber (string) MaxLength(200), 7], [Property: Customer.CreatedBy (string) Required MaxLength(50), 8], [Property: Customer.CreatedDate (DateTime) Required, 9], [Property: Customer.CustomerType (string) Required MaxLength(100), 10], [Property: Customer.EmailAddress (string) MaxLength(80), 11], [Property: Customer.FullName (string) Required MaxLength(500), 12], [Property: Customer.IdentityNumber (string) Required MaxLength(100), 13], [Property: Customer.IdentityType (int?), 14], [Property: Customer.IsDeleted (bool) Required, 15], [Property: Customer.LastUpdatedDate (DateTime?), 16], [Property: Customer.OverpaymentBalance (decimal?), 17], [Property: Customer.PhoneNumber (string) MaxLength(50), 18], [Property: Customer.Vatnumber (string) MaxLength(100), 19] }
        SELECT TOP(1) c.Id, c.Address_BuildingNumber, c.Address_City, c.Address_Country, c.Address_District, c.Address_PostalCode, c.Address_Street, c.Address_SubNumber, c.CreatedBy, c.CreatedDate, c.CustomerType, c.EmailAddress, c.FullName, c.IdentityNumber, c.IdentityType, c.IsDeleted, c.LastUpdatedDate, c.OverpaymentBalance, c.PhoneNumber, c.VATNumber
        FROM Customers AS c
        WHERE c.IdentityNumber == @__cutomerIdentityNumber_0) | Resolver: c => new RelationalCommandCache(
        c.Dependencies.MemoryCache, 
        c.RelationalDependencies.QuerySqlGeneratorFactory, 
        c.RelationalDependencies.RelationalParameterBasedSqlProcessorFactory, 
        Projection Mapping:
            EmptyProjectionMember -> Dictionary<IProperty, int> { [Property: Customer.Id (long) Required PK AfterSave:Throw ValueGenerated.OnAdd, 0], [Property: Customer.AddressBuildingNumber (string) MaxLength(200), 1], [Property: Customer.AddressCity (string) Required MaxLength(200), 2], [Property: Customer.AddressCountry (string) Required MaxLength(200), 3], [Property: Customer.AddressDistrict (string) Required MaxLength(200), 4], [Property: Customer.AddressPostalCode (string) Required MaxLength(50), 5], [Property: Customer.AddressStreet (string) MaxLength(200), 6], [Property: Customer.AddressSubNumber (string) MaxLength(200), 7], [Property: Customer.CreatedBy (string) Required MaxLength(50), 8], [Property: Customer.CreatedDate (DateTime) Required, 9], [Property: Customer.CustomerType (string) Required MaxLength(100), 10], [Property: Customer.EmailAddress (string) MaxLength(80), 11], [Property: Customer.FullName (string) Required MaxLength(500), 12], [Property: Customer.IdentityNumber (string) Required MaxLength(100), 13], [Property: Customer.IdentityType (int?), 14], [Property: Customer.IsDeleted (bool) Required, 15], [Property: Customer.LastUpdatedDate (DateTime?), 16], [Property: Customer.OverpaymentBalance (decimal?), 17], [Property: Customer.PhoneNumber (string) MaxLength(50), 18], [Property: Customer.Vatnumber (string) MaxLength(100), 19] }
        SELECT TOP(1) c.Id, c.Address_BuildingNumber, c.Address_City, c.Address_Country, c.Address_District, c.Address_PostalCode, c.Address_Street, c.Address_SubNumber, c.CreatedBy, c.CreatedDate, c.CustomerType, c.EmailAddress, c.FullName, c.IdentityNumber, c.IdentityType, c.IsDeleted, c.LastUpdatedDate, c.OverpaymentBalance, c.PhoneNumber, c.VATNumber
        FROM Customers AS c
        WHERE c.IdentityNumber == @__cutomerIdentityNumber_0, 
        False, 
        new HashSet<string>(
            new string[]{ }, 
            StringComparer.Ordinal
        )
    )].GetRelationalCommandTemplate(parameters), 
    readerColumns: null, 
    shaper: (queryContext, dataReader, resultContext, resultCoordinator) => 
    {
        Customer entity;
        entity = 
        {
            MaterializationContext materializationContext1;
            IEntityType entityType1;
            Customer instance1;
            InternalEntityEntry entry1;
            bool hasNullKey1;
            materializationContext1 = new MaterializationContext(
                [LIFTABLE Constant: ValueBuffer | Resolver: _ => (object)ValueBuffer.Empty], 
                queryContext.Context
            );
            instance1 = default(Customer);
            entry1 = queryContext.TryGetEntry(
                key: [LIFTABLE Constant: Key: Customer.Id PK | Resolver: c => c.Dependencies.Model.FindEntityType("BillingSystem.Domain.Entities.Customer").FindPrimaryKey()], 
                keyValues: new object[]{ (object)dataReader.GetInt64(0) }, 
                throwOnNullKey: True, 
                hasNullKey: hasNullKey1);
            !(hasNullKey1) ? entry1 != default(InternalEntityEntry) ? 
            {
                entityType1 = entry1.EntityType;
                return instance1 = (Customer)entry1.Entity;
            } : 
            {
                ISnapshot shadowSnapshot1;
                shadowSnapshot1 = [LIFTABLE Constant: Snapshot | Resolver: _ => Snapshot.Empty];
                entityType1 = [LIFTABLE Constant: EntityType: Customer | Resolver: namelessParameter{0} => namelessParameter{0}.Dependencies.Model.FindEntityType("BillingSystem.Domain.Entities.Customer")];
                instance1 = switch (entityType1)
                {
                    case [LIFTABLE Constant: EntityType: Customer | Resolver: namelessParameter{1} => namelessParameter{1}.Dependencies.Model.FindEntityType("BillingSystem.Domain.Entities.Customer")]: 
                        {
                            return 
                            {
                                Customer instance;
                                instance = new Customer();
                                instance.<Id>k__BackingField = dataReader.GetInt64(0);
                                instance.<AddressBuildingNumber>k__BackingField = dataReader.IsDBNull(1) ? default(string) : dataReader.GetString(1);
                                instance.<AddressCity>k__BackingField = dataReader.GetString(2);
                                instance.<AddressCountry>k__BackingField = dataReader.GetString(3);
                                instance.<AddressDistrict>k__BackingField = dataReader.GetString(4);
                                instance.<AddressPostalCode>k__BackingField = dataReader.GetString(5);
                                instance.<AddressStreet>k__BackingField = dataReader.IsDBNull(6) ? default(string) : dataReader.GetString(6);
                                instance.<AddressSubNumber>k__BackingField = dataReader.IsDBNull(7) ? default(string) : dataReader.GetString(7);
                                instance.<CreatedBy>k__BackingField = dataReader.GetString(8);
                                instance.<CreatedDate>k__BackingField = dataReader.GetDateTime(9);
                                instance.<CustomerType>k__BackingField = dataReader.GetString(10);
                                instance.<EmailAddress>k__BackingField = dataReader.IsDBNull(11) ? default(string) : dataReader.GetString(11);
                                instance.<FullName>k__BackingField = dataReader.GetString(12);
                                instance.<IdentityNumber>k__BackingField = dataReader.GetString(13);
                                instance.<IdentityType>k__BackingField = dataReader.IsDBNull(14) ? default(int?) : (int?)dataReader.GetInt32(14);
                                instance.<IsDeleted>k__BackingField = dataReader.GetBoolean(15);
                                instance.<LastUpdatedDate>k__BackingField = dataReader.IsDBNull(16) ? default(DateTime?) : (DateTime?)dataReader.GetDateTime(16);
                                instance.<OverpaymentBalance>k__BackingField = dataReader.IsDBNull(17) ? default(decimal?) : (decimal?)dataReader.GetDecimal(17);
                                instance.<PhoneNumber>k__BackingField = dataReader.IsDBNull(18) ? default(string) : dataReader.GetString(18);
                                instance.<Vatnumber>k__BackingField = dataReader.IsDBNull(19) ? default(string) : dataReader.GetString(19);
                                (instance is IInjectableService) ? ((IInjectableService)instance).Injected(
                                    context: materializationContext1.Context, 
                                    entity: instance, 
                                    queryTrackingBehavior: TrackAll, 
                                    structuralType: [LIFTABLE Constant: EntityType: Customer | Resolver: namelessParameter{2} => namelessParameter{2}.Dependencies.Model.FindEntityType("BillingSystem.Domain.Entities.Customer")]) : default(void);
                                return instance;
                            }}
                    default: 
                        default(Customer)
                }
                ;
                entry1 = entityType1 == default(IEntityType) ? default(InternalEntityEntry) : queryContext.StartTracking(
                    entityType: entityType1, 
                    entity: instance1, 
                    snapshot: shadowSnapshot1);
                return instance1;
            } : default(void);
            return instance1;
        };
        return entity;
    }, 
    contextType: BillingSystem.Infrastructure.EF.BillingServiceDBContext, 
    standAloneStateManager: False, 
    detailedErrorsEnabled: False, 
    threadSafetyChecksEnabled: True)
    .SingleOrDefault()'
2025-11-18 15:52:41.093 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-11-18 15:52:41.099 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (6ms).
2025-11-18 15:52:41.104 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (11ms).
2025-11-18 15:52:41.108 +03:00 [DBG] Executing DbCommand [Parameters=[@__cutomerIdentityNumber_0='?' (Size = 100)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[Id], [c].[Address_BuildingNumber], [c].[Address_City], [c].[Address_Country], [c].[Address_District], [c].[Address_PostalCode], [c].[Address_Street], [c].[Address_SubNumber], [c].[CreatedBy], [c].[CreatedDate], [c].[CustomerType], [c].[EmailAddress], [c].[FullName], [c].[IdentityNumber], [c].[IdentityType], [c].[IsDeleted], [c].[LastUpdatedDate], [c].[OverpaymentBalance], [c].[PhoneNumber], [c].[VATNumber]
FROM [Customers] AS [c]
WHERE [c].[IdentityNumber] = @__cutomerIdentityNumber_0
2025-11-18 15:52:41.119 +03:00 [INF] Executed DbCommand (11ms) [Parameters=[@__cutomerIdentityNumber_0='?' (Size = 100)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[Id], [c].[Address_BuildingNumber], [c].[Address_City], [c].[Address_Country], [c].[Address_District], [c].[Address_PostalCode], [c].[Address_Street], [c].[Address_SubNumber], [c].[CreatedBy], [c].[CreatedDate], [c].[CustomerType], [c].[EmailAddress], [c].[FullName], [c].[IdentityNumber], [c].[IdentityType], [c].[IsDeleted], [c].[LastUpdatedDate], [c].[OverpaymentBalance], [c].[PhoneNumber], [c].[VATNumber]
FROM [Customers] AS [c]
WHERE [c].[IdentityNumber] = @__cutomerIdentityNumber_0
2025-11-18 15:52:41.195 +03:00 [DBG] Context 'BillingServiceDBContext' started tracking 'Customer' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-11-18 15:52:41.295 +03:00 [DBG] Closing data reader to 'GAC-BillingService' on server '.'.
2025-11-18 15:52:41.301 +03:00 [DBG] A data reader for 'GAC-BillingService' on server '.' is being disposed after spending 174ms reading results.
2025-11-18 15:58:52.584 +03:00 [DBG] Registered model binder providers, in the following order: ["Microsoft.AspNetCore.Mvc.ModelBinding.Binders.BinderTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ServicesModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.BodyModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.HeaderModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FloatingPointTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.EnumTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.DateTimeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.SimpleTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.TryParseModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.CancellationTokenModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ByteArrayModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FormFileModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FormCollectionModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.KeyValuePairModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.DictionaryModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ArrayModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.CollectionModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ComplexObjectModelBinderProvider"]
2025-11-18 15:58:52.779 +03:00 [DBG] Hosting starting
2025-11-18 15:58:53.109 +03:00 [DBG] Starting bus instances: IBus
2025-11-18 15:58:53.116 +03:00 [DBG] Starting bus: "rabbitmq://localhost/"
2025-11-18 15:58:53.142 +03:00 [DBG] Middleware loaded
2025-11-18 15:58:53.149 +03:00 [DBG] Middleware loaded. Script /_framework/aspnetcore-browser-refresh.js (16519 B).
2025-11-18 15:58:53.164 +03:00 [DBG] Middleware loaded. Script /_framework/blazor-hotreload.js (799 B).
2025-11-18 15:58:53.169 +03:00 [DBG] Connect: guest@localhost:5672/
2025-11-18 15:58:53.310 +03:00 [DBG] Middleware loaded: DOTNET_MODIFIABLE_ASSEMBLIES=debug, __ASPNETCORE_BROWSER_TOOLS=true
2025-11-18 15:58:53.330 +03:00 [DBG] Connected: guest@localhost:5672/ (address: amqp://localhost:5672, local: 54685)
2025-11-18 15:58:53.385 +03:00 [DBG] Endpoint Ready: "rabbitmq://localhost/ECHGHANNAMLP1_BillingSystemAPI_bus_guooyyyh3bcsbyjjbdxnpet3g3?temporary=true"
2025-11-18 15:58:53.388 +03:00 [INF] Bus started: "rabbitmq://localhost/"
2025-11-18 15:58:53.637 +03:00 [INF] Now listening on: https://localhost:7257
2025-11-18 15:58:53.646 +03:00 [INF] Now listening on: http://localhost:5009
2025-11-18 15:58:53.650 +03:00 [DBG] Loaded hosting startup assembly BillingSystem.API
2025-11-18 15:58:53.655 +03:00 [DBG] Loaded hosting startup assembly Microsoft.WebTools.ApiEndpointDiscovery
2025-11-18 15:58:53.657 +03:00 [DBG] Loaded hosting startup assembly Microsoft.AspNetCore.Watch.BrowserRefresh
2025-11-18 15:58:53.660 +03:00 [DBG] Loaded hosting startup assembly Microsoft.WebTools.BrowserLink.Net
2025-11-18 15:58:53.825 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-11-18 15:58:53.827 +03:00 [INF] Hosting environment: Development
2025-11-18 15:58:53.829 +03:00 [INF] Content root path: C:\Repositories\Gac-BillingSystem\src\BillingSystem.API
2025-11-18 15:58:53.832 +03:00 [DBG] Hosting started
2025-11-18 15:58:53.974 +03:00 [DBG] Connection id "0HNH6K8T6IQ68" accepted.
2025-11-18 15:58:53.981 +03:00 [DBG] Connection id "0HNH6K8T6IQ68" started.
2025-11-18 15:58:54.008 +03:00 [DBG] Connection id "0HNH6K8T6IQ68" received FIN.
2025-11-18 15:58:54.030 +03:00 [DBG] Failed to authenticate HTTPS connection.
System.IO.IOException: Received an unexpected EOF or 0 bytes from the transport stream.
   at System.Net.Security.SslStream.ReceiveHandshakeFrameAsync[TIOAdapter](CancellationToken cancellationToken)
   at System.Net.Security.SslStream.ForceAuthenticationAsync[TIOAdapter](Boolean receiveFirst, Byte[] reAuthenticationData, CancellationToken cancellationToken)
   at System.Net.Security.SslStream.ProcessAuthenticationWithTelemetryAsync(Boolean isAsync, CancellationToken cancellationToken)
   at Microsoft.AspNetCore.Server.Kestrel.Https.Internal.HttpsConnectionMiddleware.OnConnectionAsync(ConnectionContext context)
2025-11-18 15:58:54.064 +03:00 [DBG] Connection id "0HNH6K8T6IQ68" stopped.
2025-11-18 15:58:54.078 +03:00 [DBG] Connection id "0HNH6K8T6IQ68" sending FIN because: "The Socket transport's send loop completed gracefully."
2025-11-18 15:58:54.601 +03:00 [DBG] Connection id "0HNH6K8T6IQ69" accepted.
2025-11-18 15:58:54.605 +03:00 [DBG] Connection id "0HNH6K8T6IQ69" started.
2025-11-18 15:58:54.668 +03:00 [DBG] Connection 0HNH6K8T6IQ69 established using the following protocol: "Tls13"
2025-11-18 15:58:54.742 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7257/swagger/index.html - null null
2025-11-18 15:58:54.802 +03:00 [DBG] Wildcard detected, all requests with hosts will be allowed.
2025-11-18 15:58:54.824 +03:00 [DBG] No candidates found for the request path '/swagger/index.html'
2025-11-18 15:58:54.829 +03:00 [DBG] Request did not match any endpoints
2025-11-18 15:58:54.904 +03:00 [DBG] Response markup is scheduled to include Browser Link script injection.
2025-11-18 15:58:54.911 +03:00 [DBG] Response markup is scheduled to include browser refresh script injection.
2025-11-18 15:58:54.940 +03:00 [INF] HTTP GET /swagger/index.html responded 200 in 102.2672 ms
2025-11-18 15:58:54.950 +03:00 [DBG] Response markup was updated to include Browser Link script injection.
2025-11-18 15:58:54.954 +03:00 [DBG] Response markup was updated to include browser refresh script injection.
2025-11-18 15:58:54.962 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7257/swagger/index.html - 200 null text/html;charset=utf-8 229.293ms
2025-11-18 15:58:54.990 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7257/_framework/aspnetcore-browser-refresh.js - null null
2025-11-18 15:58:55.005 +03:00 [DBG] Script injected: /_framework/aspnetcore-browser-refresh.js
2025-11-18 15:58:55.010 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7257/_framework/aspnetcore-browser-refresh.js - 200 16519 application/javascript; charset=utf-8 20.939ms
2025-11-18 15:58:55.016 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7257/_vs/browserLink - null null
2025-11-18 15:58:55.083 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7257/_vs/browserLink - 200 null text/javascript; charset=UTF-8 66.5784ms
2025-11-18 15:58:55.191 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7257/swagger/v1/swagger.json - null null
2025-11-18 15:58:55.198 +03:00 [DBG] No candidates found for the request path '/swagger/v1/swagger.json'
2025-11-18 15:58:55.200 +03:00 [DBG] Request did not match any endpoints
2025-11-18 15:58:55.220 +03:00 [INF] HTTP GET /swagger/v1/swagger.json responded 200 in 16.3512 ms
2025-11-18 15:58:55.228 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7257/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 37.8663ms
2025-11-18 16:09:08.012 +03:00 [DBG] Connection id "0HNH6K8T6IQ6A" accepted.
2025-11-18 16:09:08.013 +03:00 [DBG] Connection id "0HNH6K8T6IQ6A" received FIN.
2025-11-18 16:09:08.022 +03:00 [DBG] Connection id "0HNH6K8T6IQ6B" accepted.
2025-11-18 16:09:08.022 +03:00 [DBG] Connection id "0HNH6K8T6IQ6A" started.
2025-11-18 16:09:08.046 +03:00 [DBG] Connection id "0HNH6K8T6IQ6B" started.
2025-11-18 16:09:08.050 +03:00 [DBG] Failed to authenticate HTTPS connection.
System.IO.IOException: Received an unexpected EOF or 0 bytes from the transport stream.
   at System.Net.Security.SslStream.ReceiveHandshakeFrameAsync[TIOAdapter](CancellationToken cancellationToken)
   at System.Net.Security.SslStream.ForceAuthenticationAsync[TIOAdapter](Boolean receiveFirst, Byte[] reAuthenticationData, CancellationToken cancellationToken)
   at System.Net.Security.SslStream.ProcessAuthenticationWithTelemetryAsync(Boolean isAsync, CancellationToken cancellationToken)
   at Microsoft.AspNetCore.Server.Kestrel.Https.Internal.HttpsConnectionMiddleware.OnConnectionAsync(ConnectionContext context)
2025-11-18 16:09:08.056 +03:00 [DBG] Connection id "0HNH6K8T6IQ6A" stopped.
2025-11-18 16:09:08.059 +03:00 [DBG] Connection 0HNH6K8T6IQ6B established using the following protocol: "Tls13"
2025-11-18 16:09:08.060 +03:00 [DBG] Connection id "0HNH6K8T6IQ6A" sending FIN because: "The Socket transport's send loop completed gracefully."
2025-11-18 16:09:08.068 +03:00 [INF] Request starting HTTP/1.1 POST https://localhost:7257/api/Invoices - application/json 1352
2025-11-18 16:09:08.086 +03:00 [DBG] 1 candidate(s) found for the request path '/api/Invoices'
2025-11-18 16:09:08.095 +03:00 [DBG] Endpoint 'BillingSystem.API.Controllers.InvoicesController.Post (BillingSystem.API)' with route pattern 'api/Invoices' is valid for the request path '/api/Invoices'
2025-11-18 16:09:08.105 +03:00 [DBG] Request matched endpoint 'BillingSystem.API.Controllers.InvoicesController.Post (BillingSystem.API)'
2025-11-18 16:09:08.114 +03:00 [DBG] Static files was skipped as the request already matched an endpoint.
2025-11-18 16:09:08.383 +03:00 [DBG] An 'IServiceProvider' was created for internal use by Entity Framework.
2025-11-18 16:09:13.915 +03:00 [INF] Executing endpoint 'BillingSystem.API.Controllers.InvoicesController.Post (BillingSystem.API)'
2025-11-18 16:09:13.976 +03:00 [INF] Route matched with {action = "Post", controller = "Invoices"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Post(BillingSystem.Application.Requests.CreateInvoiceRequest) on controller BillingSystem.API.Controllers.InvoicesController (BillingSystem.API).
2025-11-18 16:09:13.984 +03:00 [DBG] Execution plan of authorization filters (in the following order): ["None"]
2025-11-18 16:09:13.991 +03:00 [DBG] Execution plan of resource filters (in the following order): ["None"]
2025-11-18 16:09:13.995 +03:00 [DBG] Execution plan of action filters (in the following order): ["Microsoft.AspNetCore.Mvc.ModelBinding.UnsupportedContentTypeFilter (Order: -3000)","Microsoft.AspNetCore.Mvc.Infrastructure.ModelStateInvalidFilter (Order: -2000)","BillingSystem.API.ActionFilters.AuditBillingRequestsFilter","BillingSystem.API.ActionFilters.IdempotencyFilter (Order: 0)"]
2025-11-18 16:09:14.000 +03:00 [DBG] Execution plan of exception filters (in the following order): ["None"]
2025-11-18 16:09:14.005 +03:00 [DBG] Execution plan of result filters (in the following order): ["Microsoft.AspNetCore.Mvc.Infrastructure.ClientErrorResultFilter (Order: -2000)","Microsoft.AspNetCore.Mvc.ProducesAttribute (Order: 0)","BillingSystem.API.ActionFilters.IdempotencyFilter (Order: 0)"]
2025-11-18 16:09:14.012 +03:00 [DBG] Executing controller factory for controller BillingSystem.API.Controllers.InvoicesController (BillingSystem.API)
2025-11-18 16:09:14.020 +03:00 [WRN] You do not have a valid license key for the Lucky Penny software MediatR. This is allowed for development and testing scenarios. If you are running in production you are required to have a licensed version. Please visit https://luckypennysoftware.com to obtain a valid license.
2025-11-18 16:09:14.063 +03:00 [DBG] Executed controller factory for controller BillingSystem.API.Controllers.InvoicesController (BillingSystem.API)
2025-11-18 16:09:14.089 +03:00 [DBG] Attempting to bind parameter 'invoiceRequest' of type 'BillingSystem.Application.Requests.CreateInvoiceRequest' ...
2025-11-18 16:09:14.098 +03:00 [DBG] Attempting to bind parameter 'invoiceRequest' of type 'BillingSystem.Application.Requests.CreateInvoiceRequest' using the name '' in request data ...
2025-11-18 16:09:14.105 +03:00 [DBG] Selected input formatter 'Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonInputFormatter' for content type 'application/json'.
2025-11-18 16:09:14.150 +03:00 [DBG] Connection id "0HNH6K8T6IQ6B", Request id "0HNH6K8T6IQ6B:00000001": started reading request body.
2025-11-18 16:09:14.157 +03:00 [DBG] Connection id "0HNH6K8T6IQ6B", Request id "0HNH6K8T6IQ6B:00000001": done reading request body.
2025-11-18 16:09:14.191 +03:00 [DBG] JSON input formatter succeeded, deserializing to type 'BillingSystem.Application.Requests.CreateInvoiceRequest'
2025-11-18 16:09:14.198 +03:00 [DBG] Done attempting to bind parameter 'invoiceRequest' of type 'BillingSystem.Application.Requests.CreateInvoiceRequest'.
2025-11-18 16:09:14.201 +03:00 [DBG] Done attempting to bind parameter 'invoiceRequest' of type 'BillingSystem.Application.Requests.CreateInvoiceRequest'.
2025-11-18 16:09:14.206 +03:00 [DBG] Attempting to validate the bound parameter 'invoiceRequest' of type 'BillingSystem.Application.Requests.CreateInvoiceRequest' ...
2025-11-18 16:09:14.234 +03:00 [DBG] Done attempting to validate the bound parameter 'invoiceRequest' of type 'BillingSystem.Application.Requests.CreateInvoiceRequest'.
2025-11-18 16:09:14.545 +03:00 [DBG] No relationship from 'Invoice' to 'Invoice' has been configured by convention because there are multiple properties on one entity type - {'DiscountedPrimaryInvoice'} that could be matched with the properties on the other entity type - {'InverseDiscountedPrimaryInvoice', 'InversePrimaryInvoice', 'InverseSubstitutionPrimaryInvoice', 'PrimaryInvoice', 'SubstitutionPrimaryInvoice'}. This message can be disregarded if explicit configuration has been specified in 'OnModelCreating'.
2025-11-18 16:09:14.805 +03:00 [DBG] No relationship from 'Invoice' to 'Invoice' has been configured by convention because there are multiple properties on one entity type - {'DiscountedPrimaryInvoice'} that could be matched with the properties on the other entity type - {'InverseDiscountedPrimaryInvoice', 'InversePrimaryInvoice', 'InverseSubstitutionPrimaryInvoice', 'PrimaryInvoice', 'SubstitutionPrimaryInvoice'}. This message can be disregarded if explicit configuration has been specified in 'OnModelCreating'.
2025-11-18 16:09:14.821 +03:00 [DBG] No relationship from 'Invoice' to 'Invoice' has been configured by convention because there are multiple properties on one entity type - {'InversePrimaryInvoice'} that could be matched with the properties on the other entity type - {'InverseSubstitutionPrimaryInvoice', 'PrimaryInvoice', 'SubstitutionPrimaryInvoice'}. This message can be disregarded if explicit configuration has been specified in 'OnModelCreating'.
2025-11-18 16:09:14.832 +03:00 [DBG] No relationship from 'Invoice' to 'Invoice' has been configured by convention because there are multiple properties on one entity type - {'InversePrimaryInvoice'} that could be matched with the properties on the other entity type - {'InverseSubstitutionPrimaryInvoice', 'PrimaryInvoice', 'SubstitutionPrimaryInvoice'}. This message can be disregarded if explicit configuration has been specified in 'OnModelCreating'.
2025-11-18 16:09:15.206 +03:00 [DBG] Entity Framework Core 9.0.9 initialized 'BillingServiceDBContext' using provider 'Microsoft.EntityFrameworkCore.SqlServer:9.0.9' with options: EngineType=SqlServer 
2025-11-18 16:09:15.367 +03:00 [DBG] Compiling query expression: 
'DbSet<Invoice>()
    .AsNoTracking()
    .Any(inv => inv.ExternalId.ToString() == __idempotentKey_0)'
2025-11-18 16:09:15.740 +03:00 [DBG] Generated query execution expression: 
'queryContext => ShapedQueryCompilingExpressionVisitor.SingleAsync<bool>(
    asyncEnumerable: SingleQueryingEnumerable.Create<bool>(
        relationalQueryContext: (RelationalQueryContext)queryContext, 
        relationalCommandResolver: parameters => [LIFTABLE Constant: RelationalCommandCache.QueryExpression(
            Projection Mapping:
                EmptyProjectionMember -> 0
            SELECT EXISTS (
                SELECT 1
                FROM Invoices AS i
                WHERE COALESCE(CONVERT(varchar(36), i.ExternalId), '') == @__idempotentKey_0)) | Resolver: c => new RelationalCommandCache(
            c.Dependencies.MemoryCache, 
            c.RelationalDependencies.QuerySqlGeneratorFactory, 
            c.RelationalDependencies.RelationalParameterBasedSqlProcessorFactory, 
            Projection Mapping:
                EmptyProjectionMember -> 0
            SELECT EXISTS (
                SELECT 1
                FROM Invoices AS i
                WHERE COALESCE(CONVERT(varchar(36), i.ExternalId), '') == @__idempotentKey_0), 
            False, 
            new HashSet<string>(
                new string[]{ }, 
                StringComparer.Ordinal
            )
        )].GetRelationalCommandTemplate(parameters), 
        readerColumns: null, 
        shaper: (queryContext, dataReader, resultContext, resultCoordinator) => 
        {
            bool? value1;
            value1 = dataReader.IsDBNull(0) ? default(bool?) : (bool?)dataReader.GetBoolean(0);
            return (bool)value1;
        }, 
        contextType: BillingSystem.Infrastructure.EF.BillingServiceDBContext, 
        standAloneStateManager: False, 
        detailedErrorsEnabled: False, 
        threadSafetyChecksEnabled: True), 
    cancellationToken: queryContext.CancellationToken)'
2025-11-18 16:09:15.801 +03:00 [DBG] Creating DbConnection.
2025-11-18 16:09:15.828 +03:00 [DBG] Created DbConnection. (24ms).
2025-11-18 16:09:15.835 +03:00 [DBG] Opening connection to database 'GAC-BillingService' on server '.'.
2025-11-18 16:09:16.145 +03:00 [DBG] Opened connection to database 'GAC-BillingService' on server '.'.
2025-11-18 16:09:16.158 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-11-18 16:09:16.176 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (11ms).
2025-11-18 16:09:16.194 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (37ms).
2025-11-18 16:09:16.209 +03:00 [DBG] Executing DbCommand [Parameters=[@__idempotentKey_0='?' (Size = 36) (DbType = AnsiString)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [Invoices] AS [i]
        WHERE CONVERT(varchar(36), [i].[ExternalId]) = @__idempotentKey_0) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2025-11-18 16:09:16.295 +03:00 [INF] Executed DbCommand (86ms) [Parameters=[@__idempotentKey_0='?' (Size = 36) (DbType = AnsiString)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [Invoices] AS [i]
        WHERE CONVERT(varchar(36), [i].[ExternalId]) = @__idempotentKey_0) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2025-11-18 16:09:16.319 +03:00 [DBG] Closing data reader to 'GAC-BillingService' on server '.'.
2025-11-18 16:09:16.332 +03:00 [DBG] A data reader for 'GAC-BillingService' on server '.' is being disposed after spending 25ms reading results.
2025-11-18 16:09:16.340 +03:00 [DBG] Closing connection to database 'GAC-BillingService' on server '.'.
2025-11-18 16:09:16.352 +03:00 [DBG] Closed connection to database 'GAC-BillingService' on server '.' (12ms).
2025-11-18 16:09:16.620 +03:00 [WRN] You do not have a valid license key for the Lucky Penny software AutoMapper. This is allowed for development and testing scenarios. If you are running in production you are required to have a licensed version. Please visit https://luckypennysoftware.com to obtain a valid license.
2025-11-18 16:09:22.100 +03:00 [DBG] Opening connection to database 'GAC-BillingService' on server '.'.
2025-11-18 16:09:22.110 +03:00 [DBG] Opened connection to database 'GAC-BillingService' on server '.'.
2025-11-18 16:09:22.118 +03:00 [DBG] Beginning transaction with isolation level 'Unspecified'.
2025-11-18 16:09:22.133 +03:00 [DBG] Began transaction with isolation level 'ReadCommitted'.
2025-11-18 16:09:23.652 +03:00 [DBG] Compiling query expression: 
'DbSet<InvoiceSequenceValue>().FromSql(EXECUTE dbo.GetNextInvoiceNumber, __p_0)
'
2025-11-18 16:09:23.716 +03:00 [DBG] Generated query execution expression: 
'queryContext => FromSqlQueryingEnumerable.Create<InvoiceSequenceValue>(
    relationalQueryContext: (RelationalQueryContext)queryContext, 
    relationalCommandResolver: parameters => [LIFTABLE Constant: RelationalCommandCache.QueryExpression(
        Projection Mapping:
            EmptyProjectionMember -> Dictionary<IProperty, int> { [Property: InvoiceSequenceValue.Value (long) Required, 0] }
        SELECT b.Value
        FROM EXECUTE dbo.GetNextInvoiceNumber) | Resolver: c => new RelationalCommandCache(
        c.Dependencies.MemoryCache, 
        c.RelationalDependencies.QuerySqlGeneratorFactory, 
        c.RelationalDependencies.RelationalParameterBasedSqlProcessorFactory, 
        Projection Mapping:
            EmptyProjectionMember -> Dictionary<IProperty, int> { [Property: InvoiceSequenceValue.Value (long) Required, 0] }
        SELECT b.Value
        FROM EXECUTE dbo.GetNextInvoiceNumber, 
        False, 
        new HashSet<string>(
            new string[]{ }, 
            StringComparer.Ordinal
        )
    )].GetRelationalCommandTemplate(parameters), 
    readerColumns: null, 
    columnNames: [LIFTABLE Constant: string[] { "Value" } | Resolver: _ => new string[]{ "Value" }], 
    shaper: (queryContext, dataReader, indexMap) => 
    {
        InvoiceSequenceValue entity;
        entity = 
        {
            MaterializationContext materializationContext1;
            IEntityType entityType1;
            InvoiceSequenceValue instance1;
            materializationContext1 = new MaterializationContext(
                [LIFTABLE Constant: ValueBuffer | Resolver: _ => (object)ValueBuffer.Empty], 
                queryContext.Context
            );
            instance1 = default(InvoiceSequenceValue);
            {
                ISnapshot shadowSnapshot1;
                shadowSnapshot1 = [LIFTABLE Constant: Snapshot | Resolver: _ => Snapshot.Empty];
                entityType1 = [LIFTABLE Constant: EntityType: InvoiceSequenceValue Keyless | Resolver: namelessParameter{0} => namelessParameter{0}.Dependencies.Model.FindEntityType("BillingSystem.Domain.Entities.InvoiceSequenceValue")];
                instance1 = switch (entityType1)
                {
                    case [LIFTABLE Constant: EntityType: InvoiceSequenceValue Keyless | Resolver: namelessParameter{1} => namelessParameter{1}.Dependencies.Model.FindEntityType("BillingSystem.Domain.Entities.InvoiceSequenceValue")]: 
                        {
                            return 
                            {
                                InvoiceSequenceValue instance;
                                instance = new InvoiceSequenceValue();
                                instance.<Value>k__BackingField = dataReader.GetInt64(indexMap[0]);
                                (instance is IInjectableService) ? ((IInjectableService)instance).Injected(
                                    context: materializationContext1.Context, 
                                    entity: instance, 
                                    queryTrackingBehavior: TrackAll, 
                                    structuralType: [LIFTABLE Constant: EntityType: InvoiceSequenceValue Keyless | Resolver: namelessParameter{2} => namelessParameter{2}.Dependencies.Model.FindEntityType("BillingSystem.Domain.Entities.InvoiceSequenceValue")]) : default(void);
                                return instance;
                            }}
                    default: 
                        default(InvoiceSequenceValue)
                }
                ;
                return instance1;
            }return instance1;
        };
        return entity;
    }, 
    contextType: BillingSystem.Infrastructure.EF.BillingServiceDBContext, 
    standAloneStateManager: False, 
    detailedErrorsEnabled: False, 
    threadSafetyChecksEnabled: True)'
2025-11-18 16:09:23.727 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-11-18 16:09:23.732 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (4ms).
2025-11-18 16:09:23.736 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (9ms).
2025-11-18 16:09:23.741 +03:00 [DBG] Executing DbCommand [Parameters=[], CommandType='"Text"', CommandTimeout='30']
EXECUTE dbo.GetNextInvoiceNumber
2025-11-18 16:09:23.752 +03:00 [INF] Executed DbCommand (11ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
EXECUTE dbo.GetNextInvoiceNumber
2025-11-18 16:09:23.762 +03:00 [DBG] Closing data reader to 'GAC-BillingService' on server '.'.
2025-11-18 16:09:23.765 +03:00 [DBG] A data reader for 'GAC-BillingService' on server '.' is being disposed after spending 7ms reading results.
2025-11-18 16:09:33.630 +03:00 [DBG] Compiling query expression: 
'DbSet<Customer>()
    .FirstOrDefault(c => c.IdentityNumber == __cutomerIdentityNumber_0)'
2025-11-18 16:09:33.648 +03:00 [DBG] Generated query execution expression: 
'queryContext => SingleQueryingEnumerable.Create<Customer>(
    relationalQueryContext: (RelationalQueryContext)queryContext, 
    relationalCommandResolver: parameters => [LIFTABLE Constant: RelationalCommandCache.QueryExpression(
        Projection Mapping:
            EmptyProjectionMember -> Dictionary<IProperty, int> { [Property: Customer.Id (long) Required PK AfterSave:Throw ValueGenerated.OnAdd, 0], [Property: Customer.AddressBuildingNumber (string) MaxLength(200), 1], [Property: Customer.AddressCity (string) Required MaxLength(200), 2], [Property: Customer.AddressCountry (string) Required MaxLength(200), 3], [Property: Customer.AddressDistrict (string) Required MaxLength(200), 4], [Property: Customer.AddressPostalCode (string) Required MaxLength(50), 5], [Property: Customer.AddressStreet (string) MaxLength(200), 6], [Property: Customer.AddressSubNumber (string) MaxLength(200), 7], [Property: Customer.CreatedBy (string) Required MaxLength(50), 8], [Property: Customer.CreatedDate (DateTime) Required, 9], [Property: Customer.CustomerType (string) Required MaxLength(100), 10], [Property: Customer.EmailAddress (string) MaxLength(80), 11], [Property: Customer.FullName (string) Required MaxLength(500), 12], [Property: Customer.IdentityNumber (string) Required MaxLength(100), 13], [Property: Customer.IdentityType (int?), 14], [Property: Customer.IsDeleted (bool) Required, 15], [Property: Customer.LastUpdatedDate (DateTime?), 16], [Property: Customer.OverpaymentBalance (decimal?), 17], [Property: Customer.PhoneNumber (string) MaxLength(50), 18], [Property: Customer.Vatnumber (string) MaxLength(100), 19] }
        SELECT TOP(1) c.Id, c.Address_BuildingNumber, c.Address_City, c.Address_Country, c.Address_District, c.Address_PostalCode, c.Address_Street, c.Address_SubNumber, c.CreatedBy, c.CreatedDate, c.CustomerType, c.EmailAddress, c.FullName, c.IdentityNumber, c.IdentityType, c.IsDeleted, c.LastUpdatedDate, c.OverpaymentBalance, c.PhoneNumber, c.VATNumber
        FROM Customers AS c
        WHERE c.IdentityNumber == @__cutomerIdentityNumber_0) | Resolver: c => new RelationalCommandCache(
        c.Dependencies.MemoryCache, 
        c.RelationalDependencies.QuerySqlGeneratorFactory, 
        c.RelationalDependencies.RelationalParameterBasedSqlProcessorFactory, 
        Projection Mapping:
            EmptyProjectionMember -> Dictionary<IProperty, int> { [Property: Customer.Id (long) Required PK AfterSave:Throw ValueGenerated.OnAdd, 0], [Property: Customer.AddressBuildingNumber (string) MaxLength(200), 1], [Property: Customer.AddressCity (string) Required MaxLength(200), 2], [Property: Customer.AddressCountry (string) Required MaxLength(200), 3], [Property: Customer.AddressDistrict (string) Required MaxLength(200), 4], [Property: Customer.AddressPostalCode (string) Required MaxLength(50), 5], [Property: Customer.AddressStreet (string) MaxLength(200), 6], [Property: Customer.AddressSubNumber (string) MaxLength(200), 7], [Property: Customer.CreatedBy (string) Required MaxLength(50), 8], [Property: Customer.CreatedDate (DateTime) Required, 9], [Property: Customer.CustomerType (string) Required MaxLength(100), 10], [Property: Customer.EmailAddress (string) MaxLength(80), 11], [Property: Customer.FullName (string) Required MaxLength(500), 12], [Property: Customer.IdentityNumber (string) Required MaxLength(100), 13], [Property: Customer.IdentityType (int?), 14], [Property: Customer.IsDeleted (bool) Required, 15], [Property: Customer.LastUpdatedDate (DateTime?), 16], [Property: Customer.OverpaymentBalance (decimal?), 17], [Property: Customer.PhoneNumber (string) MaxLength(50), 18], [Property: Customer.Vatnumber (string) MaxLength(100), 19] }
        SELECT TOP(1) c.Id, c.Address_BuildingNumber, c.Address_City, c.Address_Country, c.Address_District, c.Address_PostalCode, c.Address_Street, c.Address_SubNumber, c.CreatedBy, c.CreatedDate, c.CustomerType, c.EmailAddress, c.FullName, c.IdentityNumber, c.IdentityType, c.IsDeleted, c.LastUpdatedDate, c.OverpaymentBalance, c.PhoneNumber, c.VATNumber
        FROM Customers AS c
        WHERE c.IdentityNumber == @__cutomerIdentityNumber_0, 
        False, 
        new HashSet<string>(
            new string[]{ }, 
            StringComparer.Ordinal
        )
    )].GetRelationalCommandTemplate(parameters), 
    readerColumns: null, 
    shaper: (queryContext, dataReader, resultContext, resultCoordinator) => 
    {
        Customer entity;
        entity = 
        {
            MaterializationContext materializationContext1;
            IEntityType entityType1;
            Customer instance1;
            InternalEntityEntry entry1;
            bool hasNullKey1;
            materializationContext1 = new MaterializationContext(
                [LIFTABLE Constant: ValueBuffer | Resolver: _ => (object)ValueBuffer.Empty], 
                queryContext.Context
            );
            instance1 = default(Customer);
            entry1 = queryContext.TryGetEntry(
                key: [LIFTABLE Constant: Key: Customer.Id PK | Resolver: c => c.Dependencies.Model.FindEntityType("BillingSystem.Domain.Entities.Customer").FindPrimaryKey()], 
                keyValues: new object[]{ (object)dataReader.GetInt64(0) }, 
                throwOnNullKey: True, 
                hasNullKey: hasNullKey1);
            !(hasNullKey1) ? entry1 != default(InternalEntityEntry) ? 
            {
                entityType1 = entry1.EntityType;
                return instance1 = (Customer)entry1.Entity;
            } : 
            {
                ISnapshot shadowSnapshot1;
                shadowSnapshot1 = [LIFTABLE Constant: Snapshot | Resolver: _ => Snapshot.Empty];
                entityType1 = [LIFTABLE Constant: EntityType: Customer | Resolver: namelessParameter{0} => namelessParameter{0}.Dependencies.Model.FindEntityType("BillingSystem.Domain.Entities.Customer")];
                instance1 = switch (entityType1)
                {
                    case [LIFTABLE Constant: EntityType: Customer | Resolver: namelessParameter{1} => namelessParameter{1}.Dependencies.Model.FindEntityType("BillingSystem.Domain.Entities.Customer")]: 
                        {
                            return 
                            {
                                Customer instance;
                                instance = new Customer();
                                instance.<Id>k__BackingField = dataReader.GetInt64(0);
                                instance.<AddressBuildingNumber>k__BackingField = dataReader.IsDBNull(1) ? default(string) : dataReader.GetString(1);
                                instance.<AddressCity>k__BackingField = dataReader.GetString(2);
                                instance.<AddressCountry>k__BackingField = dataReader.GetString(3);
                                instance.<AddressDistrict>k__BackingField = dataReader.GetString(4);
                                instance.<AddressPostalCode>k__BackingField = dataReader.GetString(5);
                                instance.<AddressStreet>k__BackingField = dataReader.IsDBNull(6) ? default(string) : dataReader.GetString(6);
                                instance.<AddressSubNumber>k__BackingField = dataReader.IsDBNull(7) ? default(string) : dataReader.GetString(7);
                                instance.<CreatedBy>k__BackingField = dataReader.GetString(8);
                                instance.<CreatedDate>k__BackingField = dataReader.GetDateTime(9);
                                instance.<CustomerType>k__BackingField = dataReader.GetString(10);
                                instance.<EmailAddress>k__BackingField = dataReader.IsDBNull(11) ? default(string) : dataReader.GetString(11);
                                instance.<FullName>k__BackingField = dataReader.GetString(12);
                                instance.<IdentityNumber>k__BackingField = dataReader.GetString(13);
                                instance.<IdentityType>k__BackingField = dataReader.IsDBNull(14) ? default(int?) : (int?)dataReader.GetInt32(14);
                                instance.<IsDeleted>k__BackingField = dataReader.GetBoolean(15);
                                instance.<LastUpdatedDate>k__BackingField = dataReader.IsDBNull(16) ? default(DateTime?) : (DateTime?)dataReader.GetDateTime(16);
                                instance.<OverpaymentBalance>k__BackingField = dataReader.IsDBNull(17) ? default(decimal?) : (decimal?)dataReader.GetDecimal(17);
                                instance.<PhoneNumber>k__BackingField = dataReader.IsDBNull(18) ? default(string) : dataReader.GetString(18);
                                instance.<Vatnumber>k__BackingField = dataReader.IsDBNull(19) ? default(string) : dataReader.GetString(19);
                                (instance is IInjectableService) ? ((IInjectableService)instance).Injected(
                                    context: materializationContext1.Context, 
                                    entity: instance, 
                                    queryTrackingBehavior: TrackAll, 
                                    structuralType: [LIFTABLE Constant: EntityType: Customer | Resolver: namelessParameter{2} => namelessParameter{2}.Dependencies.Model.FindEntityType("BillingSystem.Domain.Entities.Customer")]) : default(void);
                                return instance;
                            }}
                    default: 
                        default(Customer)
                }
                ;
                entry1 = entityType1 == default(IEntityType) ? default(InternalEntityEntry) : queryContext.StartTracking(
                    entityType: entityType1, 
                    entity: instance1, 
                    snapshot: shadowSnapshot1);
                return instance1;
            } : default(void);
            return instance1;
        };
        return entity;
    }, 
    contextType: BillingSystem.Infrastructure.EF.BillingServiceDBContext, 
    standAloneStateManager: False, 
    detailedErrorsEnabled: False, 
    threadSafetyChecksEnabled: True)
    .SingleOrDefault()'
2025-11-18 16:09:33.663 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-11-18 16:09:33.665 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (1ms).
2025-11-18 16:09:33.670 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (6ms).
2025-11-18 16:09:33.675 +03:00 [DBG] Executing DbCommand [Parameters=[@__cutomerIdentityNumber_0='?' (Size = 100)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[Id], [c].[Address_BuildingNumber], [c].[Address_City], [c].[Address_Country], [c].[Address_District], [c].[Address_PostalCode], [c].[Address_Street], [c].[Address_SubNumber], [c].[CreatedBy], [c].[CreatedDate], [c].[CustomerType], [c].[EmailAddress], [c].[FullName], [c].[IdentityNumber], [c].[IdentityType], [c].[IsDeleted], [c].[LastUpdatedDate], [c].[OverpaymentBalance], [c].[PhoneNumber], [c].[VATNumber]
FROM [Customers] AS [c]
WHERE [c].[IdentityNumber] = @__cutomerIdentityNumber_0
2025-11-18 16:09:33.684 +03:00 [INF] Executed DbCommand (9ms) [Parameters=[@__cutomerIdentityNumber_0='?' (Size = 100)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[Id], [c].[Address_BuildingNumber], [c].[Address_City], [c].[Address_Country], [c].[Address_District], [c].[Address_PostalCode], [c].[Address_Street], [c].[Address_SubNumber], [c].[CreatedBy], [c].[CreatedDate], [c].[CustomerType], [c].[EmailAddress], [c].[FullName], [c].[IdentityNumber], [c].[IdentityType], [c].[IsDeleted], [c].[LastUpdatedDate], [c].[OverpaymentBalance], [c].[PhoneNumber], [c].[VATNumber]
FROM [Customers] AS [c]
WHERE [c].[IdentityNumber] = @__cutomerIdentityNumber_0
2025-11-18 16:09:33.732 +03:00 [DBG] Context 'BillingServiceDBContext' started tracking 'Customer' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-11-18 16:09:33.806 +03:00 [DBG] Closing data reader to 'GAC-BillingService' on server '.'.
2025-11-18 16:09:33.814 +03:00 [DBG] A data reader for 'GAC-BillingService' on server '.' is being disposed after spending 123ms reading results.
2025-11-18 16:09:44.269 +03:00 [DBG] 'BillingServiceDBContext' generated a temporary value for the property 'Invoice.Id'. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-11-18 16:09:44.398 +03:00 [DBG] Context 'BillingServiceDBContext' started tracking 'Invoice' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-11-18 16:09:45.166 +03:00 [DBG] SaveChanges starting for 'BillingServiceDBContext'.
2025-11-18 16:09:45.174 +03:00 [DBG] DetectChanges starting for 'BillingServiceDBContext'.
2025-11-18 16:09:45.235 +03:00 [DBG] DetectChanges completed for 'BillingServiceDBContext'.
2025-11-18 16:09:45.315 +03:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-11-18 16:09:45.323 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-11-18 16:09:45.326 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (2ms).
2025-11-18 16:09:45.331 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (7ms).
2025-11-18 16:09:45.335 +03:00 [DBG] Executing DbCommand [Parameters=[@p0='?' (Precision = 18) (DbType = Decimal), @p1='?' (Size = 3000), @p2='?' (Size = 100), @p3='?' (Size = 50), @p4='?' (DbType = DateTime), @p5='?' (Size = 50), @p6='?' (DbType = Int64), @p7='?' (DbType = Int64), @p8='?' (DbType = DateTime), @p9='?' (DbType = Guid), @p10='?' (Size = 50), @p11='?' (DbType = Int32), @p12='?' (DbType = Int32), @p13='?' (DbType = Boolean), @p14='?' (DbType = Boolean), @p15='?' (DbType = Boolean), @p16='?' (DbType = Boolean), @p17='?' (DbType = DateTime), @p18='?' (DbType = DateTime), @p19='?' (Size = 4000), @p20='?' (Size = 100), @p21='?' (Size = 100), @p22='?' (DbType = Int64), @p23='?' (Size = 4000), @p24='?' (DbType = Int64), @p25='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [Invoices] ([Amount], [CancelationReasons], [ClientReferenceNumber], [CreatedBy], [CreatedDate], [Currency], [CustomerID], [DiscountedPrimaryInvoiceID], [DueAt], [ExternalId], [InvoiceNumber], [InvoiceStatus], [InvoiceType], [IsDeleted], [IsDiscounted], [IsSubInvoice], [IsSubstitution], [IssuedAt], [LastUpdatedDate], [Metadata], [PaymentProvider], [PaymentReference], [PrimaryInvoiceID], [ProviderResponse], [SubstitutionPrimaryInvoiceID], [TenantId])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18, @p19, @p20, @p21, @p22, @p23, @p24, @p25);
2025-11-18 16:09:45.356 +03:00 [INF] Executed DbCommand (22ms) [Parameters=[@p0='?' (Precision = 18) (DbType = Decimal), @p1='?' (Size = 3000), @p2='?' (Size = 100), @p3='?' (Size = 50), @p4='?' (DbType = DateTime), @p5='?' (Size = 50), @p6='?' (DbType = Int64), @p7='?' (DbType = Int64), @p8='?' (DbType = DateTime), @p9='?' (DbType = Guid), @p10='?' (Size = 50), @p11='?' (DbType = Int32), @p12='?' (DbType = Int32), @p13='?' (DbType = Boolean), @p14='?' (DbType = Boolean), @p15='?' (DbType = Boolean), @p16='?' (DbType = Boolean), @p17='?' (DbType = DateTime), @p18='?' (DbType = DateTime), @p19='?' (Size = 4000), @p20='?' (Size = 100), @p21='?' (Size = 100), @p22='?' (DbType = Int64), @p23='?' (Size = 4000), @p24='?' (DbType = Int64), @p25='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [Invoices] ([Amount], [CancelationReasons], [ClientReferenceNumber], [CreatedBy], [CreatedDate], [Currency], [CustomerID], [DiscountedPrimaryInvoiceID], [DueAt], [ExternalId], [InvoiceNumber], [InvoiceStatus], [InvoiceType], [IsDeleted], [IsDiscounted], [IsSubInvoice], [IsSubstitution], [IssuedAt], [LastUpdatedDate], [Metadata], [PaymentProvider], [PaymentReference], [PrimaryInvoiceID], [ProviderResponse], [SubstitutionPrimaryInvoiceID], [TenantId])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18, @p19, @p20, @p21, @p22, @p23, @p24, @p25);
2025-11-18 16:09:45.392 +03:00 [DBG] The foreign key property 'Invoice.Id' was detected as changed. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see property values.
2025-11-18 16:09:45.421 +03:00 [DBG] Closing data reader to 'GAC-BillingService' on server '.'.
2025-11-18 16:09:45.425 +03:00 [DBG] A data reader for 'GAC-BillingService' on server '.' is being disposed after spending 52ms reading results.
2025-11-18 16:09:45.439 +03:00 [DBG] An entity of type 'Invoice' tracked by 'BillingServiceDBContext' changed state from '"Added"' to '"Unchanged"'. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-11-18 16:09:45.444 +03:00 [DBG] SaveChanges completed for 'BillingServiceDBContext' with 1 entities written to the database.
2025-11-18 16:09:47.783 +03:00 [DBG] 'BillingServiceDBContext' generated a temporary value for the property 'OutboxEvent.Id'. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-11-18 16:09:47.807 +03:00 [DBG] Context 'BillingServiceDBContext' started tracking 'OutboxEvent' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-11-18 16:09:48.953 +03:00 [DBG] 'BillingServiceDBContext' generated a temporary value for the property 'AuditEvent.Id'. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-11-18 16:09:48.979 +03:00 [DBG] Context 'BillingServiceDBContext' started tracking 'AuditEvent' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-11-18 16:09:51.071 +03:00 [DBG] SaveChanges starting for 'BillingServiceDBContext'.
2025-11-18 16:09:51.075 +03:00 [DBG] DetectChanges starting for 'BillingServiceDBContext'.
2025-11-18 16:09:51.096 +03:00 [DBG] DetectChanges completed for 'BillingServiceDBContext'.
2025-11-18 16:09:51.111 +03:00 [DBG] Executing 2 update commands as a batch.
2025-11-18 16:09:51.117 +03:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-11-18 16:09:51.121 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-11-18 16:09:51.126 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (5ms).
2025-11-18 16:09:51.131 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (10ms).
2025-11-18 16:09:51.135 +03:00 [DBG] Executing DbCommand [Parameters=[@p0='?' (Size = 100), @p1='?' (Size = 4000), @p2='?' (Size = 50), @p3='?' (DbType = DateTime), @p4='?' (Size = 500), @p5='?' (Size = 20), @p6='?' (Size = 100), @p7='?' (Size = 100), @p8='?' (DbType = Int64), @p9='?' (DbType = DateTime), @p10='?' (Size = 4000), @p11='?' (Size = 300), @p12='?' (Size = 4000), @p13='?' (DbType = Boolean), @p14='?' (Size = 20) (DbType = AnsiString)], CommandType='"Text"', CommandTimeout='30']
SET NOCOUNT ON;
INSERT INTO [audit].[AuditEvents] ([Action], [Changes], [CreatedBy], [CreatedDate], [Description], [EntityId], [EntityType], [UserId])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
INSERT INTO [Outbox_events] ([Aggregate_id], [CreatedDate], [ErrorMsg], [Event_type], [Payload], [Processed], [ProcessingStatus])
OUTPUT INSERTED.[Id]
VALUES (@p8, @p9, @p10, @p11, @p12, @p13, @p14);
2025-11-18 16:09:51.144 +03:00 [INF] Executed DbCommand (9ms) [Parameters=[@p0='?' (Size = 100), @p1='?' (Size = 4000), @p2='?' (Size = 50), @p3='?' (DbType = DateTime), @p4='?' (Size = 500), @p5='?' (Size = 20), @p6='?' (Size = 100), @p7='?' (Size = 100), @p8='?' (DbType = Int64), @p9='?' (DbType = DateTime), @p10='?' (Size = 4000), @p11='?' (Size = 300), @p12='?' (Size = 4000), @p13='?' (DbType = Boolean), @p14='?' (Size = 20) (DbType = AnsiString)], CommandType='"Text"', CommandTimeout='30']
SET NOCOUNT ON;
INSERT INTO [audit].[AuditEvents] ([Action], [Changes], [CreatedBy], [CreatedDate], [Description], [EntityId], [EntityType], [UserId])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
INSERT INTO [Outbox_events] ([Aggregate_id], [CreatedDate], [ErrorMsg], [Event_type], [Payload], [Processed], [ProcessingStatus])
OUTPUT INSERTED.[Id]
VALUES (@p8, @p9, @p10, @p11, @p12, @p13, @p14);
2025-11-18 16:09:51.169 +03:00 [DBG] The foreign key property 'AuditEvent.Id' was detected as changed. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see property values.
2025-11-18 16:09:51.176 +03:00 [DBG] The foreign key property 'OutboxEvent.Id' was detected as changed. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see property values.
2025-11-18 16:09:51.181 +03:00 [DBG] Closing data reader to 'GAC-BillingService' on server '.'.
2025-11-18 16:09:51.184 +03:00 [DBG] A data reader for 'GAC-BillingService' on server '.' is being disposed after spending 17ms reading results.
2025-11-18 16:09:51.189 +03:00 [DBG] An entity of type 'OutboxEvent' tracked by 'BillingServiceDBContext' changed state from '"Added"' to '"Unchanged"'. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-11-18 16:09:51.195 +03:00 [DBG] An entity of type 'AuditEvent' tracked by 'BillingServiceDBContext' changed state from '"Added"' to '"Unchanged"'. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-11-18 16:09:51.200 +03:00 [DBG] SaveChanges completed for 'BillingServiceDBContext' with 2 entities written to the database.
2025-11-18 16:09:51.988 +03:00 [DBG] Committing transaction.
2025-11-18 16:09:52.017 +03:00 [DBG] Committed transaction.
2025-11-18 16:09:52.024 +03:00 [DBG] Closing connection to database 'GAC-BillingService' on server '.'.
2025-11-18 16:09:52.030 +03:00 [DBG] Closed connection to database 'GAC-BillingService' on server '.' (5ms).
2025-11-18 16:09:52.645 +03:00 [DBG] Disposing transaction.
2025-11-18 16:10:00.012 +03:00 [DBG] List of registered output formatters, in the following order: ["Microsoft.AspNetCore.Mvc.Formatters.HttpNoContentOutputFormatter","Microsoft.AspNetCore.Mvc.Formatters.StringOutputFormatter","Microsoft.AspNetCore.Mvc.Formatters.StreamOutputFormatter","Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonOutputFormatter"]
2025-11-18 16:10:00.026 +03:00 [DBG] No information found on request to perform content negotiation.
2025-11-18 16:10:00.033 +03:00 [DBG] Attempting to select the first output formatter in the output formatters list which supports a content type from the explicitly specified content types '["application/json"]'.
2025-11-18 16:10:00.046 +03:00 [DBG] Selected output formatter 'Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonOutputFormatter' and content type 'application/json' to write the response.
2025-11-18 16:10:00.058 +03:00 [INF] Executing OkObjectResult, writing value of type 'BillingSystem.SharedKernel.ApiResponse`1[[System.Int64, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-11-18 16:10:00.092 +03:00 [INF] Executed action BillingSystem.API.Controllers.InvoicesController.Post (BillingSystem.API) in 46075.6841ms
2025-11-18 16:10:00.102 +03:00 [INF] Executed endpoint 'BillingSystem.API.Controllers.InvoicesController.Post (BillingSystem.API)'
2025-11-18 16:10:00.109 +03:00 [INF] HTTP POST /api/Invoices responded 200 in 51995.0078 ms
2025-11-18 16:10:00.117 +03:00 [DBG] Connection id "0HNH6K8T6IQ6B" completed keep alive response.
2025-11-18 16:10:00.122 +03:00 [DBG] 'BillingServiceDBContext' disposed.
2025-11-18 16:10:00.130 +03:00 [DBG] Disposing connection to database 'GAC-BillingService' on server '.'.
2025-11-18 16:10:00.135 +03:00 [DBG] Disposed connection to database '' on server '' (4ms).
2025-11-18 16:10:00.138 +03:00 [INF] Request finished HTTP/1.1 POST https://localhost:7257/api/Invoices - 200 null application/json; charset=utf-8 52068.4619ms
2025-11-18 16:22:22.398 +03:00 [DBG] Registered model binder providers, in the following order: ["Microsoft.AspNetCore.Mvc.ModelBinding.Binders.BinderTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ServicesModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.BodyModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.HeaderModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FloatingPointTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.EnumTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.DateTimeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.SimpleTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.TryParseModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.CancellationTokenModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ByteArrayModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FormFileModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FormCollectionModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.KeyValuePairModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.DictionaryModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ArrayModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.CollectionModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ComplexObjectModelBinderProvider"]
2025-11-18 16:22:22.552 +03:00 [DBG] Hosting starting
2025-11-18 16:22:22.965 +03:00 [DBG] Starting bus instances: IBus
2025-11-18 16:22:22.974 +03:00 [DBG] Starting bus: "rabbitmq://localhost/"
2025-11-18 16:22:23.013 +03:00 [DBG] Middleware loaded
2025-11-18 16:22:23.020 +03:00 [DBG] Middleware loaded. Script /_framework/aspnetcore-browser-refresh.js (16519 B).
2025-11-18 16:22:23.047 +03:00 [DBG] Middleware loaded. Script /_framework/blazor-hotreload.js (799 B).
2025-11-18 16:22:23.056 +03:00 [DBG] Connect: guest@localhost:5672/
2025-11-18 16:22:23.276 +03:00 [DBG] Middleware loaded: DOTNET_MODIFIABLE_ASSEMBLIES=debug, __ASPNETCORE_BROWSER_TOOLS=true
2025-11-18 16:22:23.316 +03:00 [DBG] Connected: guest@localhost:5672/ (address: amqp://localhost:5672, local: 51579)
2025-11-18 16:22:23.392 +03:00 [DBG] Endpoint Ready: "rabbitmq://localhost/ECHGHANNAMLP1_BillingSystemAPI_bus_komyyyyh3bcsbd99bdxnpjcnbq?temporary=true"
2025-11-18 16:22:23.398 +03:00 [INF] Bus started: "rabbitmq://localhost/"
2025-11-18 16:22:23.680 +03:00 [INF] Now listening on: https://localhost:7257
2025-11-18 16:22:23.686 +03:00 [INF] Now listening on: http://localhost:5009
2025-11-18 16:22:23.688 +03:00 [DBG] Loaded hosting startup assembly BillingSystem.API
2025-11-18 16:22:23.691 +03:00 [DBG] Loaded hosting startup assembly Microsoft.WebTools.ApiEndpointDiscovery
2025-11-18 16:22:23.697 +03:00 [DBG] Loaded hosting startup assembly Microsoft.AspNetCore.Watch.BrowserRefresh
2025-11-18 16:22:23.699 +03:00 [DBG] Loaded hosting startup assembly Microsoft.WebTools.BrowserLink.Net
2025-11-18 16:22:23.725 +03:00 [DBG] Connection id "0HNH6KM1B0P3F" accepted.
2025-11-18 16:22:23.725 +03:00 [DBG] Connection id "0HNH6KM1B0P3E" accepted.
2025-11-18 16:22:23.734 +03:00 [DBG] Connection id "0HNH6KM1B0P3F" started.
2025-11-18 16:22:23.736 +03:00 [DBG] Connection id "0HNH6KM1B0P3E" started.
2025-11-18 16:22:23.744 +03:00 [DBG] Connection id "0HNH6KM1B0P3E" received FIN.
2025-11-18 16:22:23.744 +03:00 [DBG] Connection id "0HNH6KM1B0P3F" received FIN.
2025-11-18 16:22:23.770 +03:00 [DBG] Failed to authenticate HTTPS connection.
System.IO.IOException: Received an unexpected EOF or 0 bytes from the transport stream.
   at System.Net.Security.SslStream.ReceiveHandshakeFrameAsync[TIOAdapter](CancellationToken cancellationToken)
   at System.Net.Security.SslStream.ForceAuthenticationAsync[TIOAdapter](Boolean receiveFirst, Byte[] reAuthenticationData, CancellationToken cancellationToken)
   at System.Net.Security.SslStream.ProcessAuthenticationWithTelemetryAsync(Boolean isAsync, CancellationToken cancellationToken)
   at Microsoft.AspNetCore.Server.Kestrel.Https.Internal.HttpsConnectionMiddleware.OnConnectionAsync(ConnectionContext context)
2025-11-18 16:22:23.770 +03:00 [DBG] Failed to authenticate HTTPS connection.
System.IO.IOException: Received an unexpected EOF or 0 bytes from the transport stream.
   at System.Net.Security.SslStream.ReceiveHandshakeFrameAsync[TIOAdapter](CancellationToken cancellationToken)
   at System.Net.Security.SslStream.ForceAuthenticationAsync[TIOAdapter](Boolean receiveFirst, Byte[] reAuthenticationData, CancellationToken cancellationToken)
   at System.Net.Security.SslStream.ProcessAuthenticationWithTelemetryAsync(Boolean isAsync, CancellationToken cancellationToken)
   at Microsoft.AspNetCore.Server.Kestrel.Https.Internal.HttpsConnectionMiddleware.OnConnectionAsync(ConnectionContext context)
2025-11-18 16:22:23.822 +03:00 [DBG] Connection id "0HNH6KM1B0P3F" stopped.
2025-11-18 16:22:23.826 +03:00 [DBG] Connection id "0HNH6KM1B0P3E" stopped.
2025-11-18 16:22:23.844 +03:00 [DBG] Connection id "0HNH6KM1B0P3F" sending FIN because: "The Socket transport's send loop completed gracefully."
2025-11-18 16:22:23.844 +03:00 [DBG] Connection id "0HNH6KM1B0P3E" sending FIN because: "The Socket transport's send loop completed gracefully."
2025-11-18 16:22:23.913 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-11-18 16:22:23.917 +03:00 [INF] Hosting environment: Development
2025-11-18 16:22:23.921 +03:00 [INF] Content root path: C:\Repositories\Gac-BillingSystem\src\BillingSystem.API
2025-11-18 16:22:23.925 +03:00 [DBG] Hosting started
2025-11-18 16:22:24.364 +03:00 [DBG] Connection id "0HNH6KM1B0P3G" accepted.
2025-11-18 16:22:24.367 +03:00 [DBG] Connection id "0HNH6KM1B0P3G" started.
2025-11-18 16:22:24.438 +03:00 [DBG] Connection 0HNH6KM1B0P3G established using the following protocol: "Tls13"
2025-11-18 16:22:24.521 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7257/swagger/index.html - null null
2025-11-18 16:22:24.579 +03:00 [DBG] Wildcard detected, all requests with hosts will be allowed.
2025-11-18 16:22:24.601 +03:00 [DBG] No candidates found for the request path '/swagger/index.html'
2025-11-18 16:22:24.604 +03:00 [DBG] Request did not match any endpoints
2025-11-18 16:22:24.694 +03:00 [DBG] Response markup is scheduled to include Browser Link script injection.
2025-11-18 16:22:24.698 +03:00 [DBG] Response markup is scheduled to include browser refresh script injection.
2025-11-18 16:22:24.733 +03:00 [INF] HTTP GET /swagger/index.html responded 200 in 120.2341 ms
2025-11-18 16:22:24.744 +03:00 [DBG] Response markup was updated to include Browser Link script injection.
2025-11-18 16:22:24.752 +03:00 [DBG] Response markup was updated to include browser refresh script injection.
2025-11-18 16:22:24.767 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7257/swagger/index.html - 200 null text/html;charset=utf-8 259.5234ms
2025-11-18 16:22:24.824 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7257/_vs/browserLink - null null
2025-11-18 16:22:24.824 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7257/_framework/aspnetcore-browser-refresh.js - null null
2025-11-18 16:22:24.845 +03:00 [DBG] Script injected: /_framework/aspnetcore-browser-refresh.js
2025-11-18 16:22:24.850 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7257/_framework/aspnetcore-browser-refresh.js - 200 16519 application/javascript; charset=utf-8 25.9834ms
2025-11-18 16:22:24.899 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7257/_vs/browserLink - 200 null text/javascript; charset=UTF-8 74.8963ms
2025-11-18 16:22:24.967 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7257/swagger/v1/swagger.json - null null
2025-11-18 16:22:24.976 +03:00 [DBG] No candidates found for the request path '/swagger/v1/swagger.json'
2025-11-18 16:22:24.979 +03:00 [DBG] Request did not match any endpoints
2025-11-18 16:22:25.005 +03:00 [INF] HTTP GET /swagger/v1/swagger.json responded 200 in 22.9972 ms
2025-11-18 16:22:25.012 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7257/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 46.1217ms
2025-11-18 16:23:09.466 +03:00 [DBG] Connection id "0HNH6KM1B0P3H" accepted.
2025-11-18 16:23:09.466 +03:00 [DBG] Connection id "0HNH6KM1B0P3H" received FIN.
2025-11-18 16:23:09.479 +03:00 [DBG] Connection id "0HNH6KM1B0P3H" started.
2025-11-18 16:23:09.481 +03:00 [DBG] Connection id "0HNH6KM1B0P3I" accepted.
2025-11-18 16:23:09.503 +03:00 [DBG] Failed to authenticate HTTPS connection.
System.IO.IOException: Received an unexpected EOF or 0 bytes from the transport stream.
   at System.Net.Security.SslStream.ReceiveHandshakeFrameAsync[TIOAdapter](CancellationToken cancellationToken)
   at System.Net.Security.SslStream.ForceAuthenticationAsync[TIOAdapter](Boolean receiveFirst, Byte[] reAuthenticationData, CancellationToken cancellationToken)
   at System.Net.Security.SslStream.ProcessAuthenticationWithTelemetryAsync(Boolean isAsync, CancellationToken cancellationToken)
   at Microsoft.AspNetCore.Server.Kestrel.Https.Internal.HttpsConnectionMiddleware.OnConnectionAsync(ConnectionContext context)
2025-11-18 16:23:09.504 +03:00 [DBG] Connection id "0HNH6KM1B0P3I" started.
2025-11-18 16:23:09.510 +03:00 [DBG] Connection id "0HNH6KM1B0P3H" stopped.
2025-11-18 16:23:09.516 +03:00 [DBG] Connection id "0HNH6KM1B0P3H" sending FIN because: "The Socket transport's send loop completed gracefully."
2025-11-18 16:23:09.520 +03:00 [DBG] Connection 0HNH6KM1B0P3I established using the following protocol: "Tls13"
2025-11-18 16:23:09.528 +03:00 [INF] Request starting HTTP/1.1 POST https://localhost:7257/api/Invoices - application/json 1380
2025-11-18 16:23:09.537 +03:00 [DBG] 1 candidate(s) found for the request path '/api/Invoices'
2025-11-18 16:23:09.547 +03:00 [DBG] Endpoint 'BillingSystem.API.Controllers.InvoicesController.Post (BillingSystem.API)' with route pattern 'api/Invoices' is valid for the request path '/api/Invoices'
2025-11-18 16:23:09.552 +03:00 [DBG] Request matched endpoint 'BillingSystem.API.Controllers.InvoicesController.Post (BillingSystem.API)'
2025-11-18 16:23:09.559 +03:00 [DBG] Static files was skipped as the request already matched an endpoint.
2025-11-18 16:23:09.788 +03:00 [DBG] An 'IServiceProvider' was created for internal use by Entity Framework.
2025-11-18 16:23:15.284 +03:00 [INF] Executing endpoint 'BillingSystem.API.Controllers.InvoicesController.Post (BillingSystem.API)'
2025-11-18 16:23:15.348 +03:00 [INF] Route matched with {action = "Post", controller = "Invoices"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Post(BillingSystem.Application.Requests.CreateInvoiceRequest) on controller BillingSystem.API.Controllers.InvoicesController (BillingSystem.API).
2025-11-18 16:23:15.359 +03:00 [DBG] Execution plan of authorization filters (in the following order): ["None"]
2025-11-18 16:23:15.364 +03:00 [DBG] Execution plan of resource filters (in the following order): ["None"]
2025-11-18 16:23:15.370 +03:00 [DBG] Execution plan of action filters (in the following order): ["Microsoft.AspNetCore.Mvc.ModelBinding.UnsupportedContentTypeFilter (Order: -3000)","Microsoft.AspNetCore.Mvc.Infrastructure.ModelStateInvalidFilter (Order: -2000)","BillingSystem.API.ActionFilters.AuditBillingRequestsFilter","BillingSystem.API.ActionFilters.IdempotencyFilter (Order: 0)"]
2025-11-18 16:23:15.376 +03:00 [DBG] Execution plan of exception filters (in the following order): ["None"]
2025-11-18 16:23:15.380 +03:00 [DBG] Execution plan of result filters (in the following order): ["Microsoft.AspNetCore.Mvc.Infrastructure.ClientErrorResultFilter (Order: -2000)","Microsoft.AspNetCore.Mvc.ProducesAttribute (Order: 0)","BillingSystem.API.ActionFilters.IdempotencyFilter (Order: 0)"]
2025-11-18 16:23:15.387 +03:00 [DBG] Executing controller factory for controller BillingSystem.API.Controllers.InvoicesController (BillingSystem.API)
2025-11-18 16:23:15.395 +03:00 [WRN] You do not have a valid license key for the Lucky Penny software MediatR. This is allowed for development and testing scenarios. If you are running in production you are required to have a licensed version. Please visit https://luckypennysoftware.com to obtain a valid license.
2025-11-18 16:23:15.441 +03:00 [DBG] Executed controller factory for controller BillingSystem.API.Controllers.InvoicesController (BillingSystem.API)
2025-11-18 16:23:15.468 +03:00 [DBG] Attempting to bind parameter 'invoiceRequest' of type 'BillingSystem.Application.Requests.CreateInvoiceRequest' ...
2025-11-18 16:23:15.478 +03:00 [DBG] Attempting to bind parameter 'invoiceRequest' of type 'BillingSystem.Application.Requests.CreateInvoiceRequest' using the name '' in request data ...
2025-11-18 16:23:15.483 +03:00 [DBG] Selected input formatter 'Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonInputFormatter' for content type 'application/json'.
2025-11-18 16:23:15.523 +03:00 [DBG] Connection id "0HNH6KM1B0P3I", Request id "0HNH6KM1B0P3I:00000001": started reading request body.
2025-11-18 16:23:15.529 +03:00 [DBG] Connection id "0HNH6KM1B0P3I", Request id "0HNH6KM1B0P3I:00000001": done reading request body.
2025-11-18 16:23:15.574 +03:00 [DBG] JSON input formatter succeeded, deserializing to type 'BillingSystem.Application.Requests.CreateInvoiceRequest'
2025-11-18 16:23:15.581 +03:00 [DBG] Done attempting to bind parameter 'invoiceRequest' of type 'BillingSystem.Application.Requests.CreateInvoiceRequest'.
2025-11-18 16:23:15.587 +03:00 [DBG] Done attempting to bind parameter 'invoiceRequest' of type 'BillingSystem.Application.Requests.CreateInvoiceRequest'.
2025-11-18 16:23:15.591 +03:00 [DBG] Attempting to validate the bound parameter 'invoiceRequest' of type 'BillingSystem.Application.Requests.CreateInvoiceRequest' ...
2025-11-18 16:23:15.625 +03:00 [DBG] Done attempting to validate the bound parameter 'invoiceRequest' of type 'BillingSystem.Application.Requests.CreateInvoiceRequest'.
2025-11-18 16:23:15.944 +03:00 [DBG] No relationship from 'Invoice' to 'Invoice' has been configured by convention because there are multiple properties on one entity type - {'DiscountedPrimaryInvoice'} that could be matched with the properties on the other entity type - {'InverseDiscountedPrimaryInvoice', 'InversePrimaryInvoice', 'InverseSubstitutionPrimaryInvoice', 'PrimaryInvoice', 'SubstitutionPrimaryInvoice'}. This message can be disregarded if explicit configuration has been specified in 'OnModelCreating'.
2025-11-18 16:23:16.195 +03:00 [DBG] No relationship from 'Invoice' to 'Invoice' has been configured by convention because there are multiple properties on one entity type - {'DiscountedPrimaryInvoice'} that could be matched with the properties on the other entity type - {'InverseDiscountedPrimaryInvoice', 'InversePrimaryInvoice', 'InverseSubstitutionPrimaryInvoice', 'PrimaryInvoice', 'SubstitutionPrimaryInvoice'}. This message can be disregarded if explicit configuration has been specified in 'OnModelCreating'.
2025-11-18 16:23:16.210 +03:00 [DBG] No relationship from 'Invoice' to 'Invoice' has been configured by convention because there are multiple properties on one entity type - {'InversePrimaryInvoice'} that could be matched with the properties on the other entity type - {'InverseSubstitutionPrimaryInvoice', 'PrimaryInvoice', 'SubstitutionPrimaryInvoice'}. This message can be disregarded if explicit configuration has been specified in 'OnModelCreating'.
2025-11-18 16:23:16.221 +03:00 [DBG] No relationship from 'Invoice' to 'Invoice' has been configured by convention because there are multiple properties on one entity type - {'InversePrimaryInvoice'} that could be matched with the properties on the other entity type - {'InverseSubstitutionPrimaryInvoice', 'PrimaryInvoice', 'SubstitutionPrimaryInvoice'}. This message can be disregarded if explicit configuration has been specified in 'OnModelCreating'.
2025-11-18 16:23:16.711 +03:00 [DBG] Entity Framework Core 9.0.9 initialized 'BillingServiceDBContext' using provider 'Microsoft.EntityFrameworkCore.SqlServer:9.0.9' with options: EngineType=SqlServer 
2025-11-18 16:23:16.875 +03:00 [DBG] Compiling query expression: 
'DbSet<Invoice>()
    .AsNoTracking()
    .Any(inv => inv.ExternalId.ToString() == __idempotentKey_0)'
2025-11-18 16:23:17.211 +03:00 [DBG] Generated query execution expression: 
'queryContext => ShapedQueryCompilingExpressionVisitor.SingleAsync<bool>(
    asyncEnumerable: SingleQueryingEnumerable.Create<bool>(
        relationalQueryContext: (RelationalQueryContext)queryContext, 
        relationalCommandResolver: parameters => [LIFTABLE Constant: RelationalCommandCache.QueryExpression(
            Projection Mapping:
                EmptyProjectionMember -> 0
            SELECT EXISTS (
                SELECT 1
                FROM Invoices AS i
                WHERE COALESCE(CONVERT(varchar(36), i.ExternalId), '') == @__idempotentKey_0)) | Resolver: c => new RelationalCommandCache(
            c.Dependencies.MemoryCache, 
            c.RelationalDependencies.QuerySqlGeneratorFactory, 
            c.RelationalDependencies.RelationalParameterBasedSqlProcessorFactory, 
            Projection Mapping:
                EmptyProjectionMember -> 0
            SELECT EXISTS (
                SELECT 1
                FROM Invoices AS i
                WHERE COALESCE(CONVERT(varchar(36), i.ExternalId), '') == @__idempotentKey_0), 
            False, 
            new HashSet<string>(
                new string[]{ }, 
                StringComparer.Ordinal
            )
        )].GetRelationalCommandTemplate(parameters), 
        readerColumns: null, 
        shaper: (queryContext, dataReader, resultContext, resultCoordinator) => 
        {
            bool? value1;
            value1 = dataReader.IsDBNull(0) ? default(bool?) : (bool?)dataReader.GetBoolean(0);
            return (bool)value1;
        }, 
        contextType: BillingSystem.Infrastructure.EF.BillingServiceDBContext, 
        standAloneStateManager: False, 
        detailedErrorsEnabled: False, 
        threadSafetyChecksEnabled: True), 
    cancellationToken: queryContext.CancellationToken)'
2025-11-18 16:23:17.271 +03:00 [DBG] Creating DbConnection.
2025-11-18 16:23:17.300 +03:00 [DBG] Created DbConnection. (26ms).
2025-11-18 16:23:17.307 +03:00 [DBG] Opening connection to database 'GAC-BillingService' on server '.'.
2025-11-18 16:23:17.689 +03:00 [DBG] Opened connection to database 'GAC-BillingService' on server '.'.
2025-11-18 16:23:17.699 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-11-18 16:23:17.714 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (10ms).
2025-11-18 16:23:17.730 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (33ms).
2025-11-18 16:23:17.748 +03:00 [DBG] Executing DbCommand [Parameters=[@__idempotentKey_0='?' (Size = 36) (DbType = AnsiString)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [Invoices] AS [i]
        WHERE CONVERT(varchar(36), [i].[ExternalId]) = @__idempotentKey_0) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2025-11-18 16:23:17.853 +03:00 [INF] Executed DbCommand (104ms) [Parameters=[@__idempotentKey_0='?' (Size = 36) (DbType = AnsiString)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [Invoices] AS [i]
        WHERE CONVERT(varchar(36), [i].[ExternalId]) = @__idempotentKey_0) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2025-11-18 16:23:17.900 +03:00 [DBG] Closing data reader to 'GAC-BillingService' on server '.'.
2025-11-18 16:23:17.922 +03:00 [DBG] A data reader for 'GAC-BillingService' on server '.' is being disposed after spending 47ms reading results.
2025-11-18 16:23:17.933 +03:00 [DBG] Closing connection to database 'GAC-BillingService' on server '.'.
2025-11-18 16:23:17.947 +03:00 [DBG] Closed connection to database 'GAC-BillingService' on server '.' (13ms).
2025-11-18 16:23:17.955 +03:00 [DBG] Request was short circuited at action filter 'BillingSystem.API.ActionFilters.IdempotencyFilter'.
2025-11-18 16:23:17.982 +03:00 [DBG] List of registered output formatters, in the following order: ["Microsoft.AspNetCore.Mvc.Formatters.HttpNoContentOutputFormatter","Microsoft.AspNetCore.Mvc.Formatters.StringOutputFormatter","Microsoft.AspNetCore.Mvc.Formatters.StreamOutputFormatter","Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonOutputFormatter"]
2025-11-18 16:23:17.996 +03:00 [DBG] No information found on request to perform content negotiation.
2025-11-18 16:23:18.002 +03:00 [DBG] Attempting to select the first output formatter in the output formatters list which supports a content type from the explicitly specified content types '["application/json"]'.
2025-11-18 16:23:18.015 +03:00 [DBG] Selected output formatter 'Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonOutputFormatter' and content type 'application/json' to write the response.
2025-11-18 16:23:18.023 +03:00 [INF] Executing ConflictObjectResult, writing value of type 'System.String'.
2025-11-18 16:23:18.051 +03:00 [INF] Executed action BillingSystem.API.Controllers.InvoicesController.Post (BillingSystem.API) in 2657.118ms
2025-11-18 16:23:18.060 +03:00 [INF] Executed endpoint 'BillingSystem.API.Controllers.InvoicesController.Post (BillingSystem.API)'
2025-11-18 16:23:18.064 +03:00 [INF] HTTP POST /api/Invoices responded 409 in 8506.6098 ms
2025-11-18 16:23:18.071 +03:00 [DBG] Connection id "0HNH6KM1B0P3I" completed keep alive response.
2025-11-18 16:23:18.081 +03:00 [DBG] 'BillingServiceDBContext' disposed.
2025-11-18 16:23:18.092 +03:00 [DBG] Disposing connection to database 'GAC-BillingService' on server '.'.
2025-11-18 16:23:18.103 +03:00 [DBG] Disposed connection to database '' on server '' (10ms).
2025-11-18 16:23:18.108 +03:00 [INF] Request finished HTTP/1.1 POST https://localhost:7257/api/Invoices - 409 null application/json; charset=utf-8 8580.2265ms
2025-11-18 16:33:14.040 +03:00 [DBG] Connection id "0HNH6KM1B0P3J" accepted.
2025-11-18 16:33:14.041 +03:00 [DBG] Connection id "0HNH6KM1B0P3J" received FIN.
2025-11-18 16:33:14.045 +03:00 [DBG] Connection id "0HNH6KM1B0P3J" started.
2025-11-18 16:33:14.045 +03:00 [DBG] Connection id "0HNH6KM1B0P3K" accepted.
2025-11-18 16:33:14.060 +03:00 [DBG] Failed to authenticate HTTPS connection.
System.IO.IOException: Received an unexpected EOF or 0 bytes from the transport stream.
   at System.Net.Security.SslStream.ReceiveHandshakeFrameAsync[TIOAdapter](CancellationToken cancellationToken)
   at System.Net.Security.SslStream.ForceAuthenticationAsync[TIOAdapter](Boolean receiveFirst, Byte[] reAuthenticationData, CancellationToken cancellationToken)
   at System.Net.Security.SslStream.ProcessAuthenticationWithTelemetryAsync(Boolean isAsync, CancellationToken cancellationToken)
   at Microsoft.AspNetCore.Server.Kestrel.Https.Internal.HttpsConnectionMiddleware.OnConnectionAsync(ConnectionContext context)
2025-11-18 16:33:14.062 +03:00 [DBG] Connection id "0HNH6KM1B0P3K" started.
2025-11-18 16:33:14.068 +03:00 [DBG] Connection id "0HNH6KM1B0P3J" stopped.
2025-11-18 16:33:14.072 +03:00 [DBG] Connection id "0HNH6KM1B0P3J" sending FIN because: "The Socket transport's send loop completed gracefully."
2025-11-18 16:33:14.075 +03:00 [DBG] Connection 0HNH6KM1B0P3K established using the following protocol: "Tls13"
2025-11-18 16:33:14.080 +03:00 [INF] Request starting HTTP/1.1 POST https://localhost:7257/api/Invoices - application/json 1380
2025-11-18 16:33:14.085 +03:00 [DBG] 1 candidate(s) found for the request path '/api/Invoices'
2025-11-18 16:33:14.089 +03:00 [DBG] Endpoint 'BillingSystem.API.Controllers.InvoicesController.Post (BillingSystem.API)' with route pattern 'api/Invoices' is valid for the request path '/api/Invoices'
2025-11-18 16:33:14.092 +03:00 [DBG] Request matched endpoint 'BillingSystem.API.Controllers.InvoicesController.Post (BillingSystem.API)'
2025-11-18 16:33:14.095 +03:00 [DBG] Static files was skipped as the request already matched an endpoint.
2025-11-18 16:33:14.103 +03:00 [INF] Executing endpoint 'BillingSystem.API.Controllers.InvoicesController.Post (BillingSystem.API)'
2025-11-18 16:33:14.107 +03:00 [INF] Route matched with {action = "Post", controller = "Invoices"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Post(BillingSystem.Application.Requests.CreateInvoiceRequest) on controller BillingSystem.API.Controllers.InvoicesController (BillingSystem.API).
2025-11-18 16:33:14.114 +03:00 [DBG] Execution plan of authorization filters (in the following order): ["None"]
2025-11-18 16:33:14.117 +03:00 [DBG] Execution plan of resource filters (in the following order): ["None"]
2025-11-18 16:33:14.120 +03:00 [DBG] Execution plan of action filters (in the following order): ["Microsoft.AspNetCore.Mvc.ModelBinding.UnsupportedContentTypeFilter (Order: -3000)","Microsoft.AspNetCore.Mvc.Infrastructure.ModelStateInvalidFilter (Order: -2000)","BillingSystem.API.ActionFilters.AuditBillingRequestsFilter","BillingSystem.API.ActionFilters.IdempotencyFilter (Order: 0)"]
2025-11-18 16:33:14.130 +03:00 [DBG] Execution plan of exception filters (in the following order): ["None"]
2025-11-18 16:33:14.134 +03:00 [DBG] Execution plan of result filters (in the following order): ["Microsoft.AspNetCore.Mvc.Infrastructure.ClientErrorResultFilter (Order: -2000)","Microsoft.AspNetCore.Mvc.ProducesAttribute (Order: 0)","BillingSystem.API.ActionFilters.IdempotencyFilter (Order: 0)"]
2025-11-18 16:33:14.138 +03:00 [DBG] Executing controller factory for controller BillingSystem.API.Controllers.InvoicesController (BillingSystem.API)
2025-11-18 16:33:14.151 +03:00 [DBG] Executed controller factory for controller BillingSystem.API.Controllers.InvoicesController (BillingSystem.API)
2025-11-18 16:33:14.157 +03:00 [DBG] Attempting to bind parameter 'invoiceRequest' of type 'BillingSystem.Application.Requests.CreateInvoiceRequest' ...
2025-11-18 16:33:14.161 +03:00 [DBG] Attempting to bind parameter 'invoiceRequest' of type 'BillingSystem.Application.Requests.CreateInvoiceRequest' using the name '' in request data ...
2025-11-18 16:33:14.164 +03:00 [DBG] Selected input formatter 'Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonInputFormatter' for content type 'application/json'.
2025-11-18 16:33:14.168 +03:00 [DBG] Connection id "0HNH6KM1B0P3K", Request id "0HNH6KM1B0P3K:00000001": started reading request body.
2025-11-18 16:33:14.171 +03:00 [DBG] Connection id "0HNH6KM1B0P3K", Request id "0HNH6KM1B0P3K:00000001": done reading request body.
2025-11-18 16:33:14.178 +03:00 [DBG] JSON input formatter succeeded, deserializing to type 'BillingSystem.Application.Requests.CreateInvoiceRequest'
2025-11-18 16:33:14.181 +03:00 [DBG] Done attempting to bind parameter 'invoiceRequest' of type 'BillingSystem.Application.Requests.CreateInvoiceRequest'.
2025-11-18 16:33:14.184 +03:00 [DBG] Done attempting to bind parameter 'invoiceRequest' of type 'BillingSystem.Application.Requests.CreateInvoiceRequest'.
2025-11-18 16:33:14.187 +03:00 [DBG] Attempting to validate the bound parameter 'invoiceRequest' of type 'BillingSystem.Application.Requests.CreateInvoiceRequest' ...
2025-11-18 16:33:14.191 +03:00 [DBG] Done attempting to validate the bound parameter 'invoiceRequest' of type 'BillingSystem.Application.Requests.CreateInvoiceRequest'.
2025-11-18 16:33:14.221 +03:00 [DBG] Entity Framework Core 9.0.9 initialized 'BillingServiceDBContext' using provider 'Microsoft.EntityFrameworkCore.SqlServer:9.0.9' with options: EngineType=SqlServer 
2025-11-18 16:33:14.236 +03:00 [DBG] Creating DbConnection.
2025-11-18 16:33:14.239 +03:00 [DBG] Created DbConnection. (2ms).
2025-11-18 16:33:14.242 +03:00 [DBG] Opening connection to database 'GAC-BillingService' on server '.'.
2025-11-18 16:33:14.274 +03:00 [DBG] Opened connection to database 'GAC-BillingService' on server '.'.
2025-11-18 16:33:14.285 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-11-18 16:33:14.289 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (3ms).
2025-11-18 16:33:14.292 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (7ms).
2025-11-18 16:33:14.297 +03:00 [DBG] Executing DbCommand [Parameters=[@__idempotentKey_0='?' (Size = 36) (DbType = AnsiString)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [Invoices] AS [i]
        WHERE CONVERT(varchar(36), [i].[ExternalId]) = @__idempotentKey_0) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2025-11-18 16:33:14.312 +03:00 [INF] Executed DbCommand (16ms) [Parameters=[@__idempotentKey_0='?' (Size = 36) (DbType = AnsiString)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [Invoices] AS [i]
        WHERE CONVERT(varchar(36), [i].[ExternalId]) = @__idempotentKey_0) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2025-11-18 16:33:14.318 +03:00 [DBG] Closing data reader to 'GAC-BillingService' on server '.'.
2025-11-18 16:33:14.321 +03:00 [DBG] A data reader for 'GAC-BillingService' on server '.' is being disposed after spending 4ms reading results.
2025-11-18 16:33:14.325 +03:00 [DBG] Closing connection to database 'GAC-BillingService' on server '.'.
2025-11-18 16:33:14.330 +03:00 [DBG] Closed connection to database 'GAC-BillingService' on server '.' (5ms).
2025-11-18 16:33:14.506 +03:00 [WRN] You do not have a valid license key for the Lucky Penny software AutoMapper. This is allowed for development and testing scenarios. If you are running in production you are required to have a licensed version. Please visit https://luckypennysoftware.com to obtain a valid license.
2025-11-18 16:34:21.502 +03:00 [DBG] Registered model binder providers, in the following order: ["Microsoft.AspNetCore.Mvc.ModelBinding.Binders.BinderTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ServicesModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.BodyModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.HeaderModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FloatingPointTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.EnumTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.DateTimeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.SimpleTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.TryParseModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.CancellationTokenModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ByteArrayModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FormFileModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FormCollectionModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.KeyValuePairModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.DictionaryModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ArrayModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.CollectionModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ComplexObjectModelBinderProvider"]
2025-11-18 16:34:21.717 +03:00 [DBG] Hosting starting
2025-11-18 16:34:22.150 +03:00 [DBG] Starting bus instances: IBus
2025-11-18 16:34:22.158 +03:00 [DBG] Starting bus: "rabbitmq://localhost/"
2025-11-18 16:34:22.191 +03:00 [DBG] Middleware loaded
2025-11-18 16:34:22.196 +03:00 [DBG] Middleware loaded. Script /_framework/aspnetcore-browser-refresh.js (16519 B).
2025-11-18 16:34:22.206 +03:00 [DBG] Middleware loaded. Script /_framework/blazor-hotreload.js (799 B).
2025-11-18 16:34:22.226 +03:00 [DBG] Connect: guest@localhost:5672/
2025-11-18 16:34:22.403 +03:00 [DBG] Middleware loaded: DOTNET_MODIFIABLE_ASSEMBLIES=debug, __ASPNETCORE_BROWSER_TOOLS=true
2025-11-18 16:34:22.441 +03:00 [DBG] Connected: guest@localhost:5672/ (address: amqp://localhost:5672, local: 61928)
2025-11-18 16:34:22.505 +03:00 [DBG] Endpoint Ready: "rabbitmq://localhost/ECHGHANNAMLP1_BillingSystemAPI_bus_1bfyyyyh3bcsypgjbdxnpj3qg3?temporary=true"
2025-11-18 16:34:22.509 +03:00 [INF] Bus started: "rabbitmq://localhost/"
2025-11-18 16:34:22.697 +03:00 [INF] Now listening on: https://localhost:7257
2025-11-18 16:34:22.703 +03:00 [INF] Now listening on: http://localhost:5009
2025-11-18 16:34:22.705 +03:00 [DBG] Loaded hosting startup assembly BillingSystem.API
2025-11-18 16:34:22.707 +03:00 [DBG] Loaded hosting startup assembly Microsoft.WebTools.ApiEndpointDiscovery
2025-11-18 16:34:22.709 +03:00 [DBG] Loaded hosting startup assembly Microsoft.AspNetCore.Watch.BrowserRefresh
2025-11-18 16:34:22.712 +03:00 [DBG] Loaded hosting startup assembly Microsoft.WebTools.BrowserLink.Net
2025-11-18 16:34:22.858 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-11-18 16:34:22.861 +03:00 [INF] Hosting environment: Development
2025-11-18 16:34:22.864 +03:00 [INF] Content root path: C:\Repositories\Gac-BillingSystem\src\BillingSystem.API
2025-11-18 16:34:22.867 +03:00 [DBG] Hosting started
2025-11-18 16:34:22.871 +03:00 [DBG] Connection id "0HNH6KSNLAM20" accepted.
2025-11-18 16:34:22.878 +03:00 [DBG] Connection id "0HNH6KSNLAM20" started.
2025-11-18 16:34:22.904 +03:00 [DBG] Connection id "0HNH6KSNLAM20" received FIN.
2025-11-18 16:34:22.922 +03:00 [DBG] Failed to authenticate HTTPS connection.
System.IO.IOException: Received an unexpected EOF or 0 bytes from the transport stream.
   at System.Net.Security.SslStream.ReceiveHandshakeFrameAsync[TIOAdapter](CancellationToken cancellationToken)
   at System.Net.Security.SslStream.ForceAuthenticationAsync[TIOAdapter](Boolean receiveFirst, Byte[] reAuthenticationData, CancellationToken cancellationToken)
   at System.Net.Security.SslStream.ProcessAuthenticationWithTelemetryAsync(Boolean isAsync, CancellationToken cancellationToken)
   at Microsoft.AspNetCore.Server.Kestrel.Https.Internal.HttpsConnectionMiddleware.OnConnectionAsync(ConnectionContext context)
2025-11-18 16:34:22.954 +03:00 [DBG] Connection id "0HNH6KSNLAM20" stopped.
2025-11-18 16:34:22.964 +03:00 [DBG] Connection id "0HNH6KSNLAM20" sending FIN because: "The Socket transport's send loop completed gracefully."
2025-11-18 16:34:23.727 +03:00 [DBG] Connection id "0HNH6KSNLAM21" accepted.
2025-11-18 16:34:23.731 +03:00 [DBG] Connection id "0HNH6KSNLAM21" started.
2025-11-18 16:34:23.804 +03:00 [DBG] Connection 0HNH6KSNLAM21 established using the following protocol: "Tls13"
2025-11-18 16:34:23.886 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7257/swagger/index.html - null null
2025-11-18 16:34:23.954 +03:00 [DBG] Wildcard detected, all requests with hosts will be allowed.
2025-11-18 16:34:23.993 +03:00 [DBG] No candidates found for the request path '/swagger/index.html'
2025-11-18 16:34:23.999 +03:00 [DBG] Request did not match any endpoints
2025-11-18 16:34:24.108 +03:00 [DBG] Response markup is scheduled to include Browser Link script injection.
2025-11-18 16:34:24.114 +03:00 [DBG] Response markup is scheduled to include browser refresh script injection.
2025-11-18 16:34:24.144 +03:00 [INF] HTTP GET /swagger/index.html responded 200 in 130.2329 ms
2025-11-18 16:34:24.152 +03:00 [DBG] Response markup was updated to include Browser Link script injection.
2025-11-18 16:34:24.155 +03:00 [DBG] Response markup was updated to include browser refresh script injection.
2025-11-18 16:34:24.162 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7257/swagger/index.html - 200 null text/html;charset=utf-8 286.3936ms
2025-11-18 16:34:24.206 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7257/_vs/browserLink - null null
2025-11-18 16:34:24.206 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7257/_framework/aspnetcore-browser-refresh.js - null null
2025-11-18 16:34:24.238 +03:00 [DBG] Script injected: /_framework/aspnetcore-browser-refresh.js
2025-11-18 16:34:24.244 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7257/_framework/aspnetcore-browser-refresh.js - 200 16519 application/javascript; charset=utf-8 38.5886ms
2025-11-18 16:34:24.287 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7257/_vs/browserLink - 200 null text/javascript; charset=UTF-8 81.6272ms
2025-11-18 16:34:24.388 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7257/swagger/v1/swagger.json - null null
2025-11-18 16:34:24.395 +03:00 [DBG] No candidates found for the request path '/swagger/v1/swagger.json'
2025-11-18 16:34:24.398 +03:00 [DBG] Request did not match any endpoints
2025-11-18 16:34:24.424 +03:00 [INF] HTTP GET /swagger/v1/swagger.json responded 200 in 21.8134 ms
2025-11-18 16:34:24.433 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7257/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 46.0507ms
2025-11-18 16:34:26.893 +03:00 [DBG] Connection id "0HNH6KSNLAM22" accepted.
2025-11-18 16:34:26.893 +03:00 [DBG] Connection id "0HNH6KSNLAM22" received FIN.
2025-11-18 16:34:26.901 +03:00 [DBG] Connection id "0HNH6KSNLAM22" started.
2025-11-18 16:34:26.903 +03:00 [DBG] Connection id "0HNH6KSNLAM23" accepted.
2025-11-18 16:34:26.915 +03:00 [DBG] Failed to authenticate HTTPS connection.
System.IO.IOException: Received an unexpected EOF or 0 bytes from the transport stream.
   at System.Net.Security.SslStream.ReceiveHandshakeFrameAsync[TIOAdapter](CancellationToken cancellationToken)
   at System.Net.Security.SslStream.ForceAuthenticationAsync[TIOAdapter](Boolean receiveFirst, Byte[] reAuthenticationData, CancellationToken cancellationToken)
   at System.Net.Security.SslStream.ProcessAuthenticationWithTelemetryAsync(Boolean isAsync, CancellationToken cancellationToken)
   at Microsoft.AspNetCore.Server.Kestrel.Https.Internal.HttpsConnectionMiddleware.OnConnectionAsync(ConnectionContext context)
2025-11-18 16:34:26.918 +03:00 [DBG] Connection id "0HNH6KSNLAM23" started.
2025-11-18 16:34:26.929 +03:00 [DBG] Connection id "0HNH6KSNLAM22" stopped.
2025-11-18 16:34:26.941 +03:00 [DBG] Connection id "0HNH6KSNLAM22" sending FIN because: "The Socket transport's send loop completed gracefully."
2025-11-18 16:34:26.947 +03:00 [DBG] Connection 0HNH6KSNLAM23 established using the following protocol: "Tls13"
2025-11-18 16:34:26.968 +03:00 [INF] Request starting HTTP/1.1 POST https://localhost:7257/api/Invoices - application/json 1380
2025-11-18 16:34:26.982 +03:00 [DBG] 1 candidate(s) found for the request path '/api/Invoices'
2025-11-18 16:34:26.990 +03:00 [DBG] Endpoint 'BillingSystem.API.Controllers.InvoicesController.Post (BillingSystem.API)' with route pattern 'api/Invoices' is valid for the request path '/api/Invoices'
2025-11-18 16:34:26.996 +03:00 [DBG] Request matched endpoint 'BillingSystem.API.Controllers.InvoicesController.Post (BillingSystem.API)'
2025-11-18 16:34:27.003 +03:00 [DBG] Static files was skipped as the request already matched an endpoint.
2025-11-18 16:34:27.310 +03:00 [DBG] An 'IServiceProvider' was created for internal use by Entity Framework.
2025-11-18 16:34:32.839 +03:00 [INF] Executing endpoint 'BillingSystem.API.Controllers.InvoicesController.Post (BillingSystem.API)'
2025-11-18 16:34:32.881 +03:00 [INF] Route matched with {action = "Post", controller = "Invoices"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Post(BillingSystem.Application.Requests.CreateInvoiceRequest) on controller BillingSystem.API.Controllers.InvoicesController (BillingSystem.API).
2025-11-18 16:34:32.887 +03:00 [DBG] Execution plan of authorization filters (in the following order): ["None"]
2025-11-18 16:34:32.892 +03:00 [DBG] Execution plan of resource filters (in the following order): ["None"]
2025-11-18 16:34:32.896 +03:00 [DBG] Execution plan of action filters (in the following order): ["Microsoft.AspNetCore.Mvc.ModelBinding.UnsupportedContentTypeFilter (Order: -3000)","Microsoft.AspNetCore.Mvc.Infrastructure.ModelStateInvalidFilter (Order: -2000)","BillingSystem.API.ActionFilters.AuditBillingRequestsFilter","BillingSystem.API.ActionFilters.IdempotencyFilter (Order: 0)"]
2025-11-18 16:34:32.902 +03:00 [DBG] Execution plan of exception filters (in the following order): ["None"]
2025-11-18 16:34:32.907 +03:00 [DBG] Execution plan of result filters (in the following order): ["Microsoft.AspNetCore.Mvc.Infrastructure.ClientErrorResultFilter (Order: -2000)","Microsoft.AspNetCore.Mvc.ProducesAttribute (Order: 0)","BillingSystem.API.ActionFilters.IdempotencyFilter (Order: 0)"]
2025-11-18 16:34:32.914 +03:00 [DBG] Executing controller factory for controller BillingSystem.API.Controllers.InvoicesController (BillingSystem.API)
2025-11-18 16:34:32.924 +03:00 [WRN] You do not have a valid license key for the Lucky Penny software MediatR. This is allowed for development and testing scenarios. If you are running in production you are required to have a licensed version. Please visit https://luckypennysoftware.com to obtain a valid license.
2025-11-18 16:34:32.988 +03:00 [DBG] Executed controller factory for controller BillingSystem.API.Controllers.InvoicesController (BillingSystem.API)
2025-11-18 16:34:33.020 +03:00 [DBG] Attempting to bind parameter 'invoiceRequest' of type 'BillingSystem.Application.Requests.CreateInvoiceRequest' ...
2025-11-18 16:34:33.038 +03:00 [DBG] Attempting to bind parameter 'invoiceRequest' of type 'BillingSystem.Application.Requests.CreateInvoiceRequest' using the name '' in request data ...
2025-11-18 16:34:33.049 +03:00 [DBG] Selected input formatter 'Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonInputFormatter' for content type 'application/json'.
2025-11-18 16:34:33.108 +03:00 [DBG] Connection id "0HNH6KSNLAM23", Request id "0HNH6KSNLAM23:00000001": started reading request body.
2025-11-18 16:34:33.115 +03:00 [DBG] Connection id "0HNH6KSNLAM23", Request id "0HNH6KSNLAM23:00000001": done reading request body.
2025-11-18 16:34:33.163 +03:00 [DBG] JSON input formatter succeeded, deserializing to type 'BillingSystem.Application.Requests.CreateInvoiceRequest'
2025-11-18 16:34:33.168 +03:00 [DBG] Done attempting to bind parameter 'invoiceRequest' of type 'BillingSystem.Application.Requests.CreateInvoiceRequest'.
2025-11-18 16:34:33.173 +03:00 [DBG] Done attempting to bind parameter 'invoiceRequest' of type 'BillingSystem.Application.Requests.CreateInvoiceRequest'.
2025-11-18 16:34:33.175 +03:00 [DBG] Attempting to validate the bound parameter 'invoiceRequest' of type 'BillingSystem.Application.Requests.CreateInvoiceRequest' ...
2025-11-18 16:34:33.214 +03:00 [DBG] Done attempting to validate the bound parameter 'invoiceRequest' of type 'BillingSystem.Application.Requests.CreateInvoiceRequest'.
2025-11-18 16:34:33.604 +03:00 [DBG] No relationship from 'Invoice' to 'Invoice' has been configured by convention because there are multiple properties on one entity type - {'DiscountedPrimaryInvoice'} that could be matched with the properties on the other entity type - {'InverseDiscountedPrimaryInvoice', 'InversePrimaryInvoice', 'InverseSubstitutionPrimaryInvoice', 'PrimaryInvoice', 'SubstitutionPrimaryInvoice'}. This message can be disregarded if explicit configuration has been specified in 'OnModelCreating'.
2025-11-18 16:34:33.904 +03:00 [DBG] No relationship from 'Invoice' to 'Invoice' has been configured by convention because there are multiple properties on one entity type - {'DiscountedPrimaryInvoice'} that could be matched with the properties on the other entity type - {'InverseDiscountedPrimaryInvoice', 'InversePrimaryInvoice', 'InverseSubstitutionPrimaryInvoice', 'PrimaryInvoice', 'SubstitutionPrimaryInvoice'}. This message can be disregarded if explicit configuration has been specified in 'OnModelCreating'.
2025-11-18 16:34:33.917 +03:00 [DBG] No relationship from 'Invoice' to 'Invoice' has been configured by convention because there are multiple properties on one entity type - {'InversePrimaryInvoice'} that could be matched with the properties on the other entity type - {'InverseSubstitutionPrimaryInvoice', 'PrimaryInvoice', 'SubstitutionPrimaryInvoice'}. This message can be disregarded if explicit configuration has been specified in 'OnModelCreating'.
2025-11-18 16:34:33.930 +03:00 [DBG] No relationship from 'Invoice' to 'Invoice' has been configured by convention because there are multiple properties on one entity type - {'InversePrimaryInvoice'} that could be matched with the properties on the other entity type - {'InverseSubstitutionPrimaryInvoice', 'PrimaryInvoice', 'SubstitutionPrimaryInvoice'}. This message can be disregarded if explicit configuration has been specified in 'OnModelCreating'.
2025-11-18 16:34:34.431 +03:00 [DBG] Entity Framework Core 9.0.9 initialized 'BillingServiceDBContext' using provider 'Microsoft.EntityFrameworkCore.SqlServer:9.0.9' with options: EngineType=SqlServer 
2025-11-18 16:34:34.546 +03:00 [DBG] Compiling query expression: 
'DbSet<Invoice>()
    .AsNoTracking()
    .Any(inv => inv.ExternalId.ToString() == __idempotentKey_0)'
2025-11-18 16:34:34.873 +03:00 [DBG] Generated query execution expression: 
'queryContext => ShapedQueryCompilingExpressionVisitor.SingleAsync<bool>(
    asyncEnumerable: SingleQueryingEnumerable.Create<bool>(
        relationalQueryContext: (RelationalQueryContext)queryContext, 
        relationalCommandResolver: parameters => [LIFTABLE Constant: RelationalCommandCache.QueryExpression(
            Projection Mapping:
                EmptyProjectionMember -> 0
            SELECT EXISTS (
                SELECT 1
                FROM Invoices AS i
                WHERE COALESCE(CONVERT(varchar(36), i.ExternalId), '') == @__idempotentKey_0)) | Resolver: c => new RelationalCommandCache(
            c.Dependencies.MemoryCache, 
            c.RelationalDependencies.QuerySqlGeneratorFactory, 
            c.RelationalDependencies.RelationalParameterBasedSqlProcessorFactory, 
            Projection Mapping:
                EmptyProjectionMember -> 0
            SELECT EXISTS (
                SELECT 1
                FROM Invoices AS i
                WHERE COALESCE(CONVERT(varchar(36), i.ExternalId), '') == @__idempotentKey_0), 
            False, 
            new HashSet<string>(
                new string[]{ }, 
                StringComparer.Ordinal
            )
        )].GetRelationalCommandTemplate(parameters), 
        readerColumns: null, 
        shaper: (queryContext, dataReader, resultContext, resultCoordinator) => 
        {
            bool? value1;
            value1 = dataReader.IsDBNull(0) ? default(bool?) : (bool?)dataReader.GetBoolean(0);
            return (bool)value1;
        }, 
        contextType: BillingSystem.Infrastructure.EF.BillingServiceDBContext, 
        standAloneStateManager: False, 
        detailedErrorsEnabled: False, 
        threadSafetyChecksEnabled: True), 
    cancellationToken: queryContext.CancellationToken)'
2025-11-18 16:34:34.954 +03:00 [DBG] Creating DbConnection.
2025-11-18 16:34:34.985 +03:00 [DBG] Created DbConnection. (28ms).
2025-11-18 16:34:34.996 +03:00 [DBG] Opening connection to database 'GAC-BillingService' on server '.'.
2025-11-18 16:34:35.299 +03:00 [DBG] Opened connection to database 'GAC-BillingService' on server '.'.
2025-11-18 16:34:35.308 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-11-18 16:34:35.320 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (7ms).
2025-11-18 16:34:35.338 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (29ms).
2025-11-18 16:34:35.351 +03:00 [DBG] Executing DbCommand [Parameters=[@__idempotentKey_0='?' (Size = 36) (DbType = AnsiString)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [Invoices] AS [i]
        WHERE CONVERT(varchar(36), [i].[ExternalId]) = @__idempotentKey_0) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2025-11-18 16:34:35.443 +03:00 [INF] Executed DbCommand (90ms) [Parameters=[@__idempotentKey_0='?' (Size = 36) (DbType = AnsiString)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [Invoices] AS [i]
        WHERE CONVERT(varchar(36), [i].[ExternalId]) = @__idempotentKey_0) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2025-11-18 16:34:35.483 +03:00 [DBG] Closing data reader to 'GAC-BillingService' on server '.'.
2025-11-18 16:34:35.507 +03:00 [DBG] A data reader for 'GAC-BillingService' on server '.' is being disposed after spending 45ms reading results.
2025-11-18 16:34:35.519 +03:00 [DBG] Closing connection to database 'GAC-BillingService' on server '.'.
2025-11-18 16:34:35.531 +03:00 [DBG] Closed connection to database 'GAC-BillingService' on server '.' (12ms).
2025-11-18 16:34:35.800 +03:00 [WRN] You do not have a valid license key for the Lucky Penny software AutoMapper. This is allowed for development and testing scenarios. If you are running in production you are required to have a licensed version. Please visit https://luckypennysoftware.com to obtain a valid license.
2025-11-18 16:35:11.984 +03:00 [DBG] Opening connection to database 'GAC-BillingService' on server '.'.
2025-11-18 16:35:11.994 +03:00 [DBG] Opened connection to database 'GAC-BillingService' on server '.'.
2025-11-18 16:35:12.002 +03:00 [DBG] Beginning transaction with isolation level 'Unspecified'.
2025-11-18 16:35:12.020 +03:00 [DBG] Began transaction with isolation level 'ReadCommitted'.
2025-11-18 16:35:12.534 +03:00 [DBG] Compiling query expression: 
'DbSet<InvoiceSequenceValue>().FromSql(EXECUTE dbo.GetNextInvoiceNumber, __p_0)
'
2025-11-18 16:35:12.603 +03:00 [DBG] Generated query execution expression: 
'queryContext => FromSqlQueryingEnumerable.Create<InvoiceSequenceValue>(
    relationalQueryContext: (RelationalQueryContext)queryContext, 
    relationalCommandResolver: parameters => [LIFTABLE Constant: RelationalCommandCache.QueryExpression(
        Projection Mapping:
            EmptyProjectionMember -> Dictionary<IProperty, int> { [Property: InvoiceSequenceValue.Value (long) Required, 0] }
        SELECT b.Value
        FROM EXECUTE dbo.GetNextInvoiceNumber) | Resolver: c => new RelationalCommandCache(
        c.Dependencies.MemoryCache, 
        c.RelationalDependencies.QuerySqlGeneratorFactory, 
        c.RelationalDependencies.RelationalParameterBasedSqlProcessorFactory, 
        Projection Mapping:
            EmptyProjectionMember -> Dictionary<IProperty, int> { [Property: InvoiceSequenceValue.Value (long) Required, 0] }
        SELECT b.Value
        FROM EXECUTE dbo.GetNextInvoiceNumber, 
        False, 
        new HashSet<string>(
            new string[]{ }, 
            StringComparer.Ordinal
        )
    )].GetRelationalCommandTemplate(parameters), 
    readerColumns: null, 
    columnNames: [LIFTABLE Constant: string[] { "Value" } | Resolver: _ => new string[]{ "Value" }], 
    shaper: (queryContext, dataReader, indexMap) => 
    {
        InvoiceSequenceValue entity;
        entity = 
        {
            MaterializationContext materializationContext1;
            IEntityType entityType1;
            InvoiceSequenceValue instance1;
            materializationContext1 = new MaterializationContext(
                [LIFTABLE Constant: ValueBuffer | Resolver: _ => (object)ValueBuffer.Empty], 
                queryContext.Context
            );
            instance1 = default(InvoiceSequenceValue);
            {
                ISnapshot shadowSnapshot1;
                shadowSnapshot1 = [LIFTABLE Constant: Snapshot | Resolver: _ => Snapshot.Empty];
                entityType1 = [LIFTABLE Constant: EntityType: InvoiceSequenceValue Keyless | Resolver: namelessParameter{0} => namelessParameter{0}.Dependencies.Model.FindEntityType("BillingSystem.Domain.Entities.InvoiceSequenceValue")];
                instance1 = switch (entityType1)
                {
                    case [LIFTABLE Constant: EntityType: InvoiceSequenceValue Keyless | Resolver: namelessParameter{1} => namelessParameter{1}.Dependencies.Model.FindEntityType("BillingSystem.Domain.Entities.InvoiceSequenceValue")]: 
                        {
                            return 
                            {
                                InvoiceSequenceValue instance;
                                instance = new InvoiceSequenceValue();
                                instance.<Value>k__BackingField = dataReader.GetInt64(indexMap[0]);
                                (instance is IInjectableService) ? ((IInjectableService)instance).Injected(
                                    context: materializationContext1.Context, 
                                    entity: instance, 
                                    queryTrackingBehavior: TrackAll, 
                                    structuralType: [LIFTABLE Constant: EntityType: InvoiceSequenceValue Keyless | Resolver: namelessParameter{2} => namelessParameter{2}.Dependencies.Model.FindEntityType("BillingSystem.Domain.Entities.InvoiceSequenceValue")]) : default(void);
                                return instance;
                            }}
                    default: 
                        default(InvoiceSequenceValue)
                }
                ;
                return instance1;
            }return instance1;
        };
        return entity;
    }, 
    contextType: BillingSystem.Infrastructure.EF.BillingServiceDBContext, 
    standAloneStateManager: False, 
    detailedErrorsEnabled: False, 
    threadSafetyChecksEnabled: True)'
2025-11-18 16:35:12.619 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-11-18 16:35:12.624 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (3ms).
2025-11-18 16:35:12.630 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (10ms).
2025-11-18 16:35:12.634 +03:00 [DBG] Executing DbCommand [Parameters=[], CommandType='"Text"', CommandTimeout='30']
EXECUTE dbo.GetNextInvoiceNumber
2025-11-18 16:35:12.644 +03:00 [INF] Executed DbCommand (11ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
EXECUTE dbo.GetNextInvoiceNumber
2025-11-18 16:35:12.652 +03:00 [DBG] Closing data reader to 'GAC-BillingService' on server '.'.
2025-11-18 16:35:12.657 +03:00 [DBG] A data reader for 'GAC-BillingService' on server '.' is being disposed after spending 8ms reading results.
2025-11-18 16:35:17.370 +03:00 [DBG] Compiling query expression: 
'DbSet<Customer>()
    .FirstOrDefault(c => c.IdentityNumber == __cutomerIdentityNumber_0)'
2025-11-18 16:35:17.400 +03:00 [DBG] Generated query execution expression: 
'queryContext => SingleQueryingEnumerable.Create<Customer>(
    relationalQueryContext: (RelationalQueryContext)queryContext, 
    relationalCommandResolver: parameters => [LIFTABLE Constant: RelationalCommandCache.QueryExpression(
        Projection Mapping:
            EmptyProjectionMember -> Dictionary<IProperty, int> { [Property: Customer.Id (long) Required PK AfterSave:Throw ValueGenerated.OnAdd, 0], [Property: Customer.AddressBuildingNumber (string) MaxLength(200), 1], [Property: Customer.AddressCity (string) Required MaxLength(200), 2], [Property: Customer.AddressCountry (string) Required MaxLength(200), 3], [Property: Customer.AddressDistrict (string) Required MaxLength(200), 4], [Property: Customer.AddressPostalCode (string) Required MaxLength(50), 5], [Property: Customer.AddressStreet (string) MaxLength(200), 6], [Property: Customer.AddressSubNumber (string) MaxLength(200), 7], [Property: Customer.CreatedBy (string) Required MaxLength(50), 8], [Property: Customer.CreatedDate (DateTime) Required, 9], [Property: Customer.CustomerType (string) Required MaxLength(100), 10], [Property: Customer.EmailAddress (string) MaxLength(80), 11], [Property: Customer.FullName (string) Required MaxLength(500), 12], [Property: Customer.IdentityNumber (string) Required MaxLength(100), 13], [Property: Customer.IdentityType (int?), 14], [Property: Customer.IsDeleted (bool) Required, 15], [Property: Customer.LastUpdatedDate (DateTime?), 16], [Property: Customer.OverpaymentBalance (decimal?), 17], [Property: Customer.PhoneNumber (string) MaxLength(50), 18], [Property: Customer.Vatnumber (string) MaxLength(100), 19] }
        SELECT TOP(1) c.Id, c.Address_BuildingNumber, c.Address_City, c.Address_Country, c.Address_District, c.Address_PostalCode, c.Address_Street, c.Address_SubNumber, c.CreatedBy, c.CreatedDate, c.CustomerType, c.EmailAddress, c.FullName, c.IdentityNumber, c.IdentityType, c.IsDeleted, c.LastUpdatedDate, c.OverpaymentBalance, c.PhoneNumber, c.VATNumber
        FROM Customers AS c
        WHERE c.IdentityNumber == @__cutomerIdentityNumber_0) | Resolver: c => new RelationalCommandCache(
        c.Dependencies.MemoryCache, 
        c.RelationalDependencies.QuerySqlGeneratorFactory, 
        c.RelationalDependencies.RelationalParameterBasedSqlProcessorFactory, 
        Projection Mapping:
            EmptyProjectionMember -> Dictionary<IProperty, int> { [Property: Customer.Id (long) Required PK AfterSave:Throw ValueGenerated.OnAdd, 0], [Property: Customer.AddressBuildingNumber (string) MaxLength(200), 1], [Property: Customer.AddressCity (string) Required MaxLength(200), 2], [Property: Customer.AddressCountry (string) Required MaxLength(200), 3], [Property: Customer.AddressDistrict (string) Required MaxLength(200), 4], [Property: Customer.AddressPostalCode (string) Required MaxLength(50), 5], [Property: Customer.AddressStreet (string) MaxLength(200), 6], [Property: Customer.AddressSubNumber (string) MaxLength(200), 7], [Property: Customer.CreatedBy (string) Required MaxLength(50), 8], [Property: Customer.CreatedDate (DateTime) Required, 9], [Property: Customer.CustomerType (string) Required MaxLength(100), 10], [Property: Customer.EmailAddress (string) MaxLength(80), 11], [Property: Customer.FullName (string) Required MaxLength(500), 12], [Property: Customer.IdentityNumber (string) Required MaxLength(100), 13], [Property: Customer.IdentityType (int?), 14], [Property: Customer.IsDeleted (bool) Required, 15], [Property: Customer.LastUpdatedDate (DateTime?), 16], [Property: Customer.OverpaymentBalance (decimal?), 17], [Property: Customer.PhoneNumber (string) MaxLength(50), 18], [Property: Customer.Vatnumber (string) MaxLength(100), 19] }
        SELECT TOP(1) c.Id, c.Address_BuildingNumber, c.Address_City, c.Address_Country, c.Address_District, c.Address_PostalCode, c.Address_Street, c.Address_SubNumber, c.CreatedBy, c.CreatedDate, c.CustomerType, c.EmailAddress, c.FullName, c.IdentityNumber, c.IdentityType, c.IsDeleted, c.LastUpdatedDate, c.OverpaymentBalance, c.PhoneNumber, c.VATNumber
        FROM Customers AS c
        WHERE c.IdentityNumber == @__cutomerIdentityNumber_0, 
        False, 
        new HashSet<string>(
            new string[]{ }, 
            StringComparer.Ordinal
        )
    )].GetRelationalCommandTemplate(parameters), 
    readerColumns: null, 
    shaper: (queryContext, dataReader, resultContext, resultCoordinator) => 
    {
        Customer entity;
        entity = 
        {
            MaterializationContext materializationContext1;
            IEntityType entityType1;
            Customer instance1;
            InternalEntityEntry entry1;
            bool hasNullKey1;
            materializationContext1 = new MaterializationContext(
                [LIFTABLE Constant: ValueBuffer | Resolver: _ => (object)ValueBuffer.Empty], 
                queryContext.Context
            );
            instance1 = default(Customer);
            entry1 = queryContext.TryGetEntry(
                key: [LIFTABLE Constant: Key: Customer.Id PK | Resolver: c => c.Dependencies.Model.FindEntityType("BillingSystem.Domain.Entities.Customer").FindPrimaryKey()], 
                keyValues: new object[]{ (object)dataReader.GetInt64(0) }, 
                throwOnNullKey: True, 
                hasNullKey: hasNullKey1);
            !(hasNullKey1) ? entry1 != default(InternalEntityEntry) ? 
            {
                entityType1 = entry1.EntityType;
                return instance1 = (Customer)entry1.Entity;
            } : 
            {
                ISnapshot shadowSnapshot1;
                shadowSnapshot1 = [LIFTABLE Constant: Snapshot | Resolver: _ => Snapshot.Empty];
                entityType1 = [LIFTABLE Constant: EntityType: Customer | Resolver: namelessParameter{0} => namelessParameter{0}.Dependencies.Model.FindEntityType("BillingSystem.Domain.Entities.Customer")];
                instance1 = switch (entityType1)
                {
                    case [LIFTABLE Constant: EntityType: Customer | Resolver: namelessParameter{1} => namelessParameter{1}.Dependencies.Model.FindEntityType("BillingSystem.Domain.Entities.Customer")]: 
                        {
                            return 
                            {
                                Customer instance;
                                instance = new Customer();
                                instance.<Id>k__BackingField = dataReader.GetInt64(0);
                                instance.<AddressBuildingNumber>k__BackingField = dataReader.IsDBNull(1) ? default(string) : dataReader.GetString(1);
                                instance.<AddressCity>k__BackingField = dataReader.GetString(2);
                                instance.<AddressCountry>k__BackingField = dataReader.GetString(3);
                                instance.<AddressDistrict>k__BackingField = dataReader.GetString(4);
                                instance.<AddressPostalCode>k__BackingField = dataReader.GetString(5);
                                instance.<AddressStreet>k__BackingField = dataReader.IsDBNull(6) ? default(string) : dataReader.GetString(6);
                                instance.<AddressSubNumber>k__BackingField = dataReader.IsDBNull(7) ? default(string) : dataReader.GetString(7);
                                instance.<CreatedBy>k__BackingField = dataReader.GetString(8);
                                instance.<CreatedDate>k__BackingField = dataReader.GetDateTime(9);
                                instance.<CustomerType>k__BackingField = dataReader.GetString(10);
                                instance.<EmailAddress>k__BackingField = dataReader.IsDBNull(11) ? default(string) : dataReader.GetString(11);
                                instance.<FullName>k__BackingField = dataReader.GetString(12);
                                instance.<IdentityNumber>k__BackingField = dataReader.GetString(13);
                                instance.<IdentityType>k__BackingField = dataReader.IsDBNull(14) ? default(int?) : (int?)dataReader.GetInt32(14);
                                instance.<IsDeleted>k__BackingField = dataReader.GetBoolean(15);
                                instance.<LastUpdatedDate>k__BackingField = dataReader.IsDBNull(16) ? default(DateTime?) : (DateTime?)dataReader.GetDateTime(16);
                                instance.<OverpaymentBalance>k__BackingField = dataReader.IsDBNull(17) ? default(decimal?) : (decimal?)dataReader.GetDecimal(17);
                                instance.<PhoneNumber>k__BackingField = dataReader.IsDBNull(18) ? default(string) : dataReader.GetString(18);
                                instance.<Vatnumber>k__BackingField = dataReader.IsDBNull(19) ? default(string) : dataReader.GetString(19);
                                (instance is IInjectableService) ? ((IInjectableService)instance).Injected(
                                    context: materializationContext1.Context, 
                                    entity: instance, 
                                    queryTrackingBehavior: TrackAll, 
                                    structuralType: [LIFTABLE Constant: EntityType: Customer | Resolver: namelessParameter{2} => namelessParameter{2}.Dependencies.Model.FindEntityType("BillingSystem.Domain.Entities.Customer")]) : default(void);
                                return instance;
                            }}
                    default: 
                        default(Customer)
                }
                ;
                entry1 = entityType1 == default(IEntityType) ? default(InternalEntityEntry) : queryContext.StartTracking(
                    entityType: entityType1, 
                    entity: instance1, 
                    snapshot: shadowSnapshot1);
                return instance1;
            } : default(void);
            return instance1;
        };
        return entity;
    }, 
    contextType: BillingSystem.Infrastructure.EF.BillingServiceDBContext, 
    standAloneStateManager: False, 
    detailedErrorsEnabled: False, 
    threadSafetyChecksEnabled: True)
    .SingleOrDefault()'
2025-11-18 16:35:17.418 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-11-18 16:35:17.421 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (3ms).
2025-11-18 16:35:17.425 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (6ms).
2025-11-18 16:35:17.428 +03:00 [DBG] Executing DbCommand [Parameters=[@__cutomerIdentityNumber_0='?' (Size = 100)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[Id], [c].[Address_BuildingNumber], [c].[Address_City], [c].[Address_Country], [c].[Address_District], [c].[Address_PostalCode], [c].[Address_Street], [c].[Address_SubNumber], [c].[CreatedBy], [c].[CreatedDate], [c].[CustomerType], [c].[EmailAddress], [c].[FullName], [c].[IdentityNumber], [c].[IdentityType], [c].[IsDeleted], [c].[LastUpdatedDate], [c].[OverpaymentBalance], [c].[PhoneNumber], [c].[VATNumber]
FROM [Customers] AS [c]
WHERE [c].[IdentityNumber] = @__cutomerIdentityNumber_0
2025-11-18 16:35:17.454 +03:00 [INF] Executed DbCommand (26ms) [Parameters=[@__cutomerIdentityNumber_0='?' (Size = 100)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[Id], [c].[Address_BuildingNumber], [c].[Address_City], [c].[Address_Country], [c].[Address_District], [c].[Address_PostalCode], [c].[Address_Street], [c].[Address_SubNumber], [c].[CreatedBy], [c].[CreatedDate], [c].[CustomerType], [c].[EmailAddress], [c].[FullName], [c].[IdentityNumber], [c].[IdentityType], [c].[IsDeleted], [c].[LastUpdatedDate], [c].[OverpaymentBalance], [c].[PhoneNumber], [c].[VATNumber]
FROM [Customers] AS [c]
WHERE [c].[IdentityNumber] = @__cutomerIdentityNumber_0
2025-11-18 16:35:17.530 +03:00 [DBG] Context 'BillingServiceDBContext' started tracking 'Customer' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-11-18 16:35:17.594 +03:00 [DBG] Closing data reader to 'GAC-BillingService' on server '.'.
2025-11-18 16:35:17.600 +03:00 [DBG] A data reader for 'GAC-BillingService' on server '.' is being disposed after spending 137ms reading results.
2025-11-18 16:35:24.176 +03:00 [DBG] 'BillingServiceDBContext' generated a temporary value for the property 'Invoice.Id'. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-11-18 16:35:24.337 +03:00 [DBG] Context 'BillingServiceDBContext' started tracking 'Invoice' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-11-18 16:35:24.997 +03:00 [DBG] SaveChanges starting for 'BillingServiceDBContext'.
2025-11-18 16:35:25.006 +03:00 [DBG] DetectChanges starting for 'BillingServiceDBContext'.
2025-11-18 16:35:25.072 +03:00 [DBG] The unchanged property 'Customer.IdentityType' was detected as changed and will be marked as modified. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see property values.
2025-11-18 16:35:25.081 +03:00 [DBG] An entity of type 'Customer' tracked by 'BillingServiceDBContext' changed state from '"Unchanged"' to '"Modified"'. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-11-18 16:35:25.092 +03:00 [DBG] DetectChanges completed for 'BillingServiceDBContext'.
2025-11-18 16:35:25.188 +03:00 [DBG] Executing 2 update commands as a batch.
2025-11-18 16:35:25.200 +03:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-11-18 16:35:25.206 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-11-18 16:35:25.211 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (4ms).
2025-11-18 16:35:25.215 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (9ms).
2025-11-18 16:35:25.220 +03:00 [DBG] Executing DbCommand [Parameters=[@p1='?' (DbType = Int64), @p0='?' (DbType = Int32), @p2='?' (Precision = 18) (DbType = Decimal), @p3='?' (Size = 3000), @p4='?' (Size = 100), @p5='?' (Size = 50), @p6='?' (DbType = DateTime), @p7='?' (Size = 50), @p8='?' (DbType = Int64), @p9='?' (DbType = Int64), @p10='?' (DbType = DateTime), @p11='?' (DbType = Guid), @p12='?' (Size = 50), @p13='?' (DbType = Int32), @p14='?' (DbType = Int32), @p15='?' (DbType = Boolean), @p16='?' (DbType = Boolean), @p17='?' (DbType = Boolean), @p18='?' (DbType = Boolean), @p19='?' (DbType = DateTime), @p20='?' (DbType = DateTime), @p21='?' (Size = 4000), @p22='?' (Size = 100), @p23='?' (Size = 100), @p24='?' (DbType = Int64), @p25='?' (Size = 4000), @p26='?' (DbType = Int64), @p27='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SET NOCOUNT ON;
UPDATE [Customers] SET [IdentityType] = @p0
OUTPUT 1
WHERE [Id] = @p1;
INSERT INTO [Invoices] ([Amount], [CancelationReasons], [ClientReferenceNumber], [CreatedBy], [CreatedDate], [Currency], [CustomerID], [DiscountedPrimaryInvoiceID], [DueAt], [ExternalId], [InvoiceNumber], [InvoiceStatus], [InvoiceType], [IsDeleted], [IsDiscounted], [IsSubInvoice], [IsSubstitution], [IssuedAt], [LastUpdatedDate], [Metadata], [PaymentProvider], [PaymentReference], [PrimaryInvoiceID], [ProviderResponse], [SubstitutionPrimaryInvoiceID], [TenantId])
OUTPUT INSERTED.[Id]
VALUES (@p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18, @p19, @p20, @p21, @p22, @p23, @p24, @p25, @p26, @p27);
2025-11-18 16:35:25.245 +03:00 [INF] Executed DbCommand (27ms) [Parameters=[@p1='?' (DbType = Int64), @p0='?' (DbType = Int32), @p2='?' (Precision = 18) (DbType = Decimal), @p3='?' (Size = 3000), @p4='?' (Size = 100), @p5='?' (Size = 50), @p6='?' (DbType = DateTime), @p7='?' (Size = 50), @p8='?' (DbType = Int64), @p9='?' (DbType = Int64), @p10='?' (DbType = DateTime), @p11='?' (DbType = Guid), @p12='?' (Size = 50), @p13='?' (DbType = Int32), @p14='?' (DbType = Int32), @p15='?' (DbType = Boolean), @p16='?' (DbType = Boolean), @p17='?' (DbType = Boolean), @p18='?' (DbType = Boolean), @p19='?' (DbType = DateTime), @p20='?' (DbType = DateTime), @p21='?' (Size = 4000), @p22='?' (Size = 100), @p23='?' (Size = 100), @p24='?' (DbType = Int64), @p25='?' (Size = 4000), @p26='?' (DbType = Int64), @p27='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SET NOCOUNT ON;
UPDATE [Customers] SET [IdentityType] = @p0
OUTPUT 1
WHERE [Id] = @p1;
INSERT INTO [Invoices] ([Amount], [CancelationReasons], [ClientReferenceNumber], [CreatedBy], [CreatedDate], [Currency], [CustomerID], [DiscountedPrimaryInvoiceID], [DueAt], [ExternalId], [InvoiceNumber], [InvoiceStatus], [InvoiceType], [IsDeleted], [IsDiscounted], [IsSubInvoice], [IsSubstitution], [IssuedAt], [LastUpdatedDate], [Metadata], [PaymentProvider], [PaymentReference], [PrimaryInvoiceID], [ProviderResponse], [SubstitutionPrimaryInvoiceID], [TenantId])
OUTPUT INSERTED.[Id]
VALUES (@p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18, @p19, @p20, @p21, @p22, @p23, @p24, @p25, @p26, @p27);
2025-11-18 16:35:25.333 +03:00 [DBG] The foreign key property 'Invoice.Id' was detected as changed. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see property values.
2025-11-18 16:35:25.343 +03:00 [DBG] Closing data reader to 'GAC-BillingService' on server '.'.
2025-11-18 16:35:25.349 +03:00 [DBG] A data reader for 'GAC-BillingService' on server '.' is being disposed after spending 81ms reading results.
2025-11-18 16:35:25.358 +03:00 [DBG] An entity of type 'Invoice' tracked by 'BillingServiceDBContext' changed state from '"Added"' to '"Unchanged"'. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-11-18 16:35:25.366 +03:00 [DBG] An entity of type 'Customer' tracked by 'BillingServiceDBContext' changed state from '"Modified"' to '"Unchanged"'. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-11-18 16:35:25.374 +03:00 [DBG] SaveChanges completed for 'BillingServiceDBContext' with 2 entities written to the database.
2025-11-18 16:35:26.673 +03:00 [DBG] 'BillingServiceDBContext' generated a temporary value for the property 'OutboxEvent.Id'. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-11-18 16:35:26.696 +03:00 [DBG] Context 'BillingServiceDBContext' started tracking 'OutboxEvent' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-11-18 16:35:28.150 +03:00 [DBG] 'BillingServiceDBContext' generated a temporary value for the property 'AuditEvent.Id'. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-11-18 16:35:28.183 +03:00 [DBG] Context 'BillingServiceDBContext' started tracking 'AuditEvent' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-11-18 16:35:28.665 +03:00 [DBG] SaveChanges starting for 'BillingServiceDBContext'.
2025-11-18 16:35:28.672 +03:00 [DBG] DetectChanges starting for 'BillingServiceDBContext'.
2025-11-18 16:35:28.695 +03:00 [DBG] DetectChanges completed for 'BillingServiceDBContext'.
2025-11-18 16:35:28.707 +03:00 [DBG] Executing 2 update commands as a batch.
2025-11-18 16:35:28.714 +03:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-11-18 16:35:28.720 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-11-18 16:35:28.725 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (5ms).
2025-11-18 16:35:28.749 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (29ms).
2025-11-18 16:35:28.761 +03:00 [DBG] Executing DbCommand [Parameters=[@p0='?' (Size = 100), @p1='?' (Size = 4000), @p2='?' (Size = 50), @p3='?' (DbType = DateTime), @p4='?' (Size = 500), @p5='?' (Size = 20), @p6='?' (Size = 100), @p7='?' (Size = 100), @p8='?' (DbType = Int64), @p9='?' (DbType = DateTime), @p10='?' (Size = 4000), @p11='?' (Size = 300), @p12='?' (Size = 4000), @p13='?' (DbType = Boolean), @p14='?' (Size = 20) (DbType = AnsiString)], CommandType='"Text"', CommandTimeout='30']
SET NOCOUNT ON;
INSERT INTO [audit].[AuditEvents] ([Action], [Changes], [CreatedBy], [CreatedDate], [Description], [EntityId], [EntityType], [UserId])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
INSERT INTO [Outbox_events] ([Aggregate_id], [CreatedDate], [ErrorMsg], [Event_type], [Payload], [Processed], [ProcessingStatus])
OUTPUT INSERTED.[Id]
VALUES (@p8, @p9, @p10, @p11, @p12, @p13, @p14);
2025-11-18 16:35:28.772 +03:00 [INF] Executed DbCommand (11ms) [Parameters=[@p0='?' (Size = 100), @p1='?' (Size = 4000), @p2='?' (Size = 50), @p3='?' (DbType = DateTime), @p4='?' (Size = 500), @p5='?' (Size = 20), @p6='?' (Size = 100), @p7='?' (Size = 100), @p8='?' (DbType = Int64), @p9='?' (DbType = DateTime), @p10='?' (Size = 4000), @p11='?' (Size = 300), @p12='?' (Size = 4000), @p13='?' (DbType = Boolean), @p14='?' (Size = 20) (DbType = AnsiString)], CommandType='"Text"', CommandTimeout='30']
SET NOCOUNT ON;
INSERT INTO [audit].[AuditEvents] ([Action], [Changes], [CreatedBy], [CreatedDate], [Description], [EntityId], [EntityType], [UserId])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
INSERT INTO [Outbox_events] ([Aggregate_id], [CreatedDate], [ErrorMsg], [Event_type], [Payload], [Processed], [ProcessingStatus])
OUTPUT INSERTED.[Id]
VALUES (@p8, @p9, @p10, @p11, @p12, @p13, @p14);
2025-11-18 16:35:28.796 +03:00 [DBG] The foreign key property 'AuditEvent.Id' was detected as changed. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see property values.
2025-11-18 16:35:28.801 +03:00 [DBG] The foreign key property 'OutboxEvent.Id' was detected as changed. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see property values.
2025-11-18 16:35:28.804 +03:00 [DBG] Closing data reader to 'GAC-BillingService' on server '.'.
2025-11-18 16:35:28.807 +03:00 [DBG] A data reader for 'GAC-BillingService' on server '.' is being disposed after spending 13ms reading results.
2025-11-18 16:35:28.813 +03:00 [DBG] An entity of type 'OutboxEvent' tracked by 'BillingServiceDBContext' changed state from '"Added"' to '"Unchanged"'. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-11-18 16:35:28.819 +03:00 [DBG] An entity of type 'AuditEvent' tracked by 'BillingServiceDBContext' changed state from '"Added"' to '"Unchanged"'. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-11-18 16:35:28.823 +03:00 [DBG] SaveChanges completed for 'BillingServiceDBContext' with 2 entities written to the database.
2025-11-18 16:35:29.632 +03:00 [DBG] Committing transaction.
2025-11-18 16:35:29.658 +03:00 [DBG] Committed transaction.
2025-11-18 16:35:29.665 +03:00 [DBG] Closing connection to database 'GAC-BillingService' on server '.'.
2025-11-18 16:35:29.670 +03:00 [DBG] Closed connection to database 'GAC-BillingService' on server '.' (4ms).
2025-11-18 16:35:33.963 +03:00 [DBG] Disposing transaction.
2025-11-18 16:35:33.993 +03:00 [DBG] List of registered output formatters, in the following order: ["Microsoft.AspNetCore.Mvc.Formatters.HttpNoContentOutputFormatter","Microsoft.AspNetCore.Mvc.Formatters.StringOutputFormatter","Microsoft.AspNetCore.Mvc.Formatters.StreamOutputFormatter","Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonOutputFormatter"]
2025-11-18 16:35:34.006 +03:00 [DBG] No information found on request to perform content negotiation.
2025-11-18 16:35:34.010 +03:00 [DBG] Attempting to select the first output formatter in the output formatters list which supports a content type from the explicitly specified content types '["application/json"]'.
2025-11-18 16:35:34.017 +03:00 [DBG] Selected output formatter 'Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonOutputFormatter' and content type 'application/json' to write the response.
2025-11-18 16:35:34.024 +03:00 [INF] Executing OkObjectResult, writing value of type 'BillingSystem.SharedKernel.ApiResponse`1[[System.Int64, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-11-18 16:35:34.052 +03:00 [INF] Executed action BillingSystem.API.Controllers.InvoicesController.Post (BillingSystem.API) in 61136.6845ms
2025-11-18 16:35:34.057 +03:00 [INF] Executed endpoint 'BillingSystem.API.Controllers.InvoicesController.Post (BillingSystem.API)'
2025-11-18 16:35:34.063 +03:00 [INF] HTTP POST /api/Invoices responded 200 in 67060.6986 ms
2025-11-18 16:35:34.067 +03:00 [DBG] Connection id "0HNH6KSNLAM23" completed keep alive response.
2025-11-18 16:35:34.073 +03:00 [DBG] 'BillingServiceDBContext' disposed.
2025-11-18 16:35:34.081 +03:00 [DBG] Disposing connection to database 'GAC-BillingService' on server '.'.
2025-11-18 16:35:34.085 +03:00 [DBG] Disposed connection to database '' on server '' (4ms).
2025-11-18 16:35:34.089 +03:00 [INF] Request finished HTTP/1.1 POST https://localhost:7257/api/Invoices - 200 null application/json; charset=utf-8 67120.3601ms
2025-11-18 16:38:13.629 +03:00 [DBG] Connection id "0HNH6KSNLAM24" accepted.
2025-11-18 16:38:13.630 +03:00 [DBG] Connection id "0HNH6KSNLAM24" received FIN.
2025-11-18 16:38:13.634 +03:00 [DBG] Connection id "0HNH6KSNLAM25" accepted.
2025-11-18 16:38:13.634 +03:00 [DBG] Connection id "0HNH6KSNLAM24" started.
2025-11-18 16:38:13.643 +03:00 [DBG] Connection id "0HNH6KSNLAM25" started.
2025-11-18 16:38:13.648 +03:00 [DBG] Failed to authenticate HTTPS connection.
System.IO.IOException: Received an unexpected EOF or 0 bytes from the transport stream.
   at System.Net.Security.SslStream.ReceiveHandshakeFrameAsync[TIOAdapter](CancellationToken cancellationToken)
   at System.Net.Security.SslStream.ForceAuthenticationAsync[TIOAdapter](Boolean receiveFirst, Byte[] reAuthenticationData, CancellationToken cancellationToken)
   at System.Net.Security.SslStream.ProcessAuthenticationWithTelemetryAsync(Boolean isAsync, CancellationToken cancellationToken)
   at Microsoft.AspNetCore.Server.Kestrel.Https.Internal.HttpsConnectionMiddleware.OnConnectionAsync(ConnectionContext context)
2025-11-18 16:38:13.654 +03:00 [DBG] Connection id "0HNH6KSNLAM24" stopped.
2025-11-18 16:38:13.656 +03:00 [DBG] Connection 0HNH6KSNLAM25 established using the following protocol: "Tls13"
2025-11-18 16:38:13.658 +03:00 [DBG] Connection id "0HNH6KSNLAM24" sending FIN because: "The Socket transport's send loop completed gracefully."
2025-11-18 16:38:13.662 +03:00 [INF] Request starting HTTP/1.1 POST https://localhost:7257/api/Invoices - application/json 1380
2025-11-18 16:38:13.672 +03:00 [DBG] 1 candidate(s) found for the request path '/api/Invoices'
2025-11-18 16:38:13.674 +03:00 [DBG] Endpoint 'BillingSystem.API.Controllers.InvoicesController.Post (BillingSystem.API)' with route pattern 'api/Invoices' is valid for the request path '/api/Invoices'
2025-11-18 16:38:13.679 +03:00 [DBG] Request matched endpoint 'BillingSystem.API.Controllers.InvoicesController.Post (BillingSystem.API)'
2025-11-18 16:38:13.681 +03:00 [DBG] Static files was skipped as the request already matched an endpoint.
2025-11-18 16:38:13.689 +03:00 [INF] Executing endpoint 'BillingSystem.API.Controllers.InvoicesController.Post (BillingSystem.API)'
2025-11-18 16:38:13.693 +03:00 [INF] Route matched with {action = "Post", controller = "Invoices"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Post(BillingSystem.Application.Requests.CreateInvoiceRequest) on controller BillingSystem.API.Controllers.InvoicesController (BillingSystem.API).
2025-11-18 16:38:13.698 +03:00 [DBG] Execution plan of authorization filters (in the following order): ["None"]
2025-11-18 16:38:13.702 +03:00 [DBG] Execution plan of resource filters (in the following order): ["None"]
2025-11-18 16:38:13.707 +03:00 [DBG] Execution plan of action filters (in the following order): ["Microsoft.AspNetCore.Mvc.ModelBinding.UnsupportedContentTypeFilter (Order: -3000)","Microsoft.AspNetCore.Mvc.Infrastructure.ModelStateInvalidFilter (Order: -2000)","BillingSystem.API.ActionFilters.AuditBillingRequestsFilter","BillingSystem.API.ActionFilters.IdempotencyFilter (Order: 0)"]
2025-11-18 16:38:13.712 +03:00 [DBG] Execution plan of exception filters (in the following order): ["None"]
2025-11-18 16:38:13.718 +03:00 [DBG] Execution plan of result filters (in the following order): ["Microsoft.AspNetCore.Mvc.Infrastructure.ClientErrorResultFilter (Order: -2000)","Microsoft.AspNetCore.Mvc.ProducesAttribute (Order: 0)","BillingSystem.API.ActionFilters.IdempotencyFilter (Order: 0)"]
2025-11-18 16:38:13.722 +03:00 [DBG] Executing controller factory for controller BillingSystem.API.Controllers.InvoicesController (BillingSystem.API)
2025-11-18 16:38:13.727 +03:00 [DBG] Executed controller factory for controller BillingSystem.API.Controllers.InvoicesController (BillingSystem.API)
2025-11-18 16:38:13.731 +03:00 [DBG] Attempting to bind parameter 'invoiceRequest' of type 'BillingSystem.Application.Requests.CreateInvoiceRequest' ...
2025-11-18 16:38:13.735 +03:00 [DBG] Attempting to bind parameter 'invoiceRequest' of type 'BillingSystem.Application.Requests.CreateInvoiceRequest' using the name '' in request data ...
2025-11-18 16:38:13.738 +03:00 [DBG] Selected input formatter 'Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonInputFormatter' for content type 'application/json'.
2025-11-18 16:38:13.741 +03:00 [DBG] Connection id "0HNH6KSNLAM25", Request id "0HNH6KSNLAM25:00000001": started reading request body.
2025-11-18 16:38:13.745 +03:00 [DBG] Connection id "0HNH6KSNLAM25", Request id "0HNH6KSNLAM25:00000001": done reading request body.
2025-11-18 16:38:13.749 +03:00 [DBG] JSON input formatter succeeded, deserializing to type 'BillingSystem.Application.Requests.CreateInvoiceRequest'
2025-11-18 16:38:13.751 +03:00 [DBG] Done attempting to bind parameter 'invoiceRequest' of type 'BillingSystem.Application.Requests.CreateInvoiceRequest'.
2025-11-18 16:38:13.754 +03:00 [DBG] Done attempting to bind parameter 'invoiceRequest' of type 'BillingSystem.Application.Requests.CreateInvoiceRequest'.
2025-11-18 16:38:13.757 +03:00 [DBG] Attempting to validate the bound parameter 'invoiceRequest' of type 'BillingSystem.Application.Requests.CreateInvoiceRequest' ...
2025-11-18 16:38:13.761 +03:00 [DBG] Done attempting to validate the bound parameter 'invoiceRequest' of type 'BillingSystem.Application.Requests.CreateInvoiceRequest'.
2025-11-18 16:38:13.788 +03:00 [DBG] Entity Framework Core 9.0.9 initialized 'BillingServiceDBContext' using provider 'Microsoft.EntityFrameworkCore.SqlServer:9.0.9' with options: EngineType=SqlServer 
2025-11-18 16:38:13.803 +03:00 [DBG] Creating DbConnection.
2025-11-18 16:38:13.806 +03:00 [DBG] Created DbConnection. (3ms).
2025-11-18 16:38:13.809 +03:00 [DBG] Opening connection to database 'GAC-BillingService' on server '.'.
2025-11-18 16:38:13.816 +03:00 [DBG] Opened connection to database 'GAC-BillingService' on server '.'.
2025-11-18 16:38:13.819 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-11-18 16:38:13.822 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (2ms).
2025-11-18 16:38:13.825 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (5ms).
2025-11-18 16:38:13.828 +03:00 [DBG] Executing DbCommand [Parameters=[@__idempotentKey_0='?' (Size = 36) (DbType = AnsiString)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [Invoices] AS [i]
        WHERE CONVERT(varchar(36), [i].[ExternalId]) = @__idempotentKey_0) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2025-11-18 16:38:13.835 +03:00 [INF] Executed DbCommand (7ms) [Parameters=[@__idempotentKey_0='?' (Size = 36) (DbType = AnsiString)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [Invoices] AS [i]
        WHERE CONVERT(varchar(36), [i].[ExternalId]) = @__idempotentKey_0) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2025-11-18 16:38:13.839 +03:00 [DBG] Closing data reader to 'GAC-BillingService' on server '.'.
2025-11-18 16:38:13.842 +03:00 [DBG] A data reader for 'GAC-BillingService' on server '.' is being disposed after spending 2ms reading results.
2025-11-18 16:38:13.846 +03:00 [DBG] Closing connection to database 'GAC-BillingService' on server '.'.
2025-11-18 16:38:13.849 +03:00 [DBG] Closed connection to database 'GAC-BillingService' on server '.' (3ms).
2025-11-18 16:38:13.853 +03:00 [DBG] Request was short circuited at action filter 'BillingSystem.API.ActionFilters.IdempotencyFilter'.
2025-11-18 16:38:13.856 +03:00 [DBG] List of registered output formatters, in the following order: ["Microsoft.AspNetCore.Mvc.Formatters.HttpNoContentOutputFormatter","Microsoft.AspNetCore.Mvc.Formatters.StringOutputFormatter","Microsoft.AspNetCore.Mvc.Formatters.StreamOutputFormatter","Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonOutputFormatter"]
2025-11-18 16:38:13.862 +03:00 [DBG] No information found on request to perform content negotiation.
2025-11-18 16:38:13.864 +03:00 [DBG] Attempting to select the first output formatter in the output formatters list which supports a content type from the explicitly specified content types '["application/json"]'.
2025-11-18 16:38:13.867 +03:00 [DBG] Selected output formatter 'Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonOutputFormatter' and content type 'application/json' to write the response.
2025-11-18 16:38:13.869 +03:00 [INF] Executing ConflictObjectResult, writing value of type 'System.String'.
2025-11-18 16:38:13.873 +03:00 [INF] Executed action BillingSystem.API.Controllers.InvoicesController.Post (BillingSystem.API) in 150.9067ms
2025-11-18 16:38:13.876 +03:00 [INF] Executed endpoint 'BillingSystem.API.Controllers.InvoicesController.Post (BillingSystem.API)'
2025-11-18 16:38:13.879 +03:00 [INF] HTTP POST /api/Invoices responded 409 in 196.8574 ms
2025-11-18 16:38:13.884 +03:00 [DBG] Connection id "0HNH6KSNLAM25" completed keep alive response.
2025-11-18 16:38:13.887 +03:00 [DBG] 'BillingServiceDBContext' disposed.
2025-11-18 16:38:13.891 +03:00 [DBG] Disposing connection to database 'GAC-BillingService' on server '.'.
2025-11-18 16:38:13.896 +03:00 [DBG] Disposed connection to database '' on server '' (4ms).
2025-11-18 16:38:13.901 +03:00 [INF] Request finished HTTP/1.1 POST https://localhost:7257/api/Invoices - 409 null application/json; charset=utf-8 238.9149ms
2025-11-18 16:38:21.533 +03:00 [DBG] Connection id "0HNH6KSNLAM21" received FIN.
2025-11-18 16:38:21.538 +03:00 [DBG] Connection id "0HNH6KSNLAM21" is closed. The last processed stream ID was 7.
2025-11-18 16:38:21.538 +03:00 [DBG] The connection queue processing loop for 0HNH6KSNLAM21 completed.
2025-11-18 16:38:21.543 +03:00 [DBG] Connection id "0HNH6KSNLAM21" sending FIN because: "The Socket transport's send loop completed gracefully."
2025-11-18 16:38:21.564 +03:00 [DBG] Connection id "0HNH6KSNLAM21" stopped.
2025-11-18 16:38:39.001 +03:00 [INF] Request starting HTTP/1.1 POST https://localhost:7257/api/Invoices - application/json 1380
2025-11-18 16:38:39.008 +03:00 [DBG] 1 candidate(s) found for the request path '/api/Invoices'
2025-11-18 16:38:39.010 +03:00 [DBG] Endpoint 'BillingSystem.API.Controllers.InvoicesController.Post (BillingSystem.API)' with route pattern 'api/Invoices' is valid for the request path '/api/Invoices'
2025-11-18 16:38:39.014 +03:00 [DBG] Request matched endpoint 'BillingSystem.API.Controllers.InvoicesController.Post (BillingSystem.API)'
2025-11-18 16:38:39.016 +03:00 [DBG] Static files was skipped as the request already matched an endpoint.
2025-11-18 16:38:39.024 +03:00 [INF] Executing endpoint 'BillingSystem.API.Controllers.InvoicesController.Post (BillingSystem.API)'
2025-11-18 16:38:39.030 +03:00 [INF] Route matched with {action = "Post", controller = "Invoices"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Post(BillingSystem.Application.Requests.CreateInvoiceRequest) on controller BillingSystem.API.Controllers.InvoicesController (BillingSystem.API).
2025-11-18 16:38:39.034 +03:00 [DBG] Execution plan of authorization filters (in the following order): ["None"]
2025-11-18 16:38:39.037 +03:00 [DBG] Execution plan of resource filters (in the following order): ["None"]
2025-11-18 16:38:39.041 +03:00 [DBG] Execution plan of action filters (in the following order): ["Microsoft.AspNetCore.Mvc.ModelBinding.UnsupportedContentTypeFilter (Order: -3000)","Microsoft.AspNetCore.Mvc.Infrastructure.ModelStateInvalidFilter (Order: -2000)","BillingSystem.API.ActionFilters.AuditBillingRequestsFilter","BillingSystem.API.ActionFilters.IdempotencyFilter (Order: 0)"]
2025-11-18 16:38:39.047 +03:00 [DBG] Execution plan of exception filters (in the following order): ["None"]
2025-11-18 16:38:39.050 +03:00 [DBG] Execution plan of result filters (in the following order): ["Microsoft.AspNetCore.Mvc.Infrastructure.ClientErrorResultFilter (Order: -2000)","Microsoft.AspNetCore.Mvc.ProducesAttribute (Order: 0)","BillingSystem.API.ActionFilters.IdempotencyFilter (Order: 0)"]
2025-11-18 16:38:39.055 +03:00 [DBG] Executing controller factory for controller BillingSystem.API.Controllers.InvoicesController (BillingSystem.API)
2025-11-18 16:38:39.059 +03:00 [DBG] Executed controller factory for controller BillingSystem.API.Controllers.InvoicesController (BillingSystem.API)
2025-11-18 16:38:39.062 +03:00 [DBG] Attempting to bind parameter 'invoiceRequest' of type 'BillingSystem.Application.Requests.CreateInvoiceRequest' ...
2025-11-18 16:38:39.065 +03:00 [DBG] Attempting to bind parameter 'invoiceRequest' of type 'BillingSystem.Application.Requests.CreateInvoiceRequest' using the name '' in request data ...
2025-11-18 16:38:39.068 +03:00 [DBG] Selected input formatter 'Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonInputFormatter' for content type 'application/json'.
2025-11-18 16:38:39.071 +03:00 [DBG] Connection id "0HNH6KSNLAM25", Request id "0HNH6KSNLAM25:00000002": started reading request body.
2025-11-18 16:38:39.075 +03:00 [DBG] Connection id "0HNH6KSNLAM25", Request id "0HNH6KSNLAM25:00000002": done reading request body.
2025-11-18 16:38:39.078 +03:00 [DBG] JSON input formatter succeeded, deserializing to type 'BillingSystem.Application.Requests.CreateInvoiceRequest'
2025-11-18 16:38:39.080 +03:00 [DBG] Done attempting to bind parameter 'invoiceRequest' of type 'BillingSystem.Application.Requests.CreateInvoiceRequest'.
2025-11-18 16:38:39.083 +03:00 [DBG] Done attempting to bind parameter 'invoiceRequest' of type 'BillingSystem.Application.Requests.CreateInvoiceRequest'.
2025-11-18 16:38:39.086 +03:00 [DBG] Attempting to validate the bound parameter 'invoiceRequest' of type 'BillingSystem.Application.Requests.CreateInvoiceRequest' ...
2025-11-18 16:38:39.089 +03:00 [DBG] Done attempting to validate the bound parameter 'invoiceRequest' of type 'BillingSystem.Application.Requests.CreateInvoiceRequest'.
2025-11-18 16:38:39.148 +03:00 [DBG] Entity Framework Core 9.0.9 initialized 'BillingServiceDBContext' using provider 'Microsoft.EntityFrameworkCore.SqlServer:9.0.9' with options: EngineType=SqlServer 
2025-11-18 16:38:39.159 +03:00 [DBG] Creating DbConnection.
2025-11-18 16:38:39.161 +03:00 [DBG] Created DbConnection. (2ms).
2025-11-18 16:38:39.165 +03:00 [DBG] Opening connection to database 'GAC-BillingService' on server '.'.
2025-11-18 16:38:39.169 +03:00 [DBG] Opened connection to database 'GAC-BillingService' on server '.'.
2025-11-18 16:38:39.172 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-11-18 16:38:39.174 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (2ms).
2025-11-18 16:38:39.177 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (4ms).
2025-11-18 16:38:39.180 +03:00 [DBG] Executing DbCommand [Parameters=[@__idempotentKey_0='?' (Size = 36) (DbType = AnsiString)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [Invoices] AS [i]
        WHERE CONVERT(varchar(36), [i].[ExternalId]) = @__idempotentKey_0) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2025-11-18 16:38:39.188 +03:00 [INF] Executed DbCommand (8ms) [Parameters=[@__idempotentKey_0='?' (Size = 36) (DbType = AnsiString)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [Invoices] AS [i]
        WHERE CONVERT(varchar(36), [i].[ExternalId]) = @__idempotentKey_0) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2025-11-18 16:38:39.194 +03:00 [DBG] Closing data reader to 'GAC-BillingService' on server '.'.
2025-11-18 16:38:39.198 +03:00 [DBG] A data reader for 'GAC-BillingService' on server '.' is being disposed after spending 4ms reading results.
2025-11-18 16:38:39.203 +03:00 [DBG] Closing connection to database 'GAC-BillingService' on server '.'.
2025-11-18 16:38:39.206 +03:00 [DBG] Closed connection to database 'GAC-BillingService' on server '.' (3ms).
2025-11-18 16:42:31.369 +03:00 [DBG] Registered model binder providers, in the following order: ["Microsoft.AspNetCore.Mvc.ModelBinding.Binders.BinderTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ServicesModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.BodyModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.HeaderModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FloatingPointTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.EnumTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.DateTimeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.SimpleTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.TryParseModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.CancellationTokenModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ByteArrayModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FormFileModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FormCollectionModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.KeyValuePairModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.DictionaryModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ArrayModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.CollectionModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ComplexObjectModelBinderProvider"]
2025-11-18 16:42:31.567 +03:00 [DBG] Hosting starting
2025-11-18 16:42:31.937 +03:00 [DBG] Starting bus instances: IBus
2025-11-18 16:42:31.951 +03:00 [DBG] Starting bus: "rabbitmq://localhost/"
2025-11-18 16:42:32.003 +03:00 [DBG] Middleware loaded
2025-11-18 16:42:32.012 +03:00 [DBG] Middleware loaded. Script /_framework/aspnetcore-browser-refresh.js (16519 B).
2025-11-18 16:42:32.030 +03:00 [DBG] Middleware loaded. Script /_framework/blazor-hotreload.js (799 B).
2025-11-18 16:42:32.036 +03:00 [DBG] Connect: guest@localhost:5672/
2025-11-18 16:42:32.198 +03:00 [DBG] Middleware loaded: DOTNET_MODIFIABLE_ASSEMBLIES=debug, __ASPNETCORE_BROWSER_TOOLS=true
2025-11-18 16:42:32.221 +03:00 [DBG] Connected: guest@localhost:5672/ (address: amqp://localhost:5672, local: 50324)
2025-11-18 16:42:32.270 +03:00 [DBG] Endpoint Ready: "rabbitmq://localhost/ECHGHANNAMLP1_BillingSystemAPI_bus_ry1yyyyh3bcsbgwcbdxnpkn1gj?temporary=true"
2025-11-18 16:42:32.275 +03:00 [INF] Bus started: "rabbitmq://localhost/"
2025-11-18 16:42:32.505 +03:00 [INF] Now listening on: https://localhost:7257
2025-11-18 16:42:32.510 +03:00 [INF] Now listening on: http://localhost:5009
2025-11-18 16:42:32.514 +03:00 [DBG] Loaded hosting startup assembly BillingSystem.API
2025-11-18 16:42:32.516 +03:00 [DBG] Loaded hosting startup assembly Microsoft.WebTools.ApiEndpointDiscovery
2025-11-18 16:42:32.519 +03:00 [DBG] Loaded hosting startup assembly Microsoft.AspNetCore.Watch.BrowserRefresh
2025-11-18 16:42:32.521 +03:00 [DBG] Loaded hosting startup assembly Microsoft.WebTools.BrowserLink.Net
2025-11-18 16:42:32.680 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-11-18 16:42:32.687 +03:00 [INF] Hosting environment: Development
2025-11-18 16:42:32.690 +03:00 [INF] Content root path: C:\Repositories\Gac-BillingSystem\src\BillingSystem.API
2025-11-18 16:42:32.695 +03:00 [DBG] Hosting started
2025-11-18 16:42:32.746 +03:00 [DBG] Connection id "0HNH6L19L4B3D" accepted.
2025-11-18 16:42:32.755 +03:00 [DBG] Connection id "0HNH6L19L4B3D" started.
2025-11-18 16:42:32.759 +03:00 [DBG] Connection id "0HNH6L19L4B3D" received FIN.
2025-11-18 16:42:32.789 +03:00 [DBG] Failed to authenticate HTTPS connection.
System.IO.IOException: Received an unexpected EOF or 0 bytes from the transport stream.
   at System.Net.Security.SslStream.ReceiveHandshakeFrameAsync[TIOAdapter](CancellationToken cancellationToken)
   at System.Net.Security.SslStream.ForceAuthenticationAsync[TIOAdapter](Boolean receiveFirst, Byte[] reAuthenticationData, CancellationToken cancellationToken)
   at System.Net.Security.SslStream.ProcessAuthenticationWithTelemetryAsync(Boolean isAsync, CancellationToken cancellationToken)
   at Microsoft.AspNetCore.Server.Kestrel.Https.Internal.HttpsConnectionMiddleware.OnConnectionAsync(ConnectionContext context)
2025-11-18 16:42:32.831 +03:00 [DBG] Connection id "0HNH6L19L4B3D" stopped.
2025-11-18 16:42:32.844 +03:00 [DBG] Connection id "0HNH6L19L4B3D" sending FIN because: "The Socket transport's send loop completed gracefully."
2025-11-18 16:42:33.317 +03:00 [DBG] Connection id "0HNH6L19L4B3E" accepted.
2025-11-18 16:42:33.321 +03:00 [DBG] Connection id "0HNH6L19L4B3E" started.
2025-11-18 16:42:33.385 +03:00 [DBG] Connection 0HNH6L19L4B3E established using the following protocol: "Tls13"
2025-11-18 16:42:33.461 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7257/swagger/index.html - null null
2025-11-18 16:42:33.535 +03:00 [DBG] Wildcard detected, all requests with hosts will be allowed.
2025-11-18 16:42:33.560 +03:00 [DBG] No candidates found for the request path '/swagger/index.html'
2025-11-18 16:42:33.565 +03:00 [DBG] Request did not match any endpoints
2025-11-18 16:42:33.647 +03:00 [DBG] Response markup is scheduled to include Browser Link script injection.
2025-11-18 16:42:33.654 +03:00 [DBG] Response markup is scheduled to include browser refresh script injection.
2025-11-18 16:42:33.687 +03:00 [INF] HTTP GET /swagger/index.html responded 200 in 110.9534 ms
2025-11-18 16:42:33.695 +03:00 [DBG] Response markup was updated to include Browser Link script injection.
2025-11-18 16:42:33.699 +03:00 [DBG] Response markup was updated to include browser refresh script injection.
2025-11-18 16:42:33.707 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7257/swagger/index.html - 200 null text/html;charset=utf-8 257.4783ms
2025-11-18 16:42:33.778 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7257/_vs/browserLink - null null
2025-11-18 16:42:33.778 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7257/_framework/aspnetcore-browser-refresh.js - null null
2025-11-18 16:42:33.807 +03:00 [DBG] Script injected: /_framework/aspnetcore-browser-refresh.js
2025-11-18 16:42:33.812 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7257/_framework/aspnetcore-browser-refresh.js - 200 16519 application/javascript; charset=utf-8 33.7335ms
2025-11-18 16:42:33.857 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7257/_vs/browserLink - 200 null text/javascript; charset=UTF-8 80.0867ms
2025-11-18 16:42:33.922 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7257/swagger/v1/swagger.json - null null
2025-11-18 16:42:33.930 +03:00 [DBG] No candidates found for the request path '/swagger/v1/swagger.json'
2025-11-18 16:42:33.935 +03:00 [DBG] Request did not match any endpoints
2025-11-18 16:42:33.969 +03:00 [INF] HTTP GET /swagger/v1/swagger.json responded 200 in 29.4651 ms
2025-11-18 16:42:33.981 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7257/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 59.414ms
2025-11-18 16:43:20.125 +03:00 [DBG] Connection id "0HNH6L19L4B3F" accepted.
2025-11-18 16:43:20.126 +03:00 [DBG] Connection id "0HNH6L19L4B3F" received FIN.
2025-11-18 16:43:20.132 +03:00 [DBG] Connection id "0HNH6L19L4B3G" accepted.
2025-11-18 16:43:20.132 +03:00 [DBG] Connection id "0HNH6L19L4B3F" started.
2025-11-18 16:43:20.157 +03:00 [DBG] Connection id "0HNH6L19L4B3G" started.
2025-11-18 16:43:20.163 +03:00 [DBG] Failed to authenticate HTTPS connection.
System.IO.IOException: Received an unexpected EOF or 0 bytes from the transport stream.
   at System.Net.Security.SslStream.ReceiveHandshakeFrameAsync[TIOAdapter](CancellationToken cancellationToken)
   at System.Net.Security.SslStream.ForceAuthenticationAsync[TIOAdapter](Boolean receiveFirst, Byte[] reAuthenticationData, CancellationToken cancellationToken)
   at System.Net.Security.SslStream.ProcessAuthenticationWithTelemetryAsync(Boolean isAsync, CancellationToken cancellationToken)
   at Microsoft.AspNetCore.Server.Kestrel.Https.Internal.HttpsConnectionMiddleware.OnConnectionAsync(ConnectionContext context)
2025-11-18 16:43:20.174 +03:00 [DBG] Connection id "0HNH6L19L4B3F" stopped.
2025-11-18 16:43:20.176 +03:00 [DBG] Connection 0HNH6L19L4B3G established using the following protocol: "Tls13"
2025-11-18 16:43:20.179 +03:00 [DBG] Connection id "0HNH6L19L4B3F" sending FIN because: "The Socket transport's send loop completed gracefully."
2025-11-18 16:43:20.188 +03:00 [INF] Request starting HTTP/1.1 POST https://localhost:7257/api/Invoices - application/json 1380
2025-11-18 16:43:20.204 +03:00 [DBG] 1 candidate(s) found for the request path '/api/Invoices'
2025-11-18 16:43:20.213 +03:00 [DBG] Endpoint 'BillingSystem.API.Controllers.InvoicesController.Post (BillingSystem.API)' with route pattern 'api/Invoices' is valid for the request path '/api/Invoices'
2025-11-18 16:43:20.219 +03:00 [DBG] Request matched endpoint 'BillingSystem.API.Controllers.InvoicesController.Post (BillingSystem.API)'
2025-11-18 16:43:20.225 +03:00 [DBG] Static files was skipped as the request already matched an endpoint.
2025-11-18 16:43:20.458 +03:00 [DBG] An 'IServiceProvider' was created for internal use by Entity Framework.
2025-11-18 16:43:26.015 +03:00 [INF] Executing endpoint 'BillingSystem.API.Controllers.InvoicesController.Post (BillingSystem.API)'
2025-11-18 16:43:26.074 +03:00 [INF] Route matched with {action = "Post", controller = "Invoices"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Post(BillingSystem.Application.Requests.CreateInvoiceRequest) on controller BillingSystem.API.Controllers.InvoicesController (BillingSystem.API).
2025-11-18 16:43:26.086 +03:00 [DBG] Execution plan of authorization filters (in the following order): ["None"]
2025-11-18 16:43:26.089 +03:00 [DBG] Execution plan of resource filters (in the following order): ["None"]
2025-11-18 16:43:26.094 +03:00 [DBG] Execution plan of action filters (in the following order): ["Microsoft.AspNetCore.Mvc.ModelBinding.UnsupportedContentTypeFilter (Order: -3000)","Microsoft.AspNetCore.Mvc.Infrastructure.ModelStateInvalidFilter (Order: -2000)","BillingSystem.API.ActionFilters.AuditBillingRequestsFilter","BillingSystem.API.ActionFilters.IdempotencyFilter (Order: 0)"]
2025-11-18 16:43:26.104 +03:00 [DBG] Execution plan of exception filters (in the following order): ["None"]
2025-11-18 16:43:26.111 +03:00 [DBG] Execution plan of result filters (in the following order): ["Microsoft.AspNetCore.Mvc.Infrastructure.ClientErrorResultFilter (Order: -2000)","Microsoft.AspNetCore.Mvc.ProducesAttribute (Order: 0)","BillingSystem.API.ActionFilters.IdempotencyFilter (Order: 0)"]
2025-11-18 16:43:26.120 +03:00 [DBG] Executing controller factory for controller BillingSystem.API.Controllers.InvoicesController (BillingSystem.API)
2025-11-18 16:43:26.127 +03:00 [WRN] You do not have a valid license key for the Lucky Penny software MediatR. This is allowed for development and testing scenarios. If you are running in production you are required to have a licensed version. Please visit https://luckypennysoftware.com to obtain a valid license.
2025-11-18 16:43:26.182 +03:00 [DBG] Executed controller factory for controller BillingSystem.API.Controllers.InvoicesController (BillingSystem.API)
2025-11-18 16:43:26.208 +03:00 [DBG] Attempting to bind parameter 'invoiceRequest' of type 'BillingSystem.Application.Requests.CreateInvoiceRequest' ...
2025-11-18 16:43:26.215 +03:00 [DBG] Attempting to bind parameter 'invoiceRequest' of type 'BillingSystem.Application.Requests.CreateInvoiceRequest' using the name '' in request data ...
2025-11-18 16:43:26.222 +03:00 [DBG] Selected input formatter 'Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonInputFormatter' for content type 'application/json'.
2025-11-18 16:43:26.256 +03:00 [DBG] Connection id "0HNH6L19L4B3G", Request id "0HNH6L19L4B3G:00000001": started reading request body.
2025-11-18 16:43:26.263 +03:00 [DBG] Connection id "0HNH6L19L4B3G", Request id "0HNH6L19L4B3G:00000001": done reading request body.
2025-11-18 16:43:26.292 +03:00 [DBG] JSON input formatter succeeded, deserializing to type 'BillingSystem.Application.Requests.CreateInvoiceRequest'
2025-11-18 16:43:26.295 +03:00 [DBG] Done attempting to bind parameter 'invoiceRequest' of type 'BillingSystem.Application.Requests.CreateInvoiceRequest'.
2025-11-18 16:43:26.301 +03:00 [DBG] Done attempting to bind parameter 'invoiceRequest' of type 'BillingSystem.Application.Requests.CreateInvoiceRequest'.
2025-11-18 16:43:26.305 +03:00 [DBG] Attempting to validate the bound parameter 'invoiceRequest' of type 'BillingSystem.Application.Requests.CreateInvoiceRequest' ...
2025-11-18 16:43:26.329 +03:00 [DBG] Done attempting to validate the bound parameter 'invoiceRequest' of type 'BillingSystem.Application.Requests.CreateInvoiceRequest'.
2025-11-18 16:43:26.651 +03:00 [DBG] No relationship from 'Invoice' to 'Invoice' has been configured by convention because there are multiple properties on one entity type - {'DiscountedPrimaryInvoice'} that could be matched with the properties on the other entity type - {'InverseDiscountedPrimaryInvoice', 'InversePrimaryInvoice', 'InverseSubstitutionPrimaryInvoice', 'PrimaryInvoice', 'SubstitutionPrimaryInvoice'}. This message can be disregarded if explicit configuration has been specified in 'OnModelCreating'.
2025-11-18 16:43:26.911 +03:00 [DBG] No relationship from 'Invoice' to 'Invoice' has been configured by convention because there are multiple properties on one entity type - {'DiscountedPrimaryInvoice'} that could be matched with the properties on the other entity type - {'InverseDiscountedPrimaryInvoice', 'InversePrimaryInvoice', 'InverseSubstitutionPrimaryInvoice', 'PrimaryInvoice', 'SubstitutionPrimaryInvoice'}. This message can be disregarded if explicit configuration has been specified in 'OnModelCreating'.
2025-11-18 16:43:26.926 +03:00 [DBG] No relationship from 'Invoice' to 'Invoice' has been configured by convention because there are multiple properties on one entity type - {'InversePrimaryInvoice'} that could be matched with the properties on the other entity type - {'InverseSubstitutionPrimaryInvoice', 'PrimaryInvoice', 'SubstitutionPrimaryInvoice'}. This message can be disregarded if explicit configuration has been specified in 'OnModelCreating'.
2025-11-18 16:43:26.937 +03:00 [DBG] No relationship from 'Invoice' to 'Invoice' has been configured by convention because there are multiple properties on one entity type - {'InversePrimaryInvoice'} that could be matched with the properties on the other entity type - {'InverseSubstitutionPrimaryInvoice', 'PrimaryInvoice', 'SubstitutionPrimaryInvoice'}. This message can be disregarded if explicit configuration has been specified in 'OnModelCreating'.
2025-11-18 16:43:27.365 +03:00 [DBG] Entity Framework Core 9.0.9 initialized 'BillingServiceDBContext' using provider 'Microsoft.EntityFrameworkCore.SqlServer:9.0.9' with options: EngineType=SqlServer 
2025-11-18 16:43:27.494 +03:00 [DBG] Compiling query expression: 
'DbSet<Invoice>()
    .AsNoTracking()
    .Any(inv => inv.ExternalId.ToString() == __idempotentKey_0)'
2025-11-18 16:43:27.841 +03:00 [DBG] Generated query execution expression: 
'queryContext => ShapedQueryCompilingExpressionVisitor.SingleAsync<bool>(
    asyncEnumerable: SingleQueryingEnumerable.Create<bool>(
        relationalQueryContext: (RelationalQueryContext)queryContext, 
        relationalCommandResolver: parameters => [LIFTABLE Constant: RelationalCommandCache.QueryExpression(
            Projection Mapping:
                EmptyProjectionMember -> 0
            SELECT EXISTS (
                SELECT 1
                FROM Invoices AS i
                WHERE COALESCE(CONVERT(varchar(36), i.ExternalId), '') == @__idempotentKey_0)) | Resolver: c => new RelationalCommandCache(
            c.Dependencies.MemoryCache, 
            c.RelationalDependencies.QuerySqlGeneratorFactory, 
            c.RelationalDependencies.RelationalParameterBasedSqlProcessorFactory, 
            Projection Mapping:
                EmptyProjectionMember -> 0
            SELECT EXISTS (
                SELECT 1
                FROM Invoices AS i
                WHERE COALESCE(CONVERT(varchar(36), i.ExternalId), '') == @__idempotentKey_0), 
            False, 
            new HashSet<string>(
                new string[]{ }, 
                StringComparer.Ordinal
            )
        )].GetRelationalCommandTemplate(parameters), 
        readerColumns: null, 
        shaper: (queryContext, dataReader, resultContext, resultCoordinator) => 
        {
            bool? value1;
            value1 = dataReader.IsDBNull(0) ? default(bool?) : (bool?)dataReader.GetBoolean(0);
            return (bool)value1;
        }, 
        contextType: BillingSystem.Infrastructure.EF.BillingServiceDBContext, 
        standAloneStateManager: False, 
        detailedErrorsEnabled: False, 
        threadSafetyChecksEnabled: True), 
    cancellationToken: queryContext.CancellationToken)'
2025-11-18 16:43:27.905 +03:00 [DBG] Creating DbConnection.
2025-11-18 16:43:27.935 +03:00 [DBG] Created DbConnection. (27ms).
2025-11-18 16:43:27.943 +03:00 [DBG] Opening connection to database 'GAC-BillingService' on server '.'.
2025-11-18 16:43:28.295 +03:00 [DBG] Opened connection to database 'GAC-BillingService' on server '.'.
2025-11-18 16:43:28.310 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-11-18 16:43:28.326 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (12ms).
2025-11-18 16:43:28.339 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (29ms).
2025-11-18 16:43:28.360 +03:00 [DBG] Executing DbCommand [Parameters=[@__idempotentKey_0='?' (Size = 36) (DbType = AnsiString)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [Invoices] AS [i]
        WHERE CONVERT(varchar(36), [i].[ExternalId]) = @__idempotentKey_0) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2025-11-18 16:43:28.451 +03:00 [INF] Executed DbCommand (96ms) [Parameters=[@__idempotentKey_0='?' (Size = 36) (DbType = AnsiString)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [Invoices] AS [i]
        WHERE CONVERT(varchar(36), [i].[ExternalId]) = @__idempotentKey_0) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2025-11-18 16:43:28.483 +03:00 [DBG] Closing data reader to 'GAC-BillingService' on server '.'.
2025-11-18 16:43:28.506 +03:00 [DBG] A data reader for 'GAC-BillingService' on server '.' is being disposed after spending 38ms reading results.
2025-11-18 16:43:28.519 +03:00 [DBG] Closing connection to database 'GAC-BillingService' on server '.'.
2025-11-18 16:43:28.534 +03:00 [DBG] Closed connection to database 'GAC-BillingService' on server '.' (15ms).
2025-11-18 16:43:28.744 +03:00 [WRN] You do not have a valid license key for the Lucky Penny software AutoMapper. This is allowed for development and testing scenarios. If you are running in production you are required to have a licensed version. Please visit https://luckypennysoftware.com to obtain a valid license.
2025-11-18 16:44:20.940 +03:00 [DBG] Opening connection to database 'GAC-BillingService' on server '.'.
2025-11-18 16:44:20.952 +03:00 [DBG] Opened connection to database 'GAC-BillingService' on server '.'.
2025-11-18 16:44:20.960 +03:00 [DBG] Beginning transaction with isolation level 'Unspecified'.
2025-11-18 16:44:20.976 +03:00 [DBG] Began transaction with isolation level 'ReadCommitted'.
2025-11-18 16:44:20.989 +03:00 [DBG] Compiling query expression: 
'DbSet<InvoiceSequenceValue>().FromSql(EXECUTE dbo.GetNextInvoiceNumber, __p_0)
'
2025-11-18 16:44:21.048 +03:00 [DBG] Generated query execution expression: 
'queryContext => FromSqlQueryingEnumerable.Create<InvoiceSequenceValue>(
    relationalQueryContext: (RelationalQueryContext)queryContext, 
    relationalCommandResolver: parameters => [LIFTABLE Constant: RelationalCommandCache.QueryExpression(
        Projection Mapping:
            EmptyProjectionMember -> Dictionary<IProperty, int> { [Property: InvoiceSequenceValue.Value (long) Required, 0] }
        SELECT b.Value
        FROM EXECUTE dbo.GetNextInvoiceNumber) | Resolver: c => new RelationalCommandCache(
        c.Dependencies.MemoryCache, 
        c.RelationalDependencies.QuerySqlGeneratorFactory, 
        c.RelationalDependencies.RelationalParameterBasedSqlProcessorFactory, 
        Projection Mapping:
            EmptyProjectionMember -> Dictionary<IProperty, int> { [Property: InvoiceSequenceValue.Value (long) Required, 0] }
        SELECT b.Value
        FROM EXECUTE dbo.GetNextInvoiceNumber, 
        False, 
        new HashSet<string>(
            new string[]{ }, 
            StringComparer.Ordinal
        )
    )].GetRelationalCommandTemplate(parameters), 
    readerColumns: null, 
    columnNames: [LIFTABLE Constant: string[] { "Value" } | Resolver: _ => new string[]{ "Value" }], 
    shaper: (queryContext, dataReader, indexMap) => 
    {
        InvoiceSequenceValue entity;
        entity = 
        {
            MaterializationContext materializationContext1;
            IEntityType entityType1;
            InvoiceSequenceValue instance1;
            materializationContext1 = new MaterializationContext(
                [LIFTABLE Constant: ValueBuffer | Resolver: _ => (object)ValueBuffer.Empty], 
                queryContext.Context
            );
            instance1 = default(InvoiceSequenceValue);
            {
                ISnapshot shadowSnapshot1;
                shadowSnapshot1 = [LIFTABLE Constant: Snapshot | Resolver: _ => Snapshot.Empty];
                entityType1 = [LIFTABLE Constant: EntityType: InvoiceSequenceValue Keyless | Resolver: namelessParameter{0} => namelessParameter{0}.Dependencies.Model.FindEntityType("BillingSystem.Domain.Entities.InvoiceSequenceValue")];
                instance1 = switch (entityType1)
                {
                    case [LIFTABLE Constant: EntityType: InvoiceSequenceValue Keyless | Resolver: namelessParameter{1} => namelessParameter{1}.Dependencies.Model.FindEntityType("BillingSystem.Domain.Entities.InvoiceSequenceValue")]: 
                        {
                            return 
                            {
                                InvoiceSequenceValue instance;
                                instance = new InvoiceSequenceValue();
                                instance.<Value>k__BackingField = dataReader.GetInt64(indexMap[0]);
                                (instance is IInjectableService) ? ((IInjectableService)instance).Injected(
                                    context: materializationContext1.Context, 
                                    entity: instance, 
                                    queryTrackingBehavior: TrackAll, 
                                    structuralType: [LIFTABLE Constant: EntityType: InvoiceSequenceValue Keyless | Resolver: namelessParameter{2} => namelessParameter{2}.Dependencies.Model.FindEntityType("BillingSystem.Domain.Entities.InvoiceSequenceValue")]) : default(void);
                                return instance;
                            }}
                    default: 
                        default(InvoiceSequenceValue)
                }
                ;
                return instance1;
            }return instance1;
        };
        return entity;
    }, 
    contextType: BillingSystem.Infrastructure.EF.BillingServiceDBContext, 
    standAloneStateManager: False, 
    detailedErrorsEnabled: False, 
    threadSafetyChecksEnabled: True)'
2025-11-18 16:44:21.065 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-11-18 16:44:21.074 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (8ms).
2025-11-18 16:44:21.082 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (16ms).
2025-11-18 16:44:21.089 +03:00 [DBG] Executing DbCommand [Parameters=[], CommandType='"Text"', CommandTimeout='30']
EXECUTE dbo.GetNextInvoiceNumber
2025-11-18 16:44:21.102 +03:00 [INF] Executed DbCommand (14ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
EXECUTE dbo.GetNextInvoiceNumber
2025-11-18 16:44:21.114 +03:00 [DBG] Closing data reader to 'GAC-BillingService' on server '.'.
2025-11-18 16:44:21.117 +03:00 [DBG] A data reader for 'GAC-BillingService' on server '.' is being disposed after spending 8ms reading results.
2025-11-18 16:44:21.125 +03:00 [DBG] Compiling query expression: 
'DbSet<Customer>()
    .FirstOrDefault(c => c.IdentityNumber == __cutomerIdentityNumber_0)'
2025-11-18 16:44:21.153 +03:00 [DBG] Generated query execution expression: 
'queryContext => SingleQueryingEnumerable.Create<Customer>(
    relationalQueryContext: (RelationalQueryContext)queryContext, 
    relationalCommandResolver: parameters => [LIFTABLE Constant: RelationalCommandCache.QueryExpression(
        Projection Mapping:
            EmptyProjectionMember -> Dictionary<IProperty, int> { [Property: Customer.Id (long) Required PK AfterSave:Throw ValueGenerated.OnAdd, 0], [Property: Customer.AddressBuildingNumber (string) MaxLength(200), 1], [Property: Customer.AddressCity (string) Required MaxLength(200), 2], [Property: Customer.AddressCountry (string) Required MaxLength(200), 3], [Property: Customer.AddressDistrict (string) Required MaxLength(200), 4], [Property: Customer.AddressPostalCode (string) Required MaxLength(50), 5], [Property: Customer.AddressStreet (string) MaxLength(200), 6], [Property: Customer.AddressSubNumber (string) MaxLength(200), 7], [Property: Customer.CreatedBy (string) Required MaxLength(50), 8], [Property: Customer.CreatedDate (DateTime) Required, 9], [Property: Customer.CustomerType (string) Required MaxLength(100), 10], [Property: Customer.EmailAddress (string) MaxLength(80), 11], [Property: Customer.FullName (string) Required MaxLength(500), 12], [Property: Customer.IdentityNumber (string) Required MaxLength(100), 13], [Property: Customer.IdentityType (int?), 14], [Property: Customer.IsDeleted (bool) Required, 15], [Property: Customer.LastUpdatedDate (DateTime?), 16], [Property: Customer.OverpaymentBalance (decimal?), 17], [Property: Customer.PhoneNumber (string) MaxLength(50), 18], [Property: Customer.Vatnumber (string) MaxLength(100), 19] }
        SELECT TOP(1) c.Id, c.Address_BuildingNumber, c.Address_City, c.Address_Country, c.Address_District, c.Address_PostalCode, c.Address_Street, c.Address_SubNumber, c.CreatedBy, c.CreatedDate, c.CustomerType, c.EmailAddress, c.FullName, c.IdentityNumber, c.IdentityType, c.IsDeleted, c.LastUpdatedDate, c.OverpaymentBalance, c.PhoneNumber, c.VATNumber
        FROM Customers AS c
        WHERE c.IdentityNumber == @__cutomerIdentityNumber_0) | Resolver: c => new RelationalCommandCache(
        c.Dependencies.MemoryCache, 
        c.RelationalDependencies.QuerySqlGeneratorFactory, 
        c.RelationalDependencies.RelationalParameterBasedSqlProcessorFactory, 
        Projection Mapping:
            EmptyProjectionMember -> Dictionary<IProperty, int> { [Property: Customer.Id (long) Required PK AfterSave:Throw ValueGenerated.OnAdd, 0], [Property: Customer.AddressBuildingNumber (string) MaxLength(200), 1], [Property: Customer.AddressCity (string) Required MaxLength(200), 2], [Property: Customer.AddressCountry (string) Required MaxLength(200), 3], [Property: Customer.AddressDistrict (string) Required MaxLength(200), 4], [Property: Customer.AddressPostalCode (string) Required MaxLength(50), 5], [Property: Customer.AddressStreet (string) MaxLength(200), 6], [Property: Customer.AddressSubNumber (string) MaxLength(200), 7], [Property: Customer.CreatedBy (string) Required MaxLength(50), 8], [Property: Customer.CreatedDate (DateTime) Required, 9], [Property: Customer.CustomerType (string) Required MaxLength(100), 10], [Property: Customer.EmailAddress (string) MaxLength(80), 11], [Property: Customer.FullName (string) Required MaxLength(500), 12], [Property: Customer.IdentityNumber (string) Required MaxLength(100), 13], [Property: Customer.IdentityType (int?), 14], [Property: Customer.IsDeleted (bool) Required, 15], [Property: Customer.LastUpdatedDate (DateTime?), 16], [Property: Customer.OverpaymentBalance (decimal?), 17], [Property: Customer.PhoneNumber (string) MaxLength(50), 18], [Property: Customer.Vatnumber (string) MaxLength(100), 19] }
        SELECT TOP(1) c.Id, c.Address_BuildingNumber, c.Address_City, c.Address_Country, c.Address_District, c.Address_PostalCode, c.Address_Street, c.Address_SubNumber, c.CreatedBy, c.CreatedDate, c.CustomerType, c.EmailAddress, c.FullName, c.IdentityNumber, c.IdentityType, c.IsDeleted, c.LastUpdatedDate, c.OverpaymentBalance, c.PhoneNumber, c.VATNumber
        FROM Customers AS c
        WHERE c.IdentityNumber == @__cutomerIdentityNumber_0, 
        False, 
        new HashSet<string>(
            new string[]{ }, 
            StringComparer.Ordinal
        )
    )].GetRelationalCommandTemplate(parameters), 
    readerColumns: null, 
    shaper: (queryContext, dataReader, resultContext, resultCoordinator) => 
    {
        Customer entity;
        entity = 
        {
            MaterializationContext materializationContext1;
            IEntityType entityType1;
            Customer instance1;
            InternalEntityEntry entry1;
            bool hasNullKey1;
            materializationContext1 = new MaterializationContext(
                [LIFTABLE Constant: ValueBuffer | Resolver: _ => (object)ValueBuffer.Empty], 
                queryContext.Context
            );
            instance1 = default(Customer);
            entry1 = queryContext.TryGetEntry(
                key: [LIFTABLE Constant: Key: Customer.Id PK | Resolver: c => c.Dependencies.Model.FindEntityType("BillingSystem.Domain.Entities.Customer").FindPrimaryKey()], 
                keyValues: new object[]{ (object)dataReader.GetInt64(0) }, 
                throwOnNullKey: True, 
                hasNullKey: hasNullKey1);
            !(hasNullKey1) ? entry1 != default(InternalEntityEntry) ? 
            {
                entityType1 = entry1.EntityType;
                return instance1 = (Customer)entry1.Entity;
            } : 
            {
                ISnapshot shadowSnapshot1;
                shadowSnapshot1 = [LIFTABLE Constant: Snapshot | Resolver: _ => Snapshot.Empty];
                entityType1 = [LIFTABLE Constant: EntityType: Customer | Resolver: namelessParameter{0} => namelessParameter{0}.Dependencies.Model.FindEntityType("BillingSystem.Domain.Entities.Customer")];
                instance1 = switch (entityType1)
                {
                    case [LIFTABLE Constant: EntityType: Customer | Resolver: namelessParameter{1} => namelessParameter{1}.Dependencies.Model.FindEntityType("BillingSystem.Domain.Entities.Customer")]: 
                        {
                            return 
                            {
                                Customer instance;
                                instance = new Customer();
                                instance.<Id>k__BackingField = dataReader.GetInt64(0);
                                instance.<AddressBuildingNumber>k__BackingField = dataReader.IsDBNull(1) ? default(string) : dataReader.GetString(1);
                                instance.<AddressCity>k__BackingField = dataReader.GetString(2);
                                instance.<AddressCountry>k__BackingField = dataReader.GetString(3);
                                instance.<AddressDistrict>k__BackingField = dataReader.GetString(4);
                                instance.<AddressPostalCode>k__BackingField = dataReader.GetString(5);
                                instance.<AddressStreet>k__BackingField = dataReader.IsDBNull(6) ? default(string) : dataReader.GetString(6);
                                instance.<AddressSubNumber>k__BackingField = dataReader.IsDBNull(7) ? default(string) : dataReader.GetString(7);
                                instance.<CreatedBy>k__BackingField = dataReader.GetString(8);
                                instance.<CreatedDate>k__BackingField = dataReader.GetDateTime(9);
                                instance.<CustomerType>k__BackingField = dataReader.GetString(10);
                                instance.<EmailAddress>k__BackingField = dataReader.IsDBNull(11) ? default(string) : dataReader.GetString(11);
                                instance.<FullName>k__BackingField = dataReader.GetString(12);
                                instance.<IdentityNumber>k__BackingField = dataReader.GetString(13);
                                instance.<IdentityType>k__BackingField = dataReader.IsDBNull(14) ? default(int?) : (int?)dataReader.GetInt32(14);
                                instance.<IsDeleted>k__BackingField = dataReader.GetBoolean(15);
                                instance.<LastUpdatedDate>k__BackingField = dataReader.IsDBNull(16) ? default(DateTime?) : (DateTime?)dataReader.GetDateTime(16);
                                instance.<OverpaymentBalance>k__BackingField = dataReader.IsDBNull(17) ? default(decimal?) : (decimal?)dataReader.GetDecimal(17);
                                instance.<PhoneNumber>k__BackingField = dataReader.IsDBNull(18) ? default(string) : dataReader.GetString(18);
                                instance.<Vatnumber>k__BackingField = dataReader.IsDBNull(19) ? default(string) : dataReader.GetString(19);
                                (instance is IInjectableService) ? ((IInjectableService)instance).Injected(
                                    context: materializationContext1.Context, 
                                    entity: instance, 
                                    queryTrackingBehavior: TrackAll, 
                                    structuralType: [LIFTABLE Constant: EntityType: Customer | Resolver: namelessParameter{2} => namelessParameter{2}.Dependencies.Model.FindEntityType("BillingSystem.Domain.Entities.Customer")]) : default(void);
                                return instance;
                            }}
                    default: 
                        default(Customer)
                }
                ;
                entry1 = entityType1 == default(IEntityType) ? default(InternalEntityEntry) : queryContext.StartTracking(
                    entityType: entityType1, 
                    entity: instance1, 
                    snapshot: shadowSnapshot1);
                return instance1;
            } : default(void);
            return instance1;
        };
        return entity;
    }, 
    contextType: BillingSystem.Infrastructure.EF.BillingServiceDBContext, 
    standAloneStateManager: False, 
    detailedErrorsEnabled: False, 
    threadSafetyChecksEnabled: True)
    .SingleOrDefault()'
2025-11-18 16:44:21.170 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-11-18 16:44:21.172 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (2ms).
2025-11-18 16:44:21.178 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (8ms).
2025-11-18 16:44:21.183 +03:00 [DBG] Executing DbCommand [Parameters=[@__cutomerIdentityNumber_0='?' (Size = 100)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[Id], [c].[Address_BuildingNumber], [c].[Address_City], [c].[Address_Country], [c].[Address_District], [c].[Address_PostalCode], [c].[Address_Street], [c].[Address_SubNumber], [c].[CreatedBy], [c].[CreatedDate], [c].[CustomerType], [c].[EmailAddress], [c].[FullName], [c].[IdentityNumber], [c].[IdentityType], [c].[IsDeleted], [c].[LastUpdatedDate], [c].[OverpaymentBalance], [c].[PhoneNumber], [c].[VATNumber]
FROM [Customers] AS [c]
WHERE [c].[IdentityNumber] = @__cutomerIdentityNumber_0
2025-11-18 16:44:21.190 +03:00 [INF] Executed DbCommand (7ms) [Parameters=[@__cutomerIdentityNumber_0='?' (Size = 100)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[Id], [c].[Address_BuildingNumber], [c].[Address_City], [c].[Address_Country], [c].[Address_District], [c].[Address_PostalCode], [c].[Address_Street], [c].[Address_SubNumber], [c].[CreatedBy], [c].[CreatedDate], [c].[CustomerType], [c].[EmailAddress], [c].[FullName], [c].[IdentityNumber], [c].[IdentityType], [c].[IsDeleted], [c].[LastUpdatedDate], [c].[OverpaymentBalance], [c].[PhoneNumber], [c].[VATNumber]
FROM [Customers] AS [c]
WHERE [c].[IdentityNumber] = @__cutomerIdentityNumber_0
2025-11-18 16:44:21.252 +03:00 [DBG] Context 'BillingServiceDBContext' started tracking 'Customer' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-11-18 16:44:21.338 +03:00 [DBG] Closing data reader to 'GAC-BillingService' on server '.'.
2025-11-18 16:44:21.345 +03:00 [DBG] A data reader for 'GAC-BillingService' on server '.' is being disposed after spending 145ms reading results.
2025-11-18 16:44:21.390 +03:00 [DBG] 'BillingServiceDBContext' generated a temporary value for the property 'Invoice.Id'. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-11-18 16:44:21.508 +03:00 [DBG] Context 'BillingServiceDBContext' started tracking 'Invoice' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-11-18 16:44:21.524 +03:00 [DBG] 'BillingServiceDBContext' generated a temporary value for the property 'InvoicesAttachment.Id'. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-11-18 16:44:21.553 +03:00 [DBG] The navigation 'InvoicesAttachment.Invoice' was detected as changed. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-11-18 16:44:21.566 +03:00 [DBG] Context 'BillingServiceDBContext' started tracking 'InvoicesAttachment' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-11-18 16:44:21.578 +03:00 [DBG] 'BillingServiceDBContext' generated a temporary value for the property 'InvoicesItem.Id'. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-11-18 16:44:21.607 +03:00 [DBG] The navigation 'InvoicesItem.Invoice' was detected as changed. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-11-18 16:44:21.616 +03:00 [DBG] Context 'BillingServiceDBContext' started tracking 'InvoicesItem' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-11-18 16:44:21.627 +03:00 [DBG] SaveChanges starting for 'BillingServiceDBContext'.
2025-11-18 16:44:21.637 +03:00 [DBG] DetectChanges starting for 'BillingServiceDBContext'.
2025-11-18 16:44:21.738 +03:00 [DBG] DetectChanges completed for 'BillingServiceDBContext'.
2025-11-18 16:44:21.877 +03:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-11-18 16:44:21.885 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-11-18 16:44:21.887 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (2ms).
2025-11-18 16:44:21.892 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (6ms).
2025-11-18 16:44:21.900 +03:00 [DBG] Executing DbCommand [Parameters=[@p0='?' (Precision = 18) (DbType = Decimal), @p1='?' (Size = 3000), @p2='?' (Size = 100), @p3='?' (Size = 50), @p4='?' (DbType = DateTime), @p5='?' (Size = 50), @p6='?' (DbType = Int64), @p7='?' (DbType = Int64), @p8='?' (DbType = DateTime), @p9='?' (DbType = Guid), @p10='?' (Size = 50), @p11='?' (DbType = Int32), @p12='?' (DbType = Int32), @p13='?' (DbType = Boolean), @p14='?' (DbType = Boolean), @p15='?' (DbType = Boolean), @p16='?' (DbType = Boolean), @p17='?' (DbType = DateTime), @p18='?' (DbType = DateTime), @p19='?' (Size = 4000), @p20='?' (Size = 100), @p21='?' (Size = 100), @p22='?' (DbType = Int64), @p23='?' (Size = 4000), @p24='?' (DbType = Int64), @p25='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [Invoices] ([Amount], [CancelationReasons], [ClientReferenceNumber], [CreatedBy], [CreatedDate], [Currency], [CustomerID], [DiscountedPrimaryInvoiceID], [DueAt], [ExternalId], [InvoiceNumber], [InvoiceStatus], [InvoiceType], [IsDeleted], [IsDiscounted], [IsSubInvoice], [IsSubstitution], [IssuedAt], [LastUpdatedDate], [Metadata], [PaymentProvider], [PaymentReference], [PrimaryInvoiceID], [ProviderResponse], [SubstitutionPrimaryInvoiceID], [TenantId])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18, @p19, @p20, @p21, @p22, @p23, @p24, @p25);
2025-11-18 16:44:21.917 +03:00 [INF] Executed DbCommand (19ms) [Parameters=[@p0='?' (Precision = 18) (DbType = Decimal), @p1='?' (Size = 3000), @p2='?' (Size = 100), @p3='?' (Size = 50), @p4='?' (DbType = DateTime), @p5='?' (Size = 50), @p6='?' (DbType = Int64), @p7='?' (DbType = Int64), @p8='?' (DbType = DateTime), @p9='?' (DbType = Guid), @p10='?' (Size = 50), @p11='?' (DbType = Int32), @p12='?' (DbType = Int32), @p13='?' (DbType = Boolean), @p14='?' (DbType = Boolean), @p15='?' (DbType = Boolean), @p16='?' (DbType = Boolean), @p17='?' (DbType = DateTime), @p18='?' (DbType = DateTime), @p19='?' (Size = 4000), @p20='?' (Size = 100), @p21='?' (Size = 100), @p22='?' (DbType = Int64), @p23='?' (Size = 4000), @p24='?' (DbType = Int64), @p25='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [Invoices] ([Amount], [CancelationReasons], [ClientReferenceNumber], [CreatedBy], [CreatedDate], [Currency], [CustomerID], [DiscountedPrimaryInvoiceID], [DueAt], [ExternalId], [InvoiceNumber], [InvoiceStatus], [InvoiceType], [IsDeleted], [IsDiscounted], [IsSubInvoice], [IsSubstitution], [IssuedAt], [LastUpdatedDate], [Metadata], [PaymentProvider], [PaymentReference], [PrimaryInvoiceID], [ProviderResponse], [SubstitutionPrimaryInvoiceID], [TenantId])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18, @p19, @p20, @p21, @p22, @p23, @p24, @p25);
2025-11-18 16:44:21.966 +03:00 [DBG] The foreign key property 'Invoice.Id' was detected as changed. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see property values.
2025-11-18 16:44:21.983 +03:00 [DBG] The foreign key property 'InvoicesAttachment.InvoiceId' was detected as changed. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see property values.
2025-11-18 16:44:21.993 +03:00 [DBG] The foreign key property 'InvoicesItem.InvoiceId' was detected as changed. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see property values.
2025-11-18 16:44:22.000 +03:00 [DBG] Closing data reader to 'GAC-BillingService' on server '.'.
2025-11-18 16:44:22.004 +03:00 [DBG] A data reader for 'GAC-BillingService' on server '.' is being disposed after spending 78ms reading results.
2025-11-18 16:44:22.014 +03:00 [DBG] Executing 2 update commands as a batch.
2025-11-18 16:44:22.020 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-11-18 16:44:22.023 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (2ms).
2025-11-18 16:44:22.026 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (6ms).
2025-11-18 16:44:22.031 +03:00 [DBG] Executing DbCommand [Parameters=[@p26='?' (Size = 50), @p27='?' (DbType = DateTime), @p28='?' (Size = 200), @p29='?' (DbType = Int64), @p30='?' (DbType = Boolean), @p31='?' (Precision = 18) (DbType = Decimal), @p32='?' (Size = 50), @p33='?' (DbType = DateTime), @p34='?' (DbType = Int64), @p35='?' (DbType = Boolean), @p36='?' (Size = 500), @p37='?' (Size = 200), @p38='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SET NOCOUNT ON;
INSERT INTO [InvoicesAttachments] ([CreatedBy], [CreatedDate], [FileName], [InvoiceId], [IsDeleted])
OUTPUT INSERTED.[Id]
VALUES (@p26, @p27, @p28, @p29, @p30);
INSERT INTO [InvoicesItems] ([Amount], [CreatedBy], [CreatedDate], [InvoiceId], [IsDeleted], [ItemDesc], [ItemName], [Quantity])
OUTPUT INSERTED.[Id]
VALUES (@p31, @p32, @p33, @p34, @p35, @p36, @p37, @p38);
2025-11-18 16:44:22.042 +03:00 [INF] Executed DbCommand (12ms) [Parameters=[@p26='?' (Size = 50), @p27='?' (DbType = DateTime), @p28='?' (Size = 200), @p29='?' (DbType = Int64), @p30='?' (DbType = Boolean), @p31='?' (Precision = 18) (DbType = Decimal), @p32='?' (Size = 50), @p33='?' (DbType = DateTime), @p34='?' (DbType = Int64), @p35='?' (DbType = Boolean), @p36='?' (Size = 500), @p37='?' (Size = 200), @p38='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SET NOCOUNT ON;
INSERT INTO [InvoicesAttachments] ([CreatedBy], [CreatedDate], [FileName], [InvoiceId], [IsDeleted])
OUTPUT INSERTED.[Id]
VALUES (@p26, @p27, @p28, @p29, @p30);
INSERT INTO [InvoicesItems] ([Amount], [CreatedBy], [CreatedDate], [InvoiceId], [IsDeleted], [ItemDesc], [ItemName], [Quantity])
OUTPUT INSERTED.[Id]
VALUES (@p31, @p32, @p33, @p34, @p35, @p36, @p37, @p38);
2025-11-18 16:44:22.048 +03:00 [DBG] The foreign key property 'InvoicesAttachment.Id' was detected as changed. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see property values.
2025-11-18 16:44:22.052 +03:00 [DBG] The foreign key property 'InvoicesItem.Id' was detected as changed. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see property values.
2025-11-18 16:44:22.056 +03:00 [DBG] Closing data reader to 'GAC-BillingService' on server '.'.
2025-11-18 16:44:22.059 +03:00 [DBG] A data reader for 'GAC-BillingService' on server '.' is being disposed after spending 11ms reading results.
2025-11-18 16:44:22.076 +03:00 [DBG] An entity of type 'Invoice' tracked by 'BillingServiceDBContext' changed state from '"Added"' to '"Unchanged"'. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-11-18 16:44:22.085 +03:00 [DBG] An entity of type 'InvoicesAttachment' tracked by 'BillingServiceDBContext' changed state from '"Added"' to '"Unchanged"'. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-11-18 16:44:22.092 +03:00 [DBG] An entity of type 'InvoicesItem' tracked by 'BillingServiceDBContext' changed state from '"Added"' to '"Unchanged"'. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-11-18 16:44:22.101 +03:00 [DBG] SaveChanges completed for 'BillingServiceDBContext' with 3 entities written to the database.
2025-11-18 16:44:22.107 +03:00 [DBG] 'BillingServiceDBContext' generated a temporary value for the property 'OutboxEvent.Id'. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-11-18 16:44:22.134 +03:00 [DBG] Context 'BillingServiceDBContext' started tracking 'OutboxEvent' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-11-18 16:44:22.139 +03:00 [DBG] 'BillingServiceDBContext' generated a temporary value for the property 'AuditEvent.Id'. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-11-18 16:44:22.170 +03:00 [DBG] Context 'BillingServiceDBContext' started tracking 'AuditEvent' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-11-18 16:44:22.174 +03:00 [DBG] SaveChanges starting for 'BillingServiceDBContext'.
2025-11-18 16:44:22.179 +03:00 [DBG] DetectChanges starting for 'BillingServiceDBContext'.
2025-11-18 16:44:22.196 +03:00 [DBG] DetectChanges completed for 'BillingServiceDBContext'.
2025-11-18 16:44:22.203 +03:00 [DBG] Executing 2 update commands as a batch.
2025-11-18 16:44:22.210 +03:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-11-18 16:44:22.211 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-11-18 16:44:22.214 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (2ms).
2025-11-18 16:44:22.219 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (6ms).
2025-11-18 16:44:22.222 +03:00 [DBG] Executing DbCommand [Parameters=[@p0='?' (Size = 100), @p1='?' (Size = 4000), @p2='?' (Size = 50), @p3='?' (DbType = DateTime), @p4='?' (Size = 500), @p5='?' (Size = 20), @p6='?' (Size = 100), @p7='?' (Size = 100), @p8='?' (DbType = Int64), @p9='?' (DbType = DateTime), @p10='?' (Size = 4000), @p11='?' (Size = 300), @p12='?' (Size = 4000), @p13='?' (DbType = Boolean), @p14='?' (Size = 20) (DbType = AnsiString)], CommandType='"Text"', CommandTimeout='30']
SET NOCOUNT ON;
INSERT INTO [audit].[AuditEvents] ([Action], [Changes], [CreatedBy], [CreatedDate], [Description], [EntityId], [EntityType], [UserId])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
INSERT INTO [Outbox_events] ([Aggregate_id], [CreatedDate], [ErrorMsg], [Event_type], [Payload], [Processed], [ProcessingStatus])
OUTPUT INSERTED.[Id]
VALUES (@p8, @p9, @p10, @p11, @p12, @p13, @p14);
2025-11-18 16:44:22.231 +03:00 [INF] Executed DbCommand (9ms) [Parameters=[@p0='?' (Size = 100), @p1='?' (Size = 4000), @p2='?' (Size = 50), @p3='?' (DbType = DateTime), @p4='?' (Size = 500), @p5='?' (Size = 20), @p6='?' (Size = 100), @p7='?' (Size = 100), @p8='?' (DbType = Int64), @p9='?' (DbType = DateTime), @p10='?' (Size = 4000), @p11='?' (Size = 300), @p12='?' (Size = 4000), @p13='?' (DbType = Boolean), @p14='?' (Size = 20) (DbType = AnsiString)], CommandType='"Text"', CommandTimeout='30']
SET NOCOUNT ON;
INSERT INTO [audit].[AuditEvents] ([Action], [Changes], [CreatedBy], [CreatedDate], [Description], [EntityId], [EntityType], [UserId])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
INSERT INTO [Outbox_events] ([Aggregate_id], [CreatedDate], [ErrorMsg], [Event_type], [Payload], [Processed], [ProcessingStatus])
OUTPUT INSERTED.[Id]
VALUES (@p8, @p9, @p10, @p11, @p12, @p13, @p14);
2025-11-18 16:44:22.238 +03:00 [DBG] The foreign key property 'AuditEvent.Id' was detected as changed. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see property values.
2025-11-18 16:44:22.242 +03:00 [DBG] The foreign key property 'OutboxEvent.Id' was detected as changed. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see property values.
2025-11-18 16:44:22.246 +03:00 [DBG] Closing data reader to 'GAC-BillingService' on server '.'.
2025-11-18 16:44:22.251 +03:00 [DBG] A data reader for 'GAC-BillingService' on server '.' is being disposed after spending 13ms reading results.
2025-11-18 16:44:22.257 +03:00 [DBG] An entity of type 'AuditEvent' tracked by 'BillingServiceDBContext' changed state from '"Added"' to '"Unchanged"'. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-11-18 16:44:22.263 +03:00 [DBG] An entity of type 'OutboxEvent' tracked by 'BillingServiceDBContext' changed state from '"Added"' to '"Unchanged"'. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-11-18 16:44:22.270 +03:00 [DBG] SaveChanges completed for 'BillingServiceDBContext' with 2 entities written to the database.
2025-11-18 16:44:22.277 +03:00 [DBG] Committing transaction.
2025-11-18 16:44:22.301 +03:00 [DBG] Committed transaction.
2025-11-18 16:44:22.310 +03:00 [DBG] Closing connection to database 'GAC-BillingService' on server '.'.
2025-11-18 16:44:22.317 +03:00 [DBG] Closed connection to database 'GAC-BillingService' on server '.' (7ms).
2025-11-18 16:44:22.324 +03:00 [DBG] Disposing transaction.
2025-11-18 16:44:26.136 +03:00 [DBG] List of registered output formatters, in the following order: ["Microsoft.AspNetCore.Mvc.Formatters.HttpNoContentOutputFormatter","Microsoft.AspNetCore.Mvc.Formatters.StringOutputFormatter","Microsoft.AspNetCore.Mvc.Formatters.StreamOutputFormatter","Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonOutputFormatter"]
2025-11-18 16:44:26.145 +03:00 [DBG] No information found on request to perform content negotiation.
2025-11-18 16:44:26.149 +03:00 [DBG] Attempting to select the first output formatter in the output formatters list which supports a content type from the explicitly specified content types '["application/json"]'.
2025-11-18 16:44:26.157 +03:00 [DBG] Selected output formatter 'Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonOutputFormatter' and content type 'application/json' to write the response.
2025-11-18 16:44:26.161 +03:00 [INF] Executing OkObjectResult, writing value of type 'BillingSystem.SharedKernel.ApiResponse`1[[System.Int64, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-11-18 16:44:26.181 +03:00 [INF] Executed action BillingSystem.API.Controllers.InvoicesController.Post (BillingSystem.API) in 60059.5867ms
2025-11-18 16:44:26.188 +03:00 [INF] Executed endpoint 'BillingSystem.API.Controllers.InvoicesController.Post (BillingSystem.API)'
2025-11-18 16:44:26.192 +03:00 [INF] HTTP POST /api/Invoices responded 200 in 65966.2436 ms
2025-11-18 16:44:26.199 +03:00 [DBG] Connection id "0HNH6L19L4B3G" completed keep alive response.
2025-11-18 16:44:26.205 +03:00 [DBG] 'BillingServiceDBContext' disposed.
2025-11-18 16:44:26.212 +03:00 [DBG] Disposing connection to database 'GAC-BillingService' on server '.'.
2025-11-18 16:44:26.217 +03:00 [DBG] Disposed connection to database '' on server '' (4ms).
2025-11-18 16:44:26.221 +03:00 [INF] Request finished HTTP/1.1 POST https://localhost:7257/api/Invoices - 200 null application/json; charset=utf-8 66031.5587ms
