2025-11-19 10:06:25.499 +03:00 [DBG] Registered model binder providers, in the following order: ["Microsoft.AspNetCore.Mvc.ModelBinding.Binders.BinderTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ServicesModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.BodyModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.HeaderModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FloatingPointTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.EnumTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.DateTimeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.SimpleTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.TryParseModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.CancellationTokenModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ByteArrayModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FormFileModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FormCollectionModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.KeyValuePairModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.DictionaryModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ArrayModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.CollectionModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ComplexObjectModelBinderProvider"]
2025-11-19 10:06:25.653 +03:00 [DBG] Hosting starting
2025-11-19 10:06:26.064 +03:00 [DBG] Starting bus instances: IBus
2025-11-19 10:06:26.076 +03:00 [DBG] Starting bus: "rabbitmq://localhost/"
2025-11-19 10:06:26.111 +03:00 [DBG] Middleware loaded
2025-11-19 10:06:26.116 +03:00 [DBG] Middleware loaded. Script /_framework/aspnetcore-browser-refresh.js (16519 B).
2025-11-19 10:06:26.121 +03:00 [DBG] Middleware loaded. Script /_framework/blazor-hotreload.js (799 B).
2025-11-19 10:06:26.141 +03:00 [DBG] Connect: guest@localhost:5672/
2025-11-19 10:06:26.321 +03:00 [DBG] Middleware loaded: DOTNET_MODIFIABLE_ASSEMBLIES=debug, __ASPNETCORE_BROWSER_TOOLS=true
2025-11-19 10:06:26.347 +03:00 [DBG] Connected: guest@localhost:5672/ (address: amqp://localhost:5672, local: 56969)
2025-11-19 10:06:26.412 +03:00 [DBG] Endpoint Ready: "rabbitmq://localhost/ECHGHANNAMLP1_BillingSystemAPI_bus_bunoyyyh3bcsbt6wbdxnqqt8r5?temporary=true"
2025-11-19 10:06:26.417 +03:00 [INF] Bus started: "rabbitmq://localhost/"
2025-11-19 10:06:26.632 +03:00 [INF] Now listening on: https://localhost:7257
2025-11-19 10:06:26.637 +03:00 [INF] Now listening on: http://localhost:5009
2025-11-19 10:06:26.640 +03:00 [DBG] Loaded hosting startup assembly BillingSystem.API
2025-11-19 10:06:26.646 +03:00 [DBG] Loaded hosting startup assembly Microsoft.WebTools.ApiEndpointDiscovery
2025-11-19 10:06:26.649 +03:00 [DBG] Loaded hosting startup assembly Microsoft.AspNetCore.Watch.BrowserRefresh
2025-11-19 10:06:26.652 +03:00 [DBG] Loaded hosting startup assembly Microsoft.WebTools.BrowserLink.Net
2025-11-19 10:06:26.792 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-11-19 10:06:26.796 +03:00 [INF] Hosting environment: Development
2025-11-19 10:06:26.799 +03:00 [INF] Content root path: C:\Repositories\Gac-BillingSystem\src\BillingSystem.API
2025-11-19 10:06:26.804 +03:00 [DBG] Hosting started
2025-11-19 10:06:27.102 +03:00 [DBG] Connection id "0HNH778K4T0FF" accepted.
2025-11-19 10:06:27.103 +03:00 [DBG] Connection id "0HNH778K4T0FG" accepted.
2025-11-19 10:06:27.109 +03:00 [DBG] Connection id "0HNH778K4T0FF" started.
2025-11-19 10:06:27.112 +03:00 [DBG] Connection id "0HNH778K4T0FG" started.
2025-11-19 10:06:27.148 +03:00 [DBG] Connection id "0HNH778K4T0FF" received FIN.
2025-11-19 10:06:27.148 +03:00 [DBG] Connection id "0HNH778K4T0FG" received FIN.
2025-11-19 10:06:27.170 +03:00 [DBG] Failed to authenticate HTTPS connection.
System.IO.IOException: Received an unexpected EOF or 0 bytes from the transport stream.
   at System.Net.Security.SslStream.ReceiveHandshakeFrameAsync[TIOAdapter](CancellationToken cancellationToken)
   at System.Net.Security.SslStream.ForceAuthenticationAsync[TIOAdapter](Boolean receiveFirst, Byte[] reAuthenticationData, CancellationToken cancellationToken)
   at System.Net.Security.SslStream.ProcessAuthenticationWithTelemetryAsync(Boolean isAsync, CancellationToken cancellationToken)
   at Microsoft.AspNetCore.Server.Kestrel.Https.Internal.HttpsConnectionMiddleware.OnConnectionAsync(ConnectionContext context)
2025-11-19 10:06:27.170 +03:00 [DBG] Failed to authenticate HTTPS connection.
System.IO.IOException: Received an unexpected EOF or 0 bytes from the transport stream.
   at System.Net.Security.SslStream.ReceiveHandshakeFrameAsync[TIOAdapter](CancellationToken cancellationToken)
   at System.Net.Security.SslStream.ForceAuthenticationAsync[TIOAdapter](Boolean receiveFirst, Byte[] reAuthenticationData, CancellationToken cancellationToken)
   at System.Net.Security.SslStream.ProcessAuthenticationWithTelemetryAsync(Boolean isAsync, CancellationToken cancellationToken)
   at Microsoft.AspNetCore.Server.Kestrel.Https.Internal.HttpsConnectionMiddleware.OnConnectionAsync(ConnectionContext context)
2025-11-19 10:06:27.211 +03:00 [DBG] Connection id "0HNH778K4T0FF" stopped.
2025-11-19 10:06:27.211 +03:00 [DBG] Connection id "0HNH778K4T0FG" stopped.
2025-11-19 10:06:27.223 +03:00 [DBG] Connection id "0HNH778K4T0FF" sending FIN because: "The Socket transport's send loop completed gracefully."
2025-11-19 10:06:27.223 +03:00 [DBG] Connection id "0HNH778K4T0FG" sending FIN because: "The Socket transport's send loop completed gracefully."
2025-11-19 10:06:28.064 +03:00 [DBG] Connection id "0HNH778K4T0FH" accepted.
2025-11-19 10:06:28.069 +03:00 [DBG] Connection id "0HNH778K4T0FH" started.
2025-11-19 10:06:28.134 +03:00 [DBG] Connection 0HNH778K4T0FH established using the following protocol: "Tls13"
2025-11-19 10:06:28.225 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7257/swagger/index.html - null null
2025-11-19 10:06:28.313 +03:00 [DBG] Wildcard detected, all requests with hosts will be allowed.
2025-11-19 10:06:28.342 +03:00 [DBG] No candidates found for the request path '/swagger/index.html'
2025-11-19 10:06:28.348 +03:00 [DBG] Request did not match any endpoints
2025-11-19 10:06:28.439 +03:00 [DBG] Response markup is scheduled to include Browser Link script injection.
2025-11-19 10:06:28.445 +03:00 [DBG] Response markup is scheduled to include browser refresh script injection.
2025-11-19 10:06:28.478 +03:00 [INF] HTTP GET /swagger/index.html responded 200 in 117.3835 ms
2025-11-19 10:06:28.487 +03:00 [DBG] Response markup was updated to include Browser Link script injection.
2025-11-19 10:06:28.491 +03:00 [DBG] Response markup was updated to include browser refresh script injection.
2025-11-19 10:06:28.497 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7257/swagger/index.html - 200 null text/html;charset=utf-8 284.7456ms
2025-11-19 10:06:28.528 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7257/_vs/browserLink - null null
2025-11-19 10:06:28.557 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7257/_framework/aspnetcore-browser-refresh.js - null null
2025-11-19 10:06:28.579 +03:00 [DBG] Script injected: /_framework/aspnetcore-browser-refresh.js
2025-11-19 10:06:28.586 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7257/_framework/aspnetcore-browser-refresh.js - 200 16519 application/javascript; charset=utf-8 28.759ms
2025-11-19 10:06:28.623 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7257/_vs/browserLink - 200 null text/javascript; charset=UTF-8 95.7244ms
2025-11-19 10:06:28.750 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7257/swagger/v1/swagger.json - null null
2025-11-19 10:06:28.759 +03:00 [DBG] No candidates found for the request path '/swagger/v1/swagger.json'
2025-11-19 10:06:28.761 +03:00 [DBG] Request did not match any endpoints
2025-11-19 10:06:28.783 +03:00 [INF] HTTP GET /swagger/v1/swagger.json responded 200 in 19.1762 ms
2025-11-19 10:06:28.790 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7257/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 40.3965ms
2025-11-19 10:06:37.327 +03:00 [DBG] Connection id "0HNH778K4T0FI" accepted.
2025-11-19 10:06:37.327 +03:00 [DBG] Connection id "0HNH778K4T0FI" received FIN.
2025-11-19 10:06:37.335 +03:00 [DBG] Connection id "0HNH778K4T0FI" started.
2025-11-19 10:06:37.337 +03:00 [DBG] Connection id "0HNH778K4T0FJ" accepted.
2025-11-19 10:06:37.348 +03:00 [DBG] Failed to authenticate HTTPS connection.
System.IO.IOException: Received an unexpected EOF or 0 bytes from the transport stream.
   at System.Net.Security.SslStream.ReceiveHandshakeFrameAsync[TIOAdapter](CancellationToken cancellationToken)
   at System.Net.Security.SslStream.ForceAuthenticationAsync[TIOAdapter](Boolean receiveFirst, Byte[] reAuthenticationData, CancellationToken cancellationToken)
   at System.Net.Security.SslStream.ProcessAuthenticationWithTelemetryAsync(Boolean isAsync, CancellationToken cancellationToken)
   at Microsoft.AspNetCore.Server.Kestrel.Https.Internal.HttpsConnectionMiddleware.OnConnectionAsync(ConnectionContext context)
2025-11-19 10:06:37.350 +03:00 [DBG] Connection id "0HNH778K4T0FJ" started.
2025-11-19 10:06:37.357 +03:00 [DBG] Connection id "0HNH778K4T0FI" stopped.
2025-11-19 10:06:37.364 +03:00 [DBG] Connection id "0HNH778K4T0FI" sending FIN because: "The Socket transport's send loop completed gracefully."
2025-11-19 10:06:37.368 +03:00 [DBG] Connection 0HNH778K4T0FJ established using the following protocol: "Tls13"
2025-11-19 10:06:37.380 +03:00 [INF] Request starting HTTP/1.1 POST https://localhost:7257/api/Invoices - application/json 1394
2025-11-19 10:06:37.394 +03:00 [DBG] 1 candidate(s) found for the request path '/api/Invoices'
2025-11-19 10:06:37.406 +03:00 [DBG] Endpoint 'BillingSystem.API.Controllers.InvoicesController.Post (BillingSystem.API)' with route pattern 'api/Invoices' is valid for the request path '/api/Invoices'
2025-11-19 10:06:37.412 +03:00 [DBG] Request matched endpoint 'BillingSystem.API.Controllers.InvoicesController.Post (BillingSystem.API)'
2025-11-19 10:06:37.421 +03:00 [DBG] Static files was skipped as the request already matched an endpoint.
2025-11-19 10:06:37.748 +03:00 [DBG] An 'IServiceProvider' was created for internal use by Entity Framework.
2025-11-19 10:06:43.288 +03:00 [INF] Executing endpoint 'BillingSystem.API.Controllers.InvoicesController.Post (BillingSystem.API)'
2025-11-19 10:06:43.342 +03:00 [INF] Route matched with {action = "Post", controller = "Invoices"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Post(BillingSystem.Application.Requests.CreateInvoiceRequest) on controller BillingSystem.API.Controllers.InvoicesController (BillingSystem.API).
2025-11-19 10:06:43.348 +03:00 [DBG] Execution plan of authorization filters (in the following order): ["None"]
2025-11-19 10:06:43.351 +03:00 [DBG] Execution plan of resource filters (in the following order): ["None"]
2025-11-19 10:06:43.354 +03:00 [DBG] Execution plan of action filters (in the following order): ["Microsoft.AspNetCore.Mvc.ModelBinding.UnsupportedContentTypeFilter (Order: -3000)","Microsoft.AspNetCore.Mvc.Infrastructure.ModelStateInvalidFilter (Order: -2000)","BillingSystem.API.ActionFilters.AuditBillingRequestsFilter","BillingSystem.API.ActionFilters.IdempotencyFilter (Order: 0)"]
2025-11-19 10:06:43.357 +03:00 [DBG] Execution plan of exception filters (in the following order): ["None"]
2025-11-19 10:06:43.360 +03:00 [DBG] Execution plan of result filters (in the following order): ["Microsoft.AspNetCore.Mvc.Infrastructure.ClientErrorResultFilter (Order: -2000)","Microsoft.AspNetCore.Mvc.ProducesAttribute (Order: 0)","BillingSystem.API.ActionFilters.IdempotencyFilter (Order: 0)"]
2025-11-19 10:06:43.367 +03:00 [DBG] Executing controller factory for controller BillingSystem.API.Controllers.InvoicesController (BillingSystem.API)
2025-11-19 10:06:43.373 +03:00 [WRN] You do not have a valid license key for the Lucky Penny software MediatR. This is allowed for development and testing scenarios. If you are running in production you are required to have a licensed version. Please visit https://luckypennysoftware.com to obtain a valid license.
2025-11-19 10:06:43.419 +03:00 [DBG] Executed controller factory for controller BillingSystem.API.Controllers.InvoicesController (BillingSystem.API)
2025-11-19 10:06:43.446 +03:00 [DBG] Attempting to bind parameter 'invoiceRequest' of type 'BillingSystem.Application.Requests.CreateInvoiceRequest' ...
2025-11-19 10:06:43.452 +03:00 [DBG] Attempting to bind parameter 'invoiceRequest' of type 'BillingSystem.Application.Requests.CreateInvoiceRequest' using the name '' in request data ...
2025-11-19 10:06:43.457 +03:00 [DBG] Selected input formatter 'Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonInputFormatter' for content type 'application/json'.
2025-11-19 10:06:43.500 +03:00 [DBG] Connection id "0HNH778K4T0FJ", Request id "0HNH778K4T0FJ:00000001": started reading request body.
2025-11-19 10:06:43.504 +03:00 [DBG] Connection id "0HNH778K4T0FJ", Request id "0HNH778K4T0FJ:00000001": done reading request body.
2025-11-19 10:06:43.537 +03:00 [DBG] JSON input formatter succeeded, deserializing to type 'BillingSystem.Application.Requests.CreateInvoiceRequest'
2025-11-19 10:06:43.543 +03:00 [DBG] Done attempting to bind parameter 'invoiceRequest' of type 'BillingSystem.Application.Requests.CreateInvoiceRequest'.
2025-11-19 10:06:43.546 +03:00 [DBG] Done attempting to bind parameter 'invoiceRequest' of type 'BillingSystem.Application.Requests.CreateInvoiceRequest'.
2025-11-19 10:06:43.549 +03:00 [DBG] Attempting to validate the bound parameter 'invoiceRequest' of type 'BillingSystem.Application.Requests.CreateInvoiceRequest' ...
2025-11-19 10:06:43.583 +03:00 [DBG] Done attempting to validate the bound parameter 'invoiceRequest' of type 'BillingSystem.Application.Requests.CreateInvoiceRequest'.
2025-11-19 10:06:43.976 +03:00 [DBG] No relationship from 'Invoice' to 'Invoice' has been configured by convention because there are multiple properties on one entity type - {'DiscountedPrimaryInvoice'} that could be matched with the properties on the other entity type - {'InverseDiscountedPrimaryInvoice', 'InversePrimaryInvoice', 'InverseSubstitutionPrimaryInvoice', 'PrimaryInvoice', 'SubstitutionPrimaryInvoice'}. This message can be disregarded if explicit configuration has been specified in 'OnModelCreating'.
2025-11-19 10:06:44.223 +03:00 [DBG] No relationship from 'Invoice' to 'Invoice' has been configured by convention because there are multiple properties on one entity type - {'DiscountedPrimaryInvoice'} that could be matched with the properties on the other entity type - {'InverseDiscountedPrimaryInvoice', 'InversePrimaryInvoice', 'InverseSubstitutionPrimaryInvoice', 'PrimaryInvoice', 'SubstitutionPrimaryInvoice'}. This message can be disregarded if explicit configuration has been specified in 'OnModelCreating'.
2025-11-19 10:06:44.237 +03:00 [DBG] No relationship from 'Invoice' to 'Invoice' has been configured by convention because there are multiple properties on one entity type - {'InversePrimaryInvoice'} that could be matched with the properties on the other entity type - {'InverseSubstitutionPrimaryInvoice', 'PrimaryInvoice', 'SubstitutionPrimaryInvoice'}. This message can be disregarded if explicit configuration has been specified in 'OnModelCreating'.
2025-11-19 10:06:44.246 +03:00 [DBG] No relationship from 'Invoice' to 'Invoice' has been configured by convention because there are multiple properties on one entity type - {'InversePrimaryInvoice'} that could be matched with the properties on the other entity type - {'InverseSubstitutionPrimaryInvoice', 'PrimaryInvoice', 'SubstitutionPrimaryInvoice'}. This message can be disregarded if explicit configuration has been specified in 'OnModelCreating'.
2025-11-19 10:06:44.610 +03:00 [DBG] Entity Framework Core 9.0.9 initialized 'BillingServiceDBContext' using provider 'Microsoft.EntityFrameworkCore.SqlServer:9.0.9' with options: EngineType=SqlServer 
2025-11-19 10:06:44.785 +03:00 [DBG] Compiling query expression: 
'DbSet<Invoice>()
    .AsNoTracking()
    .Any(inv => inv.ExternalId.ToString() == __idempotentKey_0)'
2025-11-19 10:06:45.120 +03:00 [DBG] Generated query execution expression: 
'queryContext => ShapedQueryCompilingExpressionVisitor.SingleAsync<bool>(
    asyncEnumerable: SingleQueryingEnumerable.Create<bool>(
        relationalQueryContext: (RelationalQueryContext)queryContext, 
        relationalCommandResolver: parameters => [LIFTABLE Constant: RelationalCommandCache.QueryExpression(
            Projection Mapping:
                EmptyProjectionMember -> 0
            SELECT EXISTS (
                SELECT 1
                FROM Invoices AS i
                WHERE COALESCE(CONVERT(varchar(36), i.ExternalId), '') == @__idempotentKey_0)) | Resolver: c => new RelationalCommandCache(
            c.Dependencies.MemoryCache, 
            c.RelationalDependencies.QuerySqlGeneratorFactory, 
            c.RelationalDependencies.RelationalParameterBasedSqlProcessorFactory, 
            Projection Mapping:
                EmptyProjectionMember -> 0
            SELECT EXISTS (
                SELECT 1
                FROM Invoices AS i
                WHERE COALESCE(CONVERT(varchar(36), i.ExternalId), '') == @__idempotentKey_0), 
            False, 
            new HashSet<string>(
                new string[]{ }, 
                StringComparer.Ordinal
            )
        )].GetRelationalCommandTemplate(parameters), 
        readerColumns: null, 
        shaper: (queryContext, dataReader, resultContext, resultCoordinator) => 
        {
            bool? value1;
            value1 = dataReader.IsDBNull(0) ? default(bool?) : (bool?)dataReader.GetBoolean(0);
            return (bool)value1;
        }, 
        contextType: BillingSystem.Infrastructure.EF.BillingServiceDBContext, 
        standAloneStateManager: False, 
        detailedErrorsEnabled: False, 
        threadSafetyChecksEnabled: True), 
    cancellationToken: queryContext.CancellationToken)'
2025-11-19 10:06:45.188 +03:00 [DBG] Creating DbConnection.
2025-11-19 10:06:45.226 +03:00 [DBG] Created DbConnection. (39ms).
2025-11-19 10:06:45.234 +03:00 [DBG] Opening connection to database 'GAC-BillingService' on server '.'.
2025-11-19 10:06:45.593 +03:00 [DBG] Opened connection to database 'GAC-BillingService' on server '.'.
2025-11-19 10:06:45.601 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-11-19 10:06:45.612 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (8ms).
2025-11-19 10:06:45.626 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (26ms).
2025-11-19 10:06:45.639 +03:00 [DBG] Executing DbCommand [Parameters=[@__idempotentKey_0='?' (Size = 36) (DbType = AnsiString)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [Invoices] AS [i]
        WHERE CONVERT(varchar(36), [i].[ExternalId]) = @__idempotentKey_0) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2025-11-19 10:06:45.727 +03:00 [INF] Executed DbCommand (89ms) [Parameters=[@__idempotentKey_0='?' (Size = 36) (DbType = AnsiString)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [Invoices] AS [i]
        WHERE CONVERT(varchar(36), [i].[ExternalId]) = @__idempotentKey_0) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2025-11-19 10:06:45.754 +03:00 [DBG] Closing data reader to 'GAC-BillingService' on server '.'.
2025-11-19 10:06:45.769 +03:00 [DBG] A data reader for 'GAC-BillingService' on server '.' is being disposed after spending 29ms reading results.
2025-11-19 10:06:45.780 +03:00 [DBG] Closing connection to database 'GAC-BillingService' on server '.'.
2025-11-19 10:06:45.791 +03:00 [DBG] Closed connection to database 'GAC-BillingService' on server '.' (12ms).
2025-11-19 10:06:46.009 +03:00 [WRN] You do not have a valid license key for the Lucky Penny software AutoMapper. This is allowed for development and testing scenarios. If you are running in production you are required to have a licensed version. Please visit https://luckypennysoftware.com to obtain a valid license.
2025-11-19 10:06:46.105 +03:00 [DBG] Opening connection to database 'GAC-BillingService' on server '.'.
2025-11-19 10:06:46.112 +03:00 [DBG] Opened connection to database 'GAC-BillingService' on server '.'.
2025-11-19 10:06:46.119 +03:00 [DBG] Beginning transaction with isolation level 'Unspecified'.
2025-11-19 10:06:46.132 +03:00 [DBG] Began transaction with isolation level 'ReadCommitted'.
2025-11-19 10:06:46.142 +03:00 [DBG] Compiling query expression: 
'DbSet<InvoiceSequenceValue>().FromSql(EXECUTE dbo.GetNextInvoiceNumber, __p_0)
'
2025-11-19 10:06:46.203 +03:00 [DBG] Generated query execution expression: 
'queryContext => FromSqlQueryingEnumerable.Create<InvoiceSequenceValue>(
    relationalQueryContext: (RelationalQueryContext)queryContext, 
    relationalCommandResolver: parameters => [LIFTABLE Constant: RelationalCommandCache.QueryExpression(
        Projection Mapping:
            EmptyProjectionMember -> Dictionary<IProperty, int> { [Property: InvoiceSequenceValue.Value (long) Required, 0] }
        SELECT b.Value
        FROM EXECUTE dbo.GetNextInvoiceNumber) | Resolver: c => new RelationalCommandCache(
        c.Dependencies.MemoryCache, 
        c.RelationalDependencies.QuerySqlGeneratorFactory, 
        c.RelationalDependencies.RelationalParameterBasedSqlProcessorFactory, 
        Projection Mapping:
            EmptyProjectionMember -> Dictionary<IProperty, int> { [Property: InvoiceSequenceValue.Value (long) Required, 0] }
        SELECT b.Value
        FROM EXECUTE dbo.GetNextInvoiceNumber, 
        False, 
        new HashSet<string>(
            new string[]{ }, 
            StringComparer.Ordinal
        )
    )].GetRelationalCommandTemplate(parameters), 
    readerColumns: null, 
    columnNames: [LIFTABLE Constant: string[] { "Value" } | Resolver: _ => new string[]{ "Value" }], 
    shaper: (queryContext, dataReader, indexMap) => 
    {
        InvoiceSequenceValue entity;
        entity = 
        {
            MaterializationContext materializationContext1;
            IEntityType entityType1;
            InvoiceSequenceValue instance1;
            materializationContext1 = new MaterializationContext(
                [LIFTABLE Constant: ValueBuffer | Resolver: _ => (object)ValueBuffer.Empty], 
                queryContext.Context
            );
            instance1 = default(InvoiceSequenceValue);
            {
                ISnapshot shadowSnapshot1;
                shadowSnapshot1 = [LIFTABLE Constant: Snapshot | Resolver: _ => Snapshot.Empty];
                entityType1 = [LIFTABLE Constant: EntityType: InvoiceSequenceValue Keyless | Resolver: namelessParameter{0} => namelessParameter{0}.Dependencies.Model.FindEntityType("BillingSystem.Domain.Entities.InvoiceSequenceValue")];
                instance1 = switch (entityType1)
                {
                    case [LIFTABLE Constant: EntityType: InvoiceSequenceValue Keyless | Resolver: namelessParameter{1} => namelessParameter{1}.Dependencies.Model.FindEntityType("BillingSystem.Domain.Entities.InvoiceSequenceValue")]: 
                        {
                            return 
                            {
                                InvoiceSequenceValue instance;
                                instance = new InvoiceSequenceValue();
                                instance.<Value>k__BackingField = dataReader.GetInt64(indexMap[0]);
                                (instance is IInjectableService) ? ((IInjectableService)instance).Injected(
                                    context: materializationContext1.Context, 
                                    entity: instance, 
                                    queryTrackingBehavior: TrackAll, 
                                    structuralType: [LIFTABLE Constant: EntityType: InvoiceSequenceValue Keyless | Resolver: namelessParameter{2} => namelessParameter{2}.Dependencies.Model.FindEntityType("BillingSystem.Domain.Entities.InvoiceSequenceValue")]) : default(void);
                                return instance;
                            }}
                    default: 
                        default(InvoiceSequenceValue)
                }
                ;
                return instance1;
            }return instance1;
        };
        return entity;
    }, 
    contextType: BillingSystem.Infrastructure.EF.BillingServiceDBContext, 
    standAloneStateManager: False, 
    detailedErrorsEnabled: False, 
    threadSafetyChecksEnabled: True)'
2025-11-19 10:06:46.220 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-11-19 10:06:46.227 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (6ms).
2025-11-19 10:06:46.235 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (14ms).
2025-11-19 10:06:46.239 +03:00 [DBG] Executing DbCommand [Parameters=[], CommandType='"Text"', CommandTimeout='30']
EXECUTE dbo.GetNextInvoiceNumber
2025-11-19 10:06:46.252 +03:00 [INF] Executed DbCommand (13ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
EXECUTE dbo.GetNextInvoiceNumber
2025-11-19 10:06:46.262 +03:00 [DBG] Closing data reader to 'GAC-BillingService' on server '.'.
2025-11-19 10:06:46.266 +03:00 [DBG] A data reader for 'GAC-BillingService' on server '.' is being disposed after spending 8ms reading results.
2025-11-19 10:06:46.273 +03:00 [DBG] Compiling query expression: 
'DbSet<Customer>()
    .FirstOrDefault(c => c.IdentityNumber == __cutomerIdentityNumber_0)'
2025-11-19 10:06:46.292 +03:00 [DBG] Generated query execution expression: 
'queryContext => SingleQueryingEnumerable.Create<Customer>(
    relationalQueryContext: (RelationalQueryContext)queryContext, 
    relationalCommandResolver: parameters => [LIFTABLE Constant: RelationalCommandCache.QueryExpression(
        Projection Mapping:
            EmptyProjectionMember -> Dictionary<IProperty, int> { [Property: Customer.Id (long) Required PK AfterSave:Throw ValueGenerated.OnAdd, 0], [Property: Customer.AddressBuildingNumber (string) MaxLength(200), 1], [Property: Customer.AddressCity (string) Required MaxLength(200), 2], [Property: Customer.AddressCountry (string) Required MaxLength(200), 3], [Property: Customer.AddressDistrict (string) Required MaxLength(200), 4], [Property: Customer.AddressPostalCode (string) Required MaxLength(50), 5], [Property: Customer.AddressStreet (string) MaxLength(200), 6], [Property: Customer.AddressSubNumber (string) MaxLength(200), 7], [Property: Customer.CreatedBy (string) Required MaxLength(50), 8], [Property: Customer.CreatedDate (DateTime) Required, 9], [Property: Customer.CustomerType (string) Required MaxLength(100), 10], [Property: Customer.EmailAddress (string) MaxLength(80), 11], [Property: Customer.FullName (string) Required MaxLength(500), 12], [Property: Customer.IdentityNumber (string) Required MaxLength(100), 13], [Property: Customer.IdentityType (int?), 14], [Property: Customer.IsDeleted (bool) Required, 15], [Property: Customer.LastUpdatedDate (DateTime?), 16], [Property: Customer.OverpaymentBalance (decimal?), 17], [Property: Customer.PhoneNumber (string) MaxLength(50), 18], [Property: Customer.Vatnumber (string) MaxLength(100), 19] }
        SELECT TOP(1) c.Id, c.Address_BuildingNumber, c.Address_City, c.Address_Country, c.Address_District, c.Address_PostalCode, c.Address_Street, c.Address_SubNumber, c.CreatedBy, c.CreatedDate, c.CustomerType, c.EmailAddress, c.FullName, c.IdentityNumber, c.IdentityType, c.IsDeleted, c.LastUpdatedDate, c.OverpaymentBalance, c.PhoneNumber, c.VATNumber
        FROM Customers AS c
        WHERE c.IdentityNumber == @__cutomerIdentityNumber_0) | Resolver: c => new RelationalCommandCache(
        c.Dependencies.MemoryCache, 
        c.RelationalDependencies.QuerySqlGeneratorFactory, 
        c.RelationalDependencies.RelationalParameterBasedSqlProcessorFactory, 
        Projection Mapping:
            EmptyProjectionMember -> Dictionary<IProperty, int> { [Property: Customer.Id (long) Required PK AfterSave:Throw ValueGenerated.OnAdd, 0], [Property: Customer.AddressBuildingNumber (string) MaxLength(200), 1], [Property: Customer.AddressCity (string) Required MaxLength(200), 2], [Property: Customer.AddressCountry (string) Required MaxLength(200), 3], [Property: Customer.AddressDistrict (string) Required MaxLength(200), 4], [Property: Customer.AddressPostalCode (string) Required MaxLength(50), 5], [Property: Customer.AddressStreet (string) MaxLength(200), 6], [Property: Customer.AddressSubNumber (string) MaxLength(200), 7], [Property: Customer.CreatedBy (string) Required MaxLength(50), 8], [Property: Customer.CreatedDate (DateTime) Required, 9], [Property: Customer.CustomerType (string) Required MaxLength(100), 10], [Property: Customer.EmailAddress (string) MaxLength(80), 11], [Property: Customer.FullName (string) Required MaxLength(500), 12], [Property: Customer.IdentityNumber (string) Required MaxLength(100), 13], [Property: Customer.IdentityType (int?), 14], [Property: Customer.IsDeleted (bool) Required, 15], [Property: Customer.LastUpdatedDate (DateTime?), 16], [Property: Customer.OverpaymentBalance (decimal?), 17], [Property: Customer.PhoneNumber (string) MaxLength(50), 18], [Property: Customer.Vatnumber (string) MaxLength(100), 19] }
        SELECT TOP(1) c.Id, c.Address_BuildingNumber, c.Address_City, c.Address_Country, c.Address_District, c.Address_PostalCode, c.Address_Street, c.Address_SubNumber, c.CreatedBy, c.CreatedDate, c.CustomerType, c.EmailAddress, c.FullName, c.IdentityNumber, c.IdentityType, c.IsDeleted, c.LastUpdatedDate, c.OverpaymentBalance, c.PhoneNumber, c.VATNumber
        FROM Customers AS c
        WHERE c.IdentityNumber == @__cutomerIdentityNumber_0, 
        False, 
        new HashSet<string>(
            new string[]{ }, 
            StringComparer.Ordinal
        )
    )].GetRelationalCommandTemplate(parameters), 
    readerColumns: null, 
    shaper: (queryContext, dataReader, resultContext, resultCoordinator) => 
    {
        Customer entity;
        entity = 
        {
            MaterializationContext materializationContext1;
            IEntityType entityType1;
            Customer instance1;
            InternalEntityEntry entry1;
            bool hasNullKey1;
            materializationContext1 = new MaterializationContext(
                [LIFTABLE Constant: ValueBuffer | Resolver: _ => (object)ValueBuffer.Empty], 
                queryContext.Context
            );
            instance1 = default(Customer);
            entry1 = queryContext.TryGetEntry(
                key: [LIFTABLE Constant: Key: Customer.Id PK | Resolver: c => c.Dependencies.Model.FindEntityType("BillingSystem.Domain.Entities.Customer").FindPrimaryKey()], 
                keyValues: new object[]{ (object)dataReader.GetInt64(0) }, 
                throwOnNullKey: True, 
                hasNullKey: hasNullKey1);
            !(hasNullKey1) ? entry1 != default(InternalEntityEntry) ? 
            {
                entityType1 = entry1.EntityType;
                return instance1 = (Customer)entry1.Entity;
            } : 
            {
                ISnapshot shadowSnapshot1;
                shadowSnapshot1 = [LIFTABLE Constant: Snapshot | Resolver: _ => Snapshot.Empty];
                entityType1 = [LIFTABLE Constant: EntityType: Customer | Resolver: namelessParameter{0} => namelessParameter{0}.Dependencies.Model.FindEntityType("BillingSystem.Domain.Entities.Customer")];
                instance1 = switch (entityType1)
                {
                    case [LIFTABLE Constant: EntityType: Customer | Resolver: namelessParameter{1} => namelessParameter{1}.Dependencies.Model.FindEntityType("BillingSystem.Domain.Entities.Customer")]: 
                        {
                            return 
                            {
                                Customer instance;
                                instance = new Customer();
                                instance.<Id>k__BackingField = dataReader.GetInt64(0);
                                instance.<AddressBuildingNumber>k__BackingField = dataReader.IsDBNull(1) ? default(string) : dataReader.GetString(1);
                                instance.<AddressCity>k__BackingField = dataReader.GetString(2);
                                instance.<AddressCountry>k__BackingField = dataReader.GetString(3);
                                instance.<AddressDistrict>k__BackingField = dataReader.GetString(4);
                                instance.<AddressPostalCode>k__BackingField = dataReader.GetString(5);
                                instance.<AddressStreet>k__BackingField = dataReader.IsDBNull(6) ? default(string) : dataReader.GetString(6);
                                instance.<AddressSubNumber>k__BackingField = dataReader.IsDBNull(7) ? default(string) : dataReader.GetString(7);
                                instance.<CreatedBy>k__BackingField = dataReader.GetString(8);
                                instance.<CreatedDate>k__BackingField = dataReader.GetDateTime(9);
                                instance.<CustomerType>k__BackingField = dataReader.GetString(10);
                                instance.<EmailAddress>k__BackingField = dataReader.IsDBNull(11) ? default(string) : dataReader.GetString(11);
                                instance.<FullName>k__BackingField = dataReader.GetString(12);
                                instance.<IdentityNumber>k__BackingField = dataReader.GetString(13);
                                instance.<IdentityType>k__BackingField = dataReader.IsDBNull(14) ? default(int?) : (int?)dataReader.GetInt32(14);
                                instance.<IsDeleted>k__BackingField = dataReader.GetBoolean(15);
                                instance.<LastUpdatedDate>k__BackingField = dataReader.IsDBNull(16) ? default(DateTime?) : (DateTime?)dataReader.GetDateTime(16);
                                instance.<OverpaymentBalance>k__BackingField = dataReader.IsDBNull(17) ? default(decimal?) : (decimal?)dataReader.GetDecimal(17);
                                instance.<PhoneNumber>k__BackingField = dataReader.IsDBNull(18) ? default(string) : dataReader.GetString(18);
                                instance.<Vatnumber>k__BackingField = dataReader.IsDBNull(19) ? default(string) : dataReader.GetString(19);
                                (instance is IInjectableService) ? ((IInjectableService)instance).Injected(
                                    context: materializationContext1.Context, 
                                    entity: instance, 
                                    queryTrackingBehavior: TrackAll, 
                                    structuralType: [LIFTABLE Constant: EntityType: Customer | Resolver: namelessParameter{2} => namelessParameter{2}.Dependencies.Model.FindEntityType("BillingSystem.Domain.Entities.Customer")]) : default(void);
                                return instance;
                            }}
                    default: 
                        default(Customer)
                }
                ;
                entry1 = entityType1 == default(IEntityType) ? default(InternalEntityEntry) : queryContext.StartTracking(
                    entityType: entityType1, 
                    entity: instance1, 
                    snapshot: shadowSnapshot1);
                return instance1;
            } : default(void);
            return instance1;
        };
        return entity;
    }, 
    contextType: BillingSystem.Infrastructure.EF.BillingServiceDBContext, 
    standAloneStateManager: False, 
    detailedErrorsEnabled: False, 
    threadSafetyChecksEnabled: True)
    .SingleOrDefault()'
2025-11-19 10:06:46.309 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-11-19 10:06:46.316 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (6ms).
2025-11-19 10:06:46.321 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (12ms).
2025-11-19 10:06:46.325 +03:00 [DBG] Executing DbCommand [Parameters=[@__cutomerIdentityNumber_0='?' (Size = 100)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[Id], [c].[Address_BuildingNumber], [c].[Address_City], [c].[Address_Country], [c].[Address_District], [c].[Address_PostalCode], [c].[Address_Street], [c].[Address_SubNumber], [c].[CreatedBy], [c].[CreatedDate], [c].[CustomerType], [c].[EmailAddress], [c].[FullName], [c].[IdentityNumber], [c].[IdentityType], [c].[IsDeleted], [c].[LastUpdatedDate], [c].[OverpaymentBalance], [c].[PhoneNumber], [c].[VATNumber]
FROM [Customers] AS [c]
WHERE [c].[IdentityNumber] = @__cutomerIdentityNumber_0
2025-11-19 10:06:46.332 +03:00 [INF] Executed DbCommand (8ms) [Parameters=[@__cutomerIdentityNumber_0='?' (Size = 100)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[Id], [c].[Address_BuildingNumber], [c].[Address_City], [c].[Address_Country], [c].[Address_District], [c].[Address_PostalCode], [c].[Address_Street], [c].[Address_SubNumber], [c].[CreatedBy], [c].[CreatedDate], [c].[CustomerType], [c].[EmailAddress], [c].[FullName], [c].[IdentityNumber], [c].[IdentityType], [c].[IsDeleted], [c].[LastUpdatedDate], [c].[OverpaymentBalance], [c].[PhoneNumber], [c].[VATNumber]
FROM [Customers] AS [c]
WHERE [c].[IdentityNumber] = @__cutomerIdentityNumber_0
2025-11-19 10:06:46.339 +03:00 [DBG] Closing data reader to 'GAC-BillingService' on server '.'.
2025-11-19 10:06:46.342 +03:00 [DBG] A data reader for 'GAC-BillingService' on server '.' is being disposed after spending 3ms reading results.
2025-11-19 10:06:46.392 +03:00 [DBG] 'BillingServiceDBContext' generated a temporary value for the property 'Invoice.Id'. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-11-19 10:06:46.575 +03:00 [DBG] Context 'BillingServiceDBContext' started tracking 'Invoice' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-11-19 10:06:46.584 +03:00 [DBG] 'BillingServiceDBContext' generated a temporary value for the property 'Customer.Id'. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-11-19 10:06:46.648 +03:00 [DBG] The foreign key property 'Invoice.CustomerId' was detected as changed. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see property values.
2025-11-19 10:06:46.672 +03:00 [DBG] Context 'BillingServiceDBContext' started tracking 'Customer' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-11-19 10:06:46.681 +03:00 [DBG] 'BillingServiceDBContext' generated a temporary value for the property 'InvoicesAttachment.Id'. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-11-19 10:06:46.706 +03:00 [DBG] The navigation 'InvoicesAttachment.Invoice' was detected as changed. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-11-19 10:06:46.714 +03:00 [DBG] Context 'BillingServiceDBContext' started tracking 'InvoicesAttachment' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-11-19 10:06:46.722 +03:00 [DBG] 'BillingServiceDBContext' generated a temporary value for the property 'InvoicesItem.Id'. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-11-19 10:06:46.752 +03:00 [DBG] The navigation 'InvoicesItem.Invoice' was detected as changed. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-11-19 10:06:46.759 +03:00 [DBG] Context 'BillingServiceDBContext' started tracking 'InvoicesItem' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-11-19 10:06:46.766 +03:00 [DBG] SaveChanges starting for 'BillingServiceDBContext'.
2025-11-19 10:06:46.773 +03:00 [DBG] DetectChanges starting for 'BillingServiceDBContext'.
2025-11-19 10:06:46.834 +03:00 [DBG] DetectChanges completed for 'BillingServiceDBContext'.
2025-11-19 10:06:46.958 +03:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-11-19 10:06:46.963 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-11-19 10:06:46.968 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (4ms).
2025-11-19 10:06:46.973 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (9ms).
2025-11-19 10:06:46.978 +03:00 [DBG] Executing DbCommand [Parameters=[@p0='?' (Size = 200), @p1='?' (Size = 200), @p2='?' (Size = 200), @p3='?' (Size = 200), @p4='?' (Size = 50), @p5='?' (Size = 200), @p6='?' (Size = 200), @p7='?' (Size = 50), @p8='?' (DbType = DateTime), @p9='?' (Size = 100), @p10='?' (Size = 80), @p11='?' (Size = 500), @p12='?' (Size = 100), @p13='?' (DbType = Int32), @p14='?' (DbType = Boolean), @p15='?' (DbType = DateTime), @p16='?' (Precision = 18) (DbType = Decimal), @p17='?' (Size = 50), @p18='?' (Size = 100)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [Customers] ([Address_BuildingNumber], [Address_City], [Address_Country], [Address_District], [Address_PostalCode], [Address_Street], [Address_SubNumber], [CreatedBy], [CreatedDate], [CustomerType], [EmailAddress], [FullName], [IdentityNumber], [IdentityType], [IsDeleted], [LastUpdatedDate], [OverpaymentBalance], [PhoneNumber], [VATNumber])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18);
2025-11-19 10:06:47.011 +03:00 [INF] Executed DbCommand (35ms) [Parameters=[@p0='?' (Size = 200), @p1='?' (Size = 200), @p2='?' (Size = 200), @p3='?' (Size = 200), @p4='?' (Size = 50), @p5='?' (Size = 200), @p6='?' (Size = 200), @p7='?' (Size = 50), @p8='?' (DbType = DateTime), @p9='?' (Size = 100), @p10='?' (Size = 80), @p11='?' (Size = 500), @p12='?' (Size = 100), @p13='?' (DbType = Int32), @p14='?' (DbType = Boolean), @p15='?' (DbType = DateTime), @p16='?' (Precision = 18) (DbType = Decimal), @p17='?' (Size = 50), @p18='?' (Size = 100)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [Customers] ([Address_BuildingNumber], [Address_City], [Address_Country], [Address_District], [Address_PostalCode], [Address_Street], [Address_SubNumber], [CreatedBy], [CreatedDate], [CustomerType], [EmailAddress], [FullName], [IdentityNumber], [IdentityType], [IsDeleted], [LastUpdatedDate], [OverpaymentBalance], [PhoneNumber], [VATNumber])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18);
2025-11-19 10:06:47.030 +03:00 [DBG] The foreign key property 'Customer.Id' was detected as changed. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see property values.
2025-11-19 10:06:47.039 +03:00 [DBG] The foreign key property 'Invoice.CustomerId' was detected as changed. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see property values.
2025-11-19 10:06:47.044 +03:00 [DBG] Closing data reader to 'GAC-BillingService' on server '.'.
2025-11-19 10:06:47.047 +03:00 [DBG] A data reader for 'GAC-BillingService' on server '.' is being disposed after spending 30ms reading results.
2025-11-19 10:06:47.055 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-11-19 10:06:47.057 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (2ms).
2025-11-19 10:06:47.061 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (6ms).
2025-11-19 10:06:47.067 +03:00 [DBG] Executing DbCommand [Parameters=[@p19='?' (Precision = 18) (DbType = Decimal), @p20='?' (Size = 3000), @p21='?' (Size = 100), @p22='?' (Size = 50), @p23='?' (DbType = DateTime), @p24='?' (Size = 50), @p25='?' (DbType = Int64), @p26='?' (DbType = Int64), @p27='?' (DbType = DateTime), @p28='?' (DbType = Guid), @p29='?' (Size = 50), @p30='?' (DbType = Int32), @p31='?' (DbType = Int32), @p32='?' (DbType = Boolean), @p33='?' (DbType = Boolean), @p34='?' (DbType = Boolean), @p35='?' (DbType = Boolean), @p36='?' (DbType = DateTime), @p37='?' (DbType = DateTime), @p38='?' (Size = 4000), @p39='?' (Size = 100), @p40='?' (Size = 100), @p41='?' (DbType = Int64), @p42='?' (Size = 4000), @p43='?' (DbType = Int64), @p44='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [Invoices] ([Amount], [CancelationReasons], [ClientReferenceNumber], [CreatedBy], [CreatedDate], [Currency], [CustomerID], [DiscountedPrimaryInvoiceID], [DueAt], [ExternalId], [InvoiceNumber], [InvoiceStatus], [InvoiceType], [IsDeleted], [IsDiscounted], [IsSubInvoice], [IsSubstitution], [IssuedAt], [LastUpdatedDate], [Metadata], [PaymentProvider], [PaymentReference], [PrimaryInvoiceID], [ProviderResponse], [SubstitutionPrimaryInvoiceID], [TenantId])
OUTPUT INSERTED.[Id]
VALUES (@p19, @p20, @p21, @p22, @p23, @p24, @p25, @p26, @p27, @p28, @p29, @p30, @p31, @p32, @p33, @p34, @p35, @p36, @p37, @p38, @p39, @p40, @p41, @p42, @p43, @p44);
2025-11-19 10:06:47.080 +03:00 [INF] Executed DbCommand (14ms) [Parameters=[@p19='?' (Precision = 18) (DbType = Decimal), @p20='?' (Size = 3000), @p21='?' (Size = 100), @p22='?' (Size = 50), @p23='?' (DbType = DateTime), @p24='?' (Size = 50), @p25='?' (DbType = Int64), @p26='?' (DbType = Int64), @p27='?' (DbType = DateTime), @p28='?' (DbType = Guid), @p29='?' (Size = 50), @p30='?' (DbType = Int32), @p31='?' (DbType = Int32), @p32='?' (DbType = Boolean), @p33='?' (DbType = Boolean), @p34='?' (DbType = Boolean), @p35='?' (DbType = Boolean), @p36='?' (DbType = DateTime), @p37='?' (DbType = DateTime), @p38='?' (Size = 4000), @p39='?' (Size = 100), @p40='?' (Size = 100), @p41='?' (DbType = Int64), @p42='?' (Size = 4000), @p43='?' (DbType = Int64), @p44='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [Invoices] ([Amount], [CancelationReasons], [ClientReferenceNumber], [CreatedBy], [CreatedDate], [Currency], [CustomerID], [DiscountedPrimaryInvoiceID], [DueAt], [ExternalId], [InvoiceNumber], [InvoiceStatus], [InvoiceType], [IsDeleted], [IsDiscounted], [IsSubInvoice], [IsSubstitution], [IssuedAt], [LastUpdatedDate], [Metadata], [PaymentProvider], [PaymentReference], [PrimaryInvoiceID], [ProviderResponse], [SubstitutionPrimaryInvoiceID], [TenantId])
OUTPUT INSERTED.[Id]
VALUES (@p19, @p20, @p21, @p22, @p23, @p24, @p25, @p26, @p27, @p28, @p29, @p30, @p31, @p32, @p33, @p34, @p35, @p36, @p37, @p38, @p39, @p40, @p41, @p42, @p43, @p44);
2025-11-19 10:06:47.086 +03:00 [DBG] The foreign key property 'Invoice.Id' was detected as changed. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see property values.
2025-11-19 10:06:47.093 +03:00 [DBG] The foreign key property 'InvoicesAttachment.InvoiceId' was detected as changed. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see property values.
2025-11-19 10:06:47.098 +03:00 [DBG] The foreign key property 'InvoicesItem.InvoiceId' was detected as changed. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see property values.
2025-11-19 10:06:47.103 +03:00 [DBG] Closing data reader to 'GAC-BillingService' on server '.'.
2025-11-19 10:06:47.106 +03:00 [DBG] A data reader for 'GAC-BillingService' on server '.' is being disposed after spending 20ms reading results.
2025-11-19 10:06:47.114 +03:00 [DBG] Executing 2 update commands as a batch.
2025-11-19 10:06:47.118 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-11-19 10:06:47.123 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (4ms).
2025-11-19 10:06:47.126 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (7ms).
2025-11-19 10:06:47.130 +03:00 [DBG] Executing DbCommand [Parameters=[@p45='?' (Size = 50), @p46='?' (DbType = DateTime), @p47='?' (Size = 200), @p48='?' (DbType = Int64), @p49='?' (DbType = Boolean), @p50='?' (Precision = 18) (DbType = Decimal), @p51='?' (Size = 50), @p52='?' (DbType = DateTime), @p53='?' (DbType = Int64), @p54='?' (DbType = Boolean), @p55='?' (Size = 500), @p56='?' (Size = 200), @p57='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SET NOCOUNT ON;
INSERT INTO [InvoicesAttachments] ([CreatedBy], [CreatedDate], [FileName], [InvoiceId], [IsDeleted])
OUTPUT INSERTED.[Id]
VALUES (@p45, @p46, @p47, @p48, @p49);
INSERT INTO [InvoicesItems] ([Amount], [CreatedBy], [CreatedDate], [InvoiceId], [IsDeleted], [ItemDesc], [ItemName], [Quantity])
OUTPUT INSERTED.[Id]
VALUES (@p50, @p51, @p52, @p53, @p54, @p55, @p56, @p57);
2025-11-19 10:06:47.142 +03:00 [INF] Executed DbCommand (13ms) [Parameters=[@p45='?' (Size = 50), @p46='?' (DbType = DateTime), @p47='?' (Size = 200), @p48='?' (DbType = Int64), @p49='?' (DbType = Boolean), @p50='?' (Precision = 18) (DbType = Decimal), @p51='?' (Size = 50), @p52='?' (DbType = DateTime), @p53='?' (DbType = Int64), @p54='?' (DbType = Boolean), @p55='?' (Size = 500), @p56='?' (Size = 200), @p57='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SET NOCOUNT ON;
INSERT INTO [InvoicesAttachments] ([CreatedBy], [CreatedDate], [FileName], [InvoiceId], [IsDeleted])
OUTPUT INSERTED.[Id]
VALUES (@p45, @p46, @p47, @p48, @p49);
INSERT INTO [InvoicesItems] ([Amount], [CreatedBy], [CreatedDate], [InvoiceId], [IsDeleted], [ItemDesc], [ItemName], [Quantity])
OUTPUT INSERTED.[Id]
VALUES (@p50, @p51, @p52, @p53, @p54, @p55, @p56, @p57);
2025-11-19 10:06:47.149 +03:00 [DBG] The foreign key property 'InvoicesAttachment.Id' was detected as changed. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see property values.
2025-11-19 10:06:47.154 +03:00 [DBG] The foreign key property 'InvoicesItem.Id' was detected as changed. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see property values.
2025-11-19 10:06:47.159 +03:00 [DBG] Closing data reader to 'GAC-BillingService' on server '.'.
2025-11-19 10:06:47.162 +03:00 [DBG] A data reader for 'GAC-BillingService' on server '.' is being disposed after spending 14ms reading results.
2025-11-19 10:06:47.180 +03:00 [DBG] An entity of type 'Invoice' tracked by 'BillingServiceDBContext' changed state from '"Added"' to '"Unchanged"'. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-11-19 10:06:47.187 +03:00 [DBG] An entity of type 'Customer' tracked by 'BillingServiceDBContext' changed state from '"Added"' to '"Unchanged"'. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-11-19 10:06:47.193 +03:00 [DBG] An entity of type 'InvoicesAttachment' tracked by 'BillingServiceDBContext' changed state from '"Added"' to '"Unchanged"'. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-11-19 10:06:47.199 +03:00 [DBG] An entity of type 'InvoicesItem' tracked by 'BillingServiceDBContext' changed state from '"Added"' to '"Unchanged"'. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-11-19 10:06:47.209 +03:00 [DBG] SaveChanges completed for 'BillingServiceDBContext' with 4 entities written to the database.
2025-11-19 10:06:47.219 +03:00 [DBG] 'BillingServiceDBContext' generated a temporary value for the property 'OutboxEvent.Id'. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-11-19 10:06:47.242 +03:00 [DBG] Context 'BillingServiceDBContext' started tracking 'OutboxEvent' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-11-19 10:06:47.249 +03:00 [DBG] 'BillingServiceDBContext' generated a temporary value for the property 'AuditEvent.Id'. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-11-19 10:06:47.269 +03:00 [DBG] Context 'BillingServiceDBContext' started tracking 'AuditEvent' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-11-19 10:06:47.273 +03:00 [DBG] SaveChanges starting for 'BillingServiceDBContext'.
2025-11-19 10:06:47.278 +03:00 [DBG] DetectChanges starting for 'BillingServiceDBContext'.
2025-11-19 10:06:47.298 +03:00 [DBG] DetectChanges completed for 'BillingServiceDBContext'.
2025-11-19 10:06:47.307 +03:00 [DBG] Executing 2 update commands as a batch.
2025-11-19 10:06:47.311 +03:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-11-19 10:06:47.313 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-11-19 10:06:47.316 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (3ms).
2025-11-19 10:06:47.322 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (9ms).
2025-11-19 10:06:47.326 +03:00 [DBG] Executing DbCommand [Parameters=[@p0='?' (Size = 100), @p1='?' (Size = 4000), @p2='?' (Size = 50), @p3='?' (DbType = DateTime), @p4='?' (Size = 500), @p5='?' (Size = 20), @p6='?' (Size = 100), @p7='?' (Size = 100), @p8='?' (DbType = Int64), @p9='?' (DbType = DateTime), @p10='?' (Size = 4000), @p11='?' (Size = 300), @p12='?' (Size = 4000), @p13='?' (DbType = Boolean), @p14='?' (Size = 20) (DbType = AnsiString)], CommandType='"Text"', CommandTimeout='30']
SET NOCOUNT ON;
INSERT INTO [audit].[AuditEvents] ([Action], [Changes], [CreatedBy], [CreatedDate], [Description], [EntityId], [EntityType], [UserId])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
INSERT INTO [Outbox_events] ([Aggregate_id], [CreatedDate], [ErrorMsg], [Event_type], [Payload], [Processed], [ProcessingStatus])
OUTPUT INSERTED.[Id]
VALUES (@p8, @p9, @p10, @p11, @p12, @p13, @p14);
2025-11-19 10:06:47.337 +03:00 [INF] Executed DbCommand (11ms) [Parameters=[@p0='?' (Size = 100), @p1='?' (Size = 4000), @p2='?' (Size = 50), @p3='?' (DbType = DateTime), @p4='?' (Size = 500), @p5='?' (Size = 20), @p6='?' (Size = 100), @p7='?' (Size = 100), @p8='?' (DbType = Int64), @p9='?' (DbType = DateTime), @p10='?' (Size = 4000), @p11='?' (Size = 300), @p12='?' (Size = 4000), @p13='?' (DbType = Boolean), @p14='?' (Size = 20) (DbType = AnsiString)], CommandType='"Text"', CommandTimeout='30']
SET NOCOUNT ON;
INSERT INTO [audit].[AuditEvents] ([Action], [Changes], [CreatedBy], [CreatedDate], [Description], [EntityId], [EntityType], [UserId])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
INSERT INTO [Outbox_events] ([Aggregate_id], [CreatedDate], [ErrorMsg], [Event_type], [Payload], [Processed], [ProcessingStatus])
OUTPUT INSERTED.[Id]
VALUES (@p8, @p9, @p10, @p11, @p12, @p13, @p14);
2025-11-19 10:06:47.343 +03:00 [DBG] The foreign key property 'AuditEvent.Id' was detected as changed. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see property values.
2025-11-19 10:06:47.348 +03:00 [DBG] The foreign key property 'OutboxEvent.Id' was detected as changed. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see property values.
2025-11-19 10:06:47.352 +03:00 [DBG] Closing data reader to 'GAC-BillingService' on server '.'.
2025-11-19 10:06:47.355 +03:00 [DBG] A data reader for 'GAC-BillingService' on server '.' is being disposed after spending 13ms reading results.
2025-11-19 10:06:47.359 +03:00 [DBG] An entity of type 'AuditEvent' tracked by 'BillingServiceDBContext' changed state from '"Added"' to '"Unchanged"'. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-11-19 10:06:47.365 +03:00 [DBG] An entity of type 'OutboxEvent' tracked by 'BillingServiceDBContext' changed state from '"Added"' to '"Unchanged"'. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-11-19 10:06:47.370 +03:00 [DBG] SaveChanges completed for 'BillingServiceDBContext' with 2 entities written to the database.
2025-11-19 10:06:47.378 +03:00 [DBG] Committing transaction.
2025-11-19 10:06:47.394 +03:00 [DBG] Committed transaction.
2025-11-19 10:06:47.401 +03:00 [DBG] Closing connection to database 'GAC-BillingService' on server '.'.
2025-11-19 10:06:47.406 +03:00 [DBG] Closed connection to database 'GAC-BillingService' on server '.' (5ms).
2025-11-19 10:06:47.414 +03:00 [DBG] Disposing transaction.
2025-11-19 10:06:47.430 +03:00 [DBG] List of registered output formatters, in the following order: ["Microsoft.AspNetCore.Mvc.Formatters.HttpNoContentOutputFormatter","Microsoft.AspNetCore.Mvc.Formatters.StringOutputFormatter","Microsoft.AspNetCore.Mvc.Formatters.StreamOutputFormatter","Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonOutputFormatter"]
2025-11-19 10:06:47.441 +03:00 [DBG] No information found on request to perform content negotiation.
2025-11-19 10:06:47.446 +03:00 [DBG] Attempting to select the first output formatter in the output formatters list which supports a content type from the explicitly specified content types '["application/json"]'.
2025-11-19 10:06:47.452 +03:00 [DBG] Selected output formatter 'Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonOutputFormatter' and content type 'application/json' to write the response.
2025-11-19 10:06:47.456 +03:00 [INF] Executing OkObjectResult, writing value of type 'BillingSystem.SharedKernel.ApiResponse`1[[System.Int64, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-11-19 10:06:47.481 +03:00 [INF] Executed action BillingSystem.API.Controllers.InvoicesController.Post (BillingSystem.API) in 4113.7192ms
2025-11-19 10:06:47.487 +03:00 [INF] Executed endpoint 'BillingSystem.API.Controllers.InvoicesController.Post (BillingSystem.API)'
2025-11-19 10:06:47.491 +03:00 [INF] HTTP POST /api/Invoices responded 200 in 10071.9198 ms
2025-11-19 10:06:47.496 +03:00 [DBG] Connection id "0HNH778K4T0FJ" completed keep alive response.
2025-11-19 10:06:47.502 +03:00 [DBG] 'BillingServiceDBContext' disposed.
2025-11-19 10:06:47.509 +03:00 [DBG] Disposing connection to database 'GAC-BillingService' on server '.'.
2025-11-19 10:06:47.514 +03:00 [DBG] Disposed connection to database '' on server '' (4ms).
2025-11-19 10:06:47.519 +03:00 [INF] Request finished HTTP/1.1 POST https://localhost:7257/api/Invoices - 200 null application/json; charset=utf-8 10139.1839ms
2025-11-19 10:09:00.205 +03:00 [DBG] Connection id "0HNH778K4T0FK" accepted.
2025-11-19 10:09:00.205 +03:00 [DBG] Connection id "0HNH778K4T0FK" received FIN.
2025-11-19 10:09:00.213 +03:00 [DBG] Connection id "0HNH778K4T0FL" accepted.
2025-11-19 10:09:00.211 +03:00 [DBG] Connection id "0HNH778K4T0FK" started.
2025-11-19 10:09:00.238 +03:00 [DBG] Connection id "0HNH778K4T0FL" started.
2025-11-19 10:09:00.249 +03:00 [DBG] Failed to authenticate HTTPS connection.
System.IO.IOException: Received an unexpected EOF or 0 bytes from the transport stream.
   at System.Net.Security.SslStream.ReceiveHandshakeFrameAsync[TIOAdapter](CancellationToken cancellationToken)
   at System.Net.Security.SslStream.ForceAuthenticationAsync[TIOAdapter](Boolean receiveFirst, Byte[] reAuthenticationData, CancellationToken cancellationToken)
   at System.Net.Security.SslStream.ProcessAuthenticationWithTelemetryAsync(Boolean isAsync, CancellationToken cancellationToken)
   at Microsoft.AspNetCore.Server.Kestrel.Https.Internal.HttpsConnectionMiddleware.OnConnectionAsync(ConnectionContext context)
2025-11-19 10:09:00.258 +03:00 [DBG] Connection id "0HNH778K4T0FK" stopped.
2025-11-19 10:09:00.259 +03:00 [DBG] Connection 0HNH778K4T0FL established using the following protocol: "Tls13"
2025-11-19 10:09:00.262 +03:00 [DBG] Connection id "0HNH778K4T0FK" sending FIN because: "The Socket transport's send loop completed gracefully."
2025-11-19 10:09:00.267 +03:00 [INF] Request starting HTTP/1.1 POST https://localhost:7257/api/Invoices - application/json 1394
2025-11-19 10:09:00.276 +03:00 [DBG] 1 candidate(s) found for the request path '/api/Invoices'
2025-11-19 10:09:00.281 +03:00 [DBG] Endpoint 'BillingSystem.API.Controllers.InvoicesController.Post (BillingSystem.API)' with route pattern 'api/Invoices' is valid for the request path '/api/Invoices'
2025-11-19 10:09:00.286 +03:00 [DBG] Request matched endpoint 'BillingSystem.API.Controllers.InvoicesController.Post (BillingSystem.API)'
2025-11-19 10:09:00.289 +03:00 [DBG] Static files was skipped as the request already matched an endpoint.
2025-11-19 10:09:00.296 +03:00 [INF] Executing endpoint 'BillingSystem.API.Controllers.InvoicesController.Post (BillingSystem.API)'
2025-11-19 10:09:00.300 +03:00 [INF] Route matched with {action = "Post", controller = "Invoices"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Post(BillingSystem.Application.Requests.CreateInvoiceRequest) on controller BillingSystem.API.Controllers.InvoicesController (BillingSystem.API).
2025-11-19 10:09:00.304 +03:00 [DBG] Execution plan of authorization filters (in the following order): ["None"]
2025-11-19 10:09:00.308 +03:00 [DBG] Execution plan of resource filters (in the following order): ["None"]
2025-11-19 10:09:00.312 +03:00 [DBG] Execution plan of action filters (in the following order): ["Microsoft.AspNetCore.Mvc.ModelBinding.UnsupportedContentTypeFilter (Order: -3000)","Microsoft.AspNetCore.Mvc.Infrastructure.ModelStateInvalidFilter (Order: -2000)","BillingSystem.API.ActionFilters.AuditBillingRequestsFilter","BillingSystem.API.ActionFilters.IdempotencyFilter (Order: 0)"]
2025-11-19 10:09:00.318 +03:00 [DBG] Execution plan of exception filters (in the following order): ["None"]
2025-11-19 10:09:00.322 +03:00 [DBG] Execution plan of result filters (in the following order): ["Microsoft.AspNetCore.Mvc.Infrastructure.ClientErrorResultFilter (Order: -2000)","Microsoft.AspNetCore.Mvc.ProducesAttribute (Order: 0)","BillingSystem.API.ActionFilters.IdempotencyFilter (Order: 0)"]
2025-11-19 10:09:00.328 +03:00 [DBG] Executing controller factory for controller BillingSystem.API.Controllers.InvoicesController (BillingSystem.API)
2025-11-19 10:09:00.335 +03:00 [DBG] Executed controller factory for controller BillingSystem.API.Controllers.InvoicesController (BillingSystem.API)
2025-11-19 10:09:00.339 +03:00 [DBG] Attempting to bind parameter 'invoiceRequest' of type 'BillingSystem.Application.Requests.CreateInvoiceRequest' ...
2025-11-19 10:09:00.344 +03:00 [DBG] Attempting to bind parameter 'invoiceRequest' of type 'BillingSystem.Application.Requests.CreateInvoiceRequest' using the name '' in request data ...
2025-11-19 10:09:00.350 +03:00 [DBG] Selected input formatter 'Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonInputFormatter' for content type 'application/json'.
2025-11-19 10:09:00.354 +03:00 [DBG] Connection id "0HNH778K4T0FL", Request id "0HNH778K4T0FL:00000001": started reading request body.
2025-11-19 10:09:00.358 +03:00 [DBG] Connection id "0HNH778K4T0FL", Request id "0HNH778K4T0FL:00000001": done reading request body.
2025-11-19 10:09:00.362 +03:00 [DBG] JSON input formatter succeeded, deserializing to type 'BillingSystem.Application.Requests.CreateInvoiceRequest'
2025-11-19 10:09:00.364 +03:00 [DBG] Done attempting to bind parameter 'invoiceRequest' of type 'BillingSystem.Application.Requests.CreateInvoiceRequest'.
2025-11-19 10:09:00.369 +03:00 [DBG] Done attempting to bind parameter 'invoiceRequest' of type 'BillingSystem.Application.Requests.CreateInvoiceRequest'.
2025-11-19 10:09:00.373 +03:00 [DBG] Attempting to validate the bound parameter 'invoiceRequest' of type 'BillingSystem.Application.Requests.CreateInvoiceRequest' ...
2025-11-19 10:09:00.377 +03:00 [DBG] Done attempting to validate the bound parameter 'invoiceRequest' of type 'BillingSystem.Application.Requests.CreateInvoiceRequest'.
2025-11-19 10:09:00.404 +03:00 [DBG] Entity Framework Core 9.0.9 initialized 'BillingServiceDBContext' using provider 'Microsoft.EntityFrameworkCore.SqlServer:9.0.9' with options: EngineType=SqlServer 
2025-11-19 10:09:00.415 +03:00 [DBG] Creating DbConnection.
2025-11-19 10:09:00.420 +03:00 [DBG] Created DbConnection. (5ms).
2025-11-19 10:09:00.424 +03:00 [DBG] Opening connection to database 'GAC-BillingService' on server '.'.
2025-11-19 10:09:00.428 +03:00 [DBG] Opened connection to database 'GAC-BillingService' on server '.'.
2025-11-19 10:09:00.432 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-11-19 10:09:00.436 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (3ms).
2025-11-19 10:09:00.440 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (8ms).
2025-11-19 10:09:00.444 +03:00 [DBG] Executing DbCommand [Parameters=[@__idempotentKey_0='?' (Size = 36) (DbType = AnsiString)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [Invoices] AS [i]
        WHERE CONVERT(varchar(36), [i].[ExternalId]) = @__idempotentKey_0) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2025-11-19 10:09:00.454 +03:00 [INF] Executed DbCommand (11ms) [Parameters=[@__idempotentKey_0='?' (Size = 36) (DbType = AnsiString)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [Invoices] AS [i]
        WHERE CONVERT(varchar(36), [i].[ExternalId]) = @__idempotentKey_0) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2025-11-19 10:09:00.464 +03:00 [DBG] Closing data reader to 'GAC-BillingService' on server '.'.
2025-11-19 10:09:00.468 +03:00 [DBG] A data reader for 'GAC-BillingService' on server '.' is being disposed after spending 4ms reading results.
2025-11-19 10:09:00.476 +03:00 [DBG] Closing connection to database 'GAC-BillingService' on server '.'.
2025-11-19 10:09:00.480 +03:00 [DBG] Closed connection to database 'GAC-BillingService' on server '.' (3ms).
2025-11-19 10:09:00.493 +03:00 [DBG] Opening connection to database 'GAC-BillingService' on server '.'.
2025-11-19 10:09:00.499 +03:00 [DBG] Opened connection to database 'GAC-BillingService' on server '.'.
2025-11-19 10:09:00.503 +03:00 [DBG] Beginning transaction with isolation level 'Unspecified'.
2025-11-19 10:09:00.509 +03:00 [DBG] Began transaction with isolation level 'ReadCommitted'.
2025-11-19 10:09:00.514 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-11-19 10:09:00.517 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (3ms).
2025-11-19 10:09:00.521 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (6ms).
2025-11-19 10:09:00.524 +03:00 [DBG] Executing DbCommand [Parameters=[], CommandType='"Text"', CommandTimeout='30']
EXECUTE dbo.GetNextInvoiceNumber
2025-11-19 10:09:00.530 +03:00 [INF] Executed DbCommand (6ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
EXECUTE dbo.GetNextInvoiceNumber
2025-11-19 10:09:00.536 +03:00 [DBG] Closing data reader to 'GAC-BillingService' on server '.'.
2025-11-19 10:09:00.539 +03:00 [DBG] A data reader for 'GAC-BillingService' on server '.' is being disposed after spending 3ms reading results.
2025-11-19 10:09:00.543 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-11-19 10:09:00.545 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (2ms).
2025-11-19 10:09:00.549 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (5ms).
2025-11-19 10:09:00.552 +03:00 [DBG] Executing DbCommand [Parameters=[@__cutomerIdentityNumber_0='?' (Size = 100)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[Id], [c].[Address_BuildingNumber], [c].[Address_City], [c].[Address_Country], [c].[Address_District], [c].[Address_PostalCode], [c].[Address_Street], [c].[Address_SubNumber], [c].[CreatedBy], [c].[CreatedDate], [c].[CustomerType], [c].[EmailAddress], [c].[FullName], [c].[IdentityNumber], [c].[IdentityType], [c].[IsDeleted], [c].[LastUpdatedDate], [c].[OverpaymentBalance], [c].[PhoneNumber], [c].[VATNumber]
FROM [Customers] AS [c]
WHERE [c].[IdentityNumber] = @__cutomerIdentityNumber_0
2025-11-19 10:09:00.559 +03:00 [INF] Executed DbCommand (7ms) [Parameters=[@__cutomerIdentityNumber_0='?' (Size = 100)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[Id], [c].[Address_BuildingNumber], [c].[Address_City], [c].[Address_Country], [c].[Address_District], [c].[Address_PostalCode], [c].[Address_Street], [c].[Address_SubNumber], [c].[CreatedBy], [c].[CreatedDate], [c].[CustomerType], [c].[EmailAddress], [c].[FullName], [c].[IdentityNumber], [c].[IdentityType], [c].[IsDeleted], [c].[LastUpdatedDate], [c].[OverpaymentBalance], [c].[PhoneNumber], [c].[VATNumber]
FROM [Customers] AS [c]
WHERE [c].[IdentityNumber] = @__cutomerIdentityNumber_0
2025-11-19 10:09:00.569 +03:00 [DBG] Context 'BillingServiceDBContext' started tracking 'Customer' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-11-19 10:09:00.573 +03:00 [DBG] Closing data reader to 'GAC-BillingService' on server '.'.
2025-11-19 10:09:00.576 +03:00 [DBG] A data reader for 'GAC-BillingService' on server '.' is being disposed after spending 12ms reading results.
2025-11-19 10:09:00.582 +03:00 [DBG] 'BillingServiceDBContext' generated a temporary value for the property 'Invoice.Id'. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-11-19 10:09:00.585 +03:00 [DBG] Context 'BillingServiceDBContext' started tracking 'Invoice' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-11-19 10:09:00.589 +03:00 [DBG] 'BillingServiceDBContext' generated a temporary value for the property 'InvoicesAttachment.Id'. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-11-19 10:09:00.592 +03:00 [DBG] The navigation 'InvoicesAttachment.Invoice' was detected as changed. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-11-19 10:09:00.596 +03:00 [DBG] Context 'BillingServiceDBContext' started tracking 'InvoicesAttachment' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-11-19 10:09:00.599 +03:00 [DBG] 'BillingServiceDBContext' generated a temporary value for the property 'InvoicesItem.Id'. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-11-19 10:09:00.603 +03:00 [DBG] The navigation 'InvoicesItem.Invoice' was detected as changed. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-11-19 10:09:00.606 +03:00 [DBG] Context 'BillingServiceDBContext' started tracking 'InvoicesItem' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-11-19 10:09:00.608 +03:00 [DBG] SaveChanges starting for 'BillingServiceDBContext'.
2025-11-19 10:09:00.610 +03:00 [DBG] DetectChanges starting for 'BillingServiceDBContext'.
2025-11-19 10:09:00.613 +03:00 [DBG] DetectChanges completed for 'BillingServiceDBContext'.
2025-11-19 10:09:00.618 +03:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-11-19 10:09:00.620 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-11-19 10:09:00.623 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (2ms).
2025-11-19 10:09:00.626 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (5ms).
2025-11-19 10:09:00.629 +03:00 [DBG] Executing DbCommand [Parameters=[@p0='?' (Precision = 18) (DbType = Decimal), @p1='?' (Size = 3000), @p2='?' (Size = 100), @p3='?' (Size = 50), @p4='?' (DbType = DateTime), @p5='?' (Size = 50), @p6='?' (DbType = Int64), @p7='?' (DbType = Int64), @p8='?' (DbType = DateTime), @p9='?' (DbType = Guid), @p10='?' (Size = 50), @p11='?' (DbType = Int32), @p12='?' (DbType = Int32), @p13='?' (DbType = Boolean), @p14='?' (DbType = Boolean), @p15='?' (DbType = Boolean), @p16='?' (DbType = Boolean), @p17='?' (DbType = DateTime), @p18='?' (DbType = DateTime), @p19='?' (Size = 4000), @p20='?' (Size = 100), @p21='?' (Size = 100), @p22='?' (DbType = Int64), @p23='?' (Size = 4000), @p24='?' (DbType = Int64), @p25='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [Invoices] ([Amount], [CancelationReasons], [ClientReferenceNumber], [CreatedBy], [CreatedDate], [Currency], [CustomerID], [DiscountedPrimaryInvoiceID], [DueAt], [ExternalId], [InvoiceNumber], [InvoiceStatus], [InvoiceType], [IsDeleted], [IsDiscounted], [IsSubInvoice], [IsSubstitution], [IssuedAt], [LastUpdatedDate], [Metadata], [PaymentProvider], [PaymentReference], [PrimaryInvoiceID], [ProviderResponse], [SubstitutionPrimaryInvoiceID], [TenantId])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18, @p19, @p20, @p21, @p22, @p23, @p24, @p25);
2025-11-19 10:09:00.639 +03:00 [INF] Executed DbCommand (10ms) [Parameters=[@p0='?' (Precision = 18) (DbType = Decimal), @p1='?' (Size = 3000), @p2='?' (Size = 100), @p3='?' (Size = 50), @p4='?' (DbType = DateTime), @p5='?' (Size = 50), @p6='?' (DbType = Int64), @p7='?' (DbType = Int64), @p8='?' (DbType = DateTime), @p9='?' (DbType = Guid), @p10='?' (Size = 50), @p11='?' (DbType = Int32), @p12='?' (DbType = Int32), @p13='?' (DbType = Boolean), @p14='?' (DbType = Boolean), @p15='?' (DbType = Boolean), @p16='?' (DbType = Boolean), @p17='?' (DbType = DateTime), @p18='?' (DbType = DateTime), @p19='?' (Size = 4000), @p20='?' (Size = 100), @p21='?' (Size = 100), @p22='?' (DbType = Int64), @p23='?' (Size = 4000), @p24='?' (DbType = Int64), @p25='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [Invoices] ([Amount], [CancelationReasons], [ClientReferenceNumber], [CreatedBy], [CreatedDate], [Currency], [CustomerID], [DiscountedPrimaryInvoiceID], [DueAt], [ExternalId], [InvoiceNumber], [InvoiceStatus], [InvoiceType], [IsDeleted], [IsDiscounted], [IsSubInvoice], [IsSubstitution], [IssuedAt], [LastUpdatedDate], [Metadata], [PaymentProvider], [PaymentReference], [PrimaryInvoiceID], [ProviderResponse], [SubstitutionPrimaryInvoiceID], [TenantId])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18, @p19, @p20, @p21, @p22, @p23, @p24, @p25);
2025-11-19 10:09:00.644 +03:00 [DBG] The foreign key property 'Invoice.Id' was detected as changed. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see property values.
2025-11-19 10:09:00.647 +03:00 [DBG] The foreign key property 'InvoicesAttachment.InvoiceId' was detected as changed. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see property values.
2025-11-19 10:09:00.651 +03:00 [DBG] The foreign key property 'InvoicesItem.InvoiceId' was detected as changed. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see property values.
2025-11-19 10:09:00.654 +03:00 [DBG] Closing data reader to 'GAC-BillingService' on server '.'.
2025-11-19 10:09:00.657 +03:00 [DBG] A data reader for 'GAC-BillingService' on server '.' is being disposed after spending 13ms reading results.
2025-11-19 10:09:00.662 +03:00 [DBG] Executing 2 update commands as a batch.
2025-11-19 10:09:00.665 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-11-19 10:09:00.667 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (2ms).
2025-11-19 10:09:00.670 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (5ms).
2025-11-19 10:09:00.673 +03:00 [DBG] Executing DbCommand [Parameters=[@p26='?' (Size = 50), @p27='?' (DbType = DateTime), @p28='?' (Size = 200), @p29='?' (DbType = Int64), @p30='?' (DbType = Boolean), @p31='?' (Precision = 18) (DbType = Decimal), @p32='?' (Size = 50), @p33='?' (DbType = DateTime), @p34='?' (DbType = Int64), @p35='?' (DbType = Boolean), @p36='?' (Size = 500), @p37='?' (Size = 200), @p38='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SET NOCOUNT ON;
INSERT INTO [InvoicesAttachments] ([CreatedBy], [CreatedDate], [FileName], [InvoiceId], [IsDeleted])
OUTPUT INSERTED.[Id]
VALUES (@p26, @p27, @p28, @p29, @p30);
INSERT INTO [InvoicesItems] ([Amount], [CreatedBy], [CreatedDate], [InvoiceId], [IsDeleted], [ItemDesc], [ItemName], [Quantity])
OUTPUT INSERTED.[Id]
VALUES (@p31, @p32, @p33, @p34, @p35, @p36, @p37, @p38);
2025-11-19 10:09:00.681 +03:00 [INF] Executed DbCommand (8ms) [Parameters=[@p26='?' (Size = 50), @p27='?' (DbType = DateTime), @p28='?' (Size = 200), @p29='?' (DbType = Int64), @p30='?' (DbType = Boolean), @p31='?' (Precision = 18) (DbType = Decimal), @p32='?' (Size = 50), @p33='?' (DbType = DateTime), @p34='?' (DbType = Int64), @p35='?' (DbType = Boolean), @p36='?' (Size = 500), @p37='?' (Size = 200), @p38='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SET NOCOUNT ON;
INSERT INTO [InvoicesAttachments] ([CreatedBy], [CreatedDate], [FileName], [InvoiceId], [IsDeleted])
OUTPUT INSERTED.[Id]
VALUES (@p26, @p27, @p28, @p29, @p30);
INSERT INTO [InvoicesItems] ([Amount], [CreatedBy], [CreatedDate], [InvoiceId], [IsDeleted], [ItemDesc], [ItemName], [Quantity])
OUTPUT INSERTED.[Id]
VALUES (@p31, @p32, @p33, @p34, @p35, @p36, @p37, @p38);
2025-11-19 10:09:00.686 +03:00 [DBG] The foreign key property 'InvoicesAttachment.Id' was detected as changed. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see property values.
2025-11-19 10:09:00.689 +03:00 [DBG] The foreign key property 'InvoicesItem.Id' was detected as changed. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see property values.
2025-11-19 10:09:00.692 +03:00 [DBG] Closing data reader to 'GAC-BillingService' on server '.'.
2025-11-19 10:09:00.694 +03:00 [DBG] A data reader for 'GAC-BillingService' on server '.' is being disposed after spending 8ms reading results.
2025-11-19 10:09:00.698 +03:00 [DBG] An entity of type 'Invoice' tracked by 'BillingServiceDBContext' changed state from '"Added"' to '"Unchanged"'. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-11-19 10:09:00.701 +03:00 [DBG] An entity of type 'InvoicesAttachment' tracked by 'BillingServiceDBContext' changed state from '"Added"' to '"Unchanged"'. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-11-19 10:09:00.705 +03:00 [DBG] An entity of type 'InvoicesItem' tracked by 'BillingServiceDBContext' changed state from '"Added"' to '"Unchanged"'. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-11-19 10:09:00.707 +03:00 [DBG] SaveChanges completed for 'BillingServiceDBContext' with 3 entities written to the database.
2025-11-19 10:09:00.711 +03:00 [DBG] 'BillingServiceDBContext' generated a temporary value for the property 'OutboxEvent.Id'. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-11-19 10:09:00.715 +03:00 [DBG] Context 'BillingServiceDBContext' started tracking 'OutboxEvent' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-11-19 10:09:00.720 +03:00 [DBG] 'BillingServiceDBContext' generated a temporary value for the property 'AuditEvent.Id'. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-11-19 10:09:00.724 +03:00 [DBG] Context 'BillingServiceDBContext' started tracking 'AuditEvent' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-11-19 10:09:00.728 +03:00 [DBG] SaveChanges starting for 'BillingServiceDBContext'.
2025-11-19 10:09:00.731 +03:00 [DBG] DetectChanges starting for 'BillingServiceDBContext'.
2025-11-19 10:09:00.735 +03:00 [DBG] DetectChanges completed for 'BillingServiceDBContext'.
2025-11-19 10:09:00.738 +03:00 [DBG] Executing 2 update commands as a batch.
2025-11-19 10:09:00.741 +03:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-11-19 10:09:00.745 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-11-19 10:09:00.749 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (3ms).
2025-11-19 10:09:00.753 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (7ms).
2025-11-19 10:09:00.756 +03:00 [DBG] Executing DbCommand [Parameters=[@p0='?' (Size = 100), @p1='?' (Size = 4000), @p2='?' (Size = 50), @p3='?' (DbType = DateTime), @p4='?' (Size = 500), @p5='?' (Size = 20), @p6='?' (Size = 100), @p7='?' (Size = 100), @p8='?' (DbType = Int64), @p9='?' (DbType = DateTime), @p10='?' (Size = 4000), @p11='?' (Size = 300), @p12='?' (Size = 4000), @p13='?' (DbType = Boolean), @p14='?' (Size = 20) (DbType = AnsiString)], CommandType='"Text"', CommandTimeout='30']
SET NOCOUNT ON;
INSERT INTO [audit].[AuditEvents] ([Action], [Changes], [CreatedBy], [CreatedDate], [Description], [EntityId], [EntityType], [UserId])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
INSERT INTO [Outbox_events] ([Aggregate_id], [CreatedDate], [ErrorMsg], [Event_type], [Payload], [Processed], [ProcessingStatus])
OUTPUT INSERTED.[Id]
VALUES (@p8, @p9, @p10, @p11, @p12, @p13, @p14);
2025-11-19 10:09:00.763 +03:00 [INF] Executed DbCommand (7ms) [Parameters=[@p0='?' (Size = 100), @p1='?' (Size = 4000), @p2='?' (Size = 50), @p3='?' (DbType = DateTime), @p4='?' (Size = 500), @p5='?' (Size = 20), @p6='?' (Size = 100), @p7='?' (Size = 100), @p8='?' (DbType = Int64), @p9='?' (DbType = DateTime), @p10='?' (Size = 4000), @p11='?' (Size = 300), @p12='?' (Size = 4000), @p13='?' (DbType = Boolean), @p14='?' (Size = 20) (DbType = AnsiString)], CommandType='"Text"', CommandTimeout='30']
SET NOCOUNT ON;
INSERT INTO [audit].[AuditEvents] ([Action], [Changes], [CreatedBy], [CreatedDate], [Description], [EntityId], [EntityType], [UserId])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
INSERT INTO [Outbox_events] ([Aggregate_id], [CreatedDate], [ErrorMsg], [Event_type], [Payload], [Processed], [ProcessingStatus])
OUTPUT INSERTED.[Id]
VALUES (@p8, @p9, @p10, @p11, @p12, @p13, @p14);
2025-11-19 10:09:00.769 +03:00 [DBG] The foreign key property 'AuditEvent.Id' was detected as changed. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see property values.
2025-11-19 10:09:00.772 +03:00 [DBG] The foreign key property 'OutboxEvent.Id' was detected as changed. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see property values.
2025-11-19 10:09:00.774 +03:00 [DBG] Closing data reader to 'GAC-BillingService' on server '.'.
2025-11-19 10:09:00.776 +03:00 [DBG] A data reader for 'GAC-BillingService' on server '.' is being disposed after spending 7ms reading results.
2025-11-19 10:09:00.780 +03:00 [DBG] An entity of type 'AuditEvent' tracked by 'BillingServiceDBContext' changed state from '"Added"' to '"Unchanged"'. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-11-19 10:09:00.785 +03:00 [DBG] An entity of type 'OutboxEvent' tracked by 'BillingServiceDBContext' changed state from '"Added"' to '"Unchanged"'. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-11-19 10:09:00.788 +03:00 [DBG] SaveChanges completed for 'BillingServiceDBContext' with 2 entities written to the database.
2025-11-19 10:09:00.790 +03:00 [DBG] Committing transaction.
2025-11-19 10:09:00.801 +03:00 [DBG] Committed transaction.
2025-11-19 10:09:00.803 +03:00 [DBG] Closing connection to database 'GAC-BillingService' on server '.'.
2025-11-19 10:09:00.806 +03:00 [DBG] Closed connection to database 'GAC-BillingService' on server '.' (3ms).
2025-11-19 10:09:00.809 +03:00 [DBG] Disposing transaction.
2025-11-19 10:09:00.812 +03:00 [DBG] List of registered output formatters, in the following order: ["Microsoft.AspNetCore.Mvc.Formatters.HttpNoContentOutputFormatter","Microsoft.AspNetCore.Mvc.Formatters.StringOutputFormatter","Microsoft.AspNetCore.Mvc.Formatters.StreamOutputFormatter","Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonOutputFormatter"]
2025-11-19 10:09:00.817 +03:00 [DBG] No information found on request to perform content negotiation.
2025-11-19 10:09:00.819 +03:00 [DBG] Attempting to select the first output formatter in the output formatters list which supports a content type from the explicitly specified content types '["application/json"]'.
2025-11-19 10:09:00.822 +03:00 [DBG] Selected output formatter 'Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonOutputFormatter' and content type 'application/json' to write the response.
2025-11-19 10:09:00.825 +03:00 [INF] Executing OkObjectResult, writing value of type 'BillingSystem.SharedKernel.ApiResponse`1[[System.Int64, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-11-19 10:09:00.828 +03:00 [INF] Executed action BillingSystem.API.Controllers.InvoicesController.Post (BillingSystem.API) in 500.9732ms
2025-11-19 10:09:00.832 +03:00 [INF] Executed endpoint 'BillingSystem.API.Controllers.InvoicesController.Post (BillingSystem.API)'
2025-11-19 10:09:00.835 +03:00 [INF] HTTP POST /api/Invoices responded 200 in 546.2570 ms
2025-11-19 10:09:00.839 +03:00 [DBG] Connection id "0HNH778K4T0FL" completed keep alive response.
2025-11-19 10:09:00.841 +03:00 [DBG] 'BillingServiceDBContext' disposed.
2025-11-19 10:09:00.844 +03:00 [DBG] Disposing connection to database 'GAC-BillingService' on server '.'.
2025-11-19 10:09:00.846 +03:00 [DBG] Disposed connection to database '' on server '' (2ms).
2025-11-19 10:09:00.851 +03:00 [INF] Request finished HTTP/1.1 POST https://localhost:7257/api/Invoices - 200 null application/json; charset=utf-8 583.8217ms
2025-11-19 11:01:57.310 +03:00 [DBG] Registered model binder providers, in the following order: ["Microsoft.AspNetCore.Mvc.ModelBinding.Binders.BinderTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ServicesModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.BodyModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.HeaderModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FloatingPointTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.EnumTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.DateTimeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.SimpleTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.TryParseModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.CancellationTokenModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ByteArrayModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FormFileModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FormCollectionModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.KeyValuePairModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.DictionaryModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ArrayModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.CollectionModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ComplexObjectModelBinderProvider"]
2025-11-19 11:01:57.492 +03:00 [DBG] Hosting starting
2025-11-19 11:01:57.826 +03:00 [DBG] Starting bus instances: IBus
2025-11-19 11:01:57.834 +03:00 [DBG] Starting bus: "rabbitmq://localhost/"
2025-11-19 11:01:57.861 +03:00 [DBG] Middleware loaded
2025-11-19 11:01:57.866 +03:00 [DBG] Middleware loaded. Script /_framework/aspnetcore-browser-refresh.js (16519 B).
2025-11-19 11:01:57.871 +03:00 [DBG] Middleware loaded. Script /_framework/blazor-hotreload.js (799 B).
2025-11-19 11:01:57.889 +03:00 [DBG] Connect: guest@localhost:5672/
2025-11-19 11:01:58.042 +03:00 [DBG] Middleware loaded: DOTNET_MODIFIABLE_ASSEMBLIES=debug, __ASPNETCORE_BROWSER_TOOLS=true
2025-11-19 11:01:58.075 +03:00 [DBG] Connected: guest@localhost:5672/ (address: amqp://localhost:5672, local: 52439)
2025-11-19 11:01:58.145 +03:00 [DBG] Endpoint Ready: "rabbitmq://localhost/ECHGHANNAMLP1_BillingSystemAPI_bus_ytiyyyyh3bcsy6mqbdxnqoxjrr?temporary=true"
2025-11-19 11:01:58.149 +03:00 [INF] Bus started: "rabbitmq://localhost/"
2025-11-19 11:01:58.369 +03:00 [INF] Now listening on: https://localhost:7257
2025-11-19 11:01:58.370 +03:00 [DBG] Connection id "0HNH787KUBQQN" received FIN.
2025-11-19 11:01:58.374 +03:00 [INF] Now listening on: http://localhost:5009
2025-11-19 11:01:58.380 +03:00 [DBG] Loaded hosting startup assembly BillingSystem.API
2025-11-19 11:01:58.383 +03:00 [DBG] Loaded hosting startup assembly Microsoft.WebTools.ApiEndpointDiscovery
2025-11-19 11:01:58.386 +03:00 [DBG] Loaded hosting startup assembly Microsoft.AspNetCore.Watch.BrowserRefresh
2025-11-19 11:01:58.388 +03:00 [DBG] Loaded hosting startup assembly Microsoft.WebTools.BrowserLink.Net
2025-11-19 11:01:58.389 +03:00 [DBG] Connection id "0HNH787KUBQQN" accepted.
2025-11-19 11:01:58.395 +03:00 [DBG] Connection id "0HNH787KUBQQN" started.
2025-11-19 11:01:58.415 +03:00 [DBG] Failed to authenticate HTTPS connection.
System.IO.IOException: Received an unexpected EOF or 0 bytes from the transport stream.
   at System.Net.Security.SslStream.ReceiveHandshakeFrameAsync[TIOAdapter](CancellationToken cancellationToken)
   at System.Net.Security.SslStream.ForceAuthenticationAsync[TIOAdapter](Boolean receiveFirst, Byte[] reAuthenticationData, CancellationToken cancellationToken)
   at System.Net.Security.SslStream.ProcessAuthenticationWithTelemetryAsync(Boolean isAsync, CancellationToken cancellationToken)
   at Microsoft.AspNetCore.Server.Kestrel.Https.Internal.HttpsConnectionMiddleware.OnConnectionAsync(ConnectionContext context)
2025-11-19 11:01:58.449 +03:00 [DBG] Connection id "0HNH787KUBQQN" stopped.
2025-11-19 11:01:58.460 +03:00 [DBG] Connection id "0HNH787KUBQQN" sending FIN because: "The Socket transport's send loop completed gracefully."
2025-11-19 11:01:58.545 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-11-19 11:01:58.548 +03:00 [INF] Hosting environment: Development
2025-11-19 11:01:58.552 +03:00 [INF] Content root path: C:\Repositories\Gac-BillingSystem\src\BillingSystem.API
2025-11-19 11:01:58.555 +03:00 [DBG] Hosting started
2025-11-19 11:01:59.034 +03:00 [DBG] Connection id "0HNH787KUBQQO" accepted.
2025-11-19 11:01:59.037 +03:00 [DBG] Connection id "0HNH787KUBQQO" started.
2025-11-19 11:01:59.107 +03:00 [DBG] Connection 0HNH787KUBQQO established using the following protocol: "Tls13"
2025-11-19 11:01:59.216 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7257/swagger/index.html - null null
2025-11-19 11:01:59.271 +03:00 [DBG] Wildcard detected, all requests with hosts will be allowed.
2025-11-19 11:01:59.297 +03:00 [DBG] No candidates found for the request path '/swagger/index.html'
2025-11-19 11:01:59.301 +03:00 [DBG] Request did not match any endpoints
2025-11-19 11:01:59.373 +03:00 [DBG] Response markup is scheduled to include Browser Link script injection.
2025-11-19 11:01:59.378 +03:00 [DBG] Response markup is scheduled to include browser refresh script injection.
2025-11-19 11:01:59.409 +03:00 [INF] HTTP GET /swagger/index.html responded 200 in 97.1272 ms
2025-11-19 11:01:59.419 +03:00 [DBG] Response markup was updated to include Browser Link script injection.
2025-11-19 11:01:59.423 +03:00 [DBG] Response markup was updated to include browser refresh script injection.
2025-11-19 11:01:59.431 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7257/swagger/index.html - 200 null text/html;charset=utf-8 224.5527ms
2025-11-19 11:01:59.487 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7257/_vs/browserLink - null null
2025-11-19 11:01:59.487 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7257/_framework/aspnetcore-browser-refresh.js - null null
2025-11-19 11:01:59.512 +03:00 [DBG] Script injected: /_framework/aspnetcore-browser-refresh.js
2025-11-19 11:01:59.516 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7257/_framework/aspnetcore-browser-refresh.js - 200 16519 application/javascript; charset=utf-8 30.1078ms
2025-11-19 11:01:59.559 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7257/_vs/browserLink - 200 null text/javascript; charset=UTF-8 72.5841ms
2025-11-19 11:01:59.628 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7257/swagger/v1/swagger.json - null null
2025-11-19 11:01:59.635 +03:00 [DBG] No candidates found for the request path '/swagger/v1/swagger.json'
2025-11-19 11:01:59.638 +03:00 [DBG] Request did not match any endpoints
2025-11-19 11:01:59.660 +03:00 [INF] HTTP GET /swagger/v1/swagger.json responded 200 in 18.9347 ms
2025-11-19 11:01:59.669 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7257/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 41.7347ms
2025-11-19 11:20:15.774 +03:00 [DBG] Connection id "0HNH787KUBQQP" received FIN.
2025-11-19 11:20:15.781 +03:00 [DBG] Connection id "0HNH787KUBQQP" accepted.
2025-11-19 11:20:15.804 +03:00 [DBG] Connection id "0HNH787KUBQQP" started.
2025-11-19 11:20:15.807 +03:00 [DBG] Connection id "0HNH787KUBQQQ" accepted.
2025-11-19 11:20:15.831 +03:00 [DBG] Failed to authenticate HTTPS connection.
System.IO.IOException: Received an unexpected EOF or 0 bytes from the transport stream.
   at System.Net.Security.SslStream.ReceiveHandshakeFrameAsync[TIOAdapter](CancellationToken cancellationToken)
   at System.Net.Security.SslStream.ForceAuthenticationAsync[TIOAdapter](Boolean receiveFirst, Byte[] reAuthenticationData, CancellationToken cancellationToken)
   at System.Net.Security.SslStream.ProcessAuthenticationWithTelemetryAsync(Boolean isAsync, CancellationToken cancellationToken)
   at Microsoft.AspNetCore.Server.Kestrel.Https.Internal.HttpsConnectionMiddleware.OnConnectionAsync(ConnectionContext context)
2025-11-19 11:20:15.832 +03:00 [DBG] Connection id "0HNH787KUBQQQ" started.
2025-11-19 11:20:15.839 +03:00 [DBG] Connection id "0HNH787KUBQQP" stopped.
2025-11-19 11:20:15.844 +03:00 [DBG] Connection id "0HNH787KUBQQP" sending FIN because: "The Socket transport's send loop completed gracefully."
2025-11-19 11:20:15.849 +03:00 [DBG] Connection 0HNH787KUBQQQ established using the following protocol: "Tls13"
2025-11-19 11:20:15.858 +03:00 [INF] Request starting HTTP/1.1 POST https://localhost:7257/api/Invoices - application/json 1394
2025-11-19 11:20:15.870 +03:00 [DBG] 1 candidate(s) found for the request path '/api/Invoices'
2025-11-19 11:20:15.880 +03:00 [DBG] Endpoint 'BillingSystem.API.Controllers.InvoicesController.Post (BillingSystem.API)' with route pattern 'api/Invoices' is valid for the request path '/api/Invoices'
2025-11-19 11:20:15.886 +03:00 [DBG] Request matched endpoint 'BillingSystem.API.Controllers.InvoicesController.Post (BillingSystem.API)'
2025-11-19 11:20:15.893 +03:00 [DBG] Static files was skipped as the request already matched an endpoint.
2025-11-19 11:20:16.478 +03:00 [DBG] An 'IServiceProvider' was created for internal use by Entity Framework.
2025-11-19 11:20:21.963 +03:00 [INF] Executing endpoint 'BillingSystem.API.Controllers.InvoicesController.Post (BillingSystem.API)'
2025-11-19 11:20:22.009 +03:00 [INF] Route matched with {action = "Post", controller = "Invoices"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Post(BillingSystem.Application.Requests.CreateInvoiceRequest) on controller BillingSystem.API.Controllers.InvoicesController (BillingSystem.API).
2025-11-19 11:20:22.016 +03:00 [DBG] Execution plan of authorization filters (in the following order): ["None"]
2025-11-19 11:20:22.021 +03:00 [DBG] Execution plan of resource filters (in the following order): ["None"]
2025-11-19 11:20:22.025 +03:00 [DBG] Execution plan of action filters (in the following order): ["Microsoft.AspNetCore.Mvc.ModelBinding.UnsupportedContentTypeFilter (Order: -3000)","Microsoft.AspNetCore.Mvc.Infrastructure.ModelStateInvalidFilter (Order: -2000)","BillingSystem.API.ActionFilters.AuditBillingRequestsFilter","BillingSystem.API.ActionFilters.IdempotencyFilter (Order: 0)"]
2025-11-19 11:20:22.030 +03:00 [DBG] Execution plan of exception filters (in the following order): ["None"]
2025-11-19 11:20:22.034 +03:00 [DBG] Execution plan of result filters (in the following order): ["Microsoft.AspNetCore.Mvc.Infrastructure.ClientErrorResultFilter (Order: -2000)","Microsoft.AspNetCore.Mvc.ProducesAttribute (Order: 0)","BillingSystem.API.ActionFilters.IdempotencyFilter (Order: 0)"]
2025-11-19 11:20:22.041 +03:00 [DBG] Executing controller factory for controller BillingSystem.API.Controllers.InvoicesController (BillingSystem.API)
2025-11-19 11:20:22.048 +03:00 [WRN] You do not have a valid license key for the Lucky Penny software MediatR. This is allowed for development and testing scenarios. If you are running in production you are required to have a licensed version. Please visit https://luckypennysoftware.com to obtain a valid license.
2025-11-19 11:20:22.093 +03:00 [DBG] Executed controller factory for controller BillingSystem.API.Controllers.InvoicesController (BillingSystem.API)
2025-11-19 11:20:22.117 +03:00 [DBG] Attempting to bind parameter 'invoiceRequest' of type 'BillingSystem.Application.Requests.CreateInvoiceRequest' ...
2025-11-19 11:20:22.124 +03:00 [DBG] Attempting to bind parameter 'invoiceRequest' of type 'BillingSystem.Application.Requests.CreateInvoiceRequest' using the name '' in request data ...
2025-11-19 11:20:22.130 +03:00 [DBG] Selected input formatter 'Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonInputFormatter' for content type 'application/json'.
2025-11-19 11:20:22.177 +03:00 [DBG] Connection id "0HNH787KUBQQQ", Request id "0HNH787KUBQQQ:00000001": started reading request body.
2025-11-19 11:20:22.180 +03:00 [DBG] Connection id "0HNH787KUBQQQ", Request id "0HNH787KUBQQQ:00000001": done reading request body.
2025-11-19 11:20:22.215 +03:00 [DBG] JSON input formatter succeeded, deserializing to type 'BillingSystem.Application.Requests.CreateInvoiceRequest'
2025-11-19 11:20:22.219 +03:00 [DBG] Done attempting to bind parameter 'invoiceRequest' of type 'BillingSystem.Application.Requests.CreateInvoiceRequest'.
2025-11-19 11:20:22.223 +03:00 [DBG] Done attempting to bind parameter 'invoiceRequest' of type 'BillingSystem.Application.Requests.CreateInvoiceRequest'.
2025-11-19 11:20:22.227 +03:00 [DBG] Attempting to validate the bound parameter 'invoiceRequest' of type 'BillingSystem.Application.Requests.CreateInvoiceRequest' ...
2025-11-19 11:20:22.269 +03:00 [DBG] Done attempting to validate the bound parameter 'invoiceRequest' of type 'BillingSystem.Application.Requests.CreateInvoiceRequest'.
2025-11-19 11:20:22.275 +03:00 [DBG] The request has model state errors, returning an error response.
2025-11-19 11:20:22.280 +03:00 [DBG] Request was short circuited at action filter 'Microsoft.AspNetCore.Mvc.Infrastructure.ModelStateInvalidFilter'.
2025-11-19 11:20:22.286 +03:00 [DBG] List of registered output formatters, in the following order: ["Microsoft.AspNetCore.Mvc.Formatters.HttpNoContentOutputFormatter","Microsoft.AspNetCore.Mvc.Formatters.StringOutputFormatter","Microsoft.AspNetCore.Mvc.Formatters.StreamOutputFormatter","Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonOutputFormatter"]
2025-11-19 11:20:22.294 +03:00 [DBG] No information found on request to perform content negotiation.
2025-11-19 11:20:22.296 +03:00 [DBG] Attempting to select the first output formatter in the output formatters list which supports a content type from the explicitly specified content types '["application/json","application/problem+json","application/problem+xml"]'.
2025-11-19 11:20:22.303 +03:00 [DBG] Selected output formatter 'Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonOutputFormatter' and content type 'application/json' to write the response.
2025-11-19 11:20:22.307 +03:00 [INF] Executing BadRequestObjectResult, writing value of type 'Microsoft.AspNetCore.Mvc.ValidationProblemDetails'.
2025-11-19 11:20:22.346 +03:00 [INF] Executed action BillingSystem.API.Controllers.InvoicesController.Post (BillingSystem.API) in 302.3168ms
2025-11-19 11:20:22.351 +03:00 [INF] Executed endpoint 'BillingSystem.API.Controllers.InvoicesController.Post (BillingSystem.API)'
2025-11-19 11:20:22.356 +03:00 [INF] HTTP POST /api/Invoices responded 400 in 6464.1508 ms
2025-11-19 11:20:22.361 +03:00 [DBG] Connection id "0HNH787KUBQQQ" completed keep alive response.
2025-11-19 11:20:22.368 +03:00 [INF] Request finished HTTP/1.1 POST https://localhost:7257/api/Invoices - 400 null application/json; charset=utf-8 6509.7398ms
2025-11-19 11:23:52.200 +03:00 [DBG] Registered model binder providers, in the following order: ["Microsoft.AspNetCore.Mvc.ModelBinding.Binders.BinderTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ServicesModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.BodyModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.HeaderModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FloatingPointTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.EnumTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.DateTimeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.SimpleTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.TryParseModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.CancellationTokenModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ByteArrayModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FormFileModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FormCollectionModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.KeyValuePairModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.DictionaryModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ArrayModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.CollectionModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ComplexObjectModelBinderProvider"]
2025-11-19 11:23:52.406 +03:00 [DBG] Hosting starting
2025-11-19 11:23:52.826 +03:00 [DBG] Starting bus instances: IBus
2025-11-19 11:23:52.835 +03:00 [DBG] Starting bus: "rabbitmq://localhost/"
2025-11-19 11:23:52.866 +03:00 [DBG] Middleware loaded
2025-11-19 11:23:52.871 +03:00 [DBG] Middleware loaded. Script /_framework/aspnetcore-browser-refresh.js (16519 B).
2025-11-19 11:23:52.876 +03:00 [DBG] Middleware loaded. Script /_framework/blazor-hotreload.js (799 B).
2025-11-19 11:23:52.895 +03:00 [DBG] Connect: guest@localhost:5672/
2025-11-19 11:23:53.053 +03:00 [DBG] Middleware loaded: DOTNET_MODIFIABLE_ASSEMBLIES=debug, __ASPNETCORE_BROWSER_TOOLS=true
2025-11-19 11:23:53.111 +03:00 [DBG] Connected: guest@localhost:5672/ (address: amqp://localhost:5672, local: 61882)
2025-11-19 11:23:53.181 +03:00 [DBG] Endpoint Ready: "rabbitmq://localhost/ECHGHANNAMLP1_BillingSystemAPI_bus_9dhoyyyh3bcsyrn6bdxnqt83nx?temporary=true"
2025-11-19 11:23:53.185 +03:00 [INF] Bus started: "rabbitmq://localhost/"
2025-11-19 11:23:53.395 +03:00 [INF] Now listening on: https://localhost:7257
2025-11-19 11:23:53.400 +03:00 [INF] Now listening on: http://localhost:5009
2025-11-19 11:23:53.405 +03:00 [DBG] Loaded hosting startup assembly BillingSystem.API
2025-11-19 11:23:53.409 +03:00 [DBG] Loaded hosting startup assembly Microsoft.WebTools.ApiEndpointDiscovery
2025-11-19 11:23:53.413 +03:00 [DBG] Loaded hosting startup assembly Microsoft.AspNetCore.Watch.BrowserRefresh
2025-11-19 11:23:53.415 +03:00 [DBG] Loaded hosting startup assembly Microsoft.WebTools.BrowserLink.Net
2025-11-19 11:23:53.583 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-11-19 11:23:53.585 +03:00 [INF] Hosting environment: Development
2025-11-19 11:23:53.588 +03:00 [INF] Content root path: C:\Repositories\Gac-BillingSystem\src\BillingSystem.API
2025-11-19 11:23:53.591 +03:00 [DBG] Hosting started
2025-11-19 11:23:53.855 +03:00 [DBG] Connection id "0HNH78JSVPKE6" accepted.
2025-11-19 11:23:53.860 +03:00 [DBG] Connection id "0HNH78JSVPKE6" started.
2025-11-19 11:23:53.860 +03:00 [DBG] Connection id "0HNH78JSVPKE7" accepted.
2025-11-19 11:23:53.868 +03:00 [DBG] Connection id "0HNH78JSVPKE7" started.
2025-11-19 11:23:53.893 +03:00 [DBG] Connection id "0HNH78JSVPKE7" received FIN.
2025-11-19 11:23:53.893 +03:00 [DBG] Connection id "0HNH78JSVPKE6" received FIN.
2025-11-19 11:23:53.916 +03:00 [DBG] Failed to authenticate HTTPS connection.
System.IO.IOException: Received an unexpected EOF or 0 bytes from the transport stream.
   at System.Net.Security.SslStream.ReceiveHandshakeFrameAsync[TIOAdapter](CancellationToken cancellationToken)
   at System.Net.Security.SslStream.ForceAuthenticationAsync[TIOAdapter](Boolean receiveFirst, Byte[] reAuthenticationData, CancellationToken cancellationToken)
   at System.Net.Security.SslStream.ProcessAuthenticationWithTelemetryAsync(Boolean isAsync, CancellationToken cancellationToken)
   at Microsoft.AspNetCore.Server.Kestrel.Https.Internal.HttpsConnectionMiddleware.OnConnectionAsync(ConnectionContext context)
2025-11-19 11:23:53.916 +03:00 [DBG] Failed to authenticate HTTPS connection.
System.IO.IOException: Received an unexpected EOF or 0 bytes from the transport stream.
   at System.Net.Security.SslStream.ReceiveHandshakeFrameAsync[TIOAdapter](CancellationToken cancellationToken)
   at System.Net.Security.SslStream.ForceAuthenticationAsync[TIOAdapter](Boolean receiveFirst, Byte[] reAuthenticationData, CancellationToken cancellationToken)
   at System.Net.Security.SslStream.ProcessAuthenticationWithTelemetryAsync(Boolean isAsync, CancellationToken cancellationToken)
   at Microsoft.AspNetCore.Server.Kestrel.Https.Internal.HttpsConnectionMiddleware.OnConnectionAsync(ConnectionContext context)
2025-11-19 11:23:53.945 +03:00 [DBG] Connection id "0HNH78JSVPKE7" stopped.
2025-11-19 11:23:53.946 +03:00 [DBG] Connection id "0HNH78JSVPKE6" stopped.
2025-11-19 11:23:53.956 +03:00 [DBG] Connection id "0HNH78JSVPKE7" sending FIN because: "The Socket transport's send loop completed gracefully."
2025-11-19 11:23:53.956 +03:00 [DBG] Connection id "0HNH78JSVPKE6" sending FIN because: "The Socket transport's send loop completed gracefully."
2025-11-19 11:23:54.608 +03:00 [DBG] Connection id "0HNH78JSVPKE8" accepted.
2025-11-19 11:23:54.611 +03:00 [DBG] Connection id "0HNH78JSVPKE8" started.
2025-11-19 11:23:54.677 +03:00 [DBG] Connection 0HNH78JSVPKE8 established using the following protocol: "Tls13"
2025-11-19 11:23:54.759 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7257/swagger/index.html - null null
2025-11-19 11:23:54.820 +03:00 [DBG] Wildcard detected, all requests with hosts will be allowed.
2025-11-19 11:23:54.843 +03:00 [DBG] No candidates found for the request path '/swagger/index.html'
2025-11-19 11:23:54.847 +03:00 [DBG] Request did not match any endpoints
2025-11-19 11:23:54.953 +03:00 [DBG] Response markup is scheduled to include Browser Link script injection.
2025-11-19 11:23:54.962 +03:00 [DBG] Response markup is scheduled to include browser refresh script injection.
2025-11-19 11:23:55.001 +03:00 [INF] HTTP GET /swagger/index.html responded 200 in 142.3829 ms
2025-11-19 11:23:55.012 +03:00 [DBG] Response markup was updated to include Browser Link script injection.
2025-11-19 11:23:55.019 +03:00 [DBG] Response markup was updated to include browser refresh script injection.
2025-11-19 11:23:55.028 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7257/swagger/index.html - 200 null text/html;charset=utf-8 277.6189ms
2025-11-19 11:23:55.074 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7257/_framework/aspnetcore-browser-refresh.js - null null
2025-11-19 11:23:55.074 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7257/_vs/browserLink - null null
2025-11-19 11:23:55.109 +03:00 [DBG] Script injected: /_framework/aspnetcore-browser-refresh.js
2025-11-19 11:23:55.116 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7257/_framework/aspnetcore-browser-refresh.js - 200 16519 application/javascript; charset=utf-8 43.4889ms
2025-11-19 11:23:55.211 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7257/_vs/browserLink - 200 null text/javascript; charset=UTF-8 137.1814ms
2025-11-19 11:23:55.316 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7257/swagger/v1/swagger.json - null null
2025-11-19 11:23:55.324 +03:00 [DBG] No candidates found for the request path '/swagger/v1/swagger.json'
2025-11-19 11:23:55.326 +03:00 [DBG] Request did not match any endpoints
2025-11-19 11:23:55.361 +03:00 [INF] HTTP GET /swagger/v1/swagger.json responded 200 in 31.1705 ms
2025-11-19 11:23:55.369 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7257/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 53.4811ms
2025-11-19 11:24:13.063 +03:00 [DBG] Connection id "0HNH78JSVPKE9" accepted.
2025-11-19 11:24:13.064 +03:00 [DBG] Connection id "0HNH78JSVPKE9" received FIN.
2025-11-19 11:24:13.067 +03:00 [DBG] Connection id "0HNH78JSVPKE9" started.
2025-11-19 11:24:13.068 +03:00 [DBG] Connection id "0HNH78JSVPKEA" accepted.
2025-11-19 11:24:13.073 +03:00 [DBG] Failed to authenticate HTTPS connection.
System.IO.IOException: Received an unexpected EOF or 0 bytes from the transport stream.
   at System.Net.Security.SslStream.ReceiveHandshakeFrameAsync[TIOAdapter](CancellationToken cancellationToken)
   at System.Net.Security.SslStream.ForceAuthenticationAsync[TIOAdapter](Boolean receiveFirst, Byte[] reAuthenticationData, CancellationToken cancellationToken)
   at System.Net.Security.SslStream.ProcessAuthenticationWithTelemetryAsync(Boolean isAsync, CancellationToken cancellationToken)
   at Microsoft.AspNetCore.Server.Kestrel.Https.Internal.HttpsConnectionMiddleware.OnConnectionAsync(ConnectionContext context)
2025-11-19 11:24:13.075 +03:00 [DBG] Connection id "0HNH78JSVPKEA" started.
2025-11-19 11:24:13.080 +03:00 [DBG] Connection id "0HNH78JSVPKE9" stopped.
2025-11-19 11:24:13.085 +03:00 [DBG] Connection id "0HNH78JSVPKE9" sending FIN because: "The Socket transport's send loop completed gracefully."
2025-11-19 11:24:13.088 +03:00 [DBG] Connection 0HNH78JSVPKEA established using the following protocol: "Tls13"
2025-11-19 11:24:13.098 +03:00 [INF] Request starting HTTP/1.1 POST https://localhost:7257/api/Invoices - application/json 1387
2025-11-19 11:24:13.112 +03:00 [DBG] 1 candidate(s) found for the request path '/api/Invoices'
2025-11-19 11:24:13.123 +03:00 [DBG] Endpoint 'BillingSystem.API.Controllers.InvoicesController.Post (BillingSystem.API)' with route pattern 'api/Invoices' is valid for the request path '/api/Invoices'
2025-11-19 11:24:13.131 +03:00 [DBG] Request matched endpoint 'BillingSystem.API.Controllers.InvoicesController.Post (BillingSystem.API)'
2025-11-19 11:24:13.138 +03:00 [DBG] Static files was skipped as the request already matched an endpoint.
2025-11-19 11:24:13.318 +03:00 [DBG] An 'IServiceProvider' was created for internal use by Entity Framework.
2025-11-19 11:24:18.815 +03:00 [INF] Executing endpoint 'BillingSystem.API.Controllers.InvoicesController.Post (BillingSystem.API)'
2025-11-19 11:24:18.874 +03:00 [INF] Route matched with {action = "Post", controller = "Invoices"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Post(BillingSystem.Application.Requests.CreateInvoiceRequest) on controller BillingSystem.API.Controllers.InvoicesController (BillingSystem.API).
2025-11-19 11:24:18.886 +03:00 [DBG] Execution plan of authorization filters (in the following order): ["None"]
2025-11-19 11:24:18.892 +03:00 [DBG] Execution plan of resource filters (in the following order): ["None"]
2025-11-19 11:24:18.898 +03:00 [DBG] Execution plan of action filters (in the following order): ["Microsoft.AspNetCore.Mvc.ModelBinding.UnsupportedContentTypeFilter (Order: -3000)","Microsoft.AspNetCore.Mvc.Infrastructure.ModelStateInvalidFilter (Order: -2000)","BillingSystem.API.ActionFilters.AuditBillingRequestsFilter","BillingSystem.API.ActionFilters.IdempotencyFilter (Order: 0)"]
2025-11-19 11:24:18.908 +03:00 [DBG] Execution plan of exception filters (in the following order): ["None"]
2025-11-19 11:24:18.911 +03:00 [DBG] Execution plan of result filters (in the following order): ["Microsoft.AspNetCore.Mvc.Infrastructure.ClientErrorResultFilter (Order: -2000)","Microsoft.AspNetCore.Mvc.ProducesAttribute (Order: 0)","BillingSystem.API.ActionFilters.IdempotencyFilter (Order: 0)"]
2025-11-19 11:24:18.920 +03:00 [DBG] Executing controller factory for controller BillingSystem.API.Controllers.InvoicesController (BillingSystem.API)
2025-11-19 11:24:18.929 +03:00 [WRN] You do not have a valid license key for the Lucky Penny software MediatR. This is allowed for development and testing scenarios. If you are running in production you are required to have a licensed version. Please visit https://luckypennysoftware.com to obtain a valid license.
2025-11-19 11:24:18.979 +03:00 [DBG] Executed controller factory for controller BillingSystem.API.Controllers.InvoicesController (BillingSystem.API)
2025-11-19 11:24:19.006 +03:00 [DBG] Attempting to bind parameter 'invoiceRequest' of type 'BillingSystem.Application.Requests.CreateInvoiceRequest' ...
2025-11-19 11:24:19.016 +03:00 [DBG] Attempting to bind parameter 'invoiceRequest' of type 'BillingSystem.Application.Requests.CreateInvoiceRequest' using the name '' in request data ...
2025-11-19 11:24:19.021 +03:00 [DBG] Selected input formatter 'Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonInputFormatter' for content type 'application/json'.
2025-11-19 11:24:19.069 +03:00 [DBG] Connection id "0HNH78JSVPKEA", Request id "0HNH78JSVPKEA:00000001": started reading request body.
2025-11-19 11:24:19.075 +03:00 [DBG] Connection id "0HNH78JSVPKEA", Request id "0HNH78JSVPKEA:00000001": done reading request body.
2025-11-19 11:24:19.120 +03:00 [DBG] JSON input formatter succeeded, deserializing to type 'BillingSystem.Application.Requests.CreateInvoiceRequest'
2025-11-19 11:24:19.127 +03:00 [DBG] Done attempting to bind parameter 'invoiceRequest' of type 'BillingSystem.Application.Requests.CreateInvoiceRequest'.
2025-11-19 11:24:19.133 +03:00 [DBG] Done attempting to bind parameter 'invoiceRequest' of type 'BillingSystem.Application.Requests.CreateInvoiceRequest'.
2025-11-19 11:24:19.138 +03:00 [DBG] Attempting to validate the bound parameter 'invoiceRequest' of type 'BillingSystem.Application.Requests.CreateInvoiceRequest' ...
2025-11-19 11:24:19.171 +03:00 [DBG] Done attempting to validate the bound parameter 'invoiceRequest' of type 'BillingSystem.Application.Requests.CreateInvoiceRequest'.
2025-11-19 11:24:19.527 +03:00 [DBG] No relationship from 'Invoice' to 'Invoice' has been configured by convention because there are multiple properties on one entity type - {'DiscountedPrimaryInvoice'} that could be matched with the properties on the other entity type - {'InverseDiscountedPrimaryInvoice', 'InversePrimaryInvoice', 'InverseSubstitutionPrimaryInvoice', 'PrimaryInvoice', 'SubstitutionPrimaryInvoice'}. This message can be disregarded if explicit configuration has been specified in 'OnModelCreating'.
2025-11-19 11:24:19.791 +03:00 [DBG] No relationship from 'Invoice' to 'Invoice' has been configured by convention because there are multiple properties on one entity type - {'DiscountedPrimaryInvoice'} that could be matched with the properties on the other entity type - {'InverseDiscountedPrimaryInvoice', 'InversePrimaryInvoice', 'InverseSubstitutionPrimaryInvoice', 'PrimaryInvoice', 'SubstitutionPrimaryInvoice'}. This message can be disregarded if explicit configuration has been specified in 'OnModelCreating'.
2025-11-19 11:24:19.805 +03:00 [DBG] No relationship from 'Invoice' to 'Invoice' has been configured by convention because there are multiple properties on one entity type - {'InversePrimaryInvoice'} that could be matched with the properties on the other entity type - {'InverseSubstitutionPrimaryInvoice', 'PrimaryInvoice', 'SubstitutionPrimaryInvoice'}. This message can be disregarded if explicit configuration has been specified in 'OnModelCreating'.
2025-11-19 11:24:19.818 +03:00 [DBG] No relationship from 'Invoice' to 'Invoice' has been configured by convention because there are multiple properties on one entity type - {'InversePrimaryInvoice'} that could be matched with the properties on the other entity type - {'InverseSubstitutionPrimaryInvoice', 'PrimaryInvoice', 'SubstitutionPrimaryInvoice'}. This message can be disregarded if explicit configuration has been specified in 'OnModelCreating'.
2025-11-19 11:24:20.148 +03:00 [DBG] Entity Framework Core 9.0.9 initialized 'BillingServiceDBContext' using provider 'Microsoft.EntityFrameworkCore.SqlServer:9.0.9' with options: EngineType=SqlServer 
2025-11-19 11:24:20.266 +03:00 [DBG] Compiling query expression: 
'DbSet<Invoice>()
    .AsNoTracking()
    .Any(inv => inv.ExternalId.ToString() == __idempotentKey_0)'
2025-11-19 11:24:20.631 +03:00 [DBG] Generated query execution expression: 
'queryContext => ShapedQueryCompilingExpressionVisitor.SingleAsync<bool>(
    asyncEnumerable: SingleQueryingEnumerable.Create<bool>(
        relationalQueryContext: (RelationalQueryContext)queryContext, 
        relationalCommandResolver: parameters => [LIFTABLE Constant: RelationalCommandCache.QueryExpression(
            Projection Mapping:
                EmptyProjectionMember -> 0
            SELECT EXISTS (
                SELECT 1
                FROM Invoices AS i
                WHERE COALESCE(CONVERT(varchar(36), i.ExternalId), '') == @__idempotentKey_0)) | Resolver: c => new RelationalCommandCache(
            c.Dependencies.MemoryCache, 
            c.RelationalDependencies.QuerySqlGeneratorFactory, 
            c.RelationalDependencies.RelationalParameterBasedSqlProcessorFactory, 
            Projection Mapping:
                EmptyProjectionMember -> 0
            SELECT EXISTS (
                SELECT 1
                FROM Invoices AS i
                WHERE COALESCE(CONVERT(varchar(36), i.ExternalId), '') == @__idempotentKey_0), 
            False, 
            new HashSet<string>(
                new string[]{ }, 
                StringComparer.Ordinal
            )
        )].GetRelationalCommandTemplate(parameters), 
        readerColumns: null, 
        shaper: (queryContext, dataReader, resultContext, resultCoordinator) => 
        {
            bool? value1;
            value1 = dataReader.IsDBNull(0) ? default(bool?) : (bool?)dataReader.GetBoolean(0);
            return (bool)value1;
        }, 
        contextType: BillingSystem.Infrastructure.EF.BillingServiceDBContext, 
        standAloneStateManager: False, 
        detailedErrorsEnabled: False, 
        threadSafetyChecksEnabled: True), 
    cancellationToken: queryContext.CancellationToken)'
2025-11-19 11:24:20.690 +03:00 [DBG] Creating DbConnection.
2025-11-19 11:24:20.718 +03:00 [DBG] Created DbConnection. (24ms).
2025-11-19 11:24:20.724 +03:00 [DBG] Opening connection to database 'GAC-BillingService' on server '.'.
2025-11-19 11:24:21.147 +03:00 [DBG] Opened connection to database 'GAC-BillingService' on server '.'.
2025-11-19 11:24:21.154 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-11-19 11:24:21.165 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (6ms).
2025-11-19 11:24:21.178 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (23ms).
2025-11-19 11:24:21.191 +03:00 [DBG] Executing DbCommand [Parameters=[@__idempotentKey_0='?' (Size = 36) (DbType = AnsiString)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [Invoices] AS [i]
        WHERE CONVERT(varchar(36), [i].[ExternalId]) = @__idempotentKey_0) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2025-11-19 11:24:21.265 +03:00 [INF] Executed DbCommand (75ms) [Parameters=[@__idempotentKey_0='?' (Size = 36) (DbType = AnsiString)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [Invoices] AS [i]
        WHERE CONVERT(varchar(36), [i].[ExternalId]) = @__idempotentKey_0) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2025-11-19 11:24:21.294 +03:00 [DBG] Closing data reader to 'GAC-BillingService' on server '.'.
2025-11-19 11:24:21.309 +03:00 [DBG] A data reader for 'GAC-BillingService' on server '.' is being disposed after spending 30ms reading results.
2025-11-19 11:24:21.318 +03:00 [DBG] Closing connection to database 'GAC-BillingService' on server '.'.
2025-11-19 11:24:21.332 +03:00 [DBG] Closed connection to database 'GAC-BillingService' on server '.' (13ms).
2025-11-19 11:24:21.338 +03:00 [DBG] Request was short circuited at action filter 'BillingSystem.API.ActionFilters.IdempotencyFilter'.
2025-11-19 11:24:21.359 +03:00 [DBG] List of registered output formatters, in the following order: ["Microsoft.AspNetCore.Mvc.Formatters.HttpNoContentOutputFormatter","Microsoft.AspNetCore.Mvc.Formatters.StringOutputFormatter","Microsoft.AspNetCore.Mvc.Formatters.StreamOutputFormatter","Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonOutputFormatter"]
2025-11-19 11:24:21.370 +03:00 [DBG] No information found on request to perform content negotiation.
2025-11-19 11:24:21.373 +03:00 [DBG] Attempting to select the first output formatter in the output formatters list which supports a content type from the explicitly specified content types '["application/json"]'.
2025-11-19 11:24:21.378 +03:00 [DBG] Selected output formatter 'Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonOutputFormatter' and content type 'application/json' to write the response.
2025-11-19 11:24:21.382 +03:00 [INF] Executing ConflictObjectResult, writing value of type 'System.String'.
2025-11-19 11:24:21.401 +03:00 [INF] Executed action BillingSystem.API.Controllers.InvoicesController.Post (BillingSystem.API) in 2478.2378ms
2025-11-19 11:24:21.405 +03:00 [INF] Executed endpoint 'BillingSystem.API.Controllers.InvoicesController.Post (BillingSystem.API)'
2025-11-19 11:24:21.409 +03:00 [INF] HTTP POST /api/Invoices responded 409 in 8272.9006 ms
2025-11-19 11:24:21.414 +03:00 [DBG] Connection id "0HNH78JSVPKEA" completed keep alive response.
2025-11-19 11:24:21.421 +03:00 [DBG] 'BillingServiceDBContext' disposed.
2025-11-19 11:24:21.430 +03:00 [DBG] Disposing connection to database 'GAC-BillingService' on server '.'.
2025-11-19 11:24:21.435 +03:00 [DBG] Disposed connection to database '' on server '' (6ms).
2025-11-19 11:24:21.439 +03:00 [INF] Request finished HTTP/1.1 POST https://localhost:7257/api/Invoices - 409 null application/json; charset=utf-8 8340.2563ms
2025-11-19 11:25:00.004 +03:00 [INF] Request starting HTTP/1.1 POST https://localhost:7257/api/Invoices - application/json 1387
2025-11-19 11:25:00.015 +03:00 [DBG] 1 candidate(s) found for the request path '/api/Invoices'
2025-11-19 11:25:00.024 +03:00 [DBG] Endpoint 'BillingSystem.API.Controllers.InvoicesController.Post (BillingSystem.API)' with route pattern 'api/Invoices' is valid for the request path '/api/Invoices'
2025-11-19 11:25:00.034 +03:00 [DBG] Request matched endpoint 'BillingSystem.API.Controllers.InvoicesController.Post (BillingSystem.API)'
2025-11-19 11:25:00.042 +03:00 [DBG] Static files was skipped as the request already matched an endpoint.
2025-11-19 11:25:00.055 +03:00 [INF] Executing endpoint 'BillingSystem.API.Controllers.InvoicesController.Post (BillingSystem.API)'
2025-11-19 11:25:00.060 +03:00 [INF] Route matched with {action = "Post", controller = "Invoices"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Post(BillingSystem.Application.Requests.CreateInvoiceRequest) on controller BillingSystem.API.Controllers.InvoicesController (BillingSystem.API).
2025-11-19 11:25:00.067 +03:00 [DBG] Execution plan of authorization filters (in the following order): ["None"]
2025-11-19 11:25:00.071 +03:00 [DBG] Execution plan of resource filters (in the following order): ["None"]
2025-11-19 11:25:00.077 +03:00 [DBG] Execution plan of action filters (in the following order): ["Microsoft.AspNetCore.Mvc.ModelBinding.UnsupportedContentTypeFilter (Order: -3000)","Microsoft.AspNetCore.Mvc.Infrastructure.ModelStateInvalidFilter (Order: -2000)","BillingSystem.API.ActionFilters.AuditBillingRequestsFilter","BillingSystem.API.ActionFilters.IdempotencyFilter (Order: 0)"]
2025-11-19 11:25:00.084 +03:00 [DBG] Execution plan of exception filters (in the following order): ["None"]
2025-11-19 11:25:00.088 +03:00 [DBG] Execution plan of result filters (in the following order): ["Microsoft.AspNetCore.Mvc.Infrastructure.ClientErrorResultFilter (Order: -2000)","Microsoft.AspNetCore.Mvc.ProducesAttribute (Order: 0)","BillingSystem.API.ActionFilters.IdempotencyFilter (Order: 0)"]
2025-11-19 11:25:00.094 +03:00 [DBG] Executing controller factory for controller BillingSystem.API.Controllers.InvoicesController (BillingSystem.API)
2025-11-19 11:25:00.100 +03:00 [DBG] Executed controller factory for controller BillingSystem.API.Controllers.InvoicesController (BillingSystem.API)
2025-11-19 11:25:00.103 +03:00 [DBG] Attempting to bind parameter 'invoiceRequest' of type 'BillingSystem.Application.Requests.CreateInvoiceRequest' ...
2025-11-19 11:25:00.108 +03:00 [DBG] Attempting to bind parameter 'invoiceRequest' of type 'BillingSystem.Application.Requests.CreateInvoiceRequest' using the name '' in request data ...
2025-11-19 11:25:00.114 +03:00 [DBG] Selected input formatter 'Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonInputFormatter' for content type 'application/json'.
2025-11-19 11:25:00.118 +03:00 [DBG] Connection id "0HNH78JSVPKEA", Request id "0HNH78JSVPKEA:00000002": started reading request body.
2025-11-19 11:25:00.122 +03:00 [DBG] Connection id "0HNH78JSVPKEA", Request id "0HNH78JSVPKEA:00000002": done reading request body.
2025-11-19 11:25:00.126 +03:00 [DBG] JSON input formatter succeeded, deserializing to type 'BillingSystem.Application.Requests.CreateInvoiceRequest'
2025-11-19 11:25:00.128 +03:00 [DBG] Done attempting to bind parameter 'invoiceRequest' of type 'BillingSystem.Application.Requests.CreateInvoiceRequest'.
2025-11-19 11:25:00.131 +03:00 [DBG] Done attempting to bind parameter 'invoiceRequest' of type 'BillingSystem.Application.Requests.CreateInvoiceRequest'.
2025-11-19 11:25:00.135 +03:00 [DBG] Attempting to validate the bound parameter 'invoiceRequest' of type 'BillingSystem.Application.Requests.CreateInvoiceRequest' ...
2025-11-19 11:25:00.139 +03:00 [DBG] Done attempting to validate the bound parameter 'invoiceRequest' of type 'BillingSystem.Application.Requests.CreateInvoiceRequest'.
2025-11-19 11:25:00.163 +03:00 [DBG] Entity Framework Core 9.0.9 initialized 'BillingServiceDBContext' using provider 'Microsoft.EntityFrameworkCore.SqlServer:9.0.9' with options: EngineType=SqlServer 
2025-11-19 11:25:00.172 +03:00 [DBG] Creating DbConnection.
2025-11-19 11:25:00.175 +03:00 [DBG] Created DbConnection. (2ms).
2025-11-19 11:25:00.178 +03:00 [DBG] Opening connection to database 'GAC-BillingService' on server '.'.
2025-11-19 11:25:00.183 +03:00 [DBG] Opened connection to database 'GAC-BillingService' on server '.'.
2025-11-19 11:25:00.186 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-11-19 11:25:00.189 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (2ms).
2025-11-19 11:25:00.193 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (7ms).
2025-11-19 11:25:00.197 +03:00 [DBG] Executing DbCommand [Parameters=[@__idempotentKey_0='?' (Size = 36) (DbType = AnsiString)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [Invoices] AS [i]
        WHERE CONVERT(varchar(36), [i].[ExternalId]) = @__idempotentKey_0) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2025-11-19 11:25:00.216 +03:00 [INF] Executed DbCommand (19ms) [Parameters=[@__idempotentKey_0='?' (Size = 36) (DbType = AnsiString)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [Invoices] AS [i]
        WHERE CONVERT(varchar(36), [i].[ExternalId]) = @__idempotentKey_0) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2025-11-19 11:25:00.221 +03:00 [DBG] Closing data reader to 'GAC-BillingService' on server '.'.
2025-11-19 11:25:00.224 +03:00 [DBG] A data reader for 'GAC-BillingService' on server '.' is being disposed after spending 3ms reading results.
2025-11-19 11:25:00.230 +03:00 [DBG] Closing connection to database 'GAC-BillingService' on server '.'.
2025-11-19 11:25:00.233 +03:00 [DBG] Closed connection to database 'GAC-BillingService' on server '.' (3ms).
2025-11-19 11:25:00.443 +03:00 [WRN] You do not have a valid license key for the Lucky Penny software AutoMapper. This is allowed for development and testing scenarios. If you are running in production you are required to have a licensed version. Please visit https://luckypennysoftware.com to obtain a valid license.
2025-11-19 11:25:03.702 +03:00 [DBG] Opening connection to database 'GAC-BillingService' on server '.'.
2025-11-19 11:25:03.709 +03:00 [DBG] Opened connection to database 'GAC-BillingService' on server '.'.
2025-11-19 11:25:03.714 +03:00 [DBG] Beginning transaction with isolation level 'Unspecified'.
2025-11-19 11:25:03.731 +03:00 [DBG] Began transaction with isolation level 'ReadCommitted'.
2025-11-19 11:25:05.972 +03:00 [DBG] Compiling query expression: 
'DbSet<InvoiceSequenceValue>().FromSql(EXECUTE dbo.GetNextInvoiceNumber, __p_0)
'
2025-11-19 11:25:06.065 +03:00 [DBG] Generated query execution expression: 
'queryContext => FromSqlQueryingEnumerable.Create<InvoiceSequenceValue>(
    relationalQueryContext: (RelationalQueryContext)queryContext, 
    relationalCommandResolver: parameters => [LIFTABLE Constant: RelationalCommandCache.QueryExpression(
        Projection Mapping:
            EmptyProjectionMember -> Dictionary<IProperty, int> { [Property: InvoiceSequenceValue.Value (long) Required, 0] }
        SELECT b.Value
        FROM EXECUTE dbo.GetNextInvoiceNumber) | Resolver: c => new RelationalCommandCache(
        c.Dependencies.MemoryCache, 
        c.RelationalDependencies.QuerySqlGeneratorFactory, 
        c.RelationalDependencies.RelationalParameterBasedSqlProcessorFactory, 
        Projection Mapping:
            EmptyProjectionMember -> Dictionary<IProperty, int> { [Property: InvoiceSequenceValue.Value (long) Required, 0] }
        SELECT b.Value
        FROM EXECUTE dbo.GetNextInvoiceNumber, 
        False, 
        new HashSet<string>(
            new string[]{ }, 
            StringComparer.Ordinal
        )
    )].GetRelationalCommandTemplate(parameters), 
    readerColumns: null, 
    columnNames: [LIFTABLE Constant: string[] { "Value" } | Resolver: _ => new string[]{ "Value" }], 
    shaper: (queryContext, dataReader, indexMap) => 
    {
        InvoiceSequenceValue entity;
        entity = 
        {
            MaterializationContext materializationContext1;
            IEntityType entityType1;
            InvoiceSequenceValue instance1;
            materializationContext1 = new MaterializationContext(
                [LIFTABLE Constant: ValueBuffer | Resolver: _ => (object)ValueBuffer.Empty], 
                queryContext.Context
            );
            instance1 = default(InvoiceSequenceValue);
            {
                ISnapshot shadowSnapshot1;
                shadowSnapshot1 = [LIFTABLE Constant: Snapshot | Resolver: _ => Snapshot.Empty];
                entityType1 = [LIFTABLE Constant: EntityType: InvoiceSequenceValue Keyless | Resolver: namelessParameter{0} => namelessParameter{0}.Dependencies.Model.FindEntityType("BillingSystem.Domain.Entities.InvoiceSequenceValue")];
                instance1 = switch (entityType1)
                {
                    case [LIFTABLE Constant: EntityType: InvoiceSequenceValue Keyless | Resolver: namelessParameter{1} => namelessParameter{1}.Dependencies.Model.FindEntityType("BillingSystem.Domain.Entities.InvoiceSequenceValue")]: 
                        {
                            return 
                            {
                                InvoiceSequenceValue instance;
                                instance = new InvoiceSequenceValue();
                                instance.<Value>k__BackingField = dataReader.GetInt64(indexMap[0]);
                                (instance is IInjectableService) ? ((IInjectableService)instance).Injected(
                                    context: materializationContext1.Context, 
                                    entity: instance, 
                                    queryTrackingBehavior: TrackAll, 
                                    structuralType: [LIFTABLE Constant: EntityType: InvoiceSequenceValue Keyless | Resolver: namelessParameter{2} => namelessParameter{2}.Dependencies.Model.FindEntityType("BillingSystem.Domain.Entities.InvoiceSequenceValue")]) : default(void);
                                return instance;
                            }}
                    default: 
                        default(InvoiceSequenceValue)
                }
                ;
                return instance1;
            }return instance1;
        };
        return entity;
    }, 
    contextType: BillingSystem.Infrastructure.EF.BillingServiceDBContext, 
    standAloneStateManager: False, 
    detailedErrorsEnabled: False, 
    threadSafetyChecksEnabled: True)'
2025-11-19 11:25:06.078 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-11-19 11:25:06.082 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (3ms).
2025-11-19 11:25:06.087 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (9ms).
2025-11-19 11:25:06.091 +03:00 [DBG] Executing DbCommand [Parameters=[], CommandType='"Text"', CommandTimeout='30']
EXECUTE dbo.GetNextInvoiceNumber
2025-11-19 11:25:06.101 +03:00 [INF] Executed DbCommand (10ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
EXECUTE dbo.GetNextInvoiceNumber
2025-11-19 11:25:06.111 +03:00 [DBG] Closing data reader to 'GAC-BillingService' on server '.'.
2025-11-19 11:25:06.115 +03:00 [DBG] A data reader for 'GAC-BillingService' on server '.' is being disposed after spending 8ms reading results.
2025-11-19 11:25:12.370 +03:00 [DBG] Compiling query expression: 
'DbSet<Customer>()
    .FirstOrDefault(c => c.IdentityNumber == __cutomerIdentityNumber_0)'
2025-11-19 11:25:12.402 +03:00 [DBG] Generated query execution expression: 
'queryContext => SingleQueryingEnumerable.Create<Customer>(
    relationalQueryContext: (RelationalQueryContext)queryContext, 
    relationalCommandResolver: parameters => [LIFTABLE Constant: RelationalCommandCache.QueryExpression(
        Projection Mapping:
            EmptyProjectionMember -> Dictionary<IProperty, int> { [Property: Customer.Id (long) Required PK AfterSave:Throw ValueGenerated.OnAdd, 0], [Property: Customer.AddressBuildingNumber (string) MaxLength(200), 1], [Property: Customer.AddressCity (string) Required MaxLength(200), 2], [Property: Customer.AddressCountry (string) Required MaxLength(200), 3], [Property: Customer.AddressDistrict (string) Required MaxLength(200), 4], [Property: Customer.AddressPostalCode (string) Required MaxLength(50), 5], [Property: Customer.AddressStreet (string) MaxLength(200), 6], [Property: Customer.AddressSubNumber (string) MaxLength(200), 7], [Property: Customer.CreatedBy (string) Required MaxLength(50), 8], [Property: Customer.CreatedDate (DateTime) Required, 9], [Property: Customer.CustomerType (string) Required MaxLength(100), 10], [Property: Customer.EmailAddress (string) MaxLength(80), 11], [Property: Customer.FullName (string) Required MaxLength(500), 12], [Property: Customer.IdentityNumber (string) Required MaxLength(100), 13], [Property: Customer.IdentityType (int?), 14], [Property: Customer.IsDeleted (bool) Required, 15], [Property: Customer.LastUpdatedDate (DateTime?), 16], [Property: Customer.OverpaymentBalance (decimal?), 17], [Property: Customer.PhoneNumber (string) MaxLength(50), 18], [Property: Customer.Vatnumber (string) MaxLength(100), 19] }
        SELECT TOP(1) c.Id, c.Address_BuildingNumber, c.Address_City, c.Address_Country, c.Address_District, c.Address_PostalCode, c.Address_Street, c.Address_SubNumber, c.CreatedBy, c.CreatedDate, c.CustomerType, c.EmailAddress, c.FullName, c.IdentityNumber, c.IdentityType, c.IsDeleted, c.LastUpdatedDate, c.OverpaymentBalance, c.PhoneNumber, c.VATNumber
        FROM Customers AS c
        WHERE c.IdentityNumber == @__cutomerIdentityNumber_0) | Resolver: c => new RelationalCommandCache(
        c.Dependencies.MemoryCache, 
        c.RelationalDependencies.QuerySqlGeneratorFactory, 
        c.RelationalDependencies.RelationalParameterBasedSqlProcessorFactory, 
        Projection Mapping:
            EmptyProjectionMember -> Dictionary<IProperty, int> { [Property: Customer.Id (long) Required PK AfterSave:Throw ValueGenerated.OnAdd, 0], [Property: Customer.AddressBuildingNumber (string) MaxLength(200), 1], [Property: Customer.AddressCity (string) Required MaxLength(200), 2], [Property: Customer.AddressCountry (string) Required MaxLength(200), 3], [Property: Customer.AddressDistrict (string) Required MaxLength(200), 4], [Property: Customer.AddressPostalCode (string) Required MaxLength(50), 5], [Property: Customer.AddressStreet (string) MaxLength(200), 6], [Property: Customer.AddressSubNumber (string) MaxLength(200), 7], [Property: Customer.CreatedBy (string) Required MaxLength(50), 8], [Property: Customer.CreatedDate (DateTime) Required, 9], [Property: Customer.CustomerType (string) Required MaxLength(100), 10], [Property: Customer.EmailAddress (string) MaxLength(80), 11], [Property: Customer.FullName (string) Required MaxLength(500), 12], [Property: Customer.IdentityNumber (string) Required MaxLength(100), 13], [Property: Customer.IdentityType (int?), 14], [Property: Customer.IsDeleted (bool) Required, 15], [Property: Customer.LastUpdatedDate (DateTime?), 16], [Property: Customer.OverpaymentBalance (decimal?), 17], [Property: Customer.PhoneNumber (string) MaxLength(50), 18], [Property: Customer.Vatnumber (string) MaxLength(100), 19] }
        SELECT TOP(1) c.Id, c.Address_BuildingNumber, c.Address_City, c.Address_Country, c.Address_District, c.Address_PostalCode, c.Address_Street, c.Address_SubNumber, c.CreatedBy, c.CreatedDate, c.CustomerType, c.EmailAddress, c.FullName, c.IdentityNumber, c.IdentityType, c.IsDeleted, c.LastUpdatedDate, c.OverpaymentBalance, c.PhoneNumber, c.VATNumber
        FROM Customers AS c
        WHERE c.IdentityNumber == @__cutomerIdentityNumber_0, 
        False, 
        new HashSet<string>(
            new string[]{ }, 
            StringComparer.Ordinal
        )
    )].GetRelationalCommandTemplate(parameters), 
    readerColumns: null, 
    shaper: (queryContext, dataReader, resultContext, resultCoordinator) => 
    {
        Customer entity;
        entity = 
        {
            MaterializationContext materializationContext1;
            IEntityType entityType1;
            Customer instance1;
            InternalEntityEntry entry1;
            bool hasNullKey1;
            materializationContext1 = new MaterializationContext(
                [LIFTABLE Constant: ValueBuffer | Resolver: _ => (object)ValueBuffer.Empty], 
                queryContext.Context
            );
            instance1 = default(Customer);
            entry1 = queryContext.TryGetEntry(
                key: [LIFTABLE Constant: Key: Customer.Id PK | Resolver: c => c.Dependencies.Model.FindEntityType("BillingSystem.Domain.Entities.Customer").FindPrimaryKey()], 
                keyValues: new object[]{ (object)dataReader.GetInt64(0) }, 
                throwOnNullKey: True, 
                hasNullKey: hasNullKey1);
            !(hasNullKey1) ? entry1 != default(InternalEntityEntry) ? 
            {
                entityType1 = entry1.EntityType;
                return instance1 = (Customer)entry1.Entity;
            } : 
            {
                ISnapshot shadowSnapshot1;
                shadowSnapshot1 = [LIFTABLE Constant: Snapshot | Resolver: _ => Snapshot.Empty];
                entityType1 = [LIFTABLE Constant: EntityType: Customer | Resolver: namelessParameter{0} => namelessParameter{0}.Dependencies.Model.FindEntityType("BillingSystem.Domain.Entities.Customer")];
                instance1 = switch (entityType1)
                {
                    case [LIFTABLE Constant: EntityType: Customer | Resolver: namelessParameter{1} => namelessParameter{1}.Dependencies.Model.FindEntityType("BillingSystem.Domain.Entities.Customer")]: 
                        {
                            return 
                            {
                                Customer instance;
                                instance = new Customer();
                                instance.<Id>k__BackingField = dataReader.GetInt64(0);
                                instance.<AddressBuildingNumber>k__BackingField = dataReader.IsDBNull(1) ? default(string) : dataReader.GetString(1);
                                instance.<AddressCity>k__BackingField = dataReader.GetString(2);
                                instance.<AddressCountry>k__BackingField = dataReader.GetString(3);
                                instance.<AddressDistrict>k__BackingField = dataReader.GetString(4);
                                instance.<AddressPostalCode>k__BackingField = dataReader.GetString(5);
                                instance.<AddressStreet>k__BackingField = dataReader.IsDBNull(6) ? default(string) : dataReader.GetString(6);
                                instance.<AddressSubNumber>k__BackingField = dataReader.IsDBNull(7) ? default(string) : dataReader.GetString(7);
                                instance.<CreatedBy>k__BackingField = dataReader.GetString(8);
                                instance.<CreatedDate>k__BackingField = dataReader.GetDateTime(9);
                                instance.<CustomerType>k__BackingField = dataReader.GetString(10);
                                instance.<EmailAddress>k__BackingField = dataReader.IsDBNull(11) ? default(string) : dataReader.GetString(11);
                                instance.<FullName>k__BackingField = dataReader.GetString(12);
                                instance.<IdentityNumber>k__BackingField = dataReader.GetString(13);
                                instance.<IdentityType>k__BackingField = dataReader.IsDBNull(14) ? default(int?) : (int?)dataReader.GetInt32(14);
                                instance.<IsDeleted>k__BackingField = dataReader.GetBoolean(15);
                                instance.<LastUpdatedDate>k__BackingField = dataReader.IsDBNull(16) ? default(DateTime?) : (DateTime?)dataReader.GetDateTime(16);
                                instance.<OverpaymentBalance>k__BackingField = dataReader.IsDBNull(17) ? default(decimal?) : (decimal?)dataReader.GetDecimal(17);
                                instance.<PhoneNumber>k__BackingField = dataReader.IsDBNull(18) ? default(string) : dataReader.GetString(18);
                                instance.<Vatnumber>k__BackingField = dataReader.IsDBNull(19) ? default(string) : dataReader.GetString(19);
                                (instance is IInjectableService) ? ((IInjectableService)instance).Injected(
                                    context: materializationContext1.Context, 
                                    entity: instance, 
                                    queryTrackingBehavior: TrackAll, 
                                    structuralType: [LIFTABLE Constant: EntityType: Customer | Resolver: namelessParameter{2} => namelessParameter{2}.Dependencies.Model.FindEntityType("BillingSystem.Domain.Entities.Customer")]) : default(void);
                                return instance;
                            }}
                    default: 
                        default(Customer)
                }
                ;
                entry1 = entityType1 == default(IEntityType) ? default(InternalEntityEntry) : queryContext.StartTracking(
                    entityType: entityType1, 
                    entity: instance1, 
                    snapshot: shadowSnapshot1);
                return instance1;
            } : default(void);
            return instance1;
        };
        return entity;
    }, 
    contextType: BillingSystem.Infrastructure.EF.BillingServiceDBContext, 
    standAloneStateManager: False, 
    detailedErrorsEnabled: False, 
    threadSafetyChecksEnabled: True)
    .SingleOrDefault()'
2025-11-19 11:25:12.421 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-11-19 11:25:12.429 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (7ms).
2025-11-19 11:25:12.434 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (12ms).
2025-11-19 11:25:12.439 +03:00 [DBG] Executing DbCommand [Parameters=[@__cutomerIdentityNumber_0='?' (Size = 100)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[Id], [c].[Address_BuildingNumber], [c].[Address_City], [c].[Address_Country], [c].[Address_District], [c].[Address_PostalCode], [c].[Address_Street], [c].[Address_SubNumber], [c].[CreatedBy], [c].[CreatedDate], [c].[CustomerType], [c].[EmailAddress], [c].[FullName], [c].[IdentityNumber], [c].[IdentityType], [c].[IsDeleted], [c].[LastUpdatedDate], [c].[OverpaymentBalance], [c].[PhoneNumber], [c].[VATNumber]
FROM [Customers] AS [c]
WHERE [c].[IdentityNumber] = @__cutomerIdentityNumber_0
2025-11-19 11:25:12.448 +03:00 [INF] Executed DbCommand (9ms) [Parameters=[@__cutomerIdentityNumber_0='?' (Size = 100)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[Id], [c].[Address_BuildingNumber], [c].[Address_City], [c].[Address_Country], [c].[Address_District], [c].[Address_PostalCode], [c].[Address_Street], [c].[Address_SubNumber], [c].[CreatedBy], [c].[CreatedDate], [c].[CustomerType], [c].[EmailAddress], [c].[FullName], [c].[IdentityNumber], [c].[IdentityType], [c].[IsDeleted], [c].[LastUpdatedDate], [c].[OverpaymentBalance], [c].[PhoneNumber], [c].[VATNumber]
FROM [Customers] AS [c]
WHERE [c].[IdentityNumber] = @__cutomerIdentityNumber_0
2025-11-19 11:25:12.495 +03:00 [DBG] Context 'BillingServiceDBContext' started tracking 'Customer' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-11-19 11:25:12.582 +03:00 [DBG] Closing data reader to 'GAC-BillingService' on server '.'.
2025-11-19 11:25:12.590 +03:00 [DBG] A data reader for 'GAC-BillingService' on server '.' is being disposed after spending 137ms reading results.
2025-11-19 11:25:18.457 +03:00 [DBG] 'BillingServiceDBContext' generated a temporary value for the property 'Invoice.Id'. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-11-19 11:25:18.561 +03:00 [DBG] Context 'BillingServiceDBContext' started tracking 'Invoice' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-11-19 11:25:18.571 +03:00 [DBG] 'BillingServiceDBContext' generated a temporary value for the property 'InvoicesAttachment.Id'. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-11-19 11:25:18.590 +03:00 [DBG] The navigation 'InvoicesAttachment.Invoice' was detected as changed. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-11-19 11:25:18.600 +03:00 [DBG] Context 'BillingServiceDBContext' started tracking 'InvoicesAttachment' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-11-19 11:25:18.607 +03:00 [DBG] 'BillingServiceDBContext' generated a temporary value for the property 'InvoicesItem.Id'. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-11-19 11:25:18.628 +03:00 [DBG] The navigation 'InvoicesItem.Invoice' was detected as changed. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-11-19 11:25:18.635 +03:00 [DBG] Context 'BillingServiceDBContext' started tracking 'InvoicesItem' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-11-19 11:25:19.235 +03:00 [DBG] SaveChanges starting for 'BillingServiceDBContext'.
2025-11-19 11:25:19.247 +03:00 [DBG] DetectChanges starting for 'BillingServiceDBContext'.
2025-11-19 11:25:19.326 +03:00 [DBG] DetectChanges completed for 'BillingServiceDBContext'.
2025-11-19 11:25:19.444 +03:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-11-19 11:25:19.450 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-11-19 11:25:19.453 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (3ms).
2025-11-19 11:25:19.462 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (12ms).
2025-11-19 11:25:19.468 +03:00 [DBG] Executing DbCommand [Parameters=[@p0='?' (Precision = 18) (DbType = Decimal), @p1='?' (Size = 3000), @p2='?' (Size = 100), @p3='?' (Size = 50), @p4='?' (DbType = DateTime), @p5='?' (Size = 50), @p6='?' (DbType = Int64), @p7='?' (DbType = Int64), @p8='?' (DbType = DateTime), @p9='?' (DbType = Guid), @p10='?' (Size = 50), @p11='?' (DbType = Int32), @p12='?' (DbType = Int32), @p13='?' (DbType = Boolean), @p14='?' (DbType = Boolean), @p15='?' (DbType = Boolean), @p16='?' (DbType = Boolean), @p17='?' (DbType = DateTime), @p18='?' (DbType = DateTime), @p19='?' (Size = 4000), @p20='?' (Size = 100), @p21='?' (Size = 100), @p22='?' (DbType = Int64), @p23='?' (Size = 4000), @p24='?' (DbType = Int64), @p25='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [Invoices] ([Amount], [CancelationReasons], [ClientReferenceNumber], [CreatedBy], [CreatedDate], [Currency], [CustomerID], [DiscountedPrimaryInvoiceID], [DueAt], [ExternalId], [InvoiceNumber], [InvoiceStatus], [InvoiceType], [IsDeleted], [IsDiscounted], [IsSubInvoice], [IsSubstitution], [IssuedAt], [LastUpdatedDate], [Metadata], [PaymentProvider], [PaymentReference], [PrimaryInvoiceID], [ProviderResponse], [SubstitutionPrimaryInvoiceID], [TenantId])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18, @p19, @p20, @p21, @p22, @p23, @p24, @p25);
2025-11-19 11:25:19.483 +03:00 [INF] Executed DbCommand (17ms) [Parameters=[@p0='?' (Precision = 18) (DbType = Decimal), @p1='?' (Size = 3000), @p2='?' (Size = 100), @p3='?' (Size = 50), @p4='?' (DbType = DateTime), @p5='?' (Size = 50), @p6='?' (DbType = Int64), @p7='?' (DbType = Int64), @p8='?' (DbType = DateTime), @p9='?' (DbType = Guid), @p10='?' (Size = 50), @p11='?' (DbType = Int32), @p12='?' (DbType = Int32), @p13='?' (DbType = Boolean), @p14='?' (DbType = Boolean), @p15='?' (DbType = Boolean), @p16='?' (DbType = Boolean), @p17='?' (DbType = DateTime), @p18='?' (DbType = DateTime), @p19='?' (Size = 4000), @p20='?' (Size = 100), @p21='?' (Size = 100), @p22='?' (DbType = Int64), @p23='?' (Size = 4000), @p24='?' (DbType = Int64), @p25='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [Invoices] ([Amount], [CancelationReasons], [ClientReferenceNumber], [CreatedBy], [CreatedDate], [Currency], [CustomerID], [DiscountedPrimaryInvoiceID], [DueAt], [ExternalId], [InvoiceNumber], [InvoiceStatus], [InvoiceType], [IsDeleted], [IsDiscounted], [IsSubInvoice], [IsSubstitution], [IssuedAt], [LastUpdatedDate], [Metadata], [PaymentProvider], [PaymentReference], [PrimaryInvoiceID], [ProviderResponse], [SubstitutionPrimaryInvoiceID], [TenantId])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18, @p19, @p20, @p21, @p22, @p23, @p24, @p25);
2025-11-19 11:25:19.539 +03:00 [DBG] The foreign key property 'Invoice.Id' was detected as changed. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see property values.
2025-11-19 11:25:19.551 +03:00 [DBG] The foreign key property 'InvoicesAttachment.InvoiceId' was detected as changed. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see property values.
2025-11-19 11:25:19.558 +03:00 [DBG] The foreign key property 'InvoicesItem.InvoiceId' was detected as changed. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see property values.
2025-11-19 11:25:19.564 +03:00 [DBG] Closing data reader to 'GAC-BillingService' on server '.'.
2025-11-19 11:25:19.569 +03:00 [DBG] A data reader for 'GAC-BillingService' on server '.' is being disposed after spending 77ms reading results.
2025-11-19 11:25:19.577 +03:00 [DBG] Executing 2 update commands as a batch.
2025-11-19 11:25:19.580 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-11-19 11:25:19.583 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (2ms).
2025-11-19 11:25:19.586 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (6ms).
2025-11-19 11:25:19.589 +03:00 [DBG] Executing DbCommand [Parameters=[@p26='?' (Size = 50), @p27='?' (DbType = DateTime), @p28='?' (Size = 200), @p29='?' (DbType = Int64), @p30='?' (DbType = Boolean), @p31='?' (Precision = 18) (DbType = Decimal), @p32='?' (Size = 50), @p33='?' (DbType = DateTime), @p34='?' (DbType = Int64), @p35='?' (DbType = Boolean), @p36='?' (Size = 500), @p37='?' (Size = 200), @p38='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SET NOCOUNT ON;
INSERT INTO [InvoicesAttachments] ([CreatedBy], [CreatedDate], [FileName], [InvoiceId], [IsDeleted])
OUTPUT INSERTED.[Id]
VALUES (@p26, @p27, @p28, @p29, @p30);
INSERT INTO [InvoicesItems] ([Amount], [CreatedBy], [CreatedDate], [InvoiceId], [IsDeleted], [ItemDesc], [ItemName], [Quantity])
OUTPUT INSERTED.[Id]
VALUES (@p31, @p32, @p33, @p34, @p35, @p36, @p37, @p38);
2025-11-19 11:25:19.599 +03:00 [INF] Executed DbCommand (10ms) [Parameters=[@p26='?' (Size = 50), @p27='?' (DbType = DateTime), @p28='?' (Size = 200), @p29='?' (DbType = Int64), @p30='?' (DbType = Boolean), @p31='?' (Precision = 18) (DbType = Decimal), @p32='?' (Size = 50), @p33='?' (DbType = DateTime), @p34='?' (DbType = Int64), @p35='?' (DbType = Boolean), @p36='?' (Size = 500), @p37='?' (Size = 200), @p38='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SET NOCOUNT ON;
INSERT INTO [InvoicesAttachments] ([CreatedBy], [CreatedDate], [FileName], [InvoiceId], [IsDeleted])
OUTPUT INSERTED.[Id]
VALUES (@p26, @p27, @p28, @p29, @p30);
INSERT INTO [InvoicesItems] ([Amount], [CreatedBy], [CreatedDate], [InvoiceId], [IsDeleted], [ItemDesc], [ItemName], [Quantity])
OUTPUT INSERTED.[Id]
VALUES (@p31, @p32, @p33, @p34, @p35, @p36, @p37, @p38);
2025-11-19 11:25:19.606 +03:00 [DBG] The foreign key property 'InvoicesAttachment.Id' was detected as changed. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see property values.
2025-11-19 11:25:19.612 +03:00 [DBG] The foreign key property 'InvoicesItem.Id' was detected as changed. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see property values.
2025-11-19 11:25:19.616 +03:00 [DBG] Closing data reader to 'GAC-BillingService' on server '.'.
2025-11-19 11:25:19.619 +03:00 [DBG] A data reader for 'GAC-BillingService' on server '.' is being disposed after spending 14ms reading results.
2025-11-19 11:25:19.636 +03:00 [DBG] An entity of type 'Invoice' tracked by 'BillingServiceDBContext' changed state from '"Added"' to '"Unchanged"'. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-11-19 11:25:19.645 +03:00 [DBG] An entity of type 'InvoicesAttachment' tracked by 'BillingServiceDBContext' changed state from '"Added"' to '"Unchanged"'. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-11-19 11:25:19.652 +03:00 [DBG] An entity of type 'InvoicesItem' tracked by 'BillingServiceDBContext' changed state from '"Added"' to '"Unchanged"'. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-11-19 11:25:19.660 +03:00 [DBG] SaveChanges completed for 'BillingServiceDBContext' with 3 entities written to the database.
2025-11-19 12:04:33.592 +03:00 [DBG] Registered model binder providers, in the following order: ["Microsoft.AspNetCore.Mvc.ModelBinding.Binders.BinderTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ServicesModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.BodyModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.HeaderModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FloatingPointTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.EnumTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.DateTimeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.SimpleTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.TryParseModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.CancellationTokenModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ByteArrayModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FormFileModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FormCollectionModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.KeyValuePairModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.DictionaryModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ArrayModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.CollectionModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ComplexObjectModelBinderProvider"]
2025-11-19 12:04:33.916 +03:00 [DBG] Hosting starting
2025-11-19 12:04:34.469 +03:00 [DBG] Starting bus instances: IBus
2025-11-19 12:04:34.480 +03:00 [DBG] Starting bus: "rabbitmq://localhost/"
2025-11-19 12:04:34.533 +03:00 [DBG] Middleware loaded
2025-11-19 12:04:34.543 +03:00 [DBG] Middleware loaded. Script /_framework/aspnetcore-browser-refresh.js (16519 B).
2025-11-19 12:04:34.572 +03:00 [DBG] Middleware loaded. Script /_framework/blazor-hotreload.js (799 B).
2025-11-19 12:04:34.579 +03:00 [DBG] Connect: guest@localhost:5672/
2025-11-19 12:04:34.798 +03:00 [DBG] Middleware loaded: DOTNET_MODIFIABLE_ASSEMBLIES=debug, __ASPNETCORE_BROWSER_TOOLS=true
2025-11-19 12:04:34.832 +03:00 [DBG] Connected: guest@localhost:5672/ (address: amqp://localhost:5672, local: 52617)
2025-11-19 12:04:34.942 +03:00 [DBG] Endpoint Ready: "rabbitmq://localhost/ECHGHANNAMLP1_BillingSystemAPI_bus_ndgyyyyh3bcsys4cbdxnq1iefy?temporary=true"
2025-11-19 12:04:34.948 +03:00 [INF] Bus started: "rabbitmq://localhost/"
2025-11-19 12:04:35.272 +03:00 [INF] Now listening on: https://localhost:7257
2025-11-19 12:04:35.278 +03:00 [INF] Now listening on: http://localhost:5009
2025-11-19 12:04:35.282 +03:00 [DBG] Loaded hosting startup assembly BillingSystem.API
2025-11-19 12:04:35.287 +03:00 [DBG] Loaded hosting startup assembly Microsoft.WebTools.ApiEndpointDiscovery
2025-11-19 12:04:35.291 +03:00 [DBG] Loaded hosting startup assembly Microsoft.AspNetCore.Watch.BrowserRefresh
2025-11-19 12:04:35.295 +03:00 [DBG] Loaded hosting startup assembly Microsoft.WebTools.BrowserLink.Net
2025-11-19 12:04:35.456 +03:00 [DBG] Connection id "0HNH79AKKN684" accepted.
2025-11-19 12:04:35.461 +03:00 [DBG] Connection id "0HNH79AKKN684" started.
2025-11-19 12:04:35.475 +03:00 [DBG] Connection id "0HNH79AKKN685" received FIN.
2025-11-19 12:04:35.475 +03:00 [DBG] Connection id "0HNH79AKKN684" received FIN.
2025-11-19 12:04:35.484 +03:00 [DBG] Connection id "0HNH79AKKN685" accepted.
2025-11-19 12:04:35.489 +03:00 [DBG] Connection id "0HNH79AKKN685" started.
2025-11-19 12:04:35.502 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-11-19 12:04:35.504 +03:00 [DBG] Failed to authenticate HTTPS connection.
System.IO.IOException: Received an unexpected EOF or 0 bytes from the transport stream.
   at System.Net.Security.SslStream.ReceiveHandshakeFrameAsync[TIOAdapter](CancellationToken cancellationToken)
   at System.Net.Security.SslStream.ForceAuthenticationAsync[TIOAdapter](Boolean receiveFirst, Byte[] reAuthenticationData, CancellationToken cancellationToken)
   at System.Net.Security.SslStream.ProcessAuthenticationWithTelemetryAsync(Boolean isAsync, CancellationToken cancellationToken)
   at Microsoft.AspNetCore.Server.Kestrel.Https.Internal.HttpsConnectionMiddleware.OnConnectionAsync(ConnectionContext context)
2025-11-19 12:04:35.506 +03:00 [INF] Hosting environment: Development
2025-11-19 12:04:35.504 +03:00 [DBG] Failed to authenticate HTTPS connection.
System.IO.IOException: Received an unexpected EOF or 0 bytes from the transport stream.
   at System.Net.Security.SslStream.ReceiveHandshakeFrameAsync[TIOAdapter](CancellationToken cancellationToken)
   at System.Net.Security.SslStream.ForceAuthenticationAsync[TIOAdapter](Boolean receiveFirst, Byte[] reAuthenticationData, CancellationToken cancellationToken)
   at System.Net.Security.SslStream.ProcessAuthenticationWithTelemetryAsync(Boolean isAsync, CancellationToken cancellationToken)
   at Microsoft.AspNetCore.Server.Kestrel.Https.Internal.HttpsConnectionMiddleware.OnConnectionAsync(ConnectionContext context)
2025-11-19 12:04:35.536 +03:00 [INF] Content root path: C:\Repositories\Gac-BillingSystem\src\BillingSystem.API
2025-11-19 12:04:35.539 +03:00 [DBG] Connection id "0HNH79AKKN685" stopped.
2025-11-19 12:04:35.545 +03:00 [DBG] Connection id "0HNH79AKKN684" stopped.
2025-11-19 12:04:35.546 +03:00 [DBG] Hosting started
2025-11-19 12:04:35.558 +03:00 [DBG] Connection id "0HNH79AKKN685" sending FIN because: "The Socket transport's send loop completed gracefully."
2025-11-19 12:04:35.558 +03:00 [DBG] Connection id "0HNH79AKKN684" sending FIN because: "The Socket transport's send loop completed gracefully."
2025-11-19 12:04:36.272 +03:00 [DBG] Connection id "0HNH79AKKN686" accepted.
2025-11-19 12:04:36.281 +03:00 [DBG] Connection id "0HNH79AKKN686" started.
2025-11-19 12:04:36.436 +03:00 [DBG] Connection 0HNH79AKKN686 established using the following protocol: "Tls13"
2025-11-19 12:04:36.563 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7257/swagger/index.html - null null
2025-11-19 12:04:36.661 +03:00 [DBG] Wildcard detected, all requests with hosts will be allowed.
2025-11-19 12:04:36.691 +03:00 [DBG] No candidates found for the request path '/swagger/index.html'
2025-11-19 12:04:36.700 +03:00 [DBG] Request did not match any endpoints
2025-11-19 12:04:36.847 +03:00 [DBG] Response markup is scheduled to include Browser Link script injection.
2025-11-19 12:04:36.854 +03:00 [DBG] Response markup is scheduled to include browser refresh script injection.
2025-11-19 12:04:36.893 +03:00 [INF] HTTP GET /swagger/index.html responded 200 in 178.8957 ms
2025-11-19 12:04:36.902 +03:00 [DBG] Response markup was updated to include Browser Link script injection.
2025-11-19 12:04:36.907 +03:00 [DBG] Response markup was updated to include browser refresh script injection.
2025-11-19 12:04:36.916 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7257/swagger/index.html - 200 null text/html;charset=utf-8 367.6197ms
2025-11-19 12:04:36.996 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7257/_vs/browserLink - null null
2025-11-19 12:04:36.996 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7257/_framework/aspnetcore-browser-refresh.js - null null
2025-11-19 12:04:37.027 +03:00 [DBG] Script injected: /_framework/aspnetcore-browser-refresh.js
2025-11-19 12:04:37.033 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7257/_framework/aspnetcore-browser-refresh.js - 200 16519 application/javascript; charset=utf-8 38.2127ms
2025-11-19 12:04:37.093 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7257/_vs/browserLink - 200 null text/javascript; charset=UTF-8 97.32ms
2025-11-19 12:04:37.260 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7257/swagger/v1/swagger.json - null null
2025-11-19 12:04:37.276 +03:00 [DBG] No candidates found for the request path '/swagger/v1/swagger.json'
2025-11-19 12:04:37.282 +03:00 [DBG] Request did not match any endpoints
2025-11-19 12:04:37.319 +03:00 [INF] HTTP GET /swagger/v1/swagger.json responded 200 in 30.9376 ms
2025-11-19 12:04:37.331 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7257/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 72.6532ms
2025-11-19 12:04:43.697 +03:00 [DBG] Connection id "0HNH79AKKN687" accepted.
2025-11-19 12:04:43.699 +03:00 [DBG] Connection id "0HNH79AKKN687" received FIN.
2025-11-19 12:04:43.700 +03:00 [DBG] Connection id "0HNH79AKKN687" started.
2025-11-19 12:04:43.701 +03:00 [DBG] Connection id "0HNH79AKKN688" accepted.
2025-11-19 12:04:43.709 +03:00 [DBG] Failed to authenticate HTTPS connection.
System.IO.IOException: Received an unexpected EOF or 0 bytes from the transport stream.
   at System.Net.Security.SslStream.ReceiveHandshakeFrameAsync[TIOAdapter](CancellationToken cancellationToken)
   at System.Net.Security.SslStream.ForceAuthenticationAsync[TIOAdapter](Boolean receiveFirst, Byte[] reAuthenticationData, CancellationToken cancellationToken)
   at System.Net.Security.SslStream.ProcessAuthenticationWithTelemetryAsync(Boolean isAsync, CancellationToken cancellationToken)
   at Microsoft.AspNetCore.Server.Kestrel.Https.Internal.HttpsConnectionMiddleware.OnConnectionAsync(ConnectionContext context)
2025-11-19 12:04:43.710 +03:00 [DBG] Connection id "0HNH79AKKN688" started.
2025-11-19 12:04:43.716 +03:00 [DBG] Connection id "0HNH79AKKN687" stopped.
2025-11-19 12:04:43.723 +03:00 [DBG] Connection id "0HNH79AKKN687" sending FIN because: "The Socket transport's send loop completed gracefully."
2025-11-19 12:04:43.725 +03:00 [DBG] Connection 0HNH79AKKN688 established using the following protocol: "Tls13"
2025-11-19 12:04:43.734 +03:00 [INF] Request starting HTTP/1.1 POST https://localhost:7257/api/Invoices - application/json 1387
2025-11-19 12:04:43.746 +03:00 [DBG] 1 candidate(s) found for the request path '/api/Invoices'
2025-11-19 12:04:43.757 +03:00 [DBG] Endpoint 'BillingSystem.API.Controllers.InvoicesController.Post (BillingSystem.API)' with route pattern 'api/Invoices' is valid for the request path '/api/Invoices'
2025-11-19 12:04:43.769 +03:00 [DBG] Request matched endpoint 'BillingSystem.API.Controllers.InvoicesController.Post (BillingSystem.API)'
2025-11-19 12:04:43.781 +03:00 [DBG] Static files was skipped as the request already matched an endpoint.
2025-11-19 12:04:44.008 +03:00 [DBG] An 'IServiceProvider' was created for internal use by Entity Framework.
2025-11-19 12:04:49.483 +03:00 [INF] Executing endpoint 'BillingSystem.API.Controllers.InvoicesController.Post (BillingSystem.API)'
2025-11-19 12:04:49.536 +03:00 [INF] Route matched with {action = "Post", controller = "Invoices"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Post(BillingSystem.Application.Requests.CreateInvoiceRequest) on controller BillingSystem.API.Controllers.InvoicesController (BillingSystem.API).
2025-11-19 12:04:49.545 +03:00 [DBG] Execution plan of authorization filters (in the following order): ["None"]
2025-11-19 12:04:49.550 +03:00 [DBG] Execution plan of resource filters (in the following order): ["None"]
2025-11-19 12:04:49.556 +03:00 [DBG] Execution plan of action filters (in the following order): ["Microsoft.AspNetCore.Mvc.ModelBinding.UnsupportedContentTypeFilter (Order: -3000)","Microsoft.AspNetCore.Mvc.Infrastructure.ModelStateInvalidFilter (Order: -2000)","BillingSystem.API.ActionFilters.AuditBillingRequestsFilter","BillingSystem.API.ActionFilters.IdempotencyFilter (Order: 0)"]
2025-11-19 12:04:49.562 +03:00 [DBG] Execution plan of exception filters (in the following order): ["None"]
2025-11-19 12:04:49.566 +03:00 [DBG] Execution plan of result filters (in the following order): ["Microsoft.AspNetCore.Mvc.Infrastructure.ClientErrorResultFilter (Order: -2000)","Microsoft.AspNetCore.Mvc.ProducesAttribute (Order: 0)","BillingSystem.API.ActionFilters.IdempotencyFilter (Order: 0)"]
2025-11-19 12:04:49.578 +03:00 [DBG] Executing controller factory for controller BillingSystem.API.Controllers.InvoicesController (BillingSystem.API)
2025-11-19 12:04:49.591 +03:00 [WRN] You do not have a valid license key for the Lucky Penny software MediatR. This is allowed for development and testing scenarios. If you are running in production you are required to have a licensed version. Please visit https://luckypennysoftware.com to obtain a valid license.
2025-11-19 12:04:49.671 +03:00 [DBG] Executed controller factory for controller BillingSystem.API.Controllers.InvoicesController (BillingSystem.API)
2025-11-19 12:04:49.716 +03:00 [DBG] Attempting to bind parameter 'invoiceRequest' of type 'BillingSystem.Application.Requests.CreateInvoiceRequest' ...
2025-11-19 12:04:49.726 +03:00 [DBG] Attempting to bind parameter 'invoiceRequest' of type 'BillingSystem.Application.Requests.CreateInvoiceRequest' using the name '' in request data ...
2025-11-19 12:04:49.736 +03:00 [DBG] Selected input formatter 'Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonInputFormatter' for content type 'application/json'.
2025-11-19 12:04:49.792 +03:00 [DBG] Connection id "0HNH79AKKN688", Request id "0HNH79AKKN688:00000001": started reading request body.
2025-11-19 12:04:49.798 +03:00 [DBG] Connection id "0HNH79AKKN688", Request id "0HNH79AKKN688:00000001": done reading request body.
2025-11-19 12:04:49.834 +03:00 [DBG] JSON input formatter succeeded, deserializing to type 'BillingSystem.Application.Requests.CreateInvoiceRequest'
2025-11-19 12:04:49.841 +03:00 [DBG] Done attempting to bind parameter 'invoiceRequest' of type 'BillingSystem.Application.Requests.CreateInvoiceRequest'.
2025-11-19 12:04:49.845 +03:00 [DBG] Done attempting to bind parameter 'invoiceRequest' of type 'BillingSystem.Application.Requests.CreateInvoiceRequest'.
2025-11-19 12:04:49.850 +03:00 [DBG] Attempting to validate the bound parameter 'invoiceRequest' of type 'BillingSystem.Application.Requests.CreateInvoiceRequest' ...
2025-11-19 12:04:49.877 +03:00 [DBG] Done attempting to validate the bound parameter 'invoiceRequest' of type 'BillingSystem.Application.Requests.CreateInvoiceRequest'.
2025-11-19 12:04:50.185 +03:00 [DBG] No relationship from 'Invoice' to 'Invoice' has been configured by convention because there are multiple properties on one entity type - {'DiscountedPrimaryInvoice'} that could be matched with the properties on the other entity type - {'InverseDiscountedPrimaryInvoice', 'InversePrimaryInvoice', 'InverseSubstitutionPrimaryInvoice', 'PrimaryInvoice', 'SubstitutionPrimaryInvoice'}. This message can be disregarded if explicit configuration has been specified in 'OnModelCreating'.
2025-11-19 12:04:50.453 +03:00 [DBG] No relationship from 'Invoice' to 'Invoice' has been configured by convention because there are multiple properties on one entity type - {'DiscountedPrimaryInvoice'} that could be matched with the properties on the other entity type - {'InverseDiscountedPrimaryInvoice', 'InversePrimaryInvoice', 'InverseSubstitutionPrimaryInvoice', 'PrimaryInvoice', 'SubstitutionPrimaryInvoice'}. This message can be disregarded if explicit configuration has been specified in 'OnModelCreating'.
2025-11-19 12:04:50.479 +03:00 [DBG] No relationship from 'Invoice' to 'Invoice' has been configured by convention because there are multiple properties on one entity type - {'InversePrimaryInvoice'} that could be matched with the properties on the other entity type - {'InverseSubstitutionPrimaryInvoice', 'PrimaryInvoice', 'SubstitutionPrimaryInvoice'}. This message can be disregarded if explicit configuration has been specified in 'OnModelCreating'.
2025-11-19 12:04:50.498 +03:00 [DBG] No relationship from 'Invoice' to 'Invoice' has been configured by convention because there are multiple properties on one entity type - {'InversePrimaryInvoice'} that could be matched with the properties on the other entity type - {'InverseSubstitutionPrimaryInvoice', 'PrimaryInvoice', 'SubstitutionPrimaryInvoice'}. This message can be disregarded if explicit configuration has been specified in 'OnModelCreating'.
2025-11-19 12:04:50.918 +03:00 [DBG] Entity Framework Core 9.0.9 initialized 'BillingServiceDBContext' using provider 'Microsoft.EntityFrameworkCore.SqlServer:9.0.9' with options: EngineType=SqlServer 
2025-11-19 12:04:51.069 +03:00 [DBG] Compiling query expression: 
'DbSet<Invoice>()
    .AsNoTracking()
    .Any(inv => inv.ExternalId.ToString() == __idempotentKey_0)'
2025-11-19 12:04:51.457 +03:00 [DBG] Generated query execution expression: 
'queryContext => ShapedQueryCompilingExpressionVisitor.SingleAsync<bool>(
    asyncEnumerable: SingleQueryingEnumerable.Create<bool>(
        relationalQueryContext: (RelationalQueryContext)queryContext, 
        relationalCommandResolver: parameters => [LIFTABLE Constant: RelationalCommandCache.QueryExpression(
            Projection Mapping:
                EmptyProjectionMember -> 0
            SELECT EXISTS (
                SELECT 1
                FROM Invoices AS i
                WHERE COALESCE(CONVERT(varchar(36), i.ExternalId), '') == @__idempotentKey_0)) | Resolver: c => new RelationalCommandCache(
            c.Dependencies.MemoryCache, 
            c.RelationalDependencies.QuerySqlGeneratorFactory, 
            c.RelationalDependencies.RelationalParameterBasedSqlProcessorFactory, 
            Projection Mapping:
                EmptyProjectionMember -> 0
            SELECT EXISTS (
                SELECT 1
                FROM Invoices AS i
                WHERE COALESCE(CONVERT(varchar(36), i.ExternalId), '') == @__idempotentKey_0), 
            False, 
            new HashSet<string>(
                new string[]{ }, 
                StringComparer.Ordinal
            )
        )].GetRelationalCommandTemplate(parameters), 
        readerColumns: null, 
        shaper: (queryContext, dataReader, resultContext, resultCoordinator) => 
        {
            bool? value1;
            value1 = dataReader.IsDBNull(0) ? default(bool?) : (bool?)dataReader.GetBoolean(0);
            return (bool)value1;
        }, 
        contextType: BillingSystem.Infrastructure.EF.BillingServiceDBContext, 
        standAloneStateManager: False, 
        detailedErrorsEnabled: False, 
        threadSafetyChecksEnabled: True), 
    cancellationToken: queryContext.CancellationToken)'
2025-11-19 12:04:51.530 +03:00 [DBG] Creating DbConnection.
2025-11-19 12:04:51.558 +03:00 [DBG] Created DbConnection. (24ms).
2025-11-19 12:04:51.566 +03:00 [DBG] Opening connection to database 'GAC-BillingService' on server '.'.
2025-11-19 12:04:51.996 +03:00 [DBG] Opened connection to database 'GAC-BillingService' on server '.'.
2025-11-19 12:04:52.008 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-11-19 12:04:52.026 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (13ms).
2025-11-19 12:04:52.050 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (42ms).
2025-11-19 12:04:52.078 +03:00 [DBG] Executing DbCommand [Parameters=[@__idempotentKey_0='?' (Size = 36) (DbType = AnsiString)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [Invoices] AS [i]
        WHERE CONVERT(varchar(36), [i].[ExternalId]) = @__idempotentKey_0) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2025-11-19 12:04:52.198 +03:00 [INF] Executed DbCommand (128ms) [Parameters=[@__idempotentKey_0='?' (Size = 36) (DbType = AnsiString)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [Invoices] AS [i]
        WHERE CONVERT(varchar(36), [i].[ExternalId]) = @__idempotentKey_0) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2025-11-19 12:04:52.231 +03:00 [DBG] Closing data reader to 'GAC-BillingService' on server '.'.
2025-11-19 12:04:52.259 +03:00 [DBG] A data reader for 'GAC-BillingService' on server '.' is being disposed after spending 40ms reading results.
2025-11-19 12:04:52.275 +03:00 [DBG] Closing connection to database 'GAC-BillingService' on server '.'.
2025-11-19 12:04:52.297 +03:00 [DBG] Closed connection to database 'GAC-BillingService' on server '.' (22ms).
2025-11-19 12:04:52.575 +03:00 [WRN] You do not have a valid license key for the Lucky Penny software AutoMapper. This is allowed for development and testing scenarios. If you are running in production you are required to have a licensed version. Please visit https://luckypennysoftware.com to obtain a valid license.
2025-11-19 12:04:57.721 +03:00 [DBG] Opening connection to database 'GAC-BillingService' on server '.'.
2025-11-19 12:04:57.731 +03:00 [DBG] Opened connection to database 'GAC-BillingService' on server '.'.
2025-11-19 12:04:57.745 +03:00 [DBG] Beginning transaction with isolation level 'Unspecified'.
2025-11-19 12:04:57.773 +03:00 [DBG] Began transaction with isolation level 'ReadCommitted'.
2025-11-19 12:04:58.416 +03:00 [DBG] Compiling query expression: 
'DbSet<InvoiceSequenceValue>().FromSql(EXECUTE dbo.GetNextInvoiceNumber, __p_0)
'
2025-11-19 12:04:58.470 +03:00 [DBG] Generated query execution expression: 
'queryContext => FromSqlQueryingEnumerable.Create<InvoiceSequenceValue>(
    relationalQueryContext: (RelationalQueryContext)queryContext, 
    relationalCommandResolver: parameters => [LIFTABLE Constant: RelationalCommandCache.QueryExpression(
        Projection Mapping:
            EmptyProjectionMember -> Dictionary<IProperty, int> { [Property: InvoiceSequenceValue.Value (long) Required, 0] }
        SELECT b.Value
        FROM EXECUTE dbo.GetNextInvoiceNumber) | Resolver: c => new RelationalCommandCache(
        c.Dependencies.MemoryCache, 
        c.RelationalDependencies.QuerySqlGeneratorFactory, 
        c.RelationalDependencies.RelationalParameterBasedSqlProcessorFactory, 
        Projection Mapping:
            EmptyProjectionMember -> Dictionary<IProperty, int> { [Property: InvoiceSequenceValue.Value (long) Required, 0] }
        SELECT b.Value
        FROM EXECUTE dbo.GetNextInvoiceNumber, 
        False, 
        new HashSet<string>(
            new string[]{ }, 
            StringComparer.Ordinal
        )
    )].GetRelationalCommandTemplate(parameters), 
    readerColumns: null, 
    columnNames: [LIFTABLE Constant: string[] { "Value" } | Resolver: _ => new string[]{ "Value" }], 
    shaper: (queryContext, dataReader, indexMap) => 
    {
        InvoiceSequenceValue entity;
        entity = 
        {
            MaterializationContext materializationContext1;
            IEntityType entityType1;
            InvoiceSequenceValue instance1;
            materializationContext1 = new MaterializationContext(
                [LIFTABLE Constant: ValueBuffer | Resolver: _ => (object)ValueBuffer.Empty], 
                queryContext.Context
            );
            instance1 = default(InvoiceSequenceValue);
            {
                ISnapshot shadowSnapshot1;
                shadowSnapshot1 = [LIFTABLE Constant: Snapshot | Resolver: _ => Snapshot.Empty];
                entityType1 = [LIFTABLE Constant: EntityType: InvoiceSequenceValue Keyless | Resolver: namelessParameter{0} => namelessParameter{0}.Dependencies.Model.FindEntityType("BillingSystem.Domain.Entities.InvoiceSequenceValue")];
                instance1 = switch (entityType1)
                {
                    case [LIFTABLE Constant: EntityType: InvoiceSequenceValue Keyless | Resolver: namelessParameter{1} => namelessParameter{1}.Dependencies.Model.FindEntityType("BillingSystem.Domain.Entities.InvoiceSequenceValue")]: 
                        {
                            return 
                            {
                                InvoiceSequenceValue instance;
                                instance = new InvoiceSequenceValue();
                                instance.<Value>k__BackingField = dataReader.GetInt64(indexMap[0]);
                                (instance is IInjectableService) ? ((IInjectableService)instance).Injected(
                                    context: materializationContext1.Context, 
                                    entity: instance, 
                                    queryTrackingBehavior: TrackAll, 
                                    structuralType: [LIFTABLE Constant: EntityType: InvoiceSequenceValue Keyless | Resolver: namelessParameter{2} => namelessParameter{2}.Dependencies.Model.FindEntityType("BillingSystem.Domain.Entities.InvoiceSequenceValue")]) : default(void);
                                return instance;
                            }}
                    default: 
                        default(InvoiceSequenceValue)
                }
                ;
                return instance1;
            }return instance1;
        };
        return entity;
    }, 
    contextType: BillingSystem.Infrastructure.EF.BillingServiceDBContext, 
    standAloneStateManager: False, 
    detailedErrorsEnabled: False, 
    threadSafetyChecksEnabled: True)'
2025-11-19 12:04:58.483 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-11-19 12:04:58.488 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (4ms).
2025-11-19 12:04:58.493 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (9ms).
2025-11-19 12:04:58.496 +03:00 [DBG] Executing DbCommand [Parameters=[], CommandType='"Text"', CommandTimeout='30']
EXECUTE dbo.GetNextInvoiceNumber
2025-11-19 12:04:58.509 +03:00 [INF] Executed DbCommand (12ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
EXECUTE dbo.GetNextInvoiceNumber
2025-11-19 12:04:58.518 +03:00 [DBG] Closing data reader to 'GAC-BillingService' on server '.'.
2025-11-19 12:04:58.524 +03:00 [DBG] A data reader for 'GAC-BillingService' on server '.' is being disposed after spending 9ms reading results.
2025-11-19 12:05:00.871 +03:00 [DBG] Compiling query expression: 
'DbSet<Customer>()
    .FirstOrDefault(c => c.IdentityNumber == __cutomerIdentityNumber_0)'
2025-11-19 12:05:00.899 +03:00 [DBG] Generated query execution expression: 
'queryContext => SingleQueryingEnumerable.Create<Customer>(
    relationalQueryContext: (RelationalQueryContext)queryContext, 
    relationalCommandResolver: parameters => [LIFTABLE Constant: RelationalCommandCache.QueryExpression(
        Projection Mapping:
            EmptyProjectionMember -> Dictionary<IProperty, int> { [Property: Customer.Id (long) Required PK AfterSave:Throw ValueGenerated.OnAdd, 0], [Property: Customer.AddressBuildingNumber (string) MaxLength(200), 1], [Property: Customer.AddressCity (string) Required MaxLength(200), 2], [Property: Customer.AddressCountry (string) Required MaxLength(200), 3], [Property: Customer.AddressDistrict (string) Required MaxLength(200), 4], [Property: Customer.AddressPostalCode (string) Required MaxLength(50), 5], [Property: Customer.AddressStreet (string) MaxLength(200), 6], [Property: Customer.AddressSubNumber (string) MaxLength(200), 7], [Property: Customer.CreatedBy (string) Required MaxLength(50), 8], [Property: Customer.CreatedDate (DateTime) Required, 9], [Property: Customer.CustomerType (string) Required MaxLength(100), 10], [Property: Customer.EmailAddress (string) MaxLength(80), 11], [Property: Customer.FullName (string) Required MaxLength(500), 12], [Property: Customer.IdentityNumber (string) Required MaxLength(100), 13], [Property: Customer.IdentityType (int?), 14], [Property: Customer.IsDeleted (bool) Required, 15], [Property: Customer.LastUpdatedDate (DateTime?), 16], [Property: Customer.OverpaymentBalance (decimal?), 17], [Property: Customer.PhoneNumber (string) MaxLength(50), 18], [Property: Customer.Vatnumber (string) MaxLength(100), 19] }
        SELECT TOP(1) c.Id, c.Address_BuildingNumber, c.Address_City, c.Address_Country, c.Address_District, c.Address_PostalCode, c.Address_Street, c.Address_SubNumber, c.CreatedBy, c.CreatedDate, c.CustomerType, c.EmailAddress, c.FullName, c.IdentityNumber, c.IdentityType, c.IsDeleted, c.LastUpdatedDate, c.OverpaymentBalance, c.PhoneNumber, c.VATNumber
        FROM Customers AS c
        WHERE c.IdentityNumber == @__cutomerIdentityNumber_0) | Resolver: c => new RelationalCommandCache(
        c.Dependencies.MemoryCache, 
        c.RelationalDependencies.QuerySqlGeneratorFactory, 
        c.RelationalDependencies.RelationalParameterBasedSqlProcessorFactory, 
        Projection Mapping:
            EmptyProjectionMember -> Dictionary<IProperty, int> { [Property: Customer.Id (long) Required PK AfterSave:Throw ValueGenerated.OnAdd, 0], [Property: Customer.AddressBuildingNumber (string) MaxLength(200), 1], [Property: Customer.AddressCity (string) Required MaxLength(200), 2], [Property: Customer.AddressCountry (string) Required MaxLength(200), 3], [Property: Customer.AddressDistrict (string) Required MaxLength(200), 4], [Property: Customer.AddressPostalCode (string) Required MaxLength(50), 5], [Property: Customer.AddressStreet (string) MaxLength(200), 6], [Property: Customer.AddressSubNumber (string) MaxLength(200), 7], [Property: Customer.CreatedBy (string) Required MaxLength(50), 8], [Property: Customer.CreatedDate (DateTime) Required, 9], [Property: Customer.CustomerType (string) Required MaxLength(100), 10], [Property: Customer.EmailAddress (string) MaxLength(80), 11], [Property: Customer.FullName (string) Required MaxLength(500), 12], [Property: Customer.IdentityNumber (string) Required MaxLength(100), 13], [Property: Customer.IdentityType (int?), 14], [Property: Customer.IsDeleted (bool) Required, 15], [Property: Customer.LastUpdatedDate (DateTime?), 16], [Property: Customer.OverpaymentBalance (decimal?), 17], [Property: Customer.PhoneNumber (string) MaxLength(50), 18], [Property: Customer.Vatnumber (string) MaxLength(100), 19] }
        SELECT TOP(1) c.Id, c.Address_BuildingNumber, c.Address_City, c.Address_Country, c.Address_District, c.Address_PostalCode, c.Address_Street, c.Address_SubNumber, c.CreatedBy, c.CreatedDate, c.CustomerType, c.EmailAddress, c.FullName, c.IdentityNumber, c.IdentityType, c.IsDeleted, c.LastUpdatedDate, c.OverpaymentBalance, c.PhoneNumber, c.VATNumber
        FROM Customers AS c
        WHERE c.IdentityNumber == @__cutomerIdentityNumber_0, 
        False, 
        new HashSet<string>(
            new string[]{ }, 
            StringComparer.Ordinal
        )
    )].GetRelationalCommandTemplate(parameters), 
    readerColumns: null, 
    shaper: (queryContext, dataReader, resultContext, resultCoordinator) => 
    {
        Customer entity;
        entity = 
        {
            MaterializationContext materializationContext1;
            IEntityType entityType1;
            Customer instance1;
            InternalEntityEntry entry1;
            bool hasNullKey1;
            materializationContext1 = new MaterializationContext(
                [LIFTABLE Constant: ValueBuffer | Resolver: _ => (object)ValueBuffer.Empty], 
                queryContext.Context
            );
            instance1 = default(Customer);
            entry1 = queryContext.TryGetEntry(
                key: [LIFTABLE Constant: Key: Customer.Id PK | Resolver: c => c.Dependencies.Model.FindEntityType("BillingSystem.Domain.Entities.Customer").FindPrimaryKey()], 
                keyValues: new object[]{ (object)dataReader.GetInt64(0) }, 
                throwOnNullKey: True, 
                hasNullKey: hasNullKey1);
            !(hasNullKey1) ? entry1 != default(InternalEntityEntry) ? 
            {
                entityType1 = entry1.EntityType;
                return instance1 = (Customer)entry1.Entity;
            } : 
            {
                ISnapshot shadowSnapshot1;
                shadowSnapshot1 = [LIFTABLE Constant: Snapshot | Resolver: _ => Snapshot.Empty];
                entityType1 = [LIFTABLE Constant: EntityType: Customer | Resolver: namelessParameter{0} => namelessParameter{0}.Dependencies.Model.FindEntityType("BillingSystem.Domain.Entities.Customer")];
                instance1 = switch (entityType1)
                {
                    case [LIFTABLE Constant: EntityType: Customer | Resolver: namelessParameter{1} => namelessParameter{1}.Dependencies.Model.FindEntityType("BillingSystem.Domain.Entities.Customer")]: 
                        {
                            return 
                            {
                                Customer instance;
                                instance = new Customer();
                                instance.<Id>k__BackingField = dataReader.GetInt64(0);
                                instance.<AddressBuildingNumber>k__BackingField = dataReader.IsDBNull(1) ? default(string) : dataReader.GetString(1);
                                instance.<AddressCity>k__BackingField = dataReader.GetString(2);
                                instance.<AddressCountry>k__BackingField = dataReader.GetString(3);
                                instance.<AddressDistrict>k__BackingField = dataReader.GetString(4);
                                instance.<AddressPostalCode>k__BackingField = dataReader.GetString(5);
                                instance.<AddressStreet>k__BackingField = dataReader.IsDBNull(6) ? default(string) : dataReader.GetString(6);
                                instance.<AddressSubNumber>k__BackingField = dataReader.IsDBNull(7) ? default(string) : dataReader.GetString(7);
                                instance.<CreatedBy>k__BackingField = dataReader.GetString(8);
                                instance.<CreatedDate>k__BackingField = dataReader.GetDateTime(9);
                                instance.<CustomerType>k__BackingField = dataReader.GetString(10);
                                instance.<EmailAddress>k__BackingField = dataReader.IsDBNull(11) ? default(string) : dataReader.GetString(11);
                                instance.<FullName>k__BackingField = dataReader.GetString(12);
                                instance.<IdentityNumber>k__BackingField = dataReader.GetString(13);
                                instance.<IdentityType>k__BackingField = dataReader.IsDBNull(14) ? default(int?) : (int?)dataReader.GetInt32(14);
                                instance.<IsDeleted>k__BackingField = dataReader.GetBoolean(15);
                                instance.<LastUpdatedDate>k__BackingField = dataReader.IsDBNull(16) ? default(DateTime?) : (DateTime?)dataReader.GetDateTime(16);
                                instance.<OverpaymentBalance>k__BackingField = dataReader.IsDBNull(17) ? default(decimal?) : (decimal?)dataReader.GetDecimal(17);
                                instance.<PhoneNumber>k__BackingField = dataReader.IsDBNull(18) ? default(string) : dataReader.GetString(18);
                                instance.<Vatnumber>k__BackingField = dataReader.IsDBNull(19) ? default(string) : dataReader.GetString(19);
                                (instance is IInjectableService) ? ((IInjectableService)instance).Injected(
                                    context: materializationContext1.Context, 
                                    entity: instance, 
                                    queryTrackingBehavior: TrackAll, 
                                    structuralType: [LIFTABLE Constant: EntityType: Customer | Resolver: namelessParameter{2} => namelessParameter{2}.Dependencies.Model.FindEntityType("BillingSystem.Domain.Entities.Customer")]) : default(void);
                                return instance;
                            }}
                    default: 
                        default(Customer)
                }
                ;
                entry1 = entityType1 == default(IEntityType) ? default(InternalEntityEntry) : queryContext.StartTracking(
                    entityType: entityType1, 
                    entity: instance1, 
                    snapshot: shadowSnapshot1);
                return instance1;
            } : default(void);
            return instance1;
        };
        return entity;
    }, 
    contextType: BillingSystem.Infrastructure.EF.BillingServiceDBContext, 
    standAloneStateManager: False, 
    detailedErrorsEnabled: False, 
    threadSafetyChecksEnabled: True)
    .SingleOrDefault()'
2025-11-19 12:05:00.912 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-11-19 12:05:00.914 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (2ms).
2025-11-19 12:05:00.917 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (5ms).
2025-11-19 12:05:00.922 +03:00 [DBG] Executing DbCommand [Parameters=[@__cutomerIdentityNumber_0='?' (Size = 100)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[Id], [c].[Address_BuildingNumber], [c].[Address_City], [c].[Address_Country], [c].[Address_District], [c].[Address_PostalCode], [c].[Address_Street], [c].[Address_SubNumber], [c].[CreatedBy], [c].[CreatedDate], [c].[CustomerType], [c].[EmailAddress], [c].[FullName], [c].[IdentityNumber], [c].[IdentityType], [c].[IsDeleted], [c].[LastUpdatedDate], [c].[OverpaymentBalance], [c].[PhoneNumber], [c].[VATNumber]
FROM [Customers] AS [c]
WHERE [c].[IdentityNumber] = @__cutomerIdentityNumber_0
2025-11-19 12:05:00.929 +03:00 [INF] Executed DbCommand (7ms) [Parameters=[@__cutomerIdentityNumber_0='?' (Size = 100)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[Id], [c].[Address_BuildingNumber], [c].[Address_City], [c].[Address_Country], [c].[Address_District], [c].[Address_PostalCode], [c].[Address_Street], [c].[Address_SubNumber], [c].[CreatedBy], [c].[CreatedDate], [c].[CustomerType], [c].[EmailAddress], [c].[FullName], [c].[IdentityNumber], [c].[IdentityType], [c].[IsDeleted], [c].[LastUpdatedDate], [c].[OverpaymentBalance], [c].[PhoneNumber], [c].[VATNumber]
FROM [Customers] AS [c]
WHERE [c].[IdentityNumber] = @__cutomerIdentityNumber_0
2025-11-19 12:05:00.974 +03:00 [DBG] Context 'BillingServiceDBContext' started tracking 'Customer' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-11-19 12:05:01.042 +03:00 [DBG] Closing data reader to 'GAC-BillingService' on server '.'.
2025-11-19 12:05:01.047 +03:00 [DBG] A data reader for 'GAC-BillingService' on server '.' is being disposed after spending 111ms reading results.
2025-11-19 12:05:06.544 +03:00 [DBG] 'BillingServiceDBContext' generated a temporary value for the property 'Invoice.Id'. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-11-19 12:05:06.660 +03:00 [DBG] Context 'BillingServiceDBContext' started tracking 'Invoice' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-11-19 12:05:06.671 +03:00 [DBG] 'BillingServiceDBContext' generated a temporary value for the property 'InvoicesAttachment.Id'. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-11-19 12:05:06.694 +03:00 [DBG] The navigation 'InvoicesAttachment.Invoice' was detected as changed. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-11-19 12:05:06.705 +03:00 [DBG] Context 'BillingServiceDBContext' started tracking 'InvoicesAttachment' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-11-19 12:05:06.712 +03:00 [DBG] 'BillingServiceDBContext' generated a temporary value for the property 'InvoicesItem.Id'. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-11-19 12:05:06.736 +03:00 [DBG] The navigation 'InvoicesItem.Invoice' was detected as changed. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-11-19 12:05:06.744 +03:00 [DBG] Context 'BillingServiceDBContext' started tracking 'InvoicesItem' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-11-19 12:05:07.397 +03:00 [DBG] SaveChanges starting for 'BillingServiceDBContext'.
2025-11-19 12:05:07.414 +03:00 [DBG] DetectChanges starting for 'BillingServiceDBContext'.
2025-11-19 12:05:07.503 +03:00 [DBG] DetectChanges completed for 'BillingServiceDBContext'.
2025-11-19 12:05:07.600 +03:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-11-19 12:05:07.606 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-11-19 12:05:07.611 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (4ms).
2025-11-19 12:05:07.617 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (10ms).
2025-11-19 12:05:07.622 +03:00 [DBG] Executing DbCommand [Parameters=[@p0='?' (Precision = 18) (DbType = Decimal), @p1='?' (Size = 3000), @p2='?' (Size = 100), @p3='?' (Size = 50), @p4='?' (DbType = DateTime), @p5='?' (Size = 50), @p6='?' (DbType = Int64), @p7='?' (DbType = Int64), @p8='?' (DbType = DateTime), @p9='?' (DbType = Guid), @p10='?' (Size = 50), @p11='?' (DbType = Int32), @p12='?' (DbType = Int32), @p13='?' (DbType = Boolean), @p14='?' (DbType = Boolean), @p15='?' (DbType = Boolean), @p16='?' (DbType = Boolean), @p17='?' (DbType = DateTime), @p18='?' (DbType = DateTime), @p19='?' (Size = 4000), @p20='?' (Size = 100), @p21='?' (Size = 100), @p22='?' (DbType = Int64), @p23='?' (Size = 4000), @p24='?' (DbType = Int64), @p25='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [Invoices] ([Amount], [CancelationReasons], [ClientReferenceNumber], [CreatedBy], [CreatedDate], [Currency], [CustomerID], [DiscountedPrimaryInvoiceID], [DueAt], [ExternalId], [InvoiceNumber], [InvoiceStatus], [InvoiceType], [IsDeleted], [IsDiscounted], [IsSubInvoice], [IsSubstitution], [IssuedAt], [LastUpdatedDate], [Metadata], [PaymentProvider], [PaymentReference], [PrimaryInvoiceID], [ProviderResponse], [SubstitutionPrimaryInvoiceID], [TenantId])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18, @p19, @p20, @p21, @p22, @p23, @p24, @p25);
2025-11-19 12:05:07.639 +03:00 [INF] Executed DbCommand (19ms) [Parameters=[@p0='?' (Precision = 18) (DbType = Decimal), @p1='?' (Size = 3000), @p2='?' (Size = 100), @p3='?' (Size = 50), @p4='?' (DbType = DateTime), @p5='?' (Size = 50), @p6='?' (DbType = Int64), @p7='?' (DbType = Int64), @p8='?' (DbType = DateTime), @p9='?' (DbType = Guid), @p10='?' (Size = 50), @p11='?' (DbType = Int32), @p12='?' (DbType = Int32), @p13='?' (DbType = Boolean), @p14='?' (DbType = Boolean), @p15='?' (DbType = Boolean), @p16='?' (DbType = Boolean), @p17='?' (DbType = DateTime), @p18='?' (DbType = DateTime), @p19='?' (Size = 4000), @p20='?' (Size = 100), @p21='?' (Size = 100), @p22='?' (DbType = Int64), @p23='?' (Size = 4000), @p24='?' (DbType = Int64), @p25='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [Invoices] ([Amount], [CancelationReasons], [ClientReferenceNumber], [CreatedBy], [CreatedDate], [Currency], [CustomerID], [DiscountedPrimaryInvoiceID], [DueAt], [ExternalId], [InvoiceNumber], [InvoiceStatus], [InvoiceType], [IsDeleted], [IsDiscounted], [IsSubInvoice], [IsSubstitution], [IssuedAt], [LastUpdatedDate], [Metadata], [PaymentProvider], [PaymentReference], [PrimaryInvoiceID], [ProviderResponse], [SubstitutionPrimaryInvoiceID], [TenantId])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18, @p19, @p20, @p21, @p22, @p23, @p24, @p25);
2025-11-19 12:05:07.679 +03:00 [DBG] The foreign key property 'Invoice.Id' was detected as changed. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see property values.
2025-11-19 12:05:07.716 +03:00 [DBG] The foreign key property 'InvoicesAttachment.InvoiceId' was detected as changed. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see property values.
2025-11-19 12:05:07.727 +03:00 [DBG] The foreign key property 'InvoicesItem.InvoiceId' was detected as changed. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see property values.
2025-11-19 12:05:07.733 +03:00 [DBG] Closing data reader to 'GAC-BillingService' on server '.'.
2025-11-19 12:05:07.738 +03:00 [DBG] A data reader for 'GAC-BillingService' on server '.' is being disposed after spending 93ms reading results.
2025-11-19 12:05:07.746 +03:00 [DBG] Executing 2 update commands as a batch.
2025-11-19 12:05:07.751 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-11-19 12:05:07.754 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (2ms).
2025-11-19 12:05:07.758 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (6ms).
2025-11-19 12:05:07.761 +03:00 [DBG] Executing DbCommand [Parameters=[@p26='?' (Size = 50), @p27='?' (DbType = DateTime), @p28='?' (Size = 200), @p29='?' (DbType = Int64), @p30='?' (DbType = Boolean), @p31='?' (Precision = 18) (DbType = Decimal), @p32='?' (Size = 50), @p33='?' (DbType = DateTime), @p34='?' (DbType = Int64), @p35='?' (DbType = Boolean), @p36='?' (Size = 500), @p37='?' (Size = 200), @p38='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SET NOCOUNT ON;
INSERT INTO [InvoicesAttachments] ([CreatedBy], [CreatedDate], [FileName], [InvoiceId], [IsDeleted])
OUTPUT INSERTED.[Id]
VALUES (@p26, @p27, @p28, @p29, @p30);
INSERT INTO [InvoicesItems] ([Amount], [CreatedBy], [CreatedDate], [InvoiceId], [IsDeleted], [ItemDesc], [ItemName], [Quantity])
OUTPUT INSERTED.[Id]
VALUES (@p31, @p32, @p33, @p34, @p35, @p36, @p37, @p38);
2025-11-19 12:05:07.771 +03:00 [INF] Executed DbCommand (10ms) [Parameters=[@p26='?' (Size = 50), @p27='?' (DbType = DateTime), @p28='?' (Size = 200), @p29='?' (DbType = Int64), @p30='?' (DbType = Boolean), @p31='?' (Precision = 18) (DbType = Decimal), @p32='?' (Size = 50), @p33='?' (DbType = DateTime), @p34='?' (DbType = Int64), @p35='?' (DbType = Boolean), @p36='?' (Size = 500), @p37='?' (Size = 200), @p38='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SET NOCOUNT ON;
INSERT INTO [InvoicesAttachments] ([CreatedBy], [CreatedDate], [FileName], [InvoiceId], [IsDeleted])
OUTPUT INSERTED.[Id]
VALUES (@p26, @p27, @p28, @p29, @p30);
INSERT INTO [InvoicesItems] ([Amount], [CreatedBy], [CreatedDate], [InvoiceId], [IsDeleted], [ItemDesc], [ItemName], [Quantity])
OUTPUT INSERTED.[Id]
VALUES (@p31, @p32, @p33, @p34, @p35, @p36, @p37, @p38);
2025-11-19 12:05:07.778 +03:00 [DBG] The foreign key property 'InvoicesAttachment.Id' was detected as changed. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see property values.
2025-11-19 12:05:07.782 +03:00 [DBG] The foreign key property 'InvoicesItem.Id' was detected as changed. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see property values.
2025-11-19 12:05:07.786 +03:00 [DBG] Closing data reader to 'GAC-BillingService' on server '.'.
2025-11-19 12:05:07.789 +03:00 [DBG] A data reader for 'GAC-BillingService' on server '.' is being disposed after spending 12ms reading results.
2025-11-19 12:05:07.805 +03:00 [DBG] An entity of type 'Invoice' tracked by 'BillingServiceDBContext' changed state from '"Added"' to '"Unchanged"'. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-11-19 12:05:07.812 +03:00 [DBG] An entity of type 'InvoicesAttachment' tracked by 'BillingServiceDBContext' changed state from '"Added"' to '"Unchanged"'. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-11-19 12:05:07.820 +03:00 [DBG] An entity of type 'InvoicesItem' tracked by 'BillingServiceDBContext' changed state from '"Added"' to '"Unchanged"'. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-11-19 12:05:07.827 +03:00 [DBG] SaveChanges completed for 'BillingServiceDBContext' with 3 entities written to the database.
2025-11-19 12:05:10.695 +03:00 [DBG] 'BillingServiceDBContext' generated a temporary value for the property 'OutboxEvent.Id'. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-11-19 12:05:10.728 +03:00 [DBG] Context 'BillingServiceDBContext' started tracking 'OutboxEvent' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-11-19 12:05:12.147 +03:00 [DBG] 'BillingServiceDBContext' generated a temporary value for the property 'AuditEvent.Id'. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-11-19 12:05:12.183 +03:00 [DBG] Context 'BillingServiceDBContext' started tracking 'AuditEvent' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-11-19 12:05:13.003 +03:00 [DBG] SaveChanges starting for 'BillingServiceDBContext'.
2025-11-19 12:05:13.009 +03:00 [DBG] DetectChanges starting for 'BillingServiceDBContext'.
2025-11-19 12:05:13.026 +03:00 [DBG] DetectChanges completed for 'BillingServiceDBContext'.
2025-11-19 12:05:13.032 +03:00 [DBG] Executing 2 update commands as a batch.
2025-11-19 12:05:13.036 +03:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-11-19 12:05:13.039 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-11-19 12:05:13.043 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (3ms).
2025-11-19 12:05:13.046 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (7ms).
2025-11-19 12:05:13.049 +03:00 [DBG] Executing DbCommand [Parameters=[@p0='?' (Size = 100), @p1='?' (Size = 4000), @p2='?' (Size = 50), @p3='?' (DbType = DateTime), @p4='?' (Size = 500), @p5='?' (Size = 20), @p6='?' (Size = 100), @p7='?' (Size = 100), @p8='?' (DbType = Int64), @p9='?' (DbType = DateTime), @p10='?' (Size = 4000), @p11='?' (Size = 300), @p12='?' (Size = 4000), @p13='?' (DbType = Boolean), @p14='?' (Size = 20) (DbType = AnsiString)], CommandType='"Text"', CommandTimeout='30']
SET NOCOUNT ON;
INSERT INTO [audit].[AuditEvents] ([Action], [Changes], [CreatedBy], [CreatedDate], [Description], [EntityId], [EntityType], [UserId])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
INSERT INTO [Outbox_events] ([Aggregate_id], [CreatedDate], [ErrorMsg], [Event_type], [Payload], [Processed], [ProcessingStatus])
OUTPUT INSERTED.[Id]
VALUES (@p8, @p9, @p10, @p11, @p12, @p13, @p14);
2025-11-19 12:05:13.060 +03:00 [INF] Executed DbCommand (10ms) [Parameters=[@p0='?' (Size = 100), @p1='?' (Size = 4000), @p2='?' (Size = 50), @p3='?' (DbType = DateTime), @p4='?' (Size = 500), @p5='?' (Size = 20), @p6='?' (Size = 100), @p7='?' (Size = 100), @p8='?' (DbType = Int64), @p9='?' (DbType = DateTime), @p10='?' (Size = 4000), @p11='?' (Size = 300), @p12='?' (Size = 4000), @p13='?' (DbType = Boolean), @p14='?' (Size = 20) (DbType = AnsiString)], CommandType='"Text"', CommandTimeout='30']
SET NOCOUNT ON;
INSERT INTO [audit].[AuditEvents] ([Action], [Changes], [CreatedBy], [CreatedDate], [Description], [EntityId], [EntityType], [UserId])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
INSERT INTO [Outbox_events] ([Aggregate_id], [CreatedDate], [ErrorMsg], [Event_type], [Payload], [Processed], [ProcessingStatus])
OUTPUT INSERTED.[Id]
VALUES (@p8, @p9, @p10, @p11, @p12, @p13, @p14);
2025-11-19 12:05:13.090 +03:00 [DBG] The foreign key property 'AuditEvent.Id' was detected as changed. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see property values.
2025-11-19 12:05:13.097 +03:00 [DBG] The foreign key property 'OutboxEvent.Id' was detected as changed. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see property values.
2025-11-19 12:05:13.101 +03:00 [DBG] Closing data reader to 'GAC-BillingService' on server '.'.
2025-11-19 12:05:13.105 +03:00 [DBG] A data reader for 'GAC-BillingService' on server '.' is being disposed after spending 16ms reading results.
2025-11-19 12:05:13.109 +03:00 [DBG] An entity of type 'AuditEvent' tracked by 'BillingServiceDBContext' changed state from '"Added"' to '"Unchanged"'. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-11-19 12:05:13.115 +03:00 [DBG] An entity of type 'OutboxEvent' tracked by 'BillingServiceDBContext' changed state from '"Added"' to '"Unchanged"'. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-11-19 12:05:13.118 +03:00 [DBG] SaveChanges completed for 'BillingServiceDBContext' with 2 entities written to the database.
2025-11-19 12:05:13.774 +03:00 [DBG] Committing transaction.
2025-11-19 12:05:13.801 +03:00 [DBG] Committed transaction.
2025-11-19 12:05:13.809 +03:00 [DBG] Closing connection to database 'GAC-BillingService' on server '.'.
2025-11-19 12:05:13.814 +03:00 [DBG] Closed connection to database 'GAC-BillingService' on server '.' (5ms).
2025-11-19 12:05:18.230 +03:00 [DBG] Disposing transaction.
2025-11-19 12:05:18.247 +03:00 [DBG] List of registered output formatters, in the following order: ["Microsoft.AspNetCore.Mvc.Formatters.HttpNoContentOutputFormatter","Microsoft.AspNetCore.Mvc.Formatters.StringOutputFormatter","Microsoft.AspNetCore.Mvc.Formatters.StreamOutputFormatter","Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonOutputFormatter"]
2025-11-19 12:05:18.256 +03:00 [DBG] No information found on request to perform content negotiation.
2025-11-19 12:05:18.260 +03:00 [DBG] Attempting to select the first output formatter in the output formatters list which supports a content type from the explicitly specified content types '["application/json"]'.
2025-11-19 12:05:18.264 +03:00 [DBG] Selected output formatter 'Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonOutputFormatter' and content type 'application/json' to write the response.
2025-11-19 12:05:18.267 +03:00 [INF] Executing OkObjectResult, writing value of type 'BillingSystem.SharedKernel.ApiResponse`1[[System.Int64, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-11-19 12:05:18.286 +03:00 [INF] Executed action BillingSystem.API.Controllers.InvoicesController.Post (BillingSystem.API) in 28705.5899ms
2025-11-19 12:05:18.292 +03:00 [INF] Executed endpoint 'BillingSystem.API.Controllers.InvoicesController.Post (BillingSystem.API)'
2025-11-19 12:05:18.301 +03:00 [INF] HTTP POST /api/Invoices responded 200 in 34525.4131 ms
2025-11-19 12:05:18.312 +03:00 [DBG] Connection id "0HNH79AKKN688" completed keep alive response.
2025-11-19 12:05:18.320 +03:00 [DBG] 'BillingServiceDBContext' disposed.
2025-11-19 12:05:18.329 +03:00 [DBG] Disposing connection to database 'GAC-BillingService' on server '.'.
2025-11-19 12:05:18.336 +03:00 [DBG] Disposed connection to database '' on server '' (6ms).
2025-11-19 12:05:18.340 +03:00 [INF] Request finished HTTP/1.1 POST https://localhost:7257/api/Invoices - 200 null application/json; charset=utf-8 34606.3858ms
2025-11-19 12:28:40.574 +03:00 [DBG] Connection id "0HNH79AKKN686" received FIN.
2025-11-19 12:28:40.580 +03:00 [DBG] Connection id "0HNH79AKKN686" is closed. The last processed stream ID was 7.
2025-11-19 12:28:40.585 +03:00 [DBG] Connection id "0HNH79AKKN686" sending FIN because: "The Socket transport's send loop completed gracefully."
2025-11-19 12:28:40.591 +03:00 [DBG] The connection queue processing loop for 0HNH79AKKN686 completed.
2025-11-19 12:28:40.597 +03:00 [DBG] Connection id "0HNH79AKKN686" stopped.
2025-11-19 12:36:04.348 +03:00 [DBG] Registered model binder providers, in the following order: ["Microsoft.AspNetCore.Mvc.ModelBinding.Binders.BinderTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ServicesModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.BodyModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.HeaderModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FloatingPointTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.EnumTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.DateTimeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.SimpleTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.TryParseModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.CancellationTokenModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ByteArrayModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FormFileModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FormCollectionModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.KeyValuePairModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.DictionaryModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ArrayModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.CollectionModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ComplexObjectModelBinderProvider"]
2025-11-19 12:36:04.530 +03:00 [DBG] Hosting starting
2025-11-19 12:36:05.056 +03:00 [DBG] Starting bus instances: IBus
2025-11-19 12:36:05.062 +03:00 [DBG] Starting bus: "rabbitmq://localhost/"
2025-11-19 12:36:05.092 +03:00 [DBG] Middleware loaded
2025-11-19 12:36:05.099 +03:00 [DBG] Middleware loaded. Script /_framework/aspnetcore-browser-refresh.js (16519 B).
2025-11-19 12:36:05.113 +03:00 [DBG] Middleware loaded. Script /_framework/blazor-hotreload.js (799 B).
2025-11-19 12:36:05.119 +03:00 [DBG] Connect: guest@localhost:5672/
2025-11-19 12:36:05.301 +03:00 [DBG] Middleware loaded: DOTNET_MODIFIABLE_ASSEMBLIES=debug, __ASPNETCORE_BROWSER_TOOLS=true
2025-11-19 12:36:05.367 +03:00 [DBG] Connected: guest@localhost:5672/ (address: amqp://localhost:5672, local: 64889)
2025-11-19 12:36:05.423 +03:00 [DBG] Endpoint Ready: "rabbitmq://localhost/ECHGHANNAMLP1_BillingSystemAPI_bus_9y3oyyyh3bcsy6wxbdxnquaxrg?temporary=true"
2025-11-19 12:36:05.428 +03:00 [INF] Bus started: "rabbitmq://localhost/"
2025-11-19 12:36:05.645 +03:00 [INF] Now listening on: https://localhost:7257
2025-11-19 12:36:05.650 +03:00 [INF] Now listening on: http://localhost:5009
2025-11-19 12:36:05.652 +03:00 [DBG] Loaded hosting startup assembly BillingSystem.API
2025-11-19 12:36:05.654 +03:00 [DBG] Loaded hosting startup assembly Microsoft.WebTools.ApiEndpointDiscovery
2025-11-19 12:36:05.656 +03:00 [DBG] Loaded hosting startup assembly Microsoft.AspNetCore.Watch.BrowserRefresh
2025-11-19 12:36:05.659 +03:00 [DBG] Loaded hosting startup assembly Microsoft.WebTools.BrowserLink.Net
2025-11-19 12:36:05.696 +03:00 [DBG] Connection id "0HNH79S7VEG43" accepted.
2025-11-19 12:36:05.696 +03:00 [DBG] Connection id "0HNH79S7VEG42" accepted.
2025-11-19 12:36:05.702 +03:00 [DBG] Connection id "0HNH79S7VEG43" started.
2025-11-19 12:36:05.706 +03:00 [DBG] Connection id "0HNH79S7VEG42" started.
2025-11-19 12:36:05.727 +03:00 [DBG] Connection id "0HNH79S7VEG42" received FIN.
2025-11-19 12:36:05.727 +03:00 [DBG] Connection id "0HNH79S7VEG43" received FIN.
2025-11-19 12:36:05.745 +03:00 [DBG] Failed to authenticate HTTPS connection.
System.IO.IOException: Received an unexpected EOF or 0 bytes from the transport stream.
   at System.Net.Security.SslStream.ReceiveHandshakeFrameAsync[TIOAdapter](CancellationToken cancellationToken)
   at System.Net.Security.SslStream.ForceAuthenticationAsync[TIOAdapter](Boolean receiveFirst, Byte[] reAuthenticationData, CancellationToken cancellationToken)
   at System.Net.Security.SslStream.ProcessAuthenticationWithTelemetryAsync(Boolean isAsync, CancellationToken cancellationToken)
   at Microsoft.AspNetCore.Server.Kestrel.Https.Internal.HttpsConnectionMiddleware.OnConnectionAsync(ConnectionContext context)
2025-11-19 12:36:05.745 +03:00 [DBG] Failed to authenticate HTTPS connection.
System.IO.IOException: Received an unexpected EOF or 0 bytes from the transport stream.
   at System.Net.Security.SslStream.ReceiveHandshakeFrameAsync[TIOAdapter](CancellationToken cancellationToken)
   at System.Net.Security.SslStream.ForceAuthenticationAsync[TIOAdapter](Boolean receiveFirst, Byte[] reAuthenticationData, CancellationToken cancellationToken)
   at System.Net.Security.SslStream.ProcessAuthenticationWithTelemetryAsync(Boolean isAsync, CancellationToken cancellationToken)
   at Microsoft.AspNetCore.Server.Kestrel.Https.Internal.HttpsConnectionMiddleware.OnConnectionAsync(ConnectionContext context)
2025-11-19 12:36:05.777 +03:00 [DBG] Connection id "0HNH79S7VEG43" stopped.
2025-11-19 12:36:05.779 +03:00 [DBG] Connection id "0HNH79S7VEG42" stopped.
2025-11-19 12:36:05.791 +03:00 [DBG] Connection id "0HNH79S7VEG43" sending FIN because: "The Socket transport's send loop completed gracefully."
2025-11-19 12:36:05.791 +03:00 [DBG] Connection id "0HNH79S7VEG42" sending FIN because: "The Socket transport's send loop completed gracefully."
2025-11-19 12:36:05.853 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-11-19 12:36:05.857 +03:00 [INF] Hosting environment: Development
2025-11-19 12:36:05.866 +03:00 [INF] Content root path: C:\Repositories\Gac-BillingSystem\src\BillingSystem.API
2025-11-19 12:36:05.915 +03:00 [DBG] Hosting started
2025-11-19 12:36:06.498 +03:00 [DBG] Connection id "0HNH79S7VEG44" accepted.
2025-11-19 12:36:06.583 +03:00 [DBG] Connection id "0HNH79S7VEG44" started.
2025-11-19 12:36:06.686 +03:00 [DBG] Connection 0HNH79S7VEG44 established using the following protocol: "Tls13"
2025-11-19 12:36:06.785 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7257/swagger/index.html - null null
2025-11-19 12:36:06.845 +03:00 [DBG] Wildcard detected, all requests with hosts will be allowed.
2025-11-19 12:36:06.870 +03:00 [DBG] No candidates found for the request path '/swagger/index.html'
2025-11-19 12:36:06.875 +03:00 [DBG] Request did not match any endpoints
2025-11-19 12:36:06.974 +03:00 [DBG] Response markup is scheduled to include Browser Link script injection.
2025-11-19 12:36:06.979 +03:00 [DBG] Response markup is scheduled to include browser refresh script injection.
2025-11-19 12:36:07.005 +03:00 [INF] HTTP GET /swagger/index.html responded 200 in 121.4088 ms
2025-11-19 12:36:07.012 +03:00 [DBG] Response markup was updated to include Browser Link script injection.
2025-11-19 12:36:07.015 +03:00 [DBG] Response markup was updated to include browser refresh script injection.
2025-11-19 12:36:07.022 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7257/swagger/index.html - 200 null text/html;charset=utf-8 248.9228ms
2025-11-19 12:36:07.062 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7257/_framework/aspnetcore-browser-refresh.js - null null
2025-11-19 12:36:07.076 +03:00 [DBG] Script injected: /_framework/aspnetcore-browser-refresh.js
2025-11-19 12:36:07.081 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7257/_framework/aspnetcore-browser-refresh.js - 200 16519 application/javascript; charset=utf-8 19.3278ms
2025-11-19 12:36:07.091 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7257/_vs/browserLink - null null
2025-11-19 12:36:07.157 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7257/_vs/browserLink - 200 null text/javascript; charset=UTF-8 66.5216ms
2025-11-19 12:36:07.231 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7257/swagger/v1/swagger.json - null null
2025-11-19 12:36:07.238 +03:00 [DBG] No candidates found for the request path '/swagger/v1/swagger.json'
2025-11-19 12:36:07.241 +03:00 [DBG] Request did not match any endpoints
2025-11-19 12:36:07.262 +03:00 [INF] HTTP GET /swagger/v1/swagger.json responded 200 in 17.7526 ms
2025-11-19 12:36:07.269 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7257/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 38.6899ms
2025-11-19 12:38:45.968 +03:00 [DBG] Registered model binder providers, in the following order: ["Microsoft.AspNetCore.Mvc.ModelBinding.Binders.BinderTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ServicesModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.BodyModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.HeaderModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FloatingPointTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.EnumTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.DateTimeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.SimpleTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.TryParseModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.CancellationTokenModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ByteArrayModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FormFileModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FormCollectionModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.KeyValuePairModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.DictionaryModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ArrayModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.CollectionModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ComplexObjectModelBinderProvider"]
2025-11-19 12:38:46.423 +03:00 [DBG] Hosting starting
2025-11-19 12:38:46.893 +03:00 [DBG] Starting bus instances: IBus
2025-11-19 12:38:46.901 +03:00 [DBG] Starting bus: "rabbitmq://localhost/"
2025-11-19 12:38:46.938 +03:00 [DBG] Middleware loaded
2025-11-19 12:38:46.944 +03:00 [DBG] Middleware loaded. Script /_framework/aspnetcore-browser-refresh.js (16519 B).
2025-11-19 12:38:46.949 +03:00 [DBG] Middleware loaded. Script /_framework/blazor-hotreload.js (799 B).
2025-11-19 12:38:46.969 +03:00 [DBG] Connect: guest@localhost:5672/
2025-11-19 12:38:47.172 +03:00 [DBG] Middleware loaded: DOTNET_MODIFIABLE_ASSEMBLIES=debug, __ASPNETCORE_BROWSER_TOOLS=true
2025-11-19 12:38:47.205 +03:00 [DBG] Connected: guest@localhost:5672/ (address: amqp://localhost:5672, local: 64373)
2025-11-19 12:38:47.263 +03:00 [DBG] Endpoint Ready: "rabbitmq://localhost/ECHGHANNAMLP1_BillingSystemAPI_bus_8d3yyyyh3bcsb4rtbdxnqu5x83?temporary=true"
2025-11-19 12:38:47.267 +03:00 [INF] Bus started: "rabbitmq://localhost/"
2025-11-19 12:38:47.529 +03:00 [INF] Now listening on: https://localhost:7257
2025-11-19 12:38:47.533 +03:00 [INF] Now listening on: http://localhost:5009
2025-11-19 12:38:47.536 +03:00 [DBG] Loaded hosting startup assembly BillingSystem.API
2025-11-19 12:38:47.539 +03:00 [DBG] Loaded hosting startup assembly Microsoft.WebTools.ApiEndpointDiscovery
2025-11-19 12:38:47.541 +03:00 [DBG] Loaded hosting startup assembly Microsoft.AspNetCore.Watch.BrowserRefresh
2025-11-19 12:38:47.544 +03:00 [DBG] Loaded hosting startup assembly Microsoft.WebTools.BrowserLink.Net
2025-11-19 12:38:47.681 +03:00 [DBG] Connection id "0HNH79TO88F82" accepted.
2025-11-19 12:38:47.685 +03:00 [DBG] Connection id "0HNH79TO88F82" started.
2025-11-19 12:38:47.697 +03:00 [DBG] Connection id "0HNH79TO88F82" received FIN.
2025-11-19 12:38:47.721 +03:00 [DBG] Failed to authenticate HTTPS connection.
System.IO.IOException: Received an unexpected EOF or 0 bytes from the transport stream.
   at System.Net.Security.SslStream.ReceiveHandshakeFrameAsync[TIOAdapter](CancellationToken cancellationToken)
   at System.Net.Security.SslStream.ForceAuthenticationAsync[TIOAdapter](Boolean receiveFirst, Byte[] reAuthenticationData, CancellationToken cancellationToken)
   at System.Net.Security.SslStream.ProcessAuthenticationWithTelemetryAsync(Boolean isAsync, CancellationToken cancellationToken)
   at Microsoft.AspNetCore.Server.Kestrel.Https.Internal.HttpsConnectionMiddleware.OnConnectionAsync(ConnectionContext context)
2025-11-19 12:38:47.724 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-11-19 12:38:47.750 +03:00 [INF] Hosting environment: Development
2025-11-19 12:38:47.752 +03:00 [INF] Content root path: C:\Repositories\Gac-BillingSystem\src\BillingSystem.API
2025-11-19 12:38:47.753 +03:00 [DBG] Connection id "0HNH79TO88F82" stopped.
2025-11-19 12:38:47.755 +03:00 [DBG] Hosting started
2025-11-19 12:38:47.766 +03:00 [DBG] Connection id "0HNH79TO88F82" sending FIN because: "The Socket transport's send loop completed gracefully."
2025-11-19 12:38:48.486 +03:00 [DBG] Connection id "0HNH79TO88F83" accepted.
2025-11-19 12:38:48.490 +03:00 [DBG] Connection id "0HNH79TO88F83" started.
2025-11-19 12:38:48.559 +03:00 [DBG] Connection 0HNH79TO88F83 established using the following protocol: "Tls13"
2025-11-19 12:38:48.652 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7257/swagger/index.html - null null
2025-11-19 12:38:48.739 +03:00 [DBG] Wildcard detected, all requests with hosts will be allowed.
2025-11-19 12:38:48.771 +03:00 [DBG] No candidates found for the request path '/swagger/index.html'
2025-11-19 12:38:48.778 +03:00 [DBG] Request did not match any endpoints
2025-11-19 12:38:48.866 +03:00 [DBG] Response markup is scheduled to include Browser Link script injection.
2025-11-19 12:38:48.871 +03:00 [DBG] Response markup is scheduled to include browser refresh script injection.
2025-11-19 12:38:48.899 +03:00 [INF] HTTP GET /swagger/index.html responded 200 in 110.1810 ms
2025-11-19 12:38:48.906 +03:00 [DBG] Response markup was updated to include Browser Link script injection.
2025-11-19 12:38:48.909 +03:00 [DBG] Response markup was updated to include browser refresh script injection.
2025-11-19 12:38:48.916 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7257/swagger/index.html - 200 null text/html;charset=utf-8 287.2748ms
2025-11-19 12:38:48.943 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7257/_framework/aspnetcore-browser-refresh.js - null null
2025-11-19 12:38:48.956 +03:00 [DBG] Script injected: /_framework/aspnetcore-browser-refresh.js
2025-11-19 12:38:48.958 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7257/_vs/browserLink - null null
2025-11-19 12:38:48.960 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7257/_framework/aspnetcore-browser-refresh.js - 200 16519 application/javascript; charset=utf-8 17.3771ms
2025-11-19 12:38:49.023 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7257/_vs/browserLink - 200 null text/javascript; charset=UTF-8 65.8329ms
2025-11-19 12:38:49.081 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7257/swagger/v1/swagger.json - null null
2025-11-19 12:38:49.089 +03:00 [DBG] No candidates found for the request path '/swagger/v1/swagger.json'
2025-11-19 12:38:49.093 +03:00 [DBG] Request did not match any endpoints
2025-11-19 12:38:49.119 +03:00 [INF] HTTP GET /swagger/v1/swagger.json responded 200 in 21.8023 ms
2025-11-19 12:38:49.129 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7257/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 49.4282ms
2025-11-19 12:39:10.757 +03:00 [DBG] Connection id "0HNH79TO88F84" accepted.
2025-11-19 12:39:10.758 +03:00 [DBG] Connection id "0HNH79TO88F84" received FIN.
2025-11-19 12:39:10.763 +03:00 [DBG] Connection id "0HNH79TO88F85" accepted.
2025-11-19 12:39:10.762 +03:00 [DBG] Connection id "0HNH79TO88F84" started.
2025-11-19 12:39:10.779 +03:00 [DBG] Connection id "0HNH79TO88F85" started.
2025-11-19 12:39:10.785 +03:00 [DBG] Failed to authenticate HTTPS connection.
System.IO.IOException: Received an unexpected EOF or 0 bytes from the transport stream.
   at System.Net.Security.SslStream.ReceiveHandshakeFrameAsync[TIOAdapter](CancellationToken cancellationToken)
   at System.Net.Security.SslStream.ForceAuthenticationAsync[TIOAdapter](Boolean receiveFirst, Byte[] reAuthenticationData, CancellationToken cancellationToken)
   at System.Net.Security.SslStream.ProcessAuthenticationWithTelemetryAsync(Boolean isAsync, CancellationToken cancellationToken)
   at Microsoft.AspNetCore.Server.Kestrel.Https.Internal.HttpsConnectionMiddleware.OnConnectionAsync(ConnectionContext context)
2025-11-19 12:39:10.793 +03:00 [DBG] Connection 0HNH79TO88F85 established using the following protocol: "Tls13"
2025-11-19 12:39:10.793 +03:00 [DBG] Connection id "0HNH79TO88F84" stopped.
2025-11-19 12:39:10.800 +03:00 [DBG] Connection id "0HNH79TO88F84" sending FIN because: "The Socket transport's send loop completed gracefully."
2025-11-19 12:39:10.804 +03:00 [INF] Request starting HTTP/1.1 POST https://localhost:7257/api/Invoices - application/json 1387
2025-11-19 12:39:10.819 +03:00 [DBG] 1 candidate(s) found for the request path '/api/Invoices'
2025-11-19 12:39:10.828 +03:00 [DBG] Endpoint 'BillingSystem.API.Controllers.InvoicesController.Post (BillingSystem.API)' with route pattern 'api/Invoices' is valid for the request path '/api/Invoices'
2025-11-19 12:39:10.834 +03:00 [DBG] Request matched endpoint 'BillingSystem.API.Controllers.InvoicesController.Post (BillingSystem.API)'
2025-11-19 12:39:10.842 +03:00 [DBG] Static files was skipped as the request already matched an endpoint.
2025-11-19 12:39:11.074 +03:00 [DBG] An 'IServiceProvider' was created for internal use by Entity Framework.
2025-11-19 12:39:16.564 +03:00 [INF] Executing endpoint 'BillingSystem.API.Controllers.InvoicesController.Post (BillingSystem.API)'
2025-11-19 12:39:16.605 +03:00 [INF] Route matched with {action = "Post", controller = "Invoices"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Post(BillingSystem.Application.Requests.CreateInvoiceRequest) on controller BillingSystem.API.Controllers.InvoicesController (BillingSystem.API).
2025-11-19 12:39:16.612 +03:00 [DBG] Execution plan of authorization filters (in the following order): ["None"]
2025-11-19 12:39:16.618 +03:00 [DBG] Execution plan of resource filters (in the following order): ["None"]
2025-11-19 12:39:16.623 +03:00 [DBG] Execution plan of action filters (in the following order): ["Microsoft.AspNetCore.Mvc.ModelBinding.UnsupportedContentTypeFilter (Order: -3000)","Microsoft.AspNetCore.Mvc.Infrastructure.ModelStateInvalidFilter (Order: -2000)","BillingSystem.API.ActionFilters.AuditBillingRequestsFilter","BillingSystem.API.ActionFilters.IdempotencyFilter (Order: 0)"]
2025-11-19 12:39:16.630 +03:00 [DBG] Execution plan of exception filters (in the following order): ["None"]
2025-11-19 12:39:16.634 +03:00 [DBG] Execution plan of result filters (in the following order): ["Microsoft.AspNetCore.Mvc.Infrastructure.ClientErrorResultFilter (Order: -2000)","Microsoft.AspNetCore.Mvc.ProducesAttribute (Order: 0)","BillingSystem.API.ActionFilters.IdempotencyFilter (Order: 0)"]
2025-11-19 12:39:16.644 +03:00 [DBG] Executing controller factory for controller BillingSystem.API.Controllers.InvoicesController (BillingSystem.API)
2025-11-19 12:39:16.654 +03:00 [WRN] You do not have a valid license key for the Lucky Penny software MediatR. This is allowed for development and testing scenarios. If you are running in production you are required to have a licensed version. Please visit https://luckypennysoftware.com to obtain a valid license.
2025-11-19 12:39:16.697 +03:00 [DBG] Executed controller factory for controller BillingSystem.API.Controllers.InvoicesController (BillingSystem.API)
2025-11-19 12:39:16.718 +03:00 [DBG] Attempting to bind parameter 'invoiceRequest' of type 'BillingSystem.Application.Requests.CreateInvoiceRequest' ...
2025-11-19 12:39:16.724 +03:00 [DBG] Attempting to bind parameter 'invoiceRequest' of type 'BillingSystem.Application.Requests.CreateInvoiceRequest' using the name '' in request data ...
2025-11-19 12:39:16.729 +03:00 [DBG] Selected input formatter 'Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonInputFormatter' for content type 'application/json'.
2025-11-19 12:39:16.774 +03:00 [DBG] Connection id "0HNH79TO88F85", Request id "0HNH79TO88F85:00000001": started reading request body.
2025-11-19 12:39:16.779 +03:00 [DBG] Connection id "0HNH79TO88F85", Request id "0HNH79TO88F85:00000001": done reading request body.
2025-11-19 12:39:16.829 +03:00 [DBG] JSON input formatter succeeded, deserializing to type 'BillingSystem.Application.Requests.CreateInvoiceRequest'
2025-11-19 12:39:16.836 +03:00 [DBG] Done attempting to bind parameter 'invoiceRequest' of type 'BillingSystem.Application.Requests.CreateInvoiceRequest'.
2025-11-19 12:39:16.840 +03:00 [DBG] Done attempting to bind parameter 'invoiceRequest' of type 'BillingSystem.Application.Requests.CreateInvoiceRequest'.
2025-11-19 12:39:16.845 +03:00 [DBG] Attempting to validate the bound parameter 'invoiceRequest' of type 'BillingSystem.Application.Requests.CreateInvoiceRequest' ...
2025-11-19 12:39:16.874 +03:00 [DBG] Done attempting to validate the bound parameter 'invoiceRequest' of type 'BillingSystem.Application.Requests.CreateInvoiceRequest'.
2025-11-19 12:39:17.163 +03:00 [DBG] No relationship from 'Invoice' to 'Invoice' has been configured by convention because there are multiple properties on one entity type - {'DiscountedPrimaryInvoice'} that could be matched with the properties on the other entity type - {'InverseDiscountedPrimaryInvoice', 'InversePrimaryInvoice', 'InverseSubstitutionPrimaryInvoice', 'PrimaryInvoice', 'SubstitutionPrimaryInvoice'}. This message can be disregarded if explicit configuration has been specified in 'OnModelCreating'.
2025-11-19 12:39:17.404 +03:00 [DBG] No relationship from 'Invoice' to 'Invoice' has been configured by convention because there are multiple properties on one entity type - {'DiscountedPrimaryInvoice'} that could be matched with the properties on the other entity type - {'InverseDiscountedPrimaryInvoice', 'InversePrimaryInvoice', 'InverseSubstitutionPrimaryInvoice', 'PrimaryInvoice', 'SubstitutionPrimaryInvoice'}. This message can be disregarded if explicit configuration has been specified in 'OnModelCreating'.
2025-11-19 12:39:17.419 +03:00 [DBG] No relationship from 'Invoice' to 'Invoice' has been configured by convention because there are multiple properties on one entity type - {'InversePrimaryInvoice'} that could be matched with the properties on the other entity type - {'InverseSubstitutionPrimaryInvoice', 'PrimaryInvoice', 'SubstitutionPrimaryInvoice'}. This message can be disregarded if explicit configuration has been specified in 'OnModelCreating'.
2025-11-19 12:39:17.427 +03:00 [DBG] No relationship from 'Invoice' to 'Invoice' has been configured by convention because there are multiple properties on one entity type - {'InversePrimaryInvoice'} that could be matched with the properties on the other entity type - {'InverseSubstitutionPrimaryInvoice', 'PrimaryInvoice', 'SubstitutionPrimaryInvoice'}. This message can be disregarded if explicit configuration has been specified in 'OnModelCreating'.
2025-11-19 12:39:17.755 +03:00 [DBG] Entity Framework Core 9.0.9 initialized 'BillingServiceDBContext' using provider 'Microsoft.EntityFrameworkCore.SqlServer:9.0.9' with options: EngineType=SqlServer 
2025-11-19 12:39:17.914 +03:00 [DBG] Compiling query expression: 
'DbSet<Invoice>()
    .AsNoTracking()
    .Any(inv => inv.ExternalId.ToString() == __idempotentKey_0)'
2025-11-19 12:39:18.258 +03:00 [DBG] Generated query execution expression: 
'queryContext => ShapedQueryCompilingExpressionVisitor.SingleAsync<bool>(
    asyncEnumerable: SingleQueryingEnumerable.Create<bool>(
        relationalQueryContext: (RelationalQueryContext)queryContext, 
        relationalCommandResolver: parameters => [LIFTABLE Constant: RelationalCommandCache.QueryExpression(
            Projection Mapping:
                EmptyProjectionMember -> 0
            SELECT EXISTS (
                SELECT 1
                FROM Invoices AS i
                WHERE COALESCE(CONVERT(varchar(36), i.ExternalId), '') == @__idempotentKey_0)) | Resolver: c => new RelationalCommandCache(
            c.Dependencies.MemoryCache, 
            c.RelationalDependencies.QuerySqlGeneratorFactory, 
            c.RelationalDependencies.RelationalParameterBasedSqlProcessorFactory, 
            Projection Mapping:
                EmptyProjectionMember -> 0
            SELECT EXISTS (
                SELECT 1
                FROM Invoices AS i
                WHERE COALESCE(CONVERT(varchar(36), i.ExternalId), '') == @__idempotentKey_0), 
            False, 
            new HashSet<string>(
                new string[]{ }, 
                StringComparer.Ordinal
            )
        )].GetRelationalCommandTemplate(parameters), 
        readerColumns: null, 
        shaper: (queryContext, dataReader, resultContext, resultCoordinator) => 
        {
            bool? value1;
            value1 = dataReader.IsDBNull(0) ? default(bool?) : (bool?)dataReader.GetBoolean(0);
            return (bool)value1;
        }, 
        contextType: BillingSystem.Infrastructure.EF.BillingServiceDBContext, 
        standAloneStateManager: False, 
        detailedErrorsEnabled: False, 
        threadSafetyChecksEnabled: True), 
    cancellationToken: queryContext.CancellationToken)'
2025-11-19 12:39:18.355 +03:00 [DBG] Creating DbConnection.
2025-11-19 12:39:18.395 +03:00 [DBG] Created DbConnection. (38ms).
2025-11-19 12:39:18.405 +03:00 [DBG] Opening connection to database 'GAC-BillingService' on server '.'.
2025-11-19 12:39:18.767 +03:00 [DBG] Opened connection to database 'GAC-BillingService' on server '.'.
2025-11-19 12:39:18.777 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-11-19 12:39:18.796 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (13ms).
2025-11-19 12:39:18.817 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (40ms).
2025-11-19 12:39:18.837 +03:00 [DBG] Executing DbCommand [Parameters=[@__idempotentKey_0='?' (Size = 36) (DbType = AnsiString)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [Invoices] AS [i]
        WHERE CONVERT(varchar(36), [i].[ExternalId]) = @__idempotentKey_0) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2025-11-19 12:39:18.928 +03:00 [INF] Executed DbCommand (93ms) [Parameters=[@__idempotentKey_0='?' (Size = 36) (DbType = AnsiString)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [Invoices] AS [i]
        WHERE CONVERT(varchar(36), [i].[ExternalId]) = @__idempotentKey_0) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2025-11-19 12:39:18.966 +03:00 [DBG] Closing data reader to 'GAC-BillingService' on server '.'.
2025-11-19 12:39:18.985 +03:00 [DBG] A data reader for 'GAC-BillingService' on server '.' is being disposed after spending 42ms reading results.
2025-11-19 12:39:18.999 +03:00 [DBG] Closing connection to database 'GAC-BillingService' on server '.'.
2025-11-19 12:39:19.013 +03:00 [DBG] Closed connection to database 'GAC-BillingService' on server '.' (13ms).
2025-11-19 12:39:19.021 +03:00 [DBG] Request was short circuited at action filter 'BillingSystem.API.ActionFilters.IdempotencyFilter'.
2025-11-19 12:39:19.052 +03:00 [DBG] List of registered output formatters, in the following order: ["Microsoft.AspNetCore.Mvc.Formatters.HttpNoContentOutputFormatter","Microsoft.AspNetCore.Mvc.Formatters.StringOutputFormatter","Microsoft.AspNetCore.Mvc.Formatters.StreamOutputFormatter","Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonOutputFormatter"]
2025-11-19 12:39:19.066 +03:00 [DBG] No information found on request to perform content negotiation.
2025-11-19 12:39:19.072 +03:00 [DBG] Attempting to select the first output formatter in the output formatters list which supports a content type from the explicitly specified content types '["application/json"]'.
2025-11-19 12:39:19.082 +03:00 [DBG] Selected output formatter 'Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonOutputFormatter' and content type 'application/json' to write the response.
2025-11-19 12:39:19.086 +03:00 [INF] Executing ConflictObjectResult, writing value of type 'System.String'.
2025-11-19 12:39:19.104 +03:00 [INF] Executed action BillingSystem.API.Controllers.InvoicesController.Post (BillingSystem.API) in 2459.1053ms
2025-11-19 12:39:19.109 +03:00 [INF] Executed endpoint 'BillingSystem.API.Controllers.InvoicesController.Post (BillingSystem.API)'
2025-11-19 12:39:19.114 +03:00 [INF] HTTP POST /api/Invoices responded 409 in 8273.5104 ms
2025-11-19 12:39:19.119 +03:00 [DBG] Connection id "0HNH79TO88F85" completed keep alive response.
2025-11-19 12:39:19.125 +03:00 [DBG] 'BillingServiceDBContext' disposed.
2025-11-19 12:39:19.132 +03:00 [DBG] Disposing connection to database 'GAC-BillingService' on server '.'.
2025-11-19 12:39:19.137 +03:00 [DBG] Disposed connection to database '' on server '' (4ms).
2025-11-19 12:39:19.142 +03:00 [INF] Request finished HTTP/1.1 POST https://localhost:7257/api/Invoices - 409 null application/json; charset=utf-8 8337.7514ms
2025-11-19 12:39:46.550 +03:00 [INF] Request starting HTTP/1.1 POST https://localhost:7257/api/Invoices - application/json 1387
2025-11-19 12:39:46.557 +03:00 [DBG] 1 candidate(s) found for the request path '/api/Invoices'
2025-11-19 12:39:46.559 +03:00 [DBG] Endpoint 'BillingSystem.API.Controllers.InvoicesController.Post (BillingSystem.API)' with route pattern 'api/Invoices' is valid for the request path '/api/Invoices'
2025-11-19 12:39:46.562 +03:00 [DBG] Request matched endpoint 'BillingSystem.API.Controllers.InvoicesController.Post (BillingSystem.API)'
2025-11-19 12:39:46.565 +03:00 [DBG] Static files was skipped as the request already matched an endpoint.
2025-11-19 12:39:46.573 +03:00 [INF] Executing endpoint 'BillingSystem.API.Controllers.InvoicesController.Post (BillingSystem.API)'
2025-11-19 12:39:46.576 +03:00 [INF] Route matched with {action = "Post", controller = "Invoices"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Post(BillingSystem.Application.Requests.CreateInvoiceRequest) on controller BillingSystem.API.Controllers.InvoicesController (BillingSystem.API).
2025-11-19 12:39:46.581 +03:00 [DBG] Execution plan of authorization filters (in the following order): ["None"]
2025-11-19 12:39:46.585 +03:00 [DBG] Execution plan of resource filters (in the following order): ["None"]
2025-11-19 12:39:46.589 +03:00 [DBG] Execution plan of action filters (in the following order): ["Microsoft.AspNetCore.Mvc.ModelBinding.UnsupportedContentTypeFilter (Order: -3000)","Microsoft.AspNetCore.Mvc.Infrastructure.ModelStateInvalidFilter (Order: -2000)","BillingSystem.API.ActionFilters.AuditBillingRequestsFilter","BillingSystem.API.ActionFilters.IdempotencyFilter (Order: 0)"]
2025-11-19 12:39:46.592 +03:00 [DBG] Execution plan of exception filters (in the following order): ["None"]
2025-11-19 12:39:46.595 +03:00 [DBG] Execution plan of result filters (in the following order): ["Microsoft.AspNetCore.Mvc.Infrastructure.ClientErrorResultFilter (Order: -2000)","Microsoft.AspNetCore.Mvc.ProducesAttribute (Order: 0)","BillingSystem.API.ActionFilters.IdempotencyFilter (Order: 0)"]
2025-11-19 12:39:46.599 +03:00 [DBG] Executing controller factory for controller BillingSystem.API.Controllers.InvoicesController (BillingSystem.API)
2025-11-19 12:39:46.604 +03:00 [DBG] Executed controller factory for controller BillingSystem.API.Controllers.InvoicesController (BillingSystem.API)
2025-11-19 12:39:46.606 +03:00 [DBG] Attempting to bind parameter 'invoiceRequest' of type 'BillingSystem.Application.Requests.CreateInvoiceRequest' ...
2025-11-19 12:39:46.608 +03:00 [DBG] Attempting to bind parameter 'invoiceRequest' of type 'BillingSystem.Application.Requests.CreateInvoiceRequest' using the name '' in request data ...
2025-11-19 12:39:46.612 +03:00 [DBG] Selected input formatter 'Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonInputFormatter' for content type 'application/json'.
2025-11-19 12:39:46.616 +03:00 [DBG] Connection id "0HNH79TO88F85", Request id "0HNH79TO88F85:00000002": started reading request body.
2025-11-19 12:39:46.618 +03:00 [DBG] Connection id "0HNH79TO88F85", Request id "0HNH79TO88F85:00000002": done reading request body.
2025-11-19 12:39:46.622 +03:00 [DBG] JSON input formatter succeeded, deserializing to type 'BillingSystem.Application.Requests.CreateInvoiceRequest'
2025-11-19 12:39:46.623 +03:00 [DBG] Done attempting to bind parameter 'invoiceRequest' of type 'BillingSystem.Application.Requests.CreateInvoiceRequest'.
2025-11-19 12:39:46.626 +03:00 [DBG] Done attempting to bind parameter 'invoiceRequest' of type 'BillingSystem.Application.Requests.CreateInvoiceRequest'.
2025-11-19 12:39:46.628 +03:00 [DBG] Attempting to validate the bound parameter 'invoiceRequest' of type 'BillingSystem.Application.Requests.CreateInvoiceRequest' ...
2025-11-19 12:39:46.631 +03:00 [DBG] Done attempting to validate the bound parameter 'invoiceRequest' of type 'BillingSystem.Application.Requests.CreateInvoiceRequest'.
2025-11-19 12:39:46.656 +03:00 [DBG] Entity Framework Core 9.0.9 initialized 'BillingServiceDBContext' using provider 'Microsoft.EntityFrameworkCore.SqlServer:9.0.9' with options: EngineType=SqlServer 
2025-11-19 12:39:46.667 +03:00 [DBG] Creating DbConnection.
2025-11-19 12:39:46.670 +03:00 [DBG] Created DbConnection. (3ms).
2025-11-19 12:39:46.673 +03:00 [DBG] Opening connection to database 'GAC-BillingService' on server '.'.
2025-11-19 12:39:46.678 +03:00 [DBG] Opened connection to database 'GAC-BillingService' on server '.'.
2025-11-19 12:39:46.682 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-11-19 12:39:46.685 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (3ms).
2025-11-19 12:39:46.687 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (5ms).
2025-11-19 12:39:46.689 +03:00 [DBG] Executing DbCommand [Parameters=[@__idempotentKey_0='?' (Size = 36) (DbType = AnsiString)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [Invoices] AS [i]
        WHERE CONVERT(varchar(36), [i].[ExternalId]) = @__idempotentKey_0) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2025-11-19 12:39:46.705 +03:00 [INF] Executed DbCommand (16ms) [Parameters=[@__idempotentKey_0='?' (Size = 36) (DbType = AnsiString)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [Invoices] AS [i]
        WHERE CONVERT(varchar(36), [i].[ExternalId]) = @__idempotentKey_0) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2025-11-19 12:39:46.710 +03:00 [DBG] Closing data reader to 'GAC-BillingService' on server '.'.
2025-11-19 12:39:46.713 +03:00 [DBG] A data reader for 'GAC-BillingService' on server '.' is being disposed after spending 3ms reading results.
2025-11-19 12:39:46.719 +03:00 [DBG] Closing connection to database 'GAC-BillingService' on server '.'.
2025-11-19 12:39:46.721 +03:00 [DBG] Closed connection to database 'GAC-BillingService' on server '.' (2ms).
2025-11-19 12:39:46.911 +03:00 [WRN] You do not have a valid license key for the Lucky Penny software AutoMapper. This is allowed for development and testing scenarios. If you are running in production you are required to have a licensed version. Please visit https://luckypennysoftware.com to obtain a valid license.
2025-11-19 12:39:52.720 +03:00 [DBG] Opening connection to database 'GAC-BillingService' on server '.'.
2025-11-19 12:39:52.725 +03:00 [DBG] Opened connection to database 'GAC-BillingService' on server '.'.
2025-11-19 12:39:52.734 +03:00 [DBG] Beginning transaction with isolation level 'Unspecified'.
2025-11-19 12:39:52.748 +03:00 [DBG] Began transaction with isolation level 'ReadCommitted'.
2025-11-19 12:39:52.762 +03:00 [DBG] Compiling query expression: 
'DbSet<InvoiceSequenceValue>().FromSql(EXECUTE dbo.GetNextInvoiceNumber, __p_0)
'
2025-11-19 12:39:52.878 +03:00 [DBG] Generated query execution expression: 
'queryContext => FromSqlQueryingEnumerable.Create<InvoiceSequenceValue>(
    relationalQueryContext: (RelationalQueryContext)queryContext, 
    relationalCommandResolver: parameters => [LIFTABLE Constant: RelationalCommandCache.QueryExpression(
        Projection Mapping:
            EmptyProjectionMember -> Dictionary<IProperty, int> { [Property: InvoiceSequenceValue.Value (long) Required, 0] }
        SELECT b.Value
        FROM EXECUTE dbo.GetNextInvoiceNumber) | Resolver: c => new RelationalCommandCache(
        c.Dependencies.MemoryCache, 
        c.RelationalDependencies.QuerySqlGeneratorFactory, 
        c.RelationalDependencies.RelationalParameterBasedSqlProcessorFactory, 
        Projection Mapping:
            EmptyProjectionMember -> Dictionary<IProperty, int> { [Property: InvoiceSequenceValue.Value (long) Required, 0] }
        SELECT b.Value
        FROM EXECUTE dbo.GetNextInvoiceNumber, 
        False, 
        new HashSet<string>(
            new string[]{ }, 
            StringComparer.Ordinal
        )
    )].GetRelationalCommandTemplate(parameters), 
    readerColumns: null, 
    columnNames: [LIFTABLE Constant: string[] { "Value" } | Resolver: _ => new string[]{ "Value" }], 
    shaper: (queryContext, dataReader, indexMap) => 
    {
        InvoiceSequenceValue entity;
        entity = 
        {
            MaterializationContext materializationContext1;
            IEntityType entityType1;
            InvoiceSequenceValue instance1;
            materializationContext1 = new MaterializationContext(
                [LIFTABLE Constant: ValueBuffer | Resolver: _ => (object)ValueBuffer.Empty], 
                queryContext.Context
            );
            instance1 = default(InvoiceSequenceValue);
            {
                ISnapshot shadowSnapshot1;
                shadowSnapshot1 = [LIFTABLE Constant: Snapshot | Resolver: _ => Snapshot.Empty];
                entityType1 = [LIFTABLE Constant: EntityType: InvoiceSequenceValue Keyless | Resolver: namelessParameter{0} => namelessParameter{0}.Dependencies.Model.FindEntityType("BillingSystem.Domain.Entities.InvoiceSequenceValue")];
                instance1 = switch (entityType1)
                {
                    case [LIFTABLE Constant: EntityType: InvoiceSequenceValue Keyless | Resolver: namelessParameter{1} => namelessParameter{1}.Dependencies.Model.FindEntityType("BillingSystem.Domain.Entities.InvoiceSequenceValue")]: 
                        {
                            return 
                            {
                                InvoiceSequenceValue instance;
                                instance = new InvoiceSequenceValue();
                                instance.<Value>k__BackingField = dataReader.GetInt64(indexMap[0]);
                                (instance is IInjectableService) ? ((IInjectableService)instance).Injected(
                                    context: materializationContext1.Context, 
                                    entity: instance, 
                                    queryTrackingBehavior: TrackAll, 
                                    structuralType: [LIFTABLE Constant: EntityType: InvoiceSequenceValue Keyless | Resolver: namelessParameter{2} => namelessParameter{2}.Dependencies.Model.FindEntityType("BillingSystem.Domain.Entities.InvoiceSequenceValue")]) : default(void);
                                return instance;
                            }}
                    default: 
                        default(InvoiceSequenceValue)
                }
                ;
                return instance1;
            }return instance1;
        };
        return entity;
    }, 
    contextType: BillingSystem.Infrastructure.EF.BillingServiceDBContext, 
    standAloneStateManager: False, 
    detailedErrorsEnabled: False, 
    threadSafetyChecksEnabled: True)'
2025-11-19 12:39:52.891 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-11-19 12:39:52.894 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (3ms).
2025-11-19 12:39:52.900 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (8ms).
2025-11-19 12:39:52.903 +03:00 [DBG] Executing DbCommand [Parameters=[], CommandType='"Text"', CommandTimeout='30']
EXECUTE dbo.GetNextInvoiceNumber
2025-11-19 12:39:52.913 +03:00 [INF] Executed DbCommand (10ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
EXECUTE dbo.GetNextInvoiceNumber
2025-11-19 12:39:52.922 +03:00 [DBG] Closing data reader to 'GAC-BillingService' on server '.'.
2025-11-19 12:39:52.926 +03:00 [DBG] A data reader for 'GAC-BillingService' on server '.' is being disposed after spending 8ms reading results.
2025-11-19 12:39:52.933 +03:00 [DBG] Compiling query expression: 
'DbSet<Customer>()
    .FirstOrDefault(c => c.IdentityNumber == __cutomerIdentityNumber_0)'
2025-11-19 12:39:52.952 +03:00 [DBG] Generated query execution expression: 
'queryContext => SingleQueryingEnumerable.Create<Customer>(
    relationalQueryContext: (RelationalQueryContext)queryContext, 
    relationalCommandResolver: parameters => [LIFTABLE Constant: RelationalCommandCache.QueryExpression(
        Projection Mapping:
            EmptyProjectionMember -> Dictionary<IProperty, int> { [Property: Customer.Id (long) Required PK AfterSave:Throw ValueGenerated.OnAdd, 0], [Property: Customer.AddressBuildingNumber (string) MaxLength(200), 1], [Property: Customer.AddressCity (string) Required MaxLength(200), 2], [Property: Customer.AddressCountry (string) Required MaxLength(200), 3], [Property: Customer.AddressDistrict (string) Required MaxLength(200), 4], [Property: Customer.AddressPostalCode (string) Required MaxLength(50), 5], [Property: Customer.AddressStreet (string) MaxLength(200), 6], [Property: Customer.AddressSubNumber (string) MaxLength(200), 7], [Property: Customer.CreatedBy (string) Required MaxLength(50), 8], [Property: Customer.CreatedDate (DateTime) Required, 9], [Property: Customer.CustomerType (string) Required MaxLength(100), 10], [Property: Customer.EmailAddress (string) MaxLength(80), 11], [Property: Customer.FullName (string) Required MaxLength(500), 12], [Property: Customer.IdentityNumber (string) Required MaxLength(100), 13], [Property: Customer.IdentityType (int?), 14], [Property: Customer.IsDeleted (bool) Required, 15], [Property: Customer.LastUpdatedDate (DateTime?), 16], [Property: Customer.OverpaymentBalance (decimal?), 17], [Property: Customer.PhoneNumber (string) MaxLength(50), 18], [Property: Customer.Vatnumber (string) MaxLength(100), 19] }
        SELECT TOP(1) c.Id, c.Address_BuildingNumber, c.Address_City, c.Address_Country, c.Address_District, c.Address_PostalCode, c.Address_Street, c.Address_SubNumber, c.CreatedBy, c.CreatedDate, c.CustomerType, c.EmailAddress, c.FullName, c.IdentityNumber, c.IdentityType, c.IsDeleted, c.LastUpdatedDate, c.OverpaymentBalance, c.PhoneNumber, c.VATNumber
        FROM Customers AS c
        WHERE c.IdentityNumber == @__cutomerIdentityNumber_0) | Resolver: c => new RelationalCommandCache(
        c.Dependencies.MemoryCache, 
        c.RelationalDependencies.QuerySqlGeneratorFactory, 
        c.RelationalDependencies.RelationalParameterBasedSqlProcessorFactory, 
        Projection Mapping:
            EmptyProjectionMember -> Dictionary<IProperty, int> { [Property: Customer.Id (long) Required PK AfterSave:Throw ValueGenerated.OnAdd, 0], [Property: Customer.AddressBuildingNumber (string) MaxLength(200), 1], [Property: Customer.AddressCity (string) Required MaxLength(200), 2], [Property: Customer.AddressCountry (string) Required MaxLength(200), 3], [Property: Customer.AddressDistrict (string) Required MaxLength(200), 4], [Property: Customer.AddressPostalCode (string) Required MaxLength(50), 5], [Property: Customer.AddressStreet (string) MaxLength(200), 6], [Property: Customer.AddressSubNumber (string) MaxLength(200), 7], [Property: Customer.CreatedBy (string) Required MaxLength(50), 8], [Property: Customer.CreatedDate (DateTime) Required, 9], [Property: Customer.CustomerType (string) Required MaxLength(100), 10], [Property: Customer.EmailAddress (string) MaxLength(80), 11], [Property: Customer.FullName (string) Required MaxLength(500), 12], [Property: Customer.IdentityNumber (string) Required MaxLength(100), 13], [Property: Customer.IdentityType (int?), 14], [Property: Customer.IsDeleted (bool) Required, 15], [Property: Customer.LastUpdatedDate (DateTime?), 16], [Property: Customer.OverpaymentBalance (decimal?), 17], [Property: Customer.PhoneNumber (string) MaxLength(50), 18], [Property: Customer.Vatnumber (string) MaxLength(100), 19] }
        SELECT TOP(1) c.Id, c.Address_BuildingNumber, c.Address_City, c.Address_Country, c.Address_District, c.Address_PostalCode, c.Address_Street, c.Address_SubNumber, c.CreatedBy, c.CreatedDate, c.CustomerType, c.EmailAddress, c.FullName, c.IdentityNumber, c.IdentityType, c.IsDeleted, c.LastUpdatedDate, c.OverpaymentBalance, c.PhoneNumber, c.VATNumber
        FROM Customers AS c
        WHERE c.IdentityNumber == @__cutomerIdentityNumber_0, 
        False, 
        new HashSet<string>(
            new string[]{ }, 
            StringComparer.Ordinal
        )
    )].GetRelationalCommandTemplate(parameters), 
    readerColumns: null, 
    shaper: (queryContext, dataReader, resultContext, resultCoordinator) => 
    {
        Customer entity;
        entity = 
        {
            MaterializationContext materializationContext1;
            IEntityType entityType1;
            Customer instance1;
            InternalEntityEntry entry1;
            bool hasNullKey1;
            materializationContext1 = new MaterializationContext(
                [LIFTABLE Constant: ValueBuffer | Resolver: _ => (object)ValueBuffer.Empty], 
                queryContext.Context
            );
            instance1 = default(Customer);
            entry1 = queryContext.TryGetEntry(
                key: [LIFTABLE Constant: Key: Customer.Id PK | Resolver: c => c.Dependencies.Model.FindEntityType("BillingSystem.Domain.Entities.Customer").FindPrimaryKey()], 
                keyValues: new object[]{ (object)dataReader.GetInt64(0) }, 
                throwOnNullKey: True, 
                hasNullKey: hasNullKey1);
            !(hasNullKey1) ? entry1 != default(InternalEntityEntry) ? 
            {
                entityType1 = entry1.EntityType;
                return instance1 = (Customer)entry1.Entity;
            } : 
            {
                ISnapshot shadowSnapshot1;
                shadowSnapshot1 = [LIFTABLE Constant: Snapshot | Resolver: _ => Snapshot.Empty];
                entityType1 = [LIFTABLE Constant: EntityType: Customer | Resolver: namelessParameter{0} => namelessParameter{0}.Dependencies.Model.FindEntityType("BillingSystem.Domain.Entities.Customer")];
                instance1 = switch (entityType1)
                {
                    case [LIFTABLE Constant: EntityType: Customer | Resolver: namelessParameter{1} => namelessParameter{1}.Dependencies.Model.FindEntityType("BillingSystem.Domain.Entities.Customer")]: 
                        {
                            return 
                            {
                                Customer instance;
                                instance = new Customer();
                                instance.<Id>k__BackingField = dataReader.GetInt64(0);
                                instance.<AddressBuildingNumber>k__BackingField = dataReader.IsDBNull(1) ? default(string) : dataReader.GetString(1);
                                instance.<AddressCity>k__BackingField = dataReader.GetString(2);
                                instance.<AddressCountry>k__BackingField = dataReader.GetString(3);
                                instance.<AddressDistrict>k__BackingField = dataReader.GetString(4);
                                instance.<AddressPostalCode>k__BackingField = dataReader.GetString(5);
                                instance.<AddressStreet>k__BackingField = dataReader.IsDBNull(6) ? default(string) : dataReader.GetString(6);
                                instance.<AddressSubNumber>k__BackingField = dataReader.IsDBNull(7) ? default(string) : dataReader.GetString(7);
                                instance.<CreatedBy>k__BackingField = dataReader.GetString(8);
                                instance.<CreatedDate>k__BackingField = dataReader.GetDateTime(9);
                                instance.<CustomerType>k__BackingField = dataReader.GetString(10);
                                instance.<EmailAddress>k__BackingField = dataReader.IsDBNull(11) ? default(string) : dataReader.GetString(11);
                                instance.<FullName>k__BackingField = dataReader.GetString(12);
                                instance.<IdentityNumber>k__BackingField = dataReader.GetString(13);
                                instance.<IdentityType>k__BackingField = dataReader.IsDBNull(14) ? default(int?) : (int?)dataReader.GetInt32(14);
                                instance.<IsDeleted>k__BackingField = dataReader.GetBoolean(15);
                                instance.<LastUpdatedDate>k__BackingField = dataReader.IsDBNull(16) ? default(DateTime?) : (DateTime?)dataReader.GetDateTime(16);
                                instance.<OverpaymentBalance>k__BackingField = dataReader.IsDBNull(17) ? default(decimal?) : (decimal?)dataReader.GetDecimal(17);
                                instance.<PhoneNumber>k__BackingField = dataReader.IsDBNull(18) ? default(string) : dataReader.GetString(18);
                                instance.<Vatnumber>k__BackingField = dataReader.IsDBNull(19) ? default(string) : dataReader.GetString(19);
                                (instance is IInjectableService) ? ((IInjectableService)instance).Injected(
                                    context: materializationContext1.Context, 
                                    entity: instance, 
                                    queryTrackingBehavior: TrackAll, 
                                    structuralType: [LIFTABLE Constant: EntityType: Customer | Resolver: namelessParameter{2} => namelessParameter{2}.Dependencies.Model.FindEntityType("BillingSystem.Domain.Entities.Customer")]) : default(void);
                                return instance;
                            }}
                    default: 
                        default(Customer)
                }
                ;
                entry1 = entityType1 == default(IEntityType) ? default(InternalEntityEntry) : queryContext.StartTracking(
                    entityType: entityType1, 
                    entity: instance1, 
                    snapshot: shadowSnapshot1);
                return instance1;
            } : default(void);
            return instance1;
        };
        return entity;
    }, 
    contextType: BillingSystem.Infrastructure.EF.BillingServiceDBContext, 
    standAloneStateManager: False, 
    detailedErrorsEnabled: False, 
    threadSafetyChecksEnabled: True)
    .SingleOrDefault()'
2025-11-19 12:39:52.963 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-11-19 12:39:52.966 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (2ms).
2025-11-19 12:39:52.969 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (5ms).
2025-11-19 12:39:52.971 +03:00 [DBG] Executing DbCommand [Parameters=[@__cutomerIdentityNumber_0='?' (Size = 100)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[Id], [c].[Address_BuildingNumber], [c].[Address_City], [c].[Address_Country], [c].[Address_District], [c].[Address_PostalCode], [c].[Address_Street], [c].[Address_SubNumber], [c].[CreatedBy], [c].[CreatedDate], [c].[CustomerType], [c].[EmailAddress], [c].[FullName], [c].[IdentityNumber], [c].[IdentityType], [c].[IsDeleted], [c].[LastUpdatedDate], [c].[OverpaymentBalance], [c].[PhoneNumber], [c].[VATNumber]
FROM [Customers] AS [c]
WHERE [c].[IdentityNumber] = @__cutomerIdentityNumber_0
2025-11-19 12:39:52.977 +03:00 [INF] Executed DbCommand (6ms) [Parameters=[@__cutomerIdentityNumber_0='?' (Size = 100)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[Id], [c].[Address_BuildingNumber], [c].[Address_City], [c].[Address_Country], [c].[Address_District], [c].[Address_PostalCode], [c].[Address_Street], [c].[Address_SubNumber], [c].[CreatedBy], [c].[CreatedDate], [c].[CustomerType], [c].[EmailAddress], [c].[FullName], [c].[IdentityNumber], [c].[IdentityType], [c].[IsDeleted], [c].[LastUpdatedDate], [c].[OverpaymentBalance], [c].[PhoneNumber], [c].[VATNumber]
FROM [Customers] AS [c]
WHERE [c].[IdentityNumber] = @__cutomerIdentityNumber_0
2025-11-19 12:39:53.017 +03:00 [DBG] Context 'BillingServiceDBContext' started tracking 'Customer' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-11-19 12:39:53.084 +03:00 [DBG] Closing data reader to 'GAC-BillingService' on server '.'.
2025-11-19 12:39:53.089 +03:00 [DBG] A data reader for 'GAC-BillingService' on server '.' is being disposed after spending 106ms reading results.
2025-11-19 12:39:53.139 +03:00 [DBG] 'BillingServiceDBContext' generated a temporary value for the property 'Invoice.Id'. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-11-19 12:39:53.300 +03:00 [DBG] Context 'BillingServiceDBContext' started tracking 'Invoice' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-11-19 12:39:53.319 +03:00 [DBG] 'BillingServiceDBContext' generated a temporary value for the property 'InvoicesAttachment.Id'. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-11-19 12:39:53.343 +03:00 [DBG] The navigation 'InvoicesAttachment.Invoice' was detected as changed. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-11-19 12:39:53.355 +03:00 [DBG] Context 'BillingServiceDBContext' started tracking 'InvoicesAttachment' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-11-19 12:39:53.362 +03:00 [DBG] 'BillingServiceDBContext' generated a temporary value for the property 'InvoicesItem.Id'. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-11-19 12:39:53.395 +03:00 [DBG] The navigation 'InvoicesItem.Invoice' was detected as changed. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-11-19 12:39:53.405 +03:00 [DBG] Context 'BillingServiceDBContext' started tracking 'InvoicesItem' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-11-19 12:39:53.415 +03:00 [DBG] SaveChanges starting for 'BillingServiceDBContext'.
2025-11-19 12:39:53.422 +03:00 [DBG] DetectChanges starting for 'BillingServiceDBContext'.
2025-11-19 12:39:53.518 +03:00 [DBG] DetectChanges completed for 'BillingServiceDBContext'.
2025-11-19 12:39:53.682 +03:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-11-19 12:39:53.688 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-11-19 12:39:53.691 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (2ms).
2025-11-19 12:39:53.696 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (8ms).
2025-11-19 12:39:53.702 +03:00 [DBG] Executing DbCommand [Parameters=[@p0='?' (Precision = 18) (DbType = Decimal), @p1='?' (Size = 3000), @p2='?' (Size = 100), @p3='?' (Size = 50), @p4='?' (DbType = DateTime), @p5='?' (Size = 50), @p6='?' (DbType = Int64), @p7='?' (DbType = Int64), @p8='?' (DbType = DateTime), @p9='?' (DbType = Guid), @p10='?' (Size = 50), @p11='?' (DbType = Int32), @p12='?' (DbType = Int32), @p13='?' (DbType = Boolean), @p14='?' (DbType = Boolean), @p15='?' (DbType = Boolean), @p16='?' (DbType = Boolean), @p17='?' (DbType = DateTime), @p18='?' (DbType = DateTime), @p19='?' (Size = 4000), @p20='?' (Size = 100), @p21='?' (Size = 100), @p22='?' (DbType = Int64), @p23='?' (Size = 4000), @p24='?' (DbType = Int64), @p25='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [Invoices] ([Amount], [CancelationReasons], [ClientReferenceNumber], [CreatedBy], [CreatedDate], [Currency], [CustomerID], [DiscountedPrimaryInvoiceID], [DueAt], [ExternalId], [InvoiceNumber], [InvoiceStatus], [InvoiceType], [IsDeleted], [IsDiscounted], [IsSubInvoice], [IsSubstitution], [IssuedAt], [LastUpdatedDate], [Metadata], [PaymentProvider], [PaymentReference], [PrimaryInvoiceID], [ProviderResponse], [SubstitutionPrimaryInvoiceID], [TenantId])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18, @p19, @p20, @p21, @p22, @p23, @p24, @p25);
2025-11-19 12:39:53.712 +03:00 [INF] Executed DbCommand (13ms) [Parameters=[@p0='?' (Precision = 18) (DbType = Decimal), @p1='?' (Size = 3000), @p2='?' (Size = 100), @p3='?' (Size = 50), @p4='?' (DbType = DateTime), @p5='?' (Size = 50), @p6='?' (DbType = Int64), @p7='?' (DbType = Int64), @p8='?' (DbType = DateTime), @p9='?' (DbType = Guid), @p10='?' (Size = 50), @p11='?' (DbType = Int32), @p12='?' (DbType = Int32), @p13='?' (DbType = Boolean), @p14='?' (DbType = Boolean), @p15='?' (DbType = Boolean), @p16='?' (DbType = Boolean), @p17='?' (DbType = DateTime), @p18='?' (DbType = DateTime), @p19='?' (Size = 4000), @p20='?' (Size = 100), @p21='?' (Size = 100), @p22='?' (DbType = Int64), @p23='?' (Size = 4000), @p24='?' (DbType = Int64), @p25='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [Invoices] ([Amount], [CancelationReasons], [ClientReferenceNumber], [CreatedBy], [CreatedDate], [Currency], [CustomerID], [DiscountedPrimaryInvoiceID], [DueAt], [ExternalId], [InvoiceNumber], [InvoiceStatus], [InvoiceType], [IsDeleted], [IsDiscounted], [IsSubInvoice], [IsSubstitution], [IssuedAt], [LastUpdatedDate], [Metadata], [PaymentProvider], [PaymentReference], [PrimaryInvoiceID], [ProviderResponse], [SubstitutionPrimaryInvoiceID], [TenantId])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18, @p19, @p20, @p21, @p22, @p23, @p24, @p25);
2025-11-19 12:39:53.737 +03:00 [DBG] The foreign key property 'Invoice.Id' was detected as changed. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see property values.
2025-11-19 12:39:53.750 +03:00 [DBG] The foreign key property 'InvoicesAttachment.InvoiceId' was detected as changed. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see property values.
2025-11-19 12:39:53.760 +03:00 [DBG] The foreign key property 'InvoicesItem.InvoiceId' was detected as changed. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see property values.
2025-11-19 12:39:53.767 +03:00 [DBG] Closing data reader to 'GAC-BillingService' on server '.'.
2025-11-19 12:39:53.770 +03:00 [DBG] A data reader for 'GAC-BillingService' on server '.' is being disposed after spending 51ms reading results.
2025-11-19 12:39:53.778 +03:00 [DBG] Executing 2 update commands as a batch.
2025-11-19 12:39:53.780 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-11-19 12:39:53.783 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (2ms).
2025-11-19 12:39:53.786 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (5ms).
2025-11-19 12:39:53.790 +03:00 [DBG] Executing DbCommand [Parameters=[@p26='?' (Size = 50), @p27='?' (DbType = DateTime), @p28='?' (Size = 200), @p29='?' (DbType = Int64), @p30='?' (DbType = Boolean), @p31='?' (Precision = 18) (DbType = Decimal), @p32='?' (Size = 50), @p33='?' (DbType = DateTime), @p34='?' (DbType = Int64), @p35='?' (DbType = Boolean), @p36='?' (Size = 500), @p37='?' (Size = 200), @p38='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SET NOCOUNT ON;
INSERT INTO [InvoicesAttachments] ([CreatedBy], [CreatedDate], [FileName], [InvoiceId], [IsDeleted])
OUTPUT INSERTED.[Id]
VALUES (@p26, @p27, @p28, @p29, @p30);
INSERT INTO [InvoicesItems] ([Amount], [CreatedBy], [CreatedDate], [InvoiceId], [IsDeleted], [ItemDesc], [ItemName], [Quantity])
OUTPUT INSERTED.[Id]
VALUES (@p31, @p32, @p33, @p34, @p35, @p36, @p37, @p38);
2025-11-19 12:39:53.798 +03:00 [INF] Executed DbCommand (8ms) [Parameters=[@p26='?' (Size = 50), @p27='?' (DbType = DateTime), @p28='?' (Size = 200), @p29='?' (DbType = Int64), @p30='?' (DbType = Boolean), @p31='?' (Precision = 18) (DbType = Decimal), @p32='?' (Size = 50), @p33='?' (DbType = DateTime), @p34='?' (DbType = Int64), @p35='?' (DbType = Boolean), @p36='?' (Size = 500), @p37='?' (Size = 200), @p38='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SET NOCOUNT ON;
INSERT INTO [InvoicesAttachments] ([CreatedBy], [CreatedDate], [FileName], [InvoiceId], [IsDeleted])
OUTPUT INSERTED.[Id]
VALUES (@p26, @p27, @p28, @p29, @p30);
INSERT INTO [InvoicesItems] ([Amount], [CreatedBy], [CreatedDate], [InvoiceId], [IsDeleted], [ItemDesc], [ItemName], [Quantity])
OUTPUT INSERTED.[Id]
VALUES (@p31, @p32, @p33, @p34, @p35, @p36, @p37, @p38);
2025-11-19 12:39:53.804 +03:00 [DBG] The foreign key property 'InvoicesAttachment.Id' was detected as changed. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see property values.
2025-11-19 12:39:53.808 +03:00 [DBG] The foreign key property 'InvoicesItem.Id' was detected as changed. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see property values.
2025-11-19 12:39:53.811 +03:00 [DBG] Closing data reader to 'GAC-BillingService' on server '.'.
2025-11-19 12:39:53.814 +03:00 [DBG] A data reader for 'GAC-BillingService' on server '.' is being disposed after spending 10ms reading results.
2025-11-19 12:39:53.827 +03:00 [DBG] An entity of type 'Invoice' tracked by 'BillingServiceDBContext' changed state from '"Added"' to '"Unchanged"'. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-11-19 12:39:53.835 +03:00 [DBG] An entity of type 'InvoicesAttachment' tracked by 'BillingServiceDBContext' changed state from '"Added"' to '"Unchanged"'. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-11-19 12:39:53.841 +03:00 [DBG] An entity of type 'InvoicesItem' tracked by 'BillingServiceDBContext' changed state from '"Added"' to '"Unchanged"'. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-11-19 12:39:53.850 +03:00 [DBG] SaveChanges completed for 'BillingServiceDBContext' with 3 entities written to the database.
2025-11-19 12:39:53.872 +03:00 [DBG] 'BillingServiceDBContext' generated a temporary value for the property 'OutboxEvent.Id'. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-11-19 12:39:53.896 +03:00 [DBG] Context 'BillingServiceDBContext' started tracking 'OutboxEvent' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-11-19 12:39:53.902 +03:00 [DBG] 'BillingServiceDBContext' generated a temporary value for the property 'AuditEvent.Id'. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-11-19 12:39:53.924 +03:00 [DBG] Context 'BillingServiceDBContext' started tracking 'AuditEvent' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-11-19 12:39:53.928 +03:00 [DBG] SaveChanges starting for 'BillingServiceDBContext'.
2025-11-19 12:39:53.931 +03:00 [DBG] DetectChanges starting for 'BillingServiceDBContext'.
2025-11-19 12:39:53.947 +03:00 [DBG] DetectChanges completed for 'BillingServiceDBContext'.
2025-11-19 12:39:53.952 +03:00 [DBG] Executing 2 update commands as a batch.
2025-11-19 12:39:53.955 +03:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-11-19 12:39:53.958 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-11-19 12:39:53.960 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (2ms).
2025-11-19 12:39:53.966 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (7ms).
2025-11-19 12:39:53.970 +03:00 [DBG] Executing DbCommand [Parameters=[@p0='?' (Size = 100), @p1='?' (Size = 4000), @p2='?' (Size = 50), @p3='?' (DbType = DateTime), @p4='?' (Size = 500), @p5='?' (Size = 20), @p6='?' (Size = 100), @p7='?' (Size = 100), @p8='?' (DbType = Int64), @p9='?' (DbType = DateTime), @p10='?' (Size = 4000), @p11='?' (Size = 300), @p12='?' (Size = 4000), @p13='?' (DbType = Boolean), @p14='?' (Size = 20) (DbType = AnsiString)], CommandType='"Text"', CommandTimeout='30']
SET NOCOUNT ON;
INSERT INTO [audit].[AuditEvents] ([Action], [Changes], [CreatedBy], [CreatedDate], [Description], [EntityId], [EntityType], [UserId])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
INSERT INTO [Outbox_events] ([Aggregate_id], [CreatedDate], [ErrorMsg], [Event_type], [Payload], [Processed], [ProcessingStatus])
OUTPUT INSERTED.[Id]
VALUES (@p8, @p9, @p10, @p11, @p12, @p13, @p14);
2025-11-19 12:39:53.979 +03:00 [INF] Executed DbCommand (9ms) [Parameters=[@p0='?' (Size = 100), @p1='?' (Size = 4000), @p2='?' (Size = 50), @p3='?' (DbType = DateTime), @p4='?' (Size = 500), @p5='?' (Size = 20), @p6='?' (Size = 100), @p7='?' (Size = 100), @p8='?' (DbType = Int64), @p9='?' (DbType = DateTime), @p10='?' (Size = 4000), @p11='?' (Size = 300), @p12='?' (Size = 4000), @p13='?' (DbType = Boolean), @p14='?' (Size = 20) (DbType = AnsiString)], CommandType='"Text"', CommandTimeout='30']
SET NOCOUNT ON;
INSERT INTO [audit].[AuditEvents] ([Action], [Changes], [CreatedBy], [CreatedDate], [Description], [EntityId], [EntityType], [UserId])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
INSERT INTO [Outbox_events] ([Aggregate_id], [CreatedDate], [ErrorMsg], [Event_type], [Payload], [Processed], [ProcessingStatus])
OUTPUT INSERTED.[Id]
VALUES (@p8, @p9, @p10, @p11, @p12, @p13, @p14);
2025-11-19 12:39:53.986 +03:00 [DBG] The foreign key property 'AuditEvent.Id' was detected as changed. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see property values.
2025-11-19 12:39:53.992 +03:00 [DBG] The foreign key property 'OutboxEvent.Id' was detected as changed. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see property values.
2025-11-19 12:39:53.995 +03:00 [DBG] Closing data reader to 'GAC-BillingService' on server '.'.
2025-11-19 12:39:53.998 +03:00 [DBG] A data reader for 'GAC-BillingService' on server '.' is being disposed after spending 13ms reading results.
2025-11-19 12:39:54.003 +03:00 [DBG] An entity of type 'AuditEvent' tracked by 'BillingServiceDBContext' changed state from '"Added"' to '"Unchanged"'. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-11-19 12:39:54.009 +03:00 [DBG] An entity of type 'OutboxEvent' tracked by 'BillingServiceDBContext' changed state from '"Added"' to '"Unchanged"'. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-11-19 12:39:54.012 +03:00 [DBG] SaveChanges completed for 'BillingServiceDBContext' with 2 entities written to the database.
2025-11-19 12:39:54.018 +03:00 [DBG] Committing transaction.
2025-11-19 12:39:54.037 +03:00 [DBG] Committed transaction.
2025-11-19 12:39:54.042 +03:00 [DBG] Closing connection to database 'GAC-BillingService' on server '.'.
2025-11-19 12:39:54.047 +03:00 [DBG] Closed connection to database 'GAC-BillingService' on server '.' (5ms).
2025-11-19 12:39:54.056 +03:00 [DBG] Disposing transaction.
2025-11-19 12:39:54.068 +03:00 [DBG] List of registered output formatters, in the following order: ["Microsoft.AspNetCore.Mvc.Formatters.HttpNoContentOutputFormatter","Microsoft.AspNetCore.Mvc.Formatters.StringOutputFormatter","Microsoft.AspNetCore.Mvc.Formatters.StreamOutputFormatter","Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonOutputFormatter"]
2025-11-19 12:39:54.073 +03:00 [DBG] No information found on request to perform content negotiation.
2025-11-19 12:39:54.075 +03:00 [DBG] Attempting to select the first output formatter in the output formatters list which supports a content type from the explicitly specified content types '["application/json"]'.
2025-11-19 12:39:54.080 +03:00 [DBG] Selected output formatter 'Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonOutputFormatter' and content type 'application/json' to write the response.
2025-11-19 12:39:54.083 +03:00 [INF] Executing OkObjectResult, writing value of type 'BillingSystem.SharedKernel.ApiResponse`1[[System.Int64, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-11-19 12:39:54.094 +03:00 [INF] Executed action BillingSystem.API.Controllers.InvoicesController.Post (BillingSystem.API) in 7494.9762ms
2025-11-19 12:39:54.099 +03:00 [INF] Executed endpoint 'BillingSystem.API.Controllers.InvoicesController.Post (BillingSystem.API)'
2025-11-19 12:39:54.101 +03:00 [INF] HTTP POST /api/Invoices responded 200 in 7536.0363 ms
2025-11-19 12:39:54.106 +03:00 [DBG] Connection id "0HNH79TO88F85" completed keep alive response.
2025-11-19 12:39:54.108 +03:00 [DBG] 'BillingServiceDBContext' disposed.
2025-11-19 12:39:54.110 +03:00 [DBG] Disposing connection to database 'GAC-BillingService' on server '.'.
2025-11-19 12:39:54.114 +03:00 [DBG] Disposed connection to database '' on server '' (3ms).
2025-11-19 12:39:54.118 +03:00 [INF] Request finished HTTP/1.1 POST https://localhost:7257/api/Invoices - 200 null application/json; charset=utf-8 7567.788ms
2025-11-19 12:43:24.106 +03:00 [DBG] Connection id "0HNH79TO88F86" accepted.
2025-11-19 12:43:24.107 +03:00 [DBG] Connection id "0HNH79TO88F86" received FIN.
2025-11-19 12:43:24.110 +03:00 [DBG] Connection id "0HNH79TO88F86" started.
2025-11-19 12:43:24.112 +03:00 [DBG] Connection id "0HNH79TO88F87" accepted.
2025-11-19 12:43:24.121 +03:00 [DBG] Failed to authenticate HTTPS connection.
System.IO.IOException: Received an unexpected EOF or 0 bytes from the transport stream.
   at System.Net.Security.SslStream.ReceiveHandshakeFrameAsync[TIOAdapter](CancellationToken cancellationToken)
   at System.Net.Security.SslStream.ForceAuthenticationAsync[TIOAdapter](Boolean receiveFirst, Byte[] reAuthenticationData, CancellationToken cancellationToken)
   at System.Net.Security.SslStream.ProcessAuthenticationWithTelemetryAsync(Boolean isAsync, CancellationToken cancellationToken)
   at Microsoft.AspNetCore.Server.Kestrel.Https.Internal.HttpsConnectionMiddleware.OnConnectionAsync(ConnectionContext context)
2025-11-19 12:43:24.122 +03:00 [DBG] Connection id "0HNH79TO88F87" started.
2025-11-19 12:43:24.127 +03:00 [DBG] Connection id "0HNH79TO88F86" stopped.
2025-11-19 12:43:24.133 +03:00 [DBG] Connection id "0HNH79TO88F86" sending FIN because: "The Socket transport's send loop completed gracefully."
2025-11-19 12:43:24.136 +03:00 [DBG] Connection 0HNH79TO88F87 established using the following protocol: "Tls13"
2025-11-19 12:43:24.140 +03:00 [INF] Request starting HTTP/1.1 POST https://localhost:7257/api/Invoices - application/json 1387
2025-11-19 12:43:24.150 +03:00 [DBG] 1 candidate(s) found for the request path '/api/Invoices'
2025-11-19 12:43:24.152 +03:00 [DBG] Endpoint 'BillingSystem.API.Controllers.InvoicesController.Post (BillingSystem.API)' with route pattern 'api/Invoices' is valid for the request path '/api/Invoices'
2025-11-19 12:43:24.158 +03:00 [DBG] Request matched endpoint 'BillingSystem.API.Controllers.InvoicesController.Post (BillingSystem.API)'
2025-11-19 12:43:24.162 +03:00 [DBG] Static files was skipped as the request already matched an endpoint.
2025-11-19 12:43:24.179 +03:00 [INF] Executing endpoint 'BillingSystem.API.Controllers.InvoicesController.Post (BillingSystem.API)'
2025-11-19 12:43:24.188 +03:00 [INF] Route matched with {action = "Post", controller = "Invoices"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Post(BillingSystem.Application.Requests.CreateInvoiceRequest) on controller BillingSystem.API.Controllers.InvoicesController (BillingSystem.API).
2025-11-19 12:43:24.201 +03:00 [DBG] Execution plan of authorization filters (in the following order): ["None"]
2025-11-19 12:43:24.210 +03:00 [DBG] Execution plan of resource filters (in the following order): ["None"]
2025-11-19 12:43:24.217 +03:00 [DBG] Execution plan of action filters (in the following order): ["Microsoft.AspNetCore.Mvc.ModelBinding.UnsupportedContentTypeFilter (Order: -3000)","Microsoft.AspNetCore.Mvc.Infrastructure.ModelStateInvalidFilter (Order: -2000)","BillingSystem.API.ActionFilters.AuditBillingRequestsFilter","BillingSystem.API.ActionFilters.IdempotencyFilter (Order: 0)"]
2025-11-19 12:43:24.227 +03:00 [DBG] Execution plan of exception filters (in the following order): ["None"]
2025-11-19 12:43:24.230 +03:00 [DBG] Execution plan of result filters (in the following order): ["Microsoft.AspNetCore.Mvc.Infrastructure.ClientErrorResultFilter (Order: -2000)","Microsoft.AspNetCore.Mvc.ProducesAttribute (Order: 0)","BillingSystem.API.ActionFilters.IdempotencyFilter (Order: 0)"]
2025-11-19 12:43:24.235 +03:00 [DBG] Executing controller factory for controller BillingSystem.API.Controllers.InvoicesController (BillingSystem.API)
2025-11-19 12:43:24.240 +03:00 [DBG] Executed controller factory for controller BillingSystem.API.Controllers.InvoicesController (BillingSystem.API)
2025-11-19 12:43:24.244 +03:00 [DBG] Attempting to bind parameter 'invoiceRequest' of type 'BillingSystem.Application.Requests.CreateInvoiceRequest' ...
2025-11-19 12:43:24.247 +03:00 [DBG] Attempting to bind parameter 'invoiceRequest' of type 'BillingSystem.Application.Requests.CreateInvoiceRequest' using the name '' in request data ...
2025-11-19 12:43:24.251 +03:00 [DBG] Selected input formatter 'Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonInputFormatter' for content type 'application/json'.
2025-11-19 12:43:24.254 +03:00 [DBG] Connection id "0HNH79TO88F87", Request id "0HNH79TO88F87:00000001": started reading request body.
2025-11-19 12:43:24.259 +03:00 [DBG] Connection id "0HNH79TO88F87", Request id "0HNH79TO88F87:00000001": done reading request body.
2025-11-19 12:43:24.262 +03:00 [DBG] JSON input formatter succeeded, deserializing to type 'BillingSystem.Application.Requests.CreateInvoiceRequest'
2025-11-19 12:43:24.264 +03:00 [DBG] Done attempting to bind parameter 'invoiceRequest' of type 'BillingSystem.Application.Requests.CreateInvoiceRequest'.
2025-11-19 12:43:24.267 +03:00 [DBG] Done attempting to bind parameter 'invoiceRequest' of type 'BillingSystem.Application.Requests.CreateInvoiceRequest'.
2025-11-19 12:43:24.272 +03:00 [DBG] Attempting to validate the bound parameter 'invoiceRequest' of type 'BillingSystem.Application.Requests.CreateInvoiceRequest' ...
2025-11-19 12:43:24.276 +03:00 [DBG] Done attempting to validate the bound parameter 'invoiceRequest' of type 'BillingSystem.Application.Requests.CreateInvoiceRequest'.
2025-11-19 12:43:24.349 +03:00 [DBG] Entity Framework Core 9.0.9 initialized 'BillingServiceDBContext' using provider 'Microsoft.EntityFrameworkCore.SqlServer:9.0.9' with options: EngineType=SqlServer 
2025-11-19 12:43:24.358 +03:00 [DBG] Creating DbConnection.
2025-11-19 12:43:24.361 +03:00 [DBG] Created DbConnection. (2ms).
2025-11-19 12:43:24.365 +03:00 [DBG] Opening connection to database 'GAC-BillingService' on server '.'.
2025-11-19 12:43:24.370 +03:00 [DBG] Opened connection to database 'GAC-BillingService' on server '.'.
2025-11-19 12:43:24.374 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-11-19 12:43:24.378 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (4ms).
2025-11-19 12:43:24.383 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (8ms).
2025-11-19 12:43:24.386 +03:00 [DBG] Executing DbCommand [Parameters=[@__idempotentKey_0='?' (Size = 36) (DbType = AnsiString)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [Invoices] AS [i]
        WHERE CONVERT(varchar(36), [i].[ExternalId]) = @__idempotentKey_0) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2025-11-19 12:43:24.393 +03:00 [INF] Executed DbCommand (7ms) [Parameters=[@__idempotentKey_0='?' (Size = 36) (DbType = AnsiString)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [Invoices] AS [i]
        WHERE CONVERT(varchar(36), [i].[ExternalId]) = @__idempotentKey_0) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2025-11-19 12:43:24.399 +03:00 [DBG] Closing data reader to 'GAC-BillingService' on server '.'.
2025-11-19 12:43:24.401 +03:00 [DBG] A data reader for 'GAC-BillingService' on server '.' is being disposed after spending 2ms reading results.
2025-11-19 12:43:24.406 +03:00 [DBG] Closing connection to database 'GAC-BillingService' on server '.'.
2025-11-19 12:43:24.409 +03:00 [DBG] Closed connection to database 'GAC-BillingService' on server '.' (3ms).
2025-11-19 12:43:24.421 +03:00 [DBG] Opening connection to database 'GAC-BillingService' on server '.'.
2025-11-19 12:43:24.425 +03:00 [DBG] Opened connection to database 'GAC-BillingService' on server '.'.
2025-11-19 12:43:24.429 +03:00 [DBG] Beginning transaction with isolation level 'Unspecified'.
2025-11-19 12:43:24.433 +03:00 [DBG] Began transaction with isolation level 'ReadCommitted'.
2025-11-19 12:43:24.438 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-11-19 12:43:24.442 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (3ms).
2025-11-19 12:43:24.446 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (7ms).
2025-11-19 12:43:24.449 +03:00 [DBG] Executing DbCommand [Parameters=[], CommandType='"Text"', CommandTimeout='30']
EXECUTE dbo.GetNextInvoiceNumber
2025-11-19 12:43:24.459 +03:00 [INF] Executed DbCommand (10ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
EXECUTE dbo.GetNextInvoiceNumber
2025-11-19 12:43:24.464 +03:00 [DBG] Closing data reader to 'GAC-BillingService' on server '.'.
2025-11-19 12:43:24.468 +03:00 [DBG] A data reader for 'GAC-BillingService' on server '.' is being disposed after spending 4ms reading results.
2025-11-19 12:43:24.475 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-11-19 12:43:24.477 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (2ms).
2025-11-19 12:43:24.480 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (5ms).
2025-11-19 12:43:24.486 +03:00 [DBG] Executing DbCommand [Parameters=[@__cutomerIdentityNumber_0='?' (Size = 100)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[Id], [c].[Address_BuildingNumber], [c].[Address_City], [c].[Address_Country], [c].[Address_District], [c].[Address_PostalCode], [c].[Address_Street], [c].[Address_SubNumber], [c].[CreatedBy], [c].[CreatedDate], [c].[CustomerType], [c].[EmailAddress], [c].[FullName], [c].[IdentityNumber], [c].[IdentityType], [c].[IsDeleted], [c].[LastUpdatedDate], [c].[OverpaymentBalance], [c].[PhoneNumber], [c].[VATNumber]
FROM [Customers] AS [c]
WHERE [c].[IdentityNumber] = @__cutomerIdentityNumber_0
2025-11-19 12:43:24.495 +03:00 [INF] Executed DbCommand (9ms) [Parameters=[@__cutomerIdentityNumber_0='?' (Size = 100)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[Id], [c].[Address_BuildingNumber], [c].[Address_City], [c].[Address_Country], [c].[Address_District], [c].[Address_PostalCode], [c].[Address_Street], [c].[Address_SubNumber], [c].[CreatedBy], [c].[CreatedDate], [c].[CustomerType], [c].[EmailAddress], [c].[FullName], [c].[IdentityNumber], [c].[IdentityType], [c].[IsDeleted], [c].[LastUpdatedDate], [c].[OverpaymentBalance], [c].[PhoneNumber], [c].[VATNumber]
FROM [Customers] AS [c]
WHERE [c].[IdentityNumber] = @__cutomerIdentityNumber_0
2025-11-19 12:43:24.500 +03:00 [DBG] Context 'BillingServiceDBContext' started tracking 'Customer' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-11-19 12:43:24.503 +03:00 [DBG] Closing data reader to 'GAC-BillingService' on server '.'.
2025-11-19 12:43:24.506 +03:00 [DBG] A data reader for 'GAC-BillingService' on server '.' is being disposed after spending 6ms reading results.
2025-11-19 12:43:24.513 +03:00 [DBG] 'BillingServiceDBContext' generated a temporary value for the property 'Invoice.Id'. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-11-19 12:43:24.519 +03:00 [DBG] Context 'BillingServiceDBContext' started tracking 'Invoice' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-11-19 12:43:24.522 +03:00 [DBG] 'BillingServiceDBContext' generated a temporary value for the property 'InvoicesAttachment.Id'. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-11-19 12:43:24.526 +03:00 [DBG] The navigation 'InvoicesAttachment.Invoice' was detected as changed. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-11-19 12:43:24.530 +03:00 [DBG] Context 'BillingServiceDBContext' started tracking 'InvoicesAttachment' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-11-19 12:43:24.535 +03:00 [DBG] 'BillingServiceDBContext' generated a temporary value for the property 'InvoicesItem.Id'. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-11-19 12:43:24.539 +03:00 [DBG] The navigation 'InvoicesItem.Invoice' was detected as changed. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-11-19 12:43:24.542 +03:00 [DBG] Context 'BillingServiceDBContext' started tracking 'InvoicesItem' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-11-19 12:43:24.545 +03:00 [DBG] SaveChanges starting for 'BillingServiceDBContext'.
2025-11-19 12:43:24.548 +03:00 [DBG] DetectChanges starting for 'BillingServiceDBContext'.
2025-11-19 12:43:24.552 +03:00 [DBG] DetectChanges completed for 'BillingServiceDBContext'.
2025-11-19 12:43:24.556 +03:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-11-19 12:43:24.559 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-11-19 12:43:24.563 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (3ms).
2025-11-19 12:43:24.566 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (6ms).
2025-11-19 12:43:24.568 +03:00 [DBG] Executing DbCommand [Parameters=[@p0='?' (Precision = 18) (DbType = Decimal), @p1='?' (Size = 3000), @p2='?' (Size = 100), @p3='?' (Size = 50), @p4='?' (DbType = DateTime), @p5='?' (Size = 50), @p6='?' (DbType = Int64), @p7='?' (DbType = Int64), @p8='?' (DbType = DateTime), @p9='?' (DbType = Guid), @p10='?' (Size = 50), @p11='?' (DbType = Int32), @p12='?' (DbType = Int32), @p13='?' (DbType = Boolean), @p14='?' (DbType = Boolean), @p15='?' (DbType = Boolean), @p16='?' (DbType = Boolean), @p17='?' (DbType = DateTime), @p18='?' (DbType = DateTime), @p19='?' (Size = 4000), @p20='?' (Size = 100), @p21='?' (Size = 100), @p22='?' (DbType = Int64), @p23='?' (Size = 4000), @p24='?' (DbType = Int64), @p25='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [Invoices] ([Amount], [CancelationReasons], [ClientReferenceNumber], [CreatedBy], [CreatedDate], [Currency], [CustomerID], [DiscountedPrimaryInvoiceID], [DueAt], [ExternalId], [InvoiceNumber], [InvoiceStatus], [InvoiceType], [IsDeleted], [IsDiscounted], [IsSubInvoice], [IsSubstitution], [IssuedAt], [LastUpdatedDate], [Metadata], [PaymentProvider], [PaymentReference], [PrimaryInvoiceID], [ProviderResponse], [SubstitutionPrimaryInvoiceID], [TenantId])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18, @p19, @p20, @p21, @p22, @p23, @p24, @p25);
2025-11-19 12:43:24.577 +03:00 [INF] Executed DbCommand (8ms) [Parameters=[@p0='?' (Precision = 18) (DbType = Decimal), @p1='?' (Size = 3000), @p2='?' (Size = 100), @p3='?' (Size = 50), @p4='?' (DbType = DateTime), @p5='?' (Size = 50), @p6='?' (DbType = Int64), @p7='?' (DbType = Int64), @p8='?' (DbType = DateTime), @p9='?' (DbType = Guid), @p10='?' (Size = 50), @p11='?' (DbType = Int32), @p12='?' (DbType = Int32), @p13='?' (DbType = Boolean), @p14='?' (DbType = Boolean), @p15='?' (DbType = Boolean), @p16='?' (DbType = Boolean), @p17='?' (DbType = DateTime), @p18='?' (DbType = DateTime), @p19='?' (Size = 4000), @p20='?' (Size = 100), @p21='?' (Size = 100), @p22='?' (DbType = Int64), @p23='?' (Size = 4000), @p24='?' (DbType = Int64), @p25='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [Invoices] ([Amount], [CancelationReasons], [ClientReferenceNumber], [CreatedBy], [CreatedDate], [Currency], [CustomerID], [DiscountedPrimaryInvoiceID], [DueAt], [ExternalId], [InvoiceNumber], [InvoiceStatus], [InvoiceType], [IsDeleted], [IsDiscounted], [IsSubInvoice], [IsSubstitution], [IssuedAt], [LastUpdatedDate], [Metadata], [PaymentProvider], [PaymentReference], [PrimaryInvoiceID], [ProviderResponse], [SubstitutionPrimaryInvoiceID], [TenantId])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18, @p19, @p20, @p21, @p22, @p23, @p24, @p25);
2025-11-19 12:43:24.582 +03:00 [DBG] The foreign key property 'Invoice.Id' was detected as changed. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see property values.
2025-11-19 12:43:24.585 +03:00 [DBG] The foreign key property 'InvoicesAttachment.InvoiceId' was detected as changed. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see property values.
2025-11-19 12:43:24.588 +03:00 [DBG] The foreign key property 'InvoicesItem.InvoiceId' was detected as changed. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see property values.
2025-11-19 12:43:24.591 +03:00 [DBG] Closing data reader to 'GAC-BillingService' on server '.'.
2025-11-19 12:43:24.594 +03:00 [DBG] A data reader for 'GAC-BillingService' on server '.' is being disposed after spending 12ms reading results.
2025-11-19 12:43:24.598 +03:00 [DBG] Executing 2 update commands as a batch.
2025-11-19 12:43:24.601 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-11-19 12:43:24.606 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (4ms).
2025-11-19 12:43:24.610 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (8ms).
2025-11-19 12:43:24.612 +03:00 [DBG] Executing DbCommand [Parameters=[@p26='?' (Size = 50), @p27='?' (DbType = DateTime), @p28='?' (Size = 200), @p29='?' (DbType = Int64), @p30='?' (DbType = Boolean), @p31='?' (Precision = 18) (DbType = Decimal), @p32='?' (Size = 50), @p33='?' (DbType = DateTime), @p34='?' (DbType = Int64), @p35='?' (DbType = Boolean), @p36='?' (Size = 500), @p37='?' (Size = 200), @p38='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SET NOCOUNT ON;
INSERT INTO [InvoicesAttachments] ([CreatedBy], [CreatedDate], [FileName], [InvoiceId], [IsDeleted])
OUTPUT INSERTED.[Id]
VALUES (@p26, @p27, @p28, @p29, @p30);
INSERT INTO [InvoicesItems] ([Amount], [CreatedBy], [CreatedDate], [InvoiceId], [IsDeleted], [ItemDesc], [ItemName], [Quantity])
OUTPUT INSERTED.[Id]
VALUES (@p31, @p32, @p33, @p34, @p35, @p36, @p37, @p38);
2025-11-19 12:43:24.619 +03:00 [INF] Executed DbCommand (7ms) [Parameters=[@p26='?' (Size = 50), @p27='?' (DbType = DateTime), @p28='?' (Size = 200), @p29='?' (DbType = Int64), @p30='?' (DbType = Boolean), @p31='?' (Precision = 18) (DbType = Decimal), @p32='?' (Size = 50), @p33='?' (DbType = DateTime), @p34='?' (DbType = Int64), @p35='?' (DbType = Boolean), @p36='?' (Size = 500), @p37='?' (Size = 200), @p38='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SET NOCOUNT ON;
INSERT INTO [InvoicesAttachments] ([CreatedBy], [CreatedDate], [FileName], [InvoiceId], [IsDeleted])
OUTPUT INSERTED.[Id]
VALUES (@p26, @p27, @p28, @p29, @p30);
INSERT INTO [InvoicesItems] ([Amount], [CreatedBy], [CreatedDate], [InvoiceId], [IsDeleted], [ItemDesc], [ItemName], [Quantity])
OUTPUT INSERTED.[Id]
VALUES (@p31, @p32, @p33, @p34, @p35, @p36, @p37, @p38);
2025-11-19 12:43:24.625 +03:00 [DBG] The foreign key property 'InvoicesAttachment.Id' was detected as changed. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see property values.
2025-11-19 12:43:24.628 +03:00 [DBG] The foreign key property 'InvoicesItem.Id' was detected as changed. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see property values.
2025-11-19 12:43:24.632 +03:00 [DBG] Closing data reader to 'GAC-BillingService' on server '.'.
2025-11-19 12:43:24.634 +03:00 [DBG] A data reader for 'GAC-BillingService' on server '.' is being disposed after spending 9ms reading results.
2025-11-19 12:43:24.639 +03:00 [DBG] An entity of type 'Invoice' tracked by 'BillingServiceDBContext' changed state from '"Added"' to '"Unchanged"'. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-11-19 12:43:24.643 +03:00 [DBG] An entity of type 'InvoicesAttachment' tracked by 'BillingServiceDBContext' changed state from '"Added"' to '"Unchanged"'. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-11-19 12:43:24.649 +03:00 [DBG] An entity of type 'InvoicesItem' tracked by 'BillingServiceDBContext' changed state from '"Added"' to '"Unchanged"'. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-11-19 12:43:24.652 +03:00 [DBG] SaveChanges completed for 'BillingServiceDBContext' with 3 entities written to the database.
2025-11-19 12:43:24.657 +03:00 [DBG] 'BillingServiceDBContext' generated a temporary value for the property 'OutboxEvent.Id'. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-11-19 12:43:24.660 +03:00 [DBG] Context 'BillingServiceDBContext' started tracking 'OutboxEvent' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-11-19 12:43:24.664 +03:00 [DBG] 'BillingServiceDBContext' generated a temporary value for the property 'AuditEvent.Id'. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-11-19 12:43:24.666 +03:00 [DBG] Context 'BillingServiceDBContext' started tracking 'AuditEvent' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-11-19 12:43:24.672 +03:00 [DBG] SaveChanges starting for 'BillingServiceDBContext'.
2025-11-19 12:43:24.675 +03:00 [DBG] DetectChanges starting for 'BillingServiceDBContext'.
2025-11-19 12:43:24.678 +03:00 [DBG] DetectChanges completed for 'BillingServiceDBContext'.
2025-11-19 12:43:24.680 +03:00 [DBG] Executing 2 update commands as a batch.
2025-11-19 12:43:24.682 +03:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-11-19 12:43:24.685 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-11-19 12:43:24.691 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (5ms).
2025-11-19 12:43:24.694 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (9ms).
2025-11-19 12:43:24.701 +03:00 [DBG] Executing DbCommand [Parameters=[@p0='?' (Size = 100), @p1='?' (Size = 4000), @p2='?' (Size = 50), @p3='?' (DbType = DateTime), @p4='?' (Size = 500), @p5='?' (Size = 20), @p6='?' (Size = 100), @p7='?' (Size = 100), @p8='?' (DbType = Int64), @p9='?' (DbType = DateTime), @p10='?' (Size = 4000), @p11='?' (Size = 300), @p12='?' (Size = 4000), @p13='?' (DbType = Boolean), @p14='?' (Size = 20) (DbType = AnsiString)], CommandType='"Text"', CommandTimeout='30']
SET NOCOUNT ON;
INSERT INTO [audit].[AuditEvents] ([Action], [Changes], [CreatedBy], [CreatedDate], [Description], [EntityId], [EntityType], [UserId])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
INSERT INTO [Outbox_events] ([Aggregate_id], [CreatedDate], [ErrorMsg], [Event_type], [Payload], [Processed], [ProcessingStatus])
OUTPUT INSERTED.[Id]
VALUES (@p8, @p9, @p10, @p11, @p12, @p13, @p14);
2025-11-19 12:43:24.710 +03:00 [INF] Executed DbCommand (9ms) [Parameters=[@p0='?' (Size = 100), @p1='?' (Size = 4000), @p2='?' (Size = 50), @p3='?' (DbType = DateTime), @p4='?' (Size = 500), @p5='?' (Size = 20), @p6='?' (Size = 100), @p7='?' (Size = 100), @p8='?' (DbType = Int64), @p9='?' (DbType = DateTime), @p10='?' (Size = 4000), @p11='?' (Size = 300), @p12='?' (Size = 4000), @p13='?' (DbType = Boolean), @p14='?' (Size = 20) (DbType = AnsiString)], CommandType='"Text"', CommandTimeout='30']
SET NOCOUNT ON;
INSERT INTO [audit].[AuditEvents] ([Action], [Changes], [CreatedBy], [CreatedDate], [Description], [EntityId], [EntityType], [UserId])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
INSERT INTO [Outbox_events] ([Aggregate_id], [CreatedDate], [ErrorMsg], [Event_type], [Payload], [Processed], [ProcessingStatus])
OUTPUT INSERTED.[Id]
VALUES (@p8, @p9, @p10, @p11, @p12, @p13, @p14);
2025-11-19 12:43:24.715 +03:00 [DBG] The foreign key property 'AuditEvent.Id' was detected as changed. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see property values.
2025-11-19 12:43:24.718 +03:00 [DBG] The foreign key property 'OutboxEvent.Id' was detected as changed. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see property values.
2025-11-19 12:43:24.721 +03:00 [DBG] Closing data reader to 'GAC-BillingService' on server '.'.
2025-11-19 12:43:24.724 +03:00 [DBG] A data reader for 'GAC-BillingService' on server '.' is being disposed after spending 9ms reading results.
2025-11-19 12:43:24.728 +03:00 [DBG] An entity of type 'AuditEvent' tracked by 'BillingServiceDBContext' changed state from '"Added"' to '"Unchanged"'. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-11-19 12:43:24.732 +03:00 [DBG] An entity of type 'OutboxEvent' tracked by 'BillingServiceDBContext' changed state from '"Added"' to '"Unchanged"'. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-11-19 12:43:24.736 +03:00 [DBG] SaveChanges completed for 'BillingServiceDBContext' with 2 entities written to the database.
2025-11-19 12:43:24.739 +03:00 [DBG] Committing transaction.
2025-11-19 12:43:24.750 +03:00 [DBG] Committed transaction.
2025-11-19 12:43:24.752 +03:00 [DBG] Closing connection to database 'GAC-BillingService' on server '.'.
2025-11-19 12:43:24.756 +03:00 [DBG] Closed connection to database 'GAC-BillingService' on server '.' (3ms).
2025-11-19 12:43:24.760 +03:00 [DBG] Disposing transaction.
2025-11-19 12:43:24.762 +03:00 [DBG] List of registered output formatters, in the following order: ["Microsoft.AspNetCore.Mvc.Formatters.HttpNoContentOutputFormatter","Microsoft.AspNetCore.Mvc.Formatters.StringOutputFormatter","Microsoft.AspNetCore.Mvc.Formatters.StreamOutputFormatter","Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonOutputFormatter"]
2025-11-19 12:43:24.766 +03:00 [DBG] No information found on request to perform content negotiation.
2025-11-19 12:43:24.768 +03:00 [DBG] Attempting to select the first output formatter in the output formatters list which supports a content type from the explicitly specified content types '["application/json"]'.
2025-11-19 12:43:24.772 +03:00 [DBG] Selected output formatter 'Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonOutputFormatter' and content type 'application/json' to write the response.
2025-11-19 12:43:24.774 +03:00 [INF] Executing OkObjectResult, writing value of type 'BillingSystem.SharedKernel.ApiResponse`1[[System.Int64, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-11-19 12:43:24.779 +03:00 [INF] Executed action BillingSystem.API.Controllers.InvoicesController.Post (BillingSystem.API) in 544.7906ms
2025-11-19 12:43:24.782 +03:00 [INF] Executed endpoint 'BillingSystem.API.Controllers.InvoicesController.Post (BillingSystem.API)'
2025-11-19 12:43:24.785 +03:00 [INF] HTTP POST /api/Invoices responded 200 in 622.5924 ms
2025-11-19 12:43:24.789 +03:00 [DBG] Connection id "0HNH79TO88F87" completed keep alive response.
2025-11-19 12:43:24.791 +03:00 [DBG] 'BillingServiceDBContext' disposed.
2025-11-19 12:43:24.794 +03:00 [DBG] Disposing connection to database 'GAC-BillingService' on server '.'.
2025-11-19 12:43:24.797 +03:00 [DBG] Disposed connection to database '' on server '' (2ms).
2025-11-19 12:43:24.800 +03:00 [INF] Request finished HTTP/1.1 POST https://localhost:7257/api/Invoices - 200 null application/json; charset=utf-8 660.2951ms
2025-11-19 12:46:03.510 +03:00 [DBG] Registered model binder providers, in the following order: ["Microsoft.AspNetCore.Mvc.ModelBinding.Binders.BinderTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ServicesModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.BodyModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.HeaderModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FloatingPointTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.EnumTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.DateTimeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.SimpleTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.TryParseModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.CancellationTokenModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ByteArrayModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FormFileModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FormCollectionModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.KeyValuePairModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.DictionaryModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ArrayModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.CollectionModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ComplexObjectModelBinderProvider"]
2025-11-19 12:46:03.673 +03:00 [DBG] Hosting starting
2025-11-19 12:47:23.669 +03:00 [DBG] Registered model binder providers, in the following order: ["Microsoft.AspNetCore.Mvc.ModelBinding.Binders.BinderTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ServicesModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.BodyModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.HeaderModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FloatingPointTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.EnumTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.DateTimeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.SimpleTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.TryParseModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.CancellationTokenModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ByteArrayModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FormFileModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FormCollectionModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.KeyValuePairModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.DictionaryModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ArrayModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.CollectionModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ComplexObjectModelBinderProvider"]
2025-11-19 12:47:29.807 +03:00 [DBG] Hosting starting
2025-11-19 12:47:34.350 +03:00 [DBG] Starting bus instances: IBus
2025-11-19 12:47:34.359 +03:00 [DBG] Starting bus: "rabbitmq://localhost/"
2025-11-19 12:47:34.397 +03:00 [DBG] Middleware loaded
2025-11-19 12:47:34.407 +03:00 [DBG] Middleware loaded. Script /_framework/aspnetcore-browser-refresh.js (16519 B).
2025-11-19 12:47:34.422 +03:00 [DBG] Middleware loaded. Script /_framework/blazor-hotreload.js (799 B).
2025-11-19 12:47:34.427 +03:00 [DBG] Connect: guest@localhost:5672/
2025-11-19 12:47:35.067 +03:00 [DBG] Middleware loaded: DOTNET_MODIFIABLE_ASSEMBLIES=debug, __ASPNETCORE_BROWSER_TOOLS=true
2025-11-19 12:47:40.244 +03:00 [DBG] Connected: guest@localhost:5672/ (address: amqp://localhost:5672, local: 49750)
2025-11-19 12:47:41.707 +03:00 [DBG] Endpoint Ready: "rabbitmq://localhost/ECHGHANNAMLP1_BillingSystemAPI_bus_mboyyyyh3bcsyi8nbdxnqwfe86?temporary=true"
2025-11-19 12:47:41.711 +03:00 [INF] Bus started: "rabbitmq://localhost/"
2025-11-19 12:47:44.145 +03:00 [DBG] Connection id "0HNH7A2O4C9V2" accepted.
2025-11-19 12:47:44.146 +03:00 [DBG] Connection id "0HNH7A2O4C9V2" received FIN.
2025-11-19 12:47:44.154 +03:00 [DBG] Connection id "0HNH7A2O4C9V2" started.
2025-11-19 12:47:44.159 +03:00 [INF] Now listening on: https://localhost:7257
2025-11-19 12:47:44.172 +03:00 [INF] Now listening on: http://localhost:5009
2025-11-19 12:47:44.179 +03:00 [DBG] Loaded hosting startup assembly BillingSystem.API
2025-11-19 12:47:44.187 +03:00 [DBG] Loaded hosting startup assembly Microsoft.WebTools.ApiEndpointDiscovery
2025-11-19 12:47:44.193 +03:00 [DBG] Loaded hosting startup assembly Microsoft.AspNetCore.Watch.BrowserRefresh
2025-11-19 12:47:44.199 +03:00 [DBG] Loaded hosting startup assembly Microsoft.WebTools.BrowserLink.Net
2025-11-19 12:47:44.209 +03:00 [DBG] Failed to authenticate HTTPS connection.
System.IO.IOException: Received an unexpected EOF or 0 bytes from the transport stream.
   at System.Net.Security.SslStream.ReceiveHandshakeFrameAsync[TIOAdapter](CancellationToken cancellationToken)
   at System.Net.Security.SslStream.ForceAuthenticationAsync[TIOAdapter](Boolean receiveFirst, Byte[] reAuthenticationData, CancellationToken cancellationToken)
   at System.Net.Security.SslStream.ProcessAuthenticationWithTelemetryAsync(Boolean isAsync, CancellationToken cancellationToken)
   at Microsoft.AspNetCore.Server.Kestrel.Https.Internal.HttpsConnectionMiddleware.OnConnectionAsync(ConnectionContext context)
2025-11-19 12:47:44.264 +03:00 [DBG] Connection id "0HNH7A2O4C9V2" stopped.
2025-11-19 12:47:44.282 +03:00 [DBG] Connection id "0HNH7A2O4C9V2" sending FIN because: "The Socket transport's send loop completed gracefully."
2025-11-19 12:47:44.397 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-11-19 12:47:44.407 +03:00 [INF] Hosting environment: Development
2025-11-19 12:47:44.422 +03:00 [INF] Content root path: C:\Repositories\Gac-BillingSystem\src\BillingSystem.API
2025-11-19 12:47:44.426 +03:00 [DBG] Hosting started
2025-11-19 12:47:44.899 +03:00 [DBG] Connection id "0HNH7A2O4C9V3" accepted.
2025-11-19 12:47:44.902 +03:00 [DBG] Connection id "0HNH7A2O4C9V3" started.
2025-11-19 12:47:44.968 +03:00 [DBG] Connection 0HNH7A2O4C9V3 established using the following protocol: "Tls13"
2025-11-19 12:47:45.057 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7257/swagger/index.html - null null
2025-11-19 12:47:45.126 +03:00 [DBG] Wildcard detected, all requests with hosts will be allowed.
2025-11-19 12:47:45.151 +03:00 [DBG] No candidates found for the request path '/swagger/index.html'
2025-11-19 12:47:45.155 +03:00 [DBG] Request did not match any endpoints
2025-11-19 12:47:45.232 +03:00 [DBG] Response markup is scheduled to include Browser Link script injection.
2025-11-19 12:47:45.236 +03:00 [DBG] Response markup is scheduled to include browser refresh script injection.
2025-11-19 12:47:45.265 +03:00 [INF] HTTP GET /swagger/index.html responded 200 in 101.4373 ms
2025-11-19 12:47:45.273 +03:00 [DBG] Response markup was updated to include Browser Link script injection.
2025-11-19 12:47:45.275 +03:00 [DBG] Response markup was updated to include browser refresh script injection.
2025-11-19 12:47:45.282 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7257/swagger/index.html - 200 null text/html;charset=utf-8 237.4682ms
2025-11-19 12:47:45.290 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7257/_framework/aspnetcore-browser-refresh.js - null null
2025-11-19 12:47:45.306 +03:00 [DBG] Script injected: /_framework/aspnetcore-browser-refresh.js
2025-11-19 12:47:45.313 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7257/_framework/aspnetcore-browser-refresh.js - 200 16519 application/javascript; charset=utf-8 23.1379ms
2025-11-19 12:47:45.338 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7257/_vs/browserLink - null null
2025-11-19 12:47:45.402 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7257/_vs/browserLink - 200 null text/javascript; charset=UTF-8 65.2339ms
2025-11-19 12:47:45.526 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7257/swagger/v1/swagger.json - null null
2025-11-19 12:47:45.534 +03:00 [DBG] No candidates found for the request path '/swagger/v1/swagger.json'
2025-11-19 12:47:45.537 +03:00 [DBG] Request did not match any endpoints
2025-11-19 12:47:45.565 +03:00 [INF] HTTP GET /swagger/v1/swagger.json responded 200 in 18.2194 ms
2025-11-19 12:47:45.574 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7257/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 48.2247ms
2025-11-19 12:49:00.116 +03:00 [DBG] Registered model binder providers, in the following order: ["Microsoft.AspNetCore.Mvc.ModelBinding.Binders.BinderTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ServicesModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.BodyModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.HeaderModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FloatingPointTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.EnumTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.DateTimeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.SimpleTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.TryParseModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.CancellationTokenModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ByteArrayModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FormFileModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FormCollectionModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.KeyValuePairModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.DictionaryModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ArrayModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.CollectionModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ComplexObjectModelBinderProvider"]
2025-11-19 12:49:01.269 +03:00 [DBG] Hosting starting
2025-11-19 12:49:01.612 +03:00 [DBG] Starting bus instances: IBus
2025-11-19 12:49:01.619 +03:00 [DBG] Starting bus: "rabbitmq://localhost/"
2025-11-19 12:49:01.645 +03:00 [DBG] Middleware loaded
2025-11-19 12:49:01.649 +03:00 [DBG] Middleware loaded. Script /_framework/aspnetcore-browser-refresh.js (16519 B).
2025-11-19 12:49:01.654 +03:00 [DBG] Middleware loaded. Script /_framework/blazor-hotreload.js (799 B).
2025-11-19 12:49:01.670 +03:00 [DBG] Connect: guest@localhost:5672/
2025-11-19 12:49:01.840 +03:00 [DBG] Middleware loaded: DOTNET_MODIFIABLE_ASSEMBLIES=debug, __ASPNETCORE_BROWSER_TOOLS=true
2025-11-19 12:49:01.875 +03:00 [DBG] Connected: guest@localhost:5672/ (address: amqp://localhost:5672, local: 60957)
2025-11-19 12:49:01.936 +03:00 [DBG] Endpoint Ready: "rabbitmq://localhost/ECHGHANNAMLP1_BillingSystemAPI_bus_udcoyyyh3bcsy974bdxnqwg6df?temporary=true"
2025-11-19 12:49:01.941 +03:00 [INF] Bus started: "rabbitmq://localhost/"
2025-11-19 12:49:02.159 +03:00 [INF] Now listening on: https://localhost:7257
2025-11-19 12:49:02.163 +03:00 [INF] Now listening on: http://localhost:5009
2025-11-19 12:49:02.166 +03:00 [DBG] Loaded hosting startup assembly BillingSystem.API
2025-11-19 12:49:02.168 +03:00 [DBG] Loaded hosting startup assembly Microsoft.WebTools.ApiEndpointDiscovery
2025-11-19 12:49:02.171 +03:00 [DBG] Loaded hosting startup assembly Microsoft.AspNetCore.Watch.BrowserRefresh
2025-11-19 12:49:02.174 +03:00 [DBG] Loaded hosting startup assembly Microsoft.WebTools.BrowserLink.Net
2025-11-19 12:49:02.291 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-11-19 12:49:02.294 +03:00 [INF] Hosting environment: Development
2025-11-19 12:49:02.298 +03:00 [INF] Content root path: C:\Repositories\Gac-BillingSystem\src\BillingSystem.API
2025-11-19 12:49:02.301 +03:00 [DBG] Hosting started
2025-11-19 12:49:02.370 +03:00 [DBG] Connection id "0HNH7A3FECSL6" accepted.
2025-11-19 12:49:02.376 +03:00 [DBG] Connection id "0HNH7A3FECSL6" started.
2025-11-19 12:49:02.378 +03:00 [DBG] Connection id "0HNH7A3FECSL6" received FIN.
2025-11-19 12:49:02.406 +03:00 [DBG] Failed to authenticate HTTPS connection.
System.IO.IOException: Received an unexpected EOF or 0 bytes from the transport stream.
   at System.Net.Security.SslStream.ReceiveHandshakeFrameAsync[TIOAdapter](CancellationToken cancellationToken)
   at System.Net.Security.SslStream.ForceAuthenticationAsync[TIOAdapter](Boolean receiveFirst, Byte[] reAuthenticationData, CancellationToken cancellationToken)
   at System.Net.Security.SslStream.ProcessAuthenticationWithTelemetryAsync(Boolean isAsync, CancellationToken cancellationToken)
   at Microsoft.AspNetCore.Server.Kestrel.Https.Internal.HttpsConnectionMiddleware.OnConnectionAsync(ConnectionContext context)
2025-11-19 12:49:02.445 +03:00 [DBG] Connection id "0HNH7A3FECSL6" stopped.
2025-11-19 12:49:02.460 +03:00 [DBG] Connection id "0HNH7A3FECSL6" sending FIN because: "The Socket transport's send loop completed gracefully."
2025-11-19 12:49:03.645 +03:00 [DBG] Connection id "0HNH7A3FECSL7" accepted.
2025-11-19 12:49:03.653 +03:00 [DBG] Connection id "0HNH7A3FECSL7" started.
2025-11-19 12:49:04.793 +03:00 [DBG] Connection 0HNH7A3FECSL7 established using the following protocol: "Tls13"
2025-11-19 12:49:07.164 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7257/swagger/index.html - null null
2025-11-19 12:49:08.254 +03:00 [DBG] Wildcard detected, all requests with hosts will be allowed.
2025-11-19 12:49:08.298 +03:00 [DBG] No candidates found for the request path '/swagger/index.html'
2025-11-19 12:49:08.304 +03:00 [DBG] Request did not match any endpoints
2025-11-19 12:49:08.384 +03:00 [DBG] Response markup is scheduled to include Browser Link script injection.
2025-11-19 12:49:08.388 +03:00 [DBG] Response markup is scheduled to include browser refresh script injection.
2025-11-19 12:49:08.413 +03:00 [INF] HTTP GET /swagger/index.html responded 200 in 98.9169 ms
2025-11-19 12:49:08.961 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7257/_vs/browserLink - null null
2025-11-19 12:49:08.961 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7257/_framework/aspnetcore-browser-refresh.js - null null
2025-11-19 12:49:08.964 +03:00 [DBG] Response markup was updated to include Browser Link script injection.
2025-11-19 12:49:08.999 +03:00 [DBG] Response markup was updated to include browser refresh script injection.
2025-11-19 12:49:09.002 +03:00 [DBG] Script injected: /_framework/aspnetcore-browser-refresh.js
2025-11-19 12:49:09.011 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7257/swagger/index.html - 200 null text/html;charset=utf-8 2942.3687ms
2025-11-19 12:49:09.012 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7257/_framework/aspnetcore-browser-refresh.js - 200 16519 application/javascript; charset=utf-8 51.9759ms
2025-11-19 12:49:09.057 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7257/_vs/browserLink - 200 null text/javascript; charset=UTF-8 98.4793ms
2025-11-19 12:49:09.118 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7257/swagger/v1/swagger.json - null null
2025-11-19 12:49:09.124 +03:00 [DBG] No candidates found for the request path '/swagger/v1/swagger.json'
2025-11-19 12:49:09.127 +03:00 [DBG] Request did not match any endpoints
2025-11-19 12:49:09.154 +03:00 [INF] HTTP GET /swagger/v1/swagger.json responded 200 in 21.8941 ms
2025-11-19 12:49:09.164 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7257/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 46.9588ms
2025-11-19 12:57:02.281 +03:00 [DBG] Registered model binder providers, in the following order: ["Microsoft.AspNetCore.Mvc.ModelBinding.Binders.BinderTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ServicesModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.BodyModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.HeaderModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FloatingPointTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.EnumTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.DateTimeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.SimpleTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.TryParseModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.CancellationTokenModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ByteArrayModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FormFileModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FormCollectionModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.KeyValuePairModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.DictionaryModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ArrayModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.CollectionModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ComplexObjectModelBinderProvider"]
2025-11-19 12:57:02.469 +03:00 [DBG] Hosting starting
2025-11-19 12:57:02.866 +03:00 [DBG] Starting bus instances: IBus
2025-11-19 12:57:02.875 +03:00 [DBG] Starting bus: "rabbitmq://localhost/"
2025-11-19 12:57:02.908 +03:00 [DBG] Middleware loaded
2025-11-19 12:57:02.914 +03:00 [DBG] Middleware loaded. Script /_framework/aspnetcore-browser-refresh.js (16519 B).
2025-11-19 12:57:02.919 +03:00 [DBG] Middleware loaded. Script /_framework/blazor-hotreload.js (799 B).
2025-11-19 12:57:02.940 +03:00 [DBG] Connect: guest@localhost:5672/
2025-11-19 12:57:03.097 +03:00 [DBG] Middleware loaded: DOTNET_MODIFIABLE_ASSEMBLIES=debug, __ASPNETCORE_BROWSER_TOOLS=true
2025-11-19 12:57:03.127 +03:00 [DBG] Connected: guest@localhost:5672/ (address: amqp://localhost:5672, local: 65090)
2025-11-19 12:57:03.186 +03:00 [DBG] Endpoint Ready: "rabbitmq://localhost/ECHGHANNAMLP1_BillingSystemAPI_bus_obdoyyyh3bcsyw6mbdxnqwx7b7?temporary=true"
2025-11-19 12:57:03.191 +03:00 [INF] Bus started: "rabbitmq://localhost/"
2025-11-19 12:57:03.425 +03:00 [INF] Now listening on: https://localhost:7257
2025-11-19 12:57:03.429 +03:00 [INF] Now listening on: http://localhost:5009
2025-11-19 12:57:03.433 +03:00 [DBG] Loaded hosting startup assembly BillingSystem.API
2025-11-19 12:57:03.435 +03:00 [DBG] Loaded hosting startup assembly Microsoft.WebTools.ApiEndpointDiscovery
2025-11-19 12:57:03.437 +03:00 [DBG] Loaded hosting startup assembly Microsoft.AspNetCore.Watch.BrowserRefresh
2025-11-19 12:57:03.439 +03:00 [DBG] Loaded hosting startup assembly Microsoft.WebTools.BrowserLink.Net
2025-11-19 12:57:03.594 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-11-19 12:57:03.596 +03:00 [INF] Hosting environment: Development
2025-11-19 12:57:03.598 +03:00 [INF] Content root path: C:\Repositories\Gac-BillingSystem\src\BillingSystem.API
2025-11-19 12:57:03.600 +03:00 [DBG] Hosting started
2025-11-19 12:57:03.712 +03:00 [DBG] Connection id "0HNH7A7USQK51" accepted.
2025-11-19 12:57:03.714 +03:00 [DBG] Connection id "0HNH7A7USQK52" accepted.
2025-11-19 12:57:03.717 +03:00 [DBG] Connection id "0HNH7A7USQK51" started.
2025-11-19 12:57:03.719 +03:00 [DBG] Connection id "0HNH7A7USQK52" started.
2025-11-19 12:57:03.738 +03:00 [DBG] Connection id "0HNH7A7USQK51" received FIN.
2025-11-19 12:57:03.738 +03:00 [DBG] Connection id "0HNH7A7USQK52" received FIN.
2025-11-19 12:57:03.765 +03:00 [DBG] Failed to authenticate HTTPS connection.
System.IO.IOException: Received an unexpected EOF or 0 bytes from the transport stream.
   at System.Net.Security.SslStream.ReceiveHandshakeFrameAsync[TIOAdapter](CancellationToken cancellationToken)
   at System.Net.Security.SslStream.ForceAuthenticationAsync[TIOAdapter](Boolean receiveFirst, Byte[] reAuthenticationData, CancellationToken cancellationToken)
   at System.Net.Security.SslStream.ProcessAuthenticationWithTelemetryAsync(Boolean isAsync, CancellationToken cancellationToken)
   at Microsoft.AspNetCore.Server.Kestrel.Https.Internal.HttpsConnectionMiddleware.OnConnectionAsync(ConnectionContext context)
2025-11-19 12:57:03.765 +03:00 [DBG] Failed to authenticate HTTPS connection.
System.IO.IOException: Received an unexpected EOF or 0 bytes from the transport stream.
   at System.Net.Security.SslStream.ReceiveHandshakeFrameAsync[TIOAdapter](CancellationToken cancellationToken)
   at System.Net.Security.SslStream.ForceAuthenticationAsync[TIOAdapter](Boolean receiveFirst, Byte[] reAuthenticationData, CancellationToken cancellationToken)
   at System.Net.Security.SslStream.ProcessAuthenticationWithTelemetryAsync(Boolean isAsync, CancellationToken cancellationToken)
   at Microsoft.AspNetCore.Server.Kestrel.Https.Internal.HttpsConnectionMiddleware.OnConnectionAsync(ConnectionContext context)
2025-11-19 12:57:03.803 +03:00 [DBG] Connection id "0HNH7A7USQK52" stopped.
2025-11-19 12:57:03.803 +03:00 [DBG] Connection id "0HNH7A7USQK51" stopped.
2025-11-19 12:57:03.819 +03:00 [DBG] Connection id "0HNH7A7USQK51" sending FIN because: "The Socket transport's send loop completed gracefully."
2025-11-19 12:57:03.819 +03:00 [DBG] Connection id "0HNH7A7USQK52" sending FIN because: "The Socket transport's send loop completed gracefully."
2025-11-19 12:57:04.496 +03:00 [DBG] Connection id "0HNH7A7USQK53" accepted.
2025-11-19 12:57:04.500 +03:00 [DBG] Connection id "0HNH7A7USQK53" started.
2025-11-19 12:57:04.563 +03:00 [DBG] Connection 0HNH7A7USQK53 established using the following protocol: "Tls13"
2025-11-19 12:57:04.648 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7257/swagger/index.html - null null
2025-11-19 12:57:04.715 +03:00 [DBG] Wildcard detected, all requests with hosts will be allowed.
2025-11-19 12:57:04.739 +03:00 [DBG] No candidates found for the request path '/swagger/index.html'
2025-11-19 12:57:04.744 +03:00 [DBG] Request did not match any endpoints
2025-11-19 12:57:04.837 +03:00 [DBG] Response markup is scheduled to include Browser Link script injection.
2025-11-19 12:57:04.842 +03:00 [DBG] Response markup is scheduled to include browser refresh script injection.
2025-11-19 12:57:04.871 +03:00 [INF] HTTP GET /swagger/index.html responded 200 in 116.6184 ms
2025-11-19 12:57:04.879 +03:00 [DBG] Response markup was updated to include Browser Link script injection.
2025-11-19 12:57:04.883 +03:00 [DBG] Response markup was updated to include browser refresh script injection.
2025-11-19 12:57:04.890 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7257/swagger/index.html - 200 null text/html;charset=utf-8 254.3778ms
2025-11-19 12:57:04.974 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7257/_framework/aspnetcore-browser-refresh.js - null null
2025-11-19 12:57:04.974 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7257/_vs/browserLink - null null
2025-11-19 12:57:04.989 +03:00 [DBG] Script injected: /_framework/aspnetcore-browser-refresh.js
2025-11-19 12:57:04.995 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7257/_framework/aspnetcore-browser-refresh.js - 200 16519 application/javascript; charset=utf-8 22.1273ms
2025-11-19 12:57:05.055 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7257/_vs/browserLink - 200 null text/javascript; charset=UTF-8 81.5555ms
2025-11-19 12:57:05.139 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7257/swagger/v1/swagger.json - null null
2025-11-19 12:57:05.146 +03:00 [DBG] No candidates found for the request path '/swagger/v1/swagger.json'
2025-11-19 12:57:05.149 +03:00 [DBG] Request did not match any endpoints
2025-11-19 12:57:05.172 +03:00 [INF] HTTP GET /swagger/v1/swagger.json responded 200 in 19.6224 ms
2025-11-19 12:57:05.180 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7257/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 41.876ms
2025-11-19 12:57:26.032 +03:00 [DBG] Connection id "0HNH7A7USQK54" accepted.
2025-11-19 12:57:26.033 +03:00 [DBG] Connection id "0HNH7A7USQK54" received FIN.
2025-11-19 12:57:26.042 +03:00 [DBG] Connection id "0HNH7A7USQK54" started.
2025-11-19 12:57:26.043 +03:00 [DBG] Connection id "0HNH7A7USQK55" accepted.
2025-11-19 12:57:26.070 +03:00 [DBG] Failed to authenticate HTTPS connection.
System.IO.IOException: Received an unexpected EOF or 0 bytes from the transport stream.
   at System.Net.Security.SslStream.ReceiveHandshakeFrameAsync[TIOAdapter](CancellationToken cancellationToken)
   at System.Net.Security.SslStream.ForceAuthenticationAsync[TIOAdapter](Boolean receiveFirst, Byte[] reAuthenticationData, CancellationToken cancellationToken)
   at System.Net.Security.SslStream.ProcessAuthenticationWithTelemetryAsync(Boolean isAsync, CancellationToken cancellationToken)
   at Microsoft.AspNetCore.Server.Kestrel.Https.Internal.HttpsConnectionMiddleware.OnConnectionAsync(ConnectionContext context)
2025-11-19 12:57:26.074 +03:00 [DBG] Connection id "0HNH7A7USQK55" started.
2025-11-19 12:57:26.082 +03:00 [DBG] Connection id "0HNH7A7USQK54" stopped.
2025-11-19 12:57:26.089 +03:00 [DBG] Connection id "0HNH7A7USQK54" sending FIN because: "The Socket transport's send loop completed gracefully."
2025-11-19 12:57:26.089 +03:00 [DBG] Connection 0HNH7A7USQK55 established using the following protocol: "Tls13"
2025-11-19 12:57:26.099 +03:00 [INF] Request starting HTTP/1.1 POST https://localhost:7257/api/Invoices - application/json 1387
2025-11-19 12:57:26.110 +03:00 [DBG] 1 candidate(s) found for the request path '/api/Invoices'
2025-11-19 12:57:26.123 +03:00 [DBG] Endpoint 'BillingSystem.API.Controllers.InvoicesController.Post (BillingSystem.API)' with route pattern 'api/Invoices' is valid for the request path '/api/Invoices'
2025-11-19 12:57:26.136 +03:00 [DBG] Request matched endpoint 'BillingSystem.API.Controllers.InvoicesController.Post (BillingSystem.API)'
2025-11-19 12:57:26.151 +03:00 [DBG] Static files was skipped as the request already matched an endpoint.
2025-11-19 12:57:26.365 +03:00 [DBG] An 'IServiceProvider' was created for internal use by Entity Framework.
2025-11-19 12:57:31.835 +03:00 [INF] Executing endpoint 'BillingSystem.API.Controllers.InvoicesController.Post (BillingSystem.API)'
2025-11-19 12:57:31.882 +03:00 [INF] Route matched with {action = "Post", controller = "Invoices"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Post(BillingSystem.Application.Requests.CreateInvoiceRequest) on controller BillingSystem.API.Controllers.InvoicesController (BillingSystem.API).
2025-11-19 12:57:31.892 +03:00 [DBG] Execution plan of authorization filters (in the following order): ["None"]
2025-11-19 12:57:31.896 +03:00 [DBG] Execution plan of resource filters (in the following order): ["None"]
2025-11-19 12:57:31.900 +03:00 [DBG] Execution plan of action filters (in the following order): ["Microsoft.AspNetCore.Mvc.ModelBinding.UnsupportedContentTypeFilter (Order: -3000)","Microsoft.AspNetCore.Mvc.Infrastructure.ModelStateInvalidFilter (Order: -2000)","BillingSystem.API.ActionFilters.AuditBillingRequestsFilter","BillingSystem.API.ActionFilters.IdempotencyFilter (Order: 0)"]
2025-11-19 12:57:31.906 +03:00 [DBG] Execution plan of exception filters (in the following order): ["None"]
2025-11-19 12:57:31.911 +03:00 [DBG] Execution plan of result filters (in the following order): ["Microsoft.AspNetCore.Mvc.Infrastructure.ClientErrorResultFilter (Order: -2000)","Microsoft.AspNetCore.Mvc.ProducesAttribute (Order: 0)","BillingSystem.API.ActionFilters.IdempotencyFilter (Order: 0)"]
2025-11-19 12:57:31.919 +03:00 [DBG] Executing controller factory for controller BillingSystem.API.Controllers.InvoicesController (BillingSystem.API)
2025-11-19 12:57:31.929 +03:00 [WRN] You do not have a valid license key for the Lucky Penny software MediatR. This is allowed for development and testing scenarios. If you are running in production you are required to have a licensed version. Please visit https://luckypennysoftware.com to obtain a valid license.
2025-11-19 12:57:31.983 +03:00 [DBG] Executed controller factory for controller BillingSystem.API.Controllers.InvoicesController (BillingSystem.API)
2025-11-19 12:57:32.015 +03:00 [DBG] Attempting to bind parameter 'invoiceRequest' of type 'BillingSystem.Application.Requests.CreateInvoiceRequest' ...
2025-11-19 12:57:32.024 +03:00 [DBG] Attempting to bind parameter 'invoiceRequest' of type 'BillingSystem.Application.Requests.CreateInvoiceRequest' using the name '' in request data ...
2025-11-19 12:57:32.030 +03:00 [DBG] Selected input formatter 'Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonInputFormatter' for content type 'application/json'.
2025-11-19 12:57:32.086 +03:00 [DBG] Connection id "0HNH7A7USQK55", Request id "0HNH7A7USQK55:00000001": started reading request body.
2025-11-19 12:57:32.090 +03:00 [DBG] Connection id "0HNH7A7USQK55", Request id "0HNH7A7USQK55:00000001": done reading request body.
2025-11-19 12:57:32.126 +03:00 [DBG] JSON input formatter succeeded, deserializing to type 'BillingSystem.Application.Requests.CreateInvoiceRequest'
2025-11-19 12:57:32.131 +03:00 [DBG] Done attempting to bind parameter 'invoiceRequest' of type 'BillingSystem.Application.Requests.CreateInvoiceRequest'.
2025-11-19 12:57:32.134 +03:00 [DBG] Done attempting to bind parameter 'invoiceRequest' of type 'BillingSystem.Application.Requests.CreateInvoiceRequest'.
2025-11-19 12:57:32.137 +03:00 [DBG] Attempting to validate the bound parameter 'invoiceRequest' of type 'BillingSystem.Application.Requests.CreateInvoiceRequest' ...
2025-11-19 12:57:32.171 +03:00 [DBG] Done attempting to validate the bound parameter 'invoiceRequest' of type 'BillingSystem.Application.Requests.CreateInvoiceRequest'.
2025-11-19 12:57:32.480 +03:00 [DBG] No relationship from 'Invoice' to 'Invoice' has been configured by convention because there are multiple properties on one entity type - {'DiscountedPrimaryInvoice'} that could be matched with the properties on the other entity type - {'InverseDiscountedPrimaryInvoice', 'InversePrimaryInvoice', 'InverseSubstitutionPrimaryInvoice', 'PrimaryInvoice', 'SubstitutionPrimaryInvoice'}. This message can be disregarded if explicit configuration has been specified in 'OnModelCreating'.
2025-11-19 12:57:32.736 +03:00 [DBG] No relationship from 'Invoice' to 'Invoice' has been configured by convention because there are multiple properties on one entity type - {'DiscountedPrimaryInvoice'} that could be matched with the properties on the other entity type - {'InverseDiscountedPrimaryInvoice', 'InversePrimaryInvoice', 'InverseSubstitutionPrimaryInvoice', 'PrimaryInvoice', 'SubstitutionPrimaryInvoice'}. This message can be disregarded if explicit configuration has been specified in 'OnModelCreating'.
2025-11-19 12:57:32.752 +03:00 [DBG] No relationship from 'Invoice' to 'Invoice' has been configured by convention because there are multiple properties on one entity type - {'InversePrimaryInvoice'} that could be matched with the properties on the other entity type - {'InverseSubstitutionPrimaryInvoice', 'PrimaryInvoice', 'SubstitutionPrimaryInvoice'}. This message can be disregarded if explicit configuration has been specified in 'OnModelCreating'.
2025-11-19 12:57:32.762 +03:00 [DBG] No relationship from 'Invoice' to 'Invoice' has been configured by convention because there are multiple properties on one entity type - {'InversePrimaryInvoice'} that could be matched with the properties on the other entity type - {'InverseSubstitutionPrimaryInvoice', 'PrimaryInvoice', 'SubstitutionPrimaryInvoice'}. This message can be disregarded if explicit configuration has been specified in 'OnModelCreating'.
2025-11-19 12:57:33.172 +03:00 [DBG] Entity Framework Core 9.0.9 initialized 'BillingServiceDBContext' using provider 'Microsoft.EntityFrameworkCore.SqlServer:9.0.9' with options: EngineType=SqlServer 
2025-11-19 12:57:33.305 +03:00 [DBG] Compiling query expression: 
'DbSet<Invoice>()
    .AsNoTracking()
    .Any(inv => inv.ExternalId.ToString() == __idempotentKey_0)'
2025-11-19 12:57:33.690 +03:00 [DBG] Generated query execution expression: 
'queryContext => ShapedQueryCompilingExpressionVisitor.SingleAsync<bool>(
    asyncEnumerable: SingleQueryingEnumerable.Create<bool>(
        relationalQueryContext: (RelationalQueryContext)queryContext, 
        relationalCommandResolver: parameters => [LIFTABLE Constant: RelationalCommandCache.QueryExpression(
            Projection Mapping:
                EmptyProjectionMember -> 0
            SELECT EXISTS (
                SELECT 1
                FROM Invoices AS i
                WHERE COALESCE(CONVERT(varchar(36), i.ExternalId), '') == @__idempotentKey_0)) | Resolver: c => new RelationalCommandCache(
            c.Dependencies.MemoryCache, 
            c.RelationalDependencies.QuerySqlGeneratorFactory, 
            c.RelationalDependencies.RelationalParameterBasedSqlProcessorFactory, 
            Projection Mapping:
                EmptyProjectionMember -> 0
            SELECT EXISTS (
                SELECT 1
                FROM Invoices AS i
                WHERE COALESCE(CONVERT(varchar(36), i.ExternalId), '') == @__idempotentKey_0), 
            False, 
            new HashSet<string>(
                new string[]{ }, 
                StringComparer.Ordinal
            )
        )].GetRelationalCommandTemplate(parameters), 
        readerColumns: null, 
        shaper: (queryContext, dataReader, resultContext, resultCoordinator) => 
        {
            bool? value1;
            value1 = dataReader.IsDBNull(0) ? default(bool?) : (bool?)dataReader.GetBoolean(0);
            return (bool)value1;
        }, 
        contextType: BillingSystem.Infrastructure.EF.BillingServiceDBContext, 
        standAloneStateManager: False, 
        detailedErrorsEnabled: False, 
        threadSafetyChecksEnabled: True), 
    cancellationToken: queryContext.CancellationToken)'
2025-11-19 12:57:33.752 +03:00 [DBG] Creating DbConnection.
2025-11-19 12:57:33.785 +03:00 [DBG] Created DbConnection. (29ms).
2025-11-19 12:57:33.793 +03:00 [DBG] Opening connection to database 'GAC-BillingService' on server '.'.
2025-11-19 12:57:34.157 +03:00 [DBG] Opened connection to database 'GAC-BillingService' on server '.'.
2025-11-19 12:57:34.166 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-11-19 12:57:34.180 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (9ms).
2025-11-19 12:57:34.194 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (28ms).
2025-11-19 12:57:34.208 +03:00 [DBG] Executing DbCommand [Parameters=[@__idempotentKey_0='?' (Size = 36) (DbType = AnsiString)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [Invoices] AS [i]
        WHERE CONVERT(varchar(36), [i].[ExternalId]) = @__idempotentKey_0) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2025-11-19 12:57:34.281 +03:00 [INF] Executed DbCommand (75ms) [Parameters=[@__idempotentKey_0='?' (Size = 36) (DbType = AnsiString)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [Invoices] AS [i]
        WHERE CONVERT(varchar(36), [i].[ExternalId]) = @__idempotentKey_0) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2025-11-19 12:57:34.309 +03:00 [DBG] Closing data reader to 'GAC-BillingService' on server '.'.
2025-11-19 12:57:34.325 +03:00 [DBG] A data reader for 'GAC-BillingService' on server '.' is being disposed after spending 29ms reading results.
2025-11-19 12:57:34.334 +03:00 [DBG] Closing connection to database 'GAC-BillingService' on server '.'.
2025-11-19 12:57:34.349 +03:00 [DBG] Closed connection to database 'GAC-BillingService' on server '.' (13ms).
2025-11-19 12:57:34.556 +03:00 [WRN] You do not have a valid license key for the Lucky Penny software AutoMapper. This is allowed for development and testing scenarios. If you are running in production you are required to have a licensed version. Please visit https://luckypennysoftware.com to obtain a valid license.
2025-11-19 12:57:34.626 +03:00 [DBG] Opening connection to database 'GAC-BillingService' on server '.'.
2025-11-19 12:57:34.633 +03:00 [DBG] Opened connection to database 'GAC-BillingService' on server '.'.
2025-11-19 12:57:34.640 +03:00 [DBG] Beginning transaction with isolation level 'Unspecified'.
2025-11-19 12:57:34.654 +03:00 [DBG] Began transaction with isolation level 'ReadCommitted'.
2025-11-19 12:57:34.662 +03:00 [DBG] Compiling query expression: 
'DbSet<InvoiceSequenceValue>().FromSql(EXECUTE dbo.GetNextInvoiceNumber, __p_0)
'
2025-11-19 12:57:34.721 +03:00 [DBG] Generated query execution expression: 
'queryContext => FromSqlQueryingEnumerable.Create<InvoiceSequenceValue>(
    relationalQueryContext: (RelationalQueryContext)queryContext, 
    relationalCommandResolver: parameters => [LIFTABLE Constant: RelationalCommandCache.QueryExpression(
        Projection Mapping:
            EmptyProjectionMember -> Dictionary<IProperty, int> { [Property: InvoiceSequenceValue.Value (long) Required, 0] }
        SELECT b.Value
        FROM EXECUTE dbo.GetNextInvoiceNumber) | Resolver: c => new RelationalCommandCache(
        c.Dependencies.MemoryCache, 
        c.RelationalDependencies.QuerySqlGeneratorFactory, 
        c.RelationalDependencies.RelationalParameterBasedSqlProcessorFactory, 
        Projection Mapping:
            EmptyProjectionMember -> Dictionary<IProperty, int> { [Property: InvoiceSequenceValue.Value (long) Required, 0] }
        SELECT b.Value
        FROM EXECUTE dbo.GetNextInvoiceNumber, 
        False, 
        new HashSet<string>(
            new string[]{ }, 
            StringComparer.Ordinal
        )
    )].GetRelationalCommandTemplate(parameters), 
    readerColumns: null, 
    columnNames: [LIFTABLE Constant: string[] { "Value" } | Resolver: _ => new string[]{ "Value" }], 
    shaper: (queryContext, dataReader, indexMap) => 
    {
        InvoiceSequenceValue entity;
        entity = 
        {
            MaterializationContext materializationContext1;
            IEntityType entityType1;
            InvoiceSequenceValue instance1;
            materializationContext1 = new MaterializationContext(
                [LIFTABLE Constant: ValueBuffer | Resolver: _ => (object)ValueBuffer.Empty], 
                queryContext.Context
            );
            instance1 = default(InvoiceSequenceValue);
            {
                ISnapshot shadowSnapshot1;
                shadowSnapshot1 = [LIFTABLE Constant: Snapshot | Resolver: _ => Snapshot.Empty];
                entityType1 = [LIFTABLE Constant: EntityType: InvoiceSequenceValue Keyless | Resolver: namelessParameter{0} => namelessParameter{0}.Dependencies.Model.FindEntityType("BillingSystem.Domain.Entities.InvoiceSequenceValue")];
                instance1 = switch (entityType1)
                {
                    case [LIFTABLE Constant: EntityType: InvoiceSequenceValue Keyless | Resolver: namelessParameter{1} => namelessParameter{1}.Dependencies.Model.FindEntityType("BillingSystem.Domain.Entities.InvoiceSequenceValue")]: 
                        {
                            return 
                            {
                                InvoiceSequenceValue instance;
                                instance = new InvoiceSequenceValue();
                                instance.<Value>k__BackingField = dataReader.GetInt64(indexMap[0]);
                                (instance is IInjectableService) ? ((IInjectableService)instance).Injected(
                                    context: materializationContext1.Context, 
                                    entity: instance, 
                                    queryTrackingBehavior: TrackAll, 
                                    structuralType: [LIFTABLE Constant: EntityType: InvoiceSequenceValue Keyless | Resolver: namelessParameter{2} => namelessParameter{2}.Dependencies.Model.FindEntityType("BillingSystem.Domain.Entities.InvoiceSequenceValue")]) : default(void);
                                return instance;
                            }}
                    default: 
                        default(InvoiceSequenceValue)
                }
                ;
                return instance1;
            }return instance1;
        };
        return entity;
    }, 
    contextType: BillingSystem.Infrastructure.EF.BillingServiceDBContext, 
    standAloneStateManager: False, 
    detailedErrorsEnabled: False, 
    threadSafetyChecksEnabled: True)'
2025-11-19 12:57:34.733 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-11-19 12:57:34.737 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (3ms).
2025-11-19 12:57:34.742 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (8ms).
2025-11-19 12:57:34.745 +03:00 [DBG] Executing DbCommand [Parameters=[], CommandType='"Text"', CommandTimeout='30']
EXECUTE dbo.GetNextInvoiceNumber
2025-11-19 12:57:34.757 +03:00 [INF] Executed DbCommand (12ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
EXECUTE dbo.GetNextInvoiceNumber
2025-11-19 12:57:34.767 +03:00 [DBG] Closing data reader to 'GAC-BillingService' on server '.'.
2025-11-19 12:57:34.771 +03:00 [DBG] A data reader for 'GAC-BillingService' on server '.' is being disposed after spending 9ms reading results.
2025-11-19 12:57:34.778 +03:00 [DBG] Compiling query expression: 
'DbSet<Customer>()
    .FirstOrDefault(c => c.IdentityNumber == __cutomerIdentityNumber_0)'
2025-11-19 12:57:34.798 +03:00 [DBG] Generated query execution expression: 
'queryContext => SingleQueryingEnumerable.Create<Customer>(
    relationalQueryContext: (RelationalQueryContext)queryContext, 
    relationalCommandResolver: parameters => [LIFTABLE Constant: RelationalCommandCache.QueryExpression(
        Projection Mapping:
            EmptyProjectionMember -> Dictionary<IProperty, int> { [Property: Customer.Id (long) Required PK AfterSave:Throw ValueGenerated.OnAdd, 0], [Property: Customer.AddressBuildingNumber (string) MaxLength(200), 1], [Property: Customer.AddressCity (string) Required MaxLength(200), 2], [Property: Customer.AddressCountry (string) Required MaxLength(200), 3], [Property: Customer.AddressDistrict (string) Required MaxLength(200), 4], [Property: Customer.AddressPostalCode (string) Required MaxLength(50), 5], [Property: Customer.AddressStreet (string) MaxLength(200), 6], [Property: Customer.AddressSubNumber (string) MaxLength(200), 7], [Property: Customer.CreatedBy (string) Required MaxLength(50), 8], [Property: Customer.CreatedDate (DateTime) Required, 9], [Property: Customer.CustomerType (string) Required MaxLength(100), 10], [Property: Customer.EmailAddress (string) MaxLength(80), 11], [Property: Customer.FullName (string) Required MaxLength(500), 12], [Property: Customer.IdentityNumber (string) Required MaxLength(100), 13], [Property: Customer.IdentityType (int?), 14], [Property: Customer.IsDeleted (bool) Required, 15], [Property: Customer.LastUpdatedDate (DateTime?), 16], [Property: Customer.OverpaymentBalance (decimal?), 17], [Property: Customer.PhoneNumber (string) MaxLength(50), 18], [Property: Customer.Vatnumber (string) MaxLength(100), 19] }
        SELECT TOP(1) c.Id, c.Address_BuildingNumber, c.Address_City, c.Address_Country, c.Address_District, c.Address_PostalCode, c.Address_Street, c.Address_SubNumber, c.CreatedBy, c.CreatedDate, c.CustomerType, c.EmailAddress, c.FullName, c.IdentityNumber, c.IdentityType, c.IsDeleted, c.LastUpdatedDate, c.OverpaymentBalance, c.PhoneNumber, c.VATNumber
        FROM Customers AS c
        WHERE c.IdentityNumber == @__cutomerIdentityNumber_0) | Resolver: c => new RelationalCommandCache(
        c.Dependencies.MemoryCache, 
        c.RelationalDependencies.QuerySqlGeneratorFactory, 
        c.RelationalDependencies.RelationalParameterBasedSqlProcessorFactory, 
        Projection Mapping:
            EmptyProjectionMember -> Dictionary<IProperty, int> { [Property: Customer.Id (long) Required PK AfterSave:Throw ValueGenerated.OnAdd, 0], [Property: Customer.AddressBuildingNumber (string) MaxLength(200), 1], [Property: Customer.AddressCity (string) Required MaxLength(200), 2], [Property: Customer.AddressCountry (string) Required MaxLength(200), 3], [Property: Customer.AddressDistrict (string) Required MaxLength(200), 4], [Property: Customer.AddressPostalCode (string) Required MaxLength(50), 5], [Property: Customer.AddressStreet (string) MaxLength(200), 6], [Property: Customer.AddressSubNumber (string) MaxLength(200), 7], [Property: Customer.CreatedBy (string) Required MaxLength(50), 8], [Property: Customer.CreatedDate (DateTime) Required, 9], [Property: Customer.CustomerType (string) Required MaxLength(100), 10], [Property: Customer.EmailAddress (string) MaxLength(80), 11], [Property: Customer.FullName (string) Required MaxLength(500), 12], [Property: Customer.IdentityNumber (string) Required MaxLength(100), 13], [Property: Customer.IdentityType (int?), 14], [Property: Customer.IsDeleted (bool) Required, 15], [Property: Customer.LastUpdatedDate (DateTime?), 16], [Property: Customer.OverpaymentBalance (decimal?), 17], [Property: Customer.PhoneNumber (string) MaxLength(50), 18], [Property: Customer.Vatnumber (string) MaxLength(100), 19] }
        SELECT TOP(1) c.Id, c.Address_BuildingNumber, c.Address_City, c.Address_Country, c.Address_District, c.Address_PostalCode, c.Address_Street, c.Address_SubNumber, c.CreatedBy, c.CreatedDate, c.CustomerType, c.EmailAddress, c.FullName, c.IdentityNumber, c.IdentityType, c.IsDeleted, c.LastUpdatedDate, c.OverpaymentBalance, c.PhoneNumber, c.VATNumber
        FROM Customers AS c
        WHERE c.IdentityNumber == @__cutomerIdentityNumber_0, 
        False, 
        new HashSet<string>(
            new string[]{ }, 
            StringComparer.Ordinal
        )
    )].GetRelationalCommandTemplate(parameters), 
    readerColumns: null, 
    shaper: (queryContext, dataReader, resultContext, resultCoordinator) => 
    {
        Customer entity;
        entity = 
        {
            MaterializationContext materializationContext1;
            IEntityType entityType1;
            Customer instance1;
            InternalEntityEntry entry1;
            bool hasNullKey1;
            materializationContext1 = new MaterializationContext(
                [LIFTABLE Constant: ValueBuffer | Resolver: _ => (object)ValueBuffer.Empty], 
                queryContext.Context
            );
            instance1 = default(Customer);
            entry1 = queryContext.TryGetEntry(
                key: [LIFTABLE Constant: Key: Customer.Id PK | Resolver: c => c.Dependencies.Model.FindEntityType("BillingSystem.Domain.Entities.Customer").FindPrimaryKey()], 
                keyValues: new object[]{ (object)dataReader.GetInt64(0) }, 
                throwOnNullKey: True, 
                hasNullKey: hasNullKey1);
            !(hasNullKey1) ? entry1 != default(InternalEntityEntry) ? 
            {
                entityType1 = entry1.EntityType;
                return instance1 = (Customer)entry1.Entity;
            } : 
            {
                ISnapshot shadowSnapshot1;
                shadowSnapshot1 = [LIFTABLE Constant: Snapshot | Resolver: _ => Snapshot.Empty];
                entityType1 = [LIFTABLE Constant: EntityType: Customer | Resolver: namelessParameter{0} => namelessParameter{0}.Dependencies.Model.FindEntityType("BillingSystem.Domain.Entities.Customer")];
                instance1 = switch (entityType1)
                {
                    case [LIFTABLE Constant: EntityType: Customer | Resolver: namelessParameter{1} => namelessParameter{1}.Dependencies.Model.FindEntityType("BillingSystem.Domain.Entities.Customer")]: 
                        {
                            return 
                            {
                                Customer instance;
                                instance = new Customer();
                                instance.<Id>k__BackingField = dataReader.GetInt64(0);
                                instance.<AddressBuildingNumber>k__BackingField = dataReader.IsDBNull(1) ? default(string) : dataReader.GetString(1);
                                instance.<AddressCity>k__BackingField = dataReader.GetString(2);
                                instance.<AddressCountry>k__BackingField = dataReader.GetString(3);
                                instance.<AddressDistrict>k__BackingField = dataReader.GetString(4);
                                instance.<AddressPostalCode>k__BackingField = dataReader.GetString(5);
                                instance.<AddressStreet>k__BackingField = dataReader.IsDBNull(6) ? default(string) : dataReader.GetString(6);
                                instance.<AddressSubNumber>k__BackingField = dataReader.IsDBNull(7) ? default(string) : dataReader.GetString(7);
                                instance.<CreatedBy>k__BackingField = dataReader.GetString(8);
                                instance.<CreatedDate>k__BackingField = dataReader.GetDateTime(9);
                                instance.<CustomerType>k__BackingField = dataReader.GetString(10);
                                instance.<EmailAddress>k__BackingField = dataReader.IsDBNull(11) ? default(string) : dataReader.GetString(11);
                                instance.<FullName>k__BackingField = dataReader.GetString(12);
                                instance.<IdentityNumber>k__BackingField = dataReader.GetString(13);
                                instance.<IdentityType>k__BackingField = dataReader.IsDBNull(14) ? default(int?) : (int?)dataReader.GetInt32(14);
                                instance.<IsDeleted>k__BackingField = dataReader.GetBoolean(15);
                                instance.<LastUpdatedDate>k__BackingField = dataReader.IsDBNull(16) ? default(DateTime?) : (DateTime?)dataReader.GetDateTime(16);
                                instance.<OverpaymentBalance>k__BackingField = dataReader.IsDBNull(17) ? default(decimal?) : (decimal?)dataReader.GetDecimal(17);
                                instance.<PhoneNumber>k__BackingField = dataReader.IsDBNull(18) ? default(string) : dataReader.GetString(18);
                                instance.<Vatnumber>k__BackingField = dataReader.IsDBNull(19) ? default(string) : dataReader.GetString(19);
                                (instance is IInjectableService) ? ((IInjectableService)instance).Injected(
                                    context: materializationContext1.Context, 
                                    entity: instance, 
                                    queryTrackingBehavior: TrackAll, 
                                    structuralType: [LIFTABLE Constant: EntityType: Customer | Resolver: namelessParameter{2} => namelessParameter{2}.Dependencies.Model.FindEntityType("BillingSystem.Domain.Entities.Customer")]) : default(void);
                                return instance;
                            }}
                    default: 
                        default(Customer)
                }
                ;
                entry1 = entityType1 == default(IEntityType) ? default(InternalEntityEntry) : queryContext.StartTracking(
                    entityType: entityType1, 
                    entity: instance1, 
                    snapshot: shadowSnapshot1);
                return instance1;
            } : default(void);
            return instance1;
        };
        return entity;
    }, 
    contextType: BillingSystem.Infrastructure.EF.BillingServiceDBContext, 
    standAloneStateManager: False, 
    detailedErrorsEnabled: False, 
    threadSafetyChecksEnabled: True)
    .SingleOrDefault()'
2025-11-19 12:57:34.813 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-11-19 12:57:34.817 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (3ms).
2025-11-19 12:57:34.821 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (7ms).
2025-11-19 12:57:34.824 +03:00 [DBG] Executing DbCommand [Parameters=[@__cutomerIdentityNumber_0='?' (Size = 100)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[Id], [c].[Address_BuildingNumber], [c].[Address_City], [c].[Address_Country], [c].[Address_District], [c].[Address_PostalCode], [c].[Address_Street], [c].[Address_SubNumber], [c].[CreatedBy], [c].[CreatedDate], [c].[CustomerType], [c].[EmailAddress], [c].[FullName], [c].[IdentityNumber], [c].[IdentityType], [c].[IsDeleted], [c].[LastUpdatedDate], [c].[OverpaymentBalance], [c].[PhoneNumber], [c].[VATNumber]
FROM [Customers] AS [c]
WHERE [c].[IdentityNumber] = @__cutomerIdentityNumber_0
2025-11-19 12:57:34.833 +03:00 [INF] Executed DbCommand (9ms) [Parameters=[@__cutomerIdentityNumber_0='?' (Size = 100)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[Id], [c].[Address_BuildingNumber], [c].[Address_City], [c].[Address_Country], [c].[Address_District], [c].[Address_PostalCode], [c].[Address_Street], [c].[Address_SubNumber], [c].[CreatedBy], [c].[CreatedDate], [c].[CustomerType], [c].[EmailAddress], [c].[FullName], [c].[IdentityNumber], [c].[IdentityType], [c].[IsDeleted], [c].[LastUpdatedDate], [c].[OverpaymentBalance], [c].[PhoneNumber], [c].[VATNumber]
FROM [Customers] AS [c]
WHERE [c].[IdentityNumber] = @__cutomerIdentityNumber_0
2025-11-19 12:57:34.877 +03:00 [DBG] Context 'BillingServiceDBContext' started tracking 'Customer' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-11-19 12:57:34.941 +03:00 [DBG] Closing data reader to 'GAC-BillingService' on server '.'.
2025-11-19 12:57:34.948 +03:00 [DBG] A data reader for 'GAC-BillingService' on server '.' is being disposed after spending 110ms reading results.
2025-11-19 12:57:34.991 +03:00 [DBG] 'BillingServiceDBContext' generated a temporary value for the property 'Invoice.Id'. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-11-19 12:57:35.138 +03:00 [DBG] Context 'BillingServiceDBContext' started tracking 'Invoice' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-11-19 12:57:35.148 +03:00 [DBG] 'BillingServiceDBContext' generated a temporary value for the property 'InvoicesAttachment.Id'. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-11-19 12:57:35.171 +03:00 [DBG] The navigation 'InvoicesAttachment.Invoice' was detected as changed. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-11-19 12:57:35.183 +03:00 [DBG] Context 'BillingServiceDBContext' started tracking 'InvoicesAttachment' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-11-19 12:57:35.194 +03:00 [DBG] 'BillingServiceDBContext' generated a temporary value for the property 'InvoicesItem.Id'. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-11-19 12:57:35.221 +03:00 [DBG] The navigation 'InvoicesItem.Invoice' was detected as changed. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-11-19 12:57:35.228 +03:00 [DBG] Context 'BillingServiceDBContext' started tracking 'InvoicesItem' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-11-19 12:57:35.236 +03:00 [DBG] SaveChanges starting for 'BillingServiceDBContext'.
2025-11-19 12:57:35.244 +03:00 [DBG] DetectChanges starting for 'BillingServiceDBContext'.
2025-11-19 12:57:35.323 +03:00 [DBG] DetectChanges completed for 'BillingServiceDBContext'.
2025-11-19 12:57:35.457 +03:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-11-19 12:57:35.465 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-11-19 12:57:35.468 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (2ms).
2025-11-19 12:57:35.473 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (8ms).
2025-11-19 12:57:35.479 +03:00 [DBG] Executing DbCommand [Parameters=[@p0='?' (Precision = 18) (DbType = Decimal), @p1='?' (Size = 3000), @p2='?' (Size = 100), @p3='?' (Size = 50), @p4='?' (DbType = DateTime), @p5='?' (Size = 50), @p6='?' (DbType = Int64), @p7='?' (DbType = Int64), @p8='?' (DbType = DateTime), @p9='?' (DbType = Guid), @p10='?' (Size = 50), @p11='?' (DbType = Int32), @p12='?' (DbType = Int32), @p13='?' (DbType = Boolean), @p14='?' (DbType = Boolean), @p15='?' (DbType = Boolean), @p16='?' (DbType = Boolean), @p17='?' (DbType = DateTime), @p18='?' (DbType = DateTime), @p19='?' (Size = 4000), @p20='?' (Size = 100), @p21='?' (Size = 100), @p22='?' (DbType = Int64), @p23='?' (Size = 4000), @p24='?' (DbType = Int64), @p25='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [Invoices] ([Amount], [CancelationReasons], [ClientReferenceNumber], [CreatedBy], [CreatedDate], [Currency], [CustomerID], [DiscountedPrimaryInvoiceID], [DueAt], [ExternalId], [InvoiceNumber], [InvoiceStatus], [InvoiceType], [IsDeleted], [IsDiscounted], [IsSubInvoice], [IsSubstitution], [IssuedAt], [LastUpdatedDate], [Metadata], [PaymentProvider], [PaymentReference], [PrimaryInvoiceID], [ProviderResponse], [SubstitutionPrimaryInvoiceID], [TenantId])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18, @p19, @p20, @p21, @p22, @p23, @p24, @p25);
2025-11-19 12:57:35.501 +03:00 [INF] Executed DbCommand (24ms) [Parameters=[@p0='?' (Precision = 18) (DbType = Decimal), @p1='?' (Size = 3000), @p2='?' (Size = 100), @p3='?' (Size = 50), @p4='?' (DbType = DateTime), @p5='?' (Size = 50), @p6='?' (DbType = Int64), @p7='?' (DbType = Int64), @p8='?' (DbType = DateTime), @p9='?' (DbType = Guid), @p10='?' (Size = 50), @p11='?' (DbType = Int32), @p12='?' (DbType = Int32), @p13='?' (DbType = Boolean), @p14='?' (DbType = Boolean), @p15='?' (DbType = Boolean), @p16='?' (DbType = Boolean), @p17='?' (DbType = DateTime), @p18='?' (DbType = DateTime), @p19='?' (Size = 4000), @p20='?' (Size = 100), @p21='?' (Size = 100), @p22='?' (DbType = Int64), @p23='?' (Size = 4000), @p24='?' (DbType = Int64), @p25='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [Invoices] ([Amount], [CancelationReasons], [ClientReferenceNumber], [CreatedBy], [CreatedDate], [Currency], [CustomerID], [DiscountedPrimaryInvoiceID], [DueAt], [ExternalId], [InvoiceNumber], [InvoiceStatus], [InvoiceType], [IsDeleted], [IsDiscounted], [IsSubInvoice], [IsSubstitution], [IssuedAt], [LastUpdatedDate], [Metadata], [PaymentProvider], [PaymentReference], [PrimaryInvoiceID], [ProviderResponse], [SubstitutionPrimaryInvoiceID], [TenantId])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18, @p19, @p20, @p21, @p22, @p23, @p24, @p25);
2025-11-19 12:57:35.533 +03:00 [DBG] The foreign key property 'Invoice.Id' was detected as changed. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see property values.
2025-11-19 12:57:35.548 +03:00 [DBG] The foreign key property 'InvoicesAttachment.InvoiceId' was detected as changed. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see property values.
2025-11-19 12:57:35.561 +03:00 [DBG] The foreign key property 'InvoicesItem.InvoiceId' was detected as changed. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see property values.
2025-11-19 12:57:35.570 +03:00 [DBG] Closing data reader to 'GAC-BillingService' on server '.'.
2025-11-19 12:57:35.574 +03:00 [DBG] A data reader for 'GAC-BillingService' on server '.' is being disposed after spending 62ms reading results.
2025-11-19 12:57:35.581 +03:00 [DBG] Executing 2 update commands as a batch.
2025-11-19 12:57:35.585 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-11-19 12:57:35.588 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (3ms).
2025-11-19 12:57:35.592 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (7ms).
2025-11-19 12:57:35.596 +03:00 [DBG] Executing DbCommand [Parameters=[@p26='?' (Size = 50), @p27='?' (DbType = DateTime), @p28='?' (Size = 200), @p29='?' (DbType = Int64), @p30='?' (DbType = Boolean), @p31='?' (Precision = 18) (DbType = Decimal), @p32='?' (Size = 50), @p33='?' (DbType = DateTime), @p34='?' (DbType = Int64), @p35='?' (DbType = Boolean), @p36='?' (Size = 500), @p37='?' (Size = 200), @p38='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SET NOCOUNT ON;
INSERT INTO [InvoicesAttachments] ([CreatedBy], [CreatedDate], [FileName], [InvoiceId], [IsDeleted])
OUTPUT INSERTED.[Id]
VALUES (@p26, @p27, @p28, @p29, @p30);
INSERT INTO [InvoicesItems] ([Amount], [CreatedBy], [CreatedDate], [InvoiceId], [IsDeleted], [ItemDesc], [ItemName], [Quantity])
OUTPUT INSERTED.[Id]
VALUES (@p31, @p32, @p33, @p34, @p35, @p36, @p37, @p38);
2025-11-19 12:57:35.605 +03:00 [INF] Executed DbCommand (9ms) [Parameters=[@p26='?' (Size = 50), @p27='?' (DbType = DateTime), @p28='?' (Size = 200), @p29='?' (DbType = Int64), @p30='?' (DbType = Boolean), @p31='?' (Precision = 18) (DbType = Decimal), @p32='?' (Size = 50), @p33='?' (DbType = DateTime), @p34='?' (DbType = Int64), @p35='?' (DbType = Boolean), @p36='?' (Size = 500), @p37='?' (Size = 200), @p38='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SET NOCOUNT ON;
INSERT INTO [InvoicesAttachments] ([CreatedBy], [CreatedDate], [FileName], [InvoiceId], [IsDeleted])
OUTPUT INSERTED.[Id]
VALUES (@p26, @p27, @p28, @p29, @p30);
INSERT INTO [InvoicesItems] ([Amount], [CreatedBy], [CreatedDate], [InvoiceId], [IsDeleted], [ItemDesc], [ItemName], [Quantity])
OUTPUT INSERTED.[Id]
VALUES (@p31, @p32, @p33, @p34, @p35, @p36, @p37, @p38);
2025-11-19 12:57:35.612 +03:00 [DBG] The foreign key property 'InvoicesAttachment.Id' was detected as changed. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see property values.
2025-11-19 12:57:35.617 +03:00 [DBG] The foreign key property 'InvoicesItem.Id' was detected as changed. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see property values.
2025-11-19 12:57:35.620 +03:00 [DBG] Closing data reader to 'GAC-BillingService' on server '.'.
2025-11-19 12:57:35.624 +03:00 [DBG] A data reader for 'GAC-BillingService' on server '.' is being disposed after spending 12ms reading results.
2025-11-19 12:57:35.637 +03:00 [DBG] An entity of type 'Invoice' tracked by 'BillingServiceDBContext' changed state from '"Added"' to '"Unchanged"'. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-11-19 12:57:35.643 +03:00 [DBG] An entity of type 'InvoicesAttachment' tracked by 'BillingServiceDBContext' changed state from '"Added"' to '"Unchanged"'. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-11-19 12:57:35.649 +03:00 [DBG] An entity of type 'InvoicesItem' tracked by 'BillingServiceDBContext' changed state from '"Added"' to '"Unchanged"'. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-11-19 12:57:35.656 +03:00 [DBG] SaveChanges completed for 'BillingServiceDBContext' with 3 entities written to the database.
2025-11-19 12:57:35.679 +03:00 [DBG] 'BillingServiceDBContext' generated a temporary value for the property 'OutboxEvent.Id'. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-11-19 12:57:35.700 +03:00 [DBG] Context 'BillingServiceDBContext' started tracking 'OutboxEvent' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-11-19 12:57:35.706 +03:00 [DBG] 'BillingServiceDBContext' generated a temporary value for the property 'AuditEvent.Id'. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-11-19 12:57:35.727 +03:00 [DBG] Context 'BillingServiceDBContext' started tracking 'AuditEvent' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-11-19 12:57:35.731 +03:00 [DBG] SaveChanges starting for 'BillingServiceDBContext'.
2025-11-19 12:57:35.736 +03:00 [DBG] DetectChanges starting for 'BillingServiceDBContext'.
2025-11-19 12:57:35.748 +03:00 [DBG] DetectChanges completed for 'BillingServiceDBContext'.
2025-11-19 12:57:35.754 +03:00 [DBG] Executing 2 update commands as a batch.
2025-11-19 12:57:35.757 +03:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-11-19 12:57:35.760 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-11-19 12:57:35.764 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (3ms).
2025-11-19 12:57:35.768 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (7ms).
2025-11-19 12:57:35.771 +03:00 [DBG] Executing DbCommand [Parameters=[@p0='?' (Size = 100), @p1='?' (Size = 4000), @p2='?' (Size = 50), @p3='?' (DbType = DateTime), @p4='?' (Size = 500), @p5='?' (Size = 20), @p6='?' (Size = 100), @p7='?' (Size = 100), @p8='?' (DbType = Int64), @p9='?' (DbType = DateTime), @p10='?' (Size = 4000), @p11='?' (Size = 300), @p12='?' (Size = 4000), @p13='?' (DbType = Boolean), @p14='?' (Size = 20) (DbType = AnsiString)], CommandType='"Text"', CommandTimeout='30']
SET NOCOUNT ON;
INSERT INTO [audit].[AuditEvents] ([Action], [Changes], [CreatedBy], [CreatedDate], [Description], [EntityId], [EntityType], [UserId])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
INSERT INTO [Outbox_events] ([Aggregate_id], [CreatedDate], [ErrorMsg], [Event_type], [Payload], [Processed], [ProcessingStatus])
OUTPUT INSERTED.[Id]
VALUES (@p8, @p9, @p10, @p11, @p12, @p13, @p14);
2025-11-19 12:57:35.780 +03:00 [INF] Executed DbCommand (9ms) [Parameters=[@p0='?' (Size = 100), @p1='?' (Size = 4000), @p2='?' (Size = 50), @p3='?' (DbType = DateTime), @p4='?' (Size = 500), @p5='?' (Size = 20), @p6='?' (Size = 100), @p7='?' (Size = 100), @p8='?' (DbType = Int64), @p9='?' (DbType = DateTime), @p10='?' (Size = 4000), @p11='?' (Size = 300), @p12='?' (Size = 4000), @p13='?' (DbType = Boolean), @p14='?' (Size = 20) (DbType = AnsiString)], CommandType='"Text"', CommandTimeout='30']
SET NOCOUNT ON;
INSERT INTO [audit].[AuditEvents] ([Action], [Changes], [CreatedBy], [CreatedDate], [Description], [EntityId], [EntityType], [UserId])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
INSERT INTO [Outbox_events] ([Aggregate_id], [CreatedDate], [ErrorMsg], [Event_type], [Payload], [Processed], [ProcessingStatus])
OUTPUT INSERTED.[Id]
VALUES (@p8, @p9, @p10, @p11, @p12, @p13, @p14);
2025-11-19 12:57:35.787 +03:00 [DBG] The foreign key property 'AuditEvent.Id' was detected as changed. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see property values.
2025-11-19 12:57:35.792 +03:00 [DBG] The foreign key property 'OutboxEvent.Id' was detected as changed. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see property values.
2025-11-19 12:57:35.796 +03:00 [DBG] Closing data reader to 'GAC-BillingService' on server '.'.
2025-11-19 12:57:35.800 +03:00 [DBG] A data reader for 'GAC-BillingService' on server '.' is being disposed after spending 13ms reading results.
2025-11-19 12:57:35.805 +03:00 [DBG] An entity of type 'AuditEvent' tracked by 'BillingServiceDBContext' changed state from '"Added"' to '"Unchanged"'. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-11-19 12:57:35.810 +03:00 [DBG] An entity of type 'OutboxEvent' tracked by 'BillingServiceDBContext' changed state from '"Added"' to '"Unchanged"'. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-11-19 12:57:35.814 +03:00 [DBG] SaveChanges completed for 'BillingServiceDBContext' with 2 entities written to the database.
2025-11-19 12:57:35.820 +03:00 [DBG] Committing transaction.
2025-11-19 12:57:35.846 +03:00 [DBG] Committed transaction.
2025-11-19 12:57:35.850 +03:00 [DBG] Closing connection to database 'GAC-BillingService' on server '.'.
2025-11-19 12:57:35.854 +03:00 [DBG] Closed connection to database 'GAC-BillingService' on server '.' (2ms).
2025-11-19 12:57:35.860 +03:00 [DBG] Disposing transaction.
2025-11-19 12:57:35.880 +03:00 [DBG] List of registered output formatters, in the following order: ["Microsoft.AspNetCore.Mvc.Formatters.HttpNoContentOutputFormatter","Microsoft.AspNetCore.Mvc.Formatters.StringOutputFormatter","Microsoft.AspNetCore.Mvc.Formatters.StreamOutputFormatter","Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonOutputFormatter"]
2025-11-19 12:57:35.892 +03:00 [DBG] No information found on request to perform content negotiation.
2025-11-19 12:57:35.897 +03:00 [DBG] Attempting to select the first output formatter in the output formatters list which supports a content type from the explicitly specified content types '["application/json"]'.
2025-11-19 12:57:35.903 +03:00 [DBG] Selected output formatter 'Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonOutputFormatter' and content type 'application/json' to write the response.
2025-11-19 12:57:35.909 +03:00 [INF] Executing OkObjectResult, writing value of type 'BillingSystem.SharedKernel.ApiResponse`1[[System.Int64, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-11-19 12:57:35.924 +03:00 [INF] Executed action BillingSystem.API.Controllers.InvoicesController.Post (BillingSystem.API) in 4002.8743ms
2025-11-19 12:57:35.930 +03:00 [INF] Executed endpoint 'BillingSystem.API.Controllers.InvoicesController.Post (BillingSystem.API)'
2025-11-19 12:57:35.934 +03:00 [INF] HTTP POST /api/Invoices responded 200 in 9786.8184 ms
2025-11-19 12:57:35.941 +03:00 [DBG] Connection id "0HNH7A7USQK55" completed keep alive response.
2025-11-19 12:57:35.948 +03:00 [DBG] 'BillingServiceDBContext' disposed.
2025-11-19 12:57:35.959 +03:00 [DBG] Disposing connection to database 'GAC-BillingService' on server '.'.
2025-11-19 12:57:35.966 +03:00 [DBG] Disposed connection to database '' on server '' (8ms).
2025-11-19 12:57:35.972 +03:00 [INF] Request finished HTTP/1.1 POST https://localhost:7257/api/Invoices - 200 null application/json; charset=utf-8 9872.4884ms
2025-11-19 12:58:40.277 +03:00 [DBG] Connection id "0HNH7A7USQK53" received FIN.
2025-11-19 12:58:40.284 +03:00 [DBG] Connection id "0HNH7A7USQK53" is closed. The last processed stream ID was 7.
2025-11-19 12:58:40.284 +03:00 [DBG] The connection queue processing loop for 0HNH7A7USQK53 completed.
2025-11-19 12:58:40.288 +03:00 [DBG] Connection id "0HNH7A7USQK53" sending FIN because: "The Socket transport's send loop completed gracefully."
2025-11-19 12:58:40.307 +03:00 [DBG] Connection id "0HNH7A7USQK53" stopped.
