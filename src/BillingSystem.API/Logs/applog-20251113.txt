2025-11-12 17:31:44.334 +03:00 [DBG] Connection id "0HNH1UVPLUOQA" received FIN.
2025-11-13 04:47:42.001 +03:00 [DBG] Connection id "0HNH1UVPLUOQA" is closed. The last processed stream ID was 7.
2025-11-13 04:47:42.030 +03:00 [DBG] The connection queue processing loop for 0HNH1UVPLUOQA completed.
2025-11-13 04:47:42.796 +03:00 [DBG] Connection id "0HNH1UVPLUOQA" sending FIN because: "The Socket transport's send loop completed gracefully."
2025-11-13 04:47:44.036 +03:00 [DBG] Connection id "0HNH1UVPLUOQA" stopped.
2025-11-13 09:37:06.919 +03:00 [DBG] Registered model binder providers, in the following order: ["Microsoft.AspNetCore.Mvc.ModelBinding.Binders.BinderTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ServicesModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.BodyModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.HeaderModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FloatingPointTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.EnumTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.DateTimeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.SimpleTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.TryParseModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.CancellationTokenModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ByteArrayModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FormFileModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FormCollectionModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.KeyValuePairModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.DictionaryModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ArrayModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.CollectionModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ComplexObjectModelBinderProvider"]
2025-11-13 09:37:07.123 +03:00 [DBG] Hosting starting
2025-11-13 09:37:07.535 +03:00 [DBG] Starting bus instances: IBus
2025-11-13 09:37:07.542 +03:00 [DBG] Starting bus: "rabbitmq://localhost/"
2025-11-13 09:37:07.575 +03:00 [DBG] Middleware loaded
2025-11-13 09:37:07.581 +03:00 [DBG] Middleware loaded. Script /_framework/aspnetcore-browser-refresh.js (16519 B).
2025-11-13 09:37:07.585 +03:00 [DBG] Middleware loaded. Script /_framework/blazor-hotreload.js (799 B).
2025-11-13 09:37:07.601 +03:00 [DBG] Connect: guest@localhost:5672/
2025-11-13 09:37:07.773 +03:00 [DBG] Middleware loaded: DOTNET_MODIFIABLE_ASSEMBLIES=debug, __ASPNETCORE_BROWSER_TOOLS=true
2025-11-13 09:37:07.808 +03:00 [DBG] Connected: guest@localhost:5672/ (address: amqp://localhost:5672, local: 51171)
2025-11-13 09:37:07.904 +03:00 [DBG] Endpoint Ready: "rabbitmq://localhost/ECHGHANNAMLP1_BillingSystemAPI_bus_gobyyyyh3bcsbegbbdxnr9ao8a?temporary=true"
2025-11-13 09:37:07.909 +03:00 [INF] Bus started: "rabbitmq://localhost/"
2025-11-13 09:37:08.111 +03:00 [INF] Now listening on: https://localhost:7257
2025-11-13 09:37:08.115 +03:00 [INF] Now listening on: http://localhost:5009
2025-11-13 09:37:08.118 +03:00 [DBG] Loaded hosting startup assembly BillingSystem.API
2025-11-13 09:37:08.120 +03:00 [DBG] Loaded hosting startup assembly Microsoft.WebTools.ApiEndpointDiscovery
2025-11-13 09:37:08.124 +03:00 [DBG] Loaded hosting startup assembly Microsoft.AspNetCore.Watch.BrowserRefresh
2025-11-13 09:37:08.127 +03:00 [DBG] Loaded hosting startup assembly Microsoft.WebTools.BrowserLink.Net
2025-11-13 09:37:08.214 +03:00 [DBG] Connection id "0HNH2FS8N638H" accepted.
2025-11-13 09:37:08.217 +03:00 [DBG] Connection id "0HNH2FS8N638I" accepted.
2025-11-13 09:37:08.219 +03:00 [DBG] Connection id "0HNH2FS8N638H" started.
2025-11-13 09:37:08.220 +03:00 [DBG] Connection id "0HNH2FS8N638I" started.
2025-11-13 09:37:08.251 +03:00 [DBG] Connection id "0HNH2FS8N638I" received FIN.
2025-11-13 09:37:08.251 +03:00 [DBG] Connection id "0HNH2FS8N638H" received FIN.
2025-11-13 09:37:08.271 +03:00 [DBG] Failed to authenticate HTTPS connection.
System.IO.IOException: Received an unexpected EOF or 0 bytes from the transport stream.
   at System.Net.Security.SslStream.ReceiveHandshakeFrameAsync[TIOAdapter](CancellationToken cancellationToken)
   at System.Net.Security.SslStream.ForceAuthenticationAsync[TIOAdapter](Boolean receiveFirst, Byte[] reAuthenticationData, CancellationToken cancellationToken)
   at System.Net.Security.SslStream.ProcessAuthenticationWithTelemetryAsync(Boolean isAsync, CancellationToken cancellationToken)
   at Microsoft.AspNetCore.Server.Kestrel.Https.Internal.HttpsConnectionMiddleware.OnConnectionAsync(ConnectionContext context)
2025-11-13 09:37:08.271 +03:00 [DBG] Failed to authenticate HTTPS connection.
System.IO.IOException: Received an unexpected EOF or 0 bytes from the transport stream.
   at System.Net.Security.SslStream.ReceiveHandshakeFrameAsync[TIOAdapter](CancellationToken cancellationToken)
   at System.Net.Security.SslStream.ForceAuthenticationAsync[TIOAdapter](Boolean receiveFirst, Byte[] reAuthenticationData, CancellationToken cancellationToken)
   at System.Net.Security.SslStream.ProcessAuthenticationWithTelemetryAsync(Boolean isAsync, CancellationToken cancellationToken)
   at Microsoft.AspNetCore.Server.Kestrel.Https.Internal.HttpsConnectionMiddleware.OnConnectionAsync(ConnectionContext context)
2025-11-13 09:37:08.313 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-11-13 09:37:08.356 +03:00 [DBG] Connection id "0HNH2FS8N638H" stopped.
2025-11-13 09:37:08.358 +03:00 [INF] Hosting environment: Development
2025-11-13 09:37:08.356 +03:00 [DBG] Connection id "0HNH2FS8N638I" stopped.
2025-11-13 09:37:08.363 +03:00 [INF] Content root path: C:\Repositories\Gac-BillingSystem\src\BillingSystem.API
2025-11-13 09:37:08.367 +03:00 [DBG] Hosting started
2025-11-13 09:37:08.368 +03:00 [DBG] Connection id "0HNH2FS8N638I" sending FIN because: "The Socket transport's send loop completed gracefully."
2025-11-13 09:37:08.368 +03:00 [DBG] Connection id "0HNH2FS8N638H" sending FIN because: "The Socket transport's send loop completed gracefully."
2025-11-13 09:37:09.022 +03:00 [DBG] Connection id "0HNH2FS8N638J" accepted.
2025-11-13 09:37:09.025 +03:00 [DBG] Connection id "0HNH2FS8N638J" started.
2025-11-13 09:37:09.093 +03:00 [DBG] Connection 0HNH2FS8N638J established using the following protocol: "Tls13"
2025-11-13 09:37:09.167 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7257/swagger/index.html - null null
2025-11-13 09:37:09.226 +03:00 [DBG] Wildcard detected, all requests with hosts will be allowed.
2025-11-13 09:37:09.253 +03:00 [DBG] No candidates found for the request path '/swagger/index.html'
2025-11-13 09:37:09.259 +03:00 [DBG] Request did not match any endpoints
2025-11-13 09:37:09.336 +03:00 [DBG] Response markup is scheduled to include Browser Link script injection.
2025-11-13 09:37:09.342 +03:00 [DBG] Response markup is scheduled to include browser refresh script injection.
2025-11-13 09:37:09.372 +03:00 [INF] HTTP GET /swagger/index.html responded 200 in 101.9560 ms
2025-11-13 09:37:09.378 +03:00 [DBG] Response markup was updated to include Browser Link script injection.
2025-11-13 09:37:09.381 +03:00 [DBG] Response markup was updated to include browser refresh script injection.
2025-11-13 09:37:09.388 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7257/swagger/index.html - 200 null text/html;charset=utf-8 233.003ms
2025-11-13 09:37:09.410 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7257/_framework/aspnetcore-browser-refresh.js - null null
2025-11-13 09:37:09.426 +03:00 [DBG] Script injected: /_framework/aspnetcore-browser-refresh.js
2025-11-13 09:37:09.430 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7257/_framework/aspnetcore-browser-refresh.js - 200 16519 application/javascript; charset=utf-8 19.2944ms
2025-11-13 09:37:09.436 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7257/_vs/browserLink - null null
2025-11-13 09:37:09.508 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7257/_vs/browserLink - 200 null text/javascript; charset=UTF-8 71.352ms
2025-11-13 09:37:09.563 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7257/swagger/v1/swagger.json - null null
2025-11-13 09:37:09.570 +03:00 [DBG] No candidates found for the request path '/swagger/v1/swagger.json'
2025-11-13 09:37:09.573 +03:00 [DBG] Request did not match any endpoints
2025-11-13 09:37:09.593 +03:00 [INF] HTTP GET /swagger/v1/swagger.json responded 200 in 17.3275 ms
2025-11-13 09:37:09.599 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7257/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 36.5515ms
2025-11-13 09:39:55.681 +03:00 [DBG] Connection id "0HNH2FS8N638K" received FIN.
2025-11-13 09:39:55.681 +03:00 [DBG] Connection id "0HNH2FS8N638K" accepted.
2025-11-13 09:39:55.703 +03:00 [DBG] Connection id "0HNH2FS8N638K" started.
2025-11-13 09:39:55.704 +03:00 [DBG] Connection id "0HNH2FS8N638L" accepted.
2025-11-13 09:39:55.707 +03:00 [DBG] Failed to authenticate HTTPS connection.
System.IO.IOException: Received an unexpected EOF or 0 bytes from the transport stream.
   at System.Net.Security.SslStream.ReceiveHandshakeFrameAsync[TIOAdapter](CancellationToken cancellationToken)
   at System.Net.Security.SslStream.ForceAuthenticationAsync[TIOAdapter](Boolean receiveFirst, Byte[] reAuthenticationData, CancellationToken cancellationToken)
   at System.Net.Security.SslStream.ProcessAuthenticationWithTelemetryAsync(Boolean isAsync, CancellationToken cancellationToken)
   at Microsoft.AspNetCore.Server.Kestrel.Https.Internal.HttpsConnectionMiddleware.OnConnectionAsync(ConnectionContext context)
2025-11-13 09:39:55.709 +03:00 [DBG] Connection id "0HNH2FS8N638L" started.
2025-11-13 09:39:55.713 +03:00 [DBG] Connection id "0HNH2FS8N638K" stopped.
2025-11-13 09:39:55.717 +03:00 [DBG] Connection id "0HNH2FS8N638K" sending FIN because: "The Socket transport's send loop completed gracefully."
2025-11-13 09:39:55.721 +03:00 [DBG] Connection 0HNH2FS8N638L established using the following protocol: "Tls13"
2025-11-13 09:39:55.729 +03:00 [INF] Request starting HTTP/1.1 POST https://localhost:7257/api/Invoices - application/json 1316
2025-11-13 09:39:55.740 +03:00 [DBG] 1 candidate(s) found for the request path '/api/Invoices'
2025-11-13 09:39:55.750 +03:00 [DBG] Endpoint 'BillingSystem.API.Controllers.InvoicesController.Post (BillingSystem.API)' with route pattern 'api/Invoices' is valid for the request path '/api/Invoices'
2025-11-13 09:39:55.755 +03:00 [DBG] Request matched endpoint 'BillingSystem.API.Controllers.InvoicesController.Post (BillingSystem.API)'
2025-11-13 09:39:55.761 +03:00 [DBG] Static files was skipped as the request already matched an endpoint.
2025-11-13 09:39:55.978 +03:00 [DBG] An 'IServiceProvider' was created for internal use by Entity Framework.
2025-11-13 09:40:01.537 +03:00 [INF] Executing endpoint 'BillingSystem.API.Controllers.InvoicesController.Post (BillingSystem.API)'
2025-11-13 09:40:01.572 +03:00 [INF] Route matched with {action = "Post", controller = "Invoices"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Post(BillingSystem.Application.Requests.CreateInvoiceRequest) on controller BillingSystem.API.Controllers.InvoicesController (BillingSystem.API).
2025-11-13 09:40:01.580 +03:00 [DBG] Execution plan of authorization filters (in the following order): ["None"]
2025-11-13 09:40:01.586 +03:00 [DBG] Execution plan of resource filters (in the following order): ["None"]
2025-11-13 09:40:01.590 +03:00 [DBG] Execution plan of action filters (in the following order): ["Microsoft.AspNetCore.Mvc.ModelBinding.UnsupportedContentTypeFilter (Order: -3000)","Microsoft.AspNetCore.Mvc.Infrastructure.ModelStateInvalidFilter (Order: -2000)","BillingSystem.API.ActionFilters.AuditBillingRequestsFilter","BillingSystem.API.ActionFilters.IdempotencyFilter (Order: 0)"]
2025-11-13 09:40:01.597 +03:00 [DBG] Execution plan of exception filters (in the following order): ["None"]
2025-11-13 09:40:01.602 +03:00 [DBG] Execution plan of result filters (in the following order): ["Microsoft.AspNetCore.Mvc.Infrastructure.ClientErrorResultFilter (Order: -2000)","Microsoft.AspNetCore.Mvc.ProducesAttribute (Order: 0)","BillingSystem.API.ActionFilters.IdempotencyFilter (Order: 0)"]
2025-11-13 09:40:01.614 +03:00 [DBG] Executing controller factory for controller BillingSystem.API.Controllers.InvoicesController (BillingSystem.API)
2025-11-13 09:40:01.623 +03:00 [WRN] You do not have a valid license key for the Lucky Penny software MediatR. This is allowed for development and testing scenarios. If you are running in production you are required to have a licensed version. Please visit https://luckypennysoftware.com to obtain a valid license.
2025-11-13 09:40:01.689 +03:00 [DBG] Executed controller factory for controller BillingSystem.API.Controllers.InvoicesController (BillingSystem.API)
2025-11-13 09:40:01.723 +03:00 [DBG] Attempting to bind parameter 'invoiceRequest' of type 'BillingSystem.Application.Requests.CreateInvoiceRequest' ...
2025-11-13 09:40:01.736 +03:00 [DBG] Attempting to bind parameter 'invoiceRequest' of type 'BillingSystem.Application.Requests.CreateInvoiceRequest' using the name '' in request data ...
2025-11-13 09:40:01.746 +03:00 [DBG] Selected input formatter 'Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonInputFormatter' for content type 'application/json'.
2025-11-13 09:40:01.807 +03:00 [DBG] Connection id "0HNH2FS8N638L", Request id "0HNH2FS8N638L:00000001": started reading request body.
2025-11-13 09:40:01.817 +03:00 [DBG] Connection id "0HNH2FS8N638L", Request id "0HNH2FS8N638L:00000001": done reading request body.
2025-11-13 09:40:01.850 +03:00 [DBG] JSON input formatter succeeded, deserializing to type 'BillingSystem.Application.Requests.CreateInvoiceRequest'
2025-11-13 09:40:01.855 +03:00 [DBG] Done attempting to bind parameter 'invoiceRequest' of type 'BillingSystem.Application.Requests.CreateInvoiceRequest'.
2025-11-13 09:40:01.861 +03:00 [DBG] Done attempting to bind parameter 'invoiceRequest' of type 'BillingSystem.Application.Requests.CreateInvoiceRequest'.
2025-11-13 09:40:01.868 +03:00 [DBG] Attempting to validate the bound parameter 'invoiceRequest' of type 'BillingSystem.Application.Requests.CreateInvoiceRequest' ...
2025-11-13 09:40:01.895 +03:00 [DBG] Done attempting to validate the bound parameter 'invoiceRequest' of type 'BillingSystem.Application.Requests.CreateInvoiceRequest'.
2025-11-13 09:40:02.226 +03:00 [DBG] No relationship from 'Invoice' to 'Invoice' has been configured by convention because there are multiple properties on one entity type - {'DiscountedPrimaryInvoice'} that could be matched with the properties on the other entity type - {'InverseDiscountedPrimaryInvoice', 'InversePrimaryInvoice', 'InverseSubstitutionPrimaryInvoice', 'PrimaryInvoice', 'SubstitutionPrimaryInvoice'}. This message can be disregarded if explicit configuration has been specified in 'OnModelCreating'.
2025-11-13 09:40:02.456 +03:00 [DBG] No relationship from 'Invoice' to 'Invoice' has been configured by convention because there are multiple properties on one entity type - {'DiscountedPrimaryInvoice'} that could be matched with the properties on the other entity type - {'InverseDiscountedPrimaryInvoice', 'InversePrimaryInvoice', 'InverseSubstitutionPrimaryInvoice', 'PrimaryInvoice', 'SubstitutionPrimaryInvoice'}. This message can be disregarded if explicit configuration has been specified in 'OnModelCreating'.
2025-11-13 09:40:02.472 +03:00 [DBG] No relationship from 'Invoice' to 'Invoice' has been configured by convention because there are multiple properties on one entity type - {'InversePrimaryInvoice'} that could be matched with the properties on the other entity type - {'InverseSubstitutionPrimaryInvoice', 'PrimaryInvoice', 'SubstitutionPrimaryInvoice'}. This message can be disregarded if explicit configuration has been specified in 'OnModelCreating'.
2025-11-13 09:40:02.485 +03:00 [DBG] No relationship from 'Invoice' to 'Invoice' has been configured by convention because there are multiple properties on one entity type - {'InversePrimaryInvoice'} that could be matched with the properties on the other entity type - {'InverseSubstitutionPrimaryInvoice', 'PrimaryInvoice', 'SubstitutionPrimaryInvoice'}. This message can be disregarded if explicit configuration has been specified in 'OnModelCreating'.
2025-11-13 09:40:02.869 +03:00 [DBG] Entity Framework Core 9.0.9 initialized 'BillingServiceDBContext' using provider 'Microsoft.EntityFrameworkCore.SqlServer:9.0.9' with options: EngineType=SqlServer 
2025-11-13 09:40:03.001 +03:00 [DBG] Compiling query expression: 
'DbSet<Invoice>()
    .AsNoTracking()
    .Any(inv => inv.ExternalId.ToString() == __idempotentKey_0)'
2025-11-13 09:40:03.347 +03:00 [DBG] Generated query execution expression: 
'queryContext => ShapedQueryCompilingExpressionVisitor.SingleAsync<bool>(
    asyncEnumerable: SingleQueryingEnumerable.Create<bool>(
        relationalQueryContext: (RelationalQueryContext)queryContext, 
        relationalCommandResolver: parameters => [LIFTABLE Constant: RelationalCommandCache.QueryExpression(
            Projection Mapping:
                EmptyProjectionMember -> 0
            SELECT EXISTS (
                SELECT 1
                FROM Invoices AS i
                WHERE COALESCE(CONVERT(varchar(36), i.ExternalId), '') == @__idempotentKey_0)) | Resolver: c => new RelationalCommandCache(
            c.Dependencies.MemoryCache, 
            c.RelationalDependencies.QuerySqlGeneratorFactory, 
            c.RelationalDependencies.RelationalParameterBasedSqlProcessorFactory, 
            Projection Mapping:
                EmptyProjectionMember -> 0
            SELECT EXISTS (
                SELECT 1
                FROM Invoices AS i
                WHERE COALESCE(CONVERT(varchar(36), i.ExternalId), '') == @__idempotentKey_0), 
            False, 
            new HashSet<string>(
                new string[]{ }, 
                StringComparer.Ordinal
            )
        )].GetRelationalCommandTemplate(parameters), 
        readerColumns: null, 
        shaper: (queryContext, dataReader, resultContext, resultCoordinator) => 
        {
            bool? value1;
            value1 = dataReader.IsDBNull(0) ? default(bool?) : (bool?)dataReader.GetBoolean(0);
            return (bool)value1;
        }, 
        contextType: BillingSystem.Infrastructure.EF.BillingServiceDBContext, 
        standAloneStateManager: False, 
        detailedErrorsEnabled: False, 
        threadSafetyChecksEnabled: True), 
    cancellationToken: queryContext.CancellationToken)'
2025-11-13 09:40:03.422 +03:00 [DBG] Creating DbConnection.
2025-11-13 09:40:03.446 +03:00 [DBG] Created DbConnection. (22ms).
2025-11-13 09:40:03.458 +03:00 [DBG] Opening connection to database 'GAC-BillingService' on server '.'.
2025-11-13 09:40:03.733 +03:00 [DBG] Opened connection to database 'GAC-BillingService' on server '.'.
2025-11-13 09:40:03.744 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-11-13 09:40:03.759 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (11ms).
2025-11-13 09:40:03.776 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (32ms).
2025-11-13 09:40:03.790 +03:00 [DBG] Executing DbCommand [Parameters=[@__idempotentKey_0='?' (Size = 36) (DbType = AnsiString)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [Invoices] AS [i]
        WHERE CONVERT(varchar(36), [i].[ExternalId]) = @__idempotentKey_0) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2025-11-13 09:40:03.884 +03:00 [INF] Executed DbCommand (94ms) [Parameters=[@__idempotentKey_0='?' (Size = 36) (DbType = AnsiString)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [Invoices] AS [i]
        WHERE CONVERT(varchar(36), [i].[ExternalId]) = @__idempotentKey_0) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2025-11-13 09:40:03.923 +03:00 [DBG] Closing data reader to 'GAC-BillingService' on server '.'.
2025-11-13 09:40:03.947 +03:00 [DBG] A data reader for 'GAC-BillingService' on server '.' is being disposed after spending 45ms reading results.
2025-11-13 09:40:03.961 +03:00 [DBG] Closing connection to database 'GAC-BillingService' on server '.'.
2025-11-13 09:40:03.974 +03:00 [DBG] Closed connection to database 'GAC-BillingService' on server '.' (13ms).
2025-11-13 09:40:04.177 +03:00 [WRN] You do not have a valid license key for the Lucky Penny software AutoMapper. This is allowed for development and testing scenarios. If you are running in production you are required to have a licensed version. Please visit https://luckypennysoftware.com to obtain a valid license.
2025-11-13 09:40:15.605 +03:00 [DBG] Opening connection to database 'GAC-BillingService' on server '.'.
2025-11-13 09:40:15.614 +03:00 [DBG] Opened connection to database 'GAC-BillingService' on server '.'.
2025-11-13 09:40:15.624 +03:00 [DBG] Beginning transaction with isolation level 'Unspecified'.
2025-11-13 09:40:15.645 +03:00 [DBG] Began transaction with isolation level 'ReadCommitted'.
2025-11-13 09:40:17.972 +03:00 [DBG] 'BillingServiceDBContext' generated a temporary value for the property 'Invoice.Id'. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-11-13 09:40:18.137 +03:00 [DBG] Context 'BillingServiceDBContext' started tracking 'Invoice' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-11-13 09:40:18.145 +03:00 [DBG] 'BillingServiceDBContext' generated a temporary value for the property 'Customer.Id'. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-11-13 09:40:18.218 +03:00 [DBG] The foreign key property 'Invoice.CustomerId' was detected as changed. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see property values.
2025-11-13 09:40:18.233 +03:00 [DBG] Context 'BillingServiceDBContext' started tracking 'Customer' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-11-13 09:40:19.759 +03:00 [DBG] 'BillingServiceDBContext' generated a temporary value for the property 'OutboxEvent.Id'. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-11-13 09:40:19.786 +03:00 [DBG] Context 'BillingServiceDBContext' started tracking 'OutboxEvent' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-11-13 09:40:20.918 +03:00 [DBG] SaveChanges starting for 'BillingServiceDBContext'.
2025-11-13 09:40:20.925 +03:00 [DBG] DetectChanges starting for 'BillingServiceDBContext'.
2025-11-13 09:40:20.994 +03:00 [DBG] DetectChanges completed for 'BillingServiceDBContext'.
2025-11-13 09:40:21.099 +03:00 [DBG] Executing 2 update commands as a batch.
2025-11-13 09:40:21.106 +03:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-11-13 09:40:21.113 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-11-13 09:40:21.115 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (2ms).
2025-11-13 09:40:21.122 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (8ms).
2025-11-13 09:40:21.128 +03:00 [DBG] Executing DbCommand [Parameters=[@p0='?' (Size = 200), @p1='?' (Size = 200), @p2='?' (Size = 200), @p3='?' (Size = 200), @p4='?' (Size = 50), @p5='?' (Size = 200), @p6='?' (Size = 200), @p7='?' (Size = 50), @p8='?' (DbType = DateTime), @p9='?' (Size = 100), @p10='?' (Size = 80), @p11='?' (Size = 500), @p12='?' (Size = 100), @p13='?' (DbType = Int32), @p14='?' (DbType = Boolean), @p15='?' (DbType = DateTime), @p16='?' (Precision = 18) (DbType = Decimal), @p17='?' (Size = 50), @p18='?' (Size = 100), @p19='?' (DbType = Int64), @p20='?' (DbType = DateTime), @p21='?' (Size = 4000), @p22='?' (Size = 300), @p23='?' (Size = 4000), @p24='?' (DbType = Boolean), @p25='?' (Size = 20) (DbType = AnsiString)], CommandType='"Text"', CommandTimeout='30']
SET NOCOUNT ON;
INSERT INTO [Customers] ([Address_BuildingNumber], [Address_City], [Address_Country], [Address_District], [Address_PostalCode], [Address_Street], [Address_SubNumber], [CreatedBy], [CreatedDate], [CustomerType], [EmailAddress], [FullName], [IdentityNumber], [IdentityType], [IsDeleted], [LastUpdatedDate], [OverpaymentBalance], [PhoneNumber], [VATNumber])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18);
INSERT INTO [Outbox_events] ([Aggregate_id], [CreatedDate], [ErrorMsg], [Event_type], [Payload], [Processed], [ProcessingStatus])
OUTPUT INSERTED.[Id]
VALUES (@p19, @p20, @p21, @p22, @p23, @p24, @p25);
2025-11-13 09:40:21.145 +03:00 [INF] Executed DbCommand (20ms) [Parameters=[@p0='?' (Size = 200), @p1='?' (Size = 200), @p2='?' (Size = 200), @p3='?' (Size = 200), @p4='?' (Size = 50), @p5='?' (Size = 200), @p6='?' (Size = 200), @p7='?' (Size = 50), @p8='?' (DbType = DateTime), @p9='?' (Size = 100), @p10='?' (Size = 80), @p11='?' (Size = 500), @p12='?' (Size = 100), @p13='?' (DbType = Int32), @p14='?' (DbType = Boolean), @p15='?' (DbType = DateTime), @p16='?' (Precision = 18) (DbType = Decimal), @p17='?' (Size = 50), @p18='?' (Size = 100), @p19='?' (DbType = Int64), @p20='?' (DbType = DateTime), @p21='?' (Size = 4000), @p22='?' (Size = 300), @p23='?' (Size = 4000), @p24='?' (DbType = Boolean), @p25='?' (Size = 20) (DbType = AnsiString)], CommandType='"Text"', CommandTimeout='30']
SET NOCOUNT ON;
INSERT INTO [Customers] ([Address_BuildingNumber], [Address_City], [Address_Country], [Address_District], [Address_PostalCode], [Address_Street], [Address_SubNumber], [CreatedBy], [CreatedDate], [CustomerType], [EmailAddress], [FullName], [IdentityNumber], [IdentityType], [IsDeleted], [LastUpdatedDate], [OverpaymentBalance], [PhoneNumber], [VATNumber])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18);
INSERT INTO [Outbox_events] ([Aggregate_id], [CreatedDate], [ErrorMsg], [Event_type], [Payload], [Processed], [ProcessingStatus])
OUTPUT INSERTED.[Id]
VALUES (@p19, @p20, @p21, @p22, @p23, @p24, @p25);
2025-11-13 09:40:21.185 +03:00 [DBG] Closing data reader to 'GAC-BillingService' on server '.'.
2025-11-13 09:40:21.191 +03:00 [DBG] A data reader for 'GAC-BillingService' on server '.' is being disposed after spending 33ms reading results.
2025-11-13 09:40:21.221 +03:00 [ERR] An exception occurred in the database while saving changes for context type 'BillingSystem.Infrastructure.EF.BillingServiceDBContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): Cannot insert the value NULL into column 'CreatedBy', table 'GAC-BillingService.dbo.Customers'; column does not allow nulls. INSERT fails.
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:ce324fc7-2765-4fb3-bd52-a6c62b47830a
Error Number:515,State:2,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalDatabase.SaveChangesAsync(IList`1 entries, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): Cannot insert the value NULL into column 'CreatedBy', table 'GAC-BillingService.dbo.Customers'; column does not allow nulls. INSERT fails.
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:ce324fc7-2765-4fb3-bd52-a6c62b47830a
Error Number:515,State:2,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalDatabase.SaveChangesAsync(IList`1 entries, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2025-11-13 09:44:28.690 +03:00 [DBG] Registered model binder providers, in the following order: ["Microsoft.AspNetCore.Mvc.ModelBinding.Binders.BinderTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ServicesModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.BodyModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.HeaderModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FloatingPointTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.EnumTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.DateTimeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.SimpleTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.TryParseModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.CancellationTokenModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ByteArrayModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FormFileModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FormCollectionModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.KeyValuePairModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.DictionaryModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ArrayModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.CollectionModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ComplexObjectModelBinderProvider"]
2025-11-13 09:44:28.873 +03:00 [DBG] Hosting starting
2025-11-13 09:44:29.241 +03:00 [DBG] Starting bus instances: IBus
2025-11-13 09:44:29.250 +03:00 [DBG] Starting bus: "rabbitmq://localhost/"
2025-11-13 09:44:29.283 +03:00 [DBG] Middleware loaded
2025-11-13 09:44:29.289 +03:00 [DBG] Middleware loaded. Script /_framework/aspnetcore-browser-refresh.js (16519 B).
2025-11-13 09:44:29.296 +03:00 [DBG] Middleware loaded. Script /_framework/blazor-hotreload.js (799 B).
2025-11-13 09:44:29.312 +03:00 [DBG] Connect: guest@localhost:5672/
2025-11-13 09:44:29.444 +03:00 [DBG] Middleware loaded: DOTNET_MODIFIABLE_ASSEMBLIES=debug, __ASPNETCORE_BROWSER_TOOLS=true
2025-11-13 09:44:29.468 +03:00 [DBG] Connected: guest@localhost:5672/ (address: amqp://localhost:5672, local: 64844)
2025-11-13 09:44:29.529 +03:00 [DBG] Endpoint Ready: "rabbitmq://localhost/ECHGHANNAMLP1_BillingSystemAPI_bus_od7yyyyh3bcsywbkbdxnfyyanf?temporary=true"
2025-11-13 09:44:29.534 +03:00 [INF] Bus started: "rabbitmq://localhost/"
2025-11-13 09:44:29.781 +03:00 [INF] Now listening on: https://localhost:7257
2025-11-13 09:44:29.789 +03:00 [INF] Now listening on: http://localhost:5009
2025-11-13 09:44:29.793 +03:00 [DBG] Loaded hosting startup assembly BillingSystem.API
2025-11-13 09:44:29.798 +03:00 [DBG] Loaded hosting startup assembly Microsoft.WebTools.ApiEndpointDiscovery
2025-11-13 09:44:29.801 +03:00 [DBG] Loaded hosting startup assembly Microsoft.AspNetCore.Watch.BrowserRefresh
2025-11-13 09:44:29.807 +03:00 [DBG] Loaded hosting startup assembly Microsoft.WebTools.BrowserLink.Net
2025-11-13 09:44:29.931 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-11-13 09:44:29.935 +03:00 [INF] Hosting environment: Development
2025-11-13 09:44:29.937 +03:00 [INF] Content root path: C:\Repositories\Gac-BillingSystem\src\BillingSystem.API
2025-11-13 09:44:29.941 +03:00 [DBG] Hosting started
2025-11-13 09:44:30.240 +03:00 [DBG] Connection id "0HNH2G0CELM4N" accepted.
2025-11-13 09:44:30.240 +03:00 [DBG] Connection id "0HNH2G0CELM4M" accepted.
2025-11-13 09:44:30.246 +03:00 [DBG] Connection id "0HNH2G0CELM4N" started.
2025-11-13 09:44:30.250 +03:00 [DBG] Connection id "0HNH2G0CELM4M" started.
2025-11-13 09:44:30.256 +03:00 [DBG] Connection id "0HNH2G0CELM4N" received FIN.
2025-11-13 09:44:30.256 +03:00 [DBG] Connection id "0HNH2G0CELM4M" received FIN.
2025-11-13 09:44:30.283 +03:00 [DBG] Failed to authenticate HTTPS connection.
System.IO.IOException: Received an unexpected EOF or 0 bytes from the transport stream.
   at System.Net.Security.SslStream.ReceiveHandshakeFrameAsync[TIOAdapter](CancellationToken cancellationToken)
   at System.Net.Security.SslStream.ForceAuthenticationAsync[TIOAdapter](Boolean receiveFirst, Byte[] reAuthenticationData, CancellationToken cancellationToken)
   at System.Net.Security.SslStream.ProcessAuthenticationWithTelemetryAsync(Boolean isAsync, CancellationToken cancellationToken)
   at Microsoft.AspNetCore.Server.Kestrel.Https.Internal.HttpsConnectionMiddleware.OnConnectionAsync(ConnectionContext context)
2025-11-13 09:44:30.283 +03:00 [DBG] Failed to authenticate HTTPS connection.
System.IO.IOException: Received an unexpected EOF or 0 bytes from the transport stream.
   at System.Net.Security.SslStream.ReceiveHandshakeFrameAsync[TIOAdapter](CancellationToken cancellationToken)
   at System.Net.Security.SslStream.ForceAuthenticationAsync[TIOAdapter](Boolean receiveFirst, Byte[] reAuthenticationData, CancellationToken cancellationToken)
   at System.Net.Security.SslStream.ProcessAuthenticationWithTelemetryAsync(Boolean isAsync, CancellationToken cancellationToken)
   at Microsoft.AspNetCore.Server.Kestrel.Https.Internal.HttpsConnectionMiddleware.OnConnectionAsync(ConnectionContext context)
2025-11-13 09:44:30.319 +03:00 [DBG] Connection id "0HNH2G0CELM4N" stopped.
2025-11-13 09:44:30.321 +03:00 [DBG] Connection id "0HNH2G0CELM4M" stopped.
2025-11-13 09:44:30.334 +03:00 [DBG] Connection id "0HNH2G0CELM4N" sending FIN because: "The Socket transport's send loop completed gracefully."
2025-11-13 09:44:30.334 +03:00 [DBG] Connection id "0HNH2G0CELM4M" sending FIN because: "The Socket transport's send loop completed gracefully."
2025-11-13 09:44:30.948 +03:00 [DBG] Connection id "0HNH2G0CELM4O" accepted.
2025-11-13 09:44:30.951 +03:00 [DBG] Connection id "0HNH2G0CELM4O" started.
2025-11-13 09:44:31.014 +03:00 [DBG] Connection 0HNH2G0CELM4O established using the following protocol: "Tls13"
2025-11-13 09:44:31.090 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7257/swagger/index.html - null null
2025-11-13 09:44:31.159 +03:00 [DBG] Wildcard detected, all requests with hosts will be allowed.
2025-11-13 09:44:31.187 +03:00 [DBG] No candidates found for the request path '/swagger/index.html'
2025-11-13 09:44:31.191 +03:00 [DBG] Request did not match any endpoints
2025-11-13 09:44:31.268 +03:00 [DBG] Response markup is scheduled to include Browser Link script injection.
2025-11-13 09:44:31.274 +03:00 [DBG] Response markup is scheduled to include browser refresh script injection.
2025-11-13 09:44:31.306 +03:00 [INF] HTTP GET /swagger/index.html responded 200 in 104.7918 ms
2025-11-13 09:44:31.314 +03:00 [DBG] Response markup was updated to include Browser Link script injection.
2025-11-13 09:44:31.317 +03:00 [DBG] Response markup was updated to include browser refresh script injection.
2025-11-13 09:44:31.324 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7257/swagger/index.html - 200 null text/html;charset=utf-8 244.0864ms
2025-11-13 09:44:31.414 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7257/_vs/browserLink - null null
2025-11-13 09:44:31.414 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7257/_framework/aspnetcore-browser-refresh.js - null null
2025-11-13 09:44:31.441 +03:00 [DBG] Script injected: /_framework/aspnetcore-browser-refresh.js
2025-11-13 09:44:31.449 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7257/_framework/aspnetcore-browser-refresh.js - 200 16519 application/javascript; charset=utf-8 34.8346ms
2025-11-13 09:44:31.500 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7257/_vs/browserLink - 200 null text/javascript; charset=UTF-8 86.8635ms
2025-11-13 09:44:31.596 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7257/swagger/v1/swagger.json - null null
2025-11-13 09:44:31.602 +03:00 [DBG] No candidates found for the request path '/swagger/v1/swagger.json'
2025-11-13 09:44:31.605 +03:00 [DBG] Request did not match any endpoints
2025-11-13 09:44:31.627 +03:00 [INF] HTTP GET /swagger/v1/swagger.json responded 200 in 18.0966 ms
2025-11-13 09:44:31.634 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7257/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 38.31ms
2025-11-13 09:44:41.229 +03:00 [DBG] Connection id "0HNH2G0CELM4P" accepted.
2025-11-13 09:44:41.229 +03:00 [DBG] Connection id "0HNH2G0CELM4P" received FIN.
2025-11-13 09:44:41.235 +03:00 [DBG] Connection id "0HNH2G0CELM4P" started.
2025-11-13 09:44:41.236 +03:00 [DBG] Connection id "0HNH2G0CELM4Q" accepted.
2025-11-13 09:44:41.247 +03:00 [DBG] Failed to authenticate HTTPS connection.
System.IO.IOException: Received an unexpected EOF or 0 bytes from the transport stream.
   at System.Net.Security.SslStream.ReceiveHandshakeFrameAsync[TIOAdapter](CancellationToken cancellationToken)
   at System.Net.Security.SslStream.ForceAuthenticationAsync[TIOAdapter](Boolean receiveFirst, Byte[] reAuthenticationData, CancellationToken cancellationToken)
   at System.Net.Security.SslStream.ProcessAuthenticationWithTelemetryAsync(Boolean isAsync, CancellationToken cancellationToken)
   at Microsoft.AspNetCore.Server.Kestrel.Https.Internal.HttpsConnectionMiddleware.OnConnectionAsync(ConnectionContext context)
2025-11-13 09:44:41.250 +03:00 [DBG] Connection id "0HNH2G0CELM4Q" started.
2025-11-13 09:44:41.257 +03:00 [DBG] Connection id "0HNH2G0CELM4P" stopped.
2025-11-13 09:44:41.262 +03:00 [DBG] Connection id "0HNH2G0CELM4P" sending FIN because: "The Socket transport's send loop completed gracefully."
2025-11-13 09:44:41.265 +03:00 [DBG] Connection 0HNH2G0CELM4Q established using the following protocol: "Tls13"
2025-11-13 09:44:41.277 +03:00 [INF] Request starting HTTP/1.1 POST https://localhost:7257/api/Invoices - application/json 1316
2025-11-13 09:44:41.294 +03:00 [DBG] 1 candidate(s) found for the request path '/api/Invoices'
2025-11-13 09:44:41.304 +03:00 [DBG] Endpoint 'BillingSystem.API.Controllers.InvoicesController.Post (BillingSystem.API)' with route pattern 'api/Invoices' is valid for the request path '/api/Invoices'
2025-11-13 09:44:41.309 +03:00 [DBG] Request matched endpoint 'BillingSystem.API.Controllers.InvoicesController.Post (BillingSystem.API)'
2025-11-13 09:44:41.317 +03:00 [DBG] Static files was skipped as the request already matched an endpoint.
2025-11-13 09:44:41.559 +03:00 [DBG] An 'IServiceProvider' was created for internal use by Entity Framework.
2025-11-13 09:44:47.034 +03:00 [INF] Executing endpoint 'BillingSystem.API.Controllers.InvoicesController.Post (BillingSystem.API)'
2025-11-13 09:44:47.092 +03:00 [INF] Route matched with {action = "Post", controller = "Invoices"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Post(BillingSystem.Application.Requests.CreateInvoiceRequest) on controller BillingSystem.API.Controllers.InvoicesController (BillingSystem.API).
2025-11-13 09:44:47.103 +03:00 [DBG] Execution plan of authorization filters (in the following order): ["None"]
2025-11-13 09:44:47.109 +03:00 [DBG] Execution plan of resource filters (in the following order): ["None"]
2025-11-13 09:44:47.113 +03:00 [DBG] Execution plan of action filters (in the following order): ["Microsoft.AspNetCore.Mvc.ModelBinding.UnsupportedContentTypeFilter (Order: -3000)","Microsoft.AspNetCore.Mvc.Infrastructure.ModelStateInvalidFilter (Order: -2000)","BillingSystem.API.ActionFilters.AuditBillingRequestsFilter","BillingSystem.API.ActionFilters.IdempotencyFilter (Order: 0)"]
2025-11-13 09:44:47.121 +03:00 [DBG] Execution plan of exception filters (in the following order): ["None"]
2025-11-13 09:44:47.126 +03:00 [DBG] Execution plan of result filters (in the following order): ["Microsoft.AspNetCore.Mvc.Infrastructure.ClientErrorResultFilter (Order: -2000)","Microsoft.AspNetCore.Mvc.ProducesAttribute (Order: 0)","BillingSystem.API.ActionFilters.IdempotencyFilter (Order: 0)"]
2025-11-13 09:44:47.134 +03:00 [DBG] Executing controller factory for controller BillingSystem.API.Controllers.InvoicesController (BillingSystem.API)
2025-11-13 09:44:47.142 +03:00 [WRN] You do not have a valid license key for the Lucky Penny software MediatR. This is allowed for development and testing scenarios. If you are running in production you are required to have a licensed version. Please visit https://luckypennysoftware.com to obtain a valid license.
2025-11-13 09:44:47.195 +03:00 [DBG] Executed controller factory for controller BillingSystem.API.Controllers.InvoicesController (BillingSystem.API)
2025-11-13 09:44:47.219 +03:00 [DBG] Attempting to bind parameter 'invoiceRequest' of type 'BillingSystem.Application.Requests.CreateInvoiceRequest' ...
2025-11-13 09:44:47.226 +03:00 [DBG] Attempting to bind parameter 'invoiceRequest' of type 'BillingSystem.Application.Requests.CreateInvoiceRequest' using the name '' in request data ...
2025-11-13 09:44:47.234 +03:00 [DBG] Selected input formatter 'Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonInputFormatter' for content type 'application/json'.
2025-11-13 09:44:47.289 +03:00 [DBG] Connection id "0HNH2G0CELM4Q", Request id "0HNH2G0CELM4Q:00000001": started reading request body.
2025-11-13 09:44:47.297 +03:00 [DBG] Connection id "0HNH2G0CELM4Q", Request id "0HNH2G0CELM4Q:00000001": done reading request body.
2025-11-13 09:44:47.349 +03:00 [DBG] JSON input formatter succeeded, deserializing to type 'BillingSystem.Application.Requests.CreateInvoiceRequest'
2025-11-13 09:44:47.357 +03:00 [DBG] Done attempting to bind parameter 'invoiceRequest' of type 'BillingSystem.Application.Requests.CreateInvoiceRequest'.
2025-11-13 09:44:47.360 +03:00 [DBG] Done attempting to bind parameter 'invoiceRequest' of type 'BillingSystem.Application.Requests.CreateInvoiceRequest'.
2025-11-13 09:44:47.366 +03:00 [DBG] Attempting to validate the bound parameter 'invoiceRequest' of type 'BillingSystem.Application.Requests.CreateInvoiceRequest' ...
2025-11-13 09:44:47.404 +03:00 [DBG] Done attempting to validate the bound parameter 'invoiceRequest' of type 'BillingSystem.Application.Requests.CreateInvoiceRequest'.
2025-11-13 09:44:47.759 +03:00 [DBG] No relationship from 'Invoice' to 'Invoice' has been configured by convention because there are multiple properties on one entity type - {'DiscountedPrimaryInvoice'} that could be matched with the properties on the other entity type - {'InverseDiscountedPrimaryInvoice', 'InversePrimaryInvoice', 'InverseSubstitutionPrimaryInvoice', 'PrimaryInvoice', 'SubstitutionPrimaryInvoice'}. This message can be disregarded if explicit configuration has been specified in 'OnModelCreating'.
2025-11-13 09:44:48.004 +03:00 [DBG] No relationship from 'Invoice' to 'Invoice' has been configured by convention because there are multiple properties on one entity type - {'DiscountedPrimaryInvoice'} that could be matched with the properties on the other entity type - {'InverseDiscountedPrimaryInvoice', 'InversePrimaryInvoice', 'InverseSubstitutionPrimaryInvoice', 'PrimaryInvoice', 'SubstitutionPrimaryInvoice'}. This message can be disregarded if explicit configuration has been specified in 'OnModelCreating'.
2025-11-13 09:44:48.018 +03:00 [DBG] No relationship from 'Invoice' to 'Invoice' has been configured by convention because there are multiple properties on one entity type - {'InversePrimaryInvoice'} that could be matched with the properties on the other entity type - {'InverseSubstitutionPrimaryInvoice', 'PrimaryInvoice', 'SubstitutionPrimaryInvoice'}. This message can be disregarded if explicit configuration has been specified in 'OnModelCreating'.
2025-11-13 09:44:48.027 +03:00 [DBG] No relationship from 'Invoice' to 'Invoice' has been configured by convention because there are multiple properties on one entity type - {'InversePrimaryInvoice'} that could be matched with the properties on the other entity type - {'InverseSubstitutionPrimaryInvoice', 'PrimaryInvoice', 'SubstitutionPrimaryInvoice'}. This message can be disregarded if explicit configuration has been specified in 'OnModelCreating'.
2025-11-13 09:44:48.386 +03:00 [DBG] Entity Framework Core 9.0.9 initialized 'BillingServiceDBContext' using provider 'Microsoft.EntityFrameworkCore.SqlServer:9.0.9' with options: EngineType=SqlServer 
2025-11-13 09:44:48.534 +03:00 [DBG] Compiling query expression: 
'DbSet<Invoice>()
    .AsNoTracking()
    .Any(inv => inv.ExternalId.ToString() == __idempotentKey_0)'
2025-11-13 09:44:48.844 +03:00 [DBG] Generated query execution expression: 
'queryContext => ShapedQueryCompilingExpressionVisitor.SingleAsync<bool>(
    asyncEnumerable: SingleQueryingEnumerable.Create<bool>(
        relationalQueryContext: (RelationalQueryContext)queryContext, 
        relationalCommandResolver: parameters => [LIFTABLE Constant: RelationalCommandCache.QueryExpression(
            Projection Mapping:
                EmptyProjectionMember -> 0
            SELECT EXISTS (
                SELECT 1
                FROM Invoices AS i
                WHERE COALESCE(CONVERT(varchar(36), i.ExternalId), '') == @__idempotentKey_0)) | Resolver: c => new RelationalCommandCache(
            c.Dependencies.MemoryCache, 
            c.RelationalDependencies.QuerySqlGeneratorFactory, 
            c.RelationalDependencies.RelationalParameterBasedSqlProcessorFactory, 
            Projection Mapping:
                EmptyProjectionMember -> 0
            SELECT EXISTS (
                SELECT 1
                FROM Invoices AS i
                WHERE COALESCE(CONVERT(varchar(36), i.ExternalId), '') == @__idempotentKey_0), 
            False, 
            new HashSet<string>(
                new string[]{ }, 
                StringComparer.Ordinal
            )
        )].GetRelationalCommandTemplate(parameters), 
        readerColumns: null, 
        shaper: (queryContext, dataReader, resultContext, resultCoordinator) => 
        {
            bool? value1;
            value1 = dataReader.IsDBNull(0) ? default(bool?) : (bool?)dataReader.GetBoolean(0);
            return (bool)value1;
        }, 
        contextType: BillingSystem.Infrastructure.EF.BillingServiceDBContext, 
        standAloneStateManager: False, 
        detailedErrorsEnabled: False, 
        threadSafetyChecksEnabled: True), 
    cancellationToken: queryContext.CancellationToken)'
2025-11-13 09:44:48.928 +03:00 [DBG] Creating DbConnection.
2025-11-13 09:44:48.964 +03:00 [DBG] Created DbConnection. (31ms).
2025-11-13 09:44:48.974 +03:00 [DBG] Opening connection to database 'GAC-BillingService' on server '.'.
2025-11-13 09:44:49.318 +03:00 [DBG] Opened connection to database 'GAC-BillingService' on server '.'.
2025-11-13 09:44:49.327 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-11-13 09:44:49.336 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (6ms).
2025-11-13 09:44:49.349 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (23ms).
2025-11-13 09:44:49.373 +03:00 [DBG] Executing DbCommand [Parameters=[@__idempotentKey_0='?' (Size = 36) (DbType = AnsiString)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [Invoices] AS [i]
        WHERE CONVERT(varchar(36), [i].[ExternalId]) = @__idempotentKey_0) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2025-11-13 09:44:49.469 +03:00 [INF] Executed DbCommand (103ms) [Parameters=[@__idempotentKey_0='?' (Size = 36) (DbType = AnsiString)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [Invoices] AS [i]
        WHERE CONVERT(varchar(36), [i].[ExternalId]) = @__idempotentKey_0) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2025-11-13 09:44:49.504 +03:00 [DBG] Closing data reader to 'GAC-BillingService' on server '.'.
2025-11-13 09:44:49.524 +03:00 [DBG] A data reader for 'GAC-BillingService' on server '.' is being disposed after spending 39ms reading results.
2025-11-13 09:44:49.536 +03:00 [DBG] Closing connection to database 'GAC-BillingService' on server '.'.
2025-11-13 09:44:49.551 +03:00 [DBG] Closed connection to database 'GAC-BillingService' on server '.' (14ms).
2025-11-13 09:44:49.779 +03:00 [WRN] You do not have a valid license key for the Lucky Penny software AutoMapper. This is allowed for development and testing scenarios. If you are running in production you are required to have a licensed version. Please visit https://luckypennysoftware.com to obtain a valid license.
2025-11-13 09:44:56.372 +03:00 [DBG] Opening connection to database 'GAC-BillingService' on server '.'.
2025-11-13 09:44:56.381 +03:00 [DBG] Opened connection to database 'GAC-BillingService' on server '.'.
2025-11-13 09:44:56.386 +03:00 [DBG] Beginning transaction with isolation level 'Unspecified'.
2025-11-13 09:44:56.405 +03:00 [DBG] Began transaction with isolation level 'ReadCommitted'.
2025-11-13 09:44:57.405 +03:00 [DBG] 'BillingServiceDBContext' generated a temporary value for the property 'Invoice.Id'. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-11-13 09:44:57.563 +03:00 [DBG] Context 'BillingServiceDBContext' started tracking 'Invoice' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-11-13 09:44:57.573 +03:00 [DBG] 'BillingServiceDBContext' generated a temporary value for the property 'Customer.Id'. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-11-13 09:44:57.636 +03:00 [DBG] The foreign key property 'Invoice.CustomerId' was detected as changed. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see property values.
2025-11-13 09:44:57.656 +03:00 [DBG] Context 'BillingServiceDBContext' started tracking 'Customer' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-11-13 09:44:57.789 +03:00 [DBG] 'BillingServiceDBContext' generated a temporary value for the property 'OutboxEvent.Id'. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-11-13 09:44:57.823 +03:00 [DBG] Context 'BillingServiceDBContext' started tracking 'OutboxEvent' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-11-13 09:44:58.622 +03:00 [DBG] SaveChanges starting for 'BillingServiceDBContext'.
2025-11-13 09:44:58.629 +03:00 [DBG] DetectChanges starting for 'BillingServiceDBContext'.
2025-11-13 09:44:58.689 +03:00 [DBG] DetectChanges completed for 'BillingServiceDBContext'.
2025-11-13 09:44:58.783 +03:00 [DBG] Executing 2 update commands as a batch.
2025-11-13 09:44:58.792 +03:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-11-13 09:44:58.800 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-11-13 09:44:58.805 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (4ms).
2025-11-13 09:44:58.811 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (10ms).
2025-11-13 09:44:58.817 +03:00 [DBG] Executing DbCommand [Parameters=[@p0='?' (Size = 200), @p1='?' (Size = 200), @p2='?' (Size = 200), @p3='?' (Size = 200), @p4='?' (Size = 50), @p5='?' (Size = 200), @p6='?' (Size = 200), @p7='?' (Size = 50), @p8='?' (DbType = DateTime), @p9='?' (Size = 100), @p10='?' (Size = 80), @p11='?' (Size = 500), @p12='?' (Size = 100), @p13='?' (DbType = Int32), @p14='?' (DbType = Boolean), @p15='?' (DbType = DateTime), @p16='?' (Precision = 18) (DbType = Decimal), @p17='?' (Size = 50), @p18='?' (Size = 100), @p19='?' (DbType = Int64), @p20='?' (DbType = DateTime), @p21='?' (Size = 4000), @p22='?' (Size = 300), @p23='?' (Size = 4000), @p24='?' (DbType = Boolean), @p25='?' (Size = 20) (DbType = AnsiString)], CommandType='"Text"', CommandTimeout='30']
SET NOCOUNT ON;
INSERT INTO [Customers] ([Address_BuildingNumber], [Address_City], [Address_Country], [Address_District], [Address_PostalCode], [Address_Street], [Address_SubNumber], [CreatedBy], [CreatedDate], [CustomerType], [EmailAddress], [FullName], [IdentityNumber], [IdentityType], [IsDeleted], [LastUpdatedDate], [OverpaymentBalance], [PhoneNumber], [VATNumber])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18);
INSERT INTO [Outbox_events] ([Aggregate_id], [CreatedDate], [ErrorMsg], [Event_type], [Payload], [Processed], [ProcessingStatus])
OUTPUT INSERTED.[Id]
VALUES (@p19, @p20, @p21, @p22, @p23, @p24, @p25);
2025-11-13 09:44:58.838 +03:00 [INF] Executed DbCommand (24ms) [Parameters=[@p0='?' (Size = 200), @p1='?' (Size = 200), @p2='?' (Size = 200), @p3='?' (Size = 200), @p4='?' (Size = 50), @p5='?' (Size = 200), @p6='?' (Size = 200), @p7='?' (Size = 50), @p8='?' (DbType = DateTime), @p9='?' (Size = 100), @p10='?' (Size = 80), @p11='?' (Size = 500), @p12='?' (Size = 100), @p13='?' (DbType = Int32), @p14='?' (DbType = Boolean), @p15='?' (DbType = DateTime), @p16='?' (Precision = 18) (DbType = Decimal), @p17='?' (Size = 50), @p18='?' (Size = 100), @p19='?' (DbType = Int64), @p20='?' (DbType = DateTime), @p21='?' (Size = 4000), @p22='?' (Size = 300), @p23='?' (Size = 4000), @p24='?' (DbType = Boolean), @p25='?' (Size = 20) (DbType = AnsiString)], CommandType='"Text"', CommandTimeout='30']
SET NOCOUNT ON;
INSERT INTO [Customers] ([Address_BuildingNumber], [Address_City], [Address_Country], [Address_District], [Address_PostalCode], [Address_Street], [Address_SubNumber], [CreatedBy], [CreatedDate], [CustomerType], [EmailAddress], [FullName], [IdentityNumber], [IdentityType], [IsDeleted], [LastUpdatedDate], [OverpaymentBalance], [PhoneNumber], [VATNumber])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18);
INSERT INTO [Outbox_events] ([Aggregate_id], [CreatedDate], [ErrorMsg], [Event_type], [Payload], [Processed], [ProcessingStatus])
OUTPUT INSERTED.[Id]
VALUES (@p19, @p20, @p21, @p22, @p23, @p24, @p25);
2025-11-13 09:44:58.874 +03:00 [DBG] The foreign key property 'Customer.Id' was detected as changed. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see property values.
2025-11-13 09:44:58.885 +03:00 [DBG] The foreign key property 'Invoice.CustomerId' was detected as changed. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see property values.
2025-11-13 09:44:58.894 +03:00 [DBG] The foreign key property 'OutboxEvent.Id' was detected as changed. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see property values.
2025-11-13 09:44:58.900 +03:00 [DBG] Closing data reader to 'GAC-BillingService' on server '.'.
2025-11-13 09:44:58.906 +03:00 [DBG] A data reader for 'GAC-BillingService' on server '.' is being disposed after spending 62ms reading results.
2025-11-13 09:44:58.915 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-11-13 09:44:58.920 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (5ms).
2025-11-13 09:44:58.926 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (10ms).
2025-11-13 09:44:58.933 +03:00 [DBG] Executing DbCommand [Parameters=[@p26='?' (Precision = 18) (DbType = Decimal), @p27='?' (Size = 3000), @p28='?' (Size = 100), @p29='?' (Size = 50), @p30='?' (DbType = DateTime), @p31='?' (Size = 50), @p32='?' (DbType = Int64), @p33='?' (DbType = Int64), @p34='?' (DbType = DateTime), @p35='?' (DbType = Guid), @p36='?' (Size = 50), @p37='?' (DbType = Int32), @p38='?' (DbType = Int32), @p39='?' (DbType = Boolean), @p40='?' (DbType = Boolean), @p41='?' (DbType = Boolean), @p42='?' (DbType = Boolean), @p43='?' (DbType = DateTime), @p44='?' (DbType = DateTime), @p45='?' (Size = 4000), @p46='?' (Size = 100), @p47='?' (Size = 100), @p48='?' (DbType = Int64), @p49='?' (Size = 4000), @p50='?' (DbType = Int64), @p51='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [Invoices] ([Amount], [CancelationReasons], [ClientReferenceNumber], [CreatedBy], [CreatedDate], [Currency], [CustomerID], [DiscountedPrimaryInvoiceID], [DueAt], [ExternalId], [InvoiceNumber], [InvoiceStatus], [InvoiceType], [IsDeleted], [IsDiscounted], [IsSubInvoice], [IsSubstitution], [IssuedAt], [LastUpdatedDate], [Metadata], [PaymentProvider], [PaymentReference], [PrimaryInvoiceID], [SerializedOutboxEvent], [SubstitutionPrimaryInvoiceID], [TenantId])
OUTPUT INSERTED.[Id]
VALUES (@p26, @p27, @p28, @p29, @p30, @p31, @p32, @p33, @p34, @p35, @p36, @p37, @p38, @p39, @p40, @p41, @p42, @p43, @p44, @p45, @p46, @p47, @p48, @p49, @p50, @p51);
2025-11-13 09:44:58.958 +03:00 [ERR] Failed executing DbCommand (26ms) [Parameters=[@p26='?' (Precision = 18) (DbType = Decimal), @p27='?' (Size = 3000), @p28='?' (Size = 100), @p29='?' (Size = 50), @p30='?' (DbType = DateTime), @p31='?' (Size = 50), @p32='?' (DbType = Int64), @p33='?' (DbType = Int64), @p34='?' (DbType = DateTime), @p35='?' (DbType = Guid), @p36='?' (Size = 50), @p37='?' (DbType = Int32), @p38='?' (DbType = Int32), @p39='?' (DbType = Boolean), @p40='?' (DbType = Boolean), @p41='?' (DbType = Boolean), @p42='?' (DbType = Boolean), @p43='?' (DbType = DateTime), @p44='?' (DbType = DateTime), @p45='?' (Size = 4000), @p46='?' (Size = 100), @p47='?' (Size = 100), @p48='?' (DbType = Int64), @p49='?' (Size = 4000), @p50='?' (DbType = Int64), @p51='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [Invoices] ([Amount], [CancelationReasons], [ClientReferenceNumber], [CreatedBy], [CreatedDate], [Currency], [CustomerID], [DiscountedPrimaryInvoiceID], [DueAt], [ExternalId], [InvoiceNumber], [InvoiceStatus], [InvoiceType], [IsDeleted], [IsDiscounted], [IsSubInvoice], [IsSubstitution], [IssuedAt], [LastUpdatedDate], [Metadata], [PaymentProvider], [PaymentReference], [PrimaryInvoiceID], [SerializedOutboxEvent], [SubstitutionPrimaryInvoiceID], [TenantId])
OUTPUT INSERTED.[Id]
VALUES (@p26, @p27, @p28, @p29, @p30, @p31, @p32, @p33, @p34, @p35, @p36, @p37, @p38, @p39, @p40, @p41, @p42, @p43, @p44, @p45, @p46, @p47, @p48, @p49, @p50, @p51);
2025-11-13 09:44:58.997 +03:00 [ERR] An exception occurred in the database while saving changes for context type 'BillingSystem.Infrastructure.EF.BillingServiceDBContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): Invalid column name 'SerializedOutboxEvent'.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__211_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
ClientConnectionId:e91c974f-0cfc-49bc-83db-c7162990101c
Error Number:207,State:1,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalDatabase.SaveChangesAsync(IList`1 entries, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): Invalid column name 'SerializedOutboxEvent'.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__211_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
ClientConnectionId:e91c974f-0cfc-49bc-83db-c7162990101c
Error Number:207,State:1,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalDatabase.SaveChangesAsync(IList`1 entries, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2025-11-13 09:46:41.581 +03:00 [ERR] exception occured An error occurred while saving the entity changes. See the inner exception for details. , stackTrace    at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalDatabase.SaveChangesAsync(IList`1 entries, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at BillingSystem.Infrastructure.Persistence.EF.InvoiceRepository.Insert(Invoice entity)
2025-11-13 09:46:41.629 +03:00 [ERR] exception inner exception Invalid column name 'SerializedOutboxEvent'. , stackTrace    at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__211_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
2025-11-13 09:46:41.644 +03:00 [DBG] Rolling back transaction.
2025-11-13 09:46:41.681 +03:00 [DBG] Rolled back transaction.
2025-11-13 09:46:41.694 +03:00 [DBG] Closing connection to database 'GAC-BillingService' on server '.'.
2025-11-13 09:46:41.697 +03:00 [DBG] Closed connection to database 'GAC-BillingService' on server '.' (3ms).
2025-11-13 09:46:41.732 +03:00 [DBG] Disposing transaction.
2025-11-13 09:46:41.809 +03:00 [ERR] exception occured An error occurred while saving the entity changes. See the inner exception for details. , stackTrace    at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalDatabase.SaveChangesAsync(IList`1 entries, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at BillingSystem.Infrastructure.Persistence.EF.InvoiceRepository.Insert(Invoice entity)
   at BillingSystem.Application.Commands.CreateInvoiceCommandRequestHandler.Handle(CreateInvoiceRequest request, CancellationToken cancellationToken) in C:\Repositories\Gac-BillingSystem\src\BillingSystem.Application\Commands\CreateInvoiceCommandRequestHandler.cs:line 43
   at BillingSystem.API.Controllers.InvoicesController.Post(CreateInvoiceRequest invoiceRequest) in C:\Repositories\Gac-BillingSystem\src\BillingSystem.API\Controllers\InvoicesController.cs:line 45
2025-11-13 09:46:41.813 +03:00 [ERR] exception inner exception Invalid column name 'SerializedOutboxEvent'. , stackTrace    at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__211_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
2025-11-13 09:46:41.832 +03:00 [DBG] List of registered output formatters, in the following order: ["Microsoft.AspNetCore.Mvc.Formatters.HttpNoContentOutputFormatter","Microsoft.AspNetCore.Mvc.Formatters.StringOutputFormatter","Microsoft.AspNetCore.Mvc.Formatters.StreamOutputFormatter","Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonOutputFormatter"]
2025-11-13 09:46:41.840 +03:00 [DBG] No information found on request to perform content negotiation.
2025-11-13 09:46:41.842 +03:00 [DBG] Attempting to select the first output formatter in the output formatters list which supports a content type from the explicitly specified content types '["application/json","application/problem+json","application/problem+xml"]'.
2025-11-13 09:46:41.848 +03:00 [DBG] Selected output formatter 'Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonOutputFormatter' and content type 'application/json' to write the response.
2025-11-13 09:46:41.852 +03:00 [INF] Executing ObjectResult, writing value of type 'Microsoft.AspNetCore.Mvc.ProblemDetails'.
2025-11-13 09:46:41.884 +03:00 [INF] Executed action BillingSystem.API.Controllers.InvoicesController.Post (BillingSystem.API) in 114749.4372ms
2025-11-13 09:46:41.888 +03:00 [INF] Executed endpoint 'BillingSystem.API.Controllers.InvoicesController.Post (BillingSystem.API)'
2025-11-13 09:46:41.891 +03:00 [ERR] HTTP POST /api/Invoices responded 500 in 120576.0730 ms
2025-11-13 09:46:41.897 +03:00 [DBG] Connection id "0HNH2G0CELM4Q" completed keep alive response.
2025-11-13 09:46:41.902 +03:00 [DBG] 'BillingServiceDBContext' disposed.
2025-11-13 09:46:41.911 +03:00 [DBG] Disposing connection to database 'GAC-BillingService' on server '.'.
2025-11-13 09:46:41.915 +03:00 [DBG] Disposed connection to database '' on server '' (4ms).
2025-11-13 09:46:41.920 +03:00 [INF] Request finished HTTP/1.1 POST https://localhost:7257/api/Invoices - 500 null application/json; charset=utf-8 120643.0206ms
2025-11-13 09:46:42.534 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7257/swagger/index.html - null null
2025-11-13 09:46:42.550 +03:00 [DBG] No candidates found for the request path '/swagger/index.html'
2025-11-13 09:46:42.552 +03:00 [DBG] Request did not match any endpoints
2025-11-13 09:46:42.554 +03:00 [DBG] Response markup is scheduled to include Browser Link script injection.
2025-11-13 09:46:42.556 +03:00 [DBG] Response markup is scheduled to include browser refresh script injection.
2025-11-13 09:46:42.560 +03:00 [INF] HTTP GET /swagger/index.html responded 200 in 5.7176 ms
2025-11-13 09:46:42.579 +03:00 [DBG] Response markup was updated to include Browser Link script injection.
2025-11-13 09:46:42.583 +03:00 [DBG] Response markup was updated to include browser refresh script injection.
2025-11-13 09:46:42.591 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7257/swagger/index.html - 200 null text/html;charset=utf-8 56.498ms
2025-11-13 09:46:42.624 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7257/_vs/browserLink - null null
2025-11-13 09:46:42.640 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7257/_framework/aspnetcore-browser-refresh.js - null null
2025-11-13 09:46:42.672 +03:00 [DBG] Script injected: /_framework/aspnetcore-browser-refresh.js
2025-11-13 09:46:42.679 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7257/_framework/aspnetcore-browser-refresh.js - 200 16519 application/javascript; charset=utf-8 38.3981ms
2025-11-13 09:46:42.699 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7257/_vs/browserLink - 200 null text/javascript; charset=UTF-8 76.0526ms
2025-11-13 09:46:42.805 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7257/swagger/v1/swagger.json - null null
2025-11-13 09:46:42.813 +03:00 [DBG] No candidates found for the request path '/swagger/v1/swagger.json'
2025-11-13 09:46:42.816 +03:00 [DBG] Request did not match any endpoints
2025-11-13 09:46:42.826 +03:00 [INF] HTTP GET /swagger/v1/swagger.json responded 200 in 7.0808 ms
2025-11-13 09:46:42.830 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7257/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 24.741ms
2025-11-13 10:05:31.760 +03:00 [DBG] Connection id "0HNH2G0CELM4O" received FIN.
2025-11-13 10:05:31.769 +03:00 [DBG] Connection id "0HNH2G0CELM4O" is closed. The last processed stream ID was 15.
2025-11-13 10:05:31.769 +03:00 [DBG] The connection queue processing loop for 0HNH2G0CELM4O completed.
2025-11-13 10:05:31.773 +03:00 [DBG] Connection id "0HNH2G0CELM4O" sending FIN because: "The Socket transport's send loop completed gracefully."
2025-11-13 10:05:31.794 +03:00 [DBG] Connection id "0HNH2G0CELM4O" stopped.
2025-11-13 10:10:09.987 +03:00 [DBG] Registered model binder providers, in the following order: ["Microsoft.AspNetCore.Mvc.ModelBinding.Binders.BinderTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ServicesModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.BodyModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.HeaderModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FloatingPointTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.EnumTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.DateTimeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.SimpleTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.TryParseModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.CancellationTokenModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ByteArrayModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FormFileModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FormCollectionModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.KeyValuePairModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.DictionaryModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ArrayModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.CollectionModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ComplexObjectModelBinderProvider"]
2025-11-13 10:10:10.165 +03:00 [DBG] Hosting starting
2025-11-13 10:10:10.536 +03:00 [DBG] Starting bus instances: IBus
2025-11-13 10:10:10.545 +03:00 [DBG] Starting bus: "rabbitmq://localhost/"
2025-11-13 10:10:10.575 +03:00 [DBG] Middleware loaded
2025-11-13 10:10:10.580 +03:00 [DBG] Middleware loaded. Script /_framework/aspnetcore-browser-refresh.js (16519 B).
2025-11-13 10:10:10.585 +03:00 [DBG] Middleware loaded. Script /_framework/blazor-hotreload.js (799 B).
2025-11-13 10:10:10.602 +03:00 [DBG] Connect: guest@localhost:5672/
2025-11-13 10:10:10.818 +03:00 [DBG] Middleware loaded: DOTNET_MODIFIABLE_ASSEMBLIES=debug, __ASPNETCORE_BROWSER_TOOLS=true
2025-11-13 10:10:10.845 +03:00 [DBG] Connected: guest@localhost:5672/ (address: amqp://localhost:5672, local: 50166)
2025-11-13 10:10:10.907 +03:00 [DBG] Endpoint Ready: "rabbitmq://localhost/ECHGHANNAMLP1_BillingSystemAPI_bus_powyyyyh3bcsbqdcbdxnfy7q81?temporary=true"
2025-11-13 10:10:10.910 +03:00 [INF] Bus started: "rabbitmq://localhost/"
2025-11-13 10:10:11.086 +03:00 [INF] Now listening on: https://localhost:7257
2025-11-13 10:10:11.091 +03:00 [INF] Now listening on: http://localhost:5009
2025-11-13 10:10:11.094 +03:00 [DBG] Loaded hosting startup assembly BillingSystem.API
2025-11-13 10:10:11.096 +03:00 [DBG] Loaded hosting startup assembly Microsoft.WebTools.ApiEndpointDiscovery
2025-11-13 10:10:11.098 +03:00 [DBG] Loaded hosting startup assembly Microsoft.AspNetCore.Watch.BrowserRefresh
2025-11-13 10:10:11.102 +03:00 [DBG] Loaded hosting startup assembly Microsoft.WebTools.BrowserLink.Net
2025-11-13 10:10:11.192 +03:00 [DBG] Connection id "0HNH2GENMALBB" accepted.
2025-11-13 10:10:11.192 +03:00 [DBG] Connection id "0HNH2GENMALBA" accepted.
2025-11-13 10:10:11.203 +03:00 [DBG] Connection id "0HNH2GENMALBB" started.
2025-11-13 10:10:11.204 +03:00 [DBG] Connection id "0HNH2GENMALBA" received FIN.
2025-11-13 10:10:11.209 +03:00 [DBG] Connection id "0HNH2GENMALBA" started.
2025-11-13 10:10:11.204 +03:00 [DBG] Connection id "0HNH2GENMALBB" received FIN.
2025-11-13 10:10:11.250 +03:00 [DBG] Failed to authenticate HTTPS connection.
System.IO.IOException: Received an unexpected EOF or 0 bytes from the transport stream.
   at System.Net.Security.SslStream.ReceiveHandshakeFrameAsync[TIOAdapter](CancellationToken cancellationToken)
   at System.Net.Security.SslStream.ForceAuthenticationAsync[TIOAdapter](Boolean receiveFirst, Byte[] reAuthenticationData, CancellationToken cancellationToken)
   at System.Net.Security.SslStream.ProcessAuthenticationWithTelemetryAsync(Boolean isAsync, CancellationToken cancellationToken)
   at Microsoft.AspNetCore.Server.Kestrel.Https.Internal.HttpsConnectionMiddleware.OnConnectionAsync(ConnectionContext context)
2025-11-13 10:10:11.250 +03:00 [DBG] Failed to authenticate HTTPS connection.
System.IO.IOException: Received an unexpected EOF or 0 bytes from the transport stream.
   at System.Net.Security.SslStream.ReceiveHandshakeFrameAsync[TIOAdapter](CancellationToken cancellationToken)
   at System.Net.Security.SslStream.ForceAuthenticationAsync[TIOAdapter](Boolean receiveFirst, Byte[] reAuthenticationData, CancellationToken cancellationToken)
   at System.Net.Security.SslStream.ProcessAuthenticationWithTelemetryAsync(Boolean isAsync, CancellationToken cancellationToken)
   at Microsoft.AspNetCore.Server.Kestrel.Https.Internal.HttpsConnectionMiddleware.OnConnectionAsync(ConnectionContext context)
2025-11-13 10:10:11.283 +03:00 [DBG] Connection id "0HNH2GENMALBB" stopped.
2025-11-13 10:10:11.286 +03:00 [DBG] Connection id "0HNH2GENMALBA" stopped.
2025-11-13 10:10:11.298 +03:00 [DBG] Connection id "0HNH2GENMALBA" sending FIN because: "The Socket transport's send loop completed gracefully."
2025-11-13 10:10:11.298 +03:00 [DBG] Connection id "0HNH2GENMALBB" sending FIN because: "The Socket transport's send loop completed gracefully."
2025-11-13 10:10:11.333 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-11-13 10:10:11.336 +03:00 [INF] Hosting environment: Development
2025-11-13 10:10:11.340 +03:00 [INF] Content root path: C:\Repositories\Gac-BillingSystem\src\BillingSystem.API
2025-11-13 10:10:11.343 +03:00 [DBG] Hosting started
2025-11-13 10:10:12.044 +03:00 [DBG] Connection id "0HNH2GENMALBC" accepted.
2025-11-13 10:10:12.049 +03:00 [DBG] Connection id "0HNH2GENMALBC" started.
2025-11-13 10:10:12.127 +03:00 [DBG] Connection 0HNH2GENMALBC established using the following protocol: "Tls13"
2025-11-13 10:10:12.203 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7257/swagger/index.html - null null
2025-11-13 10:10:12.264 +03:00 [DBG] Wildcard detected, all requests with hosts will be allowed.
2025-11-13 10:10:12.292 +03:00 [DBG] No candidates found for the request path '/swagger/index.html'
2025-11-13 10:10:12.298 +03:00 [DBG] Request did not match any endpoints
2025-11-13 10:10:12.383 +03:00 [DBG] Response markup is scheduled to include Browser Link script injection.
2025-11-13 10:10:12.391 +03:00 [DBG] Response markup is scheduled to include browser refresh script injection.
2025-11-13 10:10:12.422 +03:00 [INF] HTTP GET /swagger/index.html responded 200 in 115.9355 ms
2025-11-13 10:10:12.432 +03:00 [DBG] Response markup was updated to include Browser Link script injection.
2025-11-13 10:10:12.436 +03:00 [DBG] Response markup was updated to include browser refresh script injection.
2025-11-13 10:10:12.443 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7257/swagger/index.html - 200 null text/html;charset=utf-8 251.3466ms
2025-11-13 10:10:12.478 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7257/_framework/aspnetcore-browser-refresh.js - null null
2025-11-13 10:10:12.490 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7257/_vs/browserLink - null null
2025-11-13 10:10:12.491 +03:00 [DBG] Script injected: /_framework/aspnetcore-browser-refresh.js
2025-11-13 10:10:12.501 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7257/_framework/aspnetcore-browser-refresh.js - 200 16519 application/javascript; charset=utf-8 22.7821ms
2025-11-13 10:10:12.554 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7257/_vs/browserLink - 200 null text/javascript; charset=UTF-8 64.1842ms
2025-11-13 10:10:12.613 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7257/swagger/v1/swagger.json - null null
2025-11-13 10:10:12.620 +03:00 [DBG] No candidates found for the request path '/swagger/v1/swagger.json'
2025-11-13 10:10:12.622 +03:00 [DBG] Request did not match any endpoints
2025-11-13 10:10:12.644 +03:00 [INF] HTTP GET /swagger/v1/swagger.json responded 200 in 18.8453 ms
2025-11-13 10:10:12.652 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7257/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 39.4155ms
2025-11-13 10:10:39.736 +03:00 [DBG] Connection id "0HNH2GENMALBD" accepted.
2025-11-13 10:10:39.737 +03:00 [DBG] Connection id "0HNH2GENMALBD" received FIN.
2025-11-13 10:10:39.750 +03:00 [DBG] Connection id "0HNH2GENMALBD" started.
2025-11-13 10:10:39.757 +03:00 [DBG] Connection id "0HNH2GENMALBE" accepted.
2025-11-13 10:10:39.770 +03:00 [DBG] Failed to authenticate HTTPS connection.
System.IO.IOException: Received an unexpected EOF or 0 bytes from the transport stream.
   at System.Net.Security.SslStream.ReceiveHandshakeFrameAsync[TIOAdapter](CancellationToken cancellationToken)
   at System.Net.Security.SslStream.ForceAuthenticationAsync[TIOAdapter](Boolean receiveFirst, Byte[] reAuthenticationData, CancellationToken cancellationToken)
   at System.Net.Security.SslStream.ProcessAuthenticationWithTelemetryAsync(Boolean isAsync, CancellationToken cancellationToken)
   at Microsoft.AspNetCore.Server.Kestrel.Https.Internal.HttpsConnectionMiddleware.OnConnectionAsync(ConnectionContext context)
2025-11-13 10:10:39.772 +03:00 [DBG] Connection id "0HNH2GENMALBE" started.
2025-11-13 10:10:39.778 +03:00 [DBG] Connection id "0HNH2GENMALBD" stopped.
2025-11-13 10:10:39.782 +03:00 [DBG] Connection id "0HNH2GENMALBD" sending FIN because: "The Socket transport's send loop completed gracefully."
2025-11-13 10:10:39.785 +03:00 [DBG] Connection 0HNH2GENMALBE established using the following protocol: "Tls13"
2025-11-13 10:10:39.794 +03:00 [INF] Request starting HTTP/1.1 POST https://localhost:7257/api/Invoices - application/json 1317
2025-11-13 10:10:39.802 +03:00 [DBG] 1 candidate(s) found for the request path '/api/Invoices'
2025-11-13 10:10:39.810 +03:00 [DBG] Endpoint 'BillingSystem.API.Controllers.InvoicesController.Post (BillingSystem.API)' with route pattern 'api/Invoices' is valid for the request path '/api/Invoices'
2025-11-13 10:10:39.815 +03:00 [DBG] Request matched endpoint 'BillingSystem.API.Controllers.InvoicesController.Post (BillingSystem.API)'
2025-11-13 10:10:39.822 +03:00 [DBG] Static files was skipped as the request already matched an endpoint.
2025-11-13 10:10:40.008 +03:00 [DBG] An 'IServiceProvider' was created for internal use by Entity Framework.
2025-11-13 10:10:45.461 +03:00 [INF] Executing endpoint 'BillingSystem.API.Controllers.InvoicesController.Post (BillingSystem.API)'
2025-11-13 10:10:45.511 +03:00 [INF] Route matched with {action = "Post", controller = "Invoices"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Post(BillingSystem.Application.Requests.CreateInvoiceRequest) on controller BillingSystem.API.Controllers.InvoicesController (BillingSystem.API).
2025-11-13 10:10:45.525 +03:00 [DBG] Execution plan of authorization filters (in the following order): ["None"]
2025-11-13 10:10:45.532 +03:00 [DBG] Execution plan of resource filters (in the following order): ["None"]
2025-11-13 10:10:45.537 +03:00 [DBG] Execution plan of action filters (in the following order): ["Microsoft.AspNetCore.Mvc.ModelBinding.UnsupportedContentTypeFilter (Order: -3000)","Microsoft.AspNetCore.Mvc.Infrastructure.ModelStateInvalidFilter (Order: -2000)","BillingSystem.API.ActionFilters.AuditBillingRequestsFilter","BillingSystem.API.ActionFilters.IdempotencyFilter (Order: 0)"]
2025-11-13 10:10:45.547 +03:00 [DBG] Execution plan of exception filters (in the following order): ["None"]
2025-11-13 10:10:45.552 +03:00 [DBG] Execution plan of result filters (in the following order): ["Microsoft.AspNetCore.Mvc.Infrastructure.ClientErrorResultFilter (Order: -2000)","Microsoft.AspNetCore.Mvc.ProducesAttribute (Order: 0)","BillingSystem.API.ActionFilters.IdempotencyFilter (Order: 0)"]
2025-11-13 10:10:45.562 +03:00 [DBG] Executing controller factory for controller BillingSystem.API.Controllers.InvoicesController (BillingSystem.API)
2025-11-13 10:10:45.573 +03:00 [WRN] You do not have a valid license key for the Lucky Penny software MediatR. This is allowed for development and testing scenarios. If you are running in production you are required to have a licensed version. Please visit https://luckypennysoftware.com to obtain a valid license.
2025-11-13 10:10:45.654 +03:00 [DBG] Executed controller factory for controller BillingSystem.API.Controllers.InvoicesController (BillingSystem.API)
2025-11-13 10:10:45.677 +03:00 [DBG] Attempting to bind parameter 'invoiceRequest' of type 'BillingSystem.Application.Requests.CreateInvoiceRequest' ...
2025-11-13 10:10:45.684 +03:00 [DBG] Attempting to bind parameter 'invoiceRequest' of type 'BillingSystem.Application.Requests.CreateInvoiceRequest' using the name '' in request data ...
2025-11-13 10:10:45.691 +03:00 [DBG] Selected input formatter 'Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonInputFormatter' for content type 'application/json'.
2025-11-13 10:10:45.766 +03:00 [DBG] Connection id "0HNH2GENMALBE", Request id "0HNH2GENMALBE:00000001": started reading request body.
2025-11-13 10:10:45.772 +03:00 [DBG] Connection id "0HNH2GENMALBE", Request id "0HNH2GENMALBE:00000001": done reading request body.
2025-11-13 10:10:45.810 +03:00 [DBG] JSON input formatter succeeded, deserializing to type 'BillingSystem.Application.Requests.CreateInvoiceRequest'
2025-11-13 10:10:45.817 +03:00 [DBG] Done attempting to bind parameter 'invoiceRequest' of type 'BillingSystem.Application.Requests.CreateInvoiceRequest'.
2025-11-13 10:10:45.820 +03:00 [DBG] Done attempting to bind parameter 'invoiceRequest' of type 'BillingSystem.Application.Requests.CreateInvoiceRequest'.
2025-11-13 10:10:45.825 +03:00 [DBG] Attempting to validate the bound parameter 'invoiceRequest' of type 'BillingSystem.Application.Requests.CreateInvoiceRequest' ...
2025-11-13 10:10:45.861 +03:00 [DBG] Done attempting to validate the bound parameter 'invoiceRequest' of type 'BillingSystem.Application.Requests.CreateInvoiceRequest'.
2025-11-13 10:10:46.167 +03:00 [DBG] No relationship from 'Invoice' to 'Invoice' has been configured by convention because there are multiple properties on one entity type - {'DiscountedPrimaryInvoice'} that could be matched with the properties on the other entity type - {'InverseDiscountedPrimaryInvoice', 'InversePrimaryInvoice', 'InverseSubstitutionPrimaryInvoice', 'PrimaryInvoice', 'SubstitutionPrimaryInvoice'}. This message can be disregarded if explicit configuration has been specified in 'OnModelCreating'.
2025-11-13 10:10:46.471 +03:00 [DBG] No relationship from 'Invoice' to 'Invoice' has been configured by convention because there are multiple properties on one entity type - {'DiscountedPrimaryInvoice'} that could be matched with the properties on the other entity type - {'InverseDiscountedPrimaryInvoice', 'InversePrimaryInvoice', 'InverseSubstitutionPrimaryInvoice', 'PrimaryInvoice', 'SubstitutionPrimaryInvoice'}. This message can be disregarded if explicit configuration has been specified in 'OnModelCreating'.
2025-11-13 10:10:46.492 +03:00 [DBG] No relationship from 'Invoice' to 'Invoice' has been configured by convention because there are multiple properties on one entity type - {'InversePrimaryInvoice'} that could be matched with the properties on the other entity type - {'InverseSubstitutionPrimaryInvoice', 'PrimaryInvoice', 'SubstitutionPrimaryInvoice'}. This message can be disregarded if explicit configuration has been specified in 'OnModelCreating'.
2025-11-13 10:10:46.504 +03:00 [DBG] No relationship from 'Invoice' to 'Invoice' has been configured by convention because there are multiple properties on one entity type - {'InversePrimaryInvoice'} that could be matched with the properties on the other entity type - {'InverseSubstitutionPrimaryInvoice', 'PrimaryInvoice', 'SubstitutionPrimaryInvoice'}. This message can be disregarded if explicit configuration has been specified in 'OnModelCreating'.
2025-11-13 10:10:46.849 +03:00 [DBG] Entity Framework Core 9.0.9 initialized 'BillingServiceDBContext' using provider 'Microsoft.EntityFrameworkCore.SqlServer:9.0.9' with options: EngineType=SqlServer 
2025-11-13 10:10:46.992 +03:00 [DBG] Compiling query expression: 
'DbSet<Invoice>()
    .AsNoTracking()
    .Any(inv => inv.ExternalId.ToString() == __idempotentKey_0)'
2025-11-13 10:10:47.285 +03:00 [DBG] Generated query execution expression: 
'queryContext => ShapedQueryCompilingExpressionVisitor.SingleAsync<bool>(
    asyncEnumerable: SingleQueryingEnumerable.Create<bool>(
        relationalQueryContext: (RelationalQueryContext)queryContext, 
        relationalCommandResolver: parameters => [LIFTABLE Constant: RelationalCommandCache.QueryExpression(
            Projection Mapping:
                EmptyProjectionMember -> 0
            SELECT EXISTS (
                SELECT 1
                FROM Invoices AS i
                WHERE COALESCE(CONVERT(varchar(36), i.ExternalId), '') == @__idempotentKey_0)) | Resolver: c => new RelationalCommandCache(
            c.Dependencies.MemoryCache, 
            c.RelationalDependencies.QuerySqlGeneratorFactory, 
            c.RelationalDependencies.RelationalParameterBasedSqlProcessorFactory, 
            Projection Mapping:
                EmptyProjectionMember -> 0
            SELECT EXISTS (
                SELECT 1
                FROM Invoices AS i
                WHERE COALESCE(CONVERT(varchar(36), i.ExternalId), '') == @__idempotentKey_0), 
            False, 
            new HashSet<string>(
                new string[]{ }, 
                StringComparer.Ordinal
            )
        )].GetRelationalCommandTemplate(parameters), 
        readerColumns: null, 
        shaper: (queryContext, dataReader, resultContext, resultCoordinator) => 
        {
            bool? value1;
            value1 = dataReader.IsDBNull(0) ? default(bool?) : (bool?)dataReader.GetBoolean(0);
            return (bool)value1;
        }, 
        contextType: BillingSystem.Infrastructure.EF.BillingServiceDBContext, 
        standAloneStateManager: False, 
        detailedErrorsEnabled: False, 
        threadSafetyChecksEnabled: True), 
    cancellationToken: queryContext.CancellationToken)'
2025-11-13 10:10:47.358 +03:00 [DBG] Creating DbConnection.
2025-11-13 10:10:47.386 +03:00 [DBG] Created DbConnection. (26ms).
2025-11-13 10:10:47.393 +03:00 [DBG] Opening connection to database 'GAC-BillingService' on server '.'.
2025-11-13 10:10:47.723 +03:00 [DBG] Opened connection to database 'GAC-BillingService' on server '.'.
2025-11-13 10:10:47.736 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-11-13 10:10:47.749 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (9ms).
2025-11-13 10:10:47.763 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (27ms).
2025-11-13 10:10:47.777 +03:00 [DBG] Executing DbCommand [Parameters=[@__idempotentKey_0='?' (Size = 36) (DbType = AnsiString)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [Invoices] AS [i]
        WHERE CONVERT(varchar(36), [i].[ExternalId]) = @__idempotentKey_0) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2025-11-13 10:10:47.849 +03:00 [INF] Executed DbCommand (75ms) [Parameters=[@__idempotentKey_0='?' (Size = 36) (DbType = AnsiString)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [Invoices] AS [i]
        WHERE CONVERT(varchar(36), [i].[ExternalId]) = @__idempotentKey_0) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2025-11-13 10:10:47.875 +03:00 [DBG] Closing data reader to 'GAC-BillingService' on server '.'.
2025-11-13 10:10:47.888 +03:00 [DBG] A data reader for 'GAC-BillingService' on server '.' is being disposed after spending 27ms reading results.
2025-11-13 10:10:47.895 +03:00 [DBG] Closing connection to database 'GAC-BillingService' on server '.'.
2025-11-13 10:10:47.906 +03:00 [DBG] Closed connection to database 'GAC-BillingService' on server '.' (11ms).
2025-11-13 10:10:48.130 +03:00 [WRN] You do not have a valid license key for the Lucky Penny software AutoMapper. This is allowed for development and testing scenarios. If you are running in production you are required to have a licensed version. Please visit https://luckypennysoftware.com to obtain a valid license.
2025-11-13 10:10:48.222 +03:00 [DBG] Opening connection to database 'GAC-BillingService' on server '.'.
2025-11-13 10:10:48.235 +03:00 [DBG] Opened connection to database 'GAC-BillingService' on server '.'.
2025-11-13 10:10:48.243 +03:00 [DBG] Beginning transaction with isolation level 'Unspecified'.
2025-11-13 10:10:48.264 +03:00 [DBG] Began transaction with isolation level 'ReadCommitted'.
2025-11-13 10:10:48.326 +03:00 [DBG] 'BillingServiceDBContext' generated a temporary value for the property 'Invoice.Id'. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-11-13 10:10:48.484 +03:00 [DBG] Context 'BillingServiceDBContext' started tracking 'Invoice' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-11-13 10:10:48.492 +03:00 [DBG] 'BillingServiceDBContext' generated a temporary value for the property 'Customer.Id'. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-11-13 10:10:48.551 +03:00 [DBG] The foreign key property 'Invoice.CustomerId' was detected as changed. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see property values.
2025-11-13 10:10:48.571 +03:00 [DBG] Context 'BillingServiceDBContext' started tracking 'Customer' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-11-13 10:10:48.578 +03:00 [DBG] SaveChanges starting for 'BillingServiceDBContext'.
2025-11-13 10:10:48.587 +03:00 [DBG] DetectChanges starting for 'BillingServiceDBContext'.
2025-11-13 10:10:48.657 +03:00 [DBG] DetectChanges completed for 'BillingServiceDBContext'.
2025-11-13 10:10:48.768 +03:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-11-13 10:10:48.776 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-11-13 10:10:48.779 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (3ms).
2025-11-13 10:10:48.787 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (10ms).
2025-11-13 10:10:48.794 +03:00 [DBG] Executing DbCommand [Parameters=[@p0='?' (Size = 200), @p1='?' (Size = 200), @p2='?' (Size = 200), @p3='?' (Size = 200), @p4='?' (Size = 50), @p5='?' (Size = 200), @p6='?' (Size = 200), @p7='?' (Size = 50), @p8='?' (DbType = DateTime), @p9='?' (Size = 100), @p10='?' (Size = 80), @p11='?' (Size = 500), @p12='?' (Size = 100), @p13='?' (DbType = Int32), @p14='?' (DbType = Boolean), @p15='?' (DbType = DateTime), @p16='?' (Precision = 18) (DbType = Decimal), @p17='?' (Size = 50), @p18='?' (Size = 100)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [Customers] ([Address_BuildingNumber], [Address_City], [Address_Country], [Address_District], [Address_PostalCode], [Address_Street], [Address_SubNumber], [CreatedBy], [CreatedDate], [CustomerType], [EmailAddress], [FullName], [IdentityNumber], [IdentityType], [IsDeleted], [LastUpdatedDate], [OverpaymentBalance], [PhoneNumber], [VATNumber])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18);
2025-11-13 10:10:48.822 +03:00 [INF] Executed DbCommand (32ms) [Parameters=[@p0='?' (Size = 200), @p1='?' (Size = 200), @p2='?' (Size = 200), @p3='?' (Size = 200), @p4='?' (Size = 50), @p5='?' (Size = 200), @p6='?' (Size = 200), @p7='?' (Size = 50), @p8='?' (DbType = DateTime), @p9='?' (Size = 100), @p10='?' (Size = 80), @p11='?' (Size = 500), @p12='?' (Size = 100), @p13='?' (DbType = Int32), @p14='?' (DbType = Boolean), @p15='?' (DbType = DateTime), @p16='?' (Precision = 18) (DbType = Decimal), @p17='?' (Size = 50), @p18='?' (Size = 100)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [Customers] ([Address_BuildingNumber], [Address_City], [Address_Country], [Address_District], [Address_PostalCode], [Address_Street], [Address_SubNumber], [CreatedBy], [CreatedDate], [CustomerType], [EmailAddress], [FullName], [IdentityNumber], [IdentityType], [IsDeleted], [LastUpdatedDate], [OverpaymentBalance], [PhoneNumber], [VATNumber])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18);
2025-11-13 10:10:48.849 +03:00 [DBG] The foreign key property 'Customer.Id' was detected as changed. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see property values.
2025-11-13 10:10:48.860 +03:00 [DBG] The foreign key property 'Invoice.CustomerId' was detected as changed. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see property values.
2025-11-13 10:10:48.871 +03:00 [DBG] Closing data reader to 'GAC-BillingService' on server '.'.
2025-11-13 10:10:48.876 +03:00 [DBG] A data reader for 'GAC-BillingService' on server '.' is being disposed after spending 45ms reading results.
2025-11-13 10:10:48.882 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-11-13 10:10:48.885 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (3ms).
2025-11-13 10:10:48.891 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (8ms).
2025-11-13 10:10:48.898 +03:00 [DBG] Executing DbCommand [Parameters=[@p19='?' (Precision = 18) (DbType = Decimal), @p20='?' (Size = 3000), @p21='?' (Size = 100), @p22='?' (Size = 50), @p23='?' (DbType = DateTime), @p24='?' (Size = 50), @p25='?' (DbType = Int64), @p26='?' (DbType = Int64), @p27='?' (DbType = DateTime), @p28='?' (DbType = Guid), @p29='?' (Size = 50), @p30='?' (DbType = Int32), @p31='?' (DbType = Int32), @p32='?' (DbType = Boolean), @p33='?' (DbType = Boolean), @p34='?' (DbType = Boolean), @p35='?' (DbType = Boolean), @p36='?' (DbType = DateTime), @p37='?' (DbType = DateTime), @p38='?' (Size = 4000), @p39='?' (Size = 100), @p40='?' (Size = 100), @p41='?' (DbType = Int64), @p42='?' (DbType = Int64), @p43='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [Invoices] ([Amount], [CancelationReasons], [ClientReferenceNumber], [CreatedBy], [CreatedDate], [Currency], [CustomerID], [DiscountedPrimaryInvoiceID], [DueAt], [ExternalId], [InvoiceNumber], [InvoiceStatus], [InvoiceType], [IsDeleted], [IsDiscounted], [IsSubInvoice], [IsSubstitution], [IssuedAt], [LastUpdatedDate], [Metadata], [PaymentProvider], [PaymentReference], [PrimaryInvoiceID], [SubstitutionPrimaryInvoiceID], [TenantId])
OUTPUT INSERTED.[Id]
VALUES (@p19, @p20, @p21, @p22, @p23, @p24, @p25, @p26, @p27, @p28, @p29, @p30, @p31, @p32, @p33, @p34, @p35, @p36, @p37, @p38, @p39, @p40, @p41, @p42, @p43);
2025-11-13 10:10:48.930 +03:00 [INF] Executed DbCommand (34ms) [Parameters=[@p19='?' (Precision = 18) (DbType = Decimal), @p20='?' (Size = 3000), @p21='?' (Size = 100), @p22='?' (Size = 50), @p23='?' (DbType = DateTime), @p24='?' (Size = 50), @p25='?' (DbType = Int64), @p26='?' (DbType = Int64), @p27='?' (DbType = DateTime), @p28='?' (DbType = Guid), @p29='?' (Size = 50), @p30='?' (DbType = Int32), @p31='?' (DbType = Int32), @p32='?' (DbType = Boolean), @p33='?' (DbType = Boolean), @p34='?' (DbType = Boolean), @p35='?' (DbType = Boolean), @p36='?' (DbType = DateTime), @p37='?' (DbType = DateTime), @p38='?' (Size = 4000), @p39='?' (Size = 100), @p40='?' (Size = 100), @p41='?' (DbType = Int64), @p42='?' (DbType = Int64), @p43='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [Invoices] ([Amount], [CancelationReasons], [ClientReferenceNumber], [CreatedBy], [CreatedDate], [Currency], [CustomerID], [DiscountedPrimaryInvoiceID], [DueAt], [ExternalId], [InvoiceNumber], [InvoiceStatus], [InvoiceType], [IsDeleted], [IsDiscounted], [IsSubInvoice], [IsSubstitution], [IssuedAt], [LastUpdatedDate], [Metadata], [PaymentProvider], [PaymentReference], [PrimaryInvoiceID], [SubstitutionPrimaryInvoiceID], [TenantId])
OUTPUT INSERTED.[Id]
VALUES (@p19, @p20, @p21, @p22, @p23, @p24, @p25, @p26, @p27, @p28, @p29, @p30, @p31, @p32, @p33, @p34, @p35, @p36, @p37, @p38, @p39, @p40, @p41, @p42, @p43);
2025-11-13 10:10:48.942 +03:00 [DBG] The foreign key property 'Invoice.Id' was detected as changed. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see property values.
2025-11-13 10:10:48.947 +03:00 [DBG] Closing data reader to 'GAC-BillingService' on server '.'.
2025-11-13 10:10:48.951 +03:00 [DBG] A data reader for 'GAC-BillingService' on server '.' is being disposed after spending 10ms reading results.
2025-11-13 10:10:48.968 +03:00 [DBG] An entity of type 'Invoice' tracked by 'BillingServiceDBContext' changed state from '"Added"' to '"Unchanged"'. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-11-13 10:10:48.975 +03:00 [DBG] An entity of type 'Customer' tracked by 'BillingServiceDBContext' changed state from '"Added"' to '"Unchanged"'. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-11-13 10:10:48.984 +03:00 [DBG] SaveChanges completed for 'BillingServiceDBContext' with 2 entities written to the database.
2025-11-13 10:10:48.989 +03:00 [DBG] 'BillingServiceDBContext' generated a temporary value for the property 'OutboxEvent.Id'. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-11-13 10:10:49.024 +03:00 [DBG] Context 'BillingServiceDBContext' started tracking 'OutboxEvent' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-11-13 10:10:49.032 +03:00 [DBG] SaveChanges starting for 'BillingServiceDBContext'.
2025-11-13 10:10:49.039 +03:00 [DBG] DetectChanges starting for 'BillingServiceDBContext'.
2025-11-13 10:10:49.055 +03:00 [DBG] DetectChanges completed for 'BillingServiceDBContext'.
2025-11-13 10:10:49.060 +03:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-11-13 10:10:49.063 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-11-13 10:10:49.070 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (6ms).
2025-11-13 10:10:49.076 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (13ms).
2025-11-13 10:10:49.080 +03:00 [DBG] Executing DbCommand [Parameters=[@p0='?' (DbType = Int64), @p1='?' (DbType = DateTime), @p2='?' (Size = 4000), @p3='?' (Size = 300), @p4='?' (Size = 4000), @p5='?' (DbType = Boolean), @p6='?' (Size = 20) (DbType = AnsiString)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [Outbox_events] ([Aggregate_id], [CreatedDate], [ErrorMsg], [Event_type], [Payload], [Processed], [ProcessingStatus])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6);
2025-11-13 10:10:49.090 +03:00 [INF] Executed DbCommand (10ms) [Parameters=[@p0='?' (DbType = Int64), @p1='?' (DbType = DateTime), @p2='?' (Size = 4000), @p3='?' (Size = 300), @p4='?' (Size = 4000), @p5='?' (DbType = Boolean), @p6='?' (Size = 20) (DbType = AnsiString)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [Outbox_events] ([Aggregate_id], [CreatedDate], [ErrorMsg], [Event_type], [Payload], [Processed], [ProcessingStatus])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6);
2025-11-13 10:10:49.096 +03:00 [DBG] The foreign key property 'OutboxEvent.Id' was detected as changed. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see property values.
2025-11-13 10:10:49.101 +03:00 [DBG] Closing data reader to 'GAC-BillingService' on server '.'.
2025-11-13 10:10:49.104 +03:00 [DBG] A data reader for 'GAC-BillingService' on server '.' is being disposed after spending 9ms reading results.
2025-11-13 10:10:49.109 +03:00 [DBG] An entity of type 'OutboxEvent' tracked by 'BillingServiceDBContext' changed state from '"Added"' to '"Unchanged"'. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-11-13 10:10:49.114 +03:00 [DBG] SaveChanges completed for 'BillingServiceDBContext' with 1 entities written to the database.
2025-11-13 10:10:49.119 +03:00 [DBG] Committing transaction.
2025-11-13 10:10:49.137 +03:00 [DBG] Committed transaction.
2025-11-13 10:10:49.144 +03:00 [DBG] Closing connection to database 'GAC-BillingService' on server '.'.
2025-11-13 10:10:49.147 +03:00 [DBG] Closed connection to database 'GAC-BillingService' on server '.' (2ms).
2025-11-13 10:10:49.152 +03:00 [DBG] Disposing transaction.
2025-11-13 10:10:49.178 +03:00 [DBG] List of registered output formatters, in the following order: ["Microsoft.AspNetCore.Mvc.Formatters.HttpNoContentOutputFormatter","Microsoft.AspNetCore.Mvc.Formatters.StringOutputFormatter","Microsoft.AspNetCore.Mvc.Formatters.StreamOutputFormatter","Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonOutputFormatter"]
2025-11-13 10:10:49.188 +03:00 [DBG] No information found on request to perform content negotiation.
2025-11-13 10:10:49.192 +03:00 [DBG] Attempting to select the first output formatter in the output formatters list which supports a content type from the explicitly specified content types '["application/json"]'.
2025-11-13 10:10:49.198 +03:00 [DBG] Selected output formatter 'Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonOutputFormatter' and content type 'application/json' to write the response.
2025-11-13 10:10:49.203 +03:00 [INF] Executing OkObjectResult, writing value of type 'BillingSystem.SharedKernel.ApiResponse`1[[System.Int64, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-11-13 10:10:49.221 +03:00 [INF] Executed action BillingSystem.API.Controllers.InvoicesController.Post (BillingSystem.API) in 3658.2772ms
2025-11-13 10:10:49.226 +03:00 [INF] Executed endpoint 'BillingSystem.API.Controllers.InvoicesController.Post (BillingSystem.API)'
2025-11-13 10:10:49.230 +03:00 [INF] HTTP POST /api/Invoices responded 200 in 9409.8188 ms
2025-11-13 10:10:49.234 +03:00 [DBG] Connection id "0HNH2GENMALBE" completed keep alive response.
2025-11-13 10:10:49.239 +03:00 [DBG] 'BillingServiceDBContext' disposed.
2025-11-13 10:10:49.247 +03:00 [DBG] Disposing connection to database 'GAC-BillingService' on server '.'.
2025-11-13 10:10:49.254 +03:00 [DBG] Disposed connection to database '' on server '' (6ms).
2025-11-13 10:10:49.259 +03:00 [INF] Request finished HTTP/1.1 POST https://localhost:7257/api/Invoices - 200 null application/json; charset=utf-8 9465.476ms
2025-11-13 10:26:48.801 +03:00 [DBG] Registered model binder providers, in the following order: ["Microsoft.AspNetCore.Mvc.ModelBinding.Binders.BinderTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ServicesModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.BodyModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.HeaderModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FloatingPointTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.EnumTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.DateTimeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.SimpleTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.TryParseModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.CancellationTokenModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ByteArrayModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FormFileModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FormCollectionModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.KeyValuePairModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.DictionaryModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ArrayModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.CollectionModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ComplexObjectModelBinderProvider"]
2025-11-13 10:26:49.065 +03:00 [DBG] Hosting starting
2025-11-13 10:26:49.531 +03:00 [DBG] Starting bus instances: IBus
2025-11-13 10:26:49.542 +03:00 [DBG] Starting bus: "rabbitmq://localhost/"
2025-11-13 10:26:49.580 +03:00 [DBG] Middleware loaded
2025-11-13 10:26:49.586 +03:00 [DBG] Middleware loaded. Script /_framework/aspnetcore-browser-refresh.js (16519 B).
2025-11-13 10:26:49.592 +03:00 [DBG] Middleware loaded. Script /_framework/blazor-hotreload.js (799 B).
2025-11-13 10:26:49.612 +03:00 [DBG] Connect: guest@localhost:5672/
2025-11-13 10:26:49.796 +03:00 [DBG] Middleware loaded: DOTNET_MODIFIABLE_ASSEMBLIES=debug, __ASPNETCORE_BROWSER_TOOLS=true
2025-11-13 10:26:49.846 +03:00 [DBG] Connected: guest@localhost:5672/ (address: amqp://localhost:5672, local: 65169)
2025-11-13 10:26:49.927 +03:00 [DBG] Endpoint Ready: "rabbitmq://localhost/ECHGHANNAMLP1_BillingSystemAPI_bus_3y8oyyyh3bcsbomnbdxnfbondb?temporary=true"
2025-11-13 10:26:49.932 +03:00 [INF] Bus started: "rabbitmq://localhost/"
2025-11-13 10:26:50.150 +03:00 [INF] Now listening on: https://localhost:7257
2025-11-13 10:26:50.156 +03:00 [INF] Now listening on: http://localhost:5009
2025-11-13 10:26:50.160 +03:00 [DBG] Loaded hosting startup assembly BillingSystem.API
2025-11-13 10:26:50.165 +03:00 [DBG] Loaded hosting startup assembly Microsoft.WebTools.ApiEndpointDiscovery
2025-11-13 10:26:50.168 +03:00 [DBG] Loaded hosting startup assembly Microsoft.AspNetCore.Watch.BrowserRefresh
2025-11-13 10:26:50.171 +03:00 [DBG] Loaded hosting startup assembly Microsoft.WebTools.BrowserLink.Net
2025-11-13 10:26:50.184 +03:00 [DBG] Connection id "0HNH2GO1DERAH" accepted.
2025-11-13 10:26:50.186 +03:00 [DBG] Connection id "0HNH2GO1DERAH" received FIN.
2025-11-13 10:26:50.189 +03:00 [DBG] Connection id "0HNH2GO1DERAH" started.
2025-11-13 10:26:50.216 +03:00 [DBG] Failed to authenticate HTTPS connection.
System.IO.IOException: Received an unexpected EOF or 0 bytes from the transport stream.
   at System.Net.Security.SslStream.ReceiveHandshakeFrameAsync[TIOAdapter](CancellationToken cancellationToken)
   at System.Net.Security.SslStream.ForceAuthenticationAsync[TIOAdapter](Boolean receiveFirst, Byte[] reAuthenticationData, CancellationToken cancellationToken)
   at System.Net.Security.SslStream.ProcessAuthenticationWithTelemetryAsync(Boolean isAsync, CancellationToken cancellationToken)
   at Microsoft.AspNetCore.Server.Kestrel.Https.Internal.HttpsConnectionMiddleware.OnConnectionAsync(ConnectionContext context)
2025-11-13 10:26:50.251 +03:00 [DBG] Connection id "0HNH2GO1DERAH" stopped.
2025-11-13 10:26:50.266 +03:00 [DBG] Connection id "0HNH2GO1DERAH" sending FIN because: "The Socket transport's send loop completed gracefully."
2025-11-13 10:26:50.367 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-11-13 10:26:50.372 +03:00 [INF] Hosting environment: Development
2025-11-13 10:26:50.376 +03:00 [INF] Content root path: C:\Repositories\Gac-BillingSystem\src\BillingSystem.API
2025-11-13 10:26:50.379 +03:00 [DBG] Hosting started
2025-11-13 10:26:51.087 +03:00 [DBG] Connection id "0HNH2GO1DERAI" accepted.
2025-11-13 10:26:51.093 +03:00 [DBG] Connection id "0HNH2GO1DERAI" started.
2025-11-13 10:26:51.334 +03:00 [DBG] Connection 0HNH2GO1DERAI established using the following protocol: "Tls13"
2025-11-13 10:26:51.449 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7257/swagger/index.html - null null
2025-11-13 10:26:51.529 +03:00 [DBG] Wildcard detected, all requests with hosts will be allowed.
2025-11-13 10:26:51.566 +03:00 [DBG] No candidates found for the request path '/swagger/index.html'
2025-11-13 10:26:51.571 +03:00 [DBG] Request did not match any endpoints
2025-11-13 10:26:51.685 +03:00 [DBG] Response markup is scheduled to include Browser Link script injection.
2025-11-13 10:26:51.692 +03:00 [DBG] Response markup is scheduled to include browser refresh script injection.
2025-11-13 10:26:51.741 +03:00 [INF] HTTP GET /swagger/index.html responded 200 in 153.9468 ms
2025-11-13 10:26:51.750 +03:00 [DBG] Response markup was updated to include Browser Link script injection.
2025-11-13 10:26:51.754 +03:00 [DBG] Response markup was updated to include browser refresh script injection.
2025-11-13 10:26:51.763 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7257/swagger/index.html - 200 null text/html;charset=utf-8 330.6102ms
2025-11-13 10:26:51.850 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7257/_framework/aspnetcore-browser-refresh.js - null null
2025-11-13 10:26:51.872 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7257/_vs/browserLink - null null
2025-11-13 10:26:51.912 +03:00 [DBG] Script injected: /_framework/aspnetcore-browser-refresh.js
2025-11-13 10:26:51.920 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7257/_framework/aspnetcore-browser-refresh.js - 200 16519 application/javascript; charset=utf-8 70.1572ms
2025-11-13 10:26:52.008 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7257/_vs/browserLink - 200 null text/javascript; charset=UTF-8 136.8234ms
2025-11-13 10:26:52.089 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7257/swagger/v1/swagger.json - null null
2025-11-13 10:26:52.100 +03:00 [DBG] No candidates found for the request path '/swagger/v1/swagger.json'
2025-11-13 10:26:52.105 +03:00 [DBG] Request did not match any endpoints
2025-11-13 10:26:52.137 +03:00 [INF] HTTP GET /swagger/v1/swagger.json responded 200 in 27.8566 ms
2025-11-13 10:26:52.153 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7257/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 64.5101ms
2025-11-13 10:27:41.335 +03:00 [DBG] Connection id "0HNH2GO1DERAJ" accepted.
2025-11-13 10:27:41.335 +03:00 [DBG] Connection id "0HNH2GO1DERAJ" received FIN.
2025-11-13 10:27:41.347 +03:00 [DBG] Connection id "0HNH2GO1DERAK" accepted.
2025-11-13 10:27:41.339 +03:00 [DBG] Connection id "0HNH2GO1DERAJ" started.
2025-11-13 10:27:41.359 +03:00 [DBG] Connection id "0HNH2GO1DERAK" started.
2025-11-13 10:27:41.364 +03:00 [DBG] Failed to authenticate HTTPS connection.
System.IO.IOException: Received an unexpected EOF or 0 bytes from the transport stream.
   at System.Net.Security.SslStream.ReceiveHandshakeFrameAsync[TIOAdapter](CancellationToken cancellationToken)
   at System.Net.Security.SslStream.ForceAuthenticationAsync[TIOAdapter](Boolean receiveFirst, Byte[] reAuthenticationData, CancellationToken cancellationToken)
   at System.Net.Security.SslStream.ProcessAuthenticationWithTelemetryAsync(Boolean isAsync, CancellationToken cancellationToken)
   at Microsoft.AspNetCore.Server.Kestrel.Https.Internal.HttpsConnectionMiddleware.OnConnectionAsync(ConnectionContext context)
2025-11-13 10:27:41.368 +03:00 [DBG] Connection id "0HNH2GO1DERAJ" stopped.
2025-11-13 10:27:41.372 +03:00 [DBG] Connection 0HNH2GO1DERAK established using the following protocol: "Tls13"
2025-11-13 10:27:41.373 +03:00 [DBG] Connection id "0HNH2GO1DERAJ" sending FIN because: "The Socket transport's send loop completed gracefully."
2025-11-13 10:27:41.382 +03:00 [INF] Request starting HTTP/1.1 POST https://localhost:7257/api/Invoices - application/json 1317
2025-11-13 10:27:41.394 +03:00 [DBG] 1 candidate(s) found for the request path '/api/Invoices'
2025-11-13 10:27:41.410 +03:00 [DBG] Endpoint 'BillingSystem.API.Controllers.InvoicesController.Post (BillingSystem.API)' with route pattern 'api/Invoices' is valid for the request path '/api/Invoices'
2025-11-13 10:27:41.416 +03:00 [DBG] Request matched endpoint 'BillingSystem.API.Controllers.InvoicesController.Post (BillingSystem.API)'
2025-11-13 10:27:41.425 +03:00 [DBG] Static files was skipped as the request already matched an endpoint.
2025-11-13 10:27:41.644 +03:00 [DBG] An 'IServiceProvider' was created for internal use by Entity Framework.
2025-11-13 10:27:47.092 +03:00 [INF] Executing endpoint 'BillingSystem.API.Controllers.InvoicesController.Post (BillingSystem.API)'
2025-11-13 10:27:47.136 +03:00 [INF] Route matched with {action = "Post", controller = "Invoices"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Post(BillingSystem.Application.Requests.CreateInvoiceRequest) on controller BillingSystem.API.Controllers.InvoicesController (BillingSystem.API).
2025-11-13 10:27:47.144 +03:00 [DBG] Execution plan of authorization filters (in the following order): ["None"]
2025-11-13 10:27:47.148 +03:00 [DBG] Execution plan of resource filters (in the following order): ["None"]
2025-11-13 10:27:47.154 +03:00 [DBG] Execution plan of action filters (in the following order): ["Microsoft.AspNetCore.Mvc.ModelBinding.UnsupportedContentTypeFilter (Order: -3000)","Microsoft.AspNetCore.Mvc.Infrastructure.ModelStateInvalidFilter (Order: -2000)","BillingSystem.API.ActionFilters.AuditBillingRequestsFilter","BillingSystem.API.ActionFilters.IdempotencyFilter (Order: 0)"]
2025-11-13 10:27:47.161 +03:00 [DBG] Execution plan of exception filters (in the following order): ["None"]
2025-11-13 10:27:47.166 +03:00 [DBG] Execution plan of result filters (in the following order): ["Microsoft.AspNetCore.Mvc.Infrastructure.ClientErrorResultFilter (Order: -2000)","Microsoft.AspNetCore.Mvc.ProducesAttribute (Order: 0)","BillingSystem.API.ActionFilters.IdempotencyFilter (Order: 0)"]
2025-11-13 10:27:47.174 +03:00 [DBG] Executing controller factory for controller BillingSystem.API.Controllers.InvoicesController (BillingSystem.API)
2025-11-13 10:27:47.184 +03:00 [WRN] You do not have a valid license key for the Lucky Penny software MediatR. This is allowed for development and testing scenarios. If you are running in production you are required to have a licensed version. Please visit https://luckypennysoftware.com to obtain a valid license.
2025-11-13 10:27:47.258 +03:00 [DBG] Executed controller factory for controller BillingSystem.API.Controllers.InvoicesController (BillingSystem.API)
2025-11-13 10:27:47.294 +03:00 [DBG] Attempting to bind parameter 'invoiceRequest' of type 'BillingSystem.Application.Requests.CreateInvoiceRequest' ...
2025-11-13 10:27:47.302 +03:00 [DBG] Attempting to bind parameter 'invoiceRequest' of type 'BillingSystem.Application.Requests.CreateInvoiceRequest' using the name '' in request data ...
2025-11-13 10:27:47.308 +03:00 [DBG] Selected input formatter 'Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonInputFormatter' for content type 'application/json'.
2025-11-13 10:27:47.355 +03:00 [DBG] Connection id "0HNH2GO1DERAK", Request id "0HNH2GO1DERAK:00000001": started reading request body.
2025-11-13 10:27:47.358 +03:00 [DBG] Connection id "0HNH2GO1DERAK", Request id "0HNH2GO1DERAK:00000001": done reading request body.
2025-11-13 10:27:47.394 +03:00 [DBG] JSON input formatter succeeded, deserializing to type 'BillingSystem.Application.Requests.CreateInvoiceRequest'
2025-11-13 10:27:47.398 +03:00 [DBG] Done attempting to bind parameter 'invoiceRequest' of type 'BillingSystem.Application.Requests.CreateInvoiceRequest'.
2025-11-13 10:27:47.403 +03:00 [DBG] Done attempting to bind parameter 'invoiceRequest' of type 'BillingSystem.Application.Requests.CreateInvoiceRequest'.
2025-11-13 10:27:47.406 +03:00 [DBG] Attempting to validate the bound parameter 'invoiceRequest' of type 'BillingSystem.Application.Requests.CreateInvoiceRequest' ...
2025-11-13 10:27:47.435 +03:00 [DBG] Done attempting to validate the bound parameter 'invoiceRequest' of type 'BillingSystem.Application.Requests.CreateInvoiceRequest'.
2025-11-13 10:27:47.822 +03:00 [DBG] No relationship from 'Invoice' to 'Invoice' has been configured by convention because there are multiple properties on one entity type - {'DiscountedPrimaryInvoice'} that could be matched with the properties on the other entity type - {'InverseDiscountedPrimaryInvoice', 'InversePrimaryInvoice', 'InverseSubstitutionPrimaryInvoice', 'PrimaryInvoice', 'SubstitutionPrimaryInvoice'}. This message can be disregarded if explicit configuration has been specified in 'OnModelCreating'.
2025-11-13 10:27:48.100 +03:00 [DBG] No relationship from 'Invoice' to 'Invoice' has been configured by convention because there are multiple properties on one entity type - {'DiscountedPrimaryInvoice'} that could be matched with the properties on the other entity type - {'InverseDiscountedPrimaryInvoice', 'InversePrimaryInvoice', 'InverseSubstitutionPrimaryInvoice', 'PrimaryInvoice', 'SubstitutionPrimaryInvoice'}. This message can be disregarded if explicit configuration has been specified in 'OnModelCreating'.
2025-11-13 10:27:48.115 +03:00 [DBG] No relationship from 'Invoice' to 'Invoice' has been configured by convention because there are multiple properties on one entity type - {'InversePrimaryInvoice'} that could be matched with the properties on the other entity type - {'InverseSubstitutionPrimaryInvoice', 'PrimaryInvoice', 'SubstitutionPrimaryInvoice'}. This message can be disregarded if explicit configuration has been specified in 'OnModelCreating'.
2025-11-13 10:27:48.122 +03:00 [DBG] No relationship from 'Invoice' to 'Invoice' has been configured by convention because there are multiple properties on one entity type - {'InversePrimaryInvoice'} that could be matched with the properties on the other entity type - {'InverseSubstitutionPrimaryInvoice', 'PrimaryInvoice', 'SubstitutionPrimaryInvoice'}. This message can be disregarded if explicit configuration has been specified in 'OnModelCreating'.
2025-11-13 10:27:48.552 +03:00 [DBG] Entity Framework Core 9.0.9 initialized 'BillingServiceDBContext' using provider 'Microsoft.EntityFrameworkCore.SqlServer:9.0.9' with options: EngineType=SqlServer 
2025-11-13 10:27:48.698 +03:00 [DBG] Compiling query expression: 
'DbSet<Invoice>()
    .AsNoTracking()
    .Any(inv => inv.ExternalId.ToString() == __idempotentKey_0)'
2025-11-13 10:27:49.015 +03:00 [DBG] Generated query execution expression: 
'queryContext => ShapedQueryCompilingExpressionVisitor.SingleAsync<bool>(
    asyncEnumerable: SingleQueryingEnumerable.Create<bool>(
        relationalQueryContext: (RelationalQueryContext)queryContext, 
        relationalCommandResolver: parameters => [LIFTABLE Constant: RelationalCommandCache.QueryExpression(
            Projection Mapping:
                EmptyProjectionMember -> 0
            SELECT EXISTS (
                SELECT 1
                FROM Invoices AS i
                WHERE COALESCE(CONVERT(varchar(36), i.ExternalId), '') == @__idempotentKey_0)) | Resolver: c => new RelationalCommandCache(
            c.Dependencies.MemoryCache, 
            c.RelationalDependencies.QuerySqlGeneratorFactory, 
            c.RelationalDependencies.RelationalParameterBasedSqlProcessorFactory, 
            Projection Mapping:
                EmptyProjectionMember -> 0
            SELECT EXISTS (
                SELECT 1
                FROM Invoices AS i
                WHERE COALESCE(CONVERT(varchar(36), i.ExternalId), '') == @__idempotentKey_0), 
            False, 
            new HashSet<string>(
                new string[]{ }, 
                StringComparer.Ordinal
            )
        )].GetRelationalCommandTemplate(parameters), 
        readerColumns: null, 
        shaper: (queryContext, dataReader, resultContext, resultCoordinator) => 
        {
            bool? value1;
            value1 = dataReader.IsDBNull(0) ? default(bool?) : (bool?)dataReader.GetBoolean(0);
            return (bool)value1;
        }, 
        contextType: BillingSystem.Infrastructure.EF.BillingServiceDBContext, 
        standAloneStateManager: False, 
        detailedErrorsEnabled: False, 
        threadSafetyChecksEnabled: True), 
    cancellationToken: queryContext.CancellationToken)'
2025-11-13 10:27:49.093 +03:00 [DBG] Creating DbConnection.
2025-11-13 10:27:49.117 +03:00 [DBG] Created DbConnection. (23ms).
2025-11-13 10:27:49.125 +03:00 [DBG] Opening connection to database 'GAC-BillingService' on server '.'.
2025-11-13 10:27:49.483 +03:00 [DBG] Opened connection to database 'GAC-BillingService' on server '.'.
2025-11-13 10:27:49.491 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-11-13 10:27:49.503 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (9ms).
2025-11-13 10:27:49.518 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (28ms).
2025-11-13 10:27:49.537 +03:00 [DBG] Executing DbCommand [Parameters=[@__idempotentKey_0='?' (Size = 36) (DbType = AnsiString)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [Invoices] AS [i]
        WHERE CONVERT(varchar(36), [i].[ExternalId]) = @__idempotentKey_0) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2025-11-13 10:27:49.644 +03:00 [INF] Executed DbCommand (110ms) [Parameters=[@__idempotentKey_0='?' (Size = 36) (DbType = AnsiString)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [Invoices] AS [i]
        WHERE CONVERT(varchar(36), [i].[ExternalId]) = @__idempotentKey_0) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2025-11-13 10:27:49.675 +03:00 [DBG] Closing data reader to 'GAC-BillingService' on server '.'.
2025-11-13 10:27:49.689 +03:00 [DBG] A data reader for 'GAC-BillingService' on server '.' is being disposed after spending 31ms reading results.
2025-11-13 10:27:49.700 +03:00 [DBG] Closing connection to database 'GAC-BillingService' on server '.'.
2025-11-13 10:27:49.714 +03:00 [DBG] Closed connection to database 'GAC-BillingService' on server '.' (14ms).
2025-11-13 10:27:49.971 +03:00 [WRN] You do not have a valid license key for the Lucky Penny software AutoMapper. This is allowed for development and testing scenarios. If you are running in production you are required to have a licensed version. Please visit https://luckypennysoftware.com to obtain a valid license.
2025-11-13 10:27:50.072 +03:00 [DBG] Opening connection to database 'GAC-BillingService' on server '.'.
2025-11-13 10:27:50.081 +03:00 [DBG] Opened connection to database 'GAC-BillingService' on server '.'.
2025-11-13 10:27:50.087 +03:00 [DBG] Beginning transaction with isolation level 'Unspecified'.
2025-11-13 10:27:50.100 +03:00 [DBG] Began transaction with isolation level 'ReadCommitted'.
2025-11-13 10:27:50.109 +03:00 [DBG] Compiling query expression: 
'SqlQuery<long>(SELECT CAST(NEXT VALUE FOR dbo.InvoiceNumberSequence AS BIGINT) AS Value, __p_0)
    .First()'
2025-11-13 10:27:50.121 +03:00 [WRN] The query uses the 'First'/'FirstOrDefault' operator without 'OrderBy' and filter operators. This may lead to unpredictable results.
2025-11-13 10:27:50.129 +03:00 [DBG] Generated query execution expression: 
'queryContext => ShapedQueryCompilingExpressionVisitor.SingleAsync<long>(
    asyncEnumerable: SingleQueryingEnumerable.Create<long>(
        relationalQueryContext: (RelationalQueryContext)queryContext, 
        relationalCommandResolver: parameters => [LIFTABLE Constant: RelationalCommandCache.QueryExpression(
            Projection Mapping:
                EmptyProjectionMember -> 0
            SELECT TOP(1) s.Value
            FROM SELECT CAST(NEXT VALUE FOR dbo.InvoiceNumberSequence AS BIGINT) AS Value) | Resolver: c => new RelationalCommandCache(
            c.Dependencies.MemoryCache, 
            c.RelationalDependencies.QuerySqlGeneratorFactory, 
            c.RelationalDependencies.RelationalParameterBasedSqlProcessorFactory, 
            Projection Mapping:
                EmptyProjectionMember -> 0
            SELECT TOP(1) s.Value
            FROM SELECT CAST(NEXT VALUE FOR dbo.InvoiceNumberSequence AS BIGINT) AS Value, 
            False, 
            new HashSet<string>(
                new string[]{ }, 
                StringComparer.Ordinal
            )
        )].GetRelationalCommandTemplate(parameters), 
        readerColumns: null, 
        shaper: (queryContext, dataReader, resultContext, resultCoordinator) => 
        {
            long? value1;
            value1 = dataReader.IsDBNull(0) ? default(long?) : (long?)dataReader.GetInt64(0);
            return (long)value1;
        }, 
        contextType: BillingSystem.Infrastructure.EF.BillingServiceDBContext, 
        standAloneStateManager: False, 
        detailedErrorsEnabled: False, 
        threadSafetyChecksEnabled: True), 
    cancellationToken: queryContext.CancellationToken)'
2025-11-13 10:27:50.143 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-11-13 10:27:50.147 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (4ms).
2025-11-13 10:27:50.152 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (9ms).
2025-11-13 10:27:50.156 +03:00 [DBG] Executing DbCommand [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [s].[Value]
FROM (
    SELECT CAST(NEXT VALUE FOR dbo.InvoiceNumberSequence AS BIGINT) AS Value
) AS [s]
2025-11-13 10:27:50.184 +03:00 [ERR] Failed executing DbCommand (27ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [s].[Value]
FROM (
    SELECT CAST(NEXT VALUE FOR dbo.InvoiceNumberSequence AS BIGINT) AS Value
) AS [s]
2025-11-13 10:27:50.203 +03:00 [ERR] An exception occurred while iterating over the results of a query for context type 'BillingSystem.Infrastructure.EF.BillingServiceDBContext'.
Microsoft.Data.SqlClient.SqlException (0x80131904): NEXT VALUE FOR function is not allowed in check constraints, default objects, computed columns, views, user-defined functions, user-defined aggregates, user-defined table types, sub-queries, common table expressions, derived tables or return statements.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__211_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.InitializeReaderAsync(AsyncEnumerator enumerator, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()
ClientConnectionId:a1558a0f-73ad-43eb-85b2-87db3485ab11
Error Number:11719,State:1,Class:15
Microsoft.Data.SqlClient.SqlException (0x80131904): NEXT VALUE FOR function is not allowed in check constraints, default objects, computed columns, views, user-defined functions, user-defined aggregates, user-defined table types, sub-queries, common table expressions, derived tables or return statements.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__211_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.InitializeReaderAsync(AsyncEnumerator enumerator, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()
ClientConnectionId:a1558a0f-73ad-43eb-85b2-87db3485ab11
Error Number:11719,State:1,Class:15
2025-11-13 10:27:50.269 +03:00 [ERR] exception occured NEXT VALUE FOR function is not allowed in check constraints, default objects, computed columns, views, user-defined functions, user-defined aggregates, user-defined table types, sub-queries, common table expressions, derived tables or return statements. , stackTrace    at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__211_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.InitializeReaderAsync(AsyncEnumerator enumerator, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()
   at Microsoft.EntityFrameworkCore.Query.ShapedQueryCompilingExpressionVisitor.SingleAsync[TSource](IAsyncEnumerable`1 asyncEnumerable, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.ShapedQueryCompilingExpressionVisitor.SingleAsync[TSource](IAsyncEnumerable`1 asyncEnumerable, CancellationToken cancellationToken)
   at BillingSystem.Infrastructure.Persistence.EF.InvoiceRepository.InsertTransactional(Invoice entity, OutboxEvent outboxEvent) in C:\Repositories\Gac-BillingSystem\src\BillingSystem.Infrastructure\Persistence\EF\InvoiceRepository.cs:line 65
2025-11-13 10:27:50.277 +03:00 [DBG] Rolling back transaction.
2025-11-13 10:27:50.286 +03:00 [DBG] Rolled back transaction.
2025-11-13 10:27:50.289 +03:00 [DBG] Closing connection to database 'GAC-BillingService' on server '.'.
2025-11-13 10:27:50.293 +03:00 [DBG] Closed connection to database 'GAC-BillingService' on server '.' (4ms).
2025-11-13 10:27:50.332 +03:00 [DBG] Disposing transaction.
2025-11-13 10:27:50.430 +03:00 [ERR] exception occured NEXT VALUE FOR function is not allowed in check constraints, default objects, computed columns, views, user-defined functions, user-defined aggregates, user-defined table types, sub-queries, common table expressions, derived tables or return statements. , stackTrace    at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__211_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.InitializeReaderAsync(AsyncEnumerator enumerator, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()
   at Microsoft.EntityFrameworkCore.Query.ShapedQueryCompilingExpressionVisitor.SingleAsync[TSource](IAsyncEnumerable`1 asyncEnumerable, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.ShapedQueryCompilingExpressionVisitor.SingleAsync[TSource](IAsyncEnumerable`1 asyncEnumerable, CancellationToken cancellationToken)
   at BillingSystem.Infrastructure.Persistence.EF.InvoiceRepository.InsertTransactional(Invoice entity, OutboxEvent outboxEvent) in C:\Repositories\Gac-BillingSystem\src\BillingSystem.Infrastructure\Persistence\EF\InvoiceRepository.cs:line 65
   at BillingSystem.Application.Commands.CreateInvoiceCommandRequestHandler.Handle(CreateInvoiceRequest request, CancellationToken cancellationToken) in C:\Repositories\Gac-BillingSystem\src\BillingSystem.Application\Commands\CreateInvoiceCommandRequestHandler.cs:line 62
   at BillingSystem.API.Controllers.InvoicesController.Post(CreateInvoiceRequest invoiceRequest) in C:\Repositories\Gac-BillingSystem\src\BillingSystem.API\Controllers\InvoicesController.cs:line 45
2025-11-13 10:27:50.461 +03:00 [DBG] List of registered output formatters, in the following order: ["Microsoft.AspNetCore.Mvc.Formatters.HttpNoContentOutputFormatter","Microsoft.AspNetCore.Mvc.Formatters.StringOutputFormatter","Microsoft.AspNetCore.Mvc.Formatters.StreamOutputFormatter","Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonOutputFormatter"]
2025-11-13 10:27:50.474 +03:00 [DBG] No information found on request to perform content negotiation.
2025-11-13 10:27:50.479 +03:00 [DBG] Attempting to select the first output formatter in the output formatters list which supports a content type from the explicitly specified content types '["application/json","application/problem+json","application/problem+xml"]'.
2025-11-13 10:27:50.487 +03:00 [DBG] Selected output formatter 'Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonOutputFormatter' and content type 'application/json' to write the response.
2025-11-13 10:27:50.491 +03:00 [INF] Executing ObjectResult, writing value of type 'Microsoft.AspNetCore.Mvc.ProblemDetails'.
2025-11-13 10:27:50.536 +03:00 [INF] Executed action BillingSystem.API.Controllers.InvoicesController.Post (BillingSystem.API) in 3358.8924ms
2025-11-13 10:27:50.541 +03:00 [INF] Executed endpoint 'BillingSystem.API.Controllers.InvoicesController.Post (BillingSystem.API)'
2025-11-13 10:27:50.546 +03:00 [ERR] HTTP POST /api/Invoices responded 500 in 9123.8541 ms
2025-11-13 10:27:50.551 +03:00 [DBG] Connection id "0HNH2GO1DERAK" completed keep alive response.
2025-11-13 10:27:50.556 +03:00 [DBG] 'BillingServiceDBContext' disposed.
2025-11-13 10:27:50.568 +03:00 [DBG] Disposing connection to database 'GAC-BillingService' on server '.'.
2025-11-13 10:27:50.575 +03:00 [DBG] Disposed connection to database '' on server '' (6ms).
2025-11-13 10:27:50.581 +03:00 [INF] Request finished HTTP/1.1 POST https://localhost:7257/api/Invoices - 500 null application/json; charset=utf-8 9199.1021ms
2025-11-13 10:27:59.333 +03:00 [INF] Request starting HTTP/1.1 POST https://localhost:7257/api/Invoices - application/json 1317
2025-11-13 10:27:59.345 +03:00 [DBG] 1 candidate(s) found for the request path '/api/Invoices'
2025-11-13 10:27:59.348 +03:00 [DBG] Endpoint 'BillingSystem.API.Controllers.InvoicesController.Post (BillingSystem.API)' with route pattern 'api/Invoices' is valid for the request path '/api/Invoices'
2025-11-13 10:27:59.357 +03:00 [DBG] Request matched endpoint 'BillingSystem.API.Controllers.InvoicesController.Post (BillingSystem.API)'
2025-11-13 10:27:59.360 +03:00 [DBG] Static files was skipped as the request already matched an endpoint.
2025-11-13 10:27:59.371 +03:00 [INF] Executing endpoint 'BillingSystem.API.Controllers.InvoicesController.Post (BillingSystem.API)'
2025-11-13 10:27:59.377 +03:00 [INF] Route matched with {action = "Post", controller = "Invoices"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Post(BillingSystem.Application.Requests.CreateInvoiceRequest) on controller BillingSystem.API.Controllers.InvoicesController (BillingSystem.API).
2025-11-13 10:27:59.381 +03:00 [DBG] Execution plan of authorization filters (in the following order): ["None"]
2025-11-13 10:27:59.385 +03:00 [DBG] Execution plan of resource filters (in the following order): ["None"]
2025-11-13 10:27:59.389 +03:00 [DBG] Execution plan of action filters (in the following order): ["Microsoft.AspNetCore.Mvc.ModelBinding.UnsupportedContentTypeFilter (Order: -3000)","Microsoft.AspNetCore.Mvc.Infrastructure.ModelStateInvalidFilter (Order: -2000)","BillingSystem.API.ActionFilters.AuditBillingRequestsFilter","BillingSystem.API.ActionFilters.IdempotencyFilter (Order: 0)"]
2025-11-13 10:27:59.394 +03:00 [DBG] Execution plan of exception filters (in the following order): ["None"]
2025-11-13 10:27:59.398 +03:00 [DBG] Execution plan of result filters (in the following order): ["Microsoft.AspNetCore.Mvc.Infrastructure.ClientErrorResultFilter (Order: -2000)","Microsoft.AspNetCore.Mvc.ProducesAttribute (Order: 0)","BillingSystem.API.ActionFilters.IdempotencyFilter (Order: 0)"]
2025-11-13 10:27:59.405 +03:00 [DBG] Executing controller factory for controller BillingSystem.API.Controllers.InvoicesController (BillingSystem.API)
2025-11-13 10:27:59.414 +03:00 [DBG] Executed controller factory for controller BillingSystem.API.Controllers.InvoicesController (BillingSystem.API)
2025-11-13 10:27:59.418 +03:00 [DBG] Attempting to bind parameter 'invoiceRequest' of type 'BillingSystem.Application.Requests.CreateInvoiceRequest' ...
2025-11-13 10:27:59.420 +03:00 [DBG] Attempting to bind parameter 'invoiceRequest' of type 'BillingSystem.Application.Requests.CreateInvoiceRequest' using the name '' in request data ...
2025-11-13 10:27:59.424 +03:00 [DBG] Selected input formatter 'Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonInputFormatter' for content type 'application/json'.
2025-11-13 10:27:59.429 +03:00 [DBG] Connection id "0HNH2GO1DERAK", Request id "0HNH2GO1DERAK:00000002": started reading request body.
2025-11-13 10:27:59.432 +03:00 [DBG] Connection id "0HNH2GO1DERAK", Request id "0HNH2GO1DERAK:00000002": done reading request body.
2025-11-13 10:27:59.437 +03:00 [DBG] JSON input formatter succeeded, deserializing to type 'BillingSystem.Application.Requests.CreateInvoiceRequest'
2025-11-13 10:27:59.443 +03:00 [DBG] Done attempting to bind parameter 'invoiceRequest' of type 'BillingSystem.Application.Requests.CreateInvoiceRequest'.
2025-11-13 10:27:59.448 +03:00 [DBG] Done attempting to bind parameter 'invoiceRequest' of type 'BillingSystem.Application.Requests.CreateInvoiceRequest'.
2025-11-13 10:27:59.451 +03:00 [DBG] Attempting to validate the bound parameter 'invoiceRequest' of type 'BillingSystem.Application.Requests.CreateInvoiceRequest' ...
2025-11-13 10:27:59.454 +03:00 [DBG] Done attempting to validate the bound parameter 'invoiceRequest' of type 'BillingSystem.Application.Requests.CreateInvoiceRequest'.
2025-11-13 10:27:59.484 +03:00 [DBG] Entity Framework Core 9.0.9 initialized 'BillingServiceDBContext' using provider 'Microsoft.EntityFrameworkCore.SqlServer:9.0.9' with options: EngineType=SqlServer 
2025-11-13 10:27:59.497 +03:00 [DBG] Creating DbConnection.
2025-11-13 10:27:59.502 +03:00 [DBG] Created DbConnection. (4ms).
2025-11-13 10:27:59.505 +03:00 [DBG] Opening connection to database 'GAC-BillingService' on server '.'.
2025-11-13 10:27:59.511 +03:00 [DBG] Opened connection to database 'GAC-BillingService' on server '.'.
2025-11-13 10:27:59.514 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-11-13 10:27:59.517 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (2ms).
2025-11-13 10:27:59.520 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (6ms).
2025-11-13 10:27:59.527 +03:00 [DBG] Executing DbCommand [Parameters=[@__idempotentKey_0='?' (Size = 36) (DbType = AnsiString)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [Invoices] AS [i]
        WHERE CONVERT(varchar(36), [i].[ExternalId]) = @__idempotentKey_0) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2025-11-13 10:27:59.535 +03:00 [INF] Executed DbCommand (9ms) [Parameters=[@__idempotentKey_0='?' (Size = 36) (DbType = AnsiString)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [Invoices] AS [i]
        WHERE CONVERT(varchar(36), [i].[ExternalId]) = @__idempotentKey_0) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2025-11-13 10:27:59.541 +03:00 [DBG] Closing data reader to 'GAC-BillingService' on server '.'.
2025-11-13 10:27:59.545 +03:00 [DBG] A data reader for 'GAC-BillingService' on server '.' is being disposed after spending 4ms reading results.
2025-11-13 10:27:59.549 +03:00 [DBG] Closing connection to database 'GAC-BillingService' on server '.'.
2025-11-13 10:27:59.552 +03:00 [DBG] Closed connection to database 'GAC-BillingService' on server '.' (3ms).
2025-11-13 10:28:03.918 +03:00 [DBG] Opening connection to database 'GAC-BillingService' on server '.'.
2025-11-13 10:28:03.923 +03:00 [DBG] Opened connection to database 'GAC-BillingService' on server '.'.
2025-11-13 10:28:03.927 +03:00 [DBG] Beginning transaction with isolation level 'Unspecified'.
2025-11-13 10:28:03.932 +03:00 [DBG] Began transaction with isolation level 'ReadCommitted'.
2025-11-13 10:28:04.842 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-11-13 10:28:04.845 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (2ms).
2025-11-13 10:28:04.848 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (5ms).
2025-11-13 10:28:04.852 +03:00 [DBG] Executing DbCommand [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [s].[Value]
FROM (
    SELECT CAST(NEXT VALUE FOR dbo.InvoiceNumberSequence AS BIGINT) AS Value
) AS [s]
2025-11-13 10:28:04.883 +03:00 [ERR] Failed executing DbCommand (32ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [s].[Value]
FROM (
    SELECT CAST(NEXT VALUE FOR dbo.InvoiceNumberSequence AS BIGINT) AS Value
) AS [s]
2025-11-13 10:28:04.892 +03:00 [ERR] An exception occurred while iterating over the results of a query for context type 'BillingSystem.Infrastructure.EF.BillingServiceDBContext'.
Microsoft.Data.SqlClient.SqlException (0x80131904): NEXT VALUE FOR function is not allowed in check constraints, default objects, computed columns, views, user-defined functions, user-defined aggregates, user-defined table types, sub-queries, common table expressions, derived tables or return statements.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__211_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.InitializeReaderAsync(AsyncEnumerator enumerator, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()
ClientConnectionId:a1558a0f-73ad-43eb-85b2-87db3485ab11
Error Number:11719,State:1,Class:15
Microsoft.Data.SqlClient.SqlException (0x80131904): NEXT VALUE FOR function is not allowed in check constraints, default objects, computed columns, views, user-defined functions, user-defined aggregates, user-defined table types, sub-queries, common table expressions, derived tables or return statements.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__211_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.InitializeReaderAsync(AsyncEnumerator enumerator, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()
ClientConnectionId:a1558a0f-73ad-43eb-85b2-87db3485ab11
Error Number:11719,State:1,Class:15
2025-11-13 10:36:12.079 +03:00 [DBG] Registered model binder providers, in the following order: ["Microsoft.AspNetCore.Mvc.ModelBinding.Binders.BinderTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ServicesModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.BodyModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.HeaderModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FloatingPointTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.EnumTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.DateTimeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.SimpleTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.TryParseModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.CancellationTokenModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ByteArrayModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FormFileModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FormCollectionModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.KeyValuePairModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.DictionaryModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ArrayModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.CollectionModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ComplexObjectModelBinderProvider"]
2025-11-13 10:36:12.265 +03:00 [DBG] Hosting starting
2025-11-13 10:36:12.678 +03:00 [DBG] Starting bus instances: IBus
2025-11-13 10:36:12.687 +03:00 [DBG] Starting bus: "rabbitmq://localhost/"
2025-11-13 10:36:12.722 +03:00 [DBG] Middleware loaded
2025-11-13 10:36:12.727 +03:00 [DBG] Middleware loaded. Script /_framework/aspnetcore-browser-refresh.js (16519 B).
2025-11-13 10:36:12.749 +03:00 [DBG] Middleware loaded. Script /_framework/blazor-hotreload.js (799 B).
2025-11-13 10:36:12.754 +03:00 [DBG] Connect: guest@localhost:5672/
2025-11-13 10:36:12.900 +03:00 [DBG] Middleware loaded: DOTNET_MODIFIABLE_ASSEMBLIES=debug, __ASPNETCORE_BROWSER_TOOLS=true
2025-11-13 10:36:12.926 +03:00 [DBG] Connected: guest@localhost:5672/ (address: amqp://localhost:5672, local: 57631)
2025-11-13 10:36:12.995 +03:00 [DBG] Endpoint Ready: "rabbitmq://localhost/ECHGHANNAMLP1_BillingSystemAPI_bus_5dcoyyyh3bcsypj7bdxnfb41yk?temporary=true"
2025-11-13 10:36:13.000 +03:00 [INF] Bus started: "rabbitmq://localhost/"
2025-11-13 10:36:13.199 +03:00 [INF] Now listening on: https://localhost:7257
2025-11-13 10:36:13.205 +03:00 [INF] Now listening on: http://localhost:5009
2025-11-13 10:36:13.208 +03:00 [DBG] Loaded hosting startup assembly BillingSystem.API
2025-11-13 10:36:13.210 +03:00 [DBG] Loaded hosting startup assembly Microsoft.WebTools.ApiEndpointDiscovery
2025-11-13 10:36:13.214 +03:00 [DBG] Loaded hosting startup assembly Microsoft.AspNetCore.Watch.BrowserRefresh
2025-11-13 10:36:13.216 +03:00 [DBG] Loaded hosting startup assembly Microsoft.WebTools.BrowserLink.Net
2025-11-13 10:36:13.352 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-11-13 10:36:13.356 +03:00 [INF] Hosting environment: Development
2025-11-13 10:36:13.358 +03:00 [INF] Content root path: C:\Repositories\Gac-BillingSystem\src\BillingSystem.API
2025-11-13 10:36:13.362 +03:00 [DBG] Hosting started
2025-11-13 10:36:13.408 +03:00 [DBG] Connection id "0HNH2GT98PINE" accepted.
2025-11-13 10:36:13.414 +03:00 [DBG] Connection id "0HNH2GT98PINE" started.
2025-11-13 10:36:13.424 +03:00 [DBG] Connection id "0HNH2GT98PINE" received FIN.
2025-11-13 10:36:13.441 +03:00 [DBG] Failed to authenticate HTTPS connection.
System.IO.IOException: Received an unexpected EOF or 0 bytes from the transport stream.
   at System.Net.Security.SslStream.ReceiveHandshakeFrameAsync[TIOAdapter](CancellationToken cancellationToken)
   at System.Net.Security.SslStream.ForceAuthenticationAsync[TIOAdapter](Boolean receiveFirst, Byte[] reAuthenticationData, CancellationToken cancellationToken)
   at System.Net.Security.SslStream.ProcessAuthenticationWithTelemetryAsync(Boolean isAsync, CancellationToken cancellationToken)
   at Microsoft.AspNetCore.Server.Kestrel.Https.Internal.HttpsConnectionMiddleware.OnConnectionAsync(ConnectionContext context)
2025-11-13 10:36:13.476 +03:00 [DBG] Connection id "0HNH2GT98PINE" stopped.
2025-11-13 10:36:13.489 +03:00 [DBG] Connection id "0HNH2GT98PINE" sending FIN because: "The Socket transport's send loop completed gracefully."
2025-11-13 10:36:14.319 +03:00 [DBG] Connection id "0HNH2GT98PINF" accepted.
2025-11-13 10:36:14.324 +03:00 [DBG] Connection id "0HNH2GT98PINF" started.
2025-11-13 10:36:14.394 +03:00 [DBG] Connection 0HNH2GT98PINF established using the following protocol: "Tls13"
2025-11-13 10:36:14.468 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7257/swagger/index.html - null null
2025-11-13 10:36:14.524 +03:00 [DBG] Wildcard detected, all requests with hosts will be allowed.
2025-11-13 10:36:14.544 +03:00 [DBG] No candidates found for the request path '/swagger/index.html'
2025-11-13 10:36:14.550 +03:00 [DBG] Request did not match any endpoints
2025-11-13 10:36:14.628 +03:00 [DBG] Response markup is scheduled to include Browser Link script injection.
2025-11-13 10:36:14.634 +03:00 [DBG] Response markup is scheduled to include browser refresh script injection.
2025-11-13 10:36:14.659 +03:00 [INF] HTTP GET /swagger/index.html responded 200 in 98.3940 ms
2025-11-13 10:36:14.667 +03:00 [DBG] Response markup was updated to include Browser Link script injection.
2025-11-13 10:36:14.671 +03:00 [DBG] Response markup was updated to include browser refresh script injection.
2025-11-13 10:36:14.678 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7257/swagger/index.html - 200 null text/html;charset=utf-8 220.4054ms
2025-11-13 10:36:14.730 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7257/_framework/aspnetcore-browser-refresh.js - null null
2025-11-13 10:36:14.730 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7257/_vs/browserLink - null null
2025-11-13 10:36:14.744 +03:00 [DBG] Script injected: /_framework/aspnetcore-browser-refresh.js
2025-11-13 10:36:14.751 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7257/_framework/aspnetcore-browser-refresh.js - 200 16519 application/javascript; charset=utf-8 22.6077ms
2025-11-13 10:36:14.807 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7257/_vs/browserLink - 200 null text/javascript; charset=UTF-8 77.6003ms
2025-11-13 10:36:14.875 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7257/swagger/v1/swagger.json - null null
2025-11-13 10:36:14.881 +03:00 [DBG] No candidates found for the request path '/swagger/v1/swagger.json'
2025-11-13 10:36:14.884 +03:00 [DBG] Request did not match any endpoints
2025-11-13 10:36:14.903 +03:00 [INF] HTTP GET /swagger/v1/swagger.json responded 200 in 15.9404 ms
2025-11-13 10:36:14.912 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7257/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 37.4137ms
2025-11-13 10:36:22.219 +03:00 [DBG] Connection id "0HNH2GT98PING" accepted.
2025-11-13 10:36:22.220 +03:00 [DBG] Connection id "0HNH2GT98PING" received FIN.
2025-11-13 10:36:22.226 +03:00 [DBG] Connection id "0HNH2GT98PING" started.
2025-11-13 10:36:22.229 +03:00 [DBG] Connection id "0HNH2GT98PINH" accepted.
2025-11-13 10:36:22.241 +03:00 [DBG] Failed to authenticate HTTPS connection.
System.IO.IOException: Received an unexpected EOF or 0 bytes from the transport stream.
   at System.Net.Security.SslStream.ReceiveHandshakeFrameAsync[TIOAdapter](CancellationToken cancellationToken)
   at System.Net.Security.SslStream.ForceAuthenticationAsync[TIOAdapter](Boolean receiveFirst, Byte[] reAuthenticationData, CancellationToken cancellationToken)
   at System.Net.Security.SslStream.ProcessAuthenticationWithTelemetryAsync(Boolean isAsync, CancellationToken cancellationToken)
   at Microsoft.AspNetCore.Server.Kestrel.Https.Internal.HttpsConnectionMiddleware.OnConnectionAsync(ConnectionContext context)
2025-11-13 10:36:22.245 +03:00 [DBG] Connection id "0HNH2GT98PINH" started.
2025-11-13 10:36:22.257 +03:00 [DBG] Connection id "0HNH2GT98PING" stopped.
2025-11-13 10:36:22.265 +03:00 [DBG] Connection id "0HNH2GT98PING" sending FIN because: "The Socket transport's send loop completed gracefully."
2025-11-13 10:36:22.268 +03:00 [DBG] Connection 0HNH2GT98PINH established using the following protocol: "Tls13"
2025-11-13 10:36:22.280 +03:00 [INF] Request starting HTTP/1.1 POST https://localhost:7257/api/Invoices - application/json 1317
2025-11-13 10:36:22.290 +03:00 [DBG] 1 candidate(s) found for the request path '/api/Invoices'
2025-11-13 10:36:22.299 +03:00 [DBG] Endpoint 'BillingSystem.API.Controllers.InvoicesController.Post (BillingSystem.API)' with route pattern 'api/Invoices' is valid for the request path '/api/Invoices'
2025-11-13 10:36:22.303 +03:00 [DBG] Request matched endpoint 'BillingSystem.API.Controllers.InvoicesController.Post (BillingSystem.API)'
2025-11-13 10:36:22.311 +03:00 [DBG] Static files was skipped as the request already matched an endpoint.
2025-11-13 10:36:22.534 +03:00 [DBG] An 'IServiceProvider' was created for internal use by Entity Framework.
2025-11-13 10:36:27.993 +03:00 [INF] Executing endpoint 'BillingSystem.API.Controllers.InvoicesController.Post (BillingSystem.API)'
2025-11-13 10:36:28.040 +03:00 [INF] Route matched with {action = "Post", controller = "Invoices"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Post(BillingSystem.Application.Requests.CreateInvoiceRequest) on controller BillingSystem.API.Controllers.InvoicesController (BillingSystem.API).
2025-11-13 10:36:28.049 +03:00 [DBG] Execution plan of authorization filters (in the following order): ["None"]
2025-11-13 10:36:28.053 +03:00 [DBG] Execution plan of resource filters (in the following order): ["None"]
2025-11-13 10:36:28.058 +03:00 [DBG] Execution plan of action filters (in the following order): ["Microsoft.AspNetCore.Mvc.ModelBinding.UnsupportedContentTypeFilter (Order: -3000)","Microsoft.AspNetCore.Mvc.Infrastructure.ModelStateInvalidFilter (Order: -2000)","BillingSystem.API.ActionFilters.AuditBillingRequestsFilter","BillingSystem.API.ActionFilters.IdempotencyFilter (Order: 0)"]
2025-11-13 10:36:28.065 +03:00 [DBG] Execution plan of exception filters (in the following order): ["None"]
2025-11-13 10:36:28.069 +03:00 [DBG] Execution plan of result filters (in the following order): ["Microsoft.AspNetCore.Mvc.Infrastructure.ClientErrorResultFilter (Order: -2000)","Microsoft.AspNetCore.Mvc.ProducesAttribute (Order: 0)","BillingSystem.API.ActionFilters.IdempotencyFilter (Order: 0)"]
2025-11-13 10:36:28.077 +03:00 [DBG] Executing controller factory for controller BillingSystem.API.Controllers.InvoicesController (BillingSystem.API)
2025-11-13 10:36:28.085 +03:00 [WRN] You do not have a valid license key for the Lucky Penny software MediatR. This is allowed for development and testing scenarios. If you are running in production you are required to have a licensed version. Please visit https://luckypennysoftware.com to obtain a valid license.
2025-11-13 10:36:28.136 +03:00 [DBG] Executed controller factory for controller BillingSystem.API.Controllers.InvoicesController (BillingSystem.API)
2025-11-13 10:36:28.164 +03:00 [DBG] Attempting to bind parameter 'invoiceRequest' of type 'BillingSystem.Application.Requests.CreateInvoiceRequest' ...
2025-11-13 10:36:28.177 +03:00 [DBG] Attempting to bind parameter 'invoiceRequest' of type 'BillingSystem.Application.Requests.CreateInvoiceRequest' using the name '' in request data ...
2025-11-13 10:36:28.186 +03:00 [DBG] Selected input formatter 'Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonInputFormatter' for content type 'application/json'.
2025-11-13 10:36:28.247 +03:00 [DBG] Connection id "0HNH2GT98PINH", Request id "0HNH2GT98PINH:00000001": started reading request body.
2025-11-13 10:36:28.253 +03:00 [DBG] Connection id "0HNH2GT98PINH", Request id "0HNH2GT98PINH:00000001": done reading request body.
2025-11-13 10:36:28.288 +03:00 [DBG] JSON input formatter succeeded, deserializing to type 'BillingSystem.Application.Requests.CreateInvoiceRequest'
2025-11-13 10:36:28.293 +03:00 [DBG] Done attempting to bind parameter 'invoiceRequest' of type 'BillingSystem.Application.Requests.CreateInvoiceRequest'.
2025-11-13 10:36:28.297 +03:00 [DBG] Done attempting to bind parameter 'invoiceRequest' of type 'BillingSystem.Application.Requests.CreateInvoiceRequest'.
2025-11-13 10:36:28.300 +03:00 [DBG] Attempting to validate the bound parameter 'invoiceRequest' of type 'BillingSystem.Application.Requests.CreateInvoiceRequest' ...
2025-11-13 10:36:28.324 +03:00 [DBG] Done attempting to validate the bound parameter 'invoiceRequest' of type 'BillingSystem.Application.Requests.CreateInvoiceRequest'.
2025-11-13 10:36:28.631 +03:00 [DBG] No relationship from 'Invoice' to 'Invoice' has been configured by convention because there are multiple properties on one entity type - {'DiscountedPrimaryInvoice'} that could be matched with the properties on the other entity type - {'InverseDiscountedPrimaryInvoice', 'InversePrimaryInvoice', 'InverseSubstitutionPrimaryInvoice', 'PrimaryInvoice', 'SubstitutionPrimaryInvoice'}. This message can be disregarded if explicit configuration has been specified in 'OnModelCreating'.
2025-11-13 10:36:28.876 +03:00 [DBG] No relationship from 'Invoice' to 'Invoice' has been configured by convention because there are multiple properties on one entity type - {'DiscountedPrimaryInvoice'} that could be matched with the properties on the other entity type - {'InverseDiscountedPrimaryInvoice', 'InversePrimaryInvoice', 'InverseSubstitutionPrimaryInvoice', 'PrimaryInvoice', 'SubstitutionPrimaryInvoice'}. This message can be disregarded if explicit configuration has been specified in 'OnModelCreating'.
2025-11-13 10:36:28.894 +03:00 [DBG] No relationship from 'Invoice' to 'Invoice' has been configured by convention because there are multiple properties on one entity type - {'InversePrimaryInvoice'} that could be matched with the properties on the other entity type - {'InverseSubstitutionPrimaryInvoice', 'PrimaryInvoice', 'SubstitutionPrimaryInvoice'}. This message can be disregarded if explicit configuration has been specified in 'OnModelCreating'.
2025-11-13 10:36:28.905 +03:00 [DBG] No relationship from 'Invoice' to 'Invoice' has been configured by convention because there are multiple properties on one entity type - {'InversePrimaryInvoice'} that could be matched with the properties on the other entity type - {'InverseSubstitutionPrimaryInvoice', 'PrimaryInvoice', 'SubstitutionPrimaryInvoice'}. This message can be disregarded if explicit configuration has been specified in 'OnModelCreating'.
2025-11-13 10:36:29.272 +03:00 [DBG] Entity Framework Core 9.0.9 initialized 'BillingServiceDBContext' using provider 'Microsoft.EntityFrameworkCore.SqlServer:9.0.9' with options: EngineType=SqlServer 
2025-11-13 10:36:29.396 +03:00 [DBG] Compiling query expression: 
'DbSet<Invoice>()
    .AsNoTracking()
    .Any(inv => inv.ExternalId.ToString() == __idempotentKey_0)'
2025-11-13 10:36:29.725 +03:00 [DBG] Generated query execution expression: 
'queryContext => ShapedQueryCompilingExpressionVisitor.SingleAsync<bool>(
    asyncEnumerable: SingleQueryingEnumerable.Create<bool>(
        relationalQueryContext: (RelationalQueryContext)queryContext, 
        relationalCommandResolver: parameters => [LIFTABLE Constant: RelationalCommandCache.QueryExpression(
            Projection Mapping:
                EmptyProjectionMember -> 0
            SELECT EXISTS (
                SELECT 1
                FROM Invoices AS i
                WHERE COALESCE(CONVERT(varchar(36), i.ExternalId), '') == @__idempotentKey_0)) | Resolver: c => new RelationalCommandCache(
            c.Dependencies.MemoryCache, 
            c.RelationalDependencies.QuerySqlGeneratorFactory, 
            c.RelationalDependencies.RelationalParameterBasedSqlProcessorFactory, 
            Projection Mapping:
                EmptyProjectionMember -> 0
            SELECT EXISTS (
                SELECT 1
                FROM Invoices AS i
                WHERE COALESCE(CONVERT(varchar(36), i.ExternalId), '') == @__idempotentKey_0), 
            False, 
            new HashSet<string>(
                new string[]{ }, 
                StringComparer.Ordinal
            )
        )].GetRelationalCommandTemplate(parameters), 
        readerColumns: null, 
        shaper: (queryContext, dataReader, resultContext, resultCoordinator) => 
        {
            bool? value1;
            value1 = dataReader.IsDBNull(0) ? default(bool?) : (bool?)dataReader.GetBoolean(0);
            return (bool)value1;
        }, 
        contextType: BillingSystem.Infrastructure.EF.BillingServiceDBContext, 
        standAloneStateManager: False, 
        detailedErrorsEnabled: False, 
        threadSafetyChecksEnabled: True), 
    cancellationToken: queryContext.CancellationToken)'
2025-11-13 10:36:29.786 +03:00 [DBG] Creating DbConnection.
2025-11-13 10:36:29.814 +03:00 [DBG] Created DbConnection. (25ms).
2025-11-13 10:36:29.821 +03:00 [DBG] Opening connection to database 'GAC-BillingService' on server '.'.
2025-11-13 10:36:30.117 +03:00 [DBG] Opened connection to database 'GAC-BillingService' on server '.'.
2025-11-13 10:36:30.123 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-11-13 10:36:30.132 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (6ms).
2025-11-13 10:36:30.143 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (20ms).
2025-11-13 10:36:30.155 +03:00 [DBG] Executing DbCommand [Parameters=[@__idempotentKey_0='?' (Size = 36) (DbType = AnsiString)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [Invoices] AS [i]
        WHERE CONVERT(varchar(36), [i].[ExternalId]) = @__idempotentKey_0) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2025-11-13 10:36:30.230 +03:00 [INF] Executed DbCommand (71ms) [Parameters=[@__idempotentKey_0='?' (Size = 36) (DbType = AnsiString)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [Invoices] AS [i]
        WHERE CONVERT(varchar(36), [i].[ExternalId]) = @__idempotentKey_0) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2025-11-13 10:36:30.267 +03:00 [DBG] Closing data reader to 'GAC-BillingService' on server '.'.
2025-11-13 10:36:30.286 +03:00 [DBG] A data reader for 'GAC-BillingService' on server '.' is being disposed after spending 40ms reading results.
2025-11-13 10:36:30.296 +03:00 [DBG] Closing connection to database 'GAC-BillingService' on server '.'.
2025-11-13 10:36:30.315 +03:00 [DBG] Closed connection to database 'GAC-BillingService' on server '.' (18ms).
2025-11-13 10:36:30.589 +03:00 [WRN] You do not have a valid license key for the Lucky Penny software AutoMapper. This is allowed for development and testing scenarios. If you are running in production you are required to have a licensed version. Please visit https://luckypennysoftware.com to obtain a valid license.
2025-11-13 10:36:36.849 +03:00 [DBG] Opening connection to database 'GAC-BillingService' on server '.'.
2025-11-13 10:36:36.858 +03:00 [DBG] Opened connection to database 'GAC-BillingService' on server '.'.
2025-11-13 10:36:36.866 +03:00 [DBG] Beginning transaction with isolation level 'Unspecified'.
2025-11-13 10:36:36.881 +03:00 [DBG] Began transaction with isolation level 'ReadCommitted'.
2025-11-13 10:36:37.868 +03:00 [DBG] Compiling query expression: 
'DbSet<InvoiceSequenceValue>().FromSql(SELECT CAST(NEXT VALUE FOR dbo.InvoiceNumberSequence AS BIGINT) AS Value, __p_0)
    .AsNoTracking()
    .FirstOrDefault()'
2025-11-13 10:36:37.885 +03:00 [WRN] The query uses the 'First'/'FirstOrDefault' operator without 'OrderBy' and filter operators. This may lead to unpredictable results.
2025-11-13 10:36:37.939 +03:00 [DBG] Generated query execution expression: 
'queryContext => ShapedQueryCompilingExpressionVisitor.SingleOrDefaultAsync<InvoiceSequenceValue>(
    asyncEnumerable: SingleQueryingEnumerable.Create<InvoiceSequenceValue>(
        relationalQueryContext: (RelationalQueryContext)queryContext, 
        relationalCommandResolver: parameters => [LIFTABLE Constant: RelationalCommandCache.QueryExpression(
            Projection Mapping:
                EmptyProjectionMember -> Dictionary<IProperty, int> { [Property: InvoiceSequenceValue.Value (long) Required, 0] }
            SELECT TOP(1) b.Value
            FROM SELECT CAST(NEXT VALUE FOR dbo.InvoiceNumberSequence AS BIGINT) AS Value) | Resolver: c => new RelationalCommandCache(
            c.Dependencies.MemoryCache, 
            c.RelationalDependencies.QuerySqlGeneratorFactory, 
            c.RelationalDependencies.RelationalParameterBasedSqlProcessorFactory, 
            Projection Mapping:
                EmptyProjectionMember -> Dictionary<IProperty, int> { [Property: InvoiceSequenceValue.Value (long) Required, 0] }
            SELECT TOP(1) b.Value
            FROM SELECT CAST(NEXT VALUE FOR dbo.InvoiceNumberSequence AS BIGINT) AS Value, 
            False, 
            new HashSet<string>(
                new string[]{ }, 
                StringComparer.Ordinal
            )
        )].GetRelationalCommandTemplate(parameters), 
        readerColumns: null, 
        shaper: (queryContext, dataReader, resultContext, resultCoordinator) => 
        {
            InvoiceSequenceValue entity;
            entity = 
            {
                MaterializationContext materializationContext1;
                IEntityType entityType1;
                InvoiceSequenceValue instance1;
                materializationContext1 = new MaterializationContext(
                    [LIFTABLE Constant: ValueBuffer | Resolver: _ => (object)ValueBuffer.Empty], 
                    queryContext.Context
                );
                instance1 = default(InvoiceSequenceValue);
                {
                    ISnapshot shadowSnapshot1;
                    shadowSnapshot1 = [LIFTABLE Constant: Snapshot | Resolver: _ => Snapshot.Empty];
                    entityType1 = [LIFTABLE Constant: EntityType: InvoiceSequenceValue Keyless | Resolver: namelessParameter{0} => namelessParameter{0}.Dependencies.Model.FindEntityType("BillingSystem.Domain.Entities.InvoiceSequenceValue")];
                    instance1 = switch (entityType1)
                    {
                        case [LIFTABLE Constant: EntityType: InvoiceSequenceValue Keyless | Resolver: namelessParameter{1} => namelessParameter{1}.Dependencies.Model.FindEntityType("BillingSystem.Domain.Entities.InvoiceSequenceValue")]: 
                            {
                                return 
                                {
                                    InvoiceSequenceValue instance;
                                    instance = new InvoiceSequenceValue();
                                    instance.<Value>k__BackingField = dataReader.GetInt64(0);
                                    (instance is IInjectableService) ? ((IInjectableService)instance).Injected(
                                        context: materializationContext1.Context, 
                                        entity: instance, 
                                        queryTrackingBehavior: NoTracking, 
                                        structuralType: [LIFTABLE Constant: EntityType: InvoiceSequenceValue Keyless | Resolver: namelessParameter{2} => namelessParameter{2}.Dependencies.Model.FindEntityType("BillingSystem.Domain.Entities.InvoiceSequenceValue")]) : default(void);
                                    return instance;
                                }}
                        default: 
                            default(InvoiceSequenceValue)
                    }
                    ;
                    return instance1;
                }return instance1;
            };
            return entity;
        }, 
        contextType: BillingSystem.Infrastructure.EF.BillingServiceDBContext, 
        standAloneStateManager: False, 
        detailedErrorsEnabled: False, 
        threadSafetyChecksEnabled: True), 
    cancellationToken: queryContext.CancellationToken)'
2025-11-13 10:36:37.958 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-11-13 10:36:37.961 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (2ms).
2025-11-13 10:36:37.966 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (8ms).
2025-11-13 10:36:37.971 +03:00 [DBG] Executing DbCommand [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [b].[Value]
FROM (
    SELECT CAST(NEXT VALUE FOR dbo.InvoiceNumberSequence AS BIGINT) AS Value
) AS [b]
2025-11-13 10:36:38.013 +03:00 [ERR] Failed executing DbCommand (42ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [b].[Value]
FROM (
    SELECT CAST(NEXT VALUE FOR dbo.InvoiceNumberSequence AS BIGINT) AS Value
) AS [b]
2025-11-13 10:36:38.035 +03:00 [ERR] An exception occurred while iterating over the results of a query for context type 'BillingSystem.Infrastructure.EF.BillingServiceDBContext'.
Microsoft.Data.SqlClient.SqlException (0x80131904): NEXT VALUE FOR function is not allowed in check constraints, default objects, computed columns, views, user-defined functions, user-defined aggregates, user-defined table types, sub-queries, common table expressions, derived tables or return statements.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__211_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.InitializeReaderAsync(AsyncEnumerator enumerator, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()
ClientConnectionId:1b8f37f8-3754-4496-99e2-b3992b6c8f3c
Error Number:11719,State:1,Class:15
Microsoft.Data.SqlClient.SqlException (0x80131904): NEXT VALUE FOR function is not allowed in check constraints, default objects, computed columns, views, user-defined functions, user-defined aggregates, user-defined table types, sub-queries, common table expressions, derived tables or return statements.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__211_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.InitializeReaderAsync(AsyncEnumerator enumerator, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()
ClientConnectionId:1b8f37f8-3754-4496-99e2-b3992b6c8f3c
Error Number:11719,State:1,Class:15
2025-11-13 10:41:42.436 +03:00 [DBG] Registered model binder providers, in the following order: ["Microsoft.AspNetCore.Mvc.ModelBinding.Binders.BinderTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ServicesModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.BodyModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.HeaderModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FloatingPointTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.EnumTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.DateTimeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.SimpleTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.TryParseModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.CancellationTokenModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ByteArrayModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FormFileModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FormCollectionModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.KeyValuePairModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.DictionaryModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ArrayModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.CollectionModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ComplexObjectModelBinderProvider"]
2025-11-13 10:41:42.657 +03:00 [DBG] Hosting starting
2025-11-13 10:41:43.069 +03:00 [DBG] Starting bus instances: IBus
2025-11-13 10:41:43.083 +03:00 [DBG] Starting bus: "rabbitmq://localhost/"
2025-11-13 10:41:43.147 +03:00 [DBG] Middleware loaded
2025-11-13 10:41:43.158 +03:00 [DBG] Middleware loaded. Script /_framework/aspnetcore-browser-refresh.js (16519 B).
2025-11-13 10:41:43.167 +03:00 [DBG] Middleware loaded. Script /_framework/blazor-hotreload.js (799 B).
2025-11-13 10:41:43.191 +03:00 [DBG] Connect: guest@localhost:5672/
2025-11-13 10:41:43.428 +03:00 [DBG] Middleware loaded: DOTNET_MODIFIABLE_ASSEMBLIES=debug, __ASPNETCORE_BROWSER_TOOLS=true
2025-11-13 10:41:43.464 +03:00 [DBG] Connected: guest@localhost:5672/ (address: amqp://localhost:5672, local: 64507)
2025-11-13 10:41:43.541 +03:00 [DBG] Endpoint Ready: "rabbitmq://localhost/ECHGHANNAMLP1_BillingSystemAPI_bus_abfyyyyh3bcsywbsbdxnfnys8z?temporary=true"
2025-11-13 10:41:43.546 +03:00 [INF] Bus started: "rabbitmq://localhost/"
2025-11-13 10:41:43.778 +03:00 [INF] Now listening on: https://localhost:7257
2025-11-13 10:41:43.785 +03:00 [INF] Now listening on: http://localhost:5009
2025-11-13 10:41:43.790 +03:00 [DBG] Loaded hosting startup assembly BillingSystem.API
2025-11-13 10:41:43.794 +03:00 [DBG] Loaded hosting startup assembly Microsoft.WebTools.ApiEndpointDiscovery
2025-11-13 10:41:43.796 +03:00 [DBG] Loaded hosting startup assembly Microsoft.AspNetCore.Watch.BrowserRefresh
2025-11-13 10:41:43.799 +03:00 [DBG] Loaded hosting startup assembly Microsoft.WebTools.BrowserLink.Net
2025-11-13 10:41:43.926 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-11-13 10:41:43.932 +03:00 [INF] Hosting environment: Development
2025-11-13 10:41:43.938 +03:00 [INF] Content root path: C:\Repositories\Gac-BillingSystem\src\BillingSystem.API
2025-11-13 10:41:43.948 +03:00 [DBG] Hosting started
2025-11-13 10:41:44.167 +03:00 [DBG] Connection id "0HNH2H0BR583C" accepted.
2025-11-13 10:41:44.167 +03:00 [DBG] Connection id "0HNH2H0BR583B" accepted.
2025-11-13 10:41:44.173 +03:00 [DBG] Connection id "0HNH2H0BR583C" started.
2025-11-13 10:41:44.174 +03:00 [DBG] Connection id "0HNH2H0BR583B" started.
2025-11-13 10:41:44.181 +03:00 [DBG] Connection id "0HNH2H0BR583B" received FIN.
2025-11-13 10:41:44.181 +03:00 [DBG] Connection id "0HNH2H0BR583C" received FIN.
2025-11-13 10:41:44.205 +03:00 [DBG] Failed to authenticate HTTPS connection.
System.IO.IOException: Received an unexpected EOF or 0 bytes from the transport stream.
   at System.Net.Security.SslStream.ReceiveHandshakeFrameAsync[TIOAdapter](CancellationToken cancellationToken)
   at System.Net.Security.SslStream.ForceAuthenticationAsync[TIOAdapter](Boolean receiveFirst, Byte[] reAuthenticationData, CancellationToken cancellationToken)
   at System.Net.Security.SslStream.ProcessAuthenticationWithTelemetryAsync(Boolean isAsync, CancellationToken cancellationToken)
   at Microsoft.AspNetCore.Server.Kestrel.Https.Internal.HttpsConnectionMiddleware.OnConnectionAsync(ConnectionContext context)
2025-11-13 10:41:44.205 +03:00 [DBG] Failed to authenticate HTTPS connection.
System.IO.IOException: Received an unexpected EOF or 0 bytes from the transport stream.
   at System.Net.Security.SslStream.ReceiveHandshakeFrameAsync[TIOAdapter](CancellationToken cancellationToken)
   at System.Net.Security.SslStream.ForceAuthenticationAsync[TIOAdapter](Boolean receiveFirst, Byte[] reAuthenticationData, CancellationToken cancellationToken)
   at System.Net.Security.SslStream.ProcessAuthenticationWithTelemetryAsync(Boolean isAsync, CancellationToken cancellationToken)
   at Microsoft.AspNetCore.Server.Kestrel.Https.Internal.HttpsConnectionMiddleware.OnConnectionAsync(ConnectionContext context)
2025-11-13 10:41:44.239 +03:00 [DBG] Connection id "0HNH2H0BR583B" stopped.
2025-11-13 10:41:44.240 +03:00 [DBG] Connection id "0HNH2H0BR583C" stopped.
2025-11-13 10:41:44.253 +03:00 [DBG] Connection id "0HNH2H0BR583C" sending FIN because: "The Socket transport's send loop completed gracefully."
2025-11-13 10:41:44.253 +03:00 [DBG] Connection id "0HNH2H0BR583B" sending FIN because: "The Socket transport's send loop completed gracefully."
2025-11-13 10:41:44.731 +03:00 [DBG] Connection id "0HNH2H0BR583D" accepted.
2025-11-13 10:41:44.734 +03:00 [DBG] Connection id "0HNH2H0BR583D" started.
2025-11-13 10:41:44.800 +03:00 [DBG] Connection 0HNH2H0BR583D established using the following protocol: "Tls13"
2025-11-13 10:41:44.880 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7257/swagger/index.html - null null
2025-11-13 10:41:44.939 +03:00 [DBG] Wildcard detected, all requests with hosts will be allowed.
2025-11-13 10:41:44.963 +03:00 [DBG] No candidates found for the request path '/swagger/index.html'
2025-11-13 10:41:44.966 +03:00 [DBG] Request did not match any endpoints
2025-11-13 10:41:45.039 +03:00 [DBG] Response markup is scheduled to include Browser Link script injection.
2025-11-13 10:41:45.046 +03:00 [DBG] Response markup is scheduled to include browser refresh script injection.
2025-11-13 10:41:45.081 +03:00 [INF] HTTP GET /swagger/index.html responded 200 in 104.3872 ms
2025-11-13 10:41:45.092 +03:00 [DBG] Response markup was updated to include Browser Link script injection.
2025-11-13 10:41:45.097 +03:00 [DBG] Response markup was updated to include browser refresh script injection.
2025-11-13 10:41:45.105 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7257/swagger/index.html - 200 null text/html;charset=utf-8 236.9784ms
2025-11-13 10:41:45.170 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7257/_framework/aspnetcore-browser-refresh.js - null null
2025-11-13 10:41:45.170 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7257/_vs/browserLink - null null
2025-11-13 10:41:45.185 +03:00 [DBG] Script injected: /_framework/aspnetcore-browser-refresh.js
2025-11-13 10:41:45.190 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7257/_framework/aspnetcore-browser-refresh.js - 200 16519 application/javascript; charset=utf-8 21.2261ms
2025-11-13 10:41:45.241 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7257/_vs/browserLink - 200 null text/javascript; charset=UTF-8 71.0401ms
2025-11-13 10:41:45.311 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7257/swagger/v1/swagger.json - null null
2025-11-13 10:41:45.319 +03:00 [DBG] No candidates found for the request path '/swagger/v1/swagger.json'
2025-11-13 10:41:45.322 +03:00 [DBG] Request did not match any endpoints
2025-11-13 10:41:45.344 +03:00 [INF] HTTP GET /swagger/v1/swagger.json responded 200 in 16.7985 ms
2025-11-13 10:41:45.351 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7257/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 40.2234ms
2025-11-13 10:41:49.083 +03:00 [DBG] Connection id "0HNH2H0BR583E" accepted.
2025-11-13 10:41:49.084 +03:00 [DBG] Connection id "0HNH2H0BR583E" received FIN.
2025-11-13 10:41:49.088 +03:00 [DBG] Connection id "0HNH2H0BR583E" started.
2025-11-13 10:41:49.089 +03:00 [DBG] Connection id "0HNH2H0BR583F" accepted.
2025-11-13 10:41:49.095 +03:00 [DBG] Failed to authenticate HTTPS connection.
System.IO.IOException: Received an unexpected EOF or 0 bytes from the transport stream.
   at System.Net.Security.SslStream.ReceiveHandshakeFrameAsync[TIOAdapter](CancellationToken cancellationToken)
   at System.Net.Security.SslStream.ForceAuthenticationAsync[TIOAdapter](Boolean receiveFirst, Byte[] reAuthenticationData, CancellationToken cancellationToken)
   at System.Net.Security.SslStream.ProcessAuthenticationWithTelemetryAsync(Boolean isAsync, CancellationToken cancellationToken)
   at Microsoft.AspNetCore.Server.Kestrel.Https.Internal.HttpsConnectionMiddleware.OnConnectionAsync(ConnectionContext context)
2025-11-13 10:41:49.097 +03:00 [DBG] Connection id "0HNH2H0BR583F" started.
2025-11-13 10:41:49.101 +03:00 [DBG] Connection id "0HNH2H0BR583E" stopped.
2025-11-13 10:41:49.106 +03:00 [DBG] Connection id "0HNH2H0BR583E" sending FIN because: "The Socket transport's send loop completed gracefully."
2025-11-13 10:41:49.110 +03:00 [DBG] Connection 0HNH2H0BR583F established using the following protocol: "Tls13"
2025-11-13 10:41:49.118 +03:00 [INF] Request starting HTTP/1.1 POST https://localhost:7257/api/Invoices - application/json 1317
2025-11-13 10:41:49.127 +03:00 [DBG] 1 candidate(s) found for the request path '/api/Invoices'
2025-11-13 10:41:49.133 +03:00 [DBG] Endpoint 'BillingSystem.API.Controllers.InvoicesController.Post (BillingSystem.API)' with route pattern 'api/Invoices' is valid for the request path '/api/Invoices'
2025-11-13 10:41:49.140 +03:00 [DBG] Request matched endpoint 'BillingSystem.API.Controllers.InvoicesController.Post (BillingSystem.API)'
2025-11-13 10:41:49.147 +03:00 [DBG] Static files was skipped as the request already matched an endpoint.
2025-11-13 10:41:49.345 +03:00 [DBG] An 'IServiceProvider' was created for internal use by Entity Framework.
2025-11-13 10:41:54.862 +03:00 [INF] Executing endpoint 'BillingSystem.API.Controllers.InvoicesController.Post (BillingSystem.API)'
2025-11-13 10:41:54.918 +03:00 [INF] Route matched with {action = "Post", controller = "Invoices"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Post(BillingSystem.Application.Requests.CreateInvoiceRequest) on controller BillingSystem.API.Controllers.InvoicesController (BillingSystem.API).
2025-11-13 10:41:54.927 +03:00 [DBG] Execution plan of authorization filters (in the following order): ["None"]
2025-11-13 10:41:54.932 +03:00 [DBG] Execution plan of resource filters (in the following order): ["None"]
2025-11-13 10:41:54.936 +03:00 [DBG] Execution plan of action filters (in the following order): ["Microsoft.AspNetCore.Mvc.ModelBinding.UnsupportedContentTypeFilter (Order: -3000)","Microsoft.AspNetCore.Mvc.Infrastructure.ModelStateInvalidFilter (Order: -2000)","BillingSystem.API.ActionFilters.AuditBillingRequestsFilter","BillingSystem.API.ActionFilters.IdempotencyFilter (Order: 0)"]
2025-11-13 10:41:54.943 +03:00 [DBG] Execution plan of exception filters (in the following order): ["None"]
2025-11-13 10:41:54.947 +03:00 [DBG] Execution plan of result filters (in the following order): ["Microsoft.AspNetCore.Mvc.Infrastructure.ClientErrorResultFilter (Order: -2000)","Microsoft.AspNetCore.Mvc.ProducesAttribute (Order: 0)","BillingSystem.API.ActionFilters.IdempotencyFilter (Order: 0)"]
2025-11-13 10:41:54.958 +03:00 [DBG] Executing controller factory for controller BillingSystem.API.Controllers.InvoicesController (BillingSystem.API)
2025-11-13 10:41:54.968 +03:00 [WRN] You do not have a valid license key for the Lucky Penny software MediatR. This is allowed for development and testing scenarios. If you are running in production you are required to have a licensed version. Please visit https://luckypennysoftware.com to obtain a valid license.
2025-11-13 10:41:55.026 +03:00 [DBG] Executed controller factory for controller BillingSystem.API.Controllers.InvoicesController (BillingSystem.API)
2025-11-13 10:41:55.052 +03:00 [DBG] Attempting to bind parameter 'invoiceRequest' of type 'BillingSystem.Application.Requests.CreateInvoiceRequest' ...
2025-11-13 10:41:55.062 +03:00 [DBG] Attempting to bind parameter 'invoiceRequest' of type 'BillingSystem.Application.Requests.CreateInvoiceRequest' using the name '' in request data ...
2025-11-13 10:41:55.068 +03:00 [DBG] Selected input formatter 'Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonInputFormatter' for content type 'application/json'.
2025-11-13 10:41:55.127 +03:00 [DBG] Connection id "0HNH2H0BR583F", Request id "0HNH2H0BR583F:00000001": started reading request body.
2025-11-13 10:41:55.133 +03:00 [DBG] Connection id "0HNH2H0BR583F", Request id "0HNH2H0BR583F:00000001": done reading request body.
2025-11-13 10:41:55.171 +03:00 [DBG] JSON input formatter succeeded, deserializing to type 'BillingSystem.Application.Requests.CreateInvoiceRequest'
2025-11-13 10:41:55.176 +03:00 [DBG] Done attempting to bind parameter 'invoiceRequest' of type 'BillingSystem.Application.Requests.CreateInvoiceRequest'.
2025-11-13 10:41:55.179 +03:00 [DBG] Done attempting to bind parameter 'invoiceRequest' of type 'BillingSystem.Application.Requests.CreateInvoiceRequest'.
2025-11-13 10:41:55.182 +03:00 [DBG] Attempting to validate the bound parameter 'invoiceRequest' of type 'BillingSystem.Application.Requests.CreateInvoiceRequest' ...
2025-11-13 10:41:55.213 +03:00 [DBG] Done attempting to validate the bound parameter 'invoiceRequest' of type 'BillingSystem.Application.Requests.CreateInvoiceRequest'.
2025-11-13 10:41:55.545 +03:00 [DBG] No relationship from 'Invoice' to 'Invoice' has been configured by convention because there are multiple properties on one entity type - {'DiscountedPrimaryInvoice'} that could be matched with the properties on the other entity type - {'InverseDiscountedPrimaryInvoice', 'InversePrimaryInvoice', 'InverseSubstitutionPrimaryInvoice', 'PrimaryInvoice', 'SubstitutionPrimaryInvoice'}. This message can be disregarded if explicit configuration has been specified in 'OnModelCreating'.
2025-11-13 10:41:55.818 +03:00 [DBG] No relationship from 'Invoice' to 'Invoice' has been configured by convention because there are multiple properties on one entity type - {'DiscountedPrimaryInvoice'} that could be matched with the properties on the other entity type - {'InverseDiscountedPrimaryInvoice', 'InversePrimaryInvoice', 'InverseSubstitutionPrimaryInvoice', 'PrimaryInvoice', 'SubstitutionPrimaryInvoice'}. This message can be disregarded if explicit configuration has been specified in 'OnModelCreating'.
2025-11-13 10:41:55.835 +03:00 [DBG] No relationship from 'Invoice' to 'Invoice' has been configured by convention because there are multiple properties on one entity type - {'InversePrimaryInvoice'} that could be matched with the properties on the other entity type - {'InverseSubstitutionPrimaryInvoice', 'PrimaryInvoice', 'SubstitutionPrimaryInvoice'}. This message can be disregarded if explicit configuration has been specified in 'OnModelCreating'.
2025-11-13 10:41:55.850 +03:00 [DBG] No relationship from 'Invoice' to 'Invoice' has been configured by convention because there are multiple properties on one entity type - {'InversePrimaryInvoice'} that could be matched with the properties on the other entity type - {'InverseSubstitutionPrimaryInvoice', 'PrimaryInvoice', 'SubstitutionPrimaryInvoice'}. This message can be disregarded if explicit configuration has been specified in 'OnModelCreating'.
2025-11-13 10:41:56.257 +03:00 [DBG] Entity Framework Core 9.0.9 initialized 'BillingServiceDBContext' using provider 'Microsoft.EntityFrameworkCore.SqlServer:9.0.9' with options: EngineType=SqlServer 
2025-11-13 10:41:56.401 +03:00 [DBG] Compiling query expression: 
'DbSet<Invoice>()
    .AsNoTracking()
    .Any(inv => inv.ExternalId.ToString() == __idempotentKey_0)'
2025-11-13 10:41:56.711 +03:00 [DBG] Generated query execution expression: 
'queryContext => ShapedQueryCompilingExpressionVisitor.SingleAsync<bool>(
    asyncEnumerable: SingleQueryingEnumerable.Create<bool>(
        relationalQueryContext: (RelationalQueryContext)queryContext, 
        relationalCommandResolver: parameters => [LIFTABLE Constant: RelationalCommandCache.QueryExpression(
            Projection Mapping:
                EmptyProjectionMember -> 0
            SELECT EXISTS (
                SELECT 1
                FROM Invoices AS i
                WHERE COALESCE(CONVERT(varchar(36), i.ExternalId), '') == @__idempotentKey_0)) | Resolver: c => new RelationalCommandCache(
            c.Dependencies.MemoryCache, 
            c.RelationalDependencies.QuerySqlGeneratorFactory, 
            c.RelationalDependencies.RelationalParameterBasedSqlProcessorFactory, 
            Projection Mapping:
                EmptyProjectionMember -> 0
            SELECT EXISTS (
                SELECT 1
                FROM Invoices AS i
                WHERE COALESCE(CONVERT(varchar(36), i.ExternalId), '') == @__idempotentKey_0), 
            False, 
            new HashSet<string>(
                new string[]{ }, 
                StringComparer.Ordinal
            )
        )].GetRelationalCommandTemplate(parameters), 
        readerColumns: null, 
        shaper: (queryContext, dataReader, resultContext, resultCoordinator) => 
        {
            bool? value1;
            value1 = dataReader.IsDBNull(0) ? default(bool?) : (bool?)dataReader.GetBoolean(0);
            return (bool)value1;
        }, 
        contextType: BillingSystem.Infrastructure.EF.BillingServiceDBContext, 
        standAloneStateManager: False, 
        detailedErrorsEnabled: False, 
        threadSafetyChecksEnabled: True), 
    cancellationToken: queryContext.CancellationToken)'
2025-11-13 10:41:56.766 +03:00 [DBG] Creating DbConnection.
2025-11-13 10:41:56.791 +03:00 [DBG] Created DbConnection. (23ms).
2025-11-13 10:41:56.801 +03:00 [DBG] Opening connection to database 'GAC-BillingService' on server '.'.
2025-11-13 10:41:57.178 +03:00 [DBG] Opened connection to database 'GAC-BillingService' on server '.'.
2025-11-13 10:41:57.187 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-11-13 10:41:57.202 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (9ms).
2025-11-13 10:41:57.225 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (37ms).
2025-11-13 10:41:57.245 +03:00 [DBG] Executing DbCommand [Parameters=[@__idempotentKey_0='?' (Size = 36) (DbType = AnsiString)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [Invoices] AS [i]
        WHERE CONVERT(varchar(36), [i].[ExternalId]) = @__idempotentKey_0) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2025-11-13 10:41:57.351 +03:00 [INF] Executed DbCommand (108ms) [Parameters=[@__idempotentKey_0='?' (Size = 36) (DbType = AnsiString)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [Invoices] AS [i]
        WHERE CONVERT(varchar(36), [i].[ExternalId]) = @__idempotentKey_0) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2025-11-13 10:41:57.395 +03:00 [DBG] Closing data reader to 'GAC-BillingService' on server '.'.
2025-11-13 10:41:57.417 +03:00 [DBG] A data reader for 'GAC-BillingService' on server '.' is being disposed after spending 44ms reading results.
2025-11-13 10:41:57.432 +03:00 [DBG] Closing connection to database 'GAC-BillingService' on server '.'.
2025-11-13 10:41:57.450 +03:00 [DBG] Closed connection to database 'GAC-BillingService' on server '.' (18ms).
2025-11-13 10:41:57.683 +03:00 [WRN] You do not have a valid license key for the Lucky Penny software AutoMapper. This is allowed for development and testing scenarios. If you are running in production you are required to have a licensed version. Please visit https://luckypennysoftware.com to obtain a valid license.
2025-11-13 10:41:59.997 +03:00 [DBG] Opening connection to database 'GAC-BillingService' on server '.'.
2025-11-13 10:42:00.003 +03:00 [DBG] Opened connection to database 'GAC-BillingService' on server '.'.
2025-11-13 10:42:00.013 +03:00 [DBG] Beginning transaction with isolation level 'Unspecified'.
2025-11-13 10:42:00.033 +03:00 [DBG] Began transaction with isolation level 'ReadCommitted'.
2025-11-13 10:42:01.058 +03:00 [DBG] Compiling query expression: 
'DbSet<InvoiceSequenceValue>().FromSql(EXECUTE dbo.GetNextInvoiceNumber, __p_0)
    .AsNoTracking()
    .FirstOrDefault()'
2025-11-13 10:42:01.075 +03:00 [WRN] The query uses the 'First'/'FirstOrDefault' operator without 'OrderBy' and filter operators. This may lead to unpredictable results.
2025-11-13 10:42:01.123 +03:00 [DBG] Generated query execution expression: 
'queryContext => ShapedQueryCompilingExpressionVisitor.SingleOrDefaultAsync<InvoiceSequenceValue>(
    asyncEnumerable: SingleQueryingEnumerable.Create<InvoiceSequenceValue>(
        relationalQueryContext: (RelationalQueryContext)queryContext, 
        relationalCommandResolver: parameters => [LIFTABLE Constant: RelationalCommandCache.QueryExpression(
            Projection Mapping:
                EmptyProjectionMember -> Dictionary<IProperty, int> { [Property: InvoiceSequenceValue.Value (long) Required, 0] }
            SELECT TOP(1) b.Value
            FROM EXECUTE dbo.GetNextInvoiceNumber) | Resolver: c => new RelationalCommandCache(
            c.Dependencies.MemoryCache, 
            c.RelationalDependencies.QuerySqlGeneratorFactory, 
            c.RelationalDependencies.RelationalParameterBasedSqlProcessorFactory, 
            Projection Mapping:
                EmptyProjectionMember -> Dictionary<IProperty, int> { [Property: InvoiceSequenceValue.Value (long) Required, 0] }
            SELECT TOP(1) b.Value
            FROM EXECUTE dbo.GetNextInvoiceNumber, 
            False, 
            new HashSet<string>(
                new string[]{ }, 
                StringComparer.Ordinal
            )
        )].GetRelationalCommandTemplate(parameters), 
        readerColumns: null, 
        shaper: (queryContext, dataReader, resultContext, resultCoordinator) => 
        {
            InvoiceSequenceValue entity;
            entity = 
            {
                MaterializationContext materializationContext1;
                IEntityType entityType1;
                InvoiceSequenceValue instance1;
                materializationContext1 = new MaterializationContext(
                    [LIFTABLE Constant: ValueBuffer | Resolver: _ => (object)ValueBuffer.Empty], 
                    queryContext.Context
                );
                instance1 = default(InvoiceSequenceValue);
                {
                    ISnapshot shadowSnapshot1;
                    shadowSnapshot1 = [LIFTABLE Constant: Snapshot | Resolver: _ => Snapshot.Empty];
                    entityType1 = [LIFTABLE Constant: EntityType: InvoiceSequenceValue Keyless | Resolver: namelessParameter{0} => namelessParameter{0}.Dependencies.Model.FindEntityType("BillingSystem.Domain.Entities.InvoiceSequenceValue")];
                    instance1 = switch (entityType1)
                    {
                        case [LIFTABLE Constant: EntityType: InvoiceSequenceValue Keyless | Resolver: namelessParameter{1} => namelessParameter{1}.Dependencies.Model.FindEntityType("BillingSystem.Domain.Entities.InvoiceSequenceValue")]: 
                            {
                                return 
                                {
                                    InvoiceSequenceValue instance;
                                    instance = new InvoiceSequenceValue();
                                    instance.<Value>k__BackingField = dataReader.GetInt64(0);
                                    (instance is IInjectableService) ? ((IInjectableService)instance).Injected(
                                        context: materializationContext1.Context, 
                                        entity: instance, 
                                        queryTrackingBehavior: NoTracking, 
                                        structuralType: [LIFTABLE Constant: EntityType: InvoiceSequenceValue Keyless | Resolver: namelessParameter{2} => namelessParameter{2}.Dependencies.Model.FindEntityType("BillingSystem.Domain.Entities.InvoiceSequenceValue")]) : default(void);
                                    return instance;
                                }}
                        default: 
                            default(InvoiceSequenceValue)
                    }
                    ;
                    return instance1;
                }return instance1;
            };
            return entity;
        }, 
        contextType: BillingSystem.Infrastructure.EF.BillingServiceDBContext, 
        standAloneStateManager: False, 
        detailedErrorsEnabled: False, 
        threadSafetyChecksEnabled: True), 
    cancellationToken: queryContext.CancellationToken)'
2025-11-13 10:42:01.143 +03:00 [ERR] An exception occurred while iterating over the results of a query for context type 'BillingSystem.Infrastructure.EF.BillingServiceDBContext'.
System.InvalidOperationException: 'FromSql' or 'SqlQuery' was called with non-composable SQL and with a query composing over it. Consider calling 'AsEnumerable' after the method to perform the composition on the client side.
   at Microsoft.EntityFrameworkCore.Query.QuerySqlGenerator.CheckComposableSqlTrimmed(ReadOnlySpan`1 sql)
   at Microsoft.EntityFrameworkCore.SqlServer.Query.Internal.SqlServerQuerySqlGenerator.CheckComposableSqlTrimmed(ReadOnlySpan`1 sql)
   at Microsoft.EntityFrameworkCore.Query.QuerySqlGenerator.CheckComposableSql(String sql)
   at Microsoft.EntityFrameworkCore.Query.QuerySqlGenerator.VisitFromSql(FromSqlExpression fromSqlExpression)
   at Microsoft.EntityFrameworkCore.Query.SqlExpressionVisitor.VisitExtension(Expression extensionExpression)
   at Microsoft.EntityFrameworkCore.SqlServer.Query.Internal.SqlServerQuerySqlGenerator.VisitExtension(Expression extensionExpression)
   at Microsoft.EntityFrameworkCore.Query.QuerySqlGenerator.<GenerateFrom>b__51_0(TableExpressionBase e)
   at Microsoft.EntityFrameworkCore.Query.QuerySqlGenerator.GenerateList[T](IReadOnlyList`1 items, Action`1 generationAction, Action`1 joinAction)
   at Microsoft.EntityFrameworkCore.Query.QuerySqlGenerator.GenerateFrom(SelectExpression selectExpression)
   at Microsoft.EntityFrameworkCore.SqlServer.Query.Internal.SqlServerQuerySqlGenerator.GenerateFrom(SelectExpression selectExpression)
   at Microsoft.EntityFrameworkCore.Query.QuerySqlGenerator.VisitSelect(SelectExpression selectExpression)
   at Microsoft.EntityFrameworkCore.SqlServer.Query.Internal.SqlServerQuerySqlGenerator.VisitSelect(SelectExpression selectExpression)
   at Microsoft.EntityFrameworkCore.Query.QuerySqlGenerator.GenerateRootCommand(Expression queryExpression)
   at Microsoft.EntityFrameworkCore.Query.QuerySqlGenerator.GetCommand(Expression queryExpression)
   at Microsoft.EntityFrameworkCore.Query.Internal.RelationalCommandCache.GetRelationalCommandTemplate(IReadOnlyDictionary`2 parameters)
   at Microsoft.EntityFrameworkCore.Internal.RelationalCommandResolverExtensions.RentAndPopulateRelationalCommand(RelationalCommandResolver relationalCommandResolver, RelationalQueryContext queryContext)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.InitializeReaderAsync(AsyncEnumerator enumerator, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()
System.InvalidOperationException: 'FromSql' or 'SqlQuery' was called with non-composable SQL and with a query composing over it. Consider calling 'AsEnumerable' after the method to perform the composition on the client side.
   at Microsoft.EntityFrameworkCore.Query.QuerySqlGenerator.CheckComposableSqlTrimmed(ReadOnlySpan`1 sql)
   at Microsoft.EntityFrameworkCore.SqlServer.Query.Internal.SqlServerQuerySqlGenerator.CheckComposableSqlTrimmed(ReadOnlySpan`1 sql)
   at Microsoft.EntityFrameworkCore.Query.QuerySqlGenerator.CheckComposableSql(String sql)
   at Microsoft.EntityFrameworkCore.Query.QuerySqlGenerator.VisitFromSql(FromSqlExpression fromSqlExpression)
   at Microsoft.EntityFrameworkCore.Query.SqlExpressionVisitor.VisitExtension(Expression extensionExpression)
   at Microsoft.EntityFrameworkCore.SqlServer.Query.Internal.SqlServerQuerySqlGenerator.VisitExtension(Expression extensionExpression)
   at Microsoft.EntityFrameworkCore.Query.QuerySqlGenerator.<GenerateFrom>b__51_0(TableExpressionBase e)
   at Microsoft.EntityFrameworkCore.Query.QuerySqlGenerator.GenerateList[T](IReadOnlyList`1 items, Action`1 generationAction, Action`1 joinAction)
   at Microsoft.EntityFrameworkCore.Query.QuerySqlGenerator.GenerateFrom(SelectExpression selectExpression)
   at Microsoft.EntityFrameworkCore.SqlServer.Query.Internal.SqlServerQuerySqlGenerator.GenerateFrom(SelectExpression selectExpression)
   at Microsoft.EntityFrameworkCore.Query.QuerySqlGenerator.VisitSelect(SelectExpression selectExpression)
   at Microsoft.EntityFrameworkCore.SqlServer.Query.Internal.SqlServerQuerySqlGenerator.VisitSelect(SelectExpression selectExpression)
   at Microsoft.EntityFrameworkCore.Query.QuerySqlGenerator.GenerateRootCommand(Expression queryExpression)
   at Microsoft.EntityFrameworkCore.Query.QuerySqlGenerator.GetCommand(Expression queryExpression)
   at Microsoft.EntityFrameworkCore.Query.Internal.RelationalCommandCache.GetRelationalCommandTemplate(IReadOnlyDictionary`2 parameters)
   at Microsoft.EntityFrameworkCore.Internal.RelationalCommandResolverExtensions.RentAndPopulateRelationalCommand(RelationalCommandResolver relationalCommandResolver, RelationalQueryContext queryContext)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.InitializeReaderAsync(AsyncEnumerator enumerator, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()
2025-11-13 10:46:06.578 +03:00 [DBG] Registered model binder providers, in the following order: ["Microsoft.AspNetCore.Mvc.ModelBinding.Binders.BinderTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ServicesModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.BodyModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.HeaderModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FloatingPointTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.EnumTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.DateTimeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.SimpleTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.TryParseModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.CancellationTokenModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ByteArrayModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FormFileModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FormCollectionModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.KeyValuePairModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.DictionaryModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ArrayModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.CollectionModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ComplexObjectModelBinderProvider"]
2025-11-13 10:46:06.804 +03:00 [DBG] Hosting starting
2025-11-13 10:46:07.183 +03:00 [DBG] Starting bus instances: IBus
2025-11-13 10:46:07.190 +03:00 [DBG] Starting bus: "rabbitmq://localhost/"
2025-11-13 10:46:07.219 +03:00 [DBG] Middleware loaded
2025-11-13 10:46:07.226 +03:00 [DBG] Middleware loaded. Script /_framework/aspnetcore-browser-refresh.js (16519 B).
2025-11-13 10:46:07.240 +03:00 [DBG] Middleware loaded. Script /_framework/blazor-hotreload.js (799 B).
2025-11-13 10:46:07.245 +03:00 [DBG] Connect: guest@localhost:5672/
2025-11-13 10:46:07.402 +03:00 [DBG] Middleware loaded: DOTNET_MODIFIABLE_ASSEMBLIES=debug, __ASPNETCORE_BROWSER_TOOLS=true
2025-11-13 10:46:07.426 +03:00 [DBG] Connected: guest@localhost:5672/ (address: amqp://localhost:5672, local: 63250)
2025-11-13 10:46:07.475 +03:00 [DBG] Endpoint Ready: "rabbitmq://localhost/ECHGHANNAMLP1_BillingSystemAPI_bus_pozoyyyh3bcsbteabdxnfnfwdk?temporary=true"
2025-11-13 10:46:07.478 +03:00 [INF] Bus started: "rabbitmq://localhost/"
2025-11-13 10:46:07.673 +03:00 [INF] Now listening on: https://localhost:7257
2025-11-13 10:46:07.678 +03:00 [INF] Now listening on: http://localhost:5009
2025-11-13 10:46:07.681 +03:00 [DBG] Loaded hosting startup assembly BillingSystem.API
2025-11-13 10:46:07.685 +03:00 [DBG] Loaded hosting startup assembly Microsoft.WebTools.ApiEndpointDiscovery
2025-11-13 10:46:07.690 +03:00 [DBG] Loaded hosting startup assembly Microsoft.AspNetCore.Watch.BrowserRefresh
2025-11-13 10:46:07.692 +03:00 [DBG] Loaded hosting startup assembly Microsoft.WebTools.BrowserLink.Net
2025-11-13 10:46:07.738 +03:00 [DBG] Connection id "0HNH2H2QCOJM7" reset.
2025-11-13 10:46:07.739 +03:00 [DBG] Connection id "0HNH2H2QCOJM8" received FIN.
2025-11-13 10:46:07.741 +03:00 [DBG] Connection id "0HNH2H2QCOJM8" accepted.
2025-11-13 10:46:07.750 +03:00 [DBG] Connection id "0HNH2H2QCOJM7" accepted.
2025-11-13 10:46:07.762 +03:00 [DBG] Connection id "0HNH2H2QCOJM8" started.
2025-11-13 10:46:07.763 +03:00 [DBG] Connection id "0HNH2H2QCOJM7" started.
2025-11-13 10:46:07.796 +03:00 [DBG] Failed to authenticate HTTPS connection.
Microsoft.AspNetCore.Connections.ConnectionResetException: An existing connection was forcibly closed by the remote host.
 ---> System.Net.Sockets.SocketException (10054): An existing connection was forcibly closed by the remote host.
   --- End of inner exception stack trace ---
   at System.IO.Pipelines.Pipe.GetReadResult(ReadResult& result)
   at System.IO.Pipelines.Pipe.ReadAsync(CancellationToken token)
   at System.IO.Pipelines.Pipe.DefaultPipeReader.ReadAsync(CancellationToken cancellationToken)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.DuplexPipeStream.ReadAsyncInternal(Memory`1 destination, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Net.Security.SslStream.EnsureFullTlsFrameAsync[TIOAdapter](CancellationToken cancellationToken, Int32 estimatedSize)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Net.Security.SslStream.ReceiveHandshakeFrameAsync[TIOAdapter](CancellationToken cancellationToken)
   at System.Net.Security.SslStream.ForceAuthenticationAsync[TIOAdapter](Boolean receiveFirst, Byte[] reAuthenticationData, CancellationToken cancellationToken)
   at System.Net.Security.SslStream.ProcessAuthenticationWithTelemetryAsync(Boolean isAsync, CancellationToken cancellationToken)
   at Microsoft.AspNetCore.Server.Kestrel.Https.Internal.HttpsConnectionMiddleware.OnConnectionAsync(ConnectionContext context)
2025-11-13 10:46:07.796 +03:00 [DBG] Failed to authenticate HTTPS connection.
System.IO.IOException: Received an unexpected EOF or 0 bytes from the transport stream.
   at System.Net.Security.SslStream.ReceiveHandshakeFrameAsync[TIOAdapter](CancellationToken cancellationToken)
   at System.Net.Security.SslStream.ForceAuthenticationAsync[TIOAdapter](Boolean receiveFirst, Byte[] reAuthenticationData, CancellationToken cancellationToken)
   at System.Net.Security.SslStream.ProcessAuthenticationWithTelemetryAsync(Boolean isAsync, CancellationToken cancellationToken)
   at Microsoft.AspNetCore.Server.Kestrel.Https.Internal.HttpsConnectionMiddleware.OnConnectionAsync(ConnectionContext context)
2025-11-13 10:46:07.837 +03:00 [DBG] Connection id "0HNH2H2QCOJM7" stopped.
2025-11-13 10:46:07.839 +03:00 [DBG] Connection id "0HNH2H2QCOJM8" stopped.
2025-11-13 10:46:07.853 +03:00 [DBG] Connection id "0HNH2H2QCOJM7" sending FIN because: "The Socket transport's send loop completed gracefully."
2025-11-13 10:46:07.853 +03:00 [DBG] Connection id "0HNH2H2QCOJM8" sending FIN because: "The Socket transport's send loop completed gracefully."
2025-11-13 10:46:07.899 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-11-13 10:46:07.904 +03:00 [INF] Hosting environment: Development
2025-11-13 10:46:07.908 +03:00 [INF] Content root path: C:\Repositories\Gac-BillingSystem\src\BillingSystem.API
2025-11-13 10:46:07.912 +03:00 [DBG] Hosting started
2025-11-13 10:46:08.336 +03:00 [DBG] Connection id "0HNH2H2QCOJM9" accepted.
2025-11-13 10:46:08.339 +03:00 [DBG] Connection id "0HNH2H2QCOJM9" started.
2025-11-13 10:46:08.423 +03:00 [DBG] Connection 0HNH2H2QCOJM9 established using the following protocol: "Tls13"
2025-11-13 10:46:08.510 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7257/swagger/index.html - null null
2025-11-13 10:46:08.570 +03:00 [DBG] Wildcard detected, all requests with hosts will be allowed.
2025-11-13 10:46:08.597 +03:00 [DBG] No candidates found for the request path '/swagger/index.html'
2025-11-13 10:46:08.600 +03:00 [DBG] Request did not match any endpoints
2025-11-13 10:46:08.665 +03:00 [DBG] Response markup is scheduled to include Browser Link script injection.
2025-11-13 10:46:08.670 +03:00 [DBG] Response markup is scheduled to include browser refresh script injection.
2025-11-13 10:46:08.698 +03:00 [INF] HTTP GET /swagger/index.html responded 200 in 88.9029 ms
2025-11-13 10:46:08.706 +03:00 [DBG] Response markup was updated to include Browser Link script injection.
2025-11-13 10:46:08.710 +03:00 [DBG] Response markup was updated to include browser refresh script injection.
2025-11-13 10:46:08.717 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7257/swagger/index.html - 200 null text/html;charset=utf-8 218.6287ms
2025-11-13 10:46:08.724 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7257/_framework/aspnetcore-browser-refresh.js - null null
2025-11-13 10:46:08.740 +03:00 [DBG] Script injected: /_framework/aspnetcore-browser-refresh.js
2025-11-13 10:46:08.744 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7257/_framework/aspnetcore-browser-refresh.js - 200 16519 application/javascript; charset=utf-8 20.2172ms
2025-11-13 10:46:08.772 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7257/_vs/browserLink - null null
2025-11-13 10:46:08.838 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7257/_vs/browserLink - 200 null text/javascript; charset=UTF-8 66.3157ms
2025-11-13 10:46:08.926 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7257/swagger/v1/swagger.json - null null
2025-11-13 10:46:08.935 +03:00 [DBG] No candidates found for the request path '/swagger/v1/swagger.json'
2025-11-13 10:46:08.939 +03:00 [DBG] Request did not match any endpoints
2025-11-13 10:46:08.967 +03:00 [INF] HTTP GET /swagger/v1/swagger.json responded 200 in 20.4243 ms
2025-11-13 10:46:08.977 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7257/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 50.9733ms
2025-11-13 10:46:13.852 +03:00 [DBG] Connection id "0HNH2H2QCOJMA" accepted.
2025-11-13 10:46:13.852 +03:00 [DBG] Connection id "0HNH2H2QCOJMA" received FIN.
2025-11-13 10:46:13.855 +03:00 [DBG] Connection id "0HNH2H2QCOJMA" started.
2025-11-13 10:46:13.857 +03:00 [DBG] Connection id "0HNH2H2QCOJMB" accepted.
2025-11-13 10:46:13.862 +03:00 [DBG] Failed to authenticate HTTPS connection.
System.IO.IOException: Received an unexpected EOF or 0 bytes from the transport stream.
   at System.Net.Security.SslStream.ReceiveHandshakeFrameAsync[TIOAdapter](CancellationToken cancellationToken)
   at System.Net.Security.SslStream.ForceAuthenticationAsync[TIOAdapter](Boolean receiveFirst, Byte[] reAuthenticationData, CancellationToken cancellationToken)
   at System.Net.Security.SslStream.ProcessAuthenticationWithTelemetryAsync(Boolean isAsync, CancellationToken cancellationToken)
   at Microsoft.AspNetCore.Server.Kestrel.Https.Internal.HttpsConnectionMiddleware.OnConnectionAsync(ConnectionContext context)
2025-11-13 10:46:13.863 +03:00 [DBG] Connection id "0HNH2H2QCOJMB" started.
2025-11-13 10:46:13.872 +03:00 [DBG] Connection id "0HNH2H2QCOJMA" stopped.
2025-11-13 10:46:13.883 +03:00 [DBG] Connection id "0HNH2H2QCOJMA" sending FIN because: "The Socket transport's send loop completed gracefully."
2025-11-13 10:46:13.898 +03:00 [DBG] Connection 0HNH2H2QCOJMB established using the following protocol: "Tls13"
2025-11-13 10:46:13.912 +03:00 [INF] Request starting HTTP/1.1 POST https://localhost:7257/api/Invoices - application/json 1317
2025-11-13 10:46:13.929 +03:00 [DBG] 1 candidate(s) found for the request path '/api/Invoices'
2025-11-13 10:46:13.938 +03:00 [DBG] Endpoint 'BillingSystem.API.Controllers.InvoicesController.Post (BillingSystem.API)' with route pattern 'api/Invoices' is valid for the request path '/api/Invoices'
2025-11-13 10:46:13.943 +03:00 [DBG] Request matched endpoint 'BillingSystem.API.Controllers.InvoicesController.Post (BillingSystem.API)'
2025-11-13 10:46:13.949 +03:00 [DBG] Static files was skipped as the request already matched an endpoint.
2025-11-13 10:46:14.178 +03:00 [DBG] An 'IServiceProvider' was created for internal use by Entity Framework.
2025-11-13 10:46:19.650 +03:00 [INF] Executing endpoint 'BillingSystem.API.Controllers.InvoicesController.Post (BillingSystem.API)'
2025-11-13 10:46:19.710 +03:00 [INF] Route matched with {action = "Post", controller = "Invoices"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Post(BillingSystem.Application.Requests.CreateInvoiceRequest) on controller BillingSystem.API.Controllers.InvoicesController (BillingSystem.API).
2025-11-13 10:46:19.720 +03:00 [DBG] Execution plan of authorization filters (in the following order): ["None"]
2025-11-13 10:46:19.727 +03:00 [DBG] Execution plan of resource filters (in the following order): ["None"]
2025-11-13 10:46:19.730 +03:00 [DBG] Execution plan of action filters (in the following order): ["Microsoft.AspNetCore.Mvc.ModelBinding.UnsupportedContentTypeFilter (Order: -3000)","Microsoft.AspNetCore.Mvc.Infrastructure.ModelStateInvalidFilter (Order: -2000)","BillingSystem.API.ActionFilters.AuditBillingRequestsFilter","BillingSystem.API.ActionFilters.IdempotencyFilter (Order: 0)"]
2025-11-13 10:46:19.738 +03:00 [DBG] Execution plan of exception filters (in the following order): ["None"]
2025-11-13 10:46:19.744 +03:00 [DBG] Execution plan of result filters (in the following order): ["Microsoft.AspNetCore.Mvc.Infrastructure.ClientErrorResultFilter (Order: -2000)","Microsoft.AspNetCore.Mvc.ProducesAttribute (Order: 0)","BillingSystem.API.ActionFilters.IdempotencyFilter (Order: 0)"]
2025-11-13 10:46:19.754 +03:00 [DBG] Executing controller factory for controller BillingSystem.API.Controllers.InvoicesController (BillingSystem.API)
2025-11-13 10:46:19.764 +03:00 [WRN] You do not have a valid license key for the Lucky Penny software MediatR. This is allowed for development and testing scenarios. If you are running in production you are required to have a licensed version. Please visit https://luckypennysoftware.com to obtain a valid license.
2025-11-13 10:46:19.818 +03:00 [DBG] Executed controller factory for controller BillingSystem.API.Controllers.InvoicesController (BillingSystem.API)
2025-11-13 10:46:19.851 +03:00 [DBG] Attempting to bind parameter 'invoiceRequest' of type 'BillingSystem.Application.Requests.CreateInvoiceRequest' ...
2025-11-13 10:46:19.860 +03:00 [DBG] Attempting to bind parameter 'invoiceRequest' of type 'BillingSystem.Application.Requests.CreateInvoiceRequest' using the name '' in request data ...
2025-11-13 10:46:19.868 +03:00 [DBG] Selected input formatter 'Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonInputFormatter' for content type 'application/json'.
2025-11-13 10:46:19.913 +03:00 [DBG] Connection id "0HNH2H2QCOJMB", Request id "0HNH2H2QCOJMB:00000001": started reading request body.
2025-11-13 10:46:19.917 +03:00 [DBG] Connection id "0HNH2H2QCOJMB", Request id "0HNH2H2QCOJMB:00000001": done reading request body.
2025-11-13 10:46:19.959 +03:00 [DBG] JSON input formatter succeeded, deserializing to type 'BillingSystem.Application.Requests.CreateInvoiceRequest'
2025-11-13 10:46:19.966 +03:00 [DBG] Done attempting to bind parameter 'invoiceRequest' of type 'BillingSystem.Application.Requests.CreateInvoiceRequest'.
2025-11-13 10:46:19.971 +03:00 [DBG] Done attempting to bind parameter 'invoiceRequest' of type 'BillingSystem.Application.Requests.CreateInvoiceRequest'.
2025-11-13 10:46:19.976 +03:00 [DBG] Attempting to validate the bound parameter 'invoiceRequest' of type 'BillingSystem.Application.Requests.CreateInvoiceRequest' ...
2025-11-13 10:46:20.009 +03:00 [DBG] Done attempting to validate the bound parameter 'invoiceRequest' of type 'BillingSystem.Application.Requests.CreateInvoiceRequest'.
2025-11-13 10:46:20.342 +03:00 [DBG] No relationship from 'Invoice' to 'Invoice' has been configured by convention because there are multiple properties on one entity type - {'DiscountedPrimaryInvoice'} that could be matched with the properties on the other entity type - {'InverseDiscountedPrimaryInvoice', 'InversePrimaryInvoice', 'InverseSubstitutionPrimaryInvoice', 'PrimaryInvoice', 'SubstitutionPrimaryInvoice'}. This message can be disregarded if explicit configuration has been specified in 'OnModelCreating'.
2025-11-13 10:46:20.616 +03:00 [DBG] No relationship from 'Invoice' to 'Invoice' has been configured by convention because there are multiple properties on one entity type - {'DiscountedPrimaryInvoice'} that could be matched with the properties on the other entity type - {'InverseDiscountedPrimaryInvoice', 'InversePrimaryInvoice', 'InverseSubstitutionPrimaryInvoice', 'PrimaryInvoice', 'SubstitutionPrimaryInvoice'}. This message can be disregarded if explicit configuration has been specified in 'OnModelCreating'.
2025-11-13 10:46:20.630 +03:00 [DBG] No relationship from 'Invoice' to 'Invoice' has been configured by convention because there are multiple properties on one entity type - {'InversePrimaryInvoice'} that could be matched with the properties on the other entity type - {'InverseSubstitutionPrimaryInvoice', 'PrimaryInvoice', 'SubstitutionPrimaryInvoice'}. This message can be disregarded if explicit configuration has been specified in 'OnModelCreating'.
2025-11-13 10:46:20.637 +03:00 [DBG] No relationship from 'Invoice' to 'Invoice' has been configured by convention because there are multiple properties on one entity type - {'InversePrimaryInvoice'} that could be matched with the properties on the other entity type - {'InverseSubstitutionPrimaryInvoice', 'PrimaryInvoice', 'SubstitutionPrimaryInvoice'}. This message can be disregarded if explicit configuration has been specified in 'OnModelCreating'.
2025-11-13 10:46:20.982 +03:00 [DBG] Entity Framework Core 9.0.9 initialized 'BillingServiceDBContext' using provider 'Microsoft.EntityFrameworkCore.SqlServer:9.0.9' with options: EngineType=SqlServer 
2025-11-13 10:46:21.139 +03:00 [DBG] Compiling query expression: 
'DbSet<Invoice>()
    .AsNoTracking()
    .Any(inv => inv.ExternalId.ToString() == __idempotentKey_0)'
2025-11-13 10:46:21.512 +03:00 [DBG] Generated query execution expression: 
'queryContext => ShapedQueryCompilingExpressionVisitor.SingleAsync<bool>(
    asyncEnumerable: SingleQueryingEnumerable.Create<bool>(
        relationalQueryContext: (RelationalQueryContext)queryContext, 
        relationalCommandResolver: parameters => [LIFTABLE Constant: RelationalCommandCache.QueryExpression(
            Projection Mapping:
                EmptyProjectionMember -> 0
            SELECT EXISTS (
                SELECT 1
                FROM Invoices AS i
                WHERE COALESCE(CONVERT(varchar(36), i.ExternalId), '') == @__idempotentKey_0)) | Resolver: c => new RelationalCommandCache(
            c.Dependencies.MemoryCache, 
            c.RelationalDependencies.QuerySqlGeneratorFactory, 
            c.RelationalDependencies.RelationalParameterBasedSqlProcessorFactory, 
            Projection Mapping:
                EmptyProjectionMember -> 0
            SELECT EXISTS (
                SELECT 1
                FROM Invoices AS i
                WHERE COALESCE(CONVERT(varchar(36), i.ExternalId), '') == @__idempotentKey_0), 
            False, 
            new HashSet<string>(
                new string[]{ }, 
                StringComparer.Ordinal
            )
        )].GetRelationalCommandTemplate(parameters), 
        readerColumns: null, 
        shaper: (queryContext, dataReader, resultContext, resultCoordinator) => 
        {
            bool? value1;
            value1 = dataReader.IsDBNull(0) ? default(bool?) : (bool?)dataReader.GetBoolean(0);
            return (bool)value1;
        }, 
        contextType: BillingSystem.Infrastructure.EF.BillingServiceDBContext, 
        standAloneStateManager: False, 
        detailedErrorsEnabled: False, 
        threadSafetyChecksEnabled: True), 
    cancellationToken: queryContext.CancellationToken)'
2025-11-13 10:46:21.572 +03:00 [DBG] Creating DbConnection.
2025-11-13 10:46:21.599 +03:00 [DBG] Created DbConnection. (22ms).
2025-11-13 10:46:21.610 +03:00 [DBG] Opening connection to database 'GAC-BillingService' on server '.'.
2025-11-13 10:46:22.000 +03:00 [DBG] Opened connection to database 'GAC-BillingService' on server '.'.
2025-11-13 10:46:22.011 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-11-13 10:46:22.028 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (11ms).
2025-11-13 10:46:22.051 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (40ms).
2025-11-13 10:46:22.072 +03:00 [DBG] Executing DbCommand [Parameters=[@__idempotentKey_0='?' (Size = 36) (DbType = AnsiString)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [Invoices] AS [i]
        WHERE CONVERT(varchar(36), [i].[ExternalId]) = @__idempotentKey_0) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2025-11-13 10:46:22.174 +03:00 [INF] Executed DbCommand (106ms) [Parameters=[@__idempotentKey_0='?' (Size = 36) (DbType = AnsiString)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [Invoices] AS [i]
        WHERE CONVERT(varchar(36), [i].[ExternalId]) = @__idempotentKey_0) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2025-11-13 10:46:22.212 +03:00 [DBG] Closing data reader to 'GAC-BillingService' on server '.'.
2025-11-13 10:46:22.229 +03:00 [DBG] A data reader for 'GAC-BillingService' on server '.' is being disposed after spending 39ms reading results.
2025-11-13 10:46:22.241 +03:00 [DBG] Closing connection to database 'GAC-BillingService' on server '.'.
2025-11-13 10:46:22.254 +03:00 [DBG] Closed connection to database 'GAC-BillingService' on server '.' (12ms).
2025-11-13 10:46:22.475 +03:00 [WRN] You do not have a valid license key for the Lucky Penny software AutoMapper. This is allowed for development and testing scenarios. If you are running in production you are required to have a licensed version. Please visit https://luckypennysoftware.com to obtain a valid license.
2025-11-13 10:46:26.807 +03:00 [DBG] Opening connection to database 'GAC-BillingService' on server '.'.
2025-11-13 10:46:26.816 +03:00 [DBG] Opened connection to database 'GAC-BillingService' on server '.'.
2025-11-13 10:46:26.821 +03:00 [DBG] Beginning transaction with isolation level 'Unspecified'.
2025-11-13 10:46:26.836 +03:00 [DBG] Began transaction with isolation level 'ReadCommitted'.
2025-11-13 10:46:27.638 +03:00 [DBG] Compiling query expression: 
'DbSet<InvoiceSequenceValue>().FromSql(EXECUTE dbo.GetNextInvoiceNumber, __p_0)
'
2025-11-13 10:46:27.702 +03:00 [DBG] Generated query execution expression: 
'queryContext => FromSqlQueryingEnumerable.Create<InvoiceSequenceValue>(
    relationalQueryContext: (RelationalQueryContext)queryContext, 
    relationalCommandResolver: parameters => [LIFTABLE Constant: RelationalCommandCache.QueryExpression(
        Projection Mapping:
            EmptyProjectionMember -> Dictionary<IProperty, int> { [Property: InvoiceSequenceValue.Value (long) Required, 0] }
        SELECT b.Value
        FROM EXECUTE dbo.GetNextInvoiceNumber) | Resolver: c => new RelationalCommandCache(
        c.Dependencies.MemoryCache, 
        c.RelationalDependencies.QuerySqlGeneratorFactory, 
        c.RelationalDependencies.RelationalParameterBasedSqlProcessorFactory, 
        Projection Mapping:
            EmptyProjectionMember -> Dictionary<IProperty, int> { [Property: InvoiceSequenceValue.Value (long) Required, 0] }
        SELECT b.Value
        FROM EXECUTE dbo.GetNextInvoiceNumber, 
        False, 
        new HashSet<string>(
            new string[]{ }, 
            StringComparer.Ordinal
        )
    )].GetRelationalCommandTemplate(parameters), 
    readerColumns: null, 
    columnNames: [LIFTABLE Constant: string[] { "Value" } | Resolver: _ => new string[]{ "Value" }], 
    shaper: (queryContext, dataReader, indexMap) => 
    {
        InvoiceSequenceValue entity;
        entity = 
        {
            MaterializationContext materializationContext1;
            IEntityType entityType1;
            InvoiceSequenceValue instance1;
            materializationContext1 = new MaterializationContext(
                [LIFTABLE Constant: ValueBuffer | Resolver: _ => (object)ValueBuffer.Empty], 
                queryContext.Context
            );
            instance1 = default(InvoiceSequenceValue);
            {
                ISnapshot shadowSnapshot1;
                shadowSnapshot1 = [LIFTABLE Constant: Snapshot | Resolver: _ => Snapshot.Empty];
                entityType1 = [LIFTABLE Constant: EntityType: InvoiceSequenceValue Keyless | Resolver: namelessParameter{0} => namelessParameter{0}.Dependencies.Model.FindEntityType("BillingSystem.Domain.Entities.InvoiceSequenceValue")];
                instance1 = switch (entityType1)
                {
                    case [LIFTABLE Constant: EntityType: InvoiceSequenceValue Keyless | Resolver: namelessParameter{1} => namelessParameter{1}.Dependencies.Model.FindEntityType("BillingSystem.Domain.Entities.InvoiceSequenceValue")]: 
                        {
                            return 
                            {
                                InvoiceSequenceValue instance;
                                instance = new InvoiceSequenceValue();
                                instance.<Value>k__BackingField = dataReader.GetInt64(indexMap[0]);
                                (instance is IInjectableService) ? ((IInjectableService)instance).Injected(
                                    context: materializationContext1.Context, 
                                    entity: instance, 
                                    queryTrackingBehavior: TrackAll, 
                                    structuralType: [LIFTABLE Constant: EntityType: InvoiceSequenceValue Keyless | Resolver: namelessParameter{2} => namelessParameter{2}.Dependencies.Model.FindEntityType("BillingSystem.Domain.Entities.InvoiceSequenceValue")]) : default(void);
                                return instance;
                            }}
                    default: 
                        default(InvoiceSequenceValue)
                }
                ;
                return instance1;
            }return instance1;
        };
        return entity;
    }, 
    contextType: BillingSystem.Infrastructure.EF.BillingServiceDBContext, 
    standAloneStateManager: False, 
    detailedErrorsEnabled: False, 
    threadSafetyChecksEnabled: True)'
2025-11-13 10:46:27.717 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-11-13 10:46:27.722 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (4ms).
2025-11-13 10:46:27.729 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (11ms).
2025-11-13 10:46:27.733 +03:00 [DBG] Executing DbCommand [Parameters=[], CommandType='"Text"', CommandTimeout='30']
EXECUTE dbo.GetNextInvoiceNumber
2025-11-13 10:46:27.755 +03:00 [INF] Executed DbCommand (23ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
EXECUTE dbo.GetNextInvoiceNumber
2025-11-13 10:46:27.768 +03:00 [DBG] Closing data reader to 'GAC-BillingService' on server '.'.
2025-11-13 10:46:27.773 +03:00 [DBG] A data reader for 'GAC-BillingService' on server '.' is being disposed after spending 10ms reading results.
2025-11-13 10:46:39.458 +03:00 [DBG] 'BillingServiceDBContext' generated a temporary value for the property 'Invoice.Id'. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-11-13 10:46:39.605 +03:00 [DBG] Context 'BillingServiceDBContext' started tracking 'Invoice' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-11-13 10:46:39.613 +03:00 [DBG] 'BillingServiceDBContext' generated a temporary value for the property 'Customer.Id'. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-11-13 10:46:39.662 +03:00 [DBG] The foreign key property 'Invoice.CustomerId' was detected as changed. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see property values.
2025-11-13 10:46:39.683 +03:00 [DBG] Context 'BillingServiceDBContext' started tracking 'Customer' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-11-13 10:46:40.313 +03:00 [DBG] SaveChanges starting for 'BillingServiceDBContext'.
2025-11-13 10:46:40.322 +03:00 [DBG] DetectChanges starting for 'BillingServiceDBContext'.
2025-11-13 10:46:40.386 +03:00 [DBG] DetectChanges completed for 'BillingServiceDBContext'.
2025-11-13 10:46:40.510 +03:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-11-13 10:46:40.518 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-11-13 10:46:40.521 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (2ms).
2025-11-13 10:46:40.528 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (10ms).
2025-11-13 10:46:40.533 +03:00 [DBG] Executing DbCommand [Parameters=[@p0='?' (Size = 200), @p1='?' (Size = 200), @p2='?' (Size = 200), @p3='?' (Size = 200), @p4='?' (Size = 50), @p5='?' (Size = 200), @p6='?' (Size = 200), @p7='?' (Size = 50), @p8='?' (DbType = DateTime), @p9='?' (Size = 100), @p10='?' (Size = 80), @p11='?' (Size = 500), @p12='?' (Size = 100), @p13='?' (DbType = Int32), @p14='?' (DbType = Boolean), @p15='?' (DbType = DateTime), @p16='?' (Precision = 18) (DbType = Decimal), @p17='?' (Size = 50), @p18='?' (Size = 100)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [Customers] ([Address_BuildingNumber], [Address_City], [Address_Country], [Address_District], [Address_PostalCode], [Address_Street], [Address_SubNumber], [CreatedBy], [CreatedDate], [CustomerType], [EmailAddress], [FullName], [IdentityNumber], [IdentityType], [IsDeleted], [LastUpdatedDate], [OverpaymentBalance], [PhoneNumber], [VATNumber])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18);
2025-11-13 10:46:40.548 +03:00 [INF] Executed DbCommand (17ms) [Parameters=[@p0='?' (Size = 200), @p1='?' (Size = 200), @p2='?' (Size = 200), @p3='?' (Size = 200), @p4='?' (Size = 50), @p5='?' (Size = 200), @p6='?' (Size = 200), @p7='?' (Size = 50), @p8='?' (DbType = DateTime), @p9='?' (Size = 100), @p10='?' (Size = 80), @p11='?' (Size = 500), @p12='?' (Size = 100), @p13='?' (DbType = Int32), @p14='?' (DbType = Boolean), @p15='?' (DbType = DateTime), @p16='?' (Precision = 18) (DbType = Decimal), @p17='?' (Size = 50), @p18='?' (Size = 100)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [Customers] ([Address_BuildingNumber], [Address_City], [Address_Country], [Address_District], [Address_PostalCode], [Address_Street], [Address_SubNumber], [CreatedBy], [CreatedDate], [CustomerType], [EmailAddress], [FullName], [IdentityNumber], [IdentityType], [IsDeleted], [LastUpdatedDate], [OverpaymentBalance], [PhoneNumber], [VATNumber])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18);
2025-11-13 10:46:40.582 +03:00 [DBG] The foreign key property 'Customer.Id' was detected as changed. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see property values.
2025-11-13 10:46:40.588 +03:00 [DBG] The foreign key property 'Invoice.CustomerId' was detected as changed. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see property values.
2025-11-13 10:46:40.594 +03:00 [DBG] Closing data reader to 'GAC-BillingService' on server '.'.
2025-11-13 10:46:40.598 +03:00 [DBG] A data reader for 'GAC-BillingService' on server '.' is being disposed after spending 43ms reading results.
2025-11-13 10:46:40.604 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-11-13 10:46:40.606 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (2ms).
2025-11-13 10:46:40.609 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (5ms).
2025-11-13 10:46:40.613 +03:00 [DBG] Executing DbCommand [Parameters=[@p19='?' (Precision = 18) (DbType = Decimal), @p20='?' (Size = 3000), @p21='?' (Size = 100), @p22='?' (Size = 50), @p23='?' (DbType = DateTime), @p24='?' (Size = 50), @p25='?' (DbType = Int64), @p26='?' (DbType = Int64), @p27='?' (DbType = DateTime), @p28='?' (DbType = Guid), @p29='?' (Size = 50), @p30='?' (DbType = Int32), @p31='?' (DbType = Int32), @p32='?' (DbType = Boolean), @p33='?' (DbType = Boolean), @p34='?' (DbType = Boolean), @p35='?' (DbType = Boolean), @p36='?' (DbType = DateTime), @p37='?' (DbType = DateTime), @p38='?' (Size = 4000), @p39='?' (Size = 100), @p40='?' (Size = 100), @p41='?' (DbType = Int64), @p42='?' (DbType = Int64), @p43='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [Invoices] ([Amount], [CancelationReasons], [ClientReferenceNumber], [CreatedBy], [CreatedDate], [Currency], [CustomerID], [DiscountedPrimaryInvoiceID], [DueAt], [ExternalId], [InvoiceNumber], [InvoiceStatus], [InvoiceType], [IsDeleted], [IsDiscounted], [IsSubInvoice], [IsSubstitution], [IssuedAt], [LastUpdatedDate], [Metadata], [PaymentProvider], [PaymentReference], [PrimaryInvoiceID], [SubstitutionPrimaryInvoiceID], [TenantId])
OUTPUT INSERTED.[Id]
VALUES (@p19, @p20, @p21, @p22, @p23, @p24, @p25, @p26, @p27, @p28, @p29, @p30, @p31, @p32, @p33, @p34, @p35, @p36, @p37, @p38, @p39, @p40, @p41, @p42, @p43);
2025-11-13 10:46:40.624 +03:00 [INF] Executed DbCommand (12ms) [Parameters=[@p19='?' (Precision = 18) (DbType = Decimal), @p20='?' (Size = 3000), @p21='?' (Size = 100), @p22='?' (Size = 50), @p23='?' (DbType = DateTime), @p24='?' (Size = 50), @p25='?' (DbType = Int64), @p26='?' (DbType = Int64), @p27='?' (DbType = DateTime), @p28='?' (DbType = Guid), @p29='?' (Size = 50), @p30='?' (DbType = Int32), @p31='?' (DbType = Int32), @p32='?' (DbType = Boolean), @p33='?' (DbType = Boolean), @p34='?' (DbType = Boolean), @p35='?' (DbType = Boolean), @p36='?' (DbType = DateTime), @p37='?' (DbType = DateTime), @p38='?' (Size = 4000), @p39='?' (Size = 100), @p40='?' (Size = 100), @p41='?' (DbType = Int64), @p42='?' (DbType = Int64), @p43='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [Invoices] ([Amount], [CancelationReasons], [ClientReferenceNumber], [CreatedBy], [CreatedDate], [Currency], [CustomerID], [DiscountedPrimaryInvoiceID], [DueAt], [ExternalId], [InvoiceNumber], [InvoiceStatus], [InvoiceType], [IsDeleted], [IsDiscounted], [IsSubInvoice], [IsSubstitution], [IssuedAt], [LastUpdatedDate], [Metadata], [PaymentProvider], [PaymentReference], [PrimaryInvoiceID], [SubstitutionPrimaryInvoiceID], [TenantId])
OUTPUT INSERTED.[Id]
VALUES (@p19, @p20, @p21, @p22, @p23, @p24, @p25, @p26, @p27, @p28, @p29, @p30, @p31, @p32, @p33, @p34, @p35, @p36, @p37, @p38, @p39, @p40, @p41, @p42, @p43);
2025-11-13 10:46:40.631 +03:00 [DBG] The foreign key property 'Invoice.Id' was detected as changed. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see property values.
2025-11-13 10:46:40.637 +03:00 [DBG] Closing data reader to 'GAC-BillingService' on server '.'.
2025-11-13 10:46:40.641 +03:00 [DBG] A data reader for 'GAC-BillingService' on server '.' is being disposed after spending 10ms reading results.
2025-11-13 10:46:40.656 +03:00 [DBG] An entity of type 'Invoice' tracked by 'BillingServiceDBContext' changed state from '"Added"' to '"Unchanged"'. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-11-13 10:46:40.661 +03:00 [DBG] An entity of type 'Customer' tracked by 'BillingServiceDBContext' changed state from '"Added"' to '"Unchanged"'. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-11-13 10:46:40.669 +03:00 [DBG] SaveChanges completed for 'BillingServiceDBContext' with 2 entities written to the database.
2025-11-13 10:46:46.360 +03:00 [DBG] 'BillingServiceDBContext' generated a temporary value for the property 'OutboxEvent.Id'. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-11-13 10:46:46.394 +03:00 [DBG] Context 'BillingServiceDBContext' started tracking 'OutboxEvent' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-11-13 10:46:47.793 +03:00 [DBG] SaveChanges starting for 'BillingServiceDBContext'.
2025-11-13 10:46:47.799 +03:00 [DBG] DetectChanges starting for 'BillingServiceDBContext'.
2025-11-13 10:46:47.819 +03:00 [DBG] DetectChanges completed for 'BillingServiceDBContext'.
2025-11-13 10:46:47.824 +03:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-11-13 10:46:47.827 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-11-13 10:46:47.829 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (2ms).
2025-11-13 10:46:47.833 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (6ms).
2025-11-13 10:46:47.841 +03:00 [DBG] Executing DbCommand [Parameters=[@p0='?' (DbType = Int64), @p1='?' (DbType = DateTime), @p2='?' (Size = 4000), @p3='?' (Size = 300), @p4='?' (Size = 4000), @p5='?' (DbType = Boolean), @p6='?' (Size = 20) (DbType = AnsiString)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [Outbox_events] ([Aggregate_id], [CreatedDate], [ErrorMsg], [Event_type], [Payload], [Processed], [ProcessingStatus])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6);
2025-11-13 10:46:47.850 +03:00 [INF] Executed DbCommand (9ms) [Parameters=[@p0='?' (DbType = Int64), @p1='?' (DbType = DateTime), @p2='?' (Size = 4000), @p3='?' (Size = 300), @p4='?' (Size = 4000), @p5='?' (DbType = Boolean), @p6='?' (Size = 20) (DbType = AnsiString)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [Outbox_events] ([Aggregate_id], [CreatedDate], [ErrorMsg], [Event_type], [Payload], [Processed], [ProcessingStatus])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6);
2025-11-13 10:46:47.877 +03:00 [DBG] The foreign key property 'OutboxEvent.Id' was detected as changed. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see property values.
2025-11-13 10:46:47.883 +03:00 [DBG] Closing data reader to 'GAC-BillingService' on server '.'.
2025-11-13 10:46:47.886 +03:00 [DBG] A data reader for 'GAC-BillingService' on server '.' is being disposed after spending 11ms reading results.
2025-11-13 10:46:47.890 +03:00 [DBG] An entity of type 'OutboxEvent' tracked by 'BillingServiceDBContext' changed state from '"Added"' to '"Unchanged"'. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-11-13 10:46:47.894 +03:00 [DBG] SaveChanges completed for 'BillingServiceDBContext' with 1 entities written to the database.
2025-11-13 10:46:48.752 +03:00 [DBG] Committing transaction.
2025-11-13 10:46:48.770 +03:00 [DBG] Committed transaction.
2025-11-13 10:46:48.780 +03:00 [DBG] Closing connection to database 'GAC-BillingService' on server '.'.
2025-11-13 10:46:48.788 +03:00 [DBG] Closed connection to database 'GAC-BillingService' on server '.' (7ms).
2025-11-13 10:46:49.332 +03:00 [DBG] Disposing transaction.
2025-11-13 10:46:51.053 +03:00 [DBG] List of registered output formatters, in the following order: ["Microsoft.AspNetCore.Mvc.Formatters.HttpNoContentOutputFormatter","Microsoft.AspNetCore.Mvc.Formatters.StringOutputFormatter","Microsoft.AspNetCore.Mvc.Formatters.StreamOutputFormatter","Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonOutputFormatter"]
2025-11-13 10:46:51.075 +03:00 [DBG] No information found on request to perform content negotiation.
2025-11-13 10:46:51.081 +03:00 [DBG] Attempting to select the first output formatter in the output formatters list which supports a content type from the explicitly specified content types '["application/json"]'.
2025-11-13 10:46:51.091 +03:00 [DBG] Selected output formatter 'Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonOutputFormatter' and content type 'application/json' to write the response.
2025-11-13 10:46:51.099 +03:00 [INF] Executing OkObjectResult, writing value of type 'BillingSystem.SharedKernel.ApiResponse`1[[System.Int64, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-11-13 10:46:51.120 +03:00 [INF] Executed action BillingSystem.API.Controllers.InvoicesController.Post (BillingSystem.API) in 31363.7858ms
2025-11-13 10:46:51.125 +03:00 [INF] Executed endpoint 'BillingSystem.API.Controllers.InvoicesController.Post (BillingSystem.API)'
2025-11-13 10:46:51.131 +03:00 [INF] HTTP POST /api/Invoices responded 200 in 37181.9073 ms
2025-11-13 10:46:51.137 +03:00 [DBG] Connection id "0HNH2H2QCOJMB" completed keep alive response.
2025-11-13 10:46:51.144 +03:00 [DBG] 'BillingServiceDBContext' disposed.
2025-11-13 10:46:51.153 +03:00 [DBG] Disposing connection to database 'GAC-BillingService' on server '.'.
2025-11-13 10:46:51.159 +03:00 [DBG] Disposed connection to database '' on server '' (6ms).
2025-11-13 10:46:51.164 +03:00 [INF] Request finished HTTP/1.1 POST https://localhost:7257/api/Invoices - 200 null application/json; charset=utf-8 37250.8258ms
2025-11-13 11:05:31.942 +03:00 [DBG] Connection id "0HNH2H2QCOJM9" received FIN.
2025-11-13 11:05:31.948 +03:00 [DBG] Connection id "0HNH2H2QCOJM9" is closed. The last processed stream ID was 7.
2025-11-13 11:05:31.948 +03:00 [DBG] The connection queue processing loop for 0HNH2H2QCOJM9 completed.
2025-11-13 11:05:31.954 +03:00 [DBG] Connection id "0HNH2H2QCOJM9" sending FIN because: "The Socket transport's send loop completed gracefully."
2025-11-13 11:05:31.976 +03:00 [DBG] Connection id "0HNH2H2QCOJM9" stopped.
2025-11-13 11:23:31.423 +03:00 [DBG] Connection id "0HNH2H2QCOJMC" accepted.
2025-11-13 11:23:31.423 +03:00 [DBG] Connection id "0HNH2H2QCOJMC" received FIN.
2025-11-13 11:23:31.430 +03:00 [DBG] Connection id "0HNH2H2QCOJMC" started.
2025-11-13 11:23:31.434 +03:00 [DBG] Connection id "0HNH2H2QCOJMD" accepted.
2025-11-13 11:23:31.448 +03:00 [DBG] Failed to authenticate HTTPS connection.
System.IO.IOException: Received an unexpected EOF or 0 bytes from the transport stream.
   at System.Net.Security.SslStream.ReceiveHandshakeFrameAsync[TIOAdapter](CancellationToken cancellationToken)
   at System.Net.Security.SslStream.ForceAuthenticationAsync[TIOAdapter](Boolean receiveFirst, Byte[] reAuthenticationData, CancellationToken cancellationToken)
   at System.Net.Security.SslStream.ProcessAuthenticationWithTelemetryAsync(Boolean isAsync, CancellationToken cancellationToken)
   at Microsoft.AspNetCore.Server.Kestrel.Https.Internal.HttpsConnectionMiddleware.OnConnectionAsync(ConnectionContext context)
2025-11-13 11:23:31.452 +03:00 [DBG] Connection id "0HNH2H2QCOJMD" started.
2025-11-13 11:23:31.461 +03:00 [DBG] Connection id "0HNH2H2QCOJMC" stopped.
2025-11-13 11:23:31.474 +03:00 [DBG] Connection id "0HNH2H2QCOJMC" sending FIN because: "The Socket transport's send loop completed gracefully."
2025-11-13 11:23:31.481 +03:00 [DBG] Connection 0HNH2H2QCOJMD established using the following protocol: "Tls13"
2025-11-13 11:23:31.491 +03:00 [INF] Request starting HTTP/1.1 POST https://localhost:7257/api/Invoices - application/json 1317
2025-11-13 11:23:31.503 +03:00 [DBG] 1 candidate(s) found for the request path '/api/Invoices'
2025-11-13 11:23:31.507 +03:00 [DBG] Endpoint 'BillingSystem.API.Controllers.InvoicesController.Post (BillingSystem.API)' with route pattern 'api/Invoices' is valid for the request path '/api/Invoices'
2025-11-13 11:23:31.513 +03:00 [DBG] Request matched endpoint 'BillingSystem.API.Controllers.InvoicesController.Post (BillingSystem.API)'
2025-11-13 11:23:31.517 +03:00 [DBG] Static files was skipped as the request already matched an endpoint.
2025-11-13 11:23:40.009 +03:00 [INF] HTTP POST /api/Invoices responded 400 in 8491.4953 ms
2025-11-13 11:23:40.032 +03:00 [DBG] Connection id "0HNH2H2QCOJMD" completed keep alive response.
2025-11-13 11:23:42.745 +03:00 [INF] Request finished HTTP/1.1 POST https://localhost:7257/api/Invoices - 400 null null 11254.5733ms
2025-11-13 11:23:42.777 +03:00 [DBG] Connection id "0HNH2H2QCOJMD", Request id "0HNH2H2QCOJMD:00000001": started reading request body.
2025-11-13 11:23:50.643 +03:00 [DBG] Connection id "0HNH2H2QCOJMD", Request id "0HNH2H2QCOJMD:00000001": done reading request body.
2025-11-13 11:24:39.148 +03:00 [DBG] Connection id "0HNH2H2QCOJME" accepted.
2025-11-13 11:24:39.149 +03:00 [DBG] Connection id "0HNH2H2QCOJME" received FIN.
2025-11-13 11:24:39.154 +03:00 [DBG] Connection id "0HNH2H2QCOJMF" accepted.
2025-11-13 11:24:39.152 +03:00 [DBG] Connection id "0HNH2H2QCOJME" started.
2025-11-13 11:24:39.162 +03:00 [DBG] Connection id "0HNH2H2QCOJMF" started.
2025-11-13 11:24:39.168 +03:00 [DBG] Failed to authenticate HTTPS connection.
System.IO.IOException: Received an unexpected EOF or 0 bytes from the transport stream.
   at System.Net.Security.SslStream.ReceiveHandshakeFrameAsync[TIOAdapter](CancellationToken cancellationToken)
   at System.Net.Security.SslStream.ForceAuthenticationAsync[TIOAdapter](Boolean receiveFirst, Byte[] reAuthenticationData, CancellationToken cancellationToken)
   at System.Net.Security.SslStream.ProcessAuthenticationWithTelemetryAsync(Boolean isAsync, CancellationToken cancellationToken)
   at Microsoft.AspNetCore.Server.Kestrel.Https.Internal.HttpsConnectionMiddleware.OnConnectionAsync(ConnectionContext context)
2025-11-13 11:24:39.176 +03:00 [DBG] Connection id "0HNH2H2QCOJME" stopped.
2025-11-13 11:24:39.179 +03:00 [DBG] Connection 0HNH2H2QCOJMF established using the following protocol: "Tls13"
2025-11-13 11:24:39.181 +03:00 [DBG] Connection id "0HNH2H2QCOJME" sending FIN because: "The Socket transport's send loop completed gracefully."
2025-11-13 11:24:39.186 +03:00 [INF] Request starting HTTP/1.1 POST https://localhost:7257/api/Invoices - application/json 1317
2025-11-13 11:24:39.193 +03:00 [DBG] 1 candidate(s) found for the request path '/api/Invoices'
2025-11-13 11:24:39.196 +03:00 [DBG] Endpoint 'BillingSystem.API.Controllers.InvoicesController.Post (BillingSystem.API)' with route pattern 'api/Invoices' is valid for the request path '/api/Invoices'
2025-11-13 11:24:39.201 +03:00 [DBG] Request matched endpoint 'BillingSystem.API.Controllers.InvoicesController.Post (BillingSystem.API)'
2025-11-13 11:24:39.205 +03:00 [DBG] Static files was skipped as the request already matched an endpoint.
2025-11-13 11:25:24.449 +03:00 [INF] Executing endpoint 'BillingSystem.API.Controllers.InvoicesController.Post (BillingSystem.API)'
2025-11-13 11:25:24.464 +03:00 [INF] Route matched with {action = "Post", controller = "Invoices"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Post(BillingSystem.Application.Requests.CreateInvoiceRequest) on controller BillingSystem.API.Controllers.InvoicesController (BillingSystem.API).
2025-11-13 11:25:24.468 +03:00 [DBG] Execution plan of authorization filters (in the following order): ["None"]
2025-11-13 11:25:24.472 +03:00 [DBG] Execution plan of resource filters (in the following order): ["None"]
2025-11-13 11:25:24.476 +03:00 [DBG] Execution plan of action filters (in the following order): ["Microsoft.AspNetCore.Mvc.ModelBinding.UnsupportedContentTypeFilter (Order: -3000)","Microsoft.AspNetCore.Mvc.Infrastructure.ModelStateInvalidFilter (Order: -2000)","BillingSystem.API.ActionFilters.AuditBillingRequestsFilter","BillingSystem.API.ActionFilters.IdempotencyFilter (Order: 0)"]
2025-11-13 11:25:24.483 +03:00 [DBG] Execution plan of exception filters (in the following order): ["None"]
2025-11-13 11:25:24.486 +03:00 [DBG] Execution plan of result filters (in the following order): ["Microsoft.AspNetCore.Mvc.Infrastructure.ClientErrorResultFilter (Order: -2000)","Microsoft.AspNetCore.Mvc.ProducesAttribute (Order: 0)","BillingSystem.API.ActionFilters.IdempotencyFilter (Order: 0)"]
2025-11-13 11:25:24.491 +03:00 [DBG] Executing controller factory for controller BillingSystem.API.Controllers.InvoicesController (BillingSystem.API)
2025-11-13 11:25:24.497 +03:00 [DBG] Executed controller factory for controller BillingSystem.API.Controllers.InvoicesController (BillingSystem.API)
2025-11-13 11:25:24.501 +03:00 [DBG] Attempting to bind parameter 'invoiceRequest' of type 'BillingSystem.Application.Requests.CreateInvoiceRequest' ...
2025-11-13 11:25:24.504 +03:00 [DBG] Attempting to bind parameter 'invoiceRequest' of type 'BillingSystem.Application.Requests.CreateInvoiceRequest' using the name '' in request data ...
2025-11-13 11:25:24.508 +03:00 [DBG] Selected input formatter 'Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonInputFormatter' for content type 'application/json'.
2025-11-13 11:25:24.516 +03:00 [DBG] Connection id "0HNH2H2QCOJMF", Request id "0HNH2H2QCOJMF:00000001": started reading request body.
2025-11-13 11:25:24.519 +03:00 [DBG] Connection id "0HNH2H2QCOJMF", Request id "0HNH2H2QCOJMF:00000001": done reading request body.
2025-11-13 11:25:24.527 +03:00 [DBG] JSON input formatter succeeded, deserializing to type 'BillingSystem.Application.Requests.CreateInvoiceRequest'
2025-11-13 11:25:24.529 +03:00 [DBG] Done attempting to bind parameter 'invoiceRequest' of type 'BillingSystem.Application.Requests.CreateInvoiceRequest'.
2025-11-13 11:25:24.532 +03:00 [DBG] Done attempting to bind parameter 'invoiceRequest' of type 'BillingSystem.Application.Requests.CreateInvoiceRequest'.
2025-11-13 11:25:24.535 +03:00 [DBG] Attempting to validate the bound parameter 'invoiceRequest' of type 'BillingSystem.Application.Requests.CreateInvoiceRequest' ...
2025-11-13 11:25:24.542 +03:00 [DBG] Done attempting to validate the bound parameter 'invoiceRequest' of type 'BillingSystem.Application.Requests.CreateInvoiceRequest'.
2025-11-13 11:25:24.567 +03:00 [DBG] Entity Framework Core 9.0.9 initialized 'BillingServiceDBContext' using provider 'Microsoft.EntityFrameworkCore.SqlServer:9.0.9' with options: EngineType=SqlServer 
2025-11-13 11:25:24.578 +03:00 [DBG] Creating DbConnection.
2025-11-13 11:25:24.580 +03:00 [DBG] Created DbConnection. (2ms).
2025-11-13 11:25:24.582 +03:00 [DBG] Opening connection to database 'GAC-BillingService' on server '.'.
2025-11-13 11:25:24.612 +03:00 [DBG] Opened connection to database 'GAC-BillingService' on server '.'.
2025-11-13 11:25:24.618 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-11-13 11:25:24.621 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (3ms).
2025-11-13 11:25:24.624 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (6ms).
2025-11-13 11:25:24.628 +03:00 [DBG] Executing DbCommand [Parameters=[@__idempotentKey_0='?' (Size = 36) (DbType = AnsiString)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [Invoices] AS [i]
        WHERE CONVERT(varchar(36), [i].[ExternalId]) = @__idempotentKey_0) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2025-11-13 11:25:24.636 +03:00 [INF] Executed DbCommand (9ms) [Parameters=[@__idempotentKey_0='?' (Size = 36) (DbType = AnsiString)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [Invoices] AS [i]
        WHERE CONVERT(varchar(36), [i].[ExternalId]) = @__idempotentKey_0) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2025-11-13 11:25:24.642 +03:00 [DBG] Closing data reader to 'GAC-BillingService' on server '.'.
2025-11-13 11:25:24.646 +03:00 [DBG] A data reader for 'GAC-BillingService' on server '.' is being disposed after spending 4ms reading results.
2025-11-13 11:25:24.651 +03:00 [DBG] Closing connection to database 'GAC-BillingService' on server '.'.
2025-11-13 11:25:24.655 +03:00 [DBG] Closed connection to database 'GAC-BillingService' on server '.' (4ms).
2025-11-13 11:25:24.659 +03:00 [DBG] Request was short circuited at action filter 'BillingSystem.API.ActionFilters.IdempotencyFilter'.
2025-11-13 11:25:24.662 +03:00 [DBG] List of registered output formatters, in the following order: ["Microsoft.AspNetCore.Mvc.Formatters.HttpNoContentOutputFormatter","Microsoft.AspNetCore.Mvc.Formatters.StringOutputFormatter","Microsoft.AspNetCore.Mvc.Formatters.StreamOutputFormatter","Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonOutputFormatter"]
2025-11-13 11:25:24.668 +03:00 [DBG] No information found on request to perform content negotiation.
2025-11-13 11:25:24.670 +03:00 [DBG] Attempting to select the first output formatter in the output formatters list which supports a content type from the explicitly specified content types '["application/json"]'.
2025-11-13 11:25:24.674 +03:00 [DBG] Selected output formatter 'Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonOutputFormatter' and content type 'application/json' to write the response.
2025-11-13 11:25:24.677 +03:00 [INF] Executing ConflictObjectResult, writing value of type 'System.String'.
2025-11-13 11:25:24.682 +03:00 [INF] Executed action BillingSystem.API.Controllers.InvoicesController.Post (BillingSystem.API) in 191.2967ms
2025-11-13 11:25:24.684 +03:00 [INF] Executed endpoint 'BillingSystem.API.Controllers.InvoicesController.Post (BillingSystem.API)'
2025-11-13 11:25:28.081 +03:00 [INF] HTTP POST /api/Invoices responded 409 in 48873.9195 ms
2025-11-13 11:25:28.096 +03:00 [DBG] Connection id "0HNH2H2QCOJMF" completed keep alive response.
2025-11-13 11:25:28.104 +03:00 [DBG] 'BillingServiceDBContext' disposed.
2025-11-13 11:25:28.111 +03:00 [DBG] Disposing connection to database 'GAC-BillingService' on server '.'.
2025-11-13 11:25:28.117 +03:00 [DBG] Disposed connection to database '' on server '' (6ms).
2025-11-13 11:25:28.125 +03:00 [INF] Request finished HTTP/1.1 POST https://localhost:7257/api/Invoices - 409 null application/json; charset=utf-8 48936.3647ms
2025-11-13 11:28:27.160 +03:00 [DBG] Connection id "0HNH2H2QCOJMG" accepted.
2025-11-13 11:28:27.161 +03:00 [DBG] Connection id "0HNH2H2QCOJMG" received FIN.
2025-11-13 11:28:27.167 +03:00 [DBG] Connection id "0HNH2H2QCOJMG" started.
2025-11-13 11:28:27.168 +03:00 [DBG] Connection id "0HNH2H2QCOJMH" accepted.
2025-11-13 11:28:27.191 +03:00 [DBG] Failed to authenticate HTTPS connection.
System.IO.IOException: Received an unexpected EOF or 0 bytes from the transport stream.
   at System.Net.Security.SslStream.ReceiveHandshakeFrameAsync[TIOAdapter](CancellationToken cancellationToken)
   at System.Net.Security.SslStream.ForceAuthenticationAsync[TIOAdapter](Boolean receiveFirst, Byte[] reAuthenticationData, CancellationToken cancellationToken)
   at System.Net.Security.SslStream.ProcessAuthenticationWithTelemetryAsync(Boolean isAsync, CancellationToken cancellationToken)
   at Microsoft.AspNetCore.Server.Kestrel.Https.Internal.HttpsConnectionMiddleware.OnConnectionAsync(ConnectionContext context)
2025-11-13 11:28:27.193 +03:00 [DBG] Connection id "0HNH2H2QCOJMH" started.
2025-11-13 11:28:27.201 +03:00 [DBG] Connection id "0HNH2H2QCOJMG" stopped.
2025-11-13 11:28:27.212 +03:00 [DBG] Connection id "0HNH2H2QCOJMG" sending FIN because: "The Socket transport's send loop completed gracefully."
2025-11-13 11:28:27.217 +03:00 [DBG] Connection 0HNH2H2QCOJMH established using the following protocol: "Tls13"
2025-11-13 11:28:27.223 +03:00 [INF] Request starting HTTP/1.1 POST https://localhost:7257/api/Invoices - application/json 1317
2025-11-13 11:28:27.232 +03:00 [DBG] 1 candidate(s) found for the request path '/api/Invoices'
2025-11-13 11:28:27.235 +03:00 [DBG] Endpoint 'BillingSystem.API.Controllers.InvoicesController.Post (BillingSystem.API)' with route pattern 'api/Invoices' is valid for the request path '/api/Invoices'
2025-11-13 11:28:27.240 +03:00 [DBG] Request matched endpoint 'BillingSystem.API.Controllers.InvoicesController.Post (BillingSystem.API)'
2025-11-13 11:28:27.245 +03:00 [DBG] Static files was skipped as the request already matched an endpoint.
2025-11-13 11:28:32.775 +03:00 [INF] Executing endpoint 'BillingSystem.API.Controllers.InvoicesController.Post (BillingSystem.API)'
2025-11-13 11:28:32.796 +03:00 [INF] Route matched with {action = "Post", controller = "Invoices"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Post(BillingSystem.Application.Requests.CreateInvoiceRequest) on controller BillingSystem.API.Controllers.InvoicesController (BillingSystem.API).
2025-11-13 11:28:32.801 +03:00 [DBG] Execution plan of authorization filters (in the following order): ["None"]
2025-11-13 11:28:32.805 +03:00 [DBG] Execution plan of resource filters (in the following order): ["None"]
2025-11-13 11:28:32.810 +03:00 [DBG] Execution plan of action filters (in the following order): ["Microsoft.AspNetCore.Mvc.ModelBinding.UnsupportedContentTypeFilter (Order: -3000)","Microsoft.AspNetCore.Mvc.Infrastructure.ModelStateInvalidFilter (Order: -2000)","BillingSystem.API.ActionFilters.AuditBillingRequestsFilter","BillingSystem.API.ActionFilters.IdempotencyFilter (Order: 0)"]
2025-11-13 11:28:32.816 +03:00 [DBG] Execution plan of exception filters (in the following order): ["None"]
2025-11-13 11:28:32.820 +03:00 [DBG] Execution plan of result filters (in the following order): ["Microsoft.AspNetCore.Mvc.Infrastructure.ClientErrorResultFilter (Order: -2000)","Microsoft.AspNetCore.Mvc.ProducesAttribute (Order: 0)","BillingSystem.API.ActionFilters.IdempotencyFilter (Order: 0)"]
2025-11-13 11:28:32.827 +03:00 [DBG] Executing controller factory for controller BillingSystem.API.Controllers.InvoicesController (BillingSystem.API)
2025-11-13 11:28:32.831 +03:00 [DBG] Executed controller factory for controller BillingSystem.API.Controllers.InvoicesController (BillingSystem.API)
2025-11-13 11:28:32.835 +03:00 [DBG] Attempting to bind parameter 'invoiceRequest' of type 'BillingSystem.Application.Requests.CreateInvoiceRequest' ...
2025-11-13 11:28:32.838 +03:00 [DBG] Attempting to bind parameter 'invoiceRequest' of type 'BillingSystem.Application.Requests.CreateInvoiceRequest' using the name '' in request data ...
2025-11-13 11:28:32.842 +03:00 [DBG] Selected input formatter 'Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonInputFormatter' for content type 'application/json'.
2025-11-13 11:28:32.845 +03:00 [DBG] Connection id "0HNH2H2QCOJMH", Request id "0HNH2H2QCOJMH:00000001": started reading request body.
2025-11-13 11:28:32.849 +03:00 [DBG] Connection id "0HNH2H2QCOJMH", Request id "0HNH2H2QCOJMH:00000001": done reading request body.
2025-11-13 11:28:32.852 +03:00 [DBG] JSON input formatter succeeded, deserializing to type 'BillingSystem.Application.Requests.CreateInvoiceRequest'
2025-11-13 11:28:32.855 +03:00 [DBG] Done attempting to bind parameter 'invoiceRequest' of type 'BillingSystem.Application.Requests.CreateInvoiceRequest'.
2025-11-13 11:28:32.860 +03:00 [DBG] Done attempting to bind parameter 'invoiceRequest' of type 'BillingSystem.Application.Requests.CreateInvoiceRequest'.
2025-11-13 11:28:32.864 +03:00 [DBG] Attempting to validate the bound parameter 'invoiceRequest' of type 'BillingSystem.Application.Requests.CreateInvoiceRequest' ...
2025-11-13 11:28:32.867 +03:00 [DBG] Done attempting to validate the bound parameter 'invoiceRequest' of type 'BillingSystem.Application.Requests.CreateInvoiceRequest'.
2025-11-13 11:28:48.673 +03:00 [DBG] Entity Framework Core 9.0.9 initialized 'BillingServiceDBContext' using provider 'Microsoft.EntityFrameworkCore.SqlServer:9.0.9' with options: EngineType=SqlServer 
2025-11-13 11:28:48.681 +03:00 [DBG] Creating DbConnection.
2025-11-13 11:28:48.683 +03:00 [DBG] Created DbConnection. (2ms).
2025-11-13 11:28:48.685 +03:00 [DBG] Opening connection to database 'GAC-BillingService' on server '.'.
2025-11-13 11:28:48.689 +03:00 [DBG] Opened connection to database 'GAC-BillingService' on server '.'.
2025-11-13 11:28:48.692 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-11-13 11:28:48.695 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (3ms).
2025-11-13 11:28:48.699 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (6ms).
2025-11-13 11:28:48.702 +03:00 [DBG] Executing DbCommand [Parameters=[@__idempotentKey_0='?' (Size = 36) (DbType = AnsiString)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [Invoices] AS [i]
        WHERE CONVERT(varchar(36), [i].[ExternalId]) = @__idempotentKey_0) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2025-11-13 11:28:48.712 +03:00 [INF] Executed DbCommand (10ms) [Parameters=[@__idempotentKey_0='?' (Size = 36) (DbType = AnsiString)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [Invoices] AS [i]
        WHERE CONVERT(varchar(36), [i].[ExternalId]) = @__idempotentKey_0) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2025-11-13 11:28:48.729 +03:00 [DBG] Closing data reader to 'GAC-BillingService' on server '.'.
2025-11-13 11:28:48.733 +03:00 [DBG] A data reader for 'GAC-BillingService' on server '.' is being disposed after spending 3ms reading results.
2025-11-13 11:28:48.736 +03:00 [DBG] Closing connection to database 'GAC-BillingService' on server '.'.
2025-11-13 11:28:48.739 +03:00 [DBG] Closed connection to database 'GAC-BillingService' on server '.' (3ms).
2025-11-13 11:29:03.343 +03:00 [DBG] Request was short circuited at action filter 'BillingSystem.API.ActionFilters.IdempotencyFilter'.
2025-11-13 11:29:03.351 +03:00 [DBG] List of registered output formatters, in the following order: ["Microsoft.AspNetCore.Mvc.Formatters.HttpNoContentOutputFormatter","Microsoft.AspNetCore.Mvc.Formatters.StringOutputFormatter","Microsoft.AspNetCore.Mvc.Formatters.StreamOutputFormatter","Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonOutputFormatter"]
2025-11-13 11:29:03.361 +03:00 [DBG] No information found on request to perform content negotiation.
2025-11-13 11:29:03.364 +03:00 [DBG] Attempting to select the first output formatter in the output formatters list which supports a content type from the explicitly specified content types '["application/json"]'.
2025-11-13 11:29:03.372 +03:00 [DBG] Selected output formatter 'Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonOutputFormatter' and content type 'application/json' to write the response.
2025-11-13 11:29:03.377 +03:00 [INF] Executing ConflictObjectResult, writing value of type 'System.String'.
2025-11-13 11:29:03.381 +03:00 [INF] Executed action BillingSystem.API.Controllers.InvoicesController.Post (BillingSystem.API) in 30554.2325ms
2025-11-13 11:29:03.386 +03:00 [INF] Executed endpoint 'BillingSystem.API.Controllers.InvoicesController.Post (BillingSystem.API)'
2025-11-13 11:29:03.390 +03:00 [INF] HTTP POST /api/Invoices responded 409 in 36144.7090 ms
2025-11-13 11:29:03.397 +03:00 [DBG] Connection id "0HNH2H2QCOJMH" completed keep alive response.
2025-11-13 11:29:03.401 +03:00 [DBG] 'BillingServiceDBContext' disposed.
2025-11-13 11:29:03.405 +03:00 [DBG] Disposing connection to database 'GAC-BillingService' on server '.'.
2025-11-13 11:29:03.408 +03:00 [DBG] Disposed connection to database '' on server '' (3ms).
2025-11-13 11:29:03.412 +03:00 [INF] Request finished HTTP/1.1 POST https://localhost:7257/api/Invoices - 409 null application/json; charset=utf-8 36187.8106ms
